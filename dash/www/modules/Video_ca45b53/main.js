define(["backbone","Handlebars","QuickBase","css!./css/app.css"],function(e,t,i){"use strict";var o,n=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=(r.getComponentDefinition=function(e){var t,i,o={id:20019,componentName:"Video",componentDescription:"Video",appKey:"Video",css:"video",listViewThumb:e.websiteUrl+"Images/video.png",ghostViewThumb:null,buildViewThumb:null,appArgs:{websiteUrl:e.websiteUrl,json:{version:"4.4.1",Basic:{BaseTime:"",Position:"",Playing:"",VideosSrc:"",Theme:"Dark"},Style:{advanced:""}},schema:{type:"object",title:"Properties",properties:{Basic:{type:"object",title:"Settings",options:{collapsed:!1},propertyOrder:200,properties:{BaseTime:{type:"string",title:"BaseTime",default:""},Position:{type:"string",title:"Position",default:""},Playing:{type:"number",title:"Playing",format:"number"},VideosSrc:{type:"string",title:"Video Source",default:""},Theme:{type:"string",title:"Theme",options:{hidden:!0},enum:["Dark","Light"]},DashboardTheme:{options:{hidden:!0}}}},Style:{type:"object",title:"Style",options:{collapsed:!0},propertyOrder:210,properties:{advanced:{type:"css",title:"Advanced CSS",default:""}}}}}}};if(0<_.keys(e.settingsModel.attributes).length)for(i=r.upgrades.indexOf(_.find(r.upgrades,{version:e.settingsModel.get("version")}))+1;i<r.upgrades.length;i+=1)(t=r.upgrades[i]).fn(e.settingsModel,e),e.settingsModel.set("version",t.version);return o},r);function r(){}s.upgrades=[{version:0,fn:function(){}},{version:"4.3.0",fn:function(e){var t=e.get("Basic");t.Playing=t.Playing||0,e.set("Basic",t)}},{version:"4.4.1",fn:function(e){var t=e.get("Basic");t.VideosSrc=void 0===t.VideosSrc?"":t.VideosSrc,e.set("Basic",t)}}];l.app=t.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,n){var s,r=null!=t?t:e.nullContext||{},a=e.hooks.helperMissing,d="function",l=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<video>\n    <source src="'+l(typeof(s=null!=(s=e(i,"srcUrl")||(null!=t?e(t,"srcUrl"):t))?s:a)==d?s.call(r,{name:"srcUrl",hash:{},data:n,loc:{start:{line:2,column:17},end:{line:2,column:27}}}):s)+'" type="video/mp4">\n    <p>Your browser doesn\'t support HTML5 video. Here is\n       a <a href="'+l(typeof(s=null!=(s=e(i,"srcUrl")||(null!=t?e(t,"srcUrl"):t))?s:a)==d?s.call(r,{name:"srcUrl",hash:{},data:n,loc:{start:{line:4,column:18},end:{line:4,column:28}}}):s)+'">link to the video</a> instead.</p>\n</video>'},useData:!0});var a,d=l;function l(){}function p(e){var t=a.call(this,e)||this;return t.videoEl=t.el.getElementsByTagName("video").item(0),t.baseProp="",t.posProp="",t.stateProp=0,t.validVideo=!1,t.videoSrc="",t.BASE_PROP="Basic.BaseTime",t.POS_PROP="Basic.Position",t.STATE_PROP="Basic.Playing",t.VIDEOSRC_PROP="Basic.VideosSrc",t.api=e.api,t.hasInit=!1,t.updateVideoSrcUrl(),t}return a=e.View,n(p,a),p.prototype.onResize=function(){},p.prototype.onSettingsChange=function(e){void 0!==e[this.BASE_PROP]&&(this.baseProp=e[this.BASE_PROP]),void 0!==e[this.POS_PROP]&&(this.posProp=e[this.POS_PROP]),void 0!==e[this.STATE_PROP]&&(this.stateProp=e[this.STATE_PROP]),void 0!==e[this.VIDEOSRC_PROP]&&(this.videoSrc=e[this.VIDEOSRC_PROP],this.updateVideoSrcUrl()),this.validVideo=!1,this.hasInit||(this.hasInit=!0)},p.prototype.initVideo=function(){var e=this;this.videoEl=this.el.getElementsByTagName("video").item(0),this.videoEl.addEventListener("loadeddata",function(){return e.updateVideoPosition()}),this.updateVideoPosition()},p.prototype.updateVideoPosition=function(){var e,t;!this.validVideo&&this.videoEl.readyState&&(this.validVideo=!0,e=i.Tools.convertValueToMoment(this.posProp),t=i.Tools.convertValueToMoment(this.baseProp),(e=(Number(e)-Number(t))/1e3)&&.5<=Math.abs(this.videoEl.currentTime-e)&&(this.videoEl.currentTime,this.videoEl.currentTime=e),0<this.stateProp?(this.videoEl.playbackRate=this.stateProp,void 0!==(t=this.videoEl.play())&&t.then(function(){}).catch(function(){})):this.videoEl.pause()),window.requestAnimationFrame(this.updateVideoPosition.bind(this))},p.prototype.updateVideoSrcUrl=function(){var e=this;this.videoEl&&this.videoEl.removeEventListener("loadeddata",function(){return e.updateVideoPosition()}),this.el.innerHTML=d.app({srcUrl:this.videoSrc}),this.$el.addClass("video-container"),this.initVideo()},p.getComponentDefinition=s.getComponentDefinition,p});