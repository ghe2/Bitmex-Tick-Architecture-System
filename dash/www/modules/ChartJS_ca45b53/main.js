define(["Handlebars","QuickBase","moment","xlsx","chartjs","backbone","Forms","css!./css/app.css"],function(f,y,g,H,E,r,N){"use strict";var V,i,e=this&&this.__extends||(V=function(e,t){return(V=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}V(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),m=this&&this.__assign||function(){return(m=Object.assign||function(e){for(var t,i=1,a=arguments.length;i<a;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Y=(i=r.DeepModel,e(o,i),o.prototype.getColumnKeysFromAxisString=function(e,t){var i,a=/\/[gimsuy]*$/,o="",r=(0===e.indexOf("/")?(i=e.substring(1).replace(a,""),o=(a=e.match(a))?a[0].substring(1):""):i="^"+(e=e.replace(/[\-\[\]\/\{\}\(\)\+\?\.\\\^\$\|]/g,"\\$&")).replace(/\*/g,"(.*)")+"$",new RegExp(i,o));return t.getColumnNames().filter(function(e){return e.match(r)})},o.prototype.getLabels=function(){return this.labels},o.prototype.getPaletteColor=function(e){return this.palette[e%this.palette.length]},o.prototype.setPalette=function(e){this.palette=e},o.prototype.getDatasetLength=function(){return this.dataset.length},o.prototype.updateData=function(C,e,t){var i,L,a,T=this;this.checkForMissingFields(C,e,t)&&(this.datasource=C,this.setPreviousChartData(),this.chartData={},t=e.find(function(e){return e.get("_Hidden._Label")===T.get("Axes.XAxisID")}),e=this.get("Axes.XAxisData"),i=this.getColumnKeysFromAxisString(e,C),L=0===e.indexOf("/")||-1!==e.indexOf("*"),this.isWild=L,0<i.length&&(a=this.getDataAccessor(C,i[0]),e=C.getData().map(function(e){return a(e)}),this.labels=t.get("Labels.FilterUnique")?_.uniq(e):e),i.forEach(function(s){var l=T.getDataAccessor(C,s);switch(T.get("_Hidden._Type")){case"Candlestick":T.chartDataMapping[s]={colX:s};var e=_.map(C.getData().models,function(e){return parseFloat(e.get(T.get("Axes.High")))}),t=_.map(C.getData().models,function(e){return parseFloat(e.get(T.get("Axes.Low")))}),i=T.getDataAccessor(C,T.get("Axes.Open")),a=T.getDataAccessor(C,T.get("Axes.Close")),o=T.getDataAccessor(C,T.get("Axes.High")),r=T.getDataAccessor(C,T.get("Axes.Low")),n=_.max(e),d=_.min(t);T.chartData[s]=C.getData().map(function(e){return{c:a(e),h:o(e),l:r(e),o:i(e),x:l(e),y:o(e)===n?1.05*(void 0===n?1:n):.95*(void 0===d?1:d)}});break;case"Violin":T.chartDataMapping[s]={colX:s};var e=_.flatten(_.map(C.getData().models,function(e){return _.map(e.get(T.get("Axes.Coords")),function(e){return parseFloat(e)})})),c=T.getViolinDataAccessor(C,T.get("Axes.Coords")),u=_.max(e),h=_.min(e);T.chartData[s]=C.getData().map(function(e){var t=c(e),i=void 0===u?1:u,a=void 0===h?1:h,o=_.max(_.map(t,function(e){return parseFloat(e)}));return{data:_.map(t,function(e){return parseFloat(e)}),median:_.mean(_.map(t,function(e){return parseFloat(e)})),x:l(e),y:void 0===o?0:i<=o?1.05*i:.95*a}});break;case"BoxPlot":T.chartDataMapping[s]={colX:s};var t=_.map(C.getData().models,function(e){return parseFloat(e.get(T.get("Axes.Min")))}),e=_.map(C.getData().models,function(e){return parseFloat(e.get(T.get("Axes.Max")))}),p=T.getDataAccessor(C,T.get("Axes.Min")),g=T.getDataAccessor(C,T.get("Axes.Q1")),m=T.getDataAccessor(C,T.get("Axes.Median")),f=T.getDataAccessor(C,T.get("Axes.Q3")),y=T.getDataAccessor(C,T.get("Axes.Max")),x=T.getDataAccessor(C,T.get("Axes.Outliers")),b=_.min(t),v=_.max(e);T.chartData[s]=C.getData().map(function(e){var t=x(e);return{max:y(e),median:m(e),min:p(e),outliers:_.isArray(t)?t:null,q1:g(e),q3:f(e),whiskerMax:y(e),whiskerMin:p(e),x:l(e),y:y(e)===v?1.05*(void 0===v?1:v):.95*(void 0===b?1:b)}});break;case"Line":case"Bar":case"Bubble":var t=T.get("Axes.YAxisData"),e=[],S=!1;"string"==typeof t&&(S=0===t.indexOf("/")||-1!==t.indexOf("*"),e=T.getColumnKeysFromAxisString(t,C),T.isWild=L||S),!e.length&&/^(-[\d.]+$)|[\d.]+$/.test(t)&&(e=[parseFloat(t)],S=!1),_.each(e,function(e){var t,i,a,o=[],o=(L&&o.push(s),S&&o.push(e.toString()),o.join(":")),r="number"==typeof e,n=r?e:T.getDataAccessor(C,e);T.chartDataMapping[o]={colX:s,colY:e},"Bubble"===T.get("_Hidden._Type")?(t=T.get("Axes.RadiusScaling"),i="Fixed Size"===T.get("Axes.Radius")?2:T.get("Axes.Radius"),a=T.getDataAccessor(C,T.get("Axes.Radius")),T.chartData[o]=C.getData().map(function(e){return{r:"number"==typeof i?i*t:Number(a(e))*t,x:l(e),y:r?n:n(e)}})):T.chartData[o]=C.getData().map(function(e){return{x:l(e),y:r?n:n(e)}})})}}),this.updateVisuals())},o.prototype.updateVisuals=function(){var e=this.computeCommonProps(),t=this.computeTypedProps();this.dataset=_.map(e,function(e){return _.extend({},t,e)})},o.prototype.computeHighlightRules=function(e,t,i,a){var o=this.get("HighlightRules"),r=[],n=e||this.get("Axes.YAxisData"),s=x.alpha(t,_.isNil(i)?80:i);if(o&&o.length){var l=o.map(function(e){return new RegExp((e.RuleTarget||"*").replace(/\*/g,"(.*)$"))});if(this.chartData[e]&&this.datasource)for(var d=0;d<this.datasource.getData().length;d++){var c=this.computeColorInternal(n,a,d,o,l);r.push(c?x.alpha(c,i):s)}return r}return s},o.prototype.computeColor=function(e,t,i,a,o){var r=this.get("HighlightRules");return x.alpha(this.computeColorInternal(e||this.get("Axes.YAxisData"),a,o,r,r.map(function(e){return new RegExp((e.RuleTarget||"*").replace(/\*/g,"(.*)$"))}))||t,i)},o.prototype.getLabelSettings=function(){var o=this,e=this.get("Labels"),t=e.Enabled,i=e.Frequency,a=e.Color,r=e.Anchor,n=e.Align,s=e.Offset,l=e.Template,e=e.Font,d=this.get("Labels"),c=d.Rotation,u=d.ShowOverlap,h=f.compile(l),p=["start","center","end"],g=["top","center","bottom"],m="iterative"===r||"iterative"===n||"auto",c=_.isNil(c)?0:c,u=!_.isNil(u)&&u;return{align:function(e){return"iterative"===n?g[e.dataIndex%g.length]:n},anchor:function(e){return"iterative"===r?p[e.dataIndex%p.length]:r},clamp:!0,clip:!0,color:a,display:function(e){return!!t&&(!!u||e.dataIndex%i==0&&m)},font:{size:e?e.Size:12,weight:e&&e.Bold?"bold":"normal"},formatter:function(t,e){if(!o.datasource)return"";e=o.datasource.getData().at(e.dataIndex).toJSON();try{var i=Object.assign({},e,t),a=(i.cols=e,o.datasource.getApi().getTemplateViewStates(l));return h(_.assignIn(i,a))}catch(e){return _.isNumber(t.y)?t.y:t.x}},rotation:c,offset:s}},o.prototype.checkForMissingFields=function(e,t,i){var a=this;return e?!o.dataFieldsMap[this.get("_Hidden._Type")].filter(function(e){return!a.get(e)}).length&&(!!t.find(function(e){return e.get("_Hidden._Label")===a.get("Axes.XAxisID")})&&!!i.find(function(e){return e.get("_Hidden._Label")===a.get("Axes.YAxisID")})):(this.initialize(),!1)},o.prototype.getDataAccessor=function(e,t){var i=e.getPropertyFromColumn(t.toString()),t=e.getColumnType(i);return 12<=t&&t<=19?function(e){return B.convertKDBTemporalToMoment(e.get(i))}:7===t?function(e){return void 0===e.get(i)||_.isNil(e.get(i))?null:Number(e.get(i))}:function(e){return e.get(i)}},o.prototype.getViolinDataAccessor=function(e,t){var i=e.getPropertyFromColumn(t.toString());return function(e){return e.get(i)}},o.prototype.getPreviousChartData=function(e,t){e=0<=_.indexOf(Object.keys(this.previousChartData),e)?e:"";if(this.previousChartData&&this.previousChartData[e]){e=_.map(this.previousChartData[e],"y");if(e.length>=t)return e[t]}return null},o.prototype.setPreviousChartData=function(){this.previousChartData=_.extend({},this.chartData)},o.prototype.getRandomColour=function(e){var t=this.palette,e=e%t.length;return t[e]||"#0061FF"},o.prototype.computeColorInternal=function(r,n,s,e,l){var d,c,u=this,t=this.get("Basics"),i=t.Focus,t=t.Data,i=i?_.first(x.focus2Array(i)):[],h=void 0===i?0:i.length;return(c=t.dataSet&&t.dataSet.breakdownColumns?t.dataSet.breakdownColumns:c)&&c.attributes&&(c=c.get("value")),e.forEach(function(e,t){if(l[t].test(r)&&e.RuleSource){t="<this>"!==e.RuleSource?e.RuleSource:r;if("{breakdownId}"===e.RuleSource&&(t=c&&c[h]?c[h]:e.RuleSource),!u.datasource)return"#ffffff";var i,a,o,t=("string"==typeof s?u.datasource.getData().get(s):u.datasource.getData().at(s)).get(t);"iterative"===e.RuleType?(i=e.Palette[s%e.Palette.length],d=i.type||"#ffffff"):"gradient"===e.RuleType?(i=e.Palette,a=e.RuleMin,o=e.RuleMax,d=x.interpolateColor(i,a,o,t)):e.RuleOperation&&(i=e.RuleOperation,a=e.RuleValue,o=e[n],"previous"===a&&(a=u.getPreviousChartData(r,s)),x.getConditionResult(t,a,i)&&(d=o))}}),d},o.prototype.computeCommonProps=function(){var e,t,s=this,l=0,d={};return this.datasource&&(t="Bar"===this.get("_Hidden._Type")?"Bars":this.get("_Hidden._Type"),0<=_.indexOf(["Bar","BoxPlot","Candlestick","Violin"],this.get("_Hidden._Type"))&&(d={barPercentage:this.get(t+".BarPercentage")/100,categoryPercentage:this.get(t+".CategoryPercentage")/100},"percentage"!==this.get(t+".BarWidthType")&&(e=this.get(t+".MaxBarThickness"),t=this.get(t+".BarThickness"),d.barThickness=t,d.maxBarThickness=e,d.minBarLength=0))),"Candlestick"===this.get("_Hidden._Type")?_.map(this.chartData,function(e,t){return _.merge({borderColor:x.alpha(s.get("Basics.BorderColor"),s.get("Basics.BorderOpacity")),borderWidth:s.get("Basics.BorderWidth"),colX:s.chartDataMapping[t].colX,colY:s.chartDataMapping[t].colY,data:e,dataKey:t,id:s.get("_Hidden._LayerId")+":"+t,index:s.get("_Hidden._Index"),label:s.isWild?t:s.get("Basics.Name"),layerId:s.get("_Hidden._LayerId"),type:s.getChartType(),xAxisID:s.get("Axes.XAxisID"),yAxisID:s.get("Axes.YAxisID")},d)}):_.map(this.chartData,function(e,t){var i=s.getRandomColour(l),a=(l+=1,"circle"),o=("Bubble"===s.get("_Hidden._Type")?(a=s.get("Bubbles.PointStyle")?s.get("Bubbles.PointStyle"):"circle",s.get("Bubbles.Icons")&&(a=s.get("Bubbles.Icons"))):"Line"===s.get("_Hidden._Type")&&(a=s.get("Points.PointStyle")?s.get("Points.PointStyle"):"circle"),s.get("Basics.BackgroundColor")),r=s.get("Points.PointBackgroundColor")?s.get("Points.PointBackgroundColor"):o,n=s.get("Points.PointBorderColor")?s.get("Points.PointBorderColor"):r;return _.merge({backgroundColor:s.computeHighlightRules(t,s.isWild?i:o,s.get("Basics.BackgroundOpacity"),"RuleColor"),borderColor:s.get("Line")?x.alpha(s.isWild?i:s.get("Basics.BorderColor"),s.get("Basics.BorderOpacity")):s.computeHighlightRules(t,s.isWild?i:s.get("Basics.BorderColor"),s.get("Basics.BorderOpacity"),"RuleBorderColor"),borderDash:s.getBorderDash(),borderWidth:s.get("Basics.BorderWidth"),colX:s.chartDataMapping[t].colX,colY:s.chartDataMapping[t].colY,data:e,dataKey:t,datalabels:s.getLabelSettings(),defaultBackgroundColor:x.alpha(s.isWild?i:s.get("Basics.BackgroundColor"),s.get("Basics.BackgroundOpacity")),defaultBorderColor:x.alpha(s.isWild?i:s.get("Basics.BorderColor"),s.get("Basics.BorderOpacity")),id:s.get("_Hidden._LayerId")+":"+t,index:s.get("_Hidden._Index"),label:s.isWild?t:s.get("Basics.Name"),layerId:s.get("_Hidden._LayerId"),pointBackgroundColor:s.computeHighlightRules(t,s.isWild?i:r,s.get("Points.PointBackgroundOpacity"),"RuleColor"),pointBorderColor:s.computeHighlightRules(t,s.isWild?i:n,s.get("Points.PointBorderOpacity"),"RuleBorderColor"),pointRadius:s.get("Points.PointRadius"),pointStyle:a,type:s.getChartType(),xAxisID:s.get("Axes.XAxisID"),yAxisID:s.get("Axes.YAxisID")},d)})},o.prototype.getChartType=function(){return this.get("Candlestick.OHLC")?"ohlc":this.get("_Hidden._Type").toLowerCase()},o.prototype.getBorderDash=function(){var e=this.get("Line.DashGap"),t=this.get("Line.DashWidth");return e&&t?[t,e]:[]},o.prototype.computeTypedProps=function(){switch(this.get("_Hidden._Type")){case"Bubble":return{fill:!0,hoverBackgroundColor:this.get("Bubbles.HoverBackgroundColor"),hoverBorderColor:this.get("Bubbles.HoverBorderColor"),hoverBorderWidth:this.get("Bubbles.HoverBorderWidth"),hoverRadius:this.get("Bubbles.HoverRadius")};case"Candlestick":return{borderColor:this.get("Candlestick.BorderColor"),color:{down:this.get("Candlestick.BearColor"),unchanged:this.get("Candlestick.NeutralColor"),up:this.get("Candlestick.BullColor")}};case"Line":var e=/^Layer (\d+)$/,t=this.get("Line.Fill"),e=(/^[+][0-9]+$/.test(t)?t=t.replace("+","-"):e.test(t)&&(e=null===(e=e.exec(t))?0:e[1],t=this.collection.length-Number(e)),this.get("Interpolation.Interpolation"));return{cubicInterpolationMode:"Monotone"===e?"monotone":"default",dashGap:this.get("Line.DashGap"),dashWidth:this.get("Line.DashWidth"),fadetoTransparent:this.get("Line.FadeToTransparent"),fill:t,lineTension:"Cubic"===e?this.get("Interpolation.LineTension")/20:"Linear"===e?0:1,pointBackgroundColor:x.alpha(this.get("Points.PointBackgroundColor"),this.get("Points.PointBackgroundOpacity")),pointBorderColor:x.alpha(this.get("Points.PointBorderColor"),this.get("Points.PointBorderOpacity")),pointBorderWidth:this.get("Points.PointBorderWidth"),pointHitRadius:this.get("Points.PointHitRadius"),pointHoverBackgroundColor:this.get("Points.PointHoverBackgroundColor"),pointHoverBorderColor:this.get("Points.PointHoverBorderColor"),pointHoverBorderWidth:this.get("Points.PointHoverBorderWidth"),pointHoverRadius:this.get("Points.PointHoverRadius"),pointRadius:this.get("Points.PointRadius"),pointStyle:this.get("Points.PointStyle"),showLine:this.get("Line.ShowLine"),spanGaps:this.get("Line.SpanGaps"),steppedLine:"Stepped"===e&&this.get("Interpolation.SteppedLine")};case"Bar":return{hoverBackgroundColor:x.alpha(this.get("Bars.HoverBackgroundColor"),this.get("Bars.HoverBackgroundOpacity")),hoverBorderColor:x.alpha(this.get("Bars.HoverBorderColor"),this.get("Bars.HoverBorderOpacity")),hoverBorderWidth:this.get("Bars.HoverBorderWidth"),pointRadius:4,pointStyle:"rectRot"};case"Violin":case"BoxPlot":return}},o.commonVisualFields=["_Hidden._Index","Basics.Name","Basics.LegendLabelColor","Basics.BackgroundColor","Basics.BackgroundOpacity","Basics.BorderColor","Basics.BorderOpacity","Basics.BorderWidth","Axes.XAxisID","Axes.YAxisID","Labels"],o.dataFieldsMap={Bar:(o.commonDataFields=["_Hidden._Type","Basics.Data","Axes.XAxisData"]).concat(["Axes.YAxisData"]),BoxPlot:["Axes.Min","Axes.Max","Axes.Q1","Axes.Median","Axes.Q3","Axes.Outliers"],Bubble:o.commonDataFields.concat(["Axes.Radius","Axes.RadiusScaling","Axes.YAxisData"]),Candlestick:["Axes.Low","Axes.Close","Axes.High","Axes.Open"],Line:o.commonDataFields.concat(["Axes.YAxisData"]),Violin:["Axes.Coords"]},o.visualFieldsMap={Bar:o.commonVisualFields.concat(["Bars"]),BoxPlot:o.commonVisualFields.concat(["BoxPlot"]),Bubble:o.commonVisualFields.concat(["Bubbles"]),Candlestick:o.commonVisualFields.concat(["Candlestick"]),Line:o.commonVisualFields.concat(["Line","Interpolation","Points"]),Violin:o.commonVisualFields.concat(["Violin"])},o.typedFieldsMap={Bar:["Bars"],BoxPlot:["Axes.Min","Axes.Max","Axes.Q1","Axes.Median","Axes.Q3","Axes.Outliers","BoxPlot"],Bubble:["Axes.Radius","Axes.RadiusScaling","Bubbles"],Candlestick:["Axes.Low","Axes.Close","Axes.High","Axes.Open","Candlestick"],Line:["_Hidden._PossibleLayers","Line","Interpolation","Points"],Violin:["Axes.Coords","Violin"]},o);function o(){var e=null!==i&&i.apply(this,arguments)||this;return e.columns=[],e.labels=[],e.chartDataMapping={},e.chartData={},e.previousChartData={},e.dataset=[],e.isWild=!1,e.palette=[],e}a=r.Collection,e(n,a),n.prototype.modelId=function(e){return e._Hidden._LayerId+e._Hidden._Type},n.prototype.getUniqueLayerName=function(e){var t=[],i=/^[0-9]*$/;return this.map(function(e){return e.get("Basics.Name")}).forEach(function(e){e=e.substr(e.lastIndexOf(" ")+1);0<e.length&&i.test(e)&&t.push(parseInt(e,10))}),t.sort(function(e,t){return t-e}),t.length?e.substr(0,e.lastIndexOf(" ")+1)+(t[0]+1):e+" 1"};var a,j=n;function n(){var e=null!==a&&a.apply(this,arguments)||this;return e.model=Y,e}s=r.DeepModel,e(z,s),z.prototype.toChartJSON=function(){return{duration:this.get("Enabled")?this.get("Duration"):0,easing:this.get("Easing")}};var s,W=z;function z(){return null!==s&&s.apply(this,arguments)||this}X=r.DeepModel,e(d,X),d.extractScales=function(h){var e=h.get("Range.SoftRange"),e="time"===h.get("_Hidden._Type")?{break:parseInt(h.get("Labels.TimeFormats.Break"),10),display:h.get("Display"),distribution:h.get("Labels.TimeFormats.Distribution"),gridLines:{color:x.alpha(h.get("GridLines.GridLinesColor"),h.get("GridLines.GridLinesOpacity")),drawBorder:!1,offsetGridLines:h.get("GridLines.OffsetGridLines"),zeroLineColor:x.alpha(h.get("GridLines.GridLinesColor"),h.get("GridLines.GridLinesOpacity"))},id:h.get("_Hidden._Label"),offset:h.get("Labels.Offset"),position:h.get("Position"),scaleLabel:{display:h.get("Title.Display"),fontColor:x.alpha(h.get("Title.FontColor"),h.get("Title.FontOpacity")),fontFamily:h.get("Title.FontFamily"),fontSize:h.get("Title.FontSize"),fontStyle:h.get("Title.FontStyle"),labelString:h.get("Title.LabelString")},stacked:h.get("Stacked"),ticks:{callback:function(e,t,i,a,o){return(0<=["1213","1214","1216","1217","1218","1219"].indexOf(o)?e.utc():e.utc().tz(B.timezone)).format(a)},display:h.get("Labels.Display"),fontColor:x.alpha(h.get("Labels.FontColor"),h.get("Labels.FontOpacity")),fontFamily:h.get("Labels.FontFamily"),fontSize:h.get("Labels.FontSize"),fontStyle:h.get("Labels.FontStyle"),major:{enabled:h.get("Labels.TimeFormats.ShowMajor")},max:h.get("Range.Max"),min:h.get("Range.Min"),maxRotation:360===h.get("Labels.MaxRotation")?void 0:h.get("Labels.MaxRotation"),minRotation:0===h.get("Labels.MinRotation")?void 0:h.get("Labels.MinRotation")},time:{displayFormats:{day:h.get("Labels.TimeFormats.Day"),hour:h.get("Labels.TimeFormats.Hour"),millisecond:h.get("Labels.TimeFormats.Millisecond"),minute:h.get("Labels.TimeFormats.Minute"),month:h.get("Labels.TimeFormats.Month"),quarter:h.get("Labels.TimeFormats.Quarter"),second:h.get("Labels.TimeFormats.Second"),week:h.get("Labels.TimeFormats.Week"),year:h.get("Labels.TimeFormats.Year")},isoWeekday:h.get("Labels.TimeFormats.IsoWeekday"),parser:function(e){var t;return g.isMoment(e)||g.isDuration(e)||(t=_.get(e,"_kdbType"))&&0<=["1216","1217","1218","1219"].indexOf(t)&&(e=g(_.get(e,"_milliseconds"))),e},round:h.get("Labels.TimeFormats.Round"),stepSize:h.get("Labels.StepSize"),tooltipFormat:h.get("Labels.TimeFormats.TooltipFormat"),unit:h.get("Labels.TimeFormats.Unit")},triggerBreak:parseInt(h.get("Labels.TimeFormats.TriggerBreak"),10),type:h.get("_Hidden._Type")}:"category"===h.get("_Hidden._Type")?{display:h.get("Display"),gridLines:{color:x.alpha(h.get("GridLines.GridLinesColor"),h.get("GridLines.GridLinesOpacity")),drawBorder:!1,offsetGridLines:h.get("GridLines.OffsetGridLines"),zeroLineColor:x.alpha(h.get("GridLines.GridLinesColor"),h.get("GridLines.GridLinesOpacity"))},id:h.get("_Hidden._Label"),offset:!0,position:h.get("Position"),scaleLabel:{display:h.get("Title.Display"),fontColor:x.alpha(h.get("Title.FontColor"),h.get("Title.FontOpacity")),fontFamily:h.get("Title.FontFamily"),fontSize:h.get("Title.FontSize"),fontStyle:h.get("Title.FontStyle"),labelString:h.get("Title.LabelString")},stacked:h.get("Stacked"),ticks:{autoSkip:0===h.get("Labels.StepSize"),autoSkipPadding:5,callback:function(e,t,i){var a,o=h.get("_Hidden._Label"),r=h.get("Labels.Format"),n=h.get("Labels.Precision"),s=h.get("Labels.HideTrailingZeroes"),l=h.get("Labels.DateFormat"),r=x.getFormatter(r,n,s,l),n=_.get(this,"chart"),d=_.get(this,"id"),s=_.get(this,"ctx"),l=_.find(n.config.data.datasets,function(e){return e.xAxisID===o}),c="",u=parseFloat(h.get("Labels.StepSize"));if("category"===h.get("_Hidden._Type")?l&&_.get(l,"data")&&(a=_.map(_.get(l,"data"),"x"),e=0<t&&a[t-1]===a[t]?"":a[t]):_.some(l,function(e){return e.xAxisID===d})&&(a=_.find(l,function(e){return e.xAxisID===d}))&&a.hasOwnProperty("data")&&a.data[t]&&a.data[t].x&&(e=a.data[t].x),isNaN(e)||(e=r(e)),"horizontalBar"===n.config.type&&0===u&&0<i.length&&(u=Math.max(1,Math.round(20/(s.canvas.clientHeight/i.length)))),""!==(c="horizontalBar"===n.config.type&&t%u!=0?c:h.get("Labels.Prefix")+e+h.get("Labels.Suffix")))return c},display:h.get("Labels.Display"),fontColor:x.alpha(h.get("Labels.FontColor"),h.get("Labels.FontOpacity")),fontFamily:h.get("Labels.FontFamily"),fontSize:h.get("Labels.FontSize"),fontStyle:h.get("Labels.FontStyle"),max:h.get("Range.Max"),maxRotation:360===h.get("Labels.MaxRotation")?void 0:h.get("Labels.MaxRotation"),min:h.get("Range.Min"),minRotation:0===h.get("Labels.MinRotation")?void 0:h.get("Labels.MinRotation"),reverse:h.get("Labels.Reverse"),stepSize:h.get("Labels.StepSize"),suggestedMax:e?h.get("Range.SuggestedMax"):void 0,suggestedMin:e?h.get("Range.SuggestedMin"):void 0},type:h.get("_Hidden._Type")}:{afterFit:function(e){h.get("Labels.MaxWidth")&&(e.width=h.get("Labels.MaxWidth"))},center:h.get("Center"),display:h.get("Display"),gridLines:{color:x.alpha(h.get("GridLines.GridLinesColor"),h.get("GridLines.GridLinesOpacity")),drawBorder:!1,offsetGridLines:h.get("GridLines.OffsetGridLines"),zeroLineColor:x.alpha(h.get("GridLines.GridLinesColor"),h.get("GridLines.GridLinesOpacity"))},id:h.get("_Hidden._Label"),offset:h.get("Labels.Offset"),position:h.get("Position"),scaleLabel:{display:h.get("Title.Display"),fontColor:x.alpha(h.get("Title.FontColor"),h.get("Title.FontOpacity")),fontFamily:h.get("Title.FontFamily"),fontSize:h.get("Title.FontSize"),fontStyle:h.get("Title.FontStyle"),labelString:h.get("Title.LabelString")},stacked:h.get("Stacked"),ticks:{beginAtZero:h.get("Labels.BeginAtZero"),callback:function(e){var t=x.getFormatter(h.get("Labels.Format"),h.get("Labels.Precision"),h.get("Labels.HideTrailingZeroes"),h.get("Labels.DateFormat"));if(!isNaN(e)){if(Math.floor(e)!==e&&0===h.get("Labels.Precision"))return"";e=t(e)}return h.get("Labels.Prefix")+e+h.get("Labels.Suffix")},display:h.get("Labels.Display"),fontColor:x.alpha(h.get("Labels.FontColor"),h.get("Labels.FontOpacity")),fontFamily:h.get("Labels.FontFamily"),fontSize:h.get("Labels.FontSize"),fontStyle:h.get("Labels.FontStyle"),max:h.get("Range.Max"),maxRotation:360===h.get("Labels.MaxRotation")?void 0:h.get("Labels.MaxRotation"),min:h.get("Range.Min"),minRotation:0===h.get("Labels.MinRotation")?void 0:h.get("Labels.MinRotation"),reverse:h.get("Labels.Reverse"),stepSize:h.get("Labels.StepSize"),suggestedMax:e?h.get("Range.SuggestedMax"):void 0,suggestedMin:e?h.get("Range.SuggestedMin"):void 0},type:h.get("_Hidden._Type")};return e},d.singular=function(e){return e.replace("e","i")},d.camelCase=function(e){return e.replace("X","x").replace("Y","y")},d.prototype.initialize=function(){this.listenTo(this,"change:Range.UseMinMax",function(e,t){e.get("Range.UseMinMaxReset")&&(t?e.get("Range.UseDataRange")||void 0===e.get("Range.UseDataRange")?e.trigger("cache",{model:e,load:["Range.UseDataRange"],defaults:[!0]}):(e.trigger("cache",{model:e,load:["Range.UseDataRange"],defaults:[!1]}),e.trigger("cache",{model:e,load:["Range.SoftRange"],defaults:[!1]}),e.trigger("cache",{model:e,load:["Range.UseDataRange"],defaults:[!1]})):(e.trigger("cache",{model:e,store:["Range.UseDataRange"],defaults:[!1]}),e.trigger("cache",{model:e,store:["Range.SoftRange"]})))}),this.listenTo(this,"change:Range.UseDataRange",function(e,t){t?(e.trigger("cache",{model:e,store:["Range.SoftRange"],defaults:[!1]}),e.trigger("cache",{model:e,store:["Range.SuggestedMax","Range.SuggestedMin"]}),e.trigger("cache",{model:e,store:["Range.Max","Range.Min"]})):(e.trigger("cache",{model:e,load:["Range.SoftRange"],defaults:[!1]}),e.trigger("cache",{model:e,store:["Range.SuggestedMax","Range.SuggestedMin"]}),e.trigger("cache",{model:e,load:["Range.Max","Range.Min"],defaults:[0,0]}))}),this.listenTo(this,"change:_Hidden._Type",function(e){e.get("Range.UseMinMax")||e.trigger("cache",{model:e,store:["Range.SuggestedMax","Range.SuggestedMin"]})}),this.listenTo(this,"change:Range.SoftRange",function(e,t){e.get("Range.UseMinMax")?t?(e.trigger("cache",{model:e,load:["Range.SuggestedMax","Range.SuggestedMin"],defaults:[0,0]}),e.trigger("cache",{model:e,store:["Range.Max","Range.Min"]})):(e.get("Range.UseDataRange")?e.trigger("cache",{model:e,store:["Range.Max","Range.Min"]}):e.trigger("cache",{model:e,load:["Range.Max","Range.Min"],defaults:[0,0]}),e.trigger("cache",{model:e,store:["Range.SuggestedMax","Range.SuggestedMin"]})):(e.trigger("cache",{model:e,store:["Range.Max","Range.Min"]}),e.trigger("cache",{model:e,store:["Range.SuggestedMax","Range.SuggestedMin"]}))}),this.listenTo(this,"change:Title.Display",function(e){e.get("Title.Display")?e.trigger("cache",{defaults:["","#FFFFFF",100,"'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif'",12,"normal"],load:["Title.LabelString","Title.FontColor","Title.FontOpacity","Title.FontFamily","Title.FontSize","Title.FontStyle"],model:e}):e.trigger("cache",{model:e,store:["Title.LabelString","Title.FontColor","Title.FontOpacity","Title.FontFamily","Title.FontSize","Title.FontStyle"]})}),this.listenTo(this,"change:Labels.Display",function(e){e.get("Labels.Display")?e.trigger("cache",{defaults:["#FFFFFF",100,"'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif'",12,"normal",!e.isNumerical()&&void 0,0,"",""],load:["Labels.FontColor","Labels.FontOpacity","Labels.FontFamily","Labels.FontSize","Labels.FontStyle","Labels.Reverse","Labels.StepSize","Labels.Prefix","Labels.Suffix"],model:e}):e.trigger("cache",{model:e,store:["Labels.FontColor","Labels.FontOpacity","Labels.FontFamily","Labels.FontSize","Labels.FontStyle","Labels.Reverse","Labels.StepSize","Labels.Prefix","Labels.Suffix"]})}),this.listenTo(this,"change:Labels.Reverse",function(e,t){_.isUndefined(t)||_.isNull(t)||e.set("Labels._ReverseCache",t)})},d.prototype.isNumerical=function(){return _.includes(["linear","logarithmic"],this.get("_Hidden._Type"))};var X,l=d;function d(){var e=null!==X&&X.apply(this,arguments)||this;return e.cache={},e}Z=r.Collection,e(G,Z),G.prototype.modelId=function(e){return e._Hidden._AxisId+e._Hidden._Type};var Z,U=G;function G(){var e=null!==Z&&Z.apply(this,arguments)||this;return e.model=l,e}c.sourceKey=function(e){return e.getPath()},c.mergeChanges=function(t,i,e,a,o,r){return e&&(t=_.fromPairs(_.map(e,function(e){return[i(e),e]}))),a&&_.each(a,function(e){return _.extend(t[i(e)],e)}),o&&_.each(o,function(e){t[i(e)]=e}),r&&_.each(r,function(e){delete t[i(e)]}),t},c.prototype.setFocus=function(e){this.focus=e,this.updateChildren(),this.childDataSource&&this.childDataSource.setFocus(e)},c.prototype.getApi=function(){return this.api},c.prototype.isFocused=function(){return this.focus.length===this.depth&&(0===this.depth||this.source.id===this.focus[this.depth])},c.prototype.getColumnNames=function(){if(this.breakdownColumns&&this.breakdownColumns.length)return[c.BREAKDOWN_ID,this.breakdownColumns[0]].concat(_.difference(_.keys(this.meta),this.breakdownColumns));try{return _.map(this.meta,function(e){return[e.id,e.index]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}catch(e){return _.keys(this.meta)}},c.prototype.getColumnType=function(e){return this.childDataSource?this.childDataSource.getColumnType(e):e===c.BREAKDOWN_ID&&this.primaryKey?this.meta[this.primaryKey].kdbType:this.meta[e]?this.meta[e].kdbType:11},c.prototype.getData=function(){return this.childDataSource?this.childDataSource.getData():this.source.dataSet&&this.source.dataSet.collection},c.prototype.getDepth=function(){return this.childDataSource?this.childDataSource.getDepth():this.depth},c.prototype.getKey=function(){return this.source.cid},c.prototype.getPrimaryKey=function(){return this.childDataSource?this.childDataSource.getPrimaryKey():this.primaryKey},c.prototype.getPropertyFromColumn=function(e){return e===c.BREAKDOWN_ID?this.getPrimaryKey():e},c.prototype.getPath=function(){return this.source.path},c.prototype.getSource=function(){return this.source},c.prototype.hasData=function(){return this.childDataSource?this.childDataSource.hasData():this.hasDataFlag},c.prototype.onData=function(e,t,i){e.primaryKey!==this.primaryKey&&(this.primaryKey=e.primaryKey);var a=e.columns,o=a.reset,r=a.change,n=a.add,a=a.remove;this.meta=c.mergeChanges(this.meta,function(e){return e.id},o,r,n,a),0!==this.depth||_.isEqual(e.breakdownColumns,this.breakdownColumns)||(this.breakdownColumns=e.breakdownColumns,this.removeChild()),t.reset&&0<t.reset.length&&this.removeChild(),i&&this.updateError(this,i),this.hasDataFlag=!0,this.updateChildren()&&this.listener.updateDataSource(this)},c.prototype.subscribe=function(){this.api.subscribe(this.source,this.onData.bind(this))},c.prototype.updateDataSource=function(){this.listener.updateDataSource(this)},c.prototype.updateError=function(e,t){this.listener.updateError(this,t)},c.prototype.unsubscribe=function(){this.childDataSource&&(this.childDataSource.unsubscribe(),delete this.childDataSource),this.api.unsubscribe(this.source)},c.prototype.removeChild=function(){this.childDataSource&&(this.childDataSource.unsubscribe(),delete this.childDataSource)},c.prototype.updateChildren=function(){var e;return!(this.breakdownColumns&&this.breakdownColumns.length&&this.depth<this.breakdownColumns.length-1)||(this.focus.length>this.depth?(this.childDataSource&&this.focus[this.depth]!==this.childDataSource.getSource().id&&this.removeChild(),this.childDataSource||(0!==this.depth&&(this.focus[this.depth-1],this.source.id),(e=this.source.dataSet&&this.source.dataSet.collection.get(this.focus[this.depth]))&&(this.childDataSource=new c(e,this,this.api,this.focus,this.depth+1,this.breakdownColumns),this.childDataSource.subscribe()))):(this.removeChild(),this.focus.length!==this.depth||!this.hasDataFlag||0!==this.depth&&this.focus[this.depth-1]!=this.source.id||this.listener.updateDataSource(this)),!1)},c.BREAKDOWN_ID="{breakdownId}";var q=c;function c(e,t,i,a,o,r){this.breakdownColumns=[],this.meta={},this.hasDataFlag=!1,this.focus=[],this.source=e,this.listener=t,this.api=i,this.depth=o||0,this.breakdownColumns=r||this.breakdownColumns,this.setFocus(a)}K=r.DeepModel,e(Q,K),Q.prototype.initialize=function(e){this.api=e.api;var o=this.api;this.highlightPlugin={afterDatasetsDraw:function(e){var n=e.chart.ctx,e=e.chartArea,s=n.canvas,l=e.left+5,d=s.clientHeight-15,a=[];_.each(o.getProperty("Layers"),function(e,i){_.each(e.HighlightRules,function(e,t){e.Show&&a.push(m({layer:o.getProperty("Layers."+i+".Basics.Name")},o.getProperty("Layers."+i+".HighlightRules."+t)))})}),_.each(a,function(e){if("gradient"===e.RuleType){for(var t=n.createLinearGradient(l,0,l+15,0),i=1/(e.Palette.length-1),a=0,o=0;a<e.Palette.length;a++)t.addColorStop(o,e.Palette[a].type),o+=i;n.fillStyle=t,n.strokeStyle=t}else n.fillStyle=e.RuleColor,n.strokeStyle=e.RuleBorderColor;n.lineWidth=2,n.fillRect(l,d-2,15,15),n.strokeRect(l,d-2,15,15);var r=_.isObject(e.RuleName)?e.RuleName.get("value"):e.RuleName;l=l+15+5,n.fillStyle="#A0A0A0",n.fillText(r,l,s.clientHeight-7),l=l+n.measureText(r).width+10})}}},Q.prototype.showHeighlightRulesLegend=function(){var t=!1;return _.each(this.api.getProperty("Layers"),function(e){_.each(e.HighlightRules,function(e){e.Show&&(t=!0)})}),t};var K,J=Q;function Q(){return null!==K&&K.apply(this,arguments)||this}ee=r.DeepModel,e(F,ee),F.prototype.computeLegendProp=function(){var a=this.legendState,e=this.get("LegendScroll"),t=this.get("Display"),i=this;return{align:this.get("Align")?this.get("Align"):"center",display:!(0<=["scroll","layer group","layer new line"].indexOf(e))&&t,fullWidth:!!this.get("FullWidth"),labels:{boxWidth:this.get("BoxWidth"),filter:function(t,e){var i=!0,e=_.filter(e.datasets,function(e){return e.label===t.text});return e&&_.each(e,function(e){e=_.get(e,"layerId");e&&void 0!==a[e]&&!1===a[e]&&(i=!1)}),i},fontColor:this.get("LabelColor"),fontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif'",fontSize:this.get("LabelFontSize"),generateLabels:function(e){var t=_.get(E,"defaults.global.legend.labels");if(!t)return[];var t=t.generateLabels(e),i=e.config.data;return _.each(t,function(e,t){i&&i.datasets&&i.datasets[t]&&(_.get(i.datasets[t],"defaultBackgroundColor")&&(e.fillStyle=_.get(i.datasets[t],"defaultBackgroundColor")),_.get(i.datasets[t],"defaultBorderColor")&&(e.strokeStyle=_.get(i.datasets[t],"defaultBorderColor")))}),t},padding:this.get("Padding"),usePointStyle:this.get("UsePointStyle")},onClick:function(e,t){_.get(i.app,"legendModel")&&_.get(i.app,"legendModel").clickCount++,i.debounceClickEvents(t)},position:this.get("Position")?this.get("Position").replace("-inline",""):"top",reverse:!this.get("Reverse")}},F.prototype.setLegendStateProps=function(e){this.legendStateProps=e},F.prototype.renderhtmlLegend=function(i){var e=this.get("LegendScroll"),t=this.get("Display");0<=["scroll","layer group","layer new line"].indexOf(e)&&t?(this.externalDiv.html(this.computeLegendHTML(i.legend.legendItems,i)),this.externalDiv.find(".legendItem").on("click",function(e){var t=_.get(e,"currentTarget.parentNode.parentNode"),t=$(t).find(".legendItem"),e=_.get(e,"currentTarget");t&&!_.isNull(e)&&(e=Array.from(t).indexOf(e),$(t[e]).toggleClass("strike"),t=$(t[e]).hasClass("strike"),e=i.legend.legendItems[e].datasetIndex,i.getDatasetMeta(e).hidden=t,i.update())}),this.computehtmlLegendStyle()):this.externalDiv.html("")},F.prototype.computeLayoutProp=function(e){return this.bottomAdjust=e?20:0,this.computehtmlLegendStyle(),{padding:{bottom:this.bottom,left:this.left,right:this.right,top:this.top}}},F.prototype.toLegendJSON=function(){var e=_.extend(this.toJSON(),{});return e.externalDiv&&delete e.externalDiv,e.toolsEnabled&&delete e.toolsEnabled,e},F.prototype.restoreLayerState=function(e){e.data.datasets&&(e=e.data.datasets,this.restoreLayerStateOnDatasets(e))},F.prototype.restoreLayerStateOnDatasets=function(e){var a=this;_.forEach(e,function(e){var t,i=_.get(e,"layerId");i&&(t=_.get(e,"label"),e.hidden=t&&_.isBoolean(a.legendStateProps[t])?a.legendStateProps[t]:!a.layerState[i])})},F.prototype.updateLayerStatefromOnSettingsChanged=function(e){var t=this;this.layerState||(this.layerState={}),this.legendState||(this.legendState={}),_.forEach(e,function(e){t.layerState[e._Hidden._LayerId]=e.Basics.Enabled,t.legendState[e._Hidden._LayerId]=e.Basics.LegendEnabled})},F.prototype.updateLayerStatefromLegendClick=function(e,t){var i,a,t=_.get(t,"datasetIndex");_.get(e,"data.datasets")&&!_.isNil(t)&&(i=_.get(e,"data.datasets"),a=i[t].layerId,1<_.filter(i,function(e){return e.layerId===a}).length?(this.hasWarnedAboutWildCards||(this.hasWarnedAboutWildCards=!0),i[t].hidden=!i[t].hidden,e.update()):(this.layerState[a]=!e.getDatasetMeta(t).hidden,this.set("layerState",this.layerState)))},F.prototype.updateLayerStatefromLegendDblClick=function(e,t){t=_.get(t,"datasetIndex");if(_.get(e,"data.datasets")&&!_.isNil(t)){var i=_.get(e,"data.datasets"),a=i[t].layerId;if(1<_.filter(i,function(e){return e.layerId===a}).length)this.hasWarnedAboutWildCards||(this.hasWarnedAboutWildCards=!0),e.update();else{for(var o=0;o<i.length;o++){var r=i[o].layerId;this.layerState[r]=!e.getDatasetMeta(o).hidden}this.set("layerState",this.layerState)}}},F.prototype.clickEvents=function(e){1<this.clickCount?this.executeOnDoubleClick(e):this.executeonClick(e),this.clickCount=0},F.prototype.executeonClick=function(e){var t,i,a;_.get(this,"chart.legend.clickTime")||(t=e.datasetIndex,(a=(i=this.app.chart).getDatasetMeta(t)).hidden=!(!_.isNil(a.hidden)&&!1!==a.hidden)&&!i.data.datasets[t].hidden,this.dcHidden=!0,i.config.legendModel.updateLayerStatefromLegendClick(i,e))},F.prototype.executeOnDoubleClick=function(e){var t=_.get(e,"datasetIndex"),i=this.app.chart;if(!_.isNil(t)){for(var a=0;a<i.data.datasets.length;a++){var o=i.getDatasetMeta(a),r=_.get(o,"controller._config.layerId");r&&this.legendState[r]?o.hidden=a!==t&&this.dcHidden:o.hidden=!0}i.config.legendModel.updateLayerStatefromLegendDblClick(i,e),this.dcHidden=!this.dcHidden}},F.prototype.resetLayout=function(){this.top=0,this.bottom=this.bottomAdjust||0,this.left=0,this.right=0},F.prototype.computehtmlLegendStyle=function(){var e=this.toolsEnabled?F.TOOLS_HEIGHT:0,t=this.get("Position");0<=["scroll","layer group","layer new line"].indexOf(this.get("LegendScroll"))?("bottom"===t?this.externalDiv.css({bottom:this.bottomAdjust||0,height:this.bottom+"px",left:"",right:"",top:"",width:"auto"}):"top"===t||"top-inline"===t?this.externalDiv.css({bottom:"",height:this.top+"px",left:"",right:"",top:0,width:"auto"}):"left"===t?this.externalDiv.css({bottom:"",height:"auto",left:0,right:"",top:e,width:this.left+"px"}):"right"===t&&this.externalDiv.css({bottom:"",height:"auto",left:"",right:0,top:e,width:this.right+"px"}),this.externalDiv.css({color:this.get("LabelColor"),"font-family":"'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif'","font-size":this.get("LabelFontSize")})):(this.resetLayout(),this.externalDiv.css({bottom:this.bottomAdjust,left:"",right:"",top:""}))},F.prototype.getTextWidth=function(e){var t=document.createElement("canvas").getContext("2d"),i=parseFloat(this.get("LabelFontSize"))||0;return t?(t.font=i+"px Helvetica Neue, Helvetica, Arial, sans-serif",t.measureText(e).width):0},F.prototype.getPointStyle=function(e,t,i){var a=this.get("Padding"),o=this.get("LabelColor"),r=this.get("LabelFontSize"),n=this.get("BoxWidth"),s=this.get("UsePointStyle"),l=this.get("Position"),l="left"===l||"right"===l,d={circle:"circle",fillStyle:e.fillStyle,fontSize:r,labelColor:o,layerName:t,margin:a,radius:n/2-1,cntr:n/2,strokeStyle:e.strokeStyle,text:e.text,width:n,lblWidth:i,class:l?"":"horizontalLegend"},r={fillStyle:e.fillStyle,fontSize:r,labelColor:o,layerName:t,margin:a,rect:"rect",strokeStyle:e.strokeStyle,text:e.text,width:n,lblWidth:i,class:l?"":"horizontalLegend"};return s?d:r},F.prototype.isWildLayer=function(e,t,i,a){t=a+1<t.length?t[a+1]:null,a=t?e.data.datasets[t.datasetIndex]:null;return a&&_.get(a,"layerId")===i},F.prototype.getMaxWidth=function(e){var t=this,i=0;return _.each(e,function(e){e=t.getTextWidth(e.text);i<e&&(i=e)}),i},F.prototype.maxLegendWidth=function(e){var e=this.getMaxWidth(e),t=parseFloat(this.get("Padding"))||0;return e+((parseFloat(this.get("BoxWidth"))||0)+2*t+6)},F.prototype.computeLegendHTML=function(s,l){var d,c=this,e=this.get("Position"),t=this.get("LegendScroll"),i=this.get("LabelFontSize"),u="layer new line"===t,h=u?this.get("LegendLayerThreshold"):100,p="left"===e||"right"===e,g="scroll"===t,m=Math.floor(this.externalDiv.height()/(i+6)),f=this.app.$el.width()||100,y=u||g?1:Math.ceil(s.length/m),x="",b=0,v=0,S=0,C=p?F.VERTHTML:F.HORZHTML,L=!1,T=!1,D=[],M=this.getMaxWidth(s),k=this.maxLegendWidth(s);return _.each(s,function(e,t){var i="</div><div class=column-0>",a=l.data.datasets[e.datasetIndex],e=(d=a.layerId,c.getPointStyle(e,d,M)),o=d!==x,r=h<=S,n=c.isWildLayer(l,s,d,t),a=a.hidden,a=(e.class=a?e.class+" strike":e.class+"",T=!1,L&&!n||(n||r)&&o);n?(D.push(t),r=Math.floor((f-10)/k),!p&&1<D.length&&D.length%r==0&&(v+=18)):D=[],0<b&&a&&!g&&(r=p?"legendLineBreak":"legendSpanbreak",a=s.length-1,u&&(r="legendNewLine",v+=18,y=a!==t&&p?y+1:y,S=0),L&&!n&&(T=!0,b=0,C+=le.htmlLegend(e)),s.length-1===t&&(i=""),C=p?C+i:C+"<div class='"+r+"'></div>"),u&&(S=o?S+1:0),x=d,L=n,T||(C+=le.htmlLegend(e)),b++,p&&0<b&&b%m==0&&!g&&(C+=i,b=0)}),this.resetLayout(),"default"!==t&&(i=20*Math.ceil(s.length/(f/k)),this.updateChartPadding(k*y,e,i,v)),this.updateLayouts(l),C+="</div></div>"},F.prototype.updateChartPadding=function(e,t,i,a){"right"===t?(this.right=e,this.bottom=this.bottomAdjust):"left"===t?(this.left=e,this.bottom=this.bottomAdjust):"bottom"===t?this.bottom=a||i:(this.bottom=this.bottomAdjust,this.top=a||i)},F.prototype.updateLayouts=function(e){e.options.layout.padding.left=this.left,e.options.layout.padding.right=this.right,e.options.layout.padding.top=this.top,e.options.layout.padding.bottom=this.bottom,e.update()},F.TOOLS_HEIGHT=20,F.VERTHTML="<div class='legend-5' style='display:flex;'><div class='column-0'>",F.HORZHTML="<div class='legend-5'><div class='column-1'>";var ee,te=F;function F(e){var t=ee.call(this)||this;return t.hasWarnedAboutWildCards=!1,t.dcHidden=!0,t.right=0,t.left=0,t.top=0,t.bottom=0,t.bottomAdjust=0,t.legendStateProps={},t.clickCount=0,t.externalDiv=e.externalDiv,t.toolsEnabled=!1,t.app=e.app,t.debounceClickEvents=_.debounce(t.clickEvents.bind(t),300),t}"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e){if(null===e)throw new TypeError("Cannot convert undefined or null to object");var i=Object(e);return _.each(arguments,function(e){if(null!==e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(i[t]=e[t])}),i},writable:!0,configurable:!0});u.cache=function(l,d,c,u){var e;_.isArray(c.load)&&(e=c.load.reduce(function(e,t,i){if(!l.cache)return e;var a,o,r,n,s=l.cache[t];return s&&s.get("_viewType")&&(s=(a=s).get("value"),o=(r=(d+t).split(".")).pop(),r=r.join("."),n={},o&&(n[o]=a,u.setProperty(r,n,{bypass:!0}))),e[t]=s||c.defaults&&c.defaults[i],e},{}),l.set(e)),_.isArray(c.store)&&(e=c.store.reduce(function(e,t){var i=(d+t).split("."),a=i.pop();return a&&(e[t]=u.getProperty(i.join("."))[a]),e},{}),_.extend(l.cache,e),e=c.store.reduce(function(e,t){return e[t]=void 0,e},{}),l.set(e))},u.compareKDBTimes=function(e,t){return e.i>t.i?1:e.i<t.i?-1:e.n>t.n?1:e.n<t.n?-1:0},u.convertPropertyIfMoment=function(e){e=B.convertISODatetimeToKDBLikeObject(e);return B.isKDBTemporal(e)?B.convertKDBTemporalToMoment(e):e},u.expandNestedViewStates=function(e,t){var i,a=/([a-zA-Z]+)\.[0-9]+\./,o=Object.keys(e),r=[];return(r=_.every(o,function(){var e=t.getPropertyMeta(o[0]);return e&&"viewstate"===e.type})?_.uniq(_.filter(_.map(o,function(e){e=a.exec(e);return e?e[1]:null}))):r).length?(i={},_.each(r,function(e){return i[e]=t.getProperty(e)}),i):e},u.focus2Array=function(e){var t=[],i=/"([^"]*)"/g,e=e.toString?e.toString():"",a=/^\[([^\]]*)]$/.exec(e);if(null!==a){if(/^(?:"[^"\\]*(?:\\[\S\s][^"\\]*)*")(?:,"[^"\\]*(?:\\[\S\s][^"\\]*)*")*/.test(a[1]))for(var o=void 0;null!==(o=i.exec(a[1]));)t.push(_.map(o[1].split(","),function(e){return e.replace(/&#44;/g,",")}))}else t.push(e.split(","));return _.filter(t,function(e){return 0<(""+e).length})},u.hex2RGB=function(e){e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]:[255,255,255]},u.RGB2hex=function(e){return"#"+((1<<24)+(e[0]<<16)+(e[1]<<8)+e[2]).toString(16).slice(1)},u.clamp=function(e,t,i){return i<e?i:e<t?t:e},u.interpolateColor=function(e,t,i,a){for(var i=(i-t)/(e.length-1),a=this.clamp((a-t)/i,0,e.length-1),a=_.isNaN(a)?0:a,t=e[Math.floor(a)].type,i=e[Math.ceil(a)].type,o=this.hex2RGB(t),r=this.hex2RGB(i),n=a-Math.floor(a),s=o.slice(),l=0;l<3;l++)s[l]=Math.round(s[l]+n*(r[l]-o[l]));return this.RGB2hex(s)},u.getConditionResult=function(e,t,i){var a,o,r={isMatch:function(e,t){var i,a=!1,o=e.split(/ +and +| +/);for(_.includes(o,"or")&&(o=_.without(o,"or"),a=!0),i=0;i<o.length;i++)0!==o[i].indexOf("-")&&o[i].indexOf("*")<0&&(o[i]="*"+o[i]+"*");return _[a?"some":"every"](o,function(e){return r.isSimpleMatch(e,t)})},isSimpleMatch:function(e,t){var i=!1,e=(0===e.indexOf("-")&&(e=e.replace("-",""),i=!0),new RegExp("^"+e.replace(/\*/g,".*")+"$").test(t));return i?!e:e}},n=!1,s=isNaN(parseFloat(e))||_.isObject(e)?(""+e).toLowerCase():parseFloat(e),l=isNaN(parseFloat(t))||_.isObject(t)?(""+t).toLowerCase():parseFloat(t);switch(e&&e.class&&0<=["1212","1213","1214","1215"].indexOf(e.class)?(s=B.convertKDBTemporalToMoment(e).unix(),"in"===i?(a=[],_.each(t.toString().split(","),function(e){a.push(B.convertDateStringValueToMoment(e).unix()),l=a.toString()})):l=B.convertDateStringValueToMoment(t).unix()):e&&e.class&&0<=["1216","1217","1218","1219"].indexOf(e.class)&&(s=B.convertKDBTemporalToMoment(e).valueOfNano(),"in"===i?(o=[],_.each(t.toString().split(","),function(e){o.push(B.convertDateStringValueToMoment(e).valueOfNano()),l=o.toString()})):l=B.convertDateStringValueToMoment(t).valueOfNano()),i){case"contains":n=0<=s.toString().indexOf(l.toString());break;case"starts with":n=0===s.toString().indexOf(l.toString());break;case"ends with":n=-1!==s.toString().indexOf(l.toString(),s.toString().length-l.toString().length);break;case"==":n=s===l;break;case"<":n=s<l;break;case">":n=l<s;break;case"<=":n=s<=l;break;case">=":n=l<=s;break;case"!=":n=s!==l;break;case"in":n=0<=l.toString().split(",").indexOf(s.toString());break;case"search":n=r.isMatch(l,s);break;case"regexp":n=new RegExp(t.toString()).test(e?e.toString():"")}return n},u.isDuration=function(e){return _.get(e,"_kdbType")&&0<=["1216","1217","1218","1219"].indexOf(e._kdbType)},u.getFormatter=function(a,o,r,n){return"Number"===a||"Formatted Number"===a||"Smart Number"===a||"Datetime"===a||"Currency"===a||"SmartCurrency"===a?function(e){var t,i=e;if(null==(e="Smart Number"!==a&&"Formatted Number"!==a||_.isNumber(e)?e:_.isNumber(parseFloat(e))?parseFloat(e):e))return"";if("Smart Number"===a)i=_.isNumber(e)?B.smartFormatNumber(e,o):_.escape(e);else{if("Datetime"===a)return t=e,g.isMoment(e)||g.isDuration(e)?(u.isDuration(e)?B.convertValueToMoment(e.valueOf()):e).format(n):B.isKDBTemporal(e)?B.convertKDBTemporalToMoment(e).format(n):("number"==typeof e&&(t=new Date(e)),B.convertDateStringValueToMoment(t.toString()).format(n));i="Formatted Number"===a&&e.toFixed?_.isNaN(e)?"":B.formatNumber(e,o):e.toFixed?e.toFixed(o):_.escape(i)}if(r&&0<=i.toString().indexOf(".")){for(;"0"===i[i.length-1];)i=i.slice(0,-1);"."===i[i.length-1]&&(i=i.slice(0,-1))}return i}:"Boolean"===a?function(e){return _.escape(e)}:function(e){return g.isMoment(e)||g.isDuration(e)?e.format("General"===a?void 0:n,void 0):_.escape(e)}},u.pump=function(i){if(null==i)return i;if(!_.isObject(i))return i;var e=Object.getPrototypeOf(i);if(_.isObject(i)&&e!==Object.prototype&&e!==Array.prototype)return i;if(e===Array.prototype&&_.isArray(i))return i.map(u.pump);var a=/^(\d+)((?:\.\w+)+)$/;if(Object.keys(i).every(function(e){return a.test(e)}))return Object.keys(i).map(function(e){var t=a.exec(e);return _.isNil(t)?{index:0,tail:void 0,value:void 0}:{index:Number(t[1]),tail:t[2].substring(1),value:i[e]}}).reduce(function(e,t){var i={},a=void 0===t.index?0:t.index;return i[a]={},i[a][t.tail]=t.value,$.extend(!0,e,u.pump(i))},[]);var o={greedy:/^(\w+)((?:\.\w+)*)$/,nonGreedy:/^(\w+)((?:\.\w+)+)$/};return Object.keys(i).some(function(e){return o.nonGreedy.test(e)})?Object.keys(i).map(function(e){var t=o.greedy.exec(e);return{head:_.isNil(t)?null:t[1],tail:_.isNil(t)||""===t[2]?null:t[2].substring(1),value:i[e]}}).reduce(function(e,t){var i={},a=null!==t.tail,o=_.isNil(t.head)?0:t.head,r=_.isNil(t.tail)?0:t.tail;return a?(i[o]={},i[o][r]=t.value):i[o]=t.value,$.extend(!0,e,u.pump(i))},{}):_.mapValues(i,u.pump)},u.replaceViewStatesWithValue=function(e,t,i){return u.replaceViewStates(e,t,function(e,t,i,a){return a.value!==i&&console.warn("viewModel value has changed"),a.value},i)},u.replaceViewStatesWithModel=function(e,t,a){return u.replaceViewStates(e,t,function(e,t,i){if(i instanceof r.Model&&i.get("_viewType"))return i;e=a.getProperty(e)[t];return e.get("value")!==i&&e.set("value",i),e},a)},u.alpha=function(e,t){var i=this.hex2RGB(e);return i?"rgba("+i[0]+","+i[1]+","+i[2]+","+t/100+")":new Color(e).alpha(t/100).rgbaString()},u.colorFactory=function(e,t,i){void 0===t&&(t="#0061FF"),void 0===i&&(i=80);var a={};return a[e+"Color"]={title:e.replace("Point","").replace("Hover","Hover ").replace("Border","Border ").replace("Background","Background ")+"Color",type:"gradient",default:t,options:{gradient:!1}},a[e+"Opacity"]={title:e.replace("Point","").replace("Hover","Hover ").replace("Border","Border ").replace("Background","Background ")+"Opacity",default:i,minimum:0,maximum:100,type:"number",step:1,format:"range"},a},u.backgroundFactory=function(e){return u.colorFactory(e+"Background")},u.borderFactory=function(e){var t={};return t[e+"BorderWidth"]={title:e.replace("Point","").replace("Hover","Hover ")+" Border Width",type:"number",format:"range",default:2.01,minimum:.01,maximum:10.01},$.extend(!0,{},u.colorFactory(e+"Border"),t)},u.radiusFactory=function(e){var t={};return t[e+"Radius"]={title:e.replace("Point","").replace("Hover","Hover ").replace("Hit","Hit ")+"Radius",type:"number",format:"range",default:0,minimum:0,maximum:10},t},u.typeFactory=function(e){return{_Type:{type:"string",default:e,options:{hidden:!0}}}},u.replaceViewStates=function(i,e,l,d){var c;return c=function(e,t){return function i(e,t,a){a=a?a+".":"";var o,r,n=d.getPropertyMeta(a+(t+="")),s=e&&e.has&&e.has("_dataSource")&&e.has("_dataType"),s=(_.isArray(e)||_.isObject(e))&&!s;return n&&"data"===n.type?e:n&&"viewstate"===n.type?(o=(r=(a+t).split(".")).pop(),r=r.join("."),l(r,void 0===o?"":o,e,n)):s?(a+=t,c=function(e,t){return i(e,t,a)},(_.isArray(e)?_.map:_.mapValues)(e,c)):e}(e,t,i||"")},(_.isArray(e)?_.map:_.mapValues)(e,c)};var x=u;function u(){}f.registerHelper("ico",function(e){return new f.SafeString('<i class="fa '+e.hash.icon+'" style="color:'+e.hash.color+';"></i>')}),f.registerHelper("groupByLayer",function(e){var a=[],t=_.groupBy(this.points,function(e){return e.layerName}),o=_.groupBy(this.legendItems,function(e){return e.text});return _.forEach(t,function(e,t){var i=e.map(function(e){var t=o[e.layerName],t=t&&t[0]&&t[0].pointStyle?t[0].pointStyle:"circle";return{borderColor:e.colors.borderColor,cols:e.cols,color:e.colors.backgroundColor,data:e.layerData,dataFormatted:e.layerDataFormatted,isLayerEnabled:e.isLayerEnabled,shape:t}});a.push({colors:e[0].colors,isLayerEnabled:e[0].isLayerEnabled,layerCount:_.sumBy(i,function(e){return _.isNil(e.data)||""===e.data?0:1}),layerUniqData:_.uniq(_.compact(_.map(i,function(e){return e.data}))).join(),layerName:t,layerPoints:i,svg:e[0].svg})}),new f.SafeString(e.fn({layers:a}))}),f.registerHelper("groupByLayerX",function(r,e){var t=[],i=_.uniq(_.flatMap(this.points,function(e){return e.cols[r].toString()})),n=_.groupBy(this.points,function(e){return e.layerName}),s=_.groupBy(this.legendItems,function(e){return e.text});return _.forEach(i,function(a){var o=[];_.forEach(n,function(e,t){var i=_.filter(e,function(e){return e.cols[r].toString()===a.toString()}).map(function(e){var t=s[e.layerName],t=t&&t[0]&&t[0].pointStyle?t[0].pointStyle:"circle";return{data:e.layerData,dataFormatted:e.layerDataFormatted,cols:e.cols,color:e.colors.backgroundColor,borderColor:e.colors.borderColor,shape:t}});o.push({colors:e[0].colors,grouping:a,layerName:t,layerPoints:i,legends:s,isLayerEnabled:e[0].isLayerEnabled})}),t.push({grouping:a,data:o})}),new f.SafeString(e.fn({layers:t}))}),f.registerHelper("filterLayers",function(e){var t=e.hash.names.split(","),i=_.filter(this.points,function(e){return _.includes(t,e.layerName)});return new f.SafeString(e.fn({points:i}))});ie=r.DeepModel,e(h,ie),h.prototype.beforeInit=function(e){var t=this;this.chartInstance=e,this.node=e.canvas,this.node.addEventListener("touchenter",function(e){t.pendingEvent=e,window.requestAnimationFrame(t.nextFrame.bind(t))}),this.node.addEventListener("mousedown",this.mouseDown.bind(this)),this.node.addEventListener("mouseup",this.mouseUp.bind(this)),this.node.addEventListener("mousemove",function(e){t.pendingEvent=e,window.requestAnimationFrame(t.nextFrame.bind(t))}),this.node.addEventListener("mouseout",this.mouseOut.bind(this)),this.node.addEventListener("dblclick",this.dblClick.bind(this))},h.prototype.afterRender=function(){this.triggerSort&&(this.sortDataset(),this.triggerSort=!1)},h.prototype.afterUpdate=function(){this.triggerSort=!0},h.prototype.destroy=function(){this.node&&(this.node.removeEventListener("touchenter",this.mouseMove.bind(this)),this.node.removeEventListener("mousedown",this.mouseDown.bind(this)),this.node.removeEventListener("mouseup",this.mouseUp.bind(this)),this.node.removeEventListener("mousemove",this.mouseMove.bind(this)),this.node.removeEventListener("mouseout",this.mouseOut.bind(this)),this.node.removeEventListener("dblclick",this.dblClick.bind(this)),delete this.chartInstance,delete this.node)},h.prototype.setLayers=function(e){this.layers=e},h.prototype.onSettingsChange=function(e){this.crosshairArea&&this.selectedCrosshairArea&&(e.hasOwnProperty("CrosshairsEnabled")&&!e.CrosshairsEnabled&&(this.hideHover(),this.hideSelected()),e.hasOwnProperty("CrosshairsColor")&&this.setColor(),e.hasOwnProperty("TooltipBGOpacity")&&this.tooltip&&this.tooltip.updateCSS({"background-color":"rgba(0, 0, 0,"+this.get("TooltipBGOpacity")/100+")"}),this.setColor(),e.hasOwnProperty("TooltipFontSize")&&this.tooltip&&this.tooltip.updateCSS({"font-size":this.get("TooltipFontSize")}))},h.prototype.updateSelectedFromViewState=function(e){this.sortedData&&this.sortedData.length&&((e=this.findClosestElementFromValue(e.Selected))&&this.get("CrosshairsEnabled")?this.isTransposed?(this.selectedY=e.yLabel,this.drawCrosshair(this.selectedCrosshairArea,e.yPixel)):(this.selectedX=e.xLabel,this.drawCrosshair(this.selectedCrosshairArea,e.xPixel)):this.hideSelected())},h.prototype.updateHoverFromViewState=function(e){if(!e.Hover)return this.hideTooltip(),void this.hideHover();var t,i;this.sortedData&&this.sortedData.length&&!this.preventViewStateUpdate?(e=this.findClosestElementFromValue(e.Hover),t=this.isTransposed?"yPixel":"xPixel",e?(this.get("CrosshairsEnabled")&&this.drawCrosshair(this.crosshairArea,_.get(e,t)),this.get("TooltipsEnabled")&&(i={offsetY:(this.chartInstance.chartArea.top+this.chartInstance.chartArea.bottom)/2},this.renderTooltip(_.get(e,t),i,e))):this.hideHover()):this.preventViewStateUpdate=!1},h.prototype.removePreviousChartInstance=function(){this.chartInstance&&delete this.chartInstance},h.prototype.nextFrame=function(){this.pendingEvent&&(this.mouseMove(this.pendingEvent),delete this.pendingEvent)},h.prototype.mouseDown=function(e){this.startDrag=e.offsetX},h.prototype.mouseMove=function(e){this.validateMouseEvent(e)?this.updateHover(e):(this.hideHover(),this.updateViewState("Basics.Hover",""),this.hideTooltip())},h.prototype.mouseUp=function(e){Math.abs(e.offsetX-this.startDrag)<2&&this.validateMouseEvent(e)&&this.updateSelected(e)},h.prototype.mouseOut=function(){this.hideHover(),this.updateViewState("Basics.Hover",""),this.hideTooltip()},h.prototype.dblClick=function(e){this.validateMouseEvent(e)&&this.clearSelected()},h.prototype.clearSelected=function(){this.selectedX=null,this.selectedY=null,this.hideSelected()},h.prototype.compare=function(e,t){if(!e.kdbType){if("number"==typeof e||"number"==typeof t)try{return parseFloat(e)-parseFloat(t)}catch(e){}return"string"==typeof e&&e===t?0:"number"==typeof e?e-parseFloat(t):g.isMoment(B.convertKDBTemporalToMoment(e))?this.getMomentDiff(B.convertKDBTemporalToMoment(e),t):"object"==typeof e?g(e.toString()).diff(t):void 0}switch(e.kdbType()){case"1217":case"1219":return e.asMilliseconds()-g(t).valueOf();case"1212":case"1213":case"1214":return this.getMomentDiff(B.convertKDBTemporalToMoment(e),B.convertKDBTemporalToMoment(t));case"1215":case"1216":case"1218":return this.getMomentDiff(B.convertKDBTemporalToMoment(e),t)}},h.prototype.getMomentDiff=function(e,t){return g.isDuration(e)&&g.isDuration(t)?e.subtract(t).asMilliseconds():g.isMoment(e)&&g.isMoment(t)?e.diff(t):0},h.prototype.drawCrosshair=function(e,t){var i=this.chartInstance.chartArea,a=i.left,o=i.right,r=i.bottom,i=i.top;a<t&&t<o?(e[0].classList.add("active"),this.isTransposed?e.css({height:"1px",left:a+"px",top:t+"px",width:o-a+"px"}):e.css({height:r-i+"px",left:t+"px",top:i+"px",width:"1px"})):e[0].classList.remove("active")},h.prototype.findClosestElementFromEvent=function(e){if(_.get(this.chartInstance,"data.datasets")){var t=_.map(this.chartInstance._getSortedDatasetMetas(!0),function(e){return e.index}),i=_.filter(this.sortedData,function(e){return 0<=_.indexOf(t,e.datasetIndex)});if(i&&0!==i.length){for(var a=0,o=i.length-1,r=this.isTransposed?this.getOffsetY(e):this.getOffsetX(e);1<o-a;){var n=Math.round((o+a)/2),s=this.isTransposed?i[n].yPixel:i[n].xPixel;if(r<s)o=n;else{if(!(s<r))return i[n];a=n}}var e=this.isTransposed?i[o].yPixel:i[o].xPixel,l=this.isTransposed?i[a].yPixel:i[a].xPixel;return Math.abs(e-r)<Math.abs(l-r)?i[o]:i[a]}}},h.prototype.findClosestElementFromValue=function(e){var t,i=_.get(this.chartInstance,"data.datasets");if(!i)return null;var a=_.map(_.filter(i,function(e){return!e.hidden}),function(e){return i.length-1-e.index}),o=_.filter(this.sortedData,function(e){return 0<=_.indexOf(a,e.datasetIndex)});if(!o)return null;var r=this.isTransposed?"yLabel":"xLabel";if("string"==typeof e&&"string"==typeof _.get(o[0],r)){for(var n=0;n<o.length;n++){var s=_.get(o[n],r);if(s===e||s+""==e+"")return o[n]}return null}if(!o||null===o[0])return null;var l=this.compare(_.get(o[0],r),e),d=this.compare(_.get(o[o.length-1],r),e);if(void 0===l||void 0===d||isNaN(l)||0<l||d<0)return null;var c,u=0,h=o.length,l=_.get(o[u],r),p=e;for(g.isDuration(l)?p=B.convertValueToDuration(e):g.isMoment(l)&&(p=B.convertValueToMoment(e));1<h-u;){if(c=Math.round((h+u)/2),!(t=this.compare(_.get(o[c],r),p)))return o[c];t<0&&(u=c),0<t&&(h=c)}h=o.length===h?h-1:h,d=this.compare(_.get(o[u],r),p),l=this.compare(_.get(o[h],r),p);return void 0===l||void 0===d||Math.abs(d)<Math.abs(l)?o[u]:o[h]},h.prototype.findSelectedElementFromValue=function(t){var i=this,e=this.generateChartElements();return _.find(e,function(e){i.isTransposed;e=e.xLabel;return e===t||e.toString()===t.toString()})},h.prototype.generateChartElements=function(){for(var o=this,r=[],n=this,e=0;e<this.chartInstance.data.datasets.length;e++)!function(e){var i=n.chartInstance.getDatasetMeta(e).controller,t=n.chartInstance.getDatasetMeta(e).data,a=i.hasOwnProperty("_ruler")&&1<i._ruler.stackCount;n.chartInstance.isDatasetVisible(e)&&t.forEach(function(e,t){return r.push({datasetIndex:e._datasetIndex,index:e._index,xLabel:o.chartInstance.data.datasets[e._datasetIndex].data[e._index].x||o.chartInstance.data.labels[e._index],xPixel:a?i._ruler.pixels[t]:e.getCenterPoint().x,yLabel:o.chartInstance.data.datasets[e._datasetIndex].data[e._index].y,yPixel:e.getCenterPoint().y})})}(e);return r},h.prototype.getOffsetX=function(e){var t,i=e.offsetX;return i&&0!==i||(t=e.target)&&(t=t.getBoundingClientRect(),i=e.clientX-t.left),i},h.prototype.getOffsetY=function(e){var t,i=e.offsetY;return i&&0!==i||(t=e.target)&&(t=t.getBoundingClientRect(),i=e.clientY-t.top),i},h.prototype.hideSelected=function(){this.selectedCrosshairArea[0].classList.remove("active")},h.prototype.hideHover=function(){this.crosshairArea[0].classList.remove("active")},h.prototype.isReady=function(){return!(!this.sortedData||!this.sortedData.length)||(this.sortDataset(),!(!this.sortedData||!this.sortedData.length))},h.prototype.setColor=function(){"#f8f8f8"!==this.get("CrosshairsColor").toLowerCase()&&"#ffffff"!==this.get("CrosshairsColor").toLowerCase()&&(this.crosshairArea.css({"background-color":x.alpha(this.get("CrosshairsColor"),60),color:x.alpha(this.get("CrosshairsColor"),60)}),this.selectedCrosshairArea.css({"background-color":x.alpha(this.get("CrosshairsColor"),90),color:x.alpha(this.get("CrosshairsColor"),60)}))},h.prototype.sortDataset=function(){try{var e=this.generateChartElements();this.sortedData=_.sortBy(e,function(e){return e&&!isNaN(e.xPixel)?e.xPixel:0}),this.updateSelectedAfterRender()}catch(e){this.warnings=e.toString()}},h.prototype.updateHover=function(e){var t,i;this.isReady()&&(this.get("CrosshairsEnabled")||this.get("TooltipsEnabled"))&&(t=this.findClosestElementFromEvent(e),i=this.api.getProperty("Zoom.ZoomToIndex"),_.isNil(t)||(i=this.isTransposed?i?t.yPixel:this.getOffsetY(e):i?t.xPixel:this.getOffsetX(e),this.get("TooltipsEnabled")&&this.renderTooltip(i,e,t),this.get("CrosshairsEnabled")&&this.drawCrosshair(this.crosshairArea,i),(this.get("CrosshairsEnabled")||this.get("TooltipsEnabled"))&&(this.preventViewStateUpdate=!0,this.updateViewState("Basics.Hover",t))))},h.prototype.updateSelected=function(e){var t;this.isReady()&&this.get("CrosshairsEnabled")&&(e=this.findClosestElementFromEvent(e),_.isNil(e)||(t=this.isTransposed?e.yPixel:e.xPixel,this.drawCrosshair(this.selectedCrosshairArea,t),this.isTransposed?this.selectedY=e.yLabel:this.selectedX=e.xLabel,this.updateViewState("Basics.Selected",e)))},h.prototype.updateSelectedAfterRender=function(){var e,t,i,a=this.api.getProperty("Basics.Selected"),o=this.api.getProperty("XAxes.0._Hidden._Type");"category"===o?a&&(this.isTransposed?this.selectedY=a:this.selectedX=a):"time"===o?(e=B.convertDateStringValueToMoment(a),g.isMoment(e)&&(this.isTransposed?this.selectedY=e:this.selectedX=e)):"linear"!==o&&"logarithmic"!==o||(e=parseFloat(a),_.isNumber(e)&&(this.isTransposed?this.selectedY=e:this.selectedX=e)),this.selectedX?(t=this.findSelectedElementFromValue(this.selectedX))&&this.get("CrosshairsEnabled")?(i=t.xPixel,this.drawCrosshair(this.selectedCrosshairArea,i)):this.hideSelected():this.selectedY&&((t=this.findSelectedElementFromValue(this.selectedY))&&this.get("CrosshairsEnabled")?(i=t.yPixel,this.drawCrosshair(this.selectedCrosshairArea,i)):this.hideSelected())},h.prototype.updateViewState=function(e,t){this.set(e,t)},h.prototype.validateMouseEvent=function(e){var t=this.chartInstance.chartArea,i=t.left,a=t.right,o=t.top,t=t.bottom,r=this.getOffsetX(e),e=this.getOffsetY(e);return i<=r+.5&&r-.5<=a&&o<=e&&e<=t},h.prototype.adjustTooltipPosition=function(e,t){var i,a=this.chartInstance.chartArea,t=this.getOffsetY(t);this.tooltip&&(e=this.get("EdgeAlign")?(i=e-a.left<(a.right-a.left)/2?a.right-10*Math.ceil(this.tooltip.el.clientWidth/10)-this.get("Offset"):a.left+this.get("Offset"),a.top+5):(i=e-a.left<(a.right-a.left)/2?e+this.get("Offset"):e-this.tooltip.el.clientWidth-this.get("Offset"),t-this.tooltip.el.clientHeight/2<a.top?a.top:t+this.tooltip.el.clientHeight/2>a.bottom?a.bottom-this.tooltip.el.clientHeight:t-this.tooltip.el.clientHeight/2),this.tooltip.updatePosition({left:i,top:e}))},h.prototype.displayFormat=function(e,t,i){var a,o,r=t,n=e.options.time;if(n)return a=n.displayFormats,o=B.isKDBTemporal(t)?B.convertKDBTemporalToMoment(t):t,g.isMoment(o)?(o="1214"===_.get(t,"_kdbType")?g(t):g(t).tz(B.timezone),n.tooltipFormat?o.format(n.tooltipFormat):o.format(a[e._unit])):t.format?(0<=["1216","1217","1218","1219"].indexOf(_.get(t,"_kdbType"))?B.convertValueToDuration(t.valueOf()):B.convertValueToMoment(t.valueOf())).format(a[e._unit]):void 0;for(var s=this.xAxes.models.concat(this.yAxes.models),l=0;l<s.length;l++){var d=s[l];if(d.get("_Hidden._Label")===i)return x.getFormatter(d.get("Labels.Format"),d.get("Labels.Precision"),d.get("Labels.HideTrailingZeroes"),d.get("Labels.DateFormat"))(t)}return r},h.prototype.findTooltipItems=function(e,t,i){"{breakdownId}"===i&&(i=t.breakdownColumns[t.getDepth()]);var a,o=[];if(0===t.getData().length)return[];var r=typeof e;switch(r=_.isArray(e)?"string":r){case"object":for(var n=e.toKdbObject(),s=t.meta[i]?t.meta[i].kdbType:t.getColumnType(i),l=B.getComparator(s,function(e){return e}),d=0;d<t.getData().length;d++)(a=t.getData().at(d).get(i)).i=Math.floor(a.i),0===l(n,a)&&o.push(t.getData().at(d));return o;case"string":for(d=0;d<t.getData().length;d++)t.getData().at(d).get(i)===e&&o.push(t.getData().at(d));return o;case"number":for(d=0;d<t.getData().length;d++)0==Number(e)-Number(t.getData().at(d).get(i))&&o.push(t.getData().at(d));return o}return[]},h.prototype.hideTooltip=function(){this.api.removeTooltip(),delete this.tooltip},h.prototype.populatePointTooltip=function(e,t,i){var a=this.chartInstance,o=(t.x||(t.y=t.offsetY,t.x=t.offsetX),_.get(E,"Interaction.modes.point"));if(void 0!==t.x){var r=o(a,t);if(r.length){for(var n=r[0],o=this.layers.find(function(e){return e.get("_Hidden._LayerId")===a.data.datasets[n._datasetIndex].layerId}),s=this.isTransposed?"y":"x",s=this.displayFormat(a.scales[o.get("Axes.XAxisID")],a.data.datasets[n._datasetIndex].data[n._index][s]||a.data.labels[n._index],o.get("Axes.XAxisID")),l=void 0,d=void 0,c=void 0,u=this,h=0;h<r.length;h++)!function(e){var t=r[e];c=a.data.datasets[t._datasetIndex].data[t._index],l=u.layers.find(function(e){return e.get("_Hidden._LayerId")===a.data.datasets[t._datasetIndex].layerId}),d=u.dataSources[l.get("Basics.Data.cid")],c=d.getData().at(t._index),u.pushTooltipItem(l,d,c,t._index,t._datasetIndex)}(h);this.pushToTemplate({fontSize:"font-size:"+this.get("TooltipFontSize")+"px",points:_.reverse(this.tooltipItems),xLabel:s})}else this.get("PreferIntersect")?this.populateTooltip(e,t,i):this.hideTooltip()}},h.prototype.populateTooltip=function(e,t,l){for(var i=this.chartInstance,d=Object.keys(this.dataSources),a=this.layers.find(function(e){return e.get("_Hidden._LayerId")===i.data.datasets[l.datasetIndex].layerId}),o=i.scales[a.get("Axes.XAxisID")],t=this.getOffsetX(t),t=this.api.getProperty("Zoom.ZoomToIndex")?l.xLabel:o.getValueForPixel(t),o=this.displayFormat(o,t,a.get("Axes.XAxisID")),c=this,r=0;r<d.length;r++){var n=function(t){var e=c.dataSources[d[t]];if(!e.getData())return c.hideTooltip(),{value:void 0};var i=c.layers.models.filter(function(e){return e.get("Basics.Data").cid===d[t]}),a=c.findTooltipItems(l.xLabel,e,i[0].get("Axes.XAxisData"));if(a&&a.length)for(var o=0;o<a.length;o++)for(var r=a[o],n=0;n<i.length;n++){var s=i[n];c.pushTooltipItem(s,e,r,l.index)}}(r);if("object"==typeof n)return n.value}this.pushToTemplate({fontSize:"font-size:"+this.get("TooltipFontSize")+"px",points:this.tooltipItems,xLabel:o})},h.prototype.pushTooltipItem=function(e,t,i,a,o){var r,n=this.chartInstance,s=!1,l=!1,d=[],c="",u=e.get("Basics.BackgroundColor"),h=e.get("Basics.BorderColor"),p=e.get("Basics.BackgroundOpacity"),g=e.get("Basics.BorderOpacity"),m="_rowIndex"!==t.getPrimaryKey()?t.getData().indexOf(i):_.isNil(i.get("_rowIndex"))?i.id:i.get("_rowIndex"),f={colors:{backgroundColor:"",borderColor:""},cols:i.attributes,isLayerEnabled:e.get("Basics.Enabled"),layerData:"",layerDataFormatted:"",layerName:"",svg:""};switch(e.get("_Hidden._Type")){case"Candlestick":D=i.attributes[e.get("Axes.Low")]+" (Low) ",D=(D=(D+=i.attributes[e.get("Axes.High")]+" (High) ")+(i.attributes[e.get("Axes.Close")]+" (Close) "))+(i.attributes[e.get("Axes.Open")]+" (Open) "),f.layerName=e.get("Basics.Name"),f.layerData=D,f.layerDataFormatted=D,f.colors.backgroundColor=e.get("Candlestick.BearColor"),f.colors.borderColor=e.get("Candlestick.BullColor");break;case"Violin":D=i.attributes[e.get("Axes.Coords")],f.layerName=e.get("Basics.Name"),f.layerData=void 0===D?"":D.toString(),f.layerDataFormatted=void 0===D?"":D.toString();break;case"BoxPlot":D=i.attributes[e.get("Axes.Min")]+" (min) ",D=(D=(D=(D+=i.attributes[e.get("Axes.Q1")]+" (Q1) ")+(i.attributes[e.get("Axes.Median")]+" (Median) "))+(i.attributes[e.get("Axes.Q3")]+" (Q3) "))+(i.attributes[e.get("Axes.Max")]+" (Max) "),f.layerName=e.get("Basics.Name"),f.layerData=D,f.layerDataFormatted=D;break;case"Line":case"Bar":case"Bubble":var y=e.get("Axes.YAxisData");if("string"==typeof y){var x=(l=!o&&0!==o)?e.get("Axes.YAxisData"):n.data.datasets[o].colY,b=/\/[gimsuy]*$/,v=void 0,S="",C=(0===y.indexOf("/")?(v=y.substring(1).replace(b,""),S=(b=y.match(b))?b[0].substring(1):""):v="^"+(y=y.replace(/[\-\[\]\/\{\}\(\)\+\?\.\\\^\$\|]/g,"\\$&")).replace(/\*/g,"(.*)")+"$",new RegExp(v,S)),s=!!(1<(d=t.getColumnNames().filter(function(e){return e.match(C)})).length||d[0]&&d[0]!==y);if(-1===d.indexOf(x)&&!s)return}if(s&&l){for(var L=0;L<d.length;L++){var T=d[L],D=this.displayFormat(n.scales[e.get("Axes.YAxisID")],i.attributes[T],e.get("Axes.YAxisID")),c=i.attributes[T+"_Formatted"]?this.displayFormat(n.scales[e.get("Axes.YAxisID")],i.attributes[T+"_Formatted"],e.get("Axes.YAxisID")):D,M=e.getPaletteColor(L),k=e.computeColor(T,M,p,"RuleColor",m),F=e.computeColor(T,h,g,"RuleBorderColor",m);this.tooltipItems.push({colors:{backgroundColor:k,borderColor:F},cols:i.attributes,isLayerEnabled:e.get("Basics.Enabled"),layerData:D,layerDataFormatted:c,layerName:T,svg:this.renderSVG(e,k,F)})}return}"number"==typeof y?D=y.toString():(D=this.displayFormat(n.scales[e.get("Axes.YAxisID")],i.attributes[x],e.get("Axes.YAxisID")),c=i.attributes[x+"_Formatted"]?this.displayFormat(n.scales[e.get("Axes.YAxisID")],i.attributes[x+"_Formatted"],e.get("Axes.YAxisID")):D),f.layerName=s?x:e.get("Basics.Name"),f.layerData=void 0===D?"":D.toString(),f.layerDataFormatted=void 0===c?"":c.toString()}"Candlestick"!==e.get("_Hidden._Type")&&(F=s?(r=-1<d.indexOf(x)?d.indexOf(x):o,M=e.getPaletteColor(void 0===r?0:r),k=e.computeColor(x,M,p,"RuleColor",m),e.computeColor(x,M,g,"RuleBorderColor",m)):(k=e.computeColor("",u,p,"RuleColor",m),e.computeColor("",h,g,"RuleBorderColor",m)),f.colors.backgroundColor=k,f.colors.borderColor=F),f.svg=this.renderSVG(e,f.colors.backgroundColor,f.colors.borderColor),this.tooltipItems.push(f)},h.prototype.pushToTemplate=function(e){e.legendItems=this.chartInstance.legend.legendItems,this.tooltip=this.api.setTooltip({text:this.get("useCustomTooltip")?this.get("customTooltip"):M.getDefaultJSON().Overlay.customTooltip,data:e,anchorEl:this.chartInstance.canvas}).updateCSS({backgroundColor:"rgba(0, 0, 0,"+this.get("TooltipBGOpacity")/100+")",fontSize:this.get("TooltipFontSize")})},h.prototype.renderSVG=function(e,t,i){var a,o=this.get("TooltipFontSize"),r="<svg height="+o+" width="+o+' viewbox="0 0 12 12">',n=e.get("Basics.BackgroundOpacity"),s=e.get("Basics.BorderWidth");switch(e.get("_Hidden._Type")){case"Bubble":a=e.get("Bubbles.Icons")?e.get("Bubbles.Icons"):e.get("Bubbles.PointStyle");break;case"Line":a=e.get("Points.PointStyle");break;default:a="circle"}switch(a){case"circle":r=r+'<circle cx="6" cy="6" r="5" stroke="" + stroke + "" stroke-width='+Math.min(1,s)+" fill="+t+" />";break;case"cross":r=r+"<path fill="+t+"  stroke="+i+" stroke-width="+Math.min(1,s)+'  stroke-linecap="butt" stroke-linejoin="miter" opacity='+n+'  d="M 5 0 L 5 5 L 0 5 L 0 7 L 5 7 L 5 12 L 7 12 L 7 7 L 12 7 L 12 5 L 7 5 L 7 0 L 5 0 L 5 0 Z"></path>';break;case"crossRot":r=r+"<path fill="+t+" stroke="+i+" stroke-width="+Math.min(1,s)+' stroke-linecap="butt" stroke-linejoin="miter" opacity='+n+' d="M 3 0 L 0 3 L 3 6 L 0 9 L 3 12 L 6 9 L 9 12 L 12 9 L 9 6 L 12 3 L 9 0L 6 3 L 3 0 Z"></path>';break;case"triangle":r=r+"<path fill="+t+" stroke="+i+" stroke-width="+Math.min(1,s)+'  stroke-linecap="butt" stroke-linejoin="miter" opacity='+n+' d="M 0 12 L 6 0 L 12 12 L 0 12 Z" ></path>';break;case"rectRot":r=r+"<path fill="+t+" stroke="+i+" stroke-width="+Math.min(1,s)+' stroke-linecap="butt" stroke-linejoin="miter" opacity='+n+' d="M 6 0 L 12 6 L 6 12 L 0 6 L 6 0 Z"></path>';break;case"downTriangle":r=r+"<path fill="+t+" stroke="+i+" stroke-width="+Math.min(1,s)+' stroke-linecap="butt" stroke-linejoin="miter" opacity='+n+' d="M 0 0 L 12 0 L 6 12 L 0 0 Z"></path>';break;default:r=r+"<rect fill="+t+" stroke="+i+" stroke-width="+Math.min(1,s)+' stroke-linecap="butt" stroke-linejoin="miter" opacity='+n+' height="12" width="12"></rect>'}return r+="</svg>",0<=a.indexOf("fa-")?r='<i style="color:'+t+'" class="fa '+a+'"></i>':0<=a.indexOf("mi-")&&(r='<i style="color:'+t+'" class="mi '+a+'"></i>'),r},h.prototype.renderTooltip=function(e,t,i){this.tooltipItems=[],this.get("TooltipsIntersect")||this.get("PreferIntersect")?this.populatePointTooltip(e,t,i):this.populateTooltip(e,t,i),this.adjustTooltipPosition(e,t)};var ie,ae=h;function h(e){var t=e.dataSources,i=e.layers,a=e.yAxes,o=e.xAxes,r=e.el,e=e.api,n=ie.call(this)||this;return n.startDrag=0,n.isTransposed=!1,n.triggerSort=!1,n.tooltipItems=[],n.warnings="",n.preventViewStateUpdate=!1,n.dataSources=t,n.layers=i,n.api=e,n.yAxes=a,n.xAxes=o,n.crosshairArea=r.find(".crosshair"),n.selectedCrosshairArea=r.find(".crosshair-selected"),n.mouseDown=n.mouseDown.bind(n),n.mouseUp=n.mouseUp.bind(n),n.mouseMove=n.mouseMove.bind(n),n.mouseOut=n.mouseOut.bind(n),n.dblClick=n.dblClick.bind(n),n.nextFrame=n.nextFrame.bind(n),n}oe=r.DeepModel,e(p,oe),p.prototype.beforeInit=function(e){var t=this;this.chartInstance=e,this.node=e.canvas,this.node&&(this.node.addEventListener("touchmove",function(e){t.mouseMove(t.getTouchEvent(e.target,e.targetTouches[0]))}),this.node.addEventListener("touchstart",function(e){t.mouseDown(t.getTouchEvent(e.target,e.changedTouches[0]))}),this.node.addEventListener("touchend",function(e){t.mouseUp(t.getTouchEvent(e.target,e.changedTouches[0]))}),this.node.addEventListener("mousemove",this.mouseMove.bind(this)),this.node.addEventListener("mousedown",this.mouseDown.bind(this)),this.node.addEventListener("mouseup",this.mouseUp.bind(this)),this.node.addEventListener("mouseout",this.mouseOut.bind(this)),this.node.addEventListener("wheel",this.mouseWheel.bind(this)))},p.prototype.destroy=function(){var t=this;this.node&&(this.node.removeEventListener("touchmove",function(e){t.mouseMove(t.getTouchEvent(e.target,e.targetTouches[0]))}),this.node.removeEventListener("touchstart",this.mouseDown.bind(this)),this.node.removeEventListener("touchend",function(e){t.mouseUp(t.getTouchEvent(e.target,e.changedTouches[0]))}),this.node.removeEventListener("mousemove",this.mouseMove.bind(this)),this.node.removeEventListener("mousedown",this.mouseDown.bind(this)),this.node.removeEventListener("mouseup",this.mouseUp.bind(this)),this.node.removeEventListener("mouseout",this.mouseOut.bind(this)),this.node.removeEventListener("wheel",this.mouseWheel.bind(this)),delete this.chartInstance,delete this.node)},p.prototype.beforeDatasetsDraw=function(e){var t=e.chartArea,e=e.ctx,i=t.left,a=t.top,o=t.right,t=t.bottom;e.save(),e.beginPath(),e.rect(i,a,o-i,t-a),e.clip()},p.prototype.afterDatasetsDraw=function(e){e.ctx.restore()},p.prototype.afterRender=function(e){e.data.datasets.length&&this.storeDefault()},p.prototype.setDistribution=function(e){this.distribution=e},p.prototype.getZoomSettings=function(){return{drag:!0,enabled:this.enabled(this.chartInstance,"dragZoom"),mode:"x",scaleAxes:"x"}},p.prototype.storeDefault=function(){!this.defaultZoom&&this.chartInstance&&(this.defaultZoom=this.fetchZoomObj(this.chartInstance))},p.prototype.updateDebouncer=function(e){var i=this;e.ViewstateUpdateDelay&&(this.debounceViewState=_.debounce(function(e,t){i.updateViewState(e,t)},1e3*this.get("ViewstateUpdateDelay")))},p.prototype.initalizeListeners=function(){var t=this;this.listenTo(this,"change:Min change:Max",function(e){void 0!==e.get("Min")&&void 0!==e.get("Max")&&t.chartInstance&&t.updateMinMaxFromViewstate()})},p.prototype.resetZoom=function(){this.isReset=!0,this.zoomObj=void 0;var e,t,i,a=this.get("DefaultMin"),o=this.get("DefaultMax");void 0!==a&&""!==a&&void 0!==o&&""!==o||(e=_.get(this.chartInstance,"config.crosshairModel.sortedData"))&&(t=_.get(this.defaultZoom,"min")?_.get(this.defaultZoom,"min"):null,i=_.get(this.defaultZoom,"max")?_.get(this.defaultZoom,"max"):null,a=this.get("ResetViewStateOnly")?t:e[0].xLabel,o=this.get("ResetViewStateOnly")?i:e[e.length-1].xLabel),this.resetYaxisNice(),this.updateMinMax(this.chartInstance,a,o),this.updateViewState(this.chartInstance)},p.prototype.getTouchEvent=function(e,t){var i=e.getBoundingClientRect();return{offsetX:t.pageX-i.left,offsetY:t.pageY-i.top,target:e,targetTouches:t,type:"touch",xLabel:0}},p.prototype.enabled=function(e,t){if(!e.canvas)return!1;e=_.get(e,"canvas.parentElement.parentElement");if(e){var i=e.getElementsByClassName("active-mouse")[0];switch(t){case"scrollZoom":return this.get("ScrollZoom");case"pan":return this.get("DragPan")&&("none"===i.style.display||i.classList.contains("hidden1")||i.classList.contains("hidden")||i.classList.contains("active"));case"dragZoom":return this.get("DragZoom")&&!this.isTransposed&&("none"===i.style.display||i.classList.contains("hidden1")||i.classList.contains("hidden")||!i.classList.contains("active"))}}return!1},p.prototype.setRoot=function(e,t){var i,a,o;e&&(i=_.get(e,"scales"),a=_.get(e,"config.crosshairModel.selectedCrosshairArea"),i&&this.eventIsInChartArea(e,t)&&(e=i[this.activeAxis].options.type,t=this.snapEventToData(t),o=this.isTransposed?t.offsetY:t.offsetX,this.root=_.has(t,"xLabel")&&"category"!==e?t.xLabel:i[this.activeAxis].getValueForPixel(o),this.rootEvent=t,this.crosshairRoot=parseFloat(a.css("left"))))},p.prototype.singleClick=function(e){this.chartInstance.config.crosshairModel.sortedData.length&&this.setRoot(this.chartInstance,e)},p.prototype.dblClick=function(){this.resetZoom(),this.clearDragOverlay(),this.root=void 0,this.rootEvent=void 0},p.prototype.eventIsInChartArea=function(e,t){var e=e.chartArea,i=!!t.type&&"touchstart"===t.type;if(i&&(t.targetTouches&&0<t.targetTouches.length))return(i=this.getTouchEvent(t.target,t.targetTouches[0])).offsetX>e.left&&i.offsetX<e.right&&i.offsetY>e.top&&i.offsetY<e.bottom;return t.offsetX>e.left&&t.offsetX<e.right&&t.offsetY>e.top&&t.offsetY<e.bottom},p.prototype.mouseMove=function(e){(this.root||0===this.root)&&this.rootEvent&&(this.enabled(this.chartInstance,"pan")?(this.isReset=!1,this.chartInstance&&this.pan(this.chartInstance,e)):(e=this.snapEventToData(e),this.enabled(this.chartInstance,"dragZoom")&&3<Math.abs(this.rootEvent.offsetX-e.offsetX)&&this.createDragZoomOverlay(this.chartInstance,e)))},p.prototype.mouseDown=function(e){!!e.type&&"touch"===e.type||e.preventDefault();var t=Date.now();10<t-this.clicks&&t-this.clicks<this.delay?this.dblClick():this.singleClick(e),this.clicks=t},p.prototype.mouseOut=function(){this.root=void 0,this.rootEvent=void 0,this.clearDragOverlay()},p.prototype.mouseUp=function(e){var t=this.chartInstance,i=this.root||0===this.root,a=!1;if(this.enabled(t,"dragZoom")&&i&&this.rootEvent)try{a=!(e.type&&"touch"===e.type&&Math.abs(this.rootEvent.offsetX-e.offsetX)<3)}catch(e){this.warnings=e.toString(),a=!1}a&&this.rootEvent&&(e=this.snapEventToData(e),3<Math.abs(this.rootEvent.offsetX-e.offsetX)&&(this.isReset=!1,this.dragZoom(t,e))),this.clearDragOverlay(),this.root=void 0,this.rootEvent=void 0},p.prototype.mouseWheel=function(e){var t=this.chartInstance;this.enabled(t,"scrollZoom")&&(e.preventDefault(),this.isReset=!1,this.zoom(t,e))},p.prototype.setDuration=function(e,t){e=g.duration(e.valueOf());return t=void 0===t?"1217":t,e._kdbType=_.isNil(e._kdbType)?t:e._kdbType,e},p.prototype.updateMinMax=function(e,i,a,t){var o,r,n=this;e&&(o=!1,(r=_.get(e,"chart.scales"))&&(_.each(r,function(e,t){0<=t.indexOf("XAxis")&&("time"===e.options.type&&(i=void 0!==i?x.isDuration(i)?n.setDuration(i,i._kdbType):B.convertValueToMoment(i):i,a=void 0!==a?x.isDuration(a)?n.setDuration(a,a._kdbType):B.convertValueToMoment(a):a,"1212"!==i._kdbType&&"1215"!==i._kdbType||i.isUTC(!0),"1212"!==a._kdbType&&"1215"!==a._kdbType||i.isUTC(!0),e.options.ticks.min=i,e.options.ticks.max=a),e.options.ticks.min=i,e.options.ticks.max=a,e.min=i,e.max=a,o=!0)}),o&&this.recalculateYLimitsAndUpdate(e,t)))},p.prototype.recalculateYLimitsAndUpdate=function(e,t){var i,a,o=this,r=_.get(e,"scales");r&&this.chartInstance&&("none"!==this.get("YAdjust")&&t&&this.rootEvent?(i=Math.min(t.offsetX,this.rootEvent.offsetX),a=Math.max(t.offsetX,this.rootEvent.offsetX),_.forEach(r,function(e,t){"Y"===t.split("")[0]&&o.getYaxisNice(e,i,a)}),this.chartInstance.update(),this.zoomObj=this.fetchZoomObj(e)):(this.chartInstance.update(),this.activeAxis.indexOf("XAxis")<0&&(this.zoomObj=this.isReset?void 0:this.fetchZoomObj(e))))},p.prototype.resetYaxisNice=function(){var e;this.chartInstance&&(e=_.get(this.chartInstance,"scales"),_.forEach(e,function(e,t){"Y"===t.split("")[0]&&(e.options.ticks.min=void 0,e.options.ticks.max=void 0)}),this.chartInstance.update())},p.prototype.getYaxisNice=function(i,a,o){var r,n,s,e,t,l,d=this.get("YAdjust");this.chartInstance&&(r=_.map(this.chartInstance._getSortedDatasetMetas(!0),function(e){if(!e.hidden)return e.index}),e=i.chart._getSortedDatasetMetas(!0),e=_.map(e[0].data,function(e,t){if(e._view.x>=a&&e._view.x<=o)return t}),n=_.min(e),s=_.max(e),_.isNil(n)||_.isNil(s)||(e=_.flatMap(this.chartInstance.data.datasets,function(e,t){if(e.yAxisID===i.id&&0<=r.indexOf(t))return _.map(_.filter(e.data,function(e,t){return n<=t&&t<=s}),"y")}),l=_.min(e),e=_.max(e),void 0!==l&&void 0!==e&&(t=this.getNice(e-l),l="nice"===d?Math.floor(l/t)*t:l,d="nice"===d?Math.ceil(e/t)*t:e,i.options.ticks.min=l,i.options.ticks.max=d)))},p.prototype.getNice=function(e){var t=Math.floor(Math.log10(e)),e=e/Math.pow(10,t),e=e<=1?1:e<=5?2:e<=10?5:10;return e*Math.pow(10,t)},p.prototype.snapEventToData=function(e){var t,i,a=_.get(this.chartInstance,"config.crosshairModel");return a&&this.get("ZoomToIndex")?(t=(a=a.findClosestElementFromEvent(e)).xPixel,i=a.yPixel,a=a.xLabel,{offsetX:t,offsetY:i,target:e.target,targetTouches:null,type:"touch",xLabel:a}):e},p.prototype.createDragZoomOverlay=function(e,t){var i,e=e.chartArea;this.rootEvent&&(i=Math.min(this.rootEvent.offsetX,t.offsetX),t=Math.max(this.rootEvent.offsetX,t.offsetX),this.zoomArea.css({"background-color":this.get("FillColor"),height:e.bottom-e.top+"px",left:i+"px",opacity:this.get("FillOpacity")/100,position:"absolute",top:e.top+"px",width:t-i+"px"}),(e=_.get(this.chartInstance,"config.crosshairModel.tooltipArea"))&&(t=e.html(),e.html(t)))},p.prototype.clearDragOverlay=function(){this.zoomArea.css({left:"0px",width:"0px"})},p.prototype.dragZoom=function(e,t){var i=_.get(e,"scales");if(i)switch(i[this.activeAxis].options.type){case"linear":case"logarithmic":this.dragZoomLinear(e,t);break;case"time":this.dragZoomTime(e,t);break;case"category":this.dragZoomCategory(e,t)}},p.prototype.dragZoomLinear=function(e,t){var i=_.get(e,"scales");if(i){var a=this.root,i=_.has(t,"xLabel")?t.xLabel:i[this.activeAxis].getValueForPixel(t.offsetX),o=Math.min(a,i),a=Math.max(a,i);if(this.get("ResetViewStateOnly"))return this.updateViewState(e,{min:o,max:a});this.updateMinMax(e,o,a,t),this.updateViewState(e)}},p.prototype.dragZoomTime=function(e,t){var i=_.get(e,"scales");if(i){var a=this.root,i=_.has(t,"xLabel")?t.xLabel:i[this.activeAxis].getValueForPixel(t.offsetX),o=g.isDuration(a),r=a.valueOf()<i.valueOf()?a:i,a=a.valueOf()>i.valueOf()?a:i,i=o?B.convertValueToDuration(r,"1217"):B.convertValueToMoment(r),r=o?B.convertValueToDuration(a,"1217"):B.convertValueToMoment(a);if(this.get("ResetViewStateOnly"))return this.updateViewState(e,{min:i,max:r});this.updateMinMax(e,i,r,t),this.updateViewState(e)}},p.prototype.dragZoomCategory=function(e,t){var i=_.get(e,"scales");if(i){var a=e.data.labels,o=this.isTransposed?t.offsetY:t.offsetX,r=this.root,i=i[this.activeAxis].getValueForPixel(o),o=Math.min(r,i),r=Math.max(r,i);if(this.get("ResetViewStateOnly"))return this.updateViewState(e,{min:a[o],max:a[r]});this.updateMinMax(e,a[o],a[r],t),this.updateViewState(e)}},p.prototype.pan=function(e,t){var i=_.get(e,"chart.scales");if(i){switch(e.preventUpdate=!0,i[this.activeAxis].options.type){case"linear":this.panLinear(e,t);break;case"time":this.panTime(e,t);break;case"category":this.panCategory(e,t);break;default:this.hasWarned||(this.hasWarned=!0)}this.debounceViewState(e)}},p.prototype.panCategory=function(e,t){var i,a,o,r,n=_.get(e,"scales");n&&this.rootEvent&&(i=e.data.labels,a=this.isTransposed?t.offsetY:t.offsetX,a=n[this.activeAxis].getValueForPixel(a),a=this.root-a,r=n[this.activeAxis].minIndex,o=(n=n[this.activeAxis].maxIndex)-r,n=n+a,(r=r+a)<0?n=(r=0)+o:n>i.length-1&&(r=(n=i.length-1)-o),this.translateCrosshair(t.offsetX-this.rootEvent.offsetX),this.updateMinMax(e,i[r],i[n]))},p.prototype.panLinear=function(e,t){var i,a,o=_.get(e,"scales");o&&this.rootEvent&&(i=o[this.activeAxis].getValueForPixel(t.offsetX),i=this.root-i,a=(o[this.activeAxis].options.ticks.min||o[this.activeAxis].min)+i,o=(o[this.activeAxis].options.ticks.max||o[this.activeAxis].max)+i,this.translateCrosshair(t.offsetX-this.rootEvent.offsetX),this.updateMinMax(e,a,o))},p.prototype.addMilliSecToMoment=function(e,t){return B.convertValueToMoment(e._i).add(t,"ms").valueOf()},p.prototype.panTime=function(e,t){var i,a,o,r=_.get(e,"scales");r&&this.rootEvent&&(i=g.isDuration(this.root),a=r[this.activeAxis].getValueForPixel(t.offsetX),a=i?this.root-a:this.root.diff(a),o=r[this.activeAxis].options.ticks.min||r[this.activeAxis].min,r=r[this.activeAxis].options.ticks.max||r[this.activeAxis].max,o=i?o._milliseconds+a:this.addMilliSecToMoment(o,a),r=i?r._milliseconds+a:this.addMilliSecToMoment(r,a),a=i?B.convertValueToDuration(o,"1217"):B.convertValueToMoment(o),o=i?B.convertValueToDuration(r,"1217"):B.convertValueToMoment(r),this.translateCrosshair(t.offsetX-this.rootEvent.offsetX),this.updateMinMax(e,a,o))},p.prototype.translateCrosshair=function(e){var t=_.get(this.chartInstance,"config.crosshairModel.selectedCrosshairArea");t&&this.crosshairRoot&&t.css({left:this.crosshairRoot+e+"px"})},p.prototype.directionFactor=function(e,t){var i=e.chartArea.left,e=e.chartArea.right;return(t.offsetX-i)/(e-i)},p.prototype.zoom=function(e,t){var i=_.get(e,"scales");if(i){i=i[this.activeAxis].options.type;switch(e.preventUpdate=!0,i){case"linear":case"logarithmic":this.zoomLinear(e,t);break;case"time":this.zoomTime(e,t);break;case"category":this.zoomCategory(e,t);break;default:this.hasWarned||(this.hasWarned=!0)}this.debounceViewState(e)}},p.prototype.zoomCategory=function(e,t){var i,a,o=_.get(e,"scales");o&&(i=e.data.labels,a=o[this.activeAxis].minIndex,o=o[this.activeAxis].maxIndex,t=t.deltaY/Math.abs(t.deltaY)*1,a=Math.ceil(a-t),(o=(o=Math.floor(o+t))>i.length-1?i.length-1:o)<(a=a<0?0:a)&&(t=a,a=o,o=t),this.updateMinMax(e,i[a],i[o]))},p.prototype.zoomLinear=function(e,t){var i,a,o=_.get(e,"scales");o&&(i=this.directionFactor(e,t),a=o[this.activeAxis].options.ticks.min||o[this.activeAxis].min,t=.1*((o=o[this.activeAxis].options.ticks.max||o[this.activeAxis].max)-a)*(t.deltaY/Math.abs(t.deltaY)),this.updateMinMax(e,a-t*i,o+t*(1-i)))},p.prototype.zoomTime=function(e,t){var i,a,o,r=_.get(e,"scales");r&&(o=this.directionFactor(e,t),a=r[this.activeAxis].options.ticks.min||r[this.activeAxis].min,r=r[this.activeAxis].options.ticks.max||r[this.activeAxis].max,t=(i=x.isDuration(a))?(a=a._milliseconds,.1*((r=r._milliseconds)-a)*(t.deltaY/Math.abs(t.deltaY))):a._isAMomentObject?(a=g(a._d),.1*((r=g(r._d))-a)*(t.deltaY/Math.abs(t.deltaY))):.1*r.diff(a)*(t.deltaY/Math.abs(t.deltaY)),a=a-t*o,r=r+t*(1-o),t=i?B.convertValueToDuration(a,"1217"):B.convertValueToMoment(a).tz("UTC"),o=i?B.convertValueToDuration(r,"1217"):B.convertValueToMoment(r).tz("UTC"),"smart"===this.distribution&&this.defaultZoom&&(t=this.defaultZoom.min>t?this.defaultZoom.min:t,o=this.defaultZoom.max<o?this.defaultZoom.max:o),this.updateMinMax(e,t,o))},p.prototype.fetchZoomObj=function(e){var t=_.get(e,"scales"),i={min:"",max:""};if(!t)return i;var a=t[this.activeAxis].options,t=a.type,e=_.get(e,"data.labels"),o=e&&e.length?_.first(e):void 0,r=e&&e.length?_.last(e):void 0;switch(t){case"linear":case"logarithmic":i={min:this.get("min")||a.ticks.min||o,max:this.get("max")||a.ticks.max||r};break;case"time":i={min:_.get(a,"ticks.min._isValid")?a.ticks.min:"",max:_.get(a,"ticks.max._isValid")?a.ticks.max:""};break;case"category":i={min:this.get("min")||a.ticks.min||o,max:this.get("max")||a.ticks.max||r}}return i},p.prototype.updateMinMaxFromViewstate=function(){var e=_.get(this.chartInstance,"scales");if(e){var e=e[this.activeAxis].options.type,t=this.chartInstance,i=this.get("Min"),a=this.get("Max");switch(this.isReset=!1,e){case"linear":case"logarithmic":this.updateMinMax(t,parseFloat(i),parseFloat(a));break;case"time":""!==i&&B.convertValueToMoment(i),""!==a&&B.convertValueToMoment(a),this.updateMinMax(t,i,a);break;case"category":var o,r,n=t.data.labels[0];g.isDuration(n)||g.isMoment(n)?(o=B.convertStringToMomentFormat(i,i.type),r=B.convertStringToMomentFormat(a,a.type),i=t.data.labels.find(function(e){return e.valueOf()===(_.isNil(o)?o:o.valueOf())})||i,a=t.data.labels.find(function(e){return e.valueOf()===(_.isNil(r)?r:r.valueOf())})||a):"number"==typeof n&&(i=1<n.toString().split(".").length?parseInt(i,10):parseFloat(i),a=1<n.toString().split(".").length?parseInt(a,10):parseFloat(a)),this.updateMinMax(t,i,a);break;default:this.hasWarned||(this.hasWarned=!0)}this.zoomObj=this.fetchZoomObj(t),this.set("Min",this.valToViewState(this.zoomObj.min),{silent:!0}),this.set("Max",this.valToViewState(this.zoomObj.max),{silent:!0})}},p.prototype.updateViewState=function(e,t){if(!this.isTransposed)try{this.zoomObj=t||this.fetchZoomObj(e),this.set("Min",this.valToViewState(this.zoomObj.min),{silent:!0}),this.set("Max",this.valToViewState(this.zoomObj.max),{silent:!0}),e.preventUpdate=!1,this.chartInstance.isDirty&&this.trigger("cleanChart",this),this.trigger("MinMaxChange",this)}catch(e){this.warnings=e.toString()}},p.prototype.valToViewState=function(e){return void 0!==e&&e._isAMomentObject&&"function"!=typeof e.isValid&&(e.utcOffset&&(e=B.convertKDBTemporalToMoment(e)),e=B.convertKDBTemporalToMoment(g(e._i))),(e=x.isDuration(e)?this.setDuration(e._milliseconds,e.kdbType):e)&&e.toDashString?e.toDashString():null!=e?""+e:""};var oe,re=p;function p(e){var e=e.el,t=oe.call(this)||this;return t.isReset=!1,t.isTransposed=!1,t.activeAxis="XAxis 1",t.hasWarned=!1,t.distribution="",t.warnings="",t.clicks=0,t.delay=300,t.zoomArea=e.find(".zoomchart"),t.debounceViewState=_.debounce(t.updateViewState.bind(t),100*t.get("ViewstateUpdateDelay")),t.initalizeListeners(),t}var ne;ne=r.DeepModel,e(se,ne),se.prototype.initialize=function(e){this.set("ShowExportCsvButton",e.ShowExportCsvButton),this.set("ShowExportExcelButton",e.ShowExportExcelButton)};function se(){return null!==ne&&ne.apply(this,arguments)||this}var b={Trigger:{default:"Click",enum:["Click","Hover","Double Click"],propertyOrder:2,title:"Trigger Action",type:"string"}},v=(S.axisTypeFactory=function(e,t){return{title:e,options:{collapsed:!0,linked_oneof_property:{property:"_Hidden._Type",value:e}},properties:S.axisPropertiesFactory(e,t)}},S.factory=function(t,e){var i="XAxes"===t?["category","linear","logarithmic","time"]:["linear","category","logarithmic","time"];return{type:"array",propertyOrder:e,items:{type:"object",id:"arrItem",title:t,headerTemplate:l.singular(t)+" {{ i1 }}",oneOf:i.map(function(e){return S.axisTypeFactory(e,t)})}}},S.axisPropertiesFactory=function(e,t){var i={_Hidden:{options:{hidden:!0},properties:{_AxisId:{options:{hidden:!0},type:"string"},_Index:{options:{hidden:!0},type:"number"},_Label:{options:{hidden:!0},type:"string"},_Type:{default:e,options:{hidden:!0},type:"string"}},type:"object"},Center:{default:"",options:{hidden:!("linear"===e)},propertyOrder:31,type:"string"},Display:{default:!0,format:"checkbox",propertyOrder:20,title:"Display",type:"boolean"},GridLines:{options:{collapsed:!0},properties:{OffsetGridLines:{default:!0,format:"checkbox",type:"boolean"}},type:"object"},Position:{default:"XAxes"===t?"bottom":"left",enum:"XAxes"===t?["bottom","top"]:["left","right"],propertyOrder:10,type:"string"},Stacked:{default:!1,format:"checkbox",propertyOrder:30,title:"Stacked",type:"boolean"},Title:{options:{collapsed:!0},properties:$.extend(!0,{Display:{default:!1,format:"checkbox",type:"boolean"},FontFamily:{default:null,type:"string"},FontSize:{default:null,format:"number",type:"number"},FontStyle:{default:null,enum:["normal","italic","oblique","initial","inherit"],type:"string"},LabelString:{default:null,type:"string"}},x.colorFactory("Font",void 0,void 0)),type:"object"},Labels:{options:{collapsed:!0},properties:$.extend(!0,{Display:{default:!0,format:"checkbox",propertyOrder:1,type:"boolean"},FontFamily:{default:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",propertyOrder:17,title:"Font Family",type:"string"},FontSize:{default:12,format:"number",propertyOrder:16,title:"Font Size",type:"number"},FontStyle:{default:"normal",enum:["normal","italic","oblique","initial","inherit"],propertyOrder:18,title:"Font Style",type:"string"},MaxRotation:{default:360,propertyOrder:9,title:"Max Rotation",type:"number"},MaxWidth:{default:0,propertyOrder:11,title:"Fixed Axis Width",type:"number"},MinRotation:{default:0,propertyOrder:10,title:"Min Rotation",type:"number"},StepSize:{default:0,propertyOrder:13,title:"Step Size",type:"number"},_ReverseCache:{default:!1,options:{hidden:!0},type:"boolean"}},x.colorFactory("Font","#F8F8F8",100),_.includes(["linear","logarithmic"],e)?{Reverse:{default:!1,format:"checkbox",propertyOrder:3,type:"boolean"}}:{},x.colorFactory("Font","#F8F8F8",100),_.includes(["time","linear"],e)?{Offset:{default:!1,format:"checkbox",propertyOrder:3,title:"Offset",type:"boolean"}}:{},_.includes(["category","linear","logarithmic"],e)?{BeginAtZero:{default:!0,format:"checkbox",propertyOrder:2,title:"Begin At Zero",type:"boolean"},DateFormat:{default:"YYYY-MM-DD",enum:["YYYY-MM-DD","YYYY-MMM-DD","YYYY-MMMM-DD","YYYY-MM","YYYY-MMM","YYYY-MMMM","MMM DD","MMM Do","YYYY-MM-DD HH:mm:ss","YYYY-MM-DD hh:mm:ss","YYYY-MM-DD kk:mm:ss","hh:mm:ss","kk:mm:ss","hh:mm:ss.SS","hh:mm","kk:mm","mm:ss","mm:ss.SS"],propertyOrder:6,title:"Date/Time format",type:"string"},Format:{default:"General",enum:["General","Number","Smart Number","Formatted Number","Datetime"],propertyOrder:5,type:"string"},HideTrailingZeroes:{default:!1,format:"checkbox",propertyOrder:4,title:"Hide Trailing Zeroes",type:"boolean"},Precision:{default:2,format:"number",maximum:10,minimum:0,propertyOrder:7,title:"Decimal Places",type:"number"},Prefix:{default:"",propertyOrder:14,type:"string"},Suffix:{default:"",propertyOrder:15,type:"string"}}:{},_.includes(["category"],e)?{FilterUnique:{default:!1,format:"checkbox",title:"Filter Unique",type:"boolean"}}:{},_.includes(["time"],e)?{TimeFormats:{options:{collapsed:!0},properties:{Break:{default:864e5,minimum:0,propertyOrder:1,type:"number"},Day:{default:"MMM D",propertyOrder:7,type:"string"},Distribution:{default:"linear",enum:["linear","series","smart"],propertyOrder:1,type:"string"},Hour:{default:"hA",propertyOrder:8,type:"string"},IsoWeekday:{default:!1,format:"checkbox",propertyOrder:13,type:"boolean"},ShowMajor:{default:!1,format:"checkbox",propertyOrder:15,title:"Show Major units",type:"boolean"},Millisecond:{default:"h:mm:ss.SSS a",propertyOrder:11,type:"string"},Minute:{default:"h:mm a",propertyOrder:9,type:"string"},Month:{default:"MMM YYYY",propertyOrder:5,type:"string"},Quarter:{default:"[Q]Q - YYYY",propertyOrder:4,type:"string"},Round:{default:!1,format:"checkbox",propertyOrder:14,type:"boolean"},Second:{default:"h:mm:ss a",propertyOrder:10,type:"string"},TooltipFormat:{default:"",propertyOrder:12,title:"Tooltip Format",type:"string"},TriggerBreak:{default:864e5,minimum:0,propertyOrder:1,type:"number"},Unit:{default:"",enum:["","year","quarter","month","week","day","hour","minute","second","millisecond"],propertyOrder:2,title:"Force Time Unit",type:"string"},Week:{default:"ll",propertyOrder:6,type:"string"},Year:{default:"YYYY",propertyOrder:3,type:"string"}},title:"Time Formats",type:"object"}}:{}),type:"object"}};switch($.extend(!0,i.GridLines.properties,x.colorFactory("GridLines","#F8F8F8",10)),e){case"linear":case"logarithmic":case"time":i.Range={options:{collapsed:!0},properties:{Max:{default:void 0,format:"number",propertyOrder:6,type:"number"},Min:{default:void 0,format:"number",propertyOrder:7,type:"number"},SoftRange:{default:void 0,format:"checkbox",propertyOrder:3,title:"Use Soft Range",type:"boolean"},SuggestedMax:{default:void 0,format:"number",propertyOrder:4,title:"Suggested Max",type:"number"},SuggestedMin:{default:void 0,format:"number",propertyOrder:5,title:"Suggested Min",type:"number"},UseDataRange:{default:void 0,format:"checkbox",propertyOrder:3,title:"Use Data Range",type:"boolean"},UseMinMax:{default:!1,format:"checkbox",propertyOrder:1,title:"Use Min/Max",type:"boolean"},UseMinMaxReset:{default:!0,format:"checkbox",propertyOrder:2,title:"Reset on change",type:"boolean"}},type:"object"}}return i},S);function S(){}var C={RuleName:{default:"",propertyOrder:1,title:"Rule Name",type:"string"},RuleSource:{default:"",enumSource:"possible_cols",propertyOrder:3,title:"Rule Source",type:"string",watch:{possible_cols:"arrItem._Hidden._PossibleColumnsWithItself"}},RuleTarget:{data:"possible_columns",default:"*",propertyOrder:2,title:"Rule Target",type:"customDropdown",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}},RuleType:{options:{hidden:!0},propertyOrder:4,title:"Rule Type",type:"string"},Show:{default:!1,format:"checkbox",propertyOrder:5,title:"Show Rule in Legend",type:"boolean"}},C={_Hidden:{options:{hidden:!0},properties:{_Index:{options:{hidden:!0},type:"number"},_LayerId:{options:{hidden:!0},type:"string"},_PossibleColumns:{options:{hidden:!0},type:"array"},_PossibleColumnsWithItself:{options:{hidden:!0},type:"array"},_PossibleColumnsWithXYKey:{options:{hidden:!0},type:"array"},_PossibleRadius:{options:{hidden:!0},type:"array"},_PossibleXAxes:{options:{hidden:!0},type:"array"},_PossibleYAxes:{options:{hidden:!0},type:"array"}},type:"object"},Basics:{options:{collapsed:!0},properties:$.extend(!0,{},{Data:{propertyOrder:1,title:"Data Source",type:"data"},Enabled:{default:!0,format:"checkbox",propertyOrder:3,title:"Enabled",type:"boolean"},LegendEnabled:{default:!0,format:"checkbox",propertyOrder:4,title:"Legend Enabled",type:"boolean"},LegendLabelColor:{default:"#F8F8F8",options:{gradient:!1,hidden:!0,noColor:!1},propertyOrder:5,title:"Legend Color",type:"gradient"},Name:{default:"",propertyOrder:2,type:"string"}},x.backgroundFactory(""),x.borderFactory("")),propertyOrder:10,type:"object"},Axes:{options:{collapsed:!0},properties:{XAxisData:{data:"possible_columns",default:"",title:"X-Axis Data",type:"customDropdown",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}},XAxisID:{enumSource:"possible_xaxis",title:"X-Axis ID",type:"string",watch:{possible_xaxis:"arrItem._Hidden._PossibleXAxes"}},YAxisID:{enumSource:"possible_yaxis",title:"Y-Axis ID",type:"string",watch:{possible_yaxis:"arrItem._Hidden._PossibleYAxes"}}},propertyOrder:20,type:"object"},HighlightRules:{items:{oneOf:[{options:{linked_oneof_property:{property:"RuleType",value:"discrete"}},properties:Object.assign({},C,{RuleBorderColor:{default:"#F8F8F8",options:{gradient:!1,noColor:!1},propertyOrder:12,title:"Rule Border Color",type:"gradient"},RuleColor:{default:"#F8F8F8",options:{gradient:!1,noColor:!1},propertyOrder:11,title:"Rule Colour",type:"gradient"},RuleOperation:{default:"",enum:["","search","regexp","contains","starts with","ends with","==","<",">","<=",">=","!=","in","Fill Left-to-Right","Fill Right-to-Left"],propertyOrder:9,title:"Rule Operation",type:"string"},RuleValue:{data:"possible_columns",default:"",propertyOrder:10,title:"Rule Value",type:"string"}}),title:"Discrete"},{options:{additionalProperties:!1,linked_oneof_property:{property:"RuleType",value:"gradient"}},properties:Object.assign({},C,{Palette:{default:[{type:"#b71c1c"},{type:"#F57F17"},{type:"#33691E"}],format:"table",items:{properties:{type:{default:"#ffa500",options:{gradient:!1},title:"color",type:"gradient"}},title:"Palette Colour",type:"object"},options:{collapsed:!0},propertyOrder:8,title:"Colour Palette",type:"array",uniqueItems:!1},RuleMax:{default:1,format:"number",propertyOrder:7,title:"Rule Max",type:"number"},RuleMin:{default:0,format:"number",propertyOrder:6,title:"Rule Min",type:"number"}}),title:"Gradient"},{options:{additionalProperties:!1,linked_oneof_property:{property:"RuleType",value:"iterative"}},properties:{RuleName:{default:"",propertyOrder:1,title:"Rule Name",type:"string"},RuleSource:{default:"",enumSource:"possible_cols",options:{hidden:!0},propertyOrder:3,title:"Rule Source",type:"string",watch:{possible_cols:"arrItem._Hidden._PossibleColumnsWithItself"}},RuleTarget:{data:"possible_columns",default:"*",options:{hidden:!0},propertyOrder:2,title:"Rule Target",type:"customDropdown",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}},RuleType:{options:{hidden:!0},propertyOrder:4,title:"Rule Type",type:"string"},Show:{default:!1,format:"checkbox",propertyOrder:5,title:"Show Rule in Legend",type:"boolean"},Palette:{default:[{type:"#b71c1c"},{type:"#F57F17"},{type:"#33691E"}],format:"table",items:{properties:{type:{default:"#ffa500",options:{gradient:!1},title:"color",type:"gradient"}},title:"Palette Colour",type:"object"},options:{collapsed:!0},propertyOrder:8,title:"Colour Palette",type:"array",uniqueItems:!1}},title:"Iterative"}],title:"Iterative Highlight",type:"object"},options:{collapsed:!0},title:"Highlight Rules",type:"array"},Actions:{fields:{map:_.extend({Current:{enumSource:"possible_columns",propertyOrder:10,title:"Source Column",type:"string",watch:{possible_columns:"arrItem._Hidden._PossibleColumnsWithXYKey"}}},b),nav:b,query:b,url:b},options:{collapsed:!0},type:"actions"},Labels:{options:{collapsed:!0},properties:{Align:{default:"center",enum:["center","start","end","right","bottom","left","top","iterative"],propertyOrder:4,type:"string"},Anchor:{default:"center",enum:["center","start","end","iterative"],propertyOrder:5,type:"string"},Color:{default:"#000",options:{gradient:!1,noColor:!1},propertyOrder:2,title:"Label Color",type:"gradient"},Enabled:{default:!1,format:"checkbox",propertyOrder:1,type:"boolean"},ShowOverlap:{default:!1,format:"checkbox",propertyOrder:8,title:"Show Overlap",type:"boolean"},Font:{properties:{Bold:{default:!1,format:"checkbox",type:"boolean"},Size:{default:12,minimum:1,type:"number"}},propertyOrder:8,type:"object"},Frequency:{default:1,minimum:1,propertyOrder:3,title:"Label Freq",type:"number"},Offset:{default:"0",propertyOrder:6,type:"string"},Rotation:{default:0,propertyOrder:7,type:"number"},Template:{default:"{{x}}, {{toFixed y 2}}",propertyOrder:7,templateItems:{values:{items:_.keyBy(["x","y","r"]),type:"object"}},title:"Label Template",type:"tooltipTemplate"}},type:"object"}},L={properties:{Animations:{options:{collapsed:!0},properties:{Duration:{default:void 0,format:"number",propertyOrder:5,type:"number"},Easing:{default:void 0,enum:["linear","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","easeOutSine","easeInOutSine","easeInExpo","easeOutExpo","easeInOutExpo","easeInCirc","easeOutCirc","easeInOutCirc","easeInElastic","easeOutElastic","easeInOutElastic","easeInBack","easeOutBack","easeInOutBack","easeInBounce","easeOutBounce","easeInOutBounce"],propertyOrder:4,type:"string"},Enabled:{default:!1,format:"checkbox",propertyOrder:1,type:"boolean"},HoverEvents:{default:!0,format:"checkbox",propertyOrder:2,type:"boolean"},InteractionMode:{default:"x",enum:["x","y","point","dataset"],propertyOrder:3,title:"Interaction Mode",type:"string"}},propertyOrder:300,type:"object"},Basics:{options:{collapsed:!0},properties:{Focus:{default:"",propertyOrder:2,type:"string"},Hover:{default:"",propertyOrder:3,type:"string"},Selected:{default:"",propertyOrder:1,type:"string"},Transpose:{default:!1,format:"checkbox",propertyOrder:4,type:"boolean"}},propertyOrder:100,type:"object"},Layers:{_paste:function(e,t,i){function a(e){return _.get(e,"_Hidden._LayerId")&&_.set(e,"_Hidden._LayerId",_.uniqueId("layer_")),e}i(_.isArray(e)?_.map(e,a):a(e))},items:{additionalProperties:!1,headerTemplate:"{{#if self.Basics.Name}}{{valueProp self.Basics.Name }}{{else}}Layer {{ i1 }}{{/if}}",id:"arrItem",oneOf:[{options:{linked_oneof_property:{property:"_Hidden._Type",value:"Line"}},properties:$.extend(!0,{},C,{Axes:{properties:{YAxisData:{data:"possible_columns",default:"",title:"Y-Axis Data",type:"customDropdown",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}}}},Interpolation:{options:{collapsed:!0},properties:{Interpolation:{default:"Linear",enum:["Linear","Cubic","Monotone","Stepped"],type:"string"},LineTension:{default:0,format:"range",maximum:10,minimum:0,type:"number"},SteppedLine:{default:"after",enum:["before","after"],type:"string"}},propertyOrder:30,type:"object"},Line:{options:{collapsed:!0},properties:{DashGap:{default:0,format:"number",propertyOrder:6,title:"Dash Gap",type:"number"},DashWidth:{default:0,format:"number",propertyOrder:5,title:"Dash Width",type:"number"},FadeToTransparent:{default:!1,format:"checkbox",propertyOrder:4,title:"Fade to Transparent",type:"boolean"},Fill:{default:"nofill",enumSource:"possible_layers",propertyOrder:3,type:"string",watch:{possible_layers:"arrItem._Hidden._PossibleLayers"}},ShowLine:{default:!0,format:"checkbox",propertyOrder:2,type:"boolean"},SpanGaps:{default:!1,format:"checkbox",propertyOrder:1,type:"boolean"}},propertyOrder:40,type:"object"},Points:{options:{collapsed:!0},properties:$.extend(!0,{},x.backgroundFactory("Point"),x.borderFactory("Point"),x.radiusFactory("Point"),{PointStyle:{default:"circle",enum:["circle","cross","crossRot","dash","line","rect","rectRounded","rectRot","star","triangle","downTriangle"],title:"Style",type:"string"}},x.radiusFactory("PointHit"),x.backgroundFactory("PointHover"),x.borderFactory("PointHover"),x.radiusFactory("PointHover")),propertyOrder:50,type:"object"},_Hidden:{properties:$.extend(!0,{},x.typeFactory("Line"),{_PossibleLayers:{options:{hidden:!0},type:"array"}})}}),title:"Line"},{options:{linked_oneof_property:{property:"_Hidden._Type",value:"Bar"}},properties:$.extend(!0,{},C,{Axes:{properties:{YAxisData:{data:"possible_columns",default:"",title:"Y-Axis Data",type:"customDropdown",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}}}},Bars:{options:{collapsed:!0},properties:$.extend(!0,{BarPercentage:{default:90,format:"range",maximum:100,minimum:0,title:"Bar Percentage",type:"number"},BarThickness:{default:10,title:"Bar Thickness",type:"number"},BarWidthType:{default:"percentage",enum:["percentage","manual bar thickness"],title:"Bar Width type",type:"string"},CategoryPercentage:{default:80,format:"range",maximum:100,minimum:0,title:"Category Percentage",type:"number"},MaxBarThickness:{default:10,title:"Max Bar Thickness",type:"number"}},x.backgroundFactory("Hover"),x.borderFactory("Hover")),propertyOrder:30,type:"object"},_Hidden:{properties:x.typeFactory("Bar")}}),title:"Bar"},{options:{linked_oneof_property:{property:"_Hidden._Type",value:"Bubble"}},properties:$.extend(!0,{},C,{Axes:{properties:{Radius:{default:"Fixed Size",enumSource:"possible_radius",title:"Radius Data",type:"string",watch:{possible_radius:"arrItem._Hidden._PossibleRadius"}},RadiusScaling:{default:1,format:"number",title:"Radius Scaling",type:"number"},YAxisData:{data:"possible_columns",default:"",title:"Y-Axis Data",type:"customDropdown",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}}}},Bubbles:{options:{collapsed:!0},properties:$.extend(!0,{},x.backgroundFactory("Hover"),x.borderFactory("Hover"),x.radiusFactory("Hover"),{Icons:{default:"",title:"Icon Override",type:"icon"},PointStyle:{default:"circle",enum:["circle","cross","crossRot","dash","line","rect","rectRounded","rectRot","star","triangle","downTriangle"],type:"string"}}),propertyOrder:30,type:"object"},_Hidden:{properties:x.typeFactory("Bubble")}}),title:"Bubble"},{options:{linked_oneof_property:{property:"_Hidden._Type",value:"BoxPlot"}},properties:$.extend(!0,{},C,{Axes:{properties:{Max:{enumSource:"possible_columns",propertyOrder:5,title:"Max",type:"string",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}},Median:{enumSource:"possible_columns",propertyOrder:3,title:"Median",type:"string",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}},Min:{enumSource:"possible_columns",propertyOrder:1,title:"Min",type:"string",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}},Q1:{enumSource:"possible_columns",propertyOrder:2,title:"Q1",type:"string",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}},Q3:{enumSource:"possible_columns",propertyOrder:4,title:"Q3",type:"string",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}},Outliers:{enumSource:"possible_columns",propertyOrder:10,title:"Outliers",type:"string",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}}}},BoxPlot:{options:{collapsed:!0},properties:$.extend(!0,{BarPercentage:{default:90,format:"range",maximum:100,minimum:0,title:"Bar Percentage",type:"number"},BarThickness:{default:10,title:"Bar Thickness",type:"number"},BarWidthType:{default:"percentage",enum:["percentage","manual bar thickness"],title:"Bar Width type",type:"string"},CategoryPercentage:{default:80,format:"range",maximum:100,minimum:0,title:"Category Percentage",type:"number"},MaxBarThickness:{default:10,title:"Max Bar Thickness",type:"number"}},x.backgroundFactory("Hover"),x.borderFactory("Hover")),propertyOrder:30,type:"object"},_Hidden:{properties:x.typeFactory("BoxPlot")}}),title:"BoxPlot"},{options:{linked_oneof_property:{property:"_Hidden._Type",value:"Violin"}},properties:$.extend(!0,{},C,{_Hidden:{properties:x.typeFactory("Violin")},Violin:{options:{collapsed:!0},properties:$.extend(!0,{BarPercentage:{default:90,format:"range",maximum:100,minimum:0,title:"Bar Percentage",type:"number"},BarThickness:{default:10,title:"Bar Thickness",type:"number"},BarWidthType:{default:"percentage",enum:["percentage","manual bar thickness"],title:"Bar Width type",type:"string"},CategoryPercentage:{default:80,format:"range",maximum:100,minimum:0,title:"Category Percentage",type:"number"},MaxBarThickness:{default:10,title:"Max Bar Thickness",type:"number"}},x.backgroundFactory("Hover"),x.borderFactory("Hover")),propertyOrder:30,type:"object"},Axes:{properties:{Coords:{enumSource:"possible_columns",title:"Coordinates",type:"string",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}}}}}),title:"Violin"},{options:{linked_oneof_property:{property:"_Hidden._Type",value:"Candlestick"}},properties:$.extend(!0,{},C,{_Hidden:{properties:x.typeFactory("Candlestick")},Candlestick:{options:{collapsed:!0},properties:{OHLC:{default:!1,format:"checkbox",title:"Use OHLC",type:"boolean"},BearColor:{default:"rgb(255,0,0)",options:{gradient:!1},title:"Bear Color",type:"gradient"},BullColor:{default:"rgb(0,255,0)",options:{gradient:!1},title:"Bull Color",type:"gradient"},NeutralColor:{default:"rgb(255,255,255)",options:{gradient:!1},title:"Neutral Color",type:"gradient"},BarPercentage:{default:90,format:"range",maximum:100,minimum:0,title:"Bar Percentage",type:"number"},BarThickness:{default:10,title:"Bar Thickness",type:"number"},BarWidthType:{default:"percentage",enum:["percentage","manual bar thickness"],title:"Bar Width type",type:"string"},CategoryPercentage:{default:80,format:"range",maximum:100,minimum:0,title:"Category Percentage",type:"number"},MaxBarThickness:{default:10,title:"Max Bar Thickness",type:"number"}},propertyOrder:30,type:"object"},Axes:{properties:{Close:{enumSource:"possible_columns",propertyOrder:2,title:"Close",type:"string",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}},High:{enumSource:"possible_columns",propertyOrder:4,title:"High",type:"string",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}},Low:{enumSource:"possible_columns",propertyOrder:3,title:"Low",type:"string",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}},Open:{enumSource:"possible_columns",propertyOrder:1,title:"Open",type:"string",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}}}}}),title:"Candlestick"}],options:{hidden:void 0,collapsed:!0,keep_oneof_values:!0},title:"Layer",type:"object"},propertyOrder:200,type:"array"},Overlay:{options:{collapsed:!0},properties:{CrosshairsColor:{default:"#F8F8F8",options:{gradient:!1,noColor:!1},propertyOrder:321,title:"Crosshairs Color",type:"gradient"},CrosshairsEnabled:{default:!0,format:"checkbox",propertyOrder:311,title:"Show Crosshairs",type:"boolean"},EdgeAlign:{default:!1,format:"checkbox",propertyOrder:317,title:"Align Tooltip with Edge",type:"boolean"},Offset:{default:7,minimum:0,propertyOrder:318,title:"Tooltip Offset",type:"number"},PreferIntersect:{default:!1,format:"checkbox",propertyOrder:314,title:"Prefer Intersect",type:"boolean"},TooltipBGOpacity:{default:80,format:"range",maximum:100,minimum:0,propertyOrder:315,title:"Tooltip Background Opacity",type:"number"},TooltipFontSize:{default:12,maximum:100,minimum:0,propertyOrder:316,title:"Tooltip Font Size",type:"number"},TooltipsEnabled:{default:!0,format:"checkbox",propertyOrder:312,title:"Show Tooltip",type:"boolean"},TooltipsIntersect:{default:!1,format:"checkbox",propertyOrder:313,title:"Tooltips Intersect",type:"boolean"},customTooltip:{data:["series","values"],default:"<table><thead><tr style='padding-right: 10px;'> <th>{{ xLabel }} </th><th> </th > </tr></thead > {{#each points }}<tr><td><svg height='12' width = '12' > <rect style='fill:{{colors.backgroundColor}};stroke-width:3;stroke:{{colors.borderColor}}' height = '12' width = '12' > </rect></svg > {{ layerName }}: </td><td style='padding-right: 10px; text-align: left;'>{{layerData}}</td > </tr>{{/each}}</table>",propertyOrder:320,templateItems:{points:{items:{colors:{backgroundColor:"backgroundColor",borderColor:"borderColor"},cols:null,isLayerEnabled:"isLayerEnabled",layerData:"layerData",layerDataFormatted:"layerDataFormatted",layerName:"layerName"},type:"array"}},title:"Custom tooltip",type:"tooltipTemplate"},useCustomTooltip:{default:!1,format:"checkbox",propertyOrder:319,title:"Use Custom Tooltip",type:"boolean"}},propertyOrder:310,type:"object"},Zoom:{options:{collapsed:!0},properties:{DefaultMax:{default:"",propertyOrder:10,title:"Default Max  Viewstate",type:"viewstate"},DefaultMin:{default:"",propertyOrder:9,title:"Default Min Viewstate",type:"viewstate"},DragPan:{default:!0,format:"checkbox",propertyOrder:3,title:"Pan",type:"boolean"},DragZoom:{default:!0,format:"checkbox",propertyOrder:2,title:"Drag Zoom",type:"boolean"},FillColor:{default:"#898989",options:{gradient:!1},propertyOrder:5,title:"Fill Colour",type:"gradient"},FillOpacity:{default:60,format:"range",maximum:100,minimum:0,propertyOrder:6,title:"Fill Opacity",type:"number"},Max:{default:"",propertyOrder:8,title:"Max Viewstate",type:"viewstate"},Min:{default:"",propertyOrder:7,title:"Min Viewstate",type:"viewstate"},ResetViewStateOnly:{default:!1,format:"checkbox",propertyOrder:4,title:"Reset Viewstates Only",type:"boolean"},ScrollZoom:{default:!0,format:"checkbox",propertyOrder:1,title:"Scroll Zoom",type:"boolean"},ViewstateUpdateDelay:{default:1,maximum:10,minimum:0,propertyOrder:11,title:"Viewstate Update Delay (s)",type:"number"},YAdjust:{default:"none",enum:["none","nice","min/max"],title:"Rounding for Y-axis",type:"string"},ZoomStack:{default:"",options:{hidden:!0},title:"Zoom Stack",type:"string"},ZoomToIndex:{default:!0,format:"checkbox",title:"Snap to Data",type:"boolean"}},propertyOrder:312,title:"Zoom & Pan",type:"object"},Legend:{options:{collapsed:!0},properties:{Display:{default:!0,format:"checkbox",position:1,type:"boolean"},Position:{default:"top",enum:["top","top-inline","bottom","left","right"],position:2,type:"string"},BoxWidth:{default:12,position:4,title:"Icon Width",type:"number"},Padding:{default:10,position:5,title:"Icon Padding",type:"number"},FullWidth:{default:!0,format:"checkbox",options:{hidden:!0},position:2,title:"Full Width",type:"boolean"},LabelFontFamily:{default:"Helvetica",enum:["Helvetica","Arial","Times New Roman","Times","Courier New","Courier","Verdana","Georgia","Palatino","Garamond","Comic Sans MS"],options:{hidden:!0},position:6,title:"Label Font Family",type:"string"},LabelFontSize:{default:12,position:6,title:"Label Font Size",type:"number"},LabelColor:{default:"#898989",options:{gradient:!1},position:7,title:"Label Colour",type:"gradient"},Align:{default:"center",enum:["start","center","end"],position:8,title:"Align",type:"string"},LegendScroll:{default:"default",enum:["default","scroll","layer group","layer new line"],position:9,title:"Legend Display Type",type:"string"},LegendLayerThreshold:{default:5,position:10,title:"New Layer Threshold",type:"number"},Reverse:{default:!1,format:"checkbox",position:11,title:"Reverse Order",type:"boolean"},UsePointStyle:{default:!0,format:"checkbox",position:12,title:"Use Point Style",type:"boolean"}},propertyOrder:312,type:"object"},XAxes:v.factory("XAxes",210),YAxes:v.factory("YAxes",220),Style:{options:{collapsed:!0},properties:{Palette:{default:[{type:"#0061FF"},{type:"#F23A66"},{type:"#009BAB"},{type:"#7647CC"},{type:"#FFC300"},{type:"#9FA3A6"},{type:"#003A99"},{type:"#A90B31"},{type:"#005D67"},{type:"#452481"}],format:"table",items:{properties:{type:{default:"#ffa500",options:{gradient:!1},title:"color",type:"gradient"}},title:"Palette Colour",type:"object"},options:{collapsed:!1},propertyOrder:1,title:"Colour Palette",type:"array",uniqueItems:!1}},propertyOrder:313,title:"Style",type:"object"},FileExport:{options:{collapsed:!0},properties:{FileName:{format:"table",items:{options:{collapsed:!0},properties:{FileNamePart:{title:"FileName Part",type:"string"}},title:"Filename Part",type:"object"},options:{collapsed:!0,hidden:!1},title:"FileName",type:"array"},ShowExportCsvButton:{default:!1,format:"checkbox",title:"Show Export Csv Button",type:"boolean"},ShowExportExcelButton:{default:!1,format:"checkbox",title:"Show Export Excel Button",type:"boolean"},ShowScreenshot:{default:!1,format:"checkbox",title:"Show Screenshot Button",type:"boolean"}},propertyOrder:320,title:"File Export",type:"object"}},title:"properties",type:"object"},T=(D.mergeArray=function(e,l,d){var c=[];return _.each(e,function(e,n){var s=e._Hidden._Type;_.each(e,function(e,t){var i;if(void 0===c[n]?c.push(_.merge({},l[d][s])):_.get(c[n],"_Hidden")&&_.get(c[n],"_Hidden._Type")&&s!==_.get(c[n],"_Hidden._Type")&&"Layers"!==d&&(c[n]=_.merge({},l[d][s])),c[n][t]&&!e._dashboardsType&&"object"==typeof(i=c[n][t])&&"object"==typeof e&&0<Object.keys(e).length?_.each(e,function(e,t){i[t]=e}):c[n][t]=e,"object"==typeof c[n][t])for(var a=Object.keys(c[n][t]),o=0;o<a.length;o++){var r=a[o];void 0!==c[n][t][r]&&null!==c[n][t][r]||delete c[n][t][r]}})}),c},D.mergeDictionary=function(i,a,o){"string"!=typeof a&&_.each(a,function(e,t){void 0===i[o]?i[o]=a:void 0===i[o][t]||"object"!=typeof e||e._dashboardsType||e instanceof r.Model?i[o][t]=e:i[o][t]="Palette"===t?D.mergeObject(i[o][t],e):D.mergeJSON(i[o][t],e,!0)})},D.getJSONTemplateFromSchema=function(e,t){var e=e.properties[t],i={};return _.each(e.items.oneOf,function(e){var a={};_.each(e.properties,function(e,t){var i;e.properties?(a[t]={},i={},_.each(e.properties,function(e,t){void 0!==e.default&&(i[t]=e.default)}),a[t]=i):"array"===e.type||"actions"===e.type?a[t]=[]:"object"===e.type&&(a[t]={})}),i[e.title]=a}),i},D.appendCommonAxesProps=function(e,t){var i={Display:!0,FontColor:"#FFFFFF",FontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",FontOpacity:100,FontSize:12,FontStyle:"normal",MaxRotation:360,MinRotation:0,StepSize:0},a={Center:"",Display:!0,Labels:_.extend({},i,{Format:"General",HideTrailingZeroes:!1,Precision:2,Prefix:"",Suffix:""}),Position:"XAxes"===t?"bottom":"left",Stacked:!1},o={Center:"",Display:!0,Labels:i,Position:"XAxes"===t?"bottom":"left",Stacked:!1};return"XAxes"===t?a.Labels.FilterUnique=!1:"YAxes"===t&&(a.Labels.BeginAtZero=!0,a.Labels.Reverse=!1),_.each(e,function(e,t){D.mergeJSON(e,"time"===t?o:a,!1)}),e},D.mergeJSON=function(e,t,i){return i?_.extend(void 0===e?{}:e,void 0===t?{}:_.filter(t,function(e){return!_.isEqual(e,{})})):_.extend(void 0===e?{}:e,void 0===t?{}:t)},D.mergeObject=function(e,t){return _.mergeWith({},e,t,function(e,t){return _.isNull(t)?e:t})},D);function D(){}k.getComponentDefinition=function(e){var t,i,a={appArgs:{json:this.getDefaultJSON(),schema:L,quickStart:[{path:"Layers.0.Basics.Data",message:"populate Data Source"}]},componentDescription:"",componentName:"ChartJS",id:1};if(0<_.keys(e.settingsModel.attributes).length)for(i=k.upgrades.indexOf(_.find(k.upgrades,{version:e.settingsModel.get("version")}))+1;i<k.upgrades.length;i+=1)(t=k.upgrades[i]).fn(e.settingsModel),e.settingsModel.set("version",t.version);return a},k.getDefaultJSON=function(){var e=T.getJSONTemplateFromSchema(L,"XAxes"),t=T.getJSONTemplateFromSchema(L,"YAxes"),e=T.appendCommonAxesProps(e,"XAxes"),t=T.appendCommonAxesProps(t,"YAxes");return{Alignment:{innerPaddingBottom:0,innerPaddingLeft:0,innerPaddingRight:0,innerPaddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,titlePaddingBottom:7,titlePaddingLeft:0,titlePaddingRight:0,titlePaddingTop:7},Animations:{Enabled:!1,HoverEvents:!0,InteractionMode:"x"},Basics:{Focus:"",Hover:"",Selected:"",Transpose:!1},FileExport:{FileName:[],ShowExportCsvButton:!1,ShowExportExcelButton:!1,ShowScreenshot:!1},Layers:[{_Hidden:{_Index:0,_LayerId:"layer_8977",_PossibleColumns:[],_PossibleColumnsWithItself:[],_PossibleColumnsWithXYKey:[],_PossibleRadius:[],_PossibleXAxes:["XAxis 1"],_PossibleYAxes:["YAxis 1"],_Type:"Line",_PossibleLayers:["nofill","origin"]},Actions:[],Axes:{XAxisData:"",XAxisID:"XAxis 1",YAxisData:"",YAxisID:"YAxis 1"},Basics:{Data:"",BackgroundColor:"#0061FF",BackgroundOpacity:80,BorderColor:"#0061FF",BorderOpacity:80,BorderWidth:0,Enabled:!0,LegendEnabled:!0,LegendLabelColor:"",Name:"Layer 1"},HighlightRules:[],Interpolation:{Interpolation:"Linear",LineTension:0,SteppedLine:"after"},Labels:{Align:"center",Anchor:"center",Color:"#000",Enabled:!1,Font:{Bold:!1,Size:12},Frequency:1,Offset:"0",Rotation:0,Template:"{{x}}, {{toFixed y 2}}"},Line:{DashGap:0,DashWidth:0,FadeToTransparent:!1,Fill:"nofill",ShowLine:!0,SpanGaps:!1},Points:{PointBackgroundColor:"#0061FF",PointBackgroundOpacity:80,PointBorderColor:"#0061FF",PointBorderOpacity:80,PointBorderWidth:0,PointHitRadius:0,PointHoverBackgroundColor:"#0061FF",PointHoverBackgroundOpacity:80,PointHoverBorderColor:"#0061FF",PointHoverBorderOpacity:80,PointHoverBorderWidth:0,PointHoverRadius:0,PointRadius:0,PointStyle:"circle"}}],Legend:{Align:"center",BoxWidth:12,Display:!0,FullWidth:!0,LabelColor:"#F8F8F8",LabelFontFamily:"Helvetica",LabelFontSize:12,LegendScroll:"default",Padding:10,Position:"top-inline",Reverse:!1,UsePointStyle:!0},Overlay:{CrosshairsColor:"#F8F8F8",CrosshairsEnabled:!0,EdgeAlign:!1,Offset:7,PreferIntersect:!1,TooltipBGOpacity:80,TooltipFontSize:12,TooltipsEnabled:!0,TooltipsIntersect:!1,customTooltip:'<table><thead><tr style="padding-right: 10px;"><th>{{ xLabel }} </th><th> </th> </tr></thead><tbody>{{#each points }}{{#if isLayerEnabled}}<tr> <td>{{{svg}}} {{ layerName }}: </td><td style="padding-right: 10px; text-align: left;">{{layerData}}</td></tr>{{/if}}{{/each}}</tbody></table>',useCustomTooltip:!1},Style:{Palette:[{type:"#0061FF"},{type:"#F23A66"},{type:"#009BAB"},{type:"#7647CC"},{type:"#FFC300"},{type:"#9FA3A6"},{type:"#003A99"},{type:"#A90B31"},{type:"#005D67"},{type:"#452481"}]},XAxes:[e.category],YAxes:[t.linear],Zoom:{DefaultMax:"",DefaultMin:"",DragPan:!0,DragZoom:!0,FillColor:"#898989",FillOpacity:50,Max:"",Min:"",ResetViewStateOnly:!1,ScrollZoom:!0,ViewstateUpdateDelay:1,YAdjust:"None",ZoomStack:"",ZoomToIndex:!0},format:{tileBackgroundColor:"#000000",tileBorderColor:"#000000",tileBorderRounding:0,tileBorderWidth:0,tileShadow:!1,tileTransparentBackground:!0,titleBackgroundColor:"",titleBottomBorderWidth:0,titleColor:"",titleFontBold:"",titleFontSize:16,titleHorizontal:"Center",titleShadow:!1,titleTransparentBackground:"",widgetTitle:""},version:"4.7.0"}},k.getDefaultJSONTemplates=function(){var e=T.getJSONTemplateFromSchema(L,"XAxes"),t=T.getJSONTemplateFromSchema(L,"YAxes"),e=T.appendCommonAxesProps(e,"XAxes"),t=T.appendCommonAxesProps(t,"YAxes");return{Defaults:this.getDefaultJSON(),Layers:T.getJSONTemplateFromSchema(L,"Layers"),XAxes:e,YAxes:t}},k.mergeWithDefault=function(e){var i=this.getDefaultJSONTemplates(),t=_.extend({},e),a=_.extend({},i.Defaults);return delete a.version,_.each(e.attributes,function(e,t){_.isArray(e)?"Layers"!==t&&"XAxes"!==t&&"YAxes"!==t||(a[t]=T.mergeArray(_.extend({},e),i,t)):T.mergeDictionary(a,e,t)}),t.set(a,{silent:!0}),t};var M=k;function k(){}M.upgrades=[{fn:function(e){var t=e.get("Basics"),t=(t.Selected=void 0===t.Selected?"":t.Selected,t.Focus=void 0===t.Focus?"":t.Focus,e.set("Basics",t),e.get("XAxes").concat(e.get("YAxes"))),i=(t.forEach(function(e){e.Labels=e.Labels||{},e.Labels.Format="General",e.Labels.Precision=2,e.Labels.DateFormat="YYYY-MM-DD",e.Labels.HideTrailingZeroes=!1,e.Position=e.Position||""}),void 0===e.get("Zoom")&&e.set("Zoom",{Enabled:!1,FillColor:"#898989",FillOpacity:50,Max:"",Min:"",ResetViewStateOnly:!1}),_.each(e.get("Layers"),function(e){e.HighlightRules||(e.HighlightRules=[])}),void 0===e.get("Legend")&&e.set("Legend",{BoxWidth:12,Display:!0,FullWidth:!0,LabelColor:"#F8F8F8",LabelFontFamily:"Helvetica Neue",LabelFontSize:12,LegendScroll:"default",Padding:10,Position:"top",Reverse:!1,UsePointStyle:!0}),t.forEach(function(e){"time"===e._Hidden._Type&&(e.Labels.TimeFormats.Distribution=void 0===e.Labels.TimeFormats.Distribution?"linear":e.Labels.TimeFormats.Distribution,e.Labels.TimeFormats.Year=void 0===e.Labels.TimeFormats.Year?"YYYY":e.Labels.TimeFormats.Year,e.Labels.TimeFormats.Quarter=void 0===e.Labels.TimeFormats.Quarter?"[Q]Q - YYYY":e.Labels.TimeFormats.Quarter,e.Labels.TimeFormats.Month=void 0===e.Labels.TimeFormats.Month?"MMM YYYY":e.Labels.TimeFormats.Month,e.Labels.TimeFormats.Week=void 0===e.Labels.TimeFormats.Week?"ll":e.Labels.TimeFormats.Week,e.Labels.TimeFormats.Day=void 0===e.Labels.TimeFormats.Day?"MMM D":e.Labels.TimeFormats.Day,e.Labels.TimeFormats.Hour=void 0===e.Labels.TimeFormats.Hour?"hA":e.Labels.TimeFormats.Hour,e.Labels.TimeFormats.Minute=void 0===e.Labels.TimeFormats.Minute?"h:mm a":e.Labels.TimeFormats.Minute,e.Labels.TimeFormats.Second=void 0===e.Labels.TimeFormats.Second?"h:mm:ss a":e.Labels.TimeFormats.Second,e.Labels.TimeFormats.Millisecond=void 0===e.Labels.TimeFormats.Millisecond?"h:mm:ss.SSS a":e.Labels.TimeFormats.Millisecond,e.Labels.TimeFormats.TooltipFormat=void 0===e.Labels.TimeFormats.TooltipFormat?"":e.Labels.TimeFormats.TooltipFormat,e.Labels.TimeFormats.IsoWeekday=void 0!==e.Labels.TimeFormats.IsoWeekday&&e.Labels.TimeFormats.IsoWeekday,e.Labels.TimeFormats.Unit=void 0===e.Labels.TimeFormats.Unit?"":e.Labels.TimeFormats.Unit,e.Labels.TimeFormats.Round=void 0!==e.Labels.TimeFormats.Round&&e.Labels.TimeFormats.Round),e.Labels.Prefix=void 0===e.Labels.Prefix?"":e.Labels.Prefix,e.Labels.Suffix=void 0===e.Labels.Suffix?"":e.Labels.Suffix,e.Labels.StepSize=void 0===e.Labels.StepSize?0:e.Labels.StepSize,e.Labels=_.omit(e.Labels,["TimeFormat"])}),e.get("Overlay")),a=(i.CrosshairsEnabled=void 0===i.CrosshairsEnabled||i.CrosshairsEnabled,i.CrosshairsColor=void 0===i.CrosshairsColor?"#F8F8F8":i.CrosshairsColor,i.TooltipsEnabled=void 0===i.TooltipsEnabled||i.TooltipsEnabled,e.set("Overlay",i),e.unset("Tooltips"),e.get("FileExport")),a=(void 0===a?(e.set("FileExport.ShowExportCsvButton",!1),e.set("FileExport.ShowExportExcelButton",!1),e.set("FileExport.FileName",[])):e.set("FileExport",a),void 0===a.ShowScreenshot?e.set("FileExport.ShowScreenshot",!1):e.set("FileExport",a),void 0===e.get("Overlay.customTooltip")&&e.set("Overlay.customTooltip",null),void 0===e.get("Basics.Hover")&&e.set("Basics.Hover",""),void 0===e.get("Style")&&e.set("Style",{Palette:[{type:"#0061FF"},{type:"#F23A66"},{type:"#009BAB"},{type:"#7647CC"},{type:"#FFC300"},{type:"#9FA3A6"},{type:"#003A99"},{type:"#A90B31"},{type:"#005D67"},{type:"#452481"}]}),void 0===e.get("Overlay.useCustomTooltip")&&e.set("Overlay.useCustomTooltip",!1),e.get("Zoom"));void 0===a.YAdjust&&e.set("Zoom.YAdjust","none");void 0===e.get("Zoom.ZoomToIndex")&&e.set("Zoom.ZoomToIndex",!0);var o=e.get("Layers").slice();e.set("Layers",o.reverse());e.get("XAxes").forEach(function(e){e.labels&&!e.Labels.FilterUnique&&(e.Labels.FilterUnique=!1)}),a=e.get("Zoom");o=e.get("Overlay");a.DragZoom=void 0===a.DragZoom?e.get("Zoom.Enabled"):a.DragZoom,a.ScrollZoom=void 0===a.ScrollZoom||a.ScrollZoom,a.DragPan=void 0===a.DragPan||a.DragZoom,a.ViewstateUpdateDelay=void 0===a.ViewstateUpdateDelay?1:a.ViewstateUpdateDelay,e.set("Zoom",a),delete a.Enabled,delete o.TooltipsMode,delete o.TooltipsPosition,(t=e.get("XAxes").concat(e.get("YAxes"))).forEach(function(e){e.Labels.MinRotation=void 0===e.Labels.MinRotation?0:e.Labels.MinRotation,e.Labels.MaxRotation=void 0===e.Labels.MaxRotation?360:e.Labels.MaxRotation}),(t=e.get("XAxes").concat(e.get("YAxes"))).forEach(function(e){e.Labels.MaxWidth=void 0===e.Labels.MaxWidth?0:e.Labels.MaxWidth}),e.get("Overlay.PreferIntersect")||e.set("Overlay.PreferIntersect",!1),(o=e.get("Overlay")).EdgeAlign=void 0!==i.EdgeAlign&&i.EdgeAlign,o.TooltipBGOpacity=void 0===i.TooltipBGOpacity?80:i.TooltipBGOpacity,o.TooltipFontSize=void 0!==i.TooltipFontSize&&i.TooltipFontSize,e.set("Overlay",o),_.each(e.get("Layers"),function(e){e.Basics.Enabled=!0})},version:"4.1.0"},{fn:function(e){var t=e.get("Zoom");void 0===t.DefaultMin&&e.set("Zoom.DefaultMin",""),void 0===t.DefaultMax&&e.set("Zoom.DefaultMax",""),e.unset("Zoom.FocusMin"),e.unset("Zoom.FocusMax")},version:"4.1.1"},{fn:function(e){e.get("XAxes").concat(e.get("YAxes")).forEach(function(e){e.Range&&(e.Range.UseMinMaxReset=void 0===e.Range.UseMinMaxReset||e.Range.UseMinMaxReset)}),void 0===e.get("Animations.HoverEvents")&&e.set("Animations.HoverEvents",!0),void 0===e.get("Overlay.Offset")&&e.set("Overlay.Offset",7);var t=e.get("Layers");_.each(t,function(e){e.Basics.LegendEnabled=!0}),e.set("Layers",t),e.get("Overlay").useCustomTooltip||e.set("Overlay.customTooltip","<table style='{{fontSize}}'><thead><tr style='padding-right: 10px;'> <th>{{ xLabel }} </th><th> </th > </tr></thead> {{#each points }}<tr><td>{{{svg}}} {{ layerName }}: </td><td style='padding-right: 10px; text-align: left;'>{{layerData}}</td > </tr>{{/each}}</table>"),t=e.get("Layers"),_.each(t,function(e){"Candlestick"===e._Hidden._Type&&(e.Basics.BorderWidth=1,e.Basics.BorderColor="#F8F8F8",e.Basics.BorderOpacity=100,delete e.Candlestick.BorderColor)}),e.set("Layers",t),t=e.get("Layers"),_.each(t,function(e){for(var t=0;t<e.HighlightRules.length;t++)e.HighlightRules[t].RuleTarget="*",e.HighlightRules[t].RuleType="discrete"}),e.set("Layers",t)},version:"4.2.0"},{fn:function(i){var e=i.get("Layers");_.each(e,function(e,t){e=e.SelectedObjectRouting;if(!e)return i.set("Layers."+t+".Actions",[]),void i.set("Layers."+t+".SelectedObjectRouting",void 0);e=_.map(e,function(e){return{Current:e.ColumnProperty,Target:e.ViewstateProperty,Trigger:"Click",_Type:"map"}});i.set("Layers."+t+".Actions",e),i.set("Layers."+t+".SelectedObjectRouting",void 0)})},version:"4.3.0"},{fn:function(e){e.get("Animations.Interactionmode")||e.set("Animations.InteractionMode","x")},version:"4.3.1"},{fn:function(o){var e=o.get("Layers"),r=o.get("XAxes.0.Bars"),n=["Bar","BoxPlot","Candlestick","Violin"];_.each(e,function(i){var e,a,t;"Line"===i._Hidden._Type&&(i.Line.DashWidth=void 0===i.Line.DashWidth?0:i.Line.DashWidth,i.Line.DashGap=void 0===i.Line.DashGap?0:i.Line.DashGap),"BoxPlot"===i._Hidden._Type&&(i.Axes.Outliers=void 0===i.Axes.Outliers?i.Axes.Median:i.Axes.Outliers),0<=_.indexOf(n,i._Hidden._Type)&&r&&(e="Bar"===i._Hidden._Type?"Bars":i._Hidden._Type,a=0,_.each(o.get("XAxes"),function(e,t){e._Hidden._Label===i.Axes.XAxisID&&(a=t)}),t=o.get("XAxes."+a+".Bars"),i[e].BarPercentage=void 0===t.BarPercentage?90:t.BarPercentage,i[e].BarThickness=void 0===t.BarThickness?10:t.BarThickness,i[e].BarWidthType=void 0===t.BarWidthType?"percentage":t.BarWidthType,i[e].CategoryPercentage=void 0===t.CategoryPercentage?80:t.CategoryPercentage,i[e].MaxBarThickness=void 0===t.MaxBarThickness?10:t.MaxBarThickness)}),o.set("Layers",e),_.each(o.get("XAxes"),function(e,t){o.unset("XAxes."+t+".Bars")}),_.each(o.get("YAxes"),function(e,t){o.unset("YAxes."+t+".Bars")})},version:"4.5.1.2"},{fn:function(e){var t=e.get("Overlay");"<table style='{{fontSize}}'><thead><tr style='padding-right: 10px;'> <th>{{ xLabel }} </th><th> </th > </tr></thead> {{#each points }}<tr><td>{{{svg}}} {{ layerName }}: </td><td style='padding-right: 10px; text-align: left;'>{{layerData}}</td > </tr>{{/each}}</table>"!==t.customTooltip&&"<table><thead><tr style='padding-right: 10px;'> <th>{{ xLabel }} </th><th> </th > </tr></thead > {{#each points }}<tr><td><svg height='12' width = '12' > <rect style='fill:{{colors.backgroundColor}};stroke-width:3;stroke:{{colors.borderColor}}' height = '12' width = '12' > </rect></svg > {{ layerName }}: </td><td style='padding-right: 10px; text-align: left;'>{{layerData}}</td > </tr>{{/each}}</table>"!==t.customTooltip||(t.customTooltip='<table><thead><tr style="padding-right: 10px;"><th>{{ xLabel }} </th><th> </th> </tr></thead><tbody>{{#each points }}{{#if isLayerEnabled}}<tr> <td>{{{svg}}} {{ layerName }}: </td><td style="padding-right: 10px; text-align: left;">{{layerData}}</td></tr>{{/if}}{{/each}}</tbody></table>'),e.set("Overlay",t)},version:"4.6.0"},{fn:function(e){var t=e.get("Legend");t.Align=void 0===t.Align?"center":t.Align,e.set("Legend",t)},version:"4.6.1"},{fn:function(e){var t=e.get("Legend");t.LegendScroll=!0===t.LegendScroll?"scroll":"default",t.LegendLayerThreshold=_.isNil(t.LegendLayerThreshold)?5:t.LegendLayerThreshold,e.set("Legend",t)},version:"4.6.1.3"},{fn:function(e){e=e.get("XAxes");_.each(e,function(e){0<=["linear","time"].indexOf(_.get(e,"_Hidden._Type"))&&(e.Labels.Offset=void 0!==e.Labels.Offset&&e.Labels.Offset)})},version:"4.6.1.4"},{fn:function(e){e.get("XAxes").concat(e.get("YAxes")).forEach(function(e){"time"===e._Hidden._Type&&(e.Labels.TimeFormats.ShowMajor=void 0!==e.Labels.TimeFormats.ShowMajor&&e.Labels.TimeFormats.ShowMajor)});e=e.get("Layers");_.each(e,function(e){e.Labels.Rotation=_.isNil(e.Labels.Rotation)?0:e.Labels.Rotation,e.Labels.ShowOverlap=!_.isNil(e.Labels.ShowOverlap)&&e.Labels.ShowOverlap})},version:"4.7.0"}];A.app=f.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,a,o){return'<div class="chart-container" oncontextmenu="return false;">\n    <div class="tools-panel">\n        <i class="icons active-mouse pan-tool material-icons hidden1">pan_tool</i>\n        <i class="icons reset-chart active material-icons hidden1" title="Reset Zoom">youtube_searched_for</i>\n        <i class="icons reset-chart-level active material-icons disabled" title="Zoom out" style="display:none;">zoom_out</i>\n        <i class="icons reset-chart-level-in active material-icons disabled" title="Zoom in" style="display:none;">zoom_in</i>\n    </div>\n    <canvas class="chart"></canvas>\n    <canvas class="zoomchart"></canvas>\n    <div class="crosshair"></div>\n    <div class="crosshair-selected"></div>\n</div>\n<div class="highlight-rules-dialog" title="Highlight Rules"></div>\n<div class="chart-legend">\n</div>'},useData:!0}),A.fileExporter=f.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,a,o){var r=null!=t?t:e.nullContext||{},n=e.hooks.helperMissing,s=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="canvasChartpnlButtons">\n    <span class="lnksExport link-disabled">\n        <i class="fa fa-fw fa-download" title="'+s((e(i,"t")||t&&e(t,"t")||n).call(r,"Data",{name:"t",hash:{},data:o,loc:{start:{line:3,column:47},end:{line:3,column:59}}}))+'"></i>\n        <a class="lnkExcelExport" title="'+s((e(i,"t")||t&&e(t,"t")||n).call(r,"Download the current dataset in Excel format",{name:"t",hash:{},data:o,loc:{start:{line:4,column:41},end:{line:4,column:93}}}))+'">'+s((e(i,"t")||t&&e(t,"t")||n).call(r,"Excel",{name:"t",hash:{},data:o,loc:{start:{line:4,column:95},end:{line:4,column:108}}}))+'</a>\n        <a class="lnkCsvExport" title="'+s((e(i,"t")||t&&e(t,"t")||n).call(r,"Download the current dataset in CSV format",{name:"t",hash:{},data:o,loc:{start:{line:5,column:39},end:{line:5,column:89}}}))+'">'+s((e(i,"t")||t&&e(t,"t")||n).call(r,"CSV",{name:"t",hash:{},data:o,loc:{start:{line:5,column:91},end:{line:5,column:102}}}))+'</a>\n        <a class="lnkDownloadScreenshot" title="'+s((e(i,"t")||t&&e(t,"t")||n).call(r,"Download a PNG image of the chart",{name:"t",hash:{},data:o,loc:{start:{line:6,column:48},end:{line:6,column:89}}}))+'">'+s((e(i,"t")||t&&e(t,"t")||n).call(r,"PNG",{name:"t",hash:{},data:o,loc:{start:{line:6,column:91},end:{line:6,column:102}}}))+"</a>\n    </span> \n</div> \n"},useData:!0}),A.highlighRule=f.template({1:function(e,t,i,a,o){var r,n=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,l="function",d=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="highlightRule-menu-item">\n    <svg>\n        <rect x="2" y="5" width="10" height="10" stroke="'+d(typeof(r=null!=(r=e(i,"ruleBorder")||(null!=t?e(t,"ruleBorder"):t))?r:s)==l?r.call(n,{name:"ruleBorder",hash:{},data:o,loc:{start:{line:4,column:57},end:{line:4,column:71}}}):r)+'" fill="'+d(typeof(r=null!=(r=e(i,"ruleColor")||(null!=t?e(t,"ruleColor"):t))?r:s)==l?r.call(n,{name:"ruleColor",hash:{},data:o,loc:{start:{line:4,column:79},end:{line:4,column:92}}}):r)+'" stroke-width="2"></rect>\n    </svg>\n    <span>'+d(typeof(r=null!=(r=e(i,"ruleName")||(null!=t?e(t,"ruleName"):t))?r:s)==l?r.call(n,{name:"ruleName",hash:{},data:o,loc:{start:{line:6,column:10},end:{line:6,column:22}}}):r)+"</span>\n</div>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,i,a,o){return null!=(i=(e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]})(i,"each").call(null!=t?t:e.nullContext||{},t,{name:"each",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o,loc:{start:{line:1,column:0},end:{line:8,column:9}}}))?i:""},useData:!0}),A.htmlLegend=f.template({1:function(e,t,i,a,o){var r,n=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,l="function",d=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="legendItem '+d(typeof(r=null!=(r=e(i,"class")||(null!=t?e(t,"class"):t))?r:s)==l?r.call(n,{name:"class",hash:{},data:o,loc:{start:{line:2,column:23},end:{line:2,column:32}}}):r)+'">\n    <div class="legendIcon">\n        <svg height="'+d(typeof(r=null!=(r=e(i,"width")||(null!=t?e(t,"width"):t))?r:s)==l?r.call(n,{name:"width",hash:{},data:o,loc:{start:{line:4,column:21},end:{line:4,column:30}}}):r)+'" width="'+d(typeof(r=null!=(r=e(i,"width")||(null!=t?e(t,"width"):t))?r:s)==l?r.call(n,{name:"width",hash:{},data:o,loc:{start:{line:4,column:39},end:{line:4,column:48}}}):r)+'" style="margin-left:'+d(typeof(r=null!=(r=e(i,"margin")||(null!=t?e(t,"margin"):t))?r:s)==l?r.call(n,{name:"margin",hash:{},data:o,loc:{start:{line:4,column:69},end:{line:4,column:79}}}):r)+"px; margin-right:"+d(typeof(r=null!=(r=e(i,"margin")||(null!=t?e(t,"margin"):t))?r:s)==l?r.call(n,{name:"margin",hash:{},data:o,loc:{start:{line:4,column:96},end:{line:4,column:106}}}):r)+'px;">\n            <circle cx="'+d(typeof(r=null!=(r=e(i,"cntr")||(null!=t?e(t,"cntr"):t))?r:s)==l?r.call(n,{name:"cntr",hash:{},data:o,loc:{start:{line:5,column:24},end:{line:5,column:32}}}):r)+'" cy="'+d(typeof(r=null!=(r=e(i,"cntr")||(null!=t?e(t,"cntr"):t))?r:s)==l?r.call(n,{name:"cntr",hash:{},data:o,loc:{start:{line:5,column:38},end:{line:5,column:46}}}):r)+'" r="'+d(typeof(r=null!=(r=e(i,"radius")||(null!=t?e(t,"radius"):t))?r:s)==l?r.call(n,{name:"radius",hash:{},data:o,loc:{start:{line:5,column:51},end:{line:5,column:61}}}):r)+'" stroke="'+d(typeof(r=null!=(r=e(i,"fillStyle")||(null!=t?e(t,"fillStyle"):t))?r:s)==l?r.call(n,{name:"fillStyle",hash:{},data:o,loc:{start:{line:5,column:71},end:{line:5,column:84}}}):r)+'" stroke-width="" fill="'+d(typeof(r=null!=(r=e(i,"fillStyle")||(null!=t?e(t,"fillStyle"):t))?r:s)==l?r.call(n,{name:"fillStyle",hash:{},data:o,loc:{start:{line:5,column:108},end:{line:5,column:121}}}):r)+'" />\n        </svg>\n    </div>\n    <div class="legendText" style="width:'+d(typeof(r=null!=(r=e(i,"lblWidth")||(null!=t?e(t,"lblWidth"):t))?r:s)==l?r.call(n,{name:"lblWidth",hash:{},data:o,loc:{start:{line:8,column:41},end:{line:8,column:53}}}):r)+'px;">'+d(typeof(r=null!=(r=e(i,"text")||(null!=t?e(t,"text"):t))?r:s)==l?r.call(n,{name:"text",hash:{},data:o,loc:{start:{line:8,column:58},end:{line:8,column:66}}}):r)+"</div> \n</div>\n"},3:function(e,t,i,a,o){var r,n=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,l="function",d=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="legendItem '+d(typeof(r=null!=(r=e(i,"class")||(null!=t?e(t,"class"):t))?r:s)==l?r.call(n,{name:"class",hash:{},data:o,loc:{start:{line:12,column:23},end:{line:12,column:32}}}):r)+'">\n    <div class="legendIcon">\n        <svg height="'+d(typeof(r=null!=(r=e(i,"width")||(null!=t?e(t,"width"):t))?r:s)==l?r.call(n,{name:"width",hash:{},data:o,loc:{start:{line:14,column:21},end:{line:14,column:30}}}):r)+'" width="'+d(typeof(r=null!=(r=e(i,"width")||(null!=t?e(t,"width"):t))?r:s)==l?r.call(n,{name:"width",hash:{},data:o,loc:{start:{line:14,column:39},end:{line:14,column:48}}}):r)+'" style="margin-left:'+d(typeof(r=null!=(r=e(i,"margin")||(null!=t?e(t,"margin"):t))?r:s)==l?r.call(n,{name:"margin",hash:{},data:o,loc:{start:{line:14,column:69},end:{line:14,column:79}}}):r)+"px; margin-right:"+d(typeof(r=null!=(r=e(i,"margin")||(null!=t?e(t,"margin"):t))?r:s)==l?r.call(n,{name:"margin",hash:{},data:o,loc:{start:{line:14,column:96},end:{line:14,column:106}}}):r)+'px;">\n            <rect height="'+d(typeof(r=null!=(r=e(i,"width")||(null!=t?e(t,"width"):t))?r:s)==l?r.call(n,{name:"width",hash:{},data:o,loc:{start:{line:15,column:26},end:{line:15,column:35}}}):r)+'" width="'+d(typeof(r=null!=(r=e(i,"width")||(null!=t?e(t,"width"):t))?r:s)==l?r.call(n,{name:"width",hash:{},data:o,loc:{start:{line:15,column:44},end:{line:15,column:53}}}):r)+'" stroke="'+d(typeof(r=null!=(r=e(i,"fillStyle")||(null!=t?e(t,"fillStyle"):t))?r:s)==l?r.call(n,{name:"fillStyle",hash:{},data:o,loc:{start:{line:15,column:63},end:{line:15,column:76}}}):r)+'" stroke-width="1" fill="'+d(typeof(r=null!=(r=e(i,"fillStyle")||(null!=t?e(t,"fillStyle"):t))?r:s)==l?r.call(n,{name:"fillStyle",hash:{},data:o,loc:{start:{line:15,column:101},end:{line:15,column:114}}}):r)+'" />\n        </svg>\n    </div>\n    <div class="legendText" style="width:'+d(typeof(r=null!=(r=e(i,"lblWidth")||(null!=t?e(t,"lblWidth"):t))?r:s)==l?r.call(n,{name:"lblWidth",hash:{},data:o,loc:{start:{line:18,column:41},end:{line:18,column:53}}}):r)+'px;">'+d(typeof(r=null!=(r=e(i,"text")||(null!=t?e(t,"text"):t))?r:s)==l?r.call(n,{name:"text",hash:{},data:o,loc:{start:{line:18,column:58},end:{line:18,column:66}}}):r)+"</div>\n</div>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,i,a,o){var r,n=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(r=s(i,"if").call(n,null!=t?s(t,"circle"):t,{name:"if",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o,loc:{start:{line:1,column:0},end:{line:10,column:7}}}))?r:"")+(null!=(r=s(i,"if").call(n,null!=t?s(t,"rect"):t,{name:"if",hash:{},fn:e.program(3,o,0),inverse:e.noop,data:o,loc:{start:{line:11,column:0},end:{line:20,column:7}}}))?r:"")+" "},useData:!0}),A.tooltip=f.template({1:function(e,t,i,a,o){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return" \n"+(null!=(i=r(i,"if").call(null!=t?t:e.nullContext||{},null!=t?r(t,"isLayerEnabled"):t,{name:"if",hash:{},fn:e.program(2,o,0),inverse:e.noop,data:o,loc:{start:{line:8,column:4},end:{line:18,column:11}}}))?i:"")},2:function(e,t,i,a,o){var r,n,s=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,d="function",c=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"    <tr>\n        <td> \n            "+(null!=(r=typeof(n=null!=(n=e(i,"svg")||(null!=t?e(t,"svg"):t))?n:l)==d?n.call(s,{name:"svg",hash:{},data:o,loc:{start:{line:11,column:12},end:{line:11,column:21}}}):n)?r:"")+"\n            "+c(typeof(n=null!=(n=e(i,"layerName")||(null!=t?e(t,"layerName"):t))?n:l)==d?n.call(s,{name:"layerName",hash:{},data:o,loc:{start:{line:12,column:12},end:{line:12,column:25}}}):n)+': \n        </td>\n        <td style="padding-right: 10px; text-align: left;">\n            '+c(typeof(n=null!=(n=e(i,"layerDataFormatted")||(null!=t?e(t,"layerDataFormatted"):t))?n:l)==d?n.call(s,{name:"layerDataFormatted",hash:{},data:o,loc:{start:{line:15,column:12},end:{line:15,column:34}}}):n)+"\n        </td>\n    </tr> \n"},compiler:[8,">= 4.3.0"],main:function(e,t,i,a,o){var r,n=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,l="function",d=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<table style="'+d(typeof(r=null!=(r=c(i,"fontSize")||(null!=t?c(t,"fontSize"):t))?r:s)==l?r.call(n,{name:"fontSize",hash:{},data:o,loc:{start:{line:1,column:14},end:{line:1,column:26}}}):r)+'">\n    <thead>\n        <tr style="padding-right: 10px;">\n            <th> '+d(typeof(r=null!=(r=c(i,"xLabel")||(null!=t?c(t,"xLabel"):t))?r:s)==l?r.call(n,{name:"xLabel",hash:{},data:o,loc:{start:{line:4,column:17},end:{line:4,column:27}}}):r)+" </th>\n            <th> </th>\n        </tr>\n    </thead> "+(null!=(d=c(i,"each").call(n,null!=t?c(t,"points"):t,{name:"each",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o,loc:{start:{line:7,column:13},end:{line:19,column:13}}}))?d:"")+"</table>"},useData:!0});var le=A;function A(){}O.getConfig=function(p){var g=this,e={".csv":"Csv",".xlsx":"Excel"}[p.fileFormat],m={configSets:{},fileFormat:p.fileFormat,fileName:y.ExportTools.getExportFileName(p.fileName,"",e),workSheetTitle:p.workSheetTitle},f=$.extend(!0,{},this.mapAxisConfigs(p.columnsConfig.xAxes),this.mapAxisConfigs(p.columnsConfig.yAxes));return p.columnsConfig.layers.models.length&&_.each(p.columnsConfig.layers.models,function(t){var o,e,i,a,r,n,s,l,d,c,u=t.get("Basics.Data").cid,h=p.columnsConfig.dataSources[u];h&&(m.configSets[u]||(m.configSets[u]={dataSet:h.getData().toJSON(),metaData:[]}),o=h.getColumnNames(),e=void 0,m.configSets[u].metaData.length||(e={axisId:t.get("Axes.XAxisID"),colId:t.get("Axes.XAxisData")}),i={axisId:t.get("Axes.YAxisID"),colId:t.get("Axes.YAxisData"),colName:t.get("Basics.Name")},a={axisId:"",colId:t.get("Axes.Radius")},r=[],["Close","High","Low","Open","Q1","Q3","Min","Max"].forEach(function(e){r.push({axisId:t.get("Axes.YAxisID"),colId:t.get("Axes."+e)})}),c=/\/[gimsuy]*$/,s=void 0,l="",0===(n=t.get("Axes.YAxisData")).indexOf("/")?(s=n.substring(1).replace(c,""),l=(c=n.match(c))?c[0].substring(1):""):s="^"+(n=n.replace(/[\-\[\]\/\{\}\(\)\+\?\.\\\^\$\|]/g,"\\$&")).replace(/\*/g,"(.*)")+"$",d=new RegExp(s,l),_.each(o.filter(function(e){return e.match(d)}),function(e){r.push({axisId:t.get("Axes.YAxisID"),colId:e,colName:e})}),c=[e,i,a].concat(r),_.each(c,function(e){var i,t,a;_.get(e,"colId")&&_.isString(e.colId)&&(i=y.ExportTools.regExValidateColumnIDs(e.colId,o),t=e.axisId?f[e.axisId]:null,e=e.colName&&1===i.length?e.colName:"",h.breakdownColumns.length&&(a=h.breakdownColumns[h.getDepth()],_.each(i,function(e,t){"{breakdownId}"===e&&(i[t]=a)})),m.configSets[u].metaData=m.configSets[u].metaData.concat(g.getExportMetaData({colFormats:t,colIds:i,colName:e,getColumnType:_.bind(h.getColumnType.bind(h),h)})))})),m.configSets[u].metaData=_.uniqBy(m.configSets[u].metaData,function(e){return e.colId})}),m},O.mapAxisConfigs=function(e){var t={};return e.each(function(e){t[e.get("_Hidden._Label")]=e}),t},O.getExportMetaData=function(a){var o=this,e=a.colFormats,t=!e||e.get("Display"),r=e?e.get("_Hidden._Type"):"linear",n="",s="",l=e&&e.get("Labels.Precision")?e.get("Labels.Precision"):0,d=e?e.get("Labels.Format"):"",c="",u=!1,h=[];return t&&("time"===r?(d="Time",c=e.get("Labels.TimeFormats")):(n=e?e.get("Labels.Prefix"):"",s=e?e.get("Labels.Suffix"):"","Datetime"===d?c=e.get("Labels.DateFormat")||"":"General"!==d&&(u=!!e&&e.get("Labels.HideTrailingZeroes"))),_.each(a.colIds,function(e){var t=a.getColumnType(e),t=o.resolveColumnTypeAndFormat(r,d,c,l,t),i=(("Number"===t.dataType&&n||s)&&(t.dataType="String"),{});i.colId=e,i.colName=a.colName||e,i.dataType=t.dataType,i.dataKdbType=t.dataKdbType,i.dataFormat=t.dataFormat,i.hideTrailingZeroes=u,i.prefix=n,i.suffix=s,h.push(i)})),h},O.resolveColumnTypeAndFormat=function(e,t,i,a,o){var r=11<o&&o<20,n=a?"."+Array(a+1).join("0"):"",s={12:"DateTime",13:"Date",14:"Date",15:"DateTime",16:"Time",17:"Time",18:"Time",19:"Time"}[o];switch(a=this.getValidPrecission(Number(a)),(3===o||o<1||19<o)&&(o=11,i="TO_STRING",t="String"),t||(1===o?t="Boolean":1<o&&o<10?(t="Number",o<8&&(i="#0")):t="String"),t){case"Number":i="linear"===e||"logarithmic"===e?"#0"+n:"";break;case"Formatted Number":case"Smart Number":"linear"===e||"logarithmic"===e?(i="Formatted Number"===t?"#,##0"+n:r?"SmartNumber":"SmartNumber"+n,t="Number"):(t="String",i="");break;case"Datetime":var l=y.ExportTools.getTemporalTypeFromFormat(i),d=!!/[M,Y,D,d,Q]/.test(i),c=!!/[H,h,k,m,S,s]/.test(i);"category"===e&&s?"Time"===(t=s)&&"Time"!==l&&(i=d&&c&&i.split(" ").pop()||""):(t=l,i=_.get(y.ExportTools.CHARTS_DATE_FORMAT_MAP,i)),i=r?i||"":(t="String","");break;case"Time":i=r?this.resolveAxisTimeType(i):(t="String","");break;default:t="linear"!==e&&"logarithmic"!==e||!r?"String":"Number",i=""}return{dataFormat:i,dataKdbType:o,dataType:t=1===o?"Boolean":t}},O.resolveAxisTimeType=function(e){var t="",i={"":"",day:"Day",hour:"Hour",millisecond:"Millisecond",minute:"Minute",month:"Month",quarter:"Quarter",second:"Second",week:"Week",year:"Year"}[e.Unit];return i&&_.isString(t)?t=e[i]:""===i&&(t="TO_STRING"),t},O.getValidPrecission=function(e){e=void 0!==e?e:0;return e<0?e=0:10<e&&(e=10),e};var de=O;function O(){}ce=r.View,e(P,ce),P.prototype.remove=function(){return this.$lnkCsvExport&&this.$lnkCsvExport.off(),this.$lnkExcelExport&&this.$lnkExcelExport.off(),this.$lnkDownloadScreenshot&&this.$lnkDownloadScreenshot.off(),this.stopListening(),r.View.prototype.remove.apply(this)},P.prototype.initializeEvents=function(){this.listenTo(this.model,"change",this.displayChoiceLinkButtons.bind(this)),this.$lnkCsvExport&&this.$lnkExcelExport&&this.$lnkDownloadScreenshot&&(this.$lnkCsvExport.click(_.bind(this.fileExport.bind(this),this,".csv")),this.$lnkExcelExport.click(_.bind(this.fileExport.bind(this),this,".xlsx")),this.$lnkDownloadScreenshot.click(_.bind(this.downloadImage.bind(this),this,".png")))},P.prototype.displayChoiceLinkButtons=function(){var e=this.model.get("FileExport");!e||_.keys(e).length<5||(e.ShowExportCsvButton||e.ShowExportExcelButton||e.ShowScreenshot?(this.$lnkCsvExport&&this.$lnkExcelExport&&this.$lnkDownloadScreenshot&&this.$lnksExport&&(this.$lnksExport.removeClass("link-disabled"),this.$lnkCsvExport.toggleClass("link-disabled",!e.ShowExportCsvButton),this.$lnkExcelExport.toggleClass("link-disabled",!e.ShowExportExcelButton),this.$lnkDownloadScreenshot.toggleClass("link-disabled",!e.ShowScreenshot)),this.$chartContainer.toggleClass("links-enabled",!this.$chartContainer.hasClass("links-enabled")),e.Enabled||this.model.set("FileExport.Enabled",!0)):(this.$lnksExport&&this.$lnksExport.addClass("link-disabled"),this.$chartContainer.removeClass("links-enabled"),e.Enabled&&this.model.set("FileExport.Enabled",!1)))},P.prototype.downloadImage=function(e){var i=("string"==typeof(i=y.ExportTools.getExportFileName(this.getExportConfig().fileName,"","Screenshot"))?i:"Screenshot")+e;this.generateImage(function(e,t){B.fileSave(i,e,t)})},P.prototype.fileExport=function(e){var t=y.ExportTools,e=de.getConfig(_.extend(this.getExportConfig(),{fileFormat:e}));t.openFileExportDialog(e)},P.prototype.generateImage=function(n){var s=this,l=this.$chartContainer.closest(".border-div").get(0),d=l.getElementsByClassName("tools-panel")[0];_.set(d,"style.display","none"),html2canvas(l,{onrendered:function(e){var t="Light"===s.getTheme()?"#F8F8F8":"#282828",i=l.clientHeight,a=l.clientWidth,o=document.createElement("canvas"),r=(o.width=a,o.height=i,o.getContext("2d"));r.fillStyle=t,r.fillRect(0,0,a,i),r.drawImage(e,0,0),_.set(d,"style.display",""),s.isIE?(t=o.toDataURL("image/png"),n(B.convertDataUrlToBlob(t),"image/png")):r.canvas.toBlob(function(e){n(e,"application/octet-stream")})}})},P.prototype.getTheme=function(){return this.appView.dashboardViewModel.get("DashboardTheme")},P.prototype.renderLinks=function(){this.$lnksExport=this.$el.find(".lnksExport"),this.$lnkCsvExport=this.$el.find("a.lnkCsvExport"),this.$lnkExcelExport=this.$el.find("a.lnkExcelExport"),this.$lnkDownloadScreenshot=this.$el.find("a.lnkDownloadScreenshot")};var ce,ue,w,I,he=P;function P(e){var t=ce.call(this,e)||this;return t.getCanvas=e.getCanvas,t.appView=e.appView,t.getExportConfig=e.getExportConfig,t.isIE=!1,HTMLCanvasElement&&HTMLCanvasElement.prototype&&_.get(HTMLCanvasElement.prototype,"msToBlob")&&(t.isIE=!0),t.$chartContainer=t.appView.$el.find(".chart-container"),t.render(),t.renderLinks(),t.initializeEvents(),t}function pe(e){return null===e?NaN:+e}function ge(e){return 1/Math.sqrt(2*Math.PI)*Math.exp(-.5*e*e)}function me(e){var t=e.length;if(t<1)return NaN;if(1===t)return 0;for(var i=function(e){var t=e.length;if(0===t)return NaN;for(var i=0,a=-1;++a<t;)i+=(e[a]-i)/(a+1);return i}(e),a=-1,o=0;++a<t;){var r=e[a]-i;o+=r*r}return o/(t-1)}function fe(e,t){return e-t}function ye(e){t=[.25,.75],o=(a=(a=e).slice().sort(fe)).length-1;var a,t,o,e=t.map(function(e){if(0===e)return a[0];if(1===e)return a[o];var e=1+e*o,t=Math.floor(e),e=e-t,i=a[t-1];return 0==e?i:i+e*(a[t]-i)});return e[1]-e[0]}function xe(e){var t=ye(e)/1.34;return 1.06*Math.min(Math.sqrt(me(e)),t)*Math.pow(e.length,-.2)}function be(e){if(0===e.length)return{outliers:[]};(e=e.filter(function(e){return"number"==typeof e&&!isNaN(e)})).sort(function(e,t){return e-t});var r,n,i,t=ue(e);return{min:t[0],max:t[1],median:w(e,.5),kde:(r=ge,n=[],i=xe,(a.sample=function(e){return arguments.length?(n=e,a):n})(e))};function a(e,t){var o=i.call(this,n);return e.map(function(e){for(var t=-1,i=0,a=n.length;++t<a;)i+=r((e-n[t])/o);return[e,i/o/a]})}}function ve(e){if(!_.isNil(e.median))return void 0!==e.median&&void 0!==e.q1&&void 0!==e.q3?e:Array.isArray(e)?e.__stats||e:void 0}function _e(e){if(!e)return e;if("number"==typeof e||"string"==typeof e)return Number(e);var t=ve(e);return t?t.median:e}function Se(a){var o=this,r=this.recalibrate,n=this.chart,s=this.isHorizontal();this.min=null,this.max=null,n.data.datasets.forEach(function(e,t){var i=n.getDatasetMeta(t);n.isDatasetVisible(t)&&(t=i,s?t.xAxisID===o.id:t.yAxisID===o.id)&&e.data.forEach(function(e,t){r&&(i.data[t]._view.x>r[1]||i.data[t]._view.x<r[0])||e&&!i.data[t].hidden&&(e="number"==typeof(t=e).min&&"number"==typeof t.max?t:"string"==typeof t.min?{median:parseFloat(t.median),q1:parseFloat(t.q1),q3:parseFloat(t.q3),min:parseFloat(t.min),max:parseFloat(t.max),x:t.x}:Array.isArray(t)?ve(t):void 0)&&((null===o.min||e.min<o.min)&&(o.min=e.min),(null===o.max||e.max>o.max)&&(o.max=e.max),a&&a(e))})})}ue=function(e,t){var i,a,o,r=e.length,n=-1;if(null==t){for(;++n<r;)if(null!=(i=e[n])&&i<=i)for(a=o=i;++n<r;)null!=(i=e[n])&&(i<a&&(a=i),o<i&&(o=i))}else for(;++n<r;)if(null!=(i=t(e[n],n,e))&&i<=i)for(a=o=i;++n<r;)null!=(i=t(e[n],n,e))&&(i<a&&(a=i),o<i&&(o=i));return[a,o]},w=function(e,t,i){_.isNil(i)&&(i=pe);i=e.sort(function(e,t){return e-t}),e=(i.length-1)*t,t=Math.floor(e);return void 0!==i[t+1]?i[t]+(e-t)*(i[t+1]-i[t]):i[t]},b=_.extend({},E.defaults.global.elements.rectangle,{borderWidth:1,outlierRadius:2,itemRadius:2,itemStyle:"circle",itemBackgroundColor:E.defaults.global.elements.rectangle.backgroundColor,itemBorderColor:E.defaults.global.elements.rectangle.borderColor}),C=E.Element.extend({isVertical:function(){return void 0!==this._view.width},draw:function(){},_drawItems:function(t,e,i,a){var o,r,n,s,l;t.itemRadius<=0||!e.items||e.items.length<=0||(i.save(),i.strokeStle=t.itemBorderColor,i.fillStyle=t.itemBackgroundColor,void 0===(r=e.median)&&(r=Date.now()),o=function(){return(r=(9301*r+49297)%233280)/233280},n=t.itemRadius,a&&(s=t.x,l=t.width,e.items.forEach(function(e){E.canvasHelpers.drawPoint(i,t.itemStyle,n,s-l/2+o()*l,e)})),i.restore())},_drawOutliers:function(e,t,i,a){var o,r;t.outliers&&(o=e.outlierRadius,i.beginPath(),a&&(r=e.x,t.outliers.forEach(function(e){i.arc(r,e,o,0,2*Math.PI)})),i.fill(),i.closePath())},_getBounds:function(){return{left:0,top:0,right:0,bottom:0}},height:function(){return 0},inRange:function(e,t){if(!this._view)return!1;var i=this._getBounds();return e>=i.left&&e<=i.right&&t>=i.top&&t<=i.bottom},inXRange:function(e){var t=this._getBounds();return e>=t.left&&e<=t.right},inYRange:function(e){var t=this._getBounds();return e>=t.top&&e<=t.bottom},getCenterPoint:function(){var e=this._view;return{x:e.x,y:e.y}}}),E.defaults.global.elements.boxandwhiskers=_.extend({},b),E.elements.BoxAndWhiskers=C.extend({transition:function(e){var t=E.Element.prototype.transition.call(this,e),i=this._model,a=this._start,o=this._view;return i&&1!==e&&null!=a.boxplot&&(i.boxplot===o.boxplot&&(o.boxplot=E.helpers.clone(o.boxplot)),transitionBoxPlot(a.boxplot,o.boxplot,i.boxplot,e)),t},draw:function(){var e=this._chart.ctx,t=this._view,i=t.boxplot,a=this.isVertical();e.save(),e.fillStyle=t.backgroundColor,e.strokeStyle=t.borderColor,e.lineWidth=t.borderWidth,this._drawBoxPlot(t,i,e,a),this._drawOutliers(t,i,e,a),e.restore(),this._drawItems(t,i,e,a)},_drawBoxPlot:function(e,t,i,a){this._drawBoxPlotVert(e,t,i)},_drawBoxPlotVert:function(e,t,i){var a=e.x,e=e.width,o=a-e/2;t.q3>t.q1?i.fillRect(o,t.q1,e,t.q3-t.q1):i.fillRect(o,t.q3,e,t.q1-t.q3),i.save(),i.beginPath(),i.moveTo(o,t.median),i.lineTo(o+e,t.median),i.closePath(),i.stroke(),i.restore(),t.q3>t.q1?i.strokeRect(o,t.q1,e,t.q3-t.q1):i.strokeRect(o,t.q3,e,t.q1-t.q3),i.beginPath(),i.moveTo(o,t.whiskerMin),i.lineTo(o+e,t.whiskerMin),i.moveTo(a,t.whiskerMin),i.lineTo(a,t.q1),i.moveTo(o,t.whiskerMax),i.lineTo(o+e,t.whiskerMax),i.moveTo(a,t.whiskerMax),i.lineTo(a,t.q3),i.closePath(),i.stroke()},_getBounds:function(){var e=this._view,t=e.boxplot;if(!t)return{left:0,top:0,right:0,bottom:0};var i=e.y,e=e.height,i=i-e/2;return{left:t.whiskerMin,top:i,right:t.whiskerMax,bottom:i+e}}}),E.defaults.global.elements.violin=_.extend({points:100},b),E.elements.Violin=C.extend({draw:function(){var i,a,o=this._chart.ctx,e=this._view,t=e.violin,r=this.isVertical(),n=(this._drawItems(e,t,o,r),o.save(),o.fillStyle=e.backgroundColor,o.strokeStyle=e.borderColor,o.lineWidth=e.borderWidth,t.coords);E.canvasHelpers.drawPoint(o,"rectRot",5,e.x,e.violin.median);o.stroke(),o.beginPath(),r&&(i=e.x,a=e.width/2/t.maxEstimate,o.moveTo(i,t.min),n.forEach(function(e){var t=e.v,e=e.estimate;o.lineTo(i-e*a,t)}),o.lineTo(i,t.max),o.moveTo(i,t.min),n.forEach(function(e){var t=e.v,e=e.estimate;o.lineTo(i+e*a,t)}),o.lineTo(i,t.max)),o.stroke(),o.fill(),o.closePath(),this._drawOutliers(e,t,o,r),o.restore()},_getBounds:function(){var e=this._view,t=e.violin,i=e.y,e=e.height,i=i-e/2;return{left:t.min,top:i,right:t.max,bottom:i+e}}}),b={scales:{yAxes:[{type:"arrayLinear"}]}},C={_elementOptions:function(){return{}},updateElement:function(t,i,e){var a=this.getDataset(),o=t.custom||{},r=this._elementOptions();E.controllers.bar.prototype.updateElement.call(this,t,i,e),["outlierRadius","itemRadius","itemStyle","itemBackgroundColor","itemBorderColor"].forEach(function(e){t._model[e]=void 0!==o[e]?o[e]:E.helpers.valueAtIndexOrDefault(a[e],i,r[e])})},_calculateCommonModel:function(e,t,i,a){i.outliers&&(e.outliers=i.outliers.map(function(e){return a.getPixelForValue(Number(e))})),Array.isArray(t)&&(e.items=t.map(function(e){return a.getPixelForValue(Number(e))}))}},E.defaults.boxplot=E.helpers.merge({},[E.defaults.bar,b,{tooltips:{callbacks:{label:function(e){return e}}}}]),v=_.extend({},C,{dataElementType:E.elements.BoxAndWhiskers,_elementOptions:function(){return this.chart.options.elements.boxandwhiskers},_updateElementGeometry:function(e,t,i,a){E.controllers.bar.prototype._updateElementGeometry.call(this,e,t,i,a),e._model.boxplot=this._calculateBoxPlotValuesPixels(this.index,t)},_calculateBoxPlotValuesPixels:function(e,t){var i=this._getValueScale(),e=this.chart.data.datasets[e].data[t],a=ve(e),o={};return a&&(Object.keys(a).forEach(function(e){"outliers"!==e&&(o[e]=i.getPixelForValue(Number(a[e])))}),this._calculateCommonModel(o,e,a,i)),o}}),E.controllers.boxplot=E.controllers.bar.extend(v),E.defaults.violin=E.helpers.merge({},[E.defaults.bar,b,{}]),v=_.extend({},C,{dataElementType:E.elements.Violin,_elementOptions:function(){return this.chart.options.elements.violin},_updateElementGeometry:function(e,t,i,a){E.controllers.bar.prototype._updateElementGeometry.call(this,e,t,i,a);i=e.custom||{},a=this._elementOptions();e._model.violin=this._calculateViolinValuesPixels(this.index,t,(void 0!==i.points?i:a).points)},_calculateViolinValuesPixels:function(e,t,i){var a=this._getValueScale(),e=this.chart.data.datasets[e].data[t].data,t=(void 0===(t=e).__kde&&(t.__kde=be(t)),t.__kde),o=(Array.isArray(e)&&(t.min=_.min(e),t.q1=w(e,.25),t.median=w(e,.5),t.q3=w(e,.75),t.max=_.max(e)),t.max-t.min),o=function(e,t,i){e=+e,t=+t,i=(o=arguments.length)<2?(t=e,e=0,1):o<3?1:+i;for(var a=-1,o=0|Math.max(0,Math.ceil((t-e)/i)),r=new Array(o);++a<o;)r[a]=e+a*i;return r}(t.min,t.max,o/i),i=(o[o.length-1]!==t.max&&o.push(t.max),t.coords||t.kde(o).map(function(e){return{v:e[0],estimate:e[1]}})),o={min:a.getPixelForValue(t.min),max:a.getPixelForValue(t.max),median:a.getPixelForValue(t.median),coords:i.map(function(e){var t=e.v,e=e.estimate;return{v:a.getPixelForValue(t),estimate:e}}),maxEstimate:function(e,t){var i,a,o=e.length,r=-1;if(null==t){for(;++r<o;)if(null!=(i=e[r])&&i<=i)for(a=i;++r<o;)null!=(i=e[r])&&a<i&&(a=i)}else for(;++r<o;)if(null!=(i=t(e[r],r,e))&&i<=i)for(a=i;++r<o;)null!=(i=t(e[r],r,e))&&a<i&&(a=i);return a}(i,function(e){return e.estimate})};return this._calculateCommonModel(o,e,t,a),o}}),E.controllers.violin=E.controllers.bar.extend(v),b=E.scaleService.getScaleConstructor("linear").extend({getRightValue:function(e){return E.LinearScaleBase.prototype.getRightValue.call(this,_e(e))},determineDataLimits:function(){var e,t,i,a=this.recalibrate,o=(Se.call(this),this.min&&this.max&&(this.max,this.min),this),r=o.options,n=o.chart,s=n.data,l=n.config.panModel,d=!a&&l&&l.get("YAdjust")&&"none"!=l.get("YAdjust").toLowerCase()?l.zoomObj:void 0,c=(d&&d.min&&d.min.isValid&&d.max&&d.max.isValid&&(d.min.isValid()&&d.max.isValid()||(d=void 0)),s.datasets),u=o.isHorizontal(),a=E.helpers,h=o._getMatchingVisibleMetas(),p={},g=h.length;o.min=null,o.max=null;var m=r.stacked;if(void 0===m&&a.each(c,function(e,t){var i;m||(i=n.getDatasetMeta(t),n.isDatasetVisible(t)&&(t=i,u?t.xAxisID===o.id:t.yAxisID===o.id)&&void 0!==i.stack&&(m=!0))}),void 0===m)for(e=0;!m&&e<g;++e)t=h[e],m=void 0!==t.stack;for(e=0;e<g;++e)if(t=h[e],s=d?c[t.index].data.filter(function(e){return n.scales[t.xAxisID].min<=e.x.valueOf()&&e.x.valueOf()<=n.scales[t.xAxisID].max}):c[t.index].data,m){L=f=k=M=D=T=L=C=S=v=b=x=y=void 0;for(var f,y=o,x=p,b=t,v=s,S=y.options,C=S.stacked,L=(x=x,C=C,C=[(L=b).type,void 0===C&&void 0===L.stack?L.index:"",L.stack].join("."),void 0===x[C]&&(x[C]={pos:[],neg:[]}),x[C]),T=L.pos,D=L.neg,M=v.length,k=0;k<M;++k)f=y._parseValue(v[k]),isNaN(f.min)||isNaN(f.max)||b.data[k].hidden||(T[k]=T[k]||0,D[k]=D[k]||0,S.relativePoints?T[k]=100:f.min<0||f.max<0?D[k]+=f.min:T[k]+=f.max)}else{F=B=P=w=O=A=void 0;for(var F,A=o,O=t,w=s,P=w.length,B=0;B<P;++B)F=A._parseValue(w[B]),isNaN(F.min)||isNaN(F.max)||O.data[B].hidden||(A.min=_.isNil(A.min)?F.min:Math.min(A.min,F.min),A.max=_.isNil(A.max)?F.max:Math.max(A.max,F.max))}I.each(p,function(e){i=e.pos.concat(e.neg),o.min=Math.min(o.min,I.min(i)),o.max=Math.max(o.max,I.max(i))}),o.min=I.isFinite(o.min)&&!isNaN(o.min)?o.min:0,o.max=I.isFinite(o.max)&&!isNaN(o.max)?o.max:1;t&&0<=["boxplot","candlestick","ohlc"].indexOf(t.type)&&(o.finMax=o.finMin=null,r=l=void 0,"boxplot"===t.type&&(l=_.minBy(s,"min").min,r=_.maxBy(s,"max").max),"candlestick"!==t.type&&"ohlc"!==t.type||(l=_.minBy(s,"l").l,r=_.maxBy(s,"h").h),o.finMin=I.isFinite(l)&&!isNaN(l)?l:0,o.finMax=I.isFinite(r)&&!isNaN(r)?r:1,o.min=o.finMin,o.max=o.finMax,o.min=isFinite(o.min)&&!isNaN(o.min)?o.min:0,o.max=isFinite(o.max)&&!isNaN(o.max)?o.max:1),o.handleTickRangeOptions()},getLabels:function(){var e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels}}),E.scaleService.registerScaleType("arrayLinear",b,E.scaleService.getScaleDefaults("linear")),I=E.helpers,C=E.scaleService.getScaleConstructor("logarithmic").extend({getRightValue:function(e){return E.LinearScaleBase.prototype.getRightValue.call(this,_e(e))},determineDataLimits:function(){var t=this,e=(this.minNotZero=null,Se.call(this,function(e){0!==e.min&&(null===t.minNotZero||e.min<t.minNotZero)&&(t.minNotZero=e.min)}),this.options.ticks);this.min=I.valueOrDefault(e.min,this.min-.05*this.min),this.max=I.valueOrDefault(e.max,this.max+.05*this.max),this.min===this.max&&(0!==this.min&&null!==this.min?(this.min=Math.pow(10,Math.floor(I.log10(this.min))-1),this.max=Math.pow(10,Math.floor(I.log10(this.max))+1)):(this.min=1,this.max=10))}}),E.scaleService.registerScaleType("arrayLogarithmic",C,E.scaleService.getScaleDefaults("logarithmic")),function(){var a=(E=E&&E.hasOwnProperty("default")?E.default:E).helpers,t=function(){if("undefined"!=typeof window){if(window.devicePixelRatio)return window.devicePixelRatio;var e=window.screen;if(e)return(e.deviceXDPI||1)/(e.logicalXDPI||1)}return 1}(),d={toTextLines:function(e){var t,i=[];for(e=[].concat(e);e.length;)"string"==typeof(t=e.pop())?i.unshift.apply(i,t.split("\n")):Array.isArray(t)?e.push.apply(e,t):a.isNullOrUndef(e)||i.unshift(""+t);return i},toFontString:function(e){return!e||a.isNullOrUndef(e.size)||a.isNullOrUndef(e.family)?null:(e.style?e.style+" ":"")+(e.weight?e.weight+" ":"")+e.size+"px "+e.family},textSize:function(e,t,i){var a,o=[].concat(t),r=o.length,t=e.font,n=0;for(e.font=i.string,a=0;a<r;++a)n=Math.max(e.measureText(o[a]).width,n);return e.font=t,{height:r*i.lineHeight,width:n}},parseFont:function(e){var t=E.defaults.global,i=a.valueOrDefault(e.size,t.defaultFontSize),i={family:a.valueOrDefault(e.family,t.defaultFontFamily),lineHeight:a.options.toLineHeight(e.lineHeight,i),size:i,style:a.valueOrDefault(e.style,t.defaultFontStyle),weight:a.valueOrDefault(e.weight,null),string:""};return i.string=d.toFontString(i),i},bound:function(e,t,i){return Math.max(e,Math.min(t,i))},arrayDiff:function(e,t){for(var i,a,o=e.slice(),r=[],n=0,s=t.length;n<s;++n)a=t[n],-1===(i=o.indexOf(a))?r.push([a,1]):o.splice(i,1);for(n=0,s=o.length;n<s;++n)r.push([o[n],-1]);return r},rasterize:function(e){return Math.round(e*t)/t}};function s(e,t){var i=t.x,t=t.y;if(null===i)return{x:0,y:-1};if(null===t)return{x:1,y:0};i=e.x-i,e=e.y-t,t=Math.sqrt(i*i+e*e);return{x:t?i/t:0,y:t?e/t:-1}}var o=0,u=1,h=2,p=4,g=8;function m(e,t,i){var a=o;return e<i.left?a|=u:e>i.right&&(a|=h),t<i.top?a|=g:t>i.bottom&&(a|=p),a}function l(e,t){var i=t.anchor,a=e,a=(t.clamp&&(a=function(e,t){for(var i,a,o,r=e.x0,n=e.y0,s=e.x1,l=e.y1,d=m(r,n,t),c=m(s,l,t);d|c&&!(d&c);)(i=d||c)&g?(a=r+(s-r)*(t.top-n)/(l-n),o=t.top):i&p?(a=r+(s-r)*(t.bottom-n)/(l-n),o=t.bottom):i&h?(o=n+(l-n)*(t.right-r)/(s-r),a=t.right):i&u&&(o=n+(l-n)*(t.left-r)/(s-r),a=t.left),i===d?d=m(r=a,n=o,t):c=m(s=a,l=o,t);return{x0:r,x1:s,y0:n,y1:l}}(a,t.area)),i="start"===i?(o=a.x0,a.y0):"end"===i?(o=a.x1,a.y1):(o=(a.x0+a.x1)/2,(a.y0+a.y1)/2),o),o=i,r=e.vx,n=e.vy,s=t.align;switch(s){case"center":r=n=0;break;case"bottom":r=0,n=1;break;case"right":r=1,n=0;break;case"left":r=-1,n=0;break;case"top":r=0,n=-1;break;case"start":r=-r,n=-n;break;case"end":break;default:s*=Math.PI/180,r=Math.cos(s),n=Math.sin(s)}return{x:a,y:o,vx:r,vy:n}}var c=function(e,t){var i=(e.startAngle+e.endAngle)/2,a=Math.cos(i),i=Math.sin(i),o=e.innerRadius,r=e.outerRadius;return l({x0:e.x+a*o,y0:e.y+i*o,x1:e.x+a*r,y1:e.y+i*r,vx:a,vy:i},t)},f=function(e,t){var i=s(e,t.origin),a=i.x*e.radius,o=i.y*e.radius;return l({x0:e.x-a,y0:e.y-o,x1:e.x+a,y1:e.y+o,vx:i.x,vy:i.y},t)},y=function(e,t){var i=s(e,t.origin),a=e.x,o=e.y,r=0,n=0;return e.horizontal?(a=Math.min(e.x,e.base),r=Math.abs(e.base-e.x)):(o=Math.min(e.y,e.base),n=Math.abs(e.base-e.y)),l({x0:a,y0:o+n,x1:a+r,y1:o,vx:i.x,vy:i.y},t)},x=function(e,t){var i=s(e,t.origin);return l({x0:e.x,y0:e.y,x1:e.x,y1:e.y,vx:i.x,vy:i.y},t)},b=E.helpers,T=d.rasterize;function r(e,t,i,a,o){var r,n,s,l,d,c,u,h,p,g,m,f,y=a.textAlign,x=a.color,b=!!x,v=a.font,_=t.length,S=a.textStrokeColor,C=a.textStrokeWidth,L=S&&C;if(_&&(b||L))for(S=i,C=y,n=(n=v).lineHeight,s=S.w,l=S.x,"center"===C?l+=s/2:"end"!==C&&"right"!==C||(l+=s),i={h:n,w:s,x:l,y:S.y+n/2},e.font=v.string,e.textAlign=y,e.textBaseline="middle",e.shadowBlur=a.textShadowBlur,e.shadowColor=a.textShadowColor,b&&(e.fillStyle=x),o=o||0,r=0,_=t.length;r<_;++r)d=e,c=t[r],u={stroked:L,filled:b,w:i.w,x:i.x,y:o+i.y+i.h*r},f=m=g=p=h=void 0,h=d.shadowBlur,p=u.stroked,g=T(u.x),m=T(u.y),f=T(u.w),p&&d.strokeText(c,g,m,f),u.filled&&(h&&p&&(d.shadowBlur=0),d.fillText(c,g,m,f),h&&p&&(d.shadowBlur=h))}function v(e,t,i,a){var o=this;o._config=e,o._index=a,o._model=null,o._rects=null,o._ctx=t,o._el=i}b.extend(v.prototype,{_modelize:function(e,t,i,a){var o,r=this._index,n=b.options.resolve,s=d.parseFont(n([i.font,{}],a,r)),l=n([i.color,E.defaults.global.defaultFontColor],a,r);return{align:n([i.align,"center"],a,r),anchor:n([i.anchor,"center"],a,r),area:a.chart.chartArea,backgroundColor:n([i.backgroundColor,null],a,r),borderColor:n([i.borderColor,null],a,r),borderRadius:n([i.borderRadius,0],a,r),borderWidth:n([i.borderWidth,0],a,r),clamp:n([i.clamp,!1],a,r),clip:n([i.clip,!1],a,r),color:l,display:e,font:s,lines:t,offset:n([i.offset,0],a,r),opacity:n([i.opacity,1],a,r),origin:(e=this._el,o=e._model.horizontal,(e=e._scale||o&&e._xScale||e._yScale)?void 0!==e.xCenter&&void 0!==e.yCenter?{x:e.xCenter,y:e.yCenter}:(e=e.getBasePixel(),o?{x:e,y:null}:{x:null,y:e}):null),padding:b.options.toPadding(n([i.padding,0],a,r)),positioner:(o=this._el)instanceof E.elements.Arc?c:o instanceof E.elements.Point?f:o instanceof E.elements.Rectangle?y:x,rotation:n([i.rotation,0],a,r)*(Math.PI/180),size:d.textSize(this._ctx,t,s),textAlign:n([i.textAlign,"start"],a,r),textShadowBlur:n([i.textShadowBlur,0],a,r),textShadowColor:n([i.textShadowColor,l],a,r),textStrokeColor:n([i.textStrokeColor,l],a,r),textStrokeWidth:n([i.textStrokeWidth,0],a,r)}},update:function(e){var t,i,a=this,o=null,r=null,n=a._index,s=a._config,l=b.options.resolve([s.display,!0],e,n);l&&(n=e.dataset.data[n],n=b.valueOrDefault(b.callback(s.formatter,[n,e]),n),(n=b.isNullOrUndef(n)?[]:d.toTextLines(n)).length&&(o=a._modelize(l,n,s,e),n=(l=o).borderWidth||0,s=l.padding,e=l.size.height,t=-(l=l.size.width)/2,i=-e/2,r={frame:{x:t-s.left-n,y:i-s.top-n,w:l+s.width+2*n,h:e+s.height+2*n},text:{x:t,y:i,w:l,h:e}})),a._model=o,a._rects=r},geometry:function(){return this._rects?this._rects.frame:{}},rotation:function(){return this._model?this._model.rotation:0},visible:function(){return this._model&&this._model.opacity},model:function(){return this._model},draw:function(e,t){var i,e=e.ctx,a=this._model,o=this._rects;this.visible()&&(e.save(),a.clip&&(i=a.area,e.beginPath(),e.rect(i.left,i.top,i.right-i.left,i.bottom-i.top),e.clip()),e.globalAlpha=d.bound(0,a.opacity,1),e.translate(T(t.x),T(t.y)),e.rotate(a.rotation),o.frame,a.backgroundColor,a.borderColor,a.borderWidth,r(e,a.lines,o.text,a,this.$layout.yAdjust),e.restore())}});var e=E.helpers,S=Number.MIN_SAFE_INTEGER||-9007199254740991,C=Number.MAX_SAFE_INTEGER||9007199254740991;function n(e,t,i){var a=Math.cos(i),i=Math.sin(i),o=t.x,t=t.y;return{x:o+a*(e.x-o)-i*(e.y-t),y:t+i*(e.x-o)+a*(e.y-t)}}function L(e,t){for(var i,a,o=C,r=S,n=t.origin,s=0;s<e.length;++s)a=(i=e[s]).x-n.x,i=i.y-n.y,a=t.vx*a+t.vy*i,o=Math.min(o,a),r=Math.max(r,a);return{min:o,max:r}}function D(e,t){var i=t.x-e.x,a=t.y-e.y,i=Math.sqrt(i*i+a*a);return{vx:(t.x-e.x)/i,vy:(t.y-e.y)/i,origin:e,ln:i}}function M(){this._rotation=0,this._rect={x:0,y:0,w:0,h:0}}function k(e,t,i){var e=t.positioner(e,t),a=e.vx,o=e.vy;if(!a&&!o)return{x:e.x,y:e.y};var r=i.w,i=i.h,n=t.rotation,s=Math.abs(r/2*Math.cos(n))+Math.abs(i/2*Math.sin(n)),r=Math.abs(r/2*Math.sin(n))+Math.abs(i/2*Math.cos(n)),i=1/Math.max(Math.abs(a),Math.abs(o));return s*=a*i,r*=o*i,_.isNumber(t.offset)?(s+=t.offset*a,r+=t.offset*o):2===(n=t.offset.split(",")).length?(s+=_.isNaN(parseFloat(n[0]))?4*a:parseFloat(n[0]),r+=_.isNaN(parseFloat(n[1]))?4*o:parseFloat(n[1])):(s+=4*a,r+=4*o),{x:e.x+s,y:e.y+r}}e.extend(M.prototype,{center:function(){var e=this._rect;return{x:e.x+e.w/2,y:e.y+e.h/2}},update:function(e,t,i){this._rotation=i,this._rect={x:t.x+e.x,y:t.y+e.y,w:t.w,h:t.h}},contains:function(e){var t=this._rect;return!((e=n(e,this.center(),-this._rotation)).x<t.x-1||e.y<t.y-1||e.x>t.x+t.w+2||e.y>t.y+t.h+2)},intersects:function(e){var t,i,a,o=this._points(),r=e._points(),n=[D(o[0],o[1]),D(o[0],o[3])];for(this._rotation!==e._rotation&&n.push(D(r[0],r[1]),D(r[0],r[3])),t=0;t<n.length;++t)if(i=L(o,n[t]),a=L(r,n[t]),i.max<a.min||a.max<i.min)return!1;return!0},_points:function(){var e=this._rect,t=this._rotation,i=this.center();return[n({x:e.x,y:e.y},i,t),n({x:e.x+e.w,y:e.y},i,t),n({x:e.x+e.w,y:e.y+e.h},i,t),n({x:e.x,y:e.y+e.h},i,t)]}});var F={prepare:function(e){for(var t,i,a,o=[],r=0,n=e.length;r<n;++r)for(t=0,i=e[r].length;t<i;++t)a=e[r][t],o.push(a),a.$layout={_box:new M,_hidable:!1,_visible:!0,_set:r,_idx:t};return o.sort(function(e,t){e=e.$layout,t=t.$layout;return e._idx===t._idx?e._set-t._set:t._idx-e._idx}),this.update(o),o},update:function(e){for(var t,i,a,o,n=_.filter(e,function(e){return e._model}),r=0,s=n.length;r<s;++r)(i=(t=n[r]).$layout)._visible&&(a=t.geometry(),o=k(t._el._model,t.model(),a),i._box.update(o,a,t.rotation()));for(var l,d,c,u=n,h=function(t,i){var e,a,o=_.get(t,"_box._rect"),r=_.get(i,"_box._rect");(n[0]?_.get(n[0],"$context.chart.height"):0)&&o&&r&&(e=t.yAdjust||0,a=Math.abs(r.y-o.y)/2,i.yAdjust=e+o.h+a,_.each(_.filter(n,function(e){return e._index===t._idx&&e.$layout._box._rect.y!==o.y&&e.$layout._box._rect.y!==r.y}),function(e){var t=i._box;t._rect.y=t._rect.y+i.yAdjust,e.$layout._box.intersects(t)&&(e.$layout.yAdjust=r.h+a)}))},p=u.length-1;0<=p;--p)for(d=u[p].$layout,l=p-1;0<=l&&d._visible;--l)(c=u[l].$layout)._visible&&d._box.intersects(c._box)&&h(d,c)},lookup:function(e,t){for(var i,a=e.length-1;0<=a;--a)if((i=e[a].$layout)&&i._visible&&i._box.contains(t))return{dataset:i._set,label:e[a]};return null},draw:function(e,t){for(var i,a,o,r,n=0,s=t.length;n<s;++n)(a=(i=t[n]).$layout)._visible&&(o=i.geometry(),r=k(i._el._view,i.model(),o),a._box.update(r,o,i.rotation()),i.draw(e,r))}},A=E.helpers,e={align:"center",anchor:"center",backgroundColor:null,borderColor:null,borderRadius:0,borderWidth:0,clamp:!1,clip:!1,color:void 0,display:!1,font:{family:void 0,lineHeight:1.2,size:void 0,style:void 0,weight:null},formatter:function(e){if(A.isNullOrUndef(e))return null;var t,i,a,o=e;if(A.isObject(e))if(A.isNullOrUndef(e.label))if(A.isNullOrUndef(e.r))for(o="",a=0,i=(t=Object.keys(e)).length;a<i;++a)o+=(0!==a?", ":"")+t[a]+": "+e[t[a]];else o=e.r;else o=e.label;return""+o},listeners:{},offset:4,opacity:1,padding:{top:4,right:4,bottom:4,left:4},rotation:0,textAlign:"start",textStrokeColor:void 0,textStrokeWidth:0,textShadowBlur:0,textShadowColor:void 0},O=E.helpers,w="$datalabels";function P(e,t,i){var a,t=t&&t[i.dataset];t&&(a=(i=i.label).$context,!0===O.callback(t,[a])&&(e[w]._dirty=!0,i.update(a)))}function B(e,t){var i=e[w],a=i._listeners;if(a.enter||a.leave){if("mousemove"===t.type)o=F.lookup(i._labels,t);else if("mouseout"!==t.type)return;var o,r,n,t=i._hovered;i._hovered=o,i=e,e=a,a=o,((o=t)||a)&&(o?a?o.label!==a.label&&(n=r=!0):n=!0:r=!0,n&&P(i,e.leave,o),r&&P(i,e.enter,a))}}E.defaults.global.plugins.datalabels=e,E.defaults.global.plugins.datalabels=e;e={id:"datalabels",beforeInit:function(e){e[w]={_actives:[]}},beforeUpdate:function(e){e=e[w];e&&(e._listened=!1,e._listeners={},e._datasets=[],e._labels=[])},afterDatasetUpdate:function(e,a,t){var i,o=a.index,r=e[w];if(r){var n=r._datasets[o]=[],s=e.isDatasetVisible(o),l=e.data.datasets[o],d=(t=t,!1===(i=(i=l).datalabels)?null:O.merge({},[t,i=!0===i?{}:i])),c=a.meta.data||[],u=c.length,h=e.ctx,p=void 0,g=void 0,m=void 0;for(h.save(),p=0;p<u;++p)g=c[p],s&&g&&!g.hidden&&!g._model.skip?(n.push(m=new v(d,h,g,p)),m.update(m.$context={active:!1,chart:e,dataIndex:p,dataset:l,datasetIndex:o})):m=null,g[w]=m;h.restore(),O.merge(r._listeners,d.listeners||{},{merger:function(e,t,i){t[e]=t[e]||{},t[e][a.index]=i[e],r._listened=!0}})}},afterUpdate:function(e,t){e[w]&&(e[w]._labels=F.prepare(e[w]._datasets,t))},afterDatasetsDraw:function(e){e[w]&&F.draw(e,_.filter(e[w]._labels,function(e){return e._model}))},beforeEvent:function(e,t){if(e[w]&&e[w]._listened)switch(t.type){case"mousemove":case"mouseout":B(e,t);break;case"click":a=t,o=(i=e)[w],r=o._listeners.click,(o=r&&F.lookup(o._labels,a))&&P(i,r,o)}var i,a,o,r},afterEvent:function(e){var t=e[w];if(e[w]){for(var i,a=t._actives,o=t._actives=e.lastActive||[],r=d.arrayDiff(a,o),n=void 0,s=void 0,n=0,l=r.length;n<l;++n)(i=r[n])[1]&&(s=i[0][w])&&(s.$context.active=1===i[1],s.update(s.$context));(t._dirty||r.length)&&(F.update(t._labels),e.animating||e.render()),delete t._dirty}}};E.plugins.register(e)}(),function a(o,r,n){function s(i,e){if(!r[i]){if(!o[i]){var t="function"==typeof require&&require;if(!e&&t)return t(i,!0);if(l)return l(i,!0);e=new Error("Cannot find module '"+i+"'");throw e.code="MODULE_NOT_FOUND",e}t=r[i]={exports:{}};o[i][0].call(t.exports,function(e){var t=o[i][1][e];return s(t||e)},t,t.exports,a,o,r,n)}return r[i].exports}for(var l="function"==typeof require&&require,e=0;e<n.length;e++)s(n[e]);return s}({1:[function(e,t,i){},{}],2:[function(e,t,i){t.exports=function(e){e.defaults.candlestick=Object.assign({},e.defaults.financial),e.defaults.candlestick.scales={xAxes:[Object.assign({},e.defaults.financial.scales.xAxes[0])],yAxes:[Object.assign({},e.defaults.financial.scales.yAxes[0])]},e.controllers.candlestick=e.controllers.financial.extend({dataElementType:e.elements.Candlestick,updateElement:function(e,t,i){var a=this,o=a.getMeta(),r=a.getDataset(),n=a._resolveDataElementOptions(e,t);e._xScale=a.getScaleForId(o.xAxisID),e._yScale=a.getScaleForId(o.yAxisID),e._datasetIndex=a.index,e._index=t,e._model={datasetLabel:r.label||"",color:r.color,borderColor:r.borderColor,borderWidth:r.borderWidth},a.updateElementGeometry(e,t,i,n),e.pivot()}})}},{}],3:[function(e,t,i){t.exports=function(n){n.defaults.financial={label:"",hover:{mode:"label"},scales:{xAxes:[{type:"time",distribution:"series",categoryPercentage:.8,barPercentage:.9,ticks:{source:"data"}}],yAxes:[{type:"financialLinear"}]},tooltips:{callbacks:{label:function(e,t){return t.datasets[e.datasetIndex].data[e.index]}}}},n.controllers.financial=n.controllers.bar.extend({dataElementType:n.elements.Financial,updateElementGeometry:function(e,t,i,a){var o=this,e=e._model,r=o._getValueScale(),n=r.getBasePixel(),r=r.isHorizontal(),s=o._ruler||o.getRuler(),l=o.calculateBarValuePixels(o.index,t,a),s=o.calculateBarIndexPixels(o.index,t,s,a);e.horizontal=r,e.base=i?n:l.base,e.x=r?i?n:l.head:s.center,e.y=r?s.center:i?n:l.head,e.height=r?s.size:void 0,e.width=r?void 0:s.size,e.candle=o.calculateCandleValuesPixels(o.index,t,a)},calculateCandleValuesPixels:function(e,t){var i=this.chart,a=this._getValueScale(),i=i.data.datasets;return{o:a.getPixelForValue(Number(i[e].data[t].o)),h:a.getPixelForValue(Number(i[e].data[t].h)),l:a.getPixelForValue(Number(i[e].data[t].l)),c:a.getPixelForValue(Number(i[e].data[t].c))}},draw:function(){var e,t=this.chart.chart.ctx,i=this.getMeta().data,a=this.getDataset(),o=i.length,r=0;for(n.canvasHelpers.clipArea(t,this.chart.chartArea);r<o;++r)null==(e=a.data[r].o)||isNaN(e)||i[r].draw();n.canvasHelpers.unclipArea(t)}})}},{}],4:[function(e,t,i){t.exports=function(e){e.defaults.ohlc=Object.assign({},e.defaults.financial),e.defaults.ohlc.scales={xAxes:[Object.assign({},e.defaults.financial.scales.xAxes[0])],yAxes:[Object.assign({},e.defaults.financial.scales.yAxes[0])]},e.defaults.ohlc.scales.xAxes[0].barPercentage=1,e.defaults.ohlc.scales.xAxes[0].categoryPercentage=1,e.controllers.ohlc=e.controllers.financial.extend({dataElementType:e.elements.Ohlc,updateElement:function(e,t,i){var a=this,o=a.getMeta(),r=a.getDataset(),n=a._resolveDataElementOptions(e,t);e._xScale=a.getScaleForId(o.xAxisID),e._yScale=a.getScaleForId(o.yAxisID),e._datasetIndex=a.index,e._index=t,e._model={datasetLabel:r.label||"",lineWidth:r.lineWidth,armLength:r.armLength,armLengthRatio:r.armLengthRatio,color:r.color},a.updateElementGeometry(e,t,i,n),e.pivot()}})}},{}],5:[function(e,t,i){t.exports=function(e){var s=e.helpers,l=e.defaults.global;l.elements.candlestick=Object.assign(l.elements.financial,{borderColor:l.elements.financial.color.unchanged,borderWidth:2}),e.elements.Candlestick=e.elements.Financial.extend({draw:function(){var e=this._chart.ctx,t=this._view,i=t.x,a=t.candle.o,o=t.candle.h,r=t.candle.l,n=t.candle.c;e.strokeStyle=s.getValueOrDefault(t.borderColor,l.elements.candlestick.borderColor),e.lineWidth=s.getValueOrDefault(t.borderWidth,l.elements.candlestick.borderWidth),e.fillStyle=n<a?s.getValueOrDefault(t.color?t.color.up:void 0,l.elements.candlestick.color.up):a<n?s.getValueOrDefault(t.color?t.color.down:void 0,l.elements.candlestick.color.down):s.getValueOrDefault(t.color?t.color.unchanged:void 0,l.elements.candlestick.color.unchanged),e.beginPath(),e.moveTo(i,o),e.lineTo(i,Math.min(a,n)),e.moveTo(i,r),e.lineTo(i,Math.max(a,n)),e.stroke(),e.fillRect(i-t.width/2,n,t.width,a-n),e.closePath()}})}},{}],6:[function(e,t,i){t.exports=function(e){function o(e){var e=e._view,t=e.width/2,i=e.x-t,t=e.x+t;return{left:i,top:e.candle.h,right:t,bottom:e.candle.l}}e.defaults.global.elements.financial={color:{up:"rgba(80, 160, 115, 1)",down:"rgba(215, 85, 65, 1)",unchanged:"rgba(90, 90, 90, 1)"},fractionalDigitsCount:void 0},e.elements.Financial=e.Element.extend({height:function(){var e=this._view;return e.base-e.y},inRange:function(e,t){var i,a=!1;return a=this._view?e>=(i=o(this)).left&&e<=i.right&&t>=i.top&&t<=i.bottom:a},inXRange:function(e){var t=o(this);return e>=t.left&&e<=t.right},getCenterPoint:function(){var e=this._view;e.width;return{x:e.x,y:(e.candle.h+e.candle.l)/2}}})}},{}],7:[function(e,t,i){t.exports=function(e){var d=e.helpers,c=e.defaults.global;c.elements.ohlc=Object.assign(c.elements.financial,{lineWidth:2,armLength:null,armLengthRatio:.8}),e.elements.Ohlc=e.elements.Financial.extend({draw:function(){var e=this._chart.ctx,t=this._view,i=t.x,a=t.candle.o,o=t.candle.h,r=t.candle.l,n=t.candle.c,s=d.getValueOrDefault(t.armLength,c.elements.ohlc.armLength),l=d.getValueOrDefault(t.armLengthRatio,c.elements.ohlc.armLengthRatio);null===s&&(s=t.width*l*.5),e.strokeStyle=n<a?d.getValueOrDefault(t.color?t.color.up:void 0,c.elements.ohlc.color.up):a<n?d.getValueOrDefault(t.color?t.color.down:void 0,c.elements.ohlc.color.down):d.getValueOrDefault(t.color?t.color.unchanged:void 0,c.elements.ohlc.color.unchanged),e.lineWidth=d.getValueOrDefault(t.lineWidth,c.elements.ohlc.lineWidth),e.beginPath(),e.moveTo(i,o),e.lineTo(i,r),e.moveTo(i-s,a),e.lineTo(i,a),e.moveTo(i+s,n),e.lineTo(i,n),e.stroke()}})}},{}],8:[function(e,t,i){var a="function"==typeof(a=e("chart.js"))?a:window.Chart;e("./scale.financialLinear.js")(a),e("./element.financial.js")(a),e("./element.candlestick.js")(a),e("./element.ohlc.js")(a),e("./controller.financial.js")(a),e("./controller.candlestick.js")(a),e("./controller.ohlc.js")(a)},{"./controller.candlestick.js":2,"./controller.financial.js":3,"./controller.ohlc.js":4,"./element.candlestick.js":5,"./element.financial.js":6,"./element.ohlc.js":7,"./scale.financialLinear.js":9,"chart.js":1}],9:[function(e,t,i){t.exports=function(e){e.helpers;var t=e.scaleService.getScaleConstructor("linear").extend({});e.scaleService.registerScaleType("financialLinear",t,{position:"left",ticks:{callback:function(e){return e}}})}},{}]},{},[8]);var Ce,B=y.Tools;function R(e){var n=Ce.call(this,e)||this,a=(n.layers=new j,n.dataSources={},n.animation=new W,n.isTransposed=!1,n.focus=[],n.errors={},n.isPendingFirstOnSettingsChange=!0,n.isReadyForThemeChange=!1,n.clicks=0,n.delay=300,n.previousClicked="",n.dashboardViewModel=e.dashboardViewModel,R.docViewModel=e.viewModel,n.api=e.api,n.api.setProperty);return n.api.setProperty=function(e,t,i){i&&i.bypass||(t=x.replaceViewStatesWithModel(e,t,n.api)),a.call(n.api,e,t,i)},n.$el.html(le.app({})),n.$el.addClass("chartjs"),n.ctx=n.$el.find(".chart-container")[0].querySelector("canvas").getContext("2d"),n.disablePointerEventsOnMask(),n.listenTo(n.layers,"add reset",function(e){n.initLayerListeners(e),n.setThemeAccordingToDashboardSettings()}),n.listenTo(n.layers,"remove",function(e){e.stopListening()}),n.listenTo(n.layers,"update",function(e,t){n.updatePossibleLayers();var i=0<t.changes.added.length+t.changes.removed.length;_.throttle(function(){!i&&n.animation&&n.animation.get("Enabled")?n.updateChart():n.initializeChart()})}),n.xAxes=n.initAxis("XAxes"),n.yAxes=n.initAxis("YAxes"),n.legendModel=new te({app:n,externalDiv:n.$el.find(".chart-legend")}),n.listenTo(n.legendModel,"change",n.updateChart.bind(n)),n.listenTo(n.legendModel,"change:layerState",function(){_.each(n.layers.models,function(e){e.set("Basics.Enabled",n.legendModel.layerState[e.get("_Hidden._LayerId")])}),_.each(n.api.getProperty("Layers"),function(e,t){e=n.legendModel.layerState[e._Hidden._LayerId];n.api.setProperty("Layers."+t+".Basics.Enabled",e,{bypass:!0})})}),n.listenTo(n.animation,"change",n.updateChart.bind(n)),n.crosshairModel=new ae({api:n.api,dataSources:n.dataSources,el:n.$el,layers:n.layers,xAxes:n.xAxes,yAxes:n.yAxes}),n.listenTo(n.crosshairModel,"change:Basics.Selected",function(){var t,e,i,a,o,r;(n.api.getPropertyMeta("Basics.Selected").viewstateType||n.api.getPropertyMeta("Basics.Focus").viewstateType)&&(e=n.crosshairModel.get("Basics.Selected"),r=_.get(e,"datasetIndex"),i=_.get(n,"chart.data.datasets"),t=_.get(i[r],"layerId"),i&&!_.isNil(r)&&t&&(r=(i=n.layers.find(function(e){return e.get("_Hidden._LayerId")===t})).get("Basics.Data"),r=n.dataSources[r.cid],e=e.index,r.getData()&&void 0!==(e=r.getData().at(e))&&(i=r.getPropertyFromColumn(i.get("Axes.XAxisData")),a=r.getDepth(),o=_.clone(n.focus),r=12<=(r=r.getColumnType(i))&&r<=19?B.convertKDBTemporalToMoment(e.get(i)).toDashString():""+e.get(i),o[a]=r,n.api.setProperty("Basics.Focus",o.join(","),{bypass:!0}),n.api.setProperty("Basics.Selected",r,{bypass:!0}))))}),n.listenTo(n.crosshairModel,"change:Basics.Hover",function(){if(n.api.getPropertyMeta("Basics.Hover").viewstateType){var t=n.crosshairModel.get("Basics.Hover");if(!t)return n.api.setProperty("Basics.Hover",t,{bypass:!0});var e=n.layers.find(function(e){return e.get("_Hidden._LayerId")===n.chart.data.datasets[t.datasetIndex].layerId}),i=e.get("Basics.Data"),i=n.dataSources[i.cid],a=t.index;!i.getData()||void 0!==(a=i.getData().at(a))&&(e=i.getPropertyFromColumn(e.get("Axes.XAxisData")),i=12<=(i=i.getColumnType(e))&&i<=19?B.convertKDBTemporalToMoment(a.get(e)).toDashString():""+a.get(e),n.api.setProperty("Basics.Hover",i,{bypass:!0}))}}),n.panModel=new re({el:n.$el}),n.listenTo(n.panModel,"MinMaxChange",function(e){n.api.setProperty("Zoom.Min",e.get("Min"),{bypass:!0}),n.api.setProperty("Zoom.Max",e.get("Max"),{bypass:!0})}),n.listenTo(n.panModel,"cleanChart",function(){n.initializeChart()}),n.fileExportModel=new r.DeepModel,n.fileExporterView=new he({api:n.api,appView:n,el:le.fileExporter({}),getCanvas:function(){return n.ctx.canvas},getExportConfig:function(){return{altFileName:"",columnsConfig:{dataSources:n.dataSources,layers:n.layers,xAxes:n.xAxes,yAxes:n.yAxes},fileName:n.fileExportModel.get("FileExport.FileName"),workSheetTitle:"ChartJs"}},model:n.fileExportModel}),n.listenTo(n.fileExportModel,"change:FileExport.Enabled",n.toggleToolsPanel.bind(n)),n.$el.find(".tools-panel").append(n.fileExporterView.$el),n.highlightRulesModel=new J({api:n.api,el:n.$el}),n.$el.find(".active-mouse").click(function(e){return n.ZoomPanToolHandler(e)}),n.$el.find(".reset-chart").click(function(e){return n.ZoomPanToolHandler(e)}),n.$el.find(".reset-chart-level").click(function(e){return n.ZoomPanToolHandler(e)}),n.$el.find(".reset-chart-level-in").click(function(e){return n.ZoomPanToolHandler(e)}),n}return Ce=r.View,e(R,Ce),R.convertToMomentOrDuration=function(e,t){var i=t;return e&&e._isAMomentObject?i=B.convertDateStringValueToMoment(t,B.timezone):e&&(i=B.convertValueToDuration(t,e._kdbType)),i},R.prototype.onSettingsChange=function(e){var t=!!this.isPendingFirstOnSettingsChange,i=(this.isPendingFirstOnSettingsChange&&(this.isPendingFirstOnSettingsChange=!1),x.expandNestedViewStates(e,this.api)),i=x.replaceViewStatesWithValue("",i,this.api),i=x.pump(i);this.onSettingsChangeProcessed.call(this,i,e),t&&(this.isReadyForThemeChange=!0,this.isPendingFirstOnSettingsChange=!1,this.setThemeAccordingToDashboardSettings())},R.prototype.updateError=function(e,t){function i(e){return"Error"===e?3:"Loading"===e?2:"NoResults"===e?1:0}var a=this,e=e.getKey(),t=(t?this.errors[e]=t:delete this.errors[e],_.reduce(this.errors,function(e,t){t=t.type;return i(t)>i(e)?t:e},""));t&&("NoResults"!==t||Object.keys(this.dataSources).length===Object.keys(this.errors).length)?(e=_.map(this.errors,function(e,t){e=e.error,t=a.dataSources[t];return e?"["+t.getPath()+"]: "+e:null}).filter(function(e){return e}),this.api.showQueryStatus({error:e.join("\n"),type:t})):this.api.hideQueryStatus()},R.prototype.updateDataSource=function(i){var a=this;if(this.dataSources[i.getKey()]){var e=this.layers.filter(function(e){e=e.get("Basics.Data");return e&&e.cid===i.getKey()}),o=!0,r=this.getDefaultConfig(i),n=this.errors[i.getKey()];if(""===r.y&&(!n||"Loading"===_.get(n,"type")))return void this.api.showErrorMessage({error:t("Data Source provided is not valid for Canvas Chart"),type:"Warning"});if(e.forEach(function(e,t){e.updateData(i,a.xAxes,a.yAxes),e.set("_Hidden._PossibleRadius",_.union(["Fixed Size"],i.getColumnNames())),e.set("_Hidden._PossibleColumnsWithXYKey",_.union(["<thisX>","<thisY>","<thisName>"],i.getColumnNames())),e.set("_Hidden._PossibleColumnsWithItself",_.union(["<this>"],i.getColumnNames())),e.set("_Hidden._PossibleColumns",i.getColumnNames()),0===t&&""===e.get("Axes.YAxisData")&&(e.set("Axes.YAxisData",r.y),o=!1),0===t&&""===e.get("Axes.XAxisData")&&(e.set("Axes.XAxisData",r.x),o=!1)}),!e.length)return;this.api.setProperty("Layers",this.layers.toJSON().map(function(e,t){return a.api.setProperty("Layers."+t+"._Hidden._PossibleColumns",_.get(e,"_Hidden._PossibleColumns")),e.Actions=a.api.getProperty("Layers."+t+".Actions"),e}),{silent:o})}this.animation&&this.animation.get("Enabled")?this.updateChart():this.initializeChart()},R.prototype.getDefaultConfig=function(e){var i=this,a=!1,o=!1,r={x:"",y:""},t=["12","15","14","16","17","18","19","13"],n=["11","10"],s=["9","8","7","6","5","4"],l=["0","2","1"],d=_.chain(e.meta).groupBy("kdbType").map(function(e,t){return{key:t,val:e,count:e.length}}).orderBy("count","desc").value(),s=this.sortColumnByPopularity(s,_.map(d,"key"));return _.each(_.concat(t,n,s,l),function(t){!a&&0<_.filter(d,function(e){return e.key===t}).length&&(r.x=_.get(e,"breakdownColumns")&&0<_.get(e,"breakdownColumns").length?"{breakdownId}":_.map(_.filter(d,function(e){return e.key===t})[0].val,"id")[0],a=!0)}),_.each(_.concat(s,t,n,l),function(t){!o&&0<_.filter(d,function(e){return e.key===t}).length&&(r.y=i.columnsToRegex(_.filter(d,function(e){return e.key===t})[0]),o=!0)}),r},R.prototype.sortColumnByPopularity=function(t,e){return _.filter(e,function(e){return 0<=t.indexOf(e)})},R.prototype.columnsToRegex=function(e){e=_.map(e.val,"id");return 0<e.length?"/^("+e.slice(0,5).join("|")+")$/":"*"},R.prototype.disablePointerEventsOnMask=function(){var e=this.$el[0];e&&_.get(e,"parentElement.parentElement")&&(_.get(e,"parentElement.parentElement").getElementsByClassName("queryStatus")[0].style.pointerEvents="none")},R.prototype.initLayerListeners=function(i){function e(e){return"change:"+e}var a=this,t=(this.stopListening(i),this.listenTo(i,"change:_Hidden._Type",this.initLayerListeners.bind(this)),["XAxes","YAxes"].forEach(function(e){var t="XAxes"===e?a.xAxes:a.yAxes,t=_.map(t.map("_Hidden"),"_Label");i.get("Axes."+e.replace("e","i")+"ID").length||i.set("Axes."+e.replace("e","i")+"ID",e.replace("e","i")+" 1"),i.set("_Hidden._Possible"+e,t),i.setPalette(a.getPalette()),a.listenTo(i,"change:_Hidden._Possible"+e,function(e){e.setPalette(a.getPalette()),a.api.setProperty("Layers",a.layers.toJSON(),{silent:!0}),a.onSettingsLayersChanged(a.layers.toJSON())})}),Y.dataFieldsMap[i.get("_Hidden._Type")]),o=Y.visualFieldsMap[i.get("_Hidden._Type")],t=t.map(e).join(" "),o=o.map(e).join(" ");this.listenTo(i,t,this.onLayerDataEvents.bind(this)),this.listenTo(i,o,this.onLayerVisualEvents.bind(this))},R.prototype.initAxis=function(a){var o=this,t=new U;return this.listenTo(t,"add",function(e){o.updatePossibleAxes(a),e.isNumerical()&&(e.set("Labels.Reverse",!!e.get("Labels._ReverseCache"),{silent:!0}),o.api.setProperty(a,t.toJSON(),{silent:!0})),o.setThemeAccordingToDashboardSettings()}),this.listenTo(t,"remove",function(){o.updatePossibleAxes(a)}),this.listenTo(t,"update",function(){o.initializeChart()}),this.listenTo(t,"change:Range.UseMinMax change:Range.SoftRange change:Title.Display change:Labels.Display change:Labels.Reverse change:Labels._ReverseCache",function(){o.api.setProperty(a,t.toJSON())}),this.listenTo(t,"change:Labels.Format, change:Labels.DateFormat, change:Labels.FilterUnique",function(){o.layers.each(o.onLayerDataEvents.bind(o))}),this.listenTo(t,"cache",function(e){var t=e.model,i=a+"."+t.get("_Hidden._Index")+".";x.cache(t,i,e,o.api)}),t},R.prototype.getPalette=function(){var i=this;return this.api.getProperty("Style.Palette").map(function(e,t){return i.api.getProperty("Style.Palette."+t+".type")})},R.prototype.onSettingsChangeProcessed=function(t,i){var a,e,o=this;_.isObject(t.Animations)&&this.onSettingsAnimationsChanged.call(this,t.Animations),_.isObject(t.Basics)&&this.onSettingsBasicsChanged.call(this,t.Basics),["XAxes","YAxes"].forEach(function(e){_.isArray(t[e])&&o.onSettingsAxesChanged.call(o,e,t[e])}),_.isArray(t.Layers)&&!_.isEqual(this.layers.toJSON(),t.Layers)&&(a=/^Layers\.\d+\.Basics\.Enabled$/,e=Object.keys(i),_.some(e,function(e){return!e.match(/^Layers\.\d+\.Actions\.\d+\.Target$/)&&!e.match(/^Layers\.\d+\._Hidden._PossibleColumns$/)})&&this.onSettingsLayersChanged.call(this,t.Layers),_.each(e,function(e){a.test(e)&&_.get(o.chart,"data.datasets")&&o.onSettingsLayersEnabledChanged.call(o,t.Layers,i)})),(_.isObject(t.Style)||_.isEqual(Object.keys(t),["Palette"]))&&this.onSettingsStyleChanged.call(this),_.isObject(t.Zoom)&&(this.onSettingsZoomChanged.call(this,t.Zoom),this.ZoomPanToolPanel(t)),_.isObject(t.Overlay)&&this.onSettingsCrosshairChanged.call(this,t.Overlay),_.isObject(t.Legend)&&this.onSettingsLegendChanged.call(this,t.Legend),_.isObject(t.FileExport)&&this.onSettingsFileExportChanged.call(this,t.FileExport),_.isObject(t.Basics)&&t.Basics.hasOwnProperty("Transpose")&&this.onSettingsOrientationChanged.call(this,t.Basics.Transpose),this.chart&&t.hasOwnProperty("Layers")&&(this.updateChart(),this.legendModel.restoreLayerState(this.chart))},R.prototype.onSettingsAxesChanged=function(i,e){var t="XAxes"===i?this.xAxes:this.yAxes,a=_.map(t.map("_Hidden"),"_AxisId"),o=e.filter(function(e){return!_.get(e,"_Hidden._AxisId")});if(o.length)return o.forEach(function(e){for(;!e._Hidden._AxisId||_.includes(a,e._Hidden._AxisId);)e._Hidden._AxisId=_.uniqueId("axis_")}),void this.api.setProperty(i,e);e.forEach(function(e,t){e._Hidden._Index=t,e._Hidden._Label=l.singular(i)+" "+(t+1)}),t.set(e)},R.prototype.onSettingsAnimationsChanged=function(e){var t=this;e.hasOwnProperty("Enabled")?(e.Enabled?x.cache(this.animation,"Animations.",{load:["Duration","Easing"],defaults:[0,"easeOutQuart"]},this.api):x.cache(this.animation,"Animations.",{store:["Duration","Easing"]},this.api),this.animation.set(e),_.defer(function(){t.api.setProperty("Animations",t.animation.toJSON())})):this.animation.set(e),e.hasOwnProperty("HoverEvents")&&this.initializeChart()},R.prototype.onSettingsBasicsChanged=function(e){var t=this;e.Selected&&this.chart&&this.crosshairModel.updateSelectedFromViewState(e),e.hasOwnProperty("Hover")&&this.chart&&this.crosshairModel.updateHoverFromViewState(e),void 0!==e.Focus&&(this.focus=_.first(x.focus2Array(e.Focus))||[],_.each(this.dataSources,function(e){e.setFocus(t.focus),t.api.getPropertyMeta("Basics.Focus").viewstateType&&t.crosshairModel.set("Basics.Selected",t.focus)}))},R.prototype.onSettingsCrosshairChanged=function(e){this.crosshairModel.set(e),this.crosshairModel.onSettingsChange(e)},R.prototype.onSettingsFileExportChanged=function(e){var i=this;this.fileExportModel&&(_.each(e,function(e,t){i.fileExportModel.set("FileExport."+t,e)}),4===_.keys(e).length&&void 0===this.fileExportModel.get("FileExport.Enabled")&&(e.ShowExportCsvButton||e.ShowExportExcelButton||e.ShowScreenshot?this.fileExportModel.set("FileExport.Enabled",!0):this.fileExportModel.set("FileExport.Enabled",!1)))},R.prototype.onSettingsLayersChanged=function(e){var a,o=this,r=_.map(this.layers.map("_Hidden"),"_LayerId"),t=e.filter(function(e){return!e._Hidden._LayerId});if(t.length)return a=this.layers,t.forEach(function(t){var e,i=["Basics.BackgroundColor","Basics.BackgroundOpacity","Basics.BorderColor","Basics.BorderWidth","Basics.LegendLabelColor","Basics.LegendLabelColor","Basics.BorderColor","Axes","Actions","HighlightRules","Basics.Data","Basics.Enabled"];for(0<a.models.length?(e=a.models[a.models.length-1].attributes._Hidden._Type,"Line"===(t._Hidden._Type=e)?i.push("Interpolation","Line","Points"):(t.Points=null,t.Interpolation=null,t.Line=null),"Bubble"===e?i.push("Bubbles"):t.Bubbles=null,"Bar"===e?i.push("Bars"):t.Bars=null,i.forEach(function(e){e=e.split(".");1===e.length?t[e[0]]&&a.models[a.models.length-1].attributes[e[0]]?t[e[0]]=a.models[a.models.length-1].attributes[e[0]]:t[e[0]]={}:2===e.length&&t[e[0]]&&a.models[a.models.length-1].attributes[e[0]]&&(t[e[0]][e[1]]=a.models[a.models.length-1].attributes[e[0]][e[1]])}),e=o.api.getProperty("Style.Palette"),t.Basics.Name=o.layers.getUniqueLayerName(a.models[a.models.length-1].attributes.Basics.Name),t.Basics.BackgroundColor=e[a.models.length%e.length].type,t.Basics.BorderColor=e[a.models.length%e.length].type,t.Points&&(t.Points.PointBackgroundColor=e[a.models.length%e.length].type,t.Points.PointBorderColor=e[a.models.length%e.length].type,t.Points.PointHoverBackgroundColor=e[a.models.length%e.length].type,t.Points.PointHoverBorderColor=e[a.models.length%e.length].type),t.Bars&&(t.Bars.HoverBackgroundColor=e[a.models.length%e.length].type,t.Bars.HoverBorderColor=e[a.models.length%e.length].type,t.Bars.BarPercentage=90,t.Bars.BarThickness=10,t.Bars.BarWidthType="percentage",t.Bars.CategoryPercentage=80),t.Bubbles&&(t.Bubbles.HoverBackgroundColor=e[a.models.length%e.length].type,t.Bubbles.HoverBorderColor=e[a.models.length%e.length].type),t.Line&&(t.Line.Fill="noFill")):t.Basics.Name=t.Basics.Name||"Layer 1";!t._Hidden._LayerId||_.includes(r,t._Hidden._LayerId);)t._Hidden._LayerId=_.uniqueId("layer_")}),void this.api.setProperty("Layers",e);e.forEach(function(e,t){e._Hidden._Index=t}),this.layers.set(e),this.legendModel.updateLayerStatefromOnSettingsChanged(e);var t=_.chain(e).map("Basics").map("Data").filter(Boolean).uniq().value(),i=(t.forEach(function(i){var e=o.dataSources[i.cid];e?e.hasData()&&o.updateDataSource(e):(e=new q(i,o,o.api,o.focus),o.dataSources[i.cid]=e,o.listenTo(i,"change:queryStatus",function(e,t){o.updateError(o.dataSources[i.cid],t)}),e.subscribe())}),_.fromPairs(_.map(t,function(e){return[e.cid,!0]})));_.each(this.dataSources,function(e){var t=e.getSource();t&&!i[t.cid]&&(o.stopListening(t),delete o.dataSources[e.getKey()],e.unsubscribe(),o.updateDataSource(e),o.updateError(e,void 0))})},R.prototype.onSettingsLegendChanged=function(e){this.legendModel.set(e),this.chart&&(this.legendModel.renderhtmlLegend(this.chart),this.chart.options.legend=this.legendModel.computeLegendProp(),this.chart.update())},R.prototype.onSettingsLayersEnabledChanged=function(o,r){var n=this,e=Object.keys(r);_.each(e,function(t){var i,a=t.split(".").map(function(e){return _.isNaN(parseInt(e,10))?e:parseInt(e,10)}),e=o[a[1]];_.get(e,"_Hidden._LayerId")&&(i=_.get(e,"_Hidden._LayerId"),e=_.filter(n.chart.data.datasets,function(e){return e.layerId===i}),_.each(e,function(e){_.each(Object.values(e._meta),function(e){n.chart.getDatasetMeta(_.get(e,"index")).hidden=!r[t]}),n.layers.at(a[1]).set("Basics.Enabled",r[t])}))}),this.crosshairModel.setLayers(this.layers)},R.prototype.onSettingsOrientationChanged=function(e){this.isTransposed=e,this.api.getProperty("Overlay.TooltipsEnabled")&&this.isTransposed&&this.api.setProperty("Overlay.TooltipsIntersect",!0,{silent:!0}),this.panModel.isTransposed=this.isTransposed,this.crosshairModel.isTransposed=this.isTransposed,this.$el.find(".reset-chart").toggleClass("hidden",this.isTransposed),this.initializeChart()},R.prototype.onSettingsStyleChanged=function(){var t=this,i=this.getPalette();this.layers&&this.layers.models&&(_.each(this.layers.models,function(e){e.setPalette(i),t.onLayerVisualEvents(e)}),this.updateChart())},R.prototype.onSettingsZoomChanged=function(e){this.panModel.set(e),this.panModel.updateDebouncer(e),this.toggleToolsPanel()},R.prototype.destroyChart=function(){this.chart&&(this.chart.destroy(),delete this.chart)},R.prototype.onResize=function(){this.chart&&this.legendModel&&(this.chart.resize(!1),this.legendModel.renderhtmlLegend(this.chart))},R.prototype.initializeChart=function(){var e,t,i,a;this.chart&&this.chart.preventUpdate?this.chart.isDirty=!0:(this.legendModel&&_.get(this,"chart.legend")&&this.legendModel.setLegendStateProps(_.mapValues(_.keyBy(this.chart.legend.legendItems,"text"),"hidden")),this.destroyChart(),i=(t=this.prepareChart()).datasets,e=t.labels,t=t.options,i&&e&&t&&this.setMinMaxTime(t,i)&&(i={crosshairModel:this.crosshairModel,data:{datasets:i,labels:e},legendModel:this.legendModel,options:t,panModel:this.panModel,plugins:[this.panModel,this.crosshairModel,this.highlightRulesModel.highlightPlugin],timezone:B.timezone,type:this.isTransposed?"horizontalBar":"bar"},this.isTransposed||(a=_.get(i,"options.scales.yAxes"))&&a.forEach(function(e,t){"linear"===a[t].type&&(a[t].type="arrayLinear")}),i.data&&i.data.datasets&&this.legendModel.restoreLayerStateOnDatasets(i.data.datasets),this.chart=new E(this.ctx,i),this.legendModel.renderhtmlLegend(this.chart)))},R.prototype.updateChart=function(){var a=this;if(this.chart&&this.chart.preventUpdate)this.chart.isDirty=!0;else if(!this.chart||this.isTransposed)this.initializeChart();else{var e=this.prepareChart(),t=e.datasets,i=e.labels,e=e.options;if(t&&i&&e)if(this.setMinMaxTime(e,t)){$.extend(!0,this.chart.options,e),t.forEach(function(e){var t,i=_.find(a.chart.data.datasets,{id:e.id});i?(t=e.data,$.extend(!0,i,e),i.data=t):a.chart.data.datasets.push(e)});for(var o=_.fromPairs(t.map(function(e){return[e.id,!0]})),r=0;r<this.chart.data.datasets.length;r++)o[this.chart.data.datasets[r].id]||(this.chart.data.datasets.splice(r,1),r--);this.chart.data.datasets.sort(function(e,t){return t.index-e.index}),this.chart.data.labels=i,this.chart.update()}else this.chart&&(this.chart.destroy(),delete this.chart)}},R.prototype.prepareChart=function(){var t=this;if(!this.layers.length||!this.xAxes.length||!this.yAxes.length)return{};if(this.isTransposed){if(o=_.cloneDeep(_.orderBy(_.flatMap(this.layers.models,"dataset").filter(_.negate(_.isEmpty)),"index","desc")),_.includes(o.map(function(e){return e.type}),"boxplot")||_.includes(o.map(function(e){return e.type}),"violin")||_.includes(o.map(function(e){return e.type}),"candlesticks"))return{};_.each(o,function(e,t){o[t].type="bar"===o[t].type?"horizontalBar":o[t].type;var i=e.xAxisID,a=e.yAxisID;o[t].xAxisID=a,o[t].yAxisID=i,o[t].data=e.data.map(function(e){return{r:e.r||void 0,x:e.y,y:e.x}})})}else var e=this.layers.models,o=_.orderBy(_.flatMap(e,"dataset").filter(_.negate(_.isEmpty)),"index","desc");if(this.layers.some(function(e){e=e.get("Basics.Data");return!e||!t.dataSources[e.cid]||!t.dataSources[e.cid].hasData()}))return{};var e=this.layers.at(0).getLabels(),i={xAxes:(this.isTransposed?this.yAxes:this.xAxes).map(l.extractScales),yAxes:(this.isTransposed?this.xAxes:this.yAxes).map(l.extractScales)},a=this.api.getProperty("Animations.InteractionMode"),a=$.extend(!0,{},{animation:{duration:0},layout:{padding:{bottom:0}},maintainAspectRatio:!1,responsive:!0},{animation:this.animation.toChartJSON(),hover:{mode:"x"===a?this.isTransposed?"y":"x":a},layout:this.legendModel.computeLayoutProp(this.highlightRulesModel.showHeighlightRulesLegend()),legend:this.legendModel.computeLegendProp(),onClick:this.doActions.bind(this),onHover:this.doActions.bind(this),scaleOverride:!0,scaleStepWidth:50,scales:i,tooltips:{enabled:!1,mode:"point"}});return this.animation.get("HoverEvents")||(a.events=["mouseout","click","touchstart","touchmove"]),{datasets:_.clone(o),labels:_.clone(e),options:_.clone(a)}},R.prototype.ZoomPanToolPanel=function(e){_.includes(_.keys(e),"Zoom")&&((e=this.api.getProperty("Zoom")).DragZoom&&e.DragPan?this.$el.find(".active-mouse").toggleClass("hidden1",!1):this.$el.find(".active-mouse").toggleClass("hidden1",!0),e.DragZoom||e.ScrollZoom?this.$el.find(".reset-chart").toggleClass("hidden1",!1):this.$el.find(".reset-chart").toggleClass("hidden1",!0))},R.prototype.toggleToolsPanel=function(){var e,t;this.fileExportModel.has("FileExport")&&this.legendModel&&(e=this.api.getProperty("Zoom.DragZoom")||this.api.getProperty("Zoom.ScrollZoom"),t=this.fileExportModel.get("FileExport.Enabled"),this.legendModel.toolsEnabled||!e&&!t?e||t||(this.legendModel.toolsEnabled=!1,this.$el.find(".tools-panel").toggleClass("disabled",!this.$el.find(".tools-panel").hasClass("disabled")),this.updateChart()):(this.legendModel.toolsEnabled=!0,this.$el.find(".tools-panel").removeClass("disabled"),this.updateChart()))},R.prototype.ZoomPanToolHandler=function(e){(e.target.classList.contains("active")||e.target.classList.contains("active-mouse"))&&(e.target.classList.contains("active-mouse")&&"pan_tool"===e.target.innerText&&this.$el.find(".active-mouse").toggleClass("active"),e.target.classList.contains("reset-chart")&&this.panModel.resetZoom())},R.prototype.onLayerDataEvents=function(e){var t=e.get("Basics.Data"),t=t?this.dataSources[t.cid]:void 0,i=_.isNil(t)?[]:t.getColumnNames();e.updateData(t,this.xAxes,this.yAxes),e.set("_Hidden._PossibleRadius",_.union(["Fixed Size"],i)),e.set("_Hidden._PossibleColumnsWithXYKey",_.union(["<thisX>","<thisY>","<thisName>"],i)),e.set("_Hidden._PossibleColumnsWithItself",_.union(["<this>"],i)),e.set("_Hidden._PossibleColumns",i),this.api.setProperty("Layers",this.layers.toJSON())},R.prototype.onLayerVisualEvents=function(e){e.updateVisuals()},R.prototype.doActions=function(o){var r=this;if(this.chart){var e=this.chart.getElementAtEvent(o);if(e.length){var n,s,l=e[0],e=l._datasetIndex,d=l._index,c=l._model,t=_.filter(this.layers.models,function(e){return 0<e.getDatasetLength()}),e=t.length-1-e,t=t[e=e<0||e>t.length-1?t.length-1:e],i=t.get("Basics.Data"),i=this.dataSources[i.cid],u=i.getData().at(d),a=_.get(i,"focus");if(!u&&a){u=i.getSource();for(var h=0;h<a.length-1;h++)var p=_.get(u,"dataSet.collection"),u=p?p.get(a[h]):u;i=_.get(u,"dataSet.collection");u=i?i.at(d):u}t.get("Actions")&&l&&(n=[],s=_.get(o,"timeStamp")?_.get(o,"timeStamp"):Date.now(),t.get("Actions").forEach(function(e,t){if(!("mousemove"===o.type&&"Hover"!==e.Trigger||"mousemove"!==o.type&&"Hover"===e.Trigger)){var i;switch(e.Current){case"<thisName>":i=c.datasetLabel;break;case"<thisX>":i=l._chart.data.datasets[l._datasetIndex].data[d].x;break;case"<thisY>":i=l._chart.data.datasets[l._datasetIndex].data[d].y;break;default:i=u.get(e.Current)}var a=!1;"Double Click"===e.Trigger&&20<s-r.clicks&&s-r.clicks<r.delay&&l===r.previousClicked?(a=!0,r.clicks=0,r.previousClicked=""):"Double Click"!==e.Trigger&&(a=!0),a&&n.push(m(m({},e),{Value:i,_PropertyIndex:t}))}}),0<=o.type.toLowerCase().indexOf("click")&&(this.clicks=s,this.previousClicked=l),0<n.length&&this.api.doActions(n,"Layers."+e+".Actions"))}}},R.prototype.setMinMaxTime=function(e,c){function t(t,i,a,e){var o,r,n,s,l,d;"time"!==t.type&&"linear"!==t.type&&"arrayLinear"!==t.type||!c[0]?"category"===t.type&&(_.isEmpty(p.get("Min"))||p.isReset||(t.ticks.min=p.get("Min")),_.isEmpty(p.get("Max"))||p.isReset||(t.ticks.max=p.get("Max"))):(n=r=void 0,o=e.find(function(e){return e.get("_Hidden._Label")===t.id}),s=_.map(_.filter(c,function(e){return e[i]===t.id&&e.data&&e.data.length&&(!o.get("Center")||u.legendModel.layerState[e.layerId]||!_.find(u.legendModel.layerState,function(e){return!0===e}))}),function(e){return _.filter(_.map(e.data,function(e){return e[a]}),function(e){return null!=e})}),l=_.min(_.map(s,function(e){return _.min(e)})),s=_.max(_.map(s,function(e){return _.max(e)})),(e=(o=e.find(function(e){return e.get("_Hidden._Label")===t.id})).get("Range"))&&e.UseMinMax?n=e.SoftRange?(r=null!==(d=x.convertPropertyIfMoment(e.SuggestedMin))&&l<d?l:d,null!==(d=x.convertPropertyIfMoment(e.SuggestedMax))&&d<s?s:d):e.UseDataRange?(r=l,s):(r=x.convertPropertyIfMoment(e.Min),x.convertPropertyIfMoment(e.Max)):"time"===t.type&&(r=l,n=s),o.get("Center")&&"number"==typeof parseFloat(o.get("Center"))&&"linear"===t.type&&(d=n||s,r=(e=parseFloat(o.get("Center")))-(s=Math.max(Math.abs(e-(r||l)),Math.abs(e-d))||1),n=e+s),(h=h&&(void 0===r||null!==r&&isFinite(r))&&(void 0===n||null!==n&&isFinite(n)))&&("time"===t.type?(t.ticks.min=r,t.ticks.max=n,t.ticks.kdbType=_.get(r,"_kdbType")?r.kdbType():""):(t.type,t.ticks.min=r,t.ticks.max=n),0<=t.id.indexOf("XAxis")&&!1===g&&(l=R.convertToMomentOrDuration(r,p.get("Min")),d=R.convertToMomentOrDuration(n,p.get("Max")),"time"===t.type?(_.isEmpty(p.get("Min"))||p.isReset?p.isReset&&p.get("DefaultMin")&&(t.ticks.min=R.convertToMomentOrDuration(r,p.get("DefaultMin"))):t.ticks.min=l,_.isEmpty(p.get("Max"))||p.isReset?p.isReset&&p.get("DefaultMax")&&(t.ticks.max=R.convertToMomentOrDuration(n,p.get("DefaultMax"))):t.ticks.max=d):(t.type,_.isEmpty(p.get("Min"))||p.isReset||(t.ticks.min=parseFloat(p.get("Min"))),_.isEmpty(p.get("Max"))||p.isReset||(t.ticks.max=parseFloat(p.get("Max")))))))}var u=this,h=!0,p=this.panModel,g=p.get("ResetViewStateOnly");this.panModel.setDistribution(this.api.getProperty("XAxes.0.Labels.TimeFormats.Distribution"));return this.isTransposed?(_.each(e.scales.xAxes,function(e){return t(e,"xAxisID","x",u.yAxes)}),_.each(e.scales.yAxes,function(e){return t(e,"yAxisID","y",u.xAxes)})):(_.each(e.scales.xAxes,function(e){return t(e,"xAxisID","x",u.xAxes)}),_.each(e.scales.yAxes,function(e){return t(e,"yAxisID","y",u.yAxes)})),h},R.prototype.setTheme=function(e){var i,t=this.xAxes.models.concat(this.yAxes.models),a=this.layers.models,o="",r="Light"===e?(i="#FFFFFF",o="#F8F8F8","#000000"):(e="Dark",i="#000000","#F8F8F8"),e=e.toLowerCase(),e=(this.$el.find(".chart-container").removeClass("dark light"),this.$el.find(".chart-container").addClass(e),t.forEach(function(t){_.each(["GridLines.GridLinesColor","Labels.FontColor","Title.FontColor"],function(e){new Color(t.get(e)).hexString()!==i&&new Color(t.get(e)).hexString()!==o||t.set(e,r)})}),this.api.getProperty("Legend.LabelColor"));(e&&e.toString().toLowerCase()===i.toLowerCase()||o&&e.toString().toLowerCase()===o.toLowerCase())&&this.legendModel.set("LabelColor",r),a.forEach(function(t){"Candlestick"===t.get("_Hidden._Type")&&_.each(["Basics.BorderColor"],function(e){new Color(t.get(e)).hexString()!==i&&new Color(t.get(e)).hexString()!==o||t.set(e,r)})}),this.api.setProperty("Legend",this.legendModel.toLegendJSON()),this.api.setProperty("XAxes",this.xAxes.toJSON(),{silent:!0}),this.api.setProperty("YAxes",this.yAxes.toJSON()),this.api.setProperty("Layers",this.layers.toJSON())},R.prototype.setThemeAccordingToDashboardSettings=function(){this.isReadyForThemeChange&&this.setTheme(this.dashboardViewModel.get("DashboardTheme"))},R.prototype.updatePossibleAxes=function(t){var e="XAxes"===t?this.xAxes:this.yAxes,i=_.map(e.map("_Hidden"),"_Label");this.layers.forEach(function(e){e.set("_Hidden._Possible"+t,i)})},R.prototype.updatePossibleLayers=function(){this.layers.filter(function(e){return"Line"===e.get("_Hidden._Type")}).forEach(function(a){var e=a.collection.reduceRight(function(e,t,i){return[a===t?"nofill":"Layer "+(i+1)].concat(e)},["origin"]),t=_.compact(_.map(e,function(e,t){if(0<t)return"+"+t}));a.set("_Hidden._PossibleLayers",e.concat(t))});var o={RuleColor:"#F8F8F8",RuleName:"",RuleOperation:"",RuleValue:"",Show:!1};this.layers.models.forEach(function(e){var t=e.get("HighlightRules"),i=_.filter([_.last(t)],o),a=t.length-1;i.length&&0<a&&(e.unset("HighlightRules."+a,{silent:!0}),(i=m({},t[a-1])).RuleName=i.name+" copy",e.set("HighlightRules."+a,i))}),this.api.setProperty("Layers",this.layers.toJSON())},R.getComponentDefinition=M.getComponentDefinition,R.getDefaultJSON=M.getDefaultJSON,R.getDefaultJSONTemplates=M.getDefaultJSONTemplates,R.mergeWithDefault=M.mergeWithDefault,R});