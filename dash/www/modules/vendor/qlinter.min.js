"use strict";var _createClass=function(){function aa(ba,ca){for(var ea,da=0;da<ca.length;da++)ea=ca[da],ea.enumerable=ea.enumerable||!1,ea.configurable=!0,"value"in ea&&(ea.writable=!0),Object.defineProperty(ba,ea.key,ea)}return function(ba,ca,da){return ca&&aa(ba.prototype,ca),da&&aa(ba,da),ba}}();function _classCallCheck(aa,ba){if(!(aa instanceof ba))throw new TypeError("Cannot call a class as a function")}var qFunctionKeywordsOutsideSheet="aj0|wj1",qFunctionKeywords="abs|aj|acos|all|and|any|asc|asin|asof|atan|attr|avg|avgs|bin|binr|by|ceiling|cols|cor|cos|count|cov|cross|csv|cut|delete|deltas|desc|dev|differ|distinct|div|do|dsave|each|ej|ema|enlist|eval|except|exec|exit|exp|fby|fills|first|flip|floor|fkeys|from|get|getenv|group|gtime|hclose|hcount|hdel|hopen|hsym|iasc|idesc|if|ij|in|insert|inter|inv|key|keys|last|ljf|like|lj|load|log|lower|lsq|ltime|ltrim|mavg|max|maxs|mcount|md5|mdev|med|meta|min|mins|mmax|mmin|mmu|mod|msum|neg|next|not|null|or|over|parse|peach|pj|prd|prds|prev|prior|rand|rank|ratios|raze|read0|read1|reciprocal|reval|reverse|rload|rotate|rsave|rtrim|save|scan|scov|sdev|svar|select|set|setenv|show|signum|sin|sqrt|ss|ssr|string|sublist|sum|sums|sv|system|tables|tan|til|trim|type|uj|ungroup|union|update|upper|upsert|value|var|view|views|vs|wavg|where|while|within|wj|wsum|ww|xasc|xbar|xcol|xcols|xdesc|xexp|xgroup|xkey|xlog|xprev|xrank",helperFunctionKeywords="asBoolean|asByte|asChar|asDate|asDatetime|asFloat|asGUID|asInt|asList|asLong|asMinute|asMonth|asReal|asSecond|asShort|asString|asSymbol|asTime|asTimespan|asTimestamp|asType|catch|INFINITY|isAtom|isBoolean|isByte|isChar|isCompound|isDate|isDatetime|isDict|isDictionary|isEmpty|isEnum|isFloat|isFunction|isGeneral|isGUID|isInfinity|isInt|isKeyedTable|isLinked|isList|isLong|isMinute|isMonth|isNull|isNumber|isReal|isSecond|isShort|isString|isSymbol|isTable|isTime|isTimespan|isTimestamp|isType|isVector|NULL|parseBoolean|parseByte|parseChar|parseDate|parseDatetime|parseFloat|parseGUID|parseInt|parseLong|parseMinute|parseMonth|parseReal|parseSecond|parseShort|parseSymbol|parseTime|parseTimespan|parseTimestamp|parseType|typeOf|typeSymbol|until|xor",illegalQKeywords="Mlim|Q7|access|accp|adict|arch|assign|badtail|branch|cast|char|conn|constants|domain|elim|glim|globals|length|limit|locals|loop|mismatch|mq|noamend|nosocket|noupdate|nyi|os|par|params|part|pl|pwuid|splay|srv|stack|step|stop|stype|sys|threadview|unmappable|upd|user|utf8|vd1|wha|wsfull|wsm",illegalQKeywordsRegex=/^(Mlim|Q7|access|accp|adict|arch|assign|badtail|branch|cast|char|conn|constants|domain|elim|glim|globals|length|limit|locals|loop|mismatch|mq|noamend|nosocket|noupdate|nyi|os|par|params|part|pl|pwuid|splay|srv|stack|step|stop|stype|sys|threadview|unmappable|upd|user|utf8|vd1|wha|wsfull|wsm)\b/,StringStream=function(){function aa(ba,ca,da){_classCallCheck(this,aa),this.pos=this.start=0,this.string=ba,this.tabSize=ca||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=da}return _createClass(aa,[{key:"eol",value:function(){return this.pos>=this.string.length}},{key:"sol",value:function(){return this.pos==this.lineStart}},{key:"peek",value:function(){return this.string.charAt(this.pos)||void 0}},{key:"next",value:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)}},{key:"eat",value:function(ca){var ea,da=this.string.charAt(this.pos);if(ea="string"==typeof ca?da==ca:da&&(ca.test?ca.test(da):ca(da)),ea)return++this.pos,da}},{key:"eatWhile",value:function(ca){for(var da=this.pos;this.eat(ca););return this.pos>da}},{key:"eatSpace",value:function(){for(var ca=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>ca}},{key:"skipToEnd",value:function(){this.pos=this.string.length}},{key:"skipTo",value:function(ca){var da=this.string.indexOf(ca,this.pos);if(-1<da)return this.pos=da,!0}},{key:"backUp",value:function(ca){this.pos-=ca}},{key:"column",value:function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=countColumn(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0)}},{key:"indentation",value:function(){return countColumn(this.string,null,this.tabSize)-(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0)}},{key:"match",value:function(ca,da,ea){if("string"==typeof ca){var fa=function(ia){return ea?ia.toLowerCase():ia},ga=this.string.substr(this.pos,ca.length);if(fa(ga)==fa(ca))return!1!==da&&(this.pos+=ca.length),!0}else{var ba=this.string.slice(this.pos).match(ca);return ba&&0<ba.index?null:(ba&&!1!==da&&(this.pos+=ba[0].length),ba)}}},{key:"current",value:function(){return this.string.slice(this.start,this.pos)}},{key:"hideFirstChars",value:function(ca,da){this.lineStart+=ca;try{return da()}finally{this.lineStart-=ca}}},{key:"lookAhead",value:function(ca){var da=this.lineOracle;return da&&da.lookAhead(ca)}},{key:"baseToken",value:function(){var ca=this.lineOracle;return ca&&ca.baseToken(this.pos)}}]),aa}();function countColumn(aa,ba,ca,da=void 0,ea=void 0){null==ba&&(ba=aa.search(/[^\s\u00a0]/),-1==ba&&(ba=aa.length));for(var ha,fa=da||0,ga=ea||0;;){if(ha=aa.indexOf("\t",fa),0>ha||ha>=ba)return ga+(ba-fa);ga+=ha-fa,ga+=ca-ga%ca,fa=ha+1}}var State=function(){function aa(ba){var ca=ba.mode,da=ba.prevToken,ea=ba.braceDepth,fa=ba.qukeMixed,ga=ba.depth;_classCallCheck(this,aa),this.mode=ca,this.prevToken=da,this.braceDepth=ea,this.qukeMixed=fa,this.depth=ga}return _createClass(aa,[{key:"clone",value:function(){return new aa(this)}},{key:"equals",value:function(ca){return ca===this}}]),aa}(),tokenFunction=function(ba,ca){function da(db,eb){return eb.mode!==cb.afterCloseBracket&&db.match(ab,!0,!1)?(eb.mode=cb.afterVarNumSym,ua(eb,"number")):(eb.mode=cb.afterPunctuation,ua(eb,"keyword"))}function ea(db,eb,fb){return db.match(Pa,!0,!1),eb.mode=cb.afterVarNumSym,ua(eb,fb)}function fa(db,eb){for(;;){if(db.eat("\""))return eb.mode=cb.afterPunctuation,ua(eb,"string");if(db.eol())return eb.mode=cb.unclosedString,ua(eb,"string");if(!db.eat("\\"))db.next();else if(!db.eat(Ma))return db.next(),ua(eb,"error-invalidEscape")}}function ga(db,eb){return db.eat(Fa)?db.match(Ha,!0,!1):db.eat(":")&&db.match(Ga,!0,!1),eb.mode=cb.afterVarNumSym,ua(eb,"symbol")}function ha(db,eb){var fb=db.match(Oa,!0,!1);return eb.mode=cb.afterVarNumSym,Da.test(fb[0])?ua(eb,"error-datetime"):bb.test(fb[0])?ua(eb,"keyword"):Ca.test(fb[0])?ua(eb,"error-illegalKeyword"):db.eat(".")?ea(db,eb,"variable"):va&&fb[0].match(Ia)?ua(eb,"cell"):ua(eb,"variable")}function ia(db,eb){return db.match(Ka,!0)?(db.skipToEnd(),ua(eb,"toDo")):(db.skipToEnd(),ua(eb,"comment"))}function ja(db,eb){return db.eol()||db.match(Na)?(db.eatSpace(),eb.mode=cb.multilineComment,ua(eb,"error-multilineComment")):ia(db,eb)}function ka(db,eb){return db.eat("\\")&&(db.eol()||db.match(Na))?(db.eatSpace(),eb.mode=cb.SOL,ua(eb,"error-multilineComment")):(db.skipToEnd(),ua(eb,"error-multilineComment"))}function la(db,eb){return db.skipToEnd(),ua(eb,"command")}function ma(db,eb){return db.eol()||db.match(Na)?(db.eatSpace(),eb.mode=cb.commentTilEnd,db.skipToEnd(),ua(eb,"error-multilineComment")):0<eb.depth?(eb.mode=cb.afterPunctuation,ua(eb,"error-unindentedToken")):na(db,eb)}function na(db,eb){return db.match(Ja,!0,!1)?oa(db,eb):pa(db,eb)}function oa(db,eb){return db.eat(" ")?ua(eb,"command"):db.eol()?ua(eb,"command"):pa(db,eb)}function pa(db,eb){return db.skipToEnd(),ua(eb,"command")}function qa(db,eb){return db.match(ya,!1,!1)?ea(db,eb,"keyword"):db.match(Qa,!0,!1)?ua(eb,"error-reservedInContext"):db.match(Ea,!1,!1)?ea(db,eb,"variable"):db.match(Ra,!0,!1)?(eb.mode=cb.afterVarNumSym,ua(eb,"number")):(eb.mode=cb.afterPunctuation,ua(eb,"keyword"))}function ra(db,eb){return db.eatWhile(":"),eb.mode=cb.afterPunctuation,ua(eb,"keyword")}function sa(db){return db.depth--,db.mode=cb.afterCloseBracket,null}function ta(db){return db.depth++,db.mode=cb.afterOpenBracket,null}function ua(db,eb){return db.prevToken=eb,eb}var va=!!ca.isSpreadsheet,wa=/^[\[({]/,xa=/^[\])}]/,ya=/^[a-zA-Z](\.|$|(?![a-zA-Z0-9_]))/,za=/^[~!@#$%^&*:<>,\?|+=_-]/,Aa=/^[012]:/,Ba=/^(&&|\|\||(<>|[<>]=):|[~!@#$%\^&*\-_+\\,?]=)/,Ca=/^(Mlim|Q7|access|accp|adict|arch|assign|badtail|branch|cast|char|conn|constants|domain|elim|glim|globals|length|limit|locals|loop|mismatch|mq|noamend|nosocket|noupdate|nyi|os|par|params|part|pl|pwuid|splay|srv|stack|step|stop|stype|sys|threadview|unmappable|upd|user|utf8|vd1|wha|wsfull|wsm)\b/,Da=/^(asDatetime|parseDatetime)$/,Ea=/^[a-zA-Z]/,Fa=/^[a-zA-Z0-9.]/,Ga=/^[a-zA-Z0-9._/:]*/,Ha=/^[a-zA-Z0-9._]*(:[a-zA-Z0-9._/:]*)?/,Ia=/^[a-zA-Z][a-zA-Z]?[1-9][0-9]*\b/,Ja=/^([abBcCdefgopPsStTuvwWxz]|ts)\b/,Ka=/^\/*\s*@?TODO\b/i,La=/^k\)/,Ma=/^([\\\/nrt"0-7])/,Na=/^\s+$/,Oa=/^[a-zA-Z0-9_]*/,Pa=/^[a-zA-Z0-9_]*(\.[a-zA-Z0-9_]+)*\.?/,Qa=/^[a-zA-Z0-9_]+\.(abs|aj|acos|all|and|any|asc|asin|asof|atan|attr|avg|avgs|bin|binr|by|ceiling|cols|cor|cos|count|cov|cross|csv|cut|delete|deltas|desc|dev|differ|distinct|div|do|dsave|each|ej|ema|enlist|eval|except|exec|exit|exp|fby|fills|first|flip|floor|fkeys|from|get|getenv|group|gtime|hclose|hcount|hdel|hopen|hsym|iasc|idesc|if|ij|in|insert|inter|inv|key|keys|last|ljf|like|lj|load|log|lower|lsq|ltime|ltrim|mavg|max|maxs|mcount|md5|mdev|med|meta|min|mins|mmax|mmin|mmu|mod|msum|neg|next|not|null|or|over|parse|peach|pj|prd|prds|prev|prior|rand|rank|ratios|raze|read0|read1|reciprocal|reval|reverse|rload|rotate|rsave|rtrim|save|scan|scov|sdev|svar|select|set|setenv|show|signum|sin|sqrt|ss|ssr|string|sublist|sum|sums|sv|system|tables|tan|til|trim|type|uj|ungroup|union|update|upper|upsert|value|var|view|views|vs|wavg|where|while|within|wj|wsum|ww|xasc|xbar|xcol|xcols|xdesc|xexp|xgroup|xkey|xlog|xprev|xrank|asBoolean|asByte|asChar|asDate|asDatetime|asFloat|asGUID|asInt|asList|asLong|asMinute|asMonth|asReal|asSecond|asShort|asString|asSymbol|asTime|asTimespan|asTimestamp|asType|catch|INFINITY|isAtom|isBoolean|isByte|isChar|isCompound|isDate|isDatetime|isDict|isDictionary|isEmpty|isEnum|isFloat|isFunction|isGeneral|isGUID|isInfinity|isInt|isKeyedTable|isLinked|isList|isLong|isMinute|isMonth|isNull|isNumber|isReal|isSecond|isShort|isString|isSymbol|isTable|isTime|isTimespan|isTimestamp|isType|isVector|NULL|parseBoolean|parseByte|parseChar|parseDate|parseDatetime|parseFloat|parseGUID|parseInt|parseLong|parseMinute|parseMonth|parseReal|parseSecond|parseShort|parseSymbol|parseTime|parseTimespan|parseTimestamp|parseType|typeOf|typeSymbol|until|xor)(\.[a-zA-Z0-9_]+)*\.?\b/,Ra=/^([0-9]+(f|e(-?[0-9]+e?)?)?|(f|e(-?[0-9]+e?)?))/,Ta="[10]+b",Ua="0x[\\da-fA-Fa-f]*",$a=["0[nNwW][hjemdzuvtifpgn]?",Ta,Ua,"\\d{4}\\.\\d{2}([ptnm]|\\.\\d{2}([DPtdp](\\d{2}(:\\d{2}(:\\d{2}(\\.\\d{0,9})?)?)?)[pn]?|[pnd]?))","\\d{2}:\\d{2}(:\\d{2}(\\.\\d{0,9})?)?[ptnvu]?|\\d{2}[ptnvu]","\\d{1,6}D(\\d{1,2}(:\\d{2}(:\\d{2}(\\.\\d{0,9}|\\.?)?)?)?)?[np]?","\\d{1,6}P\\d{2}:\\d{2}([np]|:\\d{2}([np]|\\.[np]|\\.\\d{0,9}[np]|\\.\\d{3,9}[np]?))","(\\d+(\\.\\d*)?|\\d*\\.\\d+)(e[+-]?\\d+)[ef]?|(\\d+\\.\\d*|\\d*\\.\\d+)[ef]?|\\d+[eihjf]?"].join("|"),_a=new RegExp("^("+Ta+"|"+Ua+"|"+$a+")"),ab=new RegExp("^("+$a+")"),bb=new RegExp("^("+qFunctionKeywords+"|"+helperFunctionKeywords+(va?"":"|"+qFunctionKeywordsOutsideSheet)+")\\b"),cb={SOL:0,afterSpace:1,afterVarNumSym:2,afterPunctuation:3,unclosedString:4,multilineComment:5,commentTilEnd:6,afterOpenBracket:7,afterCloseBracket:8};return{startState:function(){return new State({mode:cb.SOL,prevToken:null,braceDepth:0,qukeMixed:!!ca.qukeMixed,depth:0})},indent:function(eb){return ba.indentUnit*eb.depth},token:function(eb,fb){if(eb.sol()&&fb.mode!==cb.commentTilEnd&&fb.mode!==cb.multilineComment&&fb.mode!==cb.unclosedString&&(fb.mode=cb.SOL,fb.prevToken="SOL"),fb.mode===cb.unclosedString)return eb.eat("\\")?ua(fb,"error-SOLBackslashInString"):fa(eb,fb);if(fb.mode===cb.SOL){if(eb.eatSpace())return fb.mode=cb.afterSpace,null;if(eb.eat("/"))return ja(eb,fb);if(!fb.qukeMixed&&0<fb.depth&&")"!==eb.peek()&&"]"!==eb.peek()&&"}"!==eb.peek())return eb.next(),ua(fb,"error-unindentedToken");if(eb.match(La,!1,!1))return la(eb,fb);if(eb.match(Ea,!1,!1))return ha(eb,fb);if(eb.eat(";"))return fb.mode=cb.afterPunctuation,null;if(eb.eat("\\"))return ma(eb,fb);if(eb.eat("`"))return ga(eb,fb);if(eb.eat("."))return qa(eb,fb);if(eb.eat("\""))return fa(eb,fb);if(eb.eat("'"))return ra(eb,fb);if(eb.eat("-"))return da(eb,fb);if(eb.match(Ba,!0,!1))return fb.mode=cb.afterPunctuation,ua(fb,"error");if(eb.eat(za))return fb.mode=cb.afterPunctuation,ua(fb,"keyword");if(eb.eat(wa))return ta(fb);if(eb.eat(xa))return sa(fb),ua(fb,"error-unindentedToken");if(eb.match(Aa,!0,!1))return fb.mode=cb.afterPunctuation,ua(fb,"keyword");if(eb.match(_a,!0,!1))return fb.mode=cb.afterVarNumSym,ua(fb,"number")}else if(fb.mode===cb.afterSpace){if(eb.eatSpace(),eb.match(Ea,!1,!1))return ha(eb,fb);if(eb.eat(";"))return fb.mode=cb.afterPunctuation,null;if(eb.eat("/"))return ia(eb,fb);if(eb.eat("`"))return ga(eb,fb);if(eb.eat("."))return qa(eb,fb);if(eb.eat("\""))return fa(eb,fb);if("\\"===eb.peek()&&"SOL"===fb.prevToken)return eb.next(),ua(fb,"error-indentedCommand");if(eb.eat(/['\\]/))return ra(eb,fb);if(eb.eat("-"))return da(eb,fb);if(eb.match(Ba,!0,!1))return fb.mode=cb.afterPunctuation,ua(fb,"error");if(eb.eat(za))return fb.mode=cb.afterPunctuation,ua(fb,"keyword");if(eb.eat(wa))return ta(fb);if(eb.eat(xa))return sa(fb);if(eb.match(Aa,!0,!1))return fb.mode=cb.afterPunctuation,ua(fb,"keyword");if(eb.match(_a,!0,!1))return fb.mode=cb.afterVarNumSym,ua(fb,"number")}else if(fb.mode===cb.afterVarNumSym){if(eb.eatSpace())return fb.mode=cb.afterSpace,null;if(eb.eat(";"))return fb.mode=cb.afterPunctuation,null;if(eb.eat("`"))return ga(eb,fb);if(eb.eat("\""))return fa(eb,fb);if(eb.eat(/['/\\]/))return ra(eb,fb);if(eb.match(Ba,!0,!1))return fb.mode=cb.afterPunctuation,ua(fb,"error");if(eb.eat(za))return fb.mode=cb.afterPunctuation,ua(fb,"keyword");if(eb.eat(wa))return ta(fb);if(eb.eat(xa))return sa(fb);if(eb.match(/^[Tz]/))return fb.mode=cb.afterPunctuation,ua(fb,"error-datetime")}else if(fb.mode===cb.afterPunctuation||fb.mode===cb.afterOpenBracket||fb.mode===cb.afterCloseBracket){if(eb.eatSpace())return fb.mode=cb.afterSpace,null;if(eb.match(Ea,!1,!1))return ha(eb,fb);if(eb.eat(";"))return fb.mode=cb.afterPunctuation,null;if(eb.eat("`"))return ga(eb,fb);if(eb.eat("."))return qa(eb,fb);if(eb.eat("\""))return fa(eb,fb);if(eb.eat(/['/\\]/))return ra(eb,fb);if(eb.eat("-"))return da(eb,fb);if(eb.match(Ba,!0,!1))return fb.mode=cb.afterPunctuation,ua(fb,"error");if(eb.eat(za))return fb.mode=cb.afterPunctuation,ua(fb,"keyword");if(eb.eat(wa))return ta(fb);if(eb.eat(xa))return sa(fb);if(eb.match(Aa,!0,!1))return fb.mode=cb.afterPunctuation,ua(fb,"keyword");if(eb.match(_a,!0,!1))return fb.mode=cb.afterVarNumSym,ua(fb,"number")}else{if(fb.mode===cb.commentTilEnd)return eb.skipToEnd(),ua(fb,"comment");if(fb.mode===cb.multilineComment)return ka(eb,fb)}return eb.next()}}},tokenizer=tokenFunction({},{name:"q",isSpreadsheet:"false"});self.addEventListener("message",function(aa){for(var ba=aa.data,ca=ba.code,da=ba.version,ea=ca.split("\n"),fa=[],ga=tokenizer.startState(),ha=0;ha<ea.length;ha++){for(var ia=[],ja=new StringStream(ea[ha]);!ja.eol();){var ka=tokenizer.token(ja,ga),la=generateMarker(ka,ja,ha,ga);la&&ia.push(la),ja.start=ja.pos}ia[0]&&"Unindented token found where an intended token was expected"===ia[0].message?fa.push(ia[0]):fa.push(ia)}self.postMessage({markers:[].concat.apply([],fa),version:da})});function generateMarker(aa,ba,ca){var ea,fa=ba.string.substr(ba.start,ba.pos-ba.start);switch(aa){case"error-invalidEscape":ea="Invalid escape sequence\nValid escape sequences are \\n, \\r, \\t, \\/, \\\\,\nand three digit octal sequences";break;case"error-illegalKeyword":ea="\""+fa+"\" is an error thrown by q\nUsing it as a variable name can cause ambiguous error messages";break;case"error-SOLBackslashInString":ea="\\ is not allowed as the first character on a line in a multi-line string";break;case"error-indentedCommand":ea="Commands cannot be indented";break;case"error-unindentedToken":ea="Unindented token found where an intended token was expected";break;case"error-datetime":ea="The datetime type is deprecated. Use timestamp instead.";break;case"error-reservedInContext":ea="Reserved words cannot be used here, as it will cause issues when using contexts";break;case"error":ea=illegalQKeywordsRegex.test(fa)?fa+" is a reserved word":/^(<>|[<>]=):/.test(aa.text)?"The use of "+aa.text+" is not recommended, as it does not assign its result":"&&"===fa?"&& is not a logical operator in q. Use & or \"and\" instead.":"||"===fa?"|| is not a logical operator in q. Use | or \"or\" instead.":/^[~!@#$%\^&*\-_+\\,?]=$/.test(fa)?"Compound assignment operators in q use : instead of =":"Invalid token: "+fa;break;default:return;}return{severity:8,message:ea,startColumn:ba.start+1,endColumm:ba.pos+1,startLineNumber:ca+1,endLineNumber:ca+1}}