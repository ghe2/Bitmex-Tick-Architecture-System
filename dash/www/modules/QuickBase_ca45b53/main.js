define(["backbone","Handlebars","dashMoment","fflate","css!./css/app.css"],function(m,s,p,R){var U,F,q,Y,H,K,z,W,Q,j,f,G,X,Z,J,tt,et,nt,it,l=this&&this.__extends||(U=function(t,e){return(U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}U(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),ot=this&&this.__assign||function(){return(ot=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},rt=function(){var t;function y(t,e,n){null!=t&&("number"==typeof t?this.fromNumber(t,e,n):null==e&&"string"!=typeof t?this.fromBytes(t):this.fromString(t,e))}function v(){return new y(null)}t="Microsoft Internet Explorer"==navigator.appName?(y.prototype.am=function(t,e,n,i,o,r){for(var s=32767&e,a=e>>15;0<=--r;){var l=32767&this[t],u=this[t++]>>15,c=a*l+u*s;o=((l=s*l+((32767&c)<<15)+n[i]+(1073741823&o))>>>30)+(c>>>15)+a*u+(o>>>30),n[i++]=1073741823&l}return o},30):"Netscape"!=navigator.appName?(y.prototype.am=function(t,e,n,i,o,r){for(;0<=--r;){var s=e*this[t++]+n[i]+o;o=Math.floor(s/67108864),n[i++]=67108863&s}return o},26):(y.prototype.am=function(t,e,n,i,o,r){for(var s=16383&e,a=e>>14;0<=--r;){var l=16383&this[t],u=this[t++]>>14,c=a*l+u*s;o=((l=s*l+((16383&c)<<14)+n[i]+o)>>28)+(c>>14)+a*u,n[i++]=268435455&l}return o},28),y.prototype.DB=t,y.prototype.DM=(1<<t)-1,y.prototype.DV=1<<t;y.prototype.FV=Math.pow(2,52),y.prototype.F1=52-t,y.prototype.F2=2*t-52;for(var e="0123456789abcdefghijklmnopqrstuvwxyz",n=new Array,i="0".charCodeAt(0),o=0;o<=9;++o)n[i++]=o;for(i="a".charCodeAt(0),o=10;o<36;++o)n[i++]=o;for(i="A".charCodeAt(0),o=10;o<36;++o)n[i++]=o;function l(t){return e.charAt(t)}function u(t,e){t=n[t.charCodeAt(e)];return null==t?-1:t}function m(t){var e=v();return e.fromInt(t),e}function b(t){var e,n=1;return 0!=(e=t>>>16)&&(t=e,n+=16),0!=(e=t>>8)&&(t=e,n+=8),0!=(e=t>>4)&&(t=e,n+=4),0!=(e=t>>2)&&(t=e,n+=2),0!=(e=t>>1)&&(t=e,n+=1),n}function w(t){this.m=t}function S(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function r(t,e){return t&e}function s(t,e){return t|e}function a(t,e){return t^e}function c(t,e){return t&~e}function p(){}function d(t){return t}function _(t){this.r2=v(),this.q3=v(),y.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}w.prototype.convert=function(t){return t.s<0||0<=t.compareTo(this.m)?t.mod(this.m):t},w.prototype.revert=function(t){return t},w.prototype.reduce=function(t){t.divRemTo(this.m,null,t)},w.prototype.mulTo=function(t,e,n){t.multiplyTo(e,n),this.reduce(n)},w.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)},S.prototype.convert=function(t){var e=v();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&0<e.compareTo(y.ZERO)&&this.m.subTo(e,e),e},S.prototype.revert=function(t){var e=v();return t.copyTo(e),this.reduce(e),e},S.prototype.reduce=function(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var e=0;e<this.m.t;++e){var n=32767&t[e],i=n*this.mpl+((n*this.mph+(t[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(t[n=e+this.m.t]+=this.m.am(0,i,t,e,0,this.m.t);t[n]>=t.DV;)t[n]-=t.DV,t[++n]++}t.clamp(),t.drShiftTo(this.m.t,t),0<=t.compareTo(this.m)&&t.subTo(this.m,t)},S.prototype.mulTo=function(t,e,n){t.multiplyTo(e,n),this.reduce(n)},S.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)},y.prototype.copyTo=function(t){for(var e=this.t-1;0<=e;--e)t[e]=this[e];t.t=this.t,t.s=this.s},y.prototype.fromInt=function(t){this.t=1,this.s=t<0?-1:0,0<t?this[0]=t:t<-1?this[0]=t+this.DV:this.t=0},y.prototype.fromString=function(t,e){var n;if(16==e)n=4;else if(8==e)n=3;else if(256==e)n=8;else if(2==e)n=1;else if(32==e)n=5;else{if(4!=e)return void this.fromRadix(t,e);n=2}this.t=0,this.s=0;for(var i=t.length,o=!1,r=0;0<=--i;){var s=8==n?255&t[i]:u(t,i);s<0?"-"==t.charAt(i)&&(o=!0):(o=!1,0==r?this[this.t++]=s:r+n>this.DB?(this[this.t-1]|=(s&(1<<this.DB-r)-1)<<r,this[this.t++]=s>>this.DB-r):this[this.t-1]|=s<<r,(r+=n)>=this.DB&&(r-=this.DB))}8==n&&0!=(128&t[0])&&(this.s=-1,0<r&&(this[this.t-1]|=(1<<this.DB-r)-1<<r)),this.clamp(),o&&y.ZERO.subTo(this,this)},y.prototype.fromBytes=function(t){this.t=0;for(var e=-1,n=this.s=0;++e<t.length;){var i=255&t[e];0==n?this[this.t++]=i:n+8>this.DB?(this[this.t-1]|=(i&(1<<this.DB-n)-1)<<n,this[this.t++]=i>>this.DB-n):this[this.t-1]|=i<<n,(n+=8)>=this.DB&&(n-=this.DB)}0!=(128&t[t.length-1])&&(this.s=-1,0<n&&(this[this.t-1]|=(1<<this.DB-n)-1<<n)),this.clamp()},y.prototype.clamp=function(){for(var t=this.s&this.DM;0<this.t&&this[this.t-1]==t;)--this.t},y.prototype.dlShiftTo=function(t,e){for(var n=this.t-1;0<=n;--n)e[n+t]=this[n];for(n=t-1;0<=n;--n)e[n]=0;e.t=this.t+t,e.s=this.s},y.prototype.drShiftTo=function(t,e){for(var n=t;n<this.t;++n)e[n-t]=this[n];e.t=Math.max(this.t-t,0),e.s=this.s},y.prototype.lShiftTo=function(t,e){for(var n=t%this.DB,i=this.DB-n,o=(1<<i)-1,r=Math.floor(t/this.DB),s=this.s<<n&this.DM,a=this.t-1;0<=a;--a)e[a+r+1]=this[a]>>i|s,s=(this[a]&o)<<n;for(a=r-1;0<=a;--a)e[a]=0;e[r]=s,e.t=this.t+r+1,e.s=this.s,e.clamp()},y.prototype.rShiftTo=function(t,e){e.s=this.s;var n=Math.floor(t/this.DB);if(n>=this.t)e.t=0;else{var i=t%this.DB,o=this.DB-i,r=(1<<i)-1;e[0]=this[n]>>i;for(var s=n+1;s<this.t;++s)e[s-n-1]|=(this[s]&r)<<o,e[s-n]=this[s]>>i;0<i&&(e[this.t-n-1]|=(this.s&r)<<o),e.t=this.t-n,e.clamp()}},y.prototype.subTo=function(t,e){for(var n=0,i=0,o=Math.min(t.t,this.t);n<o;)i+=this[n]-t[n],e[n++]=i&this.DM,i>>=this.DB;if(t.t<this.t){for(i-=t.s;n<this.t;)i+=this[n],e[n++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;n<t.t;)i-=t[n],e[n++]=i&this.DM,i>>=this.DB;i-=t.s}e.s=i<0?-1:0,i<-1?e[n++]=this.DV+i:0<i&&(e[n++]=i),e.t=n,e.clamp()},y.prototype.multiplyTo=function(t,e){var n=this.abs(),i=t.abs(),o=n.t;for(e.t=o+i.t;0<=--o;)e[o]=0;for(o=0;o<i.t;++o)e[o+n.t]=n.am(0,i[o],e,o,0,n.t);e.s=0,e.clamp(),this.s!=t.s&&y.ZERO.subTo(e,e)},y.prototype.squareTo=function(t){for(var e=this.abs(),n=t.t=2*e.t;0<=--n;)t[n]=0;for(n=0;n<e.t-1;++n){var i=e.am(n,e[n],t,2*n,0,1);(t[n+e.t]+=e.am(n+1,2*e[n],t,2*n+1,i,e.t-n-1))>=e.DV&&(t[n+e.t]-=e.DV,t[n+e.t+1]=1)}0<t.t&&(t[t.t-1]+=e.am(n,e[n],t,2*n,0,1)),t.s=0,t.clamp()},y.prototype.divRemTo=function(t,e,n){var i=t.abs();if(!(i.t<=0)){var o=this.abs();if(o.t<i.t)return null!=e&&e.fromInt(0),void(null!=n&&this.copyTo(n));null==n&&(n=v());var r=v(),s=this.s,t=t.s,a=this.DB-b(i[i.t-1]),l=(0<a?(i.lShiftTo(a,r),o.lShiftTo(a,n)):(i.copyTo(r),o.copyTo(n)),r.t),u=r[l-1];if(0!=u){var i=u*(1<<this.F1)+(1<l?r[l-2]>>this.F2:0),c=this.FV/i,p=(1<<this.F1)/i,d=1<<this.F2,h=n.t,g=h-l,f=null==e?v():e;for(r.dlShiftTo(g,f),0<=n.compareTo(f)&&(n[n.t++]=1,n.subTo(f,n)),y.ONE.dlShiftTo(l,f),f.subTo(r,r);r.t<l;)r[r.t++]=0;for(;0<=--g;){var m=n[--h]==u?this.DM:Math.floor(n[h]*c+(n[h-1]+d)*p);if((n[h]+=r.am(0,m,n,g,0,l))<m)for(r.dlShiftTo(g,f),n.subTo(f,n);n[h]<--m;)n.subTo(f,n)}null!=e&&(n.drShiftTo(l,e),s!=t&&y.ZERO.subTo(e,e)),n.t=l,n.clamp(),0<a&&n.rShiftTo(a,n),s<0&&y.ZERO.subTo(n,n)}}},y.prototype.invDigit=function(){if(this.t<1)return 0;var t=this[0];if(0==(1&t))return 0;var e=3&t;return 0<(e=(e=(e=(e=e*(2-(15&t)*e)&15)*(2-(255&t)*e)&255)*(2-((65535&t)*e&65535))&65535)*(2-t*e%this.DV)%this.DV)?this.DV-e:-e},y.prototype.isEven=function(){return 0==(0<this.t?1&this[0]:this.s)},y.prototype.exp=function(t,e){if(4294967295<t||t<1)return y.ONE;var n,i=v(),o=v(),r=e.convert(this),s=b(t)-1;for(r.copyTo(i);0<=--s;)e.sqrTo(i,o),0<(t&1<<s)?e.mulTo(o,r,i):(n=i,i=o,o=n);return e.revert(i)},y.prototype.toString=function(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(16==t)e=4;else if(8==t)e=3;else if(2==t)e=1;else if(32==t)e=5;else{if(4!=t)return this.toRadix(t);e=2}var n,i=(1<<e)-1,o=!1,r="",s=this.t,a=this.DB-s*this.DB%e;if(0<s--)for(a<this.DB&&0<(n=this[s]>>a)&&(o=!0,r=l(n));0<=s;)a<e?(n=(this[s]&(1<<a)-1)<<e-a,n|=this[--s]>>(a+=this.DB-e)):(n=this[s]>>(a-=e)&i,a<=0&&(a+=this.DB,--s)),(o=0<n?!0:o)&&(r+=l(n));return o?r:"0"},y.prototype.negate=function(){var t=v();return y.ZERO.subTo(this,t),t},y.prototype.abs=function(){return this.s<0?this.negate():this},y.prototype.compareTo=function(t){var e=this.s-t.s;if(0!=e)return e;var n=this.t;if(0!=(e=n-t.t))return this.s<0?-e:e;for(;0<=--n;)if(0!=(e=this[n]-t[n]))return e;return 0},y.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+b(this[this.t-1]^this.s&this.DM)},y.prototype.mod=function(t){var e=v();return this.abs().divRemTo(t,null,e),this.s<0&&0<e.compareTo(y.ZERO)&&t.subTo(e,e),e},y.prototype.modPowInt=function(t,e){return e=new(t<256||e.isEven()?w:S)(e),this.exp(t,e)},y.ZERO=m(0),y.ONE=m(1),p.prototype.convert=d,p.prototype.revert=d,p.prototype.mulTo=function(t,e,n){t.multiplyTo(e,n)},p.prototype.sqrTo=function(t,e){t.squareTo(e)},_.prototype.convert=function(t){var e;return t.s<0||t.t>2*this.m.t?t.mod(this.m):t.compareTo(this.m)<0?t:(e=v(),t.copyTo(e),this.reduce(e),e)},_.prototype.revert=function(t){return t},_.prototype.reduce=function(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);0<=t.compareTo(this.m);)t.subTo(this.m,t)},_.prototype.mulTo=function(t,e,n){t.multiplyTo(e,n),this.reduce(n)},_.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)};var h=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],g=(1<<26)/h[h.length-1];return y.prototype.chunkSize=function(t){return Math.floor(Math.LN2*this.DB/Math.log(t))},y.prototype.toRadix=function(t){if(null==t&&(t=10),0==this.signum()||t<2||36<t)return"0";var e=this.chunkSize(t),n=Math.pow(t,e),i=m(n),o=v(),r=v(),s="";for(this.divRemTo(i,o,r);0<o.signum();)s=(n+r.intValue()).toString(t).substr(1)+s,o.divRemTo(i,o,r);return r.intValue().toString(t)+s},y.prototype.fromRadix=function(t,e){this.fromInt(0);for(var n=this.chunkSize(e=null==e?10:e),i=Math.pow(e,n),o=!1,r=0,s=0,a=0;a<t.length;++a){var l=u(t,a);l<0?"-"==t.charAt(a)&&0==this.signum()&&(o=!0):(s=e*s+l,++r>=n&&(this.dMultiply(i),this.dAddOffset(s,0),s=r=0))}0<r&&(this.dMultiply(Math.pow(e,r)),this.dAddOffset(s,0)),o&&y.ZERO.subTo(this,this)},y.prototype.fromNumber=function(t,e,n){if("number"==typeof e)if(t<2)this.fromInt(1);else for(this.fromNumber(t,n),this.testBit(t-1)||this.bitwiseTo(y.ONE.shiftLeft(t-1),s,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(y.ONE.shiftLeft(t-1),this);else{var n=new Array,i=7&t;n.length=1+(t>>3),e.nextBytes(n),0<i?n[0]&=(1<<i)-1:n[0]=0,this.fromString(n,256)}},y.prototype.bitwiseTo=function(t,e,n){for(var i,o=Math.min(t.t,this.t),r=0;r<o;++r)n[r]=e(this[r],t[r]);if(t.t<this.t){for(i=t.s&this.DM,r=o;r<this.t;++r)n[r]=e(this[r],i);n.t=this.t}else{for(i=this.s&this.DM,r=o;r<t.t;++r)n[r]=e(i,t[r]);n.t=t.t}n.s=e(this.s,t.s),n.clamp()},y.prototype.changeBit=function(t,e){return t=y.ONE.shiftLeft(t),this.bitwiseTo(t,e,t),t},y.prototype.addTo=function(t,e){for(var n=0,i=0,o=Math.min(t.t,this.t);n<o;)i+=this[n]+t[n],e[n++]=i&this.DM,i>>=this.DB;if(t.t<this.t){for(i+=t.s;n<this.t;)i+=this[n],e[n++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;n<t.t;)i+=t[n],e[n++]=i&this.DM,i>>=this.DB;i+=t.s}e.s=i<0?-1:0,0<i?e[n++]=i:i<-1&&(e[n++]=this.DV+i),e.t=n,e.clamp()},y.prototype.dMultiply=function(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()},y.prototype.dAddOffset=function(t,e){if(0!=t){for(;this.t<=e;)this[this.t++]=0;for(this[e]+=t;this[e]>=this.DV;)this[e]-=this.DV,++e>=this.t&&(this[this.t++]=0),++this[e]}},y.prototype.multiplyLowerTo=function(t,e,n){var i,o=Math.min(this.t+t.t,e);for(n.s=0,n.t=o;0<o;)n[--o]=0;for(i=n.t-this.t;o<i;++o)n[o+this.t]=this.am(0,t[o],n,o,0,this.t);for(i=Math.min(t.t,e);o<i;++o)this.am(0,t[o],n,o,0,e-o);n.clamp()},y.prototype.multiplyUpperTo=function(t,e,n){var i=n.t=this.t+t.t- --e;for(n.s=0;0<=--i;)n[i]=0;for(i=Math.max(e-this.t,0);i<t.t;++i)n[this.t+i-e]=this.am(e-i,t[i],n,0,0,this.t+i-e);n.clamp(),n.drShiftTo(1,n)},y.prototype.modInt=function(t){if(t<=0)return 0;var e=this.DV%t,n=this.s<0?t-1:0;if(0<this.t)if(0==e)n=this[0]%t;else for(var i=this.t-1;0<=i;--i)n=(e*n+this[i])%t;return n},y.prototype.millerRabin=function(t){var e=this.subtract(y.ONE),n=e.getLowestSetBit();if(n<=0)return!1;for(var i=e.shiftRight(n),o=(h.length<(t=t+1>>1)&&(t=h.length),v()),r=0;r<t;++r){o.fromInt(h[Math.floor(Math.random()*h.length)]);var s=o.modPow(i,this);if(0!=s.compareTo(y.ONE)&&0!=s.compareTo(e)){for(var a=1;a++<n&&0!=s.compareTo(e);)if(0==(s=s.modPowInt(2,this)).compareTo(y.ONE))return!1;if(0!=s.compareTo(e))return!1}}return!0},y.prototype.clone=function(){var t=v();return this.copyTo(t),t},y.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},y.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},y.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},y.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},y.prototype.toByteArray=function(){var t,e=this.t,n=new Array,i=(n[0]=this.s,this.DB-e*this.DB%8),o=0;if(0<e--)for(i<this.DB&&(t=this[e]>>i)!=(this.s&this.DM)>>i&&(n[o++]=t|this.s<<this.DB-i);0<=e;)i<8?(t=(this[e]&(1<<i)-1)<<8-i,t|=this[--e]>>(i+=this.DB-8)):(t=this[e]>>(i-=8)&255,i<=0&&(i+=this.DB,--e)),0!=(128&t)&&(t|=-256),0==o&&(128&this.s)!=(128&t)&&++o,(0<o||t!=this.s)&&(n[o++]=t);return n},y.prototype.equals=function(t){return 0==this.compareTo(t)},y.prototype.min=function(t){return this.compareTo(t)<0?this:t},y.prototype.max=function(t){return 0<this.compareTo(t)?this:t},y.prototype.and=function(t){var e=v();return this.bitwiseTo(t,r,e),e},y.prototype.or=function(t){var e=v();return this.bitwiseTo(t,s,e),e},y.prototype.xor=function(t){var e=v();return this.bitwiseTo(t,a,e),e},y.prototype.andNot=function(t){var e=v();return this.bitwiseTo(t,c,e),e},y.prototype.not=function(){for(var t=v(),e=0;e<this.t;++e)t[e]=this.DM&~this[e];return t.t=this.t,t.s=~this.s,t},y.prototype.shiftLeft=function(t){var e=v();return t<0?this.rShiftTo(-t,e):this.lShiftTo(t,e),e},y.prototype.shiftRight=function(t){var e=v();return t<0?this.lShiftTo(-t,e):this.rShiftTo(t,e),e},y.prototype.getLowestSetBit=function(){for(var t=0;t<this.t;++t)if(0!=this[t])return t*this.DB+function(t){if(0==t)return-1;var e=0;return 0==(65535&t)&&(t>>=16,e+=16),0==(255&t)&&(t>>=8,e+=8),0==(15&t)&&(t>>=4,e+=4),0==(3&t)&&(t>>=2,e+=2),0==(1&t)&&++e,e}(this[t]);return this.s<0?this.t*this.DB:-1},y.prototype.bitCount=function(){for(var t=0,e=this.s&this.DM,n=0;n<this.t;++n)t+=function(t){for(var e=0;0!=t;)t&=t-1,++e;return e}(this[n]^e);return t},y.prototype.testBit=function(t){var e=Math.floor(t/this.DB);return e>=this.t?0!=this.s:0!=(this[e]&1<<t%this.DB)},y.prototype.setBit=function(t){return this.changeBit(t,s)},y.prototype.clearBit=function(t){return this.changeBit(t,c)},y.prototype.flipBit=function(t){return this.changeBit(t,a)},y.prototype.add=function(t){var e=v();return this.addTo(t,e),e},y.prototype.subtract=function(t){var e=v();return this.subTo(t,e),e},y.prototype.multiply=function(t){var e=v();return this.multiplyTo(t,e),e},y.prototype.divide=function(t){var e=v();return this.divRemTo(t,e,null),e},y.prototype.remainder=function(t){var e=v();return this.divRemTo(t,null,e),e},y.prototype.divideAndRemainder=function(t){var e=v(),n=v();return this.divRemTo(t,e,n),new Array(e,n)},y.prototype.modPow=function(t,e){var n=t.bitLength(),i=m(1);if(n<=0)return i;var o=n<18?1:n<48?3:n<144?4:n<768?5:6,r=new(n<8?w:e.isEven()?_:S)(e),s=new Array,a=3,l=o-1,u=(1<<o)-1;if(s[1]=r.convert(this),1<o){var c=v();for(r.sqrTo(s[1],c);a<=u;)s[a]=v(),r.mulTo(c,s[a-2],s[a]),a+=2}for(var p,d,h=t.t-1,g=!0,f=v(),n=b(t[h])-1;0<=h;){for(l<=n?p=t[h]>>n-l&u:(p=(t[h]&(1<<n+1)-1)<<l-n,0<h&&(p|=t[h-1]>>this.DB+n-l)),a=o;0==(1&p);)p>>=1,--a;if((n-=a)<0&&(n+=this.DB,--h),g)s[p].copyTo(i),g=!1;else{for(;1<a;)r.sqrTo(i,f),r.sqrTo(f,i),a-=2;0<a?r.sqrTo(i,f):(d=i,i=f,f=d),r.mulTo(f,s[p],i)}for(;0<=h&&0==(t[h]&1<<n);)r.sqrTo(i,f),d=i,i=f,f=d,--n<0&&(n=this.DB-1,--h)}return r.revert(i)},y.prototype.modInverse=function(t){var e=t.isEven();if(this.isEven()&&e||0==t.signum())return y.ZERO;for(var n=t.clone(),i=this.clone(),o=m(1),r=m(0),s=m(0),a=m(1);0!=n.signum();){for(;n.isEven();)n.rShiftTo(1,n),e?(o.isEven()&&r.isEven()||(o.addTo(this,o),r.subTo(t,r)),o.rShiftTo(1,o)):r.isEven()||r.subTo(t,r),r.rShiftTo(1,r);for(;i.isEven();)i.rShiftTo(1,i),e?(s.isEven()&&a.isEven()||(s.addTo(this,s),a.subTo(t,a)),s.rShiftTo(1,s)):a.isEven()||a.subTo(t,a),a.rShiftTo(1,a);0<=n.compareTo(i)?(n.subTo(i,n),e&&o.subTo(s,o),r.subTo(a,r)):(i.subTo(n,i),e&&s.subTo(o,s),a.subTo(r,a))}return 0!=i.compareTo(y.ONE)?y.ZERO:0<=a.compareTo(t)?a.subtract(t):a.signum()<0?(a.addTo(t,a),a.signum()<0?a.add(t):a):a},y.prototype.pow=function(t){return this.exp(t,new p)},y.prototype.gcd=function(t){var e=this.s<0?this.negate():this.clone(),n=t.s<0?t.negate():t.clone(),i=(e.compareTo(n)<0&&(t=e,e=n,n=t),e.getLowestSetBit());if((t=n.getLowestSetBit())<0)return e;for(0<(t=i<t?i:t)&&(e.rShiftTo(t,e),n.rShiftTo(t,n));0<e.signum();)0<(i=e.getLowestSetBit())&&e.rShiftTo(i,e),0<(i=n.getLowestSetBit())&&n.rShiftTo(i,n),0<=e.compareTo(n)?(e.subTo(n,e),e.rShiftTo(1,e)):(n.subTo(e,n),n.rShiftTo(1,n));return 0<t&&n.lShiftTo(t,n),n},y.prototype.isProbablePrime=function(t){var e,n=this.abs();if(1==n.t&&n[0]<=h[h.length-1]){for(e=0;e<h.length;++e)if(n[0]==h[e])return!0;return!1}if(n.isEven())return!1;for(e=1;e<h.length;){for(var i=h[e],o=e+1;o<h.length&&i<g;)i*=h[o++];for(i=n.modInt(i);e<o;)if(i%h[e++]==0)return!1}return n.millerRabin(t)},y.prototype.square=function(){var t=v();return this.squareTo(t),t},{BigInteger:y}}(),st={VALUE_CREATED:"created",VALUE_UPDATED:"updated",VALUE_DELETED:"deleted",VALUE_UNCHANGED:"unchanged",getDiff:function(t,e){return this.removeUnchanged(this.map(t,e))},map:function(t,e){if(this.isFunction(t)||this.isFunction(e))throw"Invalid argument. Function given, object expected.";if(this.isValue(t)||this.isValue(e))return _.clone(void 0===t?e:t);var n,i,o={};for(i in t)this.isFunction(t[i])||((n=void 0)!==e[i]&&(n=e[i]),"_Hidden"===i?o[i]=t[i]:"unchanged"!==this.compareValues(t[i],n)?o[i]=this.map(t[i],n):o[i]=null);for(i in e)this.isFunction(e[i])||void 0!==o[i]||(o[i]=this.map(void 0,e[i]));return o},compareValues:function(t,e){return t===e||this.isDate(t)&&this.isDate(e)&&t.getTime()===e.getTime()?this.VALUE_UNCHANGED:void 0===t?this.VALUE_CREATED:void 0===e?this.VALUE_DELETED:this.VALUE_UPDATED},isFunction:function(t){return"[object Function]"==={}.toString.apply(t)},isArray:function(t){return"[object Array]"==={}.toString.apply(t)},isDate:function(t){return"[object Date]"==={}.toString.apply(t)},isObject:function(t){return"[object Object]"==={}.toString.apply(t)},isValue:function(t){return!this.isObject(t)&&!this.isArray(t)},removeUnchangedJSON:function(n){_.each(n,_.bind(function(t,e){_.isEqual(t,{})||_.isEqual([],t)||null===t?delete n[e]:_.isArray(t)||"string"==typeof t||this.removeUnchangedJSON(n[e])},this))},removeUsedKeys:function(t){for(var e in t)null!==t[e]&&"object"==typeof t[e]&&(this.removeUsedKeys(t[e]),_.isEqual(t[e],{})&&delete t[e]),null===t[e]&&delete t[e]},removeUnchanged:function(t){var n={},i=["string","number","boolean"];return _.each(t,_.bind(function(t,e){0<=_.indexOf(i,typeof t)||null===t&&_.isArray(t)?n[e]=t:n[e]=_.pickBy(t,function(t,e){return null!==t})},this)),this.removeUsedKeys(n),n}};function at(t){return encodeURIComponent(t)}function lt(t,e){t=function(t){0===t.indexOf('"')&&(t=t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return t=decodeURIComponent(t.replace(q," "))}catch(t){}}(t);return F.isFunction(e)?e(t):t}function a(){}function ut(t,e,n,i){i=H.call(this,i,t)||this;return i.isSorted=e,i.length=n,i}function ct(t){switch(t){case 1:case 4:case 10:return 1;case 5:return 2;case 6:case 8:case 13:case 14:case 17:case 18:case 19:return 4;case 7:case 9:case 12:case 15:case 16:return 8;case 2:return 16;default:return}}function pt(t){for(var e,n,i,o="",r=0;r<t.length;r++)switch((e=t[r])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(e);break;case 12:case 13:n=t[++r],o+=String.fromCharCode((31&e)<<6|63&n);break;case 14:n=t[++r],i=t[++r],o+=String.fromCharCode((15&e)<<12|(63&n)<<6|(63&i)<<0)}return o}function y(){return null!==G&&G.apply(this,arguments)||this}function dt(t){var e=X.call(this,t)||this;return e.cssClass=t.cssClass,e.anchorEl=t.anchorEl,e.data=t.data||{},e.text=t.text,e.position=t.position,e.$el.addClass("generic-tooltip "+e.cssClass),e.$el.appendTo("#appdiv"),e.compileTemplate(),e}"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){"use strict";if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),i=1;i<arguments.length;i++){var o=arguments[i];if(null!=o)for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(n[r]=o[r])}return n},writable:!0,configurable:!0}),function(t){function s(){}s.binarySearch=function(t,e,n,i){i=s.getComparator(i,n);return s.binarySearch2(t,e,i)},s.binarySearch2=function(t,e,n){for(var i,o,r=0,s=e.length-1;r<=s;)if(0<(i=n(t,e[o=s+r>>1])))r=1+o;else{if(!(i<0))return o;s=o-1}return-r-1},s.calcDialogHeight=function(t,e){e="FSBL"in window?window.finApi.getDialogHeightOffset(e):40;return window.innerHeight<t+e?window.innerHeight-e:t},s.calculateFontContrast=function(t){var e="",n=0===t.indexOf("#"),i=0===t.indexOf("rgb")||0===t.indexOf("rgba");return e=t&&(n||i)&&(i=n?s.hex2RGB(t):s.rgbStr2Array(t)).length?125<Math.round((299*parseInt(String(i[0]))+587*parseInt(String(i[1]))+114*parseInt(String(i[2])))/1e3)?n?s.getDefaultThemeColors("Dark")[0]:"rgb(40,40,40)":n?s.getDefaultThemeColors("Light")[0]:"rgb(15,15,15)":e},s.clickEvent=function(t){var e=this.hasTouch();return t?e?"touchend mouseup":"click":e?"touchstart click":"click"},s.compress=function(t){t=R.strToU8(t);return R.deflateSync(t,{level:9})},s.convertDateStringValueToMoment=function(t,e){return p.tz(t,e||"UTC")},s.convertISODatetimeToKDBLikeObject=function(t){var e=this.TIME_RX.exec(t),e=_.filter(e,function(t){return void 0!==t});return!e||e.length<2?t:s.convertValueToMoment(t).toKdbObject()},s.convertKDBTemporalToMoment=function(t){var e,n=!1;if(t&&_.isNumber(t.i)&&_.includes(s.Types.kdbTemporals,t.class)){switch(t.class){case"1212":(e=p.tz(t.i,"UTC")).nanoseconds(t.n%1e6),n=!0;break;case"1213":(e=p.tz("2000-01-01","UTC")).add(t.i,"month");break;case"1214":e=p.tz(t.toString(),"UTC");break;case"1216":(e=p.duration(0<t.i?Math.floor(t.i/1e6):Math.ceil(t.i/1e6))).nanoseconds(t.i%1e6);break;case"1217":e=p.duration(60*t.i*1e3);break;case"1218":e=p.duration(1e3*t.i);break;case"1219":e=p.duration(t.i);break;default:e=p.tz(t.i,"UTC"),n=!0}e.kdbType(t.class)}else e=p.tz(t,"UTC");return n&&this.timezone&&e.isValid()&&e.tz(this.timezone),e},s.convertKDBToViewstateValue=function(t){var e=t;return e=_.hasIn(t,"class")?"1222"===t.class?t.toString():s.convertKDBTemporalToMoment(t).toDashString():e},s.convertMomentToDatePicker=function(t,e){return t=s.convertValueToMoment(t),e?t.tz("UTC"):this.timezone&&t.isValid()&&!p.isDuration(t)&&t.tz(this.timezone),e=new Date(t.year(),t.month(),t.date(),t.hour(),t.minute(),t.second(),t.millisecond()),(t=t.nanoseconds())&&!_.isNaN(t)&&(e.nanoseconds=t),e},s.convertTypeToKdbType=function(t,e){return t?_.includes(s.Types.kdbTemporals,t)?t:_.includes(s.Types.kdbTemporals,s.Types.dashboardToKdb[t])?s.Types.dashboardToKdb[t]:null:s.inferKdbTypeFromDashString(e)},s.convertUserInputToMoment=function(t,e,n){return _.isString(t)?(t=t.replace(/(\d\d\d\d)\.(\d\d)\.(\d\d)/,"$1-$2-$3"),n=n?p.tz(t,e,"UTC"):this.timezone?p.tz(t,e,this.timezone):p(t,e),(e=s.extractNanos(t))&&!_.isNaN(e)&&(n.kdbType("1212"),n.nanoseconds(e)),n):t},s.convertValueToDuration=function(t,e){var n,i,o=s.convertTypeToKdbType(e,t);return _.includes(["1212","1213","1214","1215"],e)?s.convertValueToMoment(t,e):t?(p.isDuration(t)?n=t:_.isString(t)&&(i=(t=t.replace("1970-01-01T","").replace("Z","")).match(/(\d\d:\d\d:\d\d.\d\d\d)(\d\d\d\d\d\d)/))&&i[1]?("1216"===e&&-1!==t.indexOf("D")&&(e=t.substring(0,t.indexOf(":")).split("D"),(e=Number(e[1])+24*Number(e[0]))&&(i[1]=e+i[1].substring(t.indexOf(":")-2))),n=p.duration(i[1]),(e=i[2]?Number(i[2]):0)&&!_.isNaN(e)&&n.nanoseconds(e)):n=p.duration(t),n&&o&&n.kdbType(o),n):p.duration(0)},s.convertValueToMoment=function(t,e,n){var i,o=s.convertTypeToKdbType(e,t),r=0;return _.includes(["1216","1217","1218","1219"],e)?s.convertValueToDuration(t,e):(null==t?(i=p(),n||i.tz(this.timezone)):p.isMoment(t)?i=t:(!_.isString(t)||"1214"!==o&&"1213"!==o?(i=p(t),n||i.tz(this.timezone)):i=p.utc(t),_.isDate(t)?r=t.nanoseconds:_.isString(t)&&(r=s.extractNanos(t)),r&&!_.isNaN(r)&&i.nanoseconds(r)),i&&o&&i.kdbType(o),i)},s.convertStringToMomentFormat=function(t,e){if(t){var n=!1;switch(e){case"1213":t=t.replace("m","");break;case"1212":t=t.split("D")[0].replace(/\./g,"-")+"T"+t.split("D")[1]+"Z",n=!0;break;case"1215":t=t.split("T")[0].replace(/\./g,"-")+"T"+t.split("T")[1]+"Z",n=!0}return s.convertValueToMoment(t,e,n)}},s.createPivotCollectionFunc=function(t){return m.Collection.extend({model:m.Model.extend({idAttribute:t,set:function(t,e){"function"==typeof t.subscribe&&(this.subscribe=t.subscribe),"function"==typeof t.unsubscribe&&(this.unsubscribe=t.unsubscribe),m.Model.prototype.set.call(this,t,e)},setX:function(t,e){var n;"object"==typeof t?n=t:(n={})[t]=e,_.extend(this.attributes,n)}})})},s.castToDashString=function(t,e){return e&&t&&t.class&&_.includes(["date","datetime","month","timestamp","minute","time","timespan","second"],e)?t=s.convertKDBTemporalToMoment(t).toDashString():_.isString(t)&&"timespan"===e&&-1<t.indexOf(".000Z")?t=t.replace(".000Z",".000000000Z"):_.isString(t)&&"datetime"===e&&null!==t.match(/[DTZ]/g)&&23<t.length&&(t=t.slice(0,23)+"Z"),t},s.extractNanos=function(t){var e=0;return e=t&&(t=(t=_.isFunction(t.toString)?t.toString():t).match(/\d{1,2}:\d{2}:\d{2}\.\d{3}(\d{6})/))?Number(t[1]):e},s.convertDataUrlToBlob=function(t){for(var t=t.split(","),e=atob(t[1]),n=e.length,i=new Uint8Array(n);n--;)i[n]=e.charCodeAt(n);return i},s.decompress=function(t){t=R.inflateSync(t);return R.strFromU8(t)},s.decodeFromBase64=function(t){return Uint8Array.from(atob(t),function(t){return t.charCodeAt(0)})},s.encodeToBase64=function(t){return btoa(String.fromCharCode.apply(null,t))},s.fileSave=function(t,e,n){var i,o;n=n||"application/octet-stream",o=document.createElement("a"),window.Blob?(i=new Blob([e],{type:n}),window.navigator.msSaveOrOpenBlob?o.onclick=function(){window.navigator.msSaveOrOpenBlob(i,t)}:void 0!==o.download&&o.setAttribute("href",URL.createObjectURL(i))):o.setAttribute("href",encodeURI(n+","+e)),void 0!==o.download&&o.setAttribute("download",t),document.body.appendChild(o),o.click(),document.body.removeChild(o)},s.formatNumber=function(t,e){var n=t;return $.isNumeric(t)?(n=(t=this.toFixedNumber(t,e).split("."))[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),2===t.length&&(n+="."+t[1]),n):this.htmlEncode(n)},s.getComparator=function(t,r){switch(t){default:case 1:case 2:case 4:case 5:case 6:case 8:case 9:return function(t,e){e=r(e);return null==t||null==e?null!=t?1:null!=e?-1:0:e<t?1:t<e?-1:0};case 10:case 11:return function(t,e){e=r(e);return null==t||null==e?null!=t?1:null!=e?-1:0:t.localeCompare(e,{caseFirst:"lower"})};case 7:return function(t,e){var n,i,o;return e=r(e),null==t||null==e?null!=t?1:null!=e?-1:0:(i=(n="-"===t[0])?1-t.length:t.length)!==(o="-"===e[0]?1-e.length:e.length)?o<i?1:-1:(n?-1:1)*(e<t?1:t<e?-1:0)};case 12:case 16:return function(t,e){var e=r(e),n=null==t||t===1/0||t===-1/0,i=null==e||e===1/0||e===-1/0;return n&&i?e<t?1:t<e?-1:0:n?t>e.i?1:t<e.i?-1:0:i?t.i>e?1:t.i<e?-1:0:t.i>e.i?1:t.i<e.i?-1:t.n>e.n?1:t.n<e.n?-1:0};case 13:case 14:case 15:case 17:case 18:case 19:return function(t,e){var e=r(e),n=null==t||t===1/0||t===-1/0,i=null==e||e===1/0||e===-1/0;return n&&i?e<t?1:t<e?-1:0:n?t>e.i?1:t<e.i?-1:0:i?t.i>e?1:t.i<e?-1:0:t.i>e.i?1:t.i<e.i?-1:0}}},s.getCookie=function(t){for(var e=t+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var o=n[i];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(e))return decodeURIComponent(o.substring(e.length,o.length))}return""},s.getDeepDiff=function(t,e){return st.getDiff(t,e)},s.getDefaultThemeColors=function(t){return"Light"===t?["#ffffff","#f4f4f4","#cecece"]:["#282828","#303030","#505050"]},s.getHash=function(t){t=(t||window).location.href.match(/#(.*)$/);return t?t[1]:""},s.getTimezoneOffset=function(){var t=this.timezone?p.tz(this.timezone):p();return t.utcOffset()},s.getTypeCategory=function(t){var e="";switch(t){case"1212":case"1213":case"1214":case"1215":case"date":case"datetime":case"month":case"timestamp":e="date";break;case"1216":case"1217":case"1218":case"1219":case"minute":case"second":case"time":case"timespan":e="duration"}return e},s.getNumberDecimalPlaces=function(t){var e=0;return e=-1!==t.lastIndexOf(".")?t.substr(t.lastIndexOf(".")+1,t.length).length:e},s.hasDefaultThemeColors=function(t,e,n,i){return!("Light"!==t||"#f0f0f0"!==e||"#e0e0e0"!==n&&n||"#c8c8c8"!==i&&i)||!("Dark"!==t||"#282828"!==e||"#303030"!==n&&n||"#505050"!==i&&i)},s.hasTouch=function(){return $(document).hasClass("touch")},s.hex2RGB=function(t){t=(4<t.length?RegExp(/^\#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/):RegExp(/^\#?([a-f\d])([a-f\d])([a-f\d])$/)).exec(t);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[]},s.hoverFix=function(t){var e=t.parentNode,n=t.nextSibling;e.removeChild(t),setTimeout(function(){e.insertBefore(t,n)},0)},s.htmlEncode=function(t){return t.toString().replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},s.inferKdbTypeFromDashString=function(t){var e;if(!t||!_.isString(t))return null;if(e=t.match(/^(\d\d\d\d-\d\d)?(-\d\d)?(T\d\d:\d\d:\d\d\.\d{3})?(\d{6})?(?:Z)?$/)){if(e[1]&&e[2]&&e[3]&&e[4])return"1970-01-01"===t.substr(0,10)?"1216":"1212";if(e[1]&&e[2]&&e[3])return"1970-01-01"===t.substr(0,10)?"1219":"1215";if(e[1]&&e[2])return"1214";if(e[1])return"1213"}return null},s.isIE=function(){var t=window.navigator.userAgent,e=t.indexOf("MSIE ");if(0<e)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);if(0<t.indexOf("Trident/"))return e=t.indexOf("rv:"),parseInt(t.substring(e+3,t.indexOf(".",e)),10);e=t.indexOf("Edge/");return 0<e&&parseInt(t.substring(e+5,t.indexOf(".",e)),10)},s.isKDBTemporal=function(t){return t&&t.class&&_.includes(s.Types.kdbTemporals,t.class)||!1},s.objToUri=function(n){return _.reduce(_.keys(n),function(t,e){return e&&t.push(e+"="+n[e]),t},[]).join("&")},s.padLeft=function(t,e){return _.isNull(t)||_.isUndefined(t)?"":(t=t.toString()).length<e?s.padLeft("0"+t,e):t},s.roundToPlaces=function(t,e){e=Math.pow(10,e);return t*=e,(t=Math.round(t))/e},s.round=function(t,e,n){return n===this.Rounding.Normal?s.roundToPlaces(t,e):(e=Math.pow(10,e),n===s.Rounding.Floor?Math.floor(t*e)/e:Math.ceil(t*e)/e)},s.rgb2hex=function(t){var e="";return e=t.length?"#"+((1<<24)+(t[0]<<16)+(t[1]<<8)+t[2]).toString(16).slice(1):e},s.rgbStr2Array=function(t){t=t.match(/rgba?\((\d{1,3}), ?(\d{1,3}), ?(\d{1,3})\)?(?:, ?(\d(?:\.\d?))\))?/);return t?[t[1],t[2],t[3],t[4]]:[]},s.smartFormatNumber=function(t,e,n){var i=Number(t),o="",r=1;return isNaN(i)?"":"string"==typeof t&&(i>Number.MAX_SAFE_INTEGER||i<Number.MIN_SAFE_INTEGER)?this.toFixedNumber(t,e):(t=Math.max(0,void 0===e?2:e),1e18<=(e=Math.abs(i))?(r=1e18,o="E"):1e15<=e?(r=1e15,o="P"):1e12<=e?(r=1e12,o="T"):1e9<=e?(r=1e9,o="B"):1e6<=e?(r=1e6,o="M"):1e3<=e&&(r=1e3,o="k"),e=s.roundToPlaces(i/r,t),(e=n?e.toFixed(t):e)+o)},s.sum=function(t){return _.reduce(t,function(t,e){return t+e},0)},s.toFixedNumber=function(t,e){e=void 0===e?2:e,e=Math.min(20,Math.max(0,e));return"string"!=typeof t||/(^[^-\d]|^[-\d].*[^\d]+|^-$)/.test(t)?"number"==typeof t?t.toFixed(e):this.htmlEncode(t):t+(e?".":"")+_.repeat("0",e)},s.touchDownEvent=function(t){return this.hasTouch()?"touchstart":"mousedown"},s.tapEvent=function(){return this.hasTouch()?"tap":"mousedown"},s.uriToObj=function(t){return _.reduce(t.split("&"),function(t,e){e=e.split("=");return t[e[0]]=e[1],t},{})},s.isIE11=/Trident\/.*rv:11/.test(navigator.userAgent),s.timezone=function(t){for(var e=t+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var o=n[i];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(e))return decodeURIComponent(o.substring(e.length,o.length))}return""}("dashboard-timezone")||p.tz.guess(),s.Formats={Date:["YYYY-MM-DD","DD/MM/YYYY","DD.MM.YYYY","MM/DD/YYYY","D/M/YYYY","M/D/YYYY","D/M/YY","M/D/YY","YYYY-MMM-DD","D MMM","D MMM YYYY","MMM D","MMM D, YYYY","YYYY-MM","MM/YYYY","M/YY","MMM YYYY"],DateTime:["YYYY-MM-DD HH:mm:ss","YYYY-MM-DD HH:mm:ss.SSS","YYYY-MM-DD HH:mm:ss.SSSSSS","YYYY-MM-DD HH:mm:ss.SSSSSSSSS","YYYY-MM-DD","MM/DD/YYYY","D/M/YYYY","M/D/YYYY","D/M/YY","M/D/YY","YYYY-MMM-DD","D MMM","D MMM YYYY","MMM D","MMM D, YYYY","HH:mm","HH:mm:ss","HH:mm:ss.SSS","HH:mm:ss.SSSSSS","HH:mm:ss.SSSSSSSSS","mm:ss","mm:ss.SSS","mm:ss.SSSSSS","mm:ss.SSSSSSSSS","ss","ss.SSS","ss.SSSSSS","ss.SSSSSSSSS"],Time:["HH:mm","HH:mm:ss","HH:mm:ss.SSS","HH:mm:ss.SSSSSS","HH:mm:ss.SSSSSSSSS","mm:ss","mm:ss.SSS","ss","ss.SSS"]},s.TIME_RX=/^((\d\d\d\d-\d\d)|(\d\d\d\d-\d\d-\d\d))?((T\d\d:\d\d:\d\d\.\d{3})(\d{6})?)?(?:Z)?$/,s.Rounding={Normal:0,Floor:1,Ceiling:2},s.Types={dashboardToKdb:{timestamp:"1212",month:"1213",date:"1214",datetime:"1215",timespan:"1216",minute:"1217",second:"1218",time:"1219"},kdbTemporals:["1212","1213","1214","1215","1216","1217","1218","1219"],kdbToDashboard:{1212:"timestamp",1213:"month",1214:"date",1215:"datetime",1216:"timespan",1217:"minute",1218:"second",1219:"time"}},t.Tools=s}(I=I||{}),function(i){function o(){}o.castDate=function(t){return t instanceof Date?t:t&&t.i?new Date(t.i):new Date(t)},o.convertDateToTimeObject=function(t){return{hour:t.getUTCHours(),minute:t.getUTCMinutes(),second:t.getUTCSeconds(),millisec:t.getUTCMilliseconds()}},o.getByQTypeNum=function(t){return(o.infosByNum=o.infosByNum?o.infosByNum:_.map(o.simple,function(t){return o.infos[t]}))[t]},o.getByName=function(t){var e=this.infos["double"===t?"float":t];return e||((e=this.infos[t.replace("[]","")])?{char:e.char+"[]",num:-e.num,literal:e.literal,null:"",name:t,editor:_.extend({},e.editor,{type:"List",itemType:e.editor.type,editorClass:e.name+"List"}),toKDBInput:function(t){t=_.values(t);return null!=t&&0<t.length?"("+(1<t.length?"":"enlist ")+_.map(t,function(t){return t&&t.toKDBInput?t.toKDBInput():e.toKDBInput(t)}).join(";")+")":"()"}}:this.infos.symbol)},o.toTimeMomentInput=function(t,e){var n=o.isNilorInfinite(e,t);if(n.isNilOrInfinite)return n.returnType;n=i.Tools.isKDBTemporal(e)?i.Tools.convertKDBTemporalToMoment(e):i.Tools.convertValueToDuration(e);return""===t?p.isDuration(n)?"'"+n.formatNano("HH:mm:ss.SSS",{trim:!1})+"'":"NULL":p.isDuration(n)?n.formatNano("HH:mm:ss.SSS",{trim:!1}):"0Nt"},o.isNilorInfinite=function(t,e){if(""===e){if(_.isNull(t)||_.isUndefined(t)||""===t||t===-1/0||t===1/0)return{isNilOrInfinite:!0,returnType:"NULL"}}else{if(_.isNull(t)||_.isUndefined(t))return{isNilOrInfinite:!0,returnType:"0N"+e};if(t===-1/0)return{isNilOrInfinite:!0,returnType:"-0W"+e};if(t===1/0)return{isNilOrInfinite:!0,returnType:"0W"+e}}return{isNilOrInfinite:!1,returnType:""}},o.toSecondMomentInput=function(t,e){var n=o.isNilorInfinite(e,t);if(n.isNilOrInfinite)return n.returnType;n=i.Tools.isKDBTemporal(e)?i.Tools.convertKDBTemporalToMoment(e):i.Tools.convertValueToDuration(e);return""===t?p.isDuration(n)?"'"+n.formatNano("HH:mm:ss",{trim:!1})+"'":"NULL":p.isDuration(n)?n.formatNano("HH:mm:ss",{trim:!1}):"0Nv"},o.toMinuteMomentInput=function(t,e){var n=o.isNilorInfinite(e,t);if(n.isNilOrInfinite)return n.returnType;n=i.Tools.isKDBTemporal(e)?i.Tools.convertKDBTemporalToMoment(e):i.Tools.convertValueToDuration(e);return""===t?p.isDuration(n)?"'"+n.format("HH:mm",{trim:!1})+"'":"NULL":p.isDuration(n)?n.format("HH:mm",{trim:!1}):"0Nu"},o.toTimespanMomentInput=function(t,e){var n=o.isNilorInfinite(e,t);if(n.isNilOrInfinite)return n.returnType;n=i.Tools.isKDBTemporal(e)?i.Tools.convertKDBTemporalToMoment(e):i.Tools.convertValueToDuration(e);return""===t?p.isDuration(n)?"'"+n.format("DD")+"D"+n.formatNano("HH:mm:ss.SSSSSSSSS",{trim:!1})+"'":"NULL":p.isDuration(n)?n.format("DD")+"D"+n.formatNano("HH:mm:ss.SSSSSSSSS",{trim:!1}):"0N"+t},o.toMonthMomentInput=function(t,e){var n=o.isNilorInfinite(e,t);if(n.isNilOrInfinite)return n.returnType;n=i.Tools.isKDBTemporal(e)?i.Tools.convertKDBTemporalToMoment(e):p.tz(e,"Y.MM","UTC");return""===t?p.isMoment(n)&&n.isValid()?"'"+n.utcOffset(0).format("YYYY-MM-DD")+"'":"NULL":p.isMoment(n)&&n.isValid()?n.utcOffset(0).format("YYYY.MM")+"m":"0Nm"},o.toMomentUTC=function(t){return i.Tools.isKDBTemporal(t)?i.Tools.convertKDBTemporalToMoment(t):p.tz(t,"UTC")},o.toTimeStampMomentInput=function(t,e){var n=o.isNilorInfinite(e,t);if(n.isNilOrInfinite)return n.returnType;_.isString(e)&&(e=e.replace("D","T").replace(/^(\d\d\d\d)\.(\d\d).(\d\d)/,"$1-$2-$3"),e=/Z$/.test(e)?e:e+"Z");n=i.Tools.isKDBTemporal(e)?i.Tools.convertKDBTemporalToMoment(e):i.Tools.convertValueToMoment(e);return""===t?p.isMoment(n)&&n.isValid()?"'"+n.utcOffset(0).format("YYYY-MM-DD")+" "+n.formatNano("HH:mm:ss.SSSSSS",{trim:!1})+"'":"NULL":p.isMoment(n)&&n.isValid()?n.utcOffset(0).format("YYYY.MM.DD")+"D"+n.formatNano("HH:mm:ss.SSSSSSSSS",{trim:!1}):"0Np"},o.toDateTimeMomentInput=function(t,e){var n=o.isNilorInfinite(e,t);if(n.isNilOrInfinite)return n.returnType;_.isString(e)&&(e=e.replace(/^(\d\d\d\d)\.(\d\d).(\d\d)/,"$1-$2-$3"),e=/Z$/.test(e)?e:e+"Z");n=o.toMomentUTC(e);return""===t?p.isMoment(n)&&n.isValid()?"'"+n.utcOffset(0).format("YYYY-MM-DD")+" "+n.formatNano("HH:mm:ss.SSS",{trim:!1})+"'":"NULL":p.isMoment(n)&&n.isValid()?n.utcOffset(0).format("YYYY.MM.DD")+"T"+n.formatNano("HH:mm:ss.SSS",{trim:!1}):"0Np"},o.toDateMomentInput=function(t,e){var n=o.isNilorInfinite(e,t);if(n.isNilOrInfinite)return n.returnType;_.isString(e)&&(e=e.replace(/^(\d\d\d\d)\.(\d\d)\.(\d\d)/,"$1-$2-$3"));n=o.toMomentUTC(e);return""===t?p.isMoment(n)&&n.isValid()?"'"+n.utcOffset(0).format("YYYY-MM-DD")+"'":"NULL":p.isMoment(n)&&n.isValid()?n.utcOffset(0).format("YYYY.MM.DD"):"0Nd"},o.toNumberInput=function(t,e){return""===t?_.isNull(e)||_.isUndefined(e)||isNaN(e)||""===e||e===-1/0||e===1/0?"NULL":e:_.isNull(e)||_.isUndefined(e)||isNaN(e)||""===e?"0N"+t:e===-1/0?"-0W"+t:e===1/0?"0W"+t:e+t},o.toListInput=function(t,e){return e?"("+(_.every(e,function(t){return _.isNull(t)||_.isUndefined(t)||_.isNumber(t)})?_.map(e,function(t){return o.infos.float.toKDBInput(t)}):_.map(e,function(t){return o.infos.char.toKDBInput(t)})).join(t?",":";")+")":"()"},o.REGEX_DATEPICKER=/^\d{4}-\d{2}-\d{2}$/,o.REGEX_ROLLING=/^(?:NOW|T([\+|\-]\d+)|T)(\@)?(\d{1,2})?(:\d{2})?(:\d{2})?(.(\d{9}|\d{3}))?(?:Z)?$/,o.REGEX_DURATION=/^\d{4}-\d{2}-\d{2}T(\d{2,6}):(\d{2}):(\d{2})?[.](\d{9}|\d{3})?Z$/,o.REGEX_TIMEPICKER=/^\d{4}-\d{2}-\d{2}T(\d{2}):(\d{2}):(\d{2})?[.](\d{9}|\d{3})?Z$/,o.infos={List:{char:void 0,size:void 0,num:0,literal:void 0,null:"",name:"list",editor:"List",toKDBInput:function(t){return o.toListInput(!1,t)},toSQLInput:function(t){return o.toListInput(!0,t)}},boolean:{char:"b",size:"1",num:1,literal:"0b",null:"",name:"boolean",editor:{type:"Checkbox"},toKDBInput:function(t){return t?"1b":"0b"},toSQLInput:function(t){return t?"1":"0"}},guid:{char:"g",size:"16",num:2,literal:"",null:"0Ng",name:"guid",editor:{type:"Text",editorAttrs:{maxLength:36},validators:[function(t){if(!t.match(/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/))return{type:"guid",message:"Invalid, requires: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"}}]},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)||""===t?"0Ng":t===-1/0?"0w":t===1/0?"-0w":'"G"$"'+t.toString()+'"'},toSQLInput:function(t){return _.isNull(t)||_.isUndefined(t)||""===t||t===-1/0||t===1/0?"NULL":"'"+t.toString()+"'"}},byte:{char:"x",size:"1",num:4,literal:"0x00",null:"",name:"byte",editor:{type:"Number",editorAttrs:{min:-128,max:127,step:1},validators:["number",{type:"range",min:-128,max:127},function(t){if(t%1!=0)return{type:"whole-number",message:"Must be a whole number"}}]},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)||isNaN(t)||""===t||t===-1/0?"0x0":t===1/0?"0xFF":"0x"+Number(t).toString(16)},toSQLInput:function(t){return _.isNull(t)||_.isUndefined(t)||isNaN(t)||""===t||t===-1/0||t===1/0?"NULL":Number(t).toString(16)}},short:{char:"h",size:"2",num:5,literal:"0h",null:"0Nh",name:"short",editor:{type:"Number",editorAttrs:{min:-32768,max:32767,step:1},validators:["number",{type:"range",min:-32768,max:32767},function(t){if(t%1!=0)return{type:"whole-number",message:"Must be a whole number"}}]},toKDBInput:function(t){return o.toNumberInput("h",t)},toSQLInput:function(t){return o.toNumberInput("",t)}},int:{char:"i",size:"4",num:6,literal:"0",null:"0N",name:"int",editor:{type:"Number",editorAttrs:{min:-2147483648,max:2147483647,step:1},validators:["number",{type:"range",min:-2147483648,max:2147483647},function(t){if(t%1!=0)return{type:"whole-number",message:"Must be a whole number"}}]},toKDBInput:function(t){return o.toNumberInput("i",t)},toSQLInput:function(t){return o.toNumberInput("",t)}},long:{char:"j",size:"8",num:7,literal:"0j",null:"0Nj",name:"long",editor:{type:"Long",validators:["number",{type:"range",min:-0x8000000000000000,max:0x8000000000000000},function(t){if(t%1!=0)return{type:"whole-number",message:"Must be a whole number"}}]},toKDBInput:function(t){return o.toNumberInput("j",t)},toSQLInput:function(t){return o.toNumberInput("",t)}},real:{char:"e",size:"4",num:8,literal:"0e",null:"0Ne",name:"real",editor:{type:"Number",editorAttrs:{step:"any"},validators:["number"]},toKDBInput:function(t){return o.toNumberInput("e",t)},toSQLInput:function(t){return o.toNumberInput("",t)}},float:{char:"f",size:"8",num:9,literal:"0.0 or 0f",null:"0n",name:"float",editor:{type:"Number",editorAttrs:{step:"any"},validators:["number"]},toKDBInput:function(t){return o.toNumberInput("f",t)},toSQLInput:function(t){return o.toNumberInput("",t)}},char:{char:"c",size:"1",num:10,literal:'" "',null:'" "',name:"char",editor:{type:"Text",editorAttrs:{maxlength:1}},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)||0===t.length?'" "':'"'+(t&&t.toString?t.toString().replace(/\\/g,"\\\\").replace(/"/g,'\\"'):" ")+'"'},toSQLInput:function(t){return _.isNull(t)||_.isUndefined(t)?"''":"'"+(t&&t.toString?t.toString().replace(/\\/g,"\\\\").replace(/"/g,'\\"'):"")+"'"}},symbol:{char:"s",size:".",num:11,literal:"`",null:"`",name:"symbol",editor:{type:"Text"},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)?"`":'`$"'+(t&&t.toString?t.toString().replace(/\\/g,"\\\\").replace(/"/g,'\\"'):"")+'"'},toSQLInput:function(t){return _.isNull(t)||_.isUndefined(t)?"''":"'"+(t&&t.toString?t.toString().replace(/\\/g,"\\\\").replace(/"/g,'\\"'):"")+"'"}},timestamp:{char:"p",size:"8",num:12,literal:"dateDtimespan",null:"0Np",name:"timestamp",editor:{type:"DateTimePicker",options:{hasNano:!0,isTimestamp:!0,dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss.SSSSSSSSS",width:200,bindButton:!1},validators:[function(t){if(t){t=i.Tools.convertUserInputToMoment(t,"YYYY/MM/DD HH:mm:ss.SSS");if(t&&!t.isValid())return{type:"timestamp",message:"Invalid date/time"}}}]},toKDBInput:function(t){return o.toTimeStampMomentInput("p",t)},toSQLInput:function(t){return o.toTimeStampMomentInput("",t)}},month:{char:"m",size:"4",num:13,literal:"2000.01m",null:"0Nm",name:"month",editor:{type:"Month",options:{bindButton:!1}},toKDBInput:function(t){return o.toMonthMomentInput("m",t)},toSQLInput:function(t){return o.toMonthMomentInput("",t)}},date:{char:"d",size:"4",num:14,literal:"2000.01.01",null:"0Nd",name:"date",editor:{type:"DatePicker",options:{dateFormat:"yy-mm-dd",width:75,bindButton:!0},validators:[function(t){if(t){var e=i.Tools.convertUserInputToMoment(t,"YYYY/MM/DD");if(e&&!e.isValid())return{type:"date",message:"Invalid date"}}return!o.REGEX_DATEPICKER.test(t.substr(0,10))}]},toKDBInput:function(t){return o.toDateMomentInput("d",t)},toSQLInput:function(t){return o.toDateMomentInput("",t)}},datetime:{char:"z",size:"8",num:15,literal:"dateTtime",null:"0Nz",name:"datetime",editor:{type:"DateTimePicker",options:{dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss.SSS",width:155,bindButton:!0},validators:[function(t){return _.isFunction(t.toISOString)&&(t=t.toISOString()),!o.REGEX_TIMEPICKER.test(t)}]},toKDBInput:function(t){return o.toDateTimeMomentInput("z",t)},toSQLInput:function(t){return o.toDateTimeMomentInput("",t)}},timespan:{char:"n",size:"8",num:16,literal:"00:00:00.00",null:"0Nn",name:"timespan",editor:{type:"TimePicker",options:{isDuration:!0,hasNano:!0,isTimespan:!0,timeFormat:"HH:mm:ss.SSSSSSSSS",width:142,bindButton:!1},validators:[function(t){return!1}]},toKDBInput:function(t){return o.toTimespanMomentInput("n",t)},toSQLInput:function(t){return o.toTimespanMomentInput("",t)}},minute:{char:"u",size:"4",num:17,literal:"00:00:00",null:"0Nu",name:"minute",editor:{type:"TimePicker",options:{isDuration:!0,timeFormat:"HH:mm",width:61,bindButton:!1},validators:[function(t){return!1}]},toKDBInput:function(t){return o.toMinuteMomentInput("u",t)},toSQLInput:function(t){return o.toMinuteMomentInput("",t)}},second:{char:"v",size:"4",num:18,literal:"00:00:00",null:"0Nv",name:"second",editor:{type:"TimePicker",options:{isDuration:!0,timeFormat:"HH:mm:ss",width:79,bindButton:!1},validators:[function(t){return!1}]},toKDBInput:function(t){return o.toSecondMomentInput("v",t)},toSQLInput:function(t){return o.toSecondMomentInput("",t)}},time:{char:"t",size:"4",num:19,literal:"00:00:00.000",null:"0Nt",name:"time",editor:{type:"TimePicker",options:{isDuration:!0,timeFormat:"HH:mm:ss.SSS",width:102,bindButton:!1},validators:[function(t){return!o.REGEX_TIMEPICKER.test(t.toString())}]},toKDBInput:function(t){return o.toTimeMomentInput("t",t)},toSQLInput:function(t){return o.toTimeMomentInput("",t)}},string:{char:"",size:".",num:20,literal:"",null:"",name:"string",editor:{type:"TextArea"},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)?'""':'"'+(t&&t.toString?t.toString().replace(/\\/g,"\\\\").replace(/"/g,'\\"'):"")+'"'},toSQLInput:function(t){return _.isNull(t)||_.isUndefined(t)?"''":"'"+(t&&t.toString?t.toString().replace(/\\/g,"\\\\").replace(/"/g,'\\"'):"")+"'"}},list:{char:"Q",size:"",num:21,literal:[],null:"",name:"list",editor:{type:"CustomList",options:{itemType:"Text"}},toKDBInput:function(t){t=_.values(t);return null!=t&&0<t.length?"("+(1<t.length?"":"enlist ")+_.map(t,function(t){return t&&t.toKDBInput?t.toKDBInput():'`$"'+(_.isString(t)?t.replace(/\"/g,'\\"'):t)+'"'}).join(";")+")":"()"},toSQLInput:function(t){t=_.values(t);return void 0!==t&&0<t.length?"("+_.map(t,function(t){return t&&t.toKDBInput?t.toKDBInput():_.isString(t)?"'"+t+"'":t}).join(",")+")":"()"}},dateRolling:{char:"d",size:"4",num:22,literal:"2000.01.01",null:"0Nd",name:"dateRolling",editor:{type:"DatePickerRolling",options:{dateFormat:"yy-mm-dd"},validators:[function(t){return!(o.REGEX_ROLLING.test(t.toString())||t&&t.toISOString&&o.REGEX_DATEPICKER.test(t.toISOString())||o.REGEX_DATEPICKER.test(t.substr(0,10)))&&{type:"rolling",message:"Valid rolling syntax includes NOW, T+x or T+x@HH:mm"}}]},toKDBInput:function(t){return $.datepicker.formatDate("yy.mm.dd",o.castDate(t))},toSQLInput:function(t){return"'"+$.datepicker.formatDate("yyyy-mm-dd",o.castDate(t))+"'"}},datetimeRolling:{char:"z",size:"8",num:23,literal:"dateTtime",null:"0Nz",name:"datetimeRolling",editor:{type:"DateTimePickerRolling",options:{dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss.SSS"},validators:[function(t){return!(o.REGEX_ROLLING.test(t.toString())||t&&t.toISOString&&o.REGEX_TIMEPICKER.test(t.toISOString())||o.REGEX_TIMEPICKER.test(t))&&{type:"guid",message:"Valid rolling syntax includes NOW, T+x or T+x@HH:mm"}}]}},timestampRolling:{char:"p",size:"8",num:24,literal:"dateDtimespan",null:"0Np",name:"timestampRolling",editor:{type:"DateTimePickerRolling",options:{hasNano:!0,isTimestamp:!0,dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss.SSSSSSSSS"},validators:[function(t){return!(o.REGEX_ROLLING.test(t.toString())||t&&t.toISOString&&o.REGEX_TIMEPICKER.test(t.toISOString())||o.REGEX_TIMEPICKER.test(t))&&{type:"guid",message:"Valid rolling syntax includes NOW, T+x or T+x@HH:mm"}}]}},timeRolling:{char:"t",size:"4",num:25,literal:"00:00:00.000",null:"0Nt",name:"timeRolling",editor:{type:"TimePickerRolling",options:{isDuration:!0,timeFormat:"HH:mm:ss.SSS"},validators:[function(t){return!o.REGEX_ROLLING.test(t.toString())&&!o.REGEX_TIMEPICKER.test(t.toString())&&{type:"guid",message:"Valid rolling syntax includes NOW, T+x or T-x"}}]}},minuteRolling:{char:"u",size:"4",num:26,literal:"00:00:00",null:"0Nu",name:"minuteRolling",editor:{type:"TimePickerRolling",options:{isDuration:!0,timeFormat:"HH:mm"},validators:[function(t){return!o.REGEX_ROLLING.test(t.toString())&&!o.REGEX_TIMEPICKER.test(t.toString())&&{type:"guid",message:"Valid rolling syntax includes NOW, T+x or T-x"}}]}},secondRolling:{char:"v",size:"4",num:27,literal:"00:00:00",null:"0Nv",name:"secondRolling",editor:{type:"TimePickerRolling",options:{isDuration:!0,timeFormat:"HH:mm:ss"},validators:[function(t){return!o.REGEX_ROLLING.test(t.toString())&&!o.REGEX_TIMEPICKER.test(t.toString())&&{type:"guid",message:"Valid rolling syntax includes NOW, T+x or T-x"}}]}},dict:{char:"Q",size:"",num:98,literal:[],null:"",name:"dict",editor:{type:"Dict",options:{itemType:"Text"}},toKDBInput:function(t){if(_.isEmpty(t))return"()!()";var e=_.keys(t),t=_.values(t),n=1===e.length?"enlist ":"";return"("+n+_.map(e,function(t){return'`$"'+t+'"'}).join(";")+")!("+n+_.map(t,function(t){return t.type?o.getByName(t.type).toKDBInput(t.value):'`$"'+t.replace(/\"/g,'\\"')+'"'}).join(";")+")"},toSQLInput:function(t){return t}},email:{char:"",size:"",num:29,literal:"",null:"",name:"email",editor:{type:"Text",options:{itemType:"Text"},validators:["email"]},toKDBInput:function(t){return o.infos.symbol.toKDBInput(t)},toSQLInput:function(t){return"'"+o.infos.symbol.toKDBInput(t)+"'"}}},o.simple=["list","boolean","guid","byte","byte","short","int","long","real","float","char","symbol","timestamp","month","date","datetime","timespan","minute","second","time","dict"],o.infosByNum=null,i.RTTI=o}(I=I||{}),function(n){function t(){}t.constructPivotWhereString=function(t){var e=[];return t.forEach(function(t){switch(t.columnType){case 1:case 2:case 4:case 5:case 6:case 7:case 8:case 9:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:e.push("("+t.columnOperator+';`$"'+t.columnName+'"; '+n.RTTI.getByQTypeNum(t.columnType).toKDBInput(t.columnValue)+")");break;case 10:1==t.columnValue.length?e.push("("+t.columnOperator+';`$"'+t.columnName+'"; "'+t.columnValue.toString()+'")'):e.push('(~\\:;`$"'+t.columnName+'"; "'+t.columnValue.toString()+'")');break;case 11:e.push("("+t.columnOperator+';`$"'+t.columnName+'"; enlist `$"'+t.columnValue.toString()+'")');break;default:_.isString(t.columnValue)?e.push('(~\\:;`$"'+t.columnName+'"; "'+t.columnValue.toString()+'")'):e.push("("+t.columnOperator+';`$"'+t.columnName+'"; enlist `$"'+t.columnValue.toString()+'")')}}),1==e.length?"enlist "+e[0]:"("+e.join(";")+")"},t._generateOrderingKdbSyntax=function(t){var e,n="";return n=2===(t=(t=t||"").split(",")).length&&"null"!=(e=t[1])?"`"+t[0]+";"+("asc"===e?1:-1):n},t.strip=function(t){return t&&0<t.length?t.replace(/((^|\s+)\/.*$)|^\s+|\s*\n/gm," "):t},t.constructPivotQuery=function(n){var t,e,i,o,r,s,a="",l="0j",u=n.pivotSource,c=n.table,p=this.strip(n.queryString),d=n.queryParams,h=n.aggFn,g=n.aggregateFns,f=n._generateOrderingKdbSyntax,m=/^[A-Za-z0-9]+\w*$/;function y(t){return 1<t.length?_.reduce(t,function(t,e,n,i){t+=";"!==t.substr(-1)&&0<n?";":"";return e.match(m)?t+="`"+e:t+='`$"'+e+'"'+(n<i.length-1?";":""),t},"(")+")":1===t.length?t[0].match(m)?"enlist `"+t[0]:'enlist `$"'+t[0]+'"':void 0}return f=this._generateOrderingKdbSyntax(f),s=y(n.dimensions),t=y(_.isArray(n.aggregateLabels)&&!_.isEmpty(n.aggregateLabels)?_.map(n.aggregateLabels,function(t,e){return t||n.aggregateCols[e]}):n.aggregateCols),e=this.constructPivotWhereString(n.wheres),1===n.aggregateCols.length&&(a="enlist "),a+="(",_.each(n.aggregateCols,function(t,e){0<t.length&&(o=g&&g[e]||h,a+="("+o+";"+(t.match(m)?"`"+t:'`$"'+t+'"')+");")}),a=a.substr(0,a.length-1)+")",n.topX&&"null"!==n.topX&&"all"!==n.topX&&(l=n.topX+"j"),s="`d`g!("+s+";"+(n.columnLabel&&0<n.columnLabel.length?"enlist `"+n.columnLabel:"()")+")","query"===u?(p=$.trim(p),u=/^{\[([a-z0-9A-Z\;\w\/ ]+?)\]/.exec(p),r="",$.isArray(u)?r=u[0]:"{[]"!==p.substring(0,3)?p="{[] "+p+"}[]":p+="[]",0<r.length&&(1===d.length?p=p+"["+d[0].name+"]":(p+="[",_.each(d,function(t,e){0<e&&(p+=";"),p+=t.name}),p+="]")),i=r+" "+this.PIVOT_FUNCTION+"["+p+";"+e+";"+s+";"+t+";"+a+";"+l+";("+f+")]",0<r.length&&(i+="}")):i=this.PIVOT_FUNCTION+"[`"+c+";"+e+";"+s+";"+t+";"+a+";"+l+";("+f+")]",i},t.PIVOT_FUNCTION="$[{x~key x}`.pivot.pivotV3;.pivot.pivotV3;{[t;w;d;a;f;n;o] g:(); if [(type d)=99h; [g:d[`g]; d:d[`d],g;]];piv: 0!?[t;w;d!d;a!f]; if [(count g)>0; [d: (-1 _ d); a2:d,a; piv2: 0!?[piv;();g!g;a2!a2]; grpData:{[x;d;grpCol;f] labels: $[(count f)>1;(`$((string x[grpCol]) ,/: string f[;0]));x[grpCol]]; d xkey (d,labels) xcol flip x _ grpCol}; piv: 0! () uj/ each[grpData[;d;g[0];f]] piv2; ]]; if [(count o)>0;[field: o[0]; order: o[1]; piv:$[order>0;field xasc piv;field xdesc piv];]]; $[n<=0;piv;n sublist piv]}]",n.Pivot=t}(I=I||{}),function(l){function u(){}u.applyAnalytic=function(){function t(t,e){i.onExecuteSubscriptionSuccess(t,i.get("_forceReset"),e)}function e(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];i.onError(i,i.attributes,t,"Error",e)}var i=this,n=i.get("_subscriptionKey")||l.DataSet.DEFAULT_ROW_INDEX;i.dataSet=new l.DataSet({idAttribute:n,collectionFunc:m.Collection.extend({model:m.Model.extend({idAttribute:n})}),agent:i.agent,maxRows:i.get("_maxRows"),primaryKey:n}),i.dataSet2=new l.DataSet2({idAttribute:n,collectionFunc:m.Collection.extend({model:m.Model.extend({idAttribute:n})}),agent:i.agent,maxRows:i.get("_maxRows"),primaryKey:n}),i.unset("error"),i.unset("queryStatus"),i.updateParameters(!0),"streaming"===i.get("_subscriptionType")?i.execute=i.wrapWithErrorHandler(function(){i.onExecuteBegin(),i.runWithConnectionCheck(e,function(){i.updateBuilder(function(){i.subscriptionId=l.DashClient.client.subscribe(i.get("_maxRows"),i.get("_selectedAnalytic"),i.get("_connection"),t,e,i.bindViewStateToKdbParams(i.get("_analyticParams"))),l.Log.Log("Subbd: "+i.subscriptionId)},e)})},i,i.attributes):i.execute=i.wrapWithErrorHandler(function(){i.onExecuteBegin(),i.runWithConnectionCheck(e,function(){i.updateBuilder(function(){l.DashClient.runAnalytic2(i.get("_selectedAnalytic"),i.get("_connection"),i.bindViewStateToKdbParams(i.get("_analyticParams")),t,e,i.get("_maxRows")||l.DocumentDataModel.DEFAULT_MAX_ROWS,null,i.performance)},e)})},i,i.attributes)},u.applyQuery=function(){function n(t,e){o.onExecuteSuccess(t,o.get("_forceReset"),e)}function i(t){o.onError(o,o.attributes,t,"Error",arguments)}var o=this,t=o.get("_subscriptionKey")||l.DataSet.DEFAULT_ROW_INDEX;o.applyViewStateAttributes();o.dataSet=new l.DataSet({idAttribute:t,collectionFunc:m.Collection.extend({model:m.Model.extend({idAttribute:t})}),agent:o.agent,maxRows:o.get("_maxRows"),primaryKey:t}),o.dataSet2=new l.DataSet2({idAttribute:t,collectionFunc:m.Collection.extend({model:m.Model.extend({idAttribute:t})}),agent:o.agent,maxRows:o.get("_maxRows"),primaryKey:t}),o.unset("error"),o.unset("queryStatus"),o.updateParameters(),"streaming"===o.get("_subscriptionType")?o.execute=o.wrapWithErrorHandler(function(){o.onExecuteBegin();var t=o.get("_queryString"),e=o.bindViewStateToKdbParams(o.get("_queryParams")),t=u.replaceParameters(t,e);o.subscriptionId=l.DashClient.client.subscribe(o.get("_maxRows"),t,o.get("_connection"),n,i),l.Log.Log("Subbd: "+o.subscriptionId)},o,o.attributes):o.execute=o.wrapWithErrorHandler(function(){o.onExecuteBegin();var t=o.get("_queryString"),e=o.bindViewStateToKdbParams(o.get("_queryParams"));""!==t.trim()&&("sql"===o.get("_dataType")?l.DashClient.runAnalytic2(".s.e",o.get("_connection"),[{type:"string",value:o.toSQLString(t,e)}],n,i,o.get("_maxRows")||l.DocumentDataModel.DEFAULT_MAX_ROWS,void 0,o.performance):l.DashClient.getQueryData2("q",o.get("_connection"),t,e,n,i,o.get("_maxRows")||l.DocumentDataModel.DEFAULT_MAX_ROWS,void 0,o.performance))},o,o.attributes)},u.bindViewStateToKdbParams=function(t){var n,o,r=this,e=[];return $.extend(!0,e,t),0<e.length&&_.each(e,function(i){var t,e;"string"==typeof i.value&&(o=i.value.match(l.DocumentDataModel.PARAMETER_RX))&&(t=r.getViewState().getByPath($.trim(o[0].substring(2,o[0].length-2))))&&(void 0===(t=_.isFunction(t.get)?t.get("value"):t.value)&&(i.value=null),i.value=_.isObject(t)&&!_.isArray(t)?$.extend(!0,{},t):t),"dict"===i.type&&_.isObject(i.value)?_.each(_.keys(i.value),function(t){var e,n;i.value[t]instanceof m.Model?i.value[t]={type:i.value[t].get("_type"),IsKdbParam:!0,isViewState:!0,name:i.value[t].path,value:i.value[t].get("value")}:"object"==typeof i.value[t]?_.has(i.value[t],"_isKdbReady")||((n=r.getViewState().getByPath(i.value[t].name))?(i.value[t].type=n.get("_type"),i.value[t].value=n.get("value")):"string"==typeof i.value[t].value&&0===i.value[t].value.indexOf("<%")&&(e=$.trim(i.value[t].value.substring(2,i.value[t].value.length-2)),(n=r.getViewState().getByPath(e))&&(i.value[t].value=n.get("value")))):"string"==typeof i.value[t]&&0===i.value[t].indexOf("<%")&&(e=$.trim(i.value[t].substring(2,i.value[t].length-2)),(n=r.getViewState().getByPath(e))&&(i.value[t]={type:n.get("_type"),IsKdbParam:!0,isViewState:!0,name:i.value[t],value:n.get("value")}))}):(o=i.type,(n=l.RTTI.getByName(o))&&"dict"===n.name&&(t=i.value.split(""),e={},_.each(t,function(t){t=t.split("");6===t.length&&(e[t[0]]={type:t[1],IsKdbParam:!0,isViewState:!0,name:t[0],value:t[2]})}),i.value=e))}),e},u.generatePivotModel=function(t,e,n,r){var s,a=this;return r.breakdownCols instanceof m.Model&&(r.breakdownCols=r.breakdownCols.get("value")),a.meta={},s=m.Model.extend({defaults:{_dataType:a.get("_dataType"),_pivotType:a.get("_pivotType"),_subscriptionType:a.get("_subscriptionType"),_subscriptionInterval:a.get("_subscriptionInterval")},idAttribute:t,childId:e,childModelType:n,initialize:function(){this.isDirty=!0,this.isPending=!1,this.legacyUpdates=[],this.agent=new l.Agent},apply:function(){this.dataSet=new l.DataSet({idAttribute:e,collectionFunc:m.Collection.extend({model:n}),agent:this.agent,maxRows:r.maxRows,primaryKey:e})},getRoot:function(){return a},getViewState:function(){return a.getViewState()},execute:function(t){function e(t,e){i.onExecuteSuccess(a.executeClientPivotQuery(a.clientPivotData,{wheres:r.wheres}),a.get("_forceReset"),void 0)}var n,i=this,o=!a.clientPivotData||a.isDirty||t&&t.intervalQuery;this.wheres||(this.wheres=r.wheres),i.onExecuteBegin();try{r.topX=null,r.ordering=null,r.queryParams=a.bindViewStateToKdbParams(a.get("_queryParams")),r.maxRows=a.get("_maxRows")||l.DocumentDataModel.DEFAULT_MAX_ROWS,r.queryString=r.queryString,_.each(r.wheres,function(t,e){var t="string"==typeof t?t:t.columnName,n=a.meta[t];r.wheres[e]={columnName:t,columnType:n,columnOperator:"=",columnValue:i.get(t)}}),n=function(t){a.onError(s,r,t,"Error",arguments)},"client"===i.get("_pivotType")?o?a.runWithConnectionCheck(n,function(){switch(a.get("_dataType")){case"query":l.DashClient.getQueryData("kdb",a.get("_connection"),r.queryString,r.queryParams,function(t){t&&(a.clientPivotData=t),e()},n,null,null,a.performance);break;case"virtual":a.executeVirtualQuery(a.get("_virtualQueryString"),a.get("_virtualParams"),function(t){a.clientPivotData=t,e()})}}):e():a.runWithConnectionCheck(n,function(){u.getPivotData(r,function(t,e){_.extend(a.meta,t.meta),i.onExecuteSuccess(t,a.get("_forceReset"),e,a.meta)},n,a.performance)})}catch(t){a.onError(s,r,t,"Error",arguments)}},exportPivotData:function(t,e){e("Pivot export not supported")},clearVirtualSubscriptions:_.noop,clearVirtualSubscriptionsAll:_.noop,executeClientPivotQuery:a.executeClientPivotQuery,formatValue:a.formatValue,getViewStateAttribute:a.getViewStateAttribute,isPagingData:a.isPagingData,legacyFlush:a.legacyFlush,legacyUpdate:a.legacyUpdate,logPrefix:a.logPrefix,onComplete:a.onComplete,onExecuteBegin:a.onExecuteBegin,onExecuteSuccess:a.onExecuteSuccess,reset:a.reset,start:a.start,stop:a.stop,subscribe:a.subscribe,triggerCallbacks:_.noop,updateVirtualSubscriptions:_.noop,unsubscribe:a.unsubscribe},{staticIdAttribute:t})},u.connectionCollectionSync=function(t,e,n){if("read"!==t)throw"data operation not supported for DocumentCollection";l.DashClient.runAPI(".api.conList","gw",[],function(t){return n.success(_.map(t.rows,function(t){return t.type=t.dbtype,delete t.type,t.password=t.pass,delete t.pass,t}))},function(t){return n.error(t)})},u.connectionSync=function(t,e,n){var i,o=this;switch(t){case"update":(i={}).originalName=o.get("originalName");case"create":i=_.extend(i||{},{name:o.id,dbtype:o.get("type"),tls:o.get("tls"),host:o.get("host"),port:o.get("port"),user:o.get("user"),pass:o.get("password"),database:""}),l.DashClient.runAPI(".api.conUpsert","gw",[{type:"symbol",value:o.id},{type:"string",value:JSON.stringify(i)}],function(t){return n.success(t)},function(t){return n.error(t)});break;case"delete":l.DashClient.runAPI(".api.conDelete","gw",[{type:"symbol",value:o.id}],function(){return n.success()},function(t){return n.error(t)});break;default:throw"data operation not supported for Document"}},u.documentCollectionSync=function(t,e,i){if("read"!==t)throw"data operation not supported for DashCollection";l.DashClient.runAPI(".api.dashList","gw",[],function(t){var n=[];t.rows.forEach(function(e){try{n.push(new l.Document(JSON.parse(e.description)))}catch(t){l.Log.Error("Error parsing dashboard description",e)}}),i.success&&i.success(n)},function(t){alert("Retrieve Dashboards FAILED"),i.error&&i.error(t)})},u.documentSync=function(t,e,n){var i,o=this;switch(t){case"read":l.DashClient.runAPI(".api.dashRead","gw",[{type:"symbol",value:o.id}],function(t){try{i=JSON.parse(t.rows[0].string)}catch(t){n.error&&n.error(t)}n.success&&n.success(i)},function(t){n.error&&n.error(t)});break;case"update":l.DashClient.runAPI(".api.dashUpsert","gw",[{type:"symbol",value:o.id},{type:"string",value:JSON.stringify(_.omit(o.attributes,["permissionEntity"]),null,2)}],function(){n.success&&n.success(o.attributes)},function(t){n.error&&n.error(t)});break;case"delete":l.DashClient.runAPI(".api.dashDelete","gw",[{type:"symbol",value:o.id}],function(){n.success&&n.success()},function(t){n.error&&n.error(t)});break;default:throw"data operation not supported for Document"}},u.replaceParameters=function(t,n){var e,i=0;if("string"==typeof t){if(t=this.strip(t),(e=/^\{(\[([^\]]+)\])?(.*)\}$/.exec(t))&&4===e.length)return e[2]?(e=e[2].split(";"),i+=e.length,t+"["+_.map(e,function(t,e){return l.RTTI.getByName(n[e].type).toKDBInput(n[e].value)}).join(";")+"]"):t+"[]";t=t.replace(/<%[^<>%]+%>/g,function(t){var e=i++;return l.RTTI.getByName(n[e].type).toKDBInput(n[e].value)})}return t},u.stop=function(){var t=this;t.pollingEvent&&(clearInterval(t.pollingEvent),t.pollingEvent=null),t.subscriptionId&&(l.DashClient.client.unsubscribe(t.subscriptionId),t.subscriptionId=null,t.isPending=!1)},u.getPivotData=function(t,n,e,i){l.DashClient.getQueryData("q",t.connection,l.Pivot.constructPivotQuery(t),t.queryParams,function(t,e){n(t,e)},e,t.maxRows,void 0,i)},u.strip=function(t){return t&&0<t.length?t.replace(/((^|\s+)\/.*$)|^\s+|\s*\n/gm," ").trim():t},u.parameterRx=new RegExp("<%([^<>%]+?)%>","g"),u.DEFAULT_NULL_VALL=-0x8000000000000000,l.DashClientLib=u}(I=I||{}),F=$,q=/\+/g,F.cookie=function(t,e,n){var i,o;if(void 0!==e&&!F.isFunction(e))return"number"==typeof(n=F.extend({},n)).expires&&(i=n.expires,(o=n.expires=new Date).setTime(+o+864e5*i)),document.cookie=[at(t),"=",at(String(e)),n.expires?"; expires="+n.expires.toUTCString():"",n.path?"; path="+n.path:"",n.domain?"; domain="+n.domain:"",n.secure?"; secure":""].join("");for(var r=t?void 0:{},s=document.cookie?document.cookie.split("; "):[],a=0,l=s.length;a<l;a++){var u=s[a].split("="),c=(c=u.shift(),decodeURIComponent(c)),u=u.join("=");if(t&&t===c){r=lt(u,e);break}t||void 0===(u=lt(u))||(r[c]=u)}return r},F.removeCookie=function(t,e){return void 0!==F.cookie(t)&&(F.cookie(t,"",F.extend({},e,{expires:-1})),!F.cookie(t))},Y=I=I||{},a.attemptUpload=function(t){a.logUploadConnected?Y.DeltaClientLib.createLog(t,function(){},function(){a.logUploadConnected=!1,a.storeLocal(t),a.debounceRetryConnection()}):a.storeLocal(t)},a.logPerformanceMetrics=function(t,e){var n,i,o;a.clientLoggingEnabled&&(e=e.performance,n=e.onAgentNotify-e.apply,t="Performance Metrics<--\x3e"+p().format("H:mm:ss.SSS")+"<--\x3e"+t+" (Roundtrip: "+n.toFixed(0)+"ms)<--\x3e",o=function(t){var e=t/n*100;return t.toFixed(0)+" ms  "+e.toFixed(2)+"%"},(i=[])[0]=e.serverStart?e.serverStart-e.apply:0,i[1]=e.serverStart&&e.serverEnd?e.serverEnd-e.serverStart:n,i[2]=e.serverEnd?e.onAgentNotify-e.serverEnd:0,t=(t=(t+="Dispatch: "+o(i[0]))+", Server Duration: "+o(i[1]))+", IPC & Deserialize: "+o(i[2]),a.attemptUpload(t))},a.setClientLogging=function(){a.logUploadConnected=!0,a.clientLoggingEnabled=!0,a.traceConsoleError(),a.trace(Y.Tools.getCookie("dashboard-log-level"))},a.trace=function(t){t=Number(t);a.clientLoggingEnabled?a.turnOnUploads(t):(a.Error=0<t?console.error.bind(console,"%s",a.logPrefix(a.Level.Error)):_.noop,a.Handled=1<t?console.error.bind(console,"%s",a.logPrefix(a.Level.Handled)):_.noop,a.Warn=1<t?console.warn.bind(console,"%s",a.logPrefix(a.Level.Warn)):_.noop,a.Debug=2<t?console.debug.bind(console,"%s",a.logPrefix(a.Level.Debug)):_.noop,a.Log=2<t?console.log.bind(console,"%s",a.logPrefix(a.Level.Info)):_.noop,a.Info=3<t?console.info.bind(console,"%s",a.logPrefix(a.Level.Info)):_.noop)},a.turnOnUploads=function(n){a.Error=function(t,e){0<n&&console.error(t,e||""),0<a.ServerLogLevel&&a.attemptUpload(a.logUploadString(this.Level.Error,t,e))},a.Handled=function(t,e){1<n&&console.error(t,e||""),1<a.ServerLogLevel&&a.attemptUpload(a.logUploadString(this.Level.Handled,t,e))},a.Warn=function(t,e){1<n&&console.warn(a.logPrefix(this.Level.Warn)+t,e||""),2<a.ServerLogLevel&&a.attemptUpload(a.logUploadString(this.Level.Warn,t,e))},a.Debug=function(t,e){2<n&&console.debug(a.logPrefix(this.Level.Debug)+t,e||""),2<a.ServerLogLevel&&a.attemptUpload(a.logUploadString(this.Level.Debug,t,e))},a.Log=function(t,e){2<n&&console.log(a.logPrefix(this.Level.Log)+t,e||""),2<a.ServerLogLevel&&a.attemptUpload(a.logUploadString(this.Level.Log,t,e))},a.Info=function(t,e){3<n&&console.info(a.logPrefix(this.Level.Info)+t,e||""),3<a.ServerLogLevel&&a.attemptUpload(a.logUploadString(this.Level.Info,t,e))}},a.getStackTrace=function(){return"\nStack Trace: "+(new Error("").stack||"").split("\n").slice(3,9).join("\n")},a.logPrefix=function(t){function e(){}return e.toString=function(){return t+"\t"+p().format("H:mm:ss.SSS")+"\t"},e},a.logUploadString=function(t,e,n){e=t+"<--\x3e"+p().format("H:mm:ss.SSS")+"<--\x3e"+e+"<--\x3e";return n&&(e+=JSON.stringify(n)),t!==this.Level.Info&&(e+=a.getStackTrace()),e},a.retryConnection=function(t){var e=[1,3,15,60,180,900];t===e.length&&--t,setTimeout(function(){a.uploadStoredLogs(t)},1e3*e[t])},a.storeLocal=function(t){var e,n,i=localStorage.length-1;if(localStorage.getItem("0000"))for(;!n;)(e=localStorage.key(i)).match(/\d\d\d\d/)&&(n=("000"+(parseInt(e)+1)).slice(-4)),--i;else n="0000";localStorage.setItem(n,t)},a.traceConsoleError=function(){var i=console.error;console.error=function(t,e){var n=a.logPrefix(a.Level.Error)+t;i.apply(console,[n,e||""]),a.attemptUpload(a.logUploadString(a.Level.Error,t,e))}},a.uploadStoredLogs=function(e){function n(t){t<localStorage.length?(i=localStorage.key(t)).match(/\d\d\d\d/)?(o=localStorage.getItem(i),Y.DeltaClientLib.createLog(o,function(){r=!0,localStorage.removeItem(i),n(t)},function(){a.retryConnection(r?0:e+1)})):n(t+1):a.logUploadConnected=!0}var i,o,r=!1;n(0)},a.ServerLogLevel=4,a.debounceRetryConnection=_.debounce(function(){a.retryConnection(0)},300,{maxWait:1e3}),i=a,Y.Log=i,(n=(n=i=Y.Log||(Y.Log={})).Level||(n.Level={})).Info="INFO",n.Warn="WARN",n.Error="ERROR",n.Fatal="FATAL",n.Critical="CRITICAL",n.Off="OFF",n.Handled="HANDLED",n.Debug="DEBUG",i.trace($.cookie("dashboard-log-level")),window.onerror=function(t,e,n,i,o){t&&t.toString&&t.toString(),o&&o.toString&&o.toString(),Y.DeltaClientLib.createLog(t+"<--\x3e"+p().format("H:mm:ss.SSS")+"<--\x3e"+o,_.noop,_.noop)},function(r){function t(){}t.initializeDeltaClient=function(t,e,n,i,o,r,s,a,l,u,c,p,d){this.host=t,this.port=e,this.secure=n,this.fromUrl=i,this.username=o,this.successCallback=s,this.errorCallback=a,this.token=l,this.appid=u,this.saml=p,this.forceLogin=d,this.properties={},this.clientLoggedIn=!1,this.errorCallback=a,this.deltaClient?this.saml?this.deltaClient.register("dashboards"):this.deltaClient.login(this.username,r,this.appid,[],this.forceLogin):(this.deltaClient=new win.Client({host:this.host,port:this.port,secure:this.secure,fromURL:this.fromUrl},c,c),this.initDeltaClient(r))},t.initializeDeltaClientCopy=function(t,e,n,i,o,r,s,a,l,u,c){this.host=e,this.port=n,this.secure=i,this.fromUrl=o,this.username=r,this.successCallback=a,this.errorCallback=l,this.appid=u,this.saml=c,this.properties={},this.clientLoggedIn=!0,this.deltaClient=t,this.deltaClient.DeltaClientLogin=!0,this.initDeltaClient(s)},t.initDeltaClient=function(t){var n=this,i=!1,o=null;this.deltaClient.status._subscribe({next:function(t){switch(t.type){case win.Client.status.CONNECTING:i&&($(n).trigger("DeltaClientDisconnect"),n.disconnected=!0),n.eCode=t.eCode,o=o||_.delay(function(){n.sendError(1006===n.eCode?"WebSocket connection error, please check proxy settings":"Server connectivity issues, please try again.")},n.DEFAULT_TIMEOUT);break;case win.Client.status.CONNECTED:try{i=!0;var e=n.deltaClient.systemConfig();e&&(n.showLastLoginAttempts=e.showLastLoginAttempts),n.clientLoggedIn?$(n).trigger("DeltaClientConnect"):n.onFirstLogin(),clearTimeout(o),$.cookie("deltaToken",n.deltaClient.tokenKey(),{expires:30,path:"/"}),o=null}catch(t){n.sendError("There was a problem connecting to the server: "+t)}break;case win.Client.status.LOGGED_IN:clearTimeout(o),o=null,n.username=n.deltaClient.user();break;case win.Client.status.LOGGED_OUT:n.changingPassword&&_.isString(t.data)&&-1!==t.data.indexOf("Client action")?setTimeout(function(){this.changingPasswordFailed=!1,this.deltaClient.resetPassword(this.username,this.changingPasswordOld,this.changingPasswordNew)},500):_.isString(t.data)&&-1===t.data.indexOf("no connection available")?($.removeCookie("deltaToken",{path:"/"}),n.saml?n.ssoLogout("local"):(-1!==t.data.indexOf("timeout")?$.cookie("deltaLoginError","Your session timed out",{expires:30,path:"/"}):-1!==t.data.indexOf("force logout")?$.cookie("deltaLoginError","Forced logout",{expires:30,path:"/"}):-1!==t.data.indexOf("session limit")?$.cookie("deltaLoginError",t.data.split("|")[2],{expires:30,path:"/"}):$.removeCookie("deltaLoginError",{path:"/"}),window.onbeforeunload=function(t){},location.reload())):!t.data&&n.disconnected?n.errorCallback("loginRequired"):i&&($.removeCookie("deltaToken",{path:"/"}),location.reload());break;case win.Client.status.EXPIRED:clearTimeout(o),o=null,r.Log.Log("Expired",t),n.sendError("Your password has expired");break;case win.Client.status.RESET:clearTimeout(o),o=null,$(n).trigger("Reset"),n.sendError("Please reset password"),r.Log.Log("Reset",t);break;case win.Client.status.RESET_FAIL:clearTimeout(o),o=null,n.changingPasswordFail&&n.changingPasswordFail(t.data),n.changingPasswordFailed=!0,r.Log.Log("Reset Fail",t);break;case win.Client.status.RESET_SUCCESS:n.changingPassword&&(n.changingPasswordFailed?n.changingPassword=!1:(n.changingPasswordSuccess&&n.changingPasswordSuccess(),n.changingPassword=!1,n.changingPasswordFail=null,n.changingPasswordSuccess=null,n.changingPasswordOld=null,n.changingPasswordNew=null,n.successCallback&&n.successCallback(),$.cookie("deltaLoginError","Password changed. Please login again.",{expires:30,path:"/"}),$.removeCookie("deltaToken",{path:"/"})));break;case win.Client.status.FAULT:r.Log.Log("Fault",t),clearTimeout(o),o=null,"userSessionLimit"!==t.data&&$.removeCookie("deltaToken",{path:"/"}),n.sendError(t.data)}},error:function(){r.Log.Error("onError",arguments)},complete:function(){r.Log.Info("onCompleted",arguments)}}),this.token=this.token||this.deltaClient.tokenKey(),this.deltaClient.DeltaClientLogin?this.onFirstLogin():this.saml?this.deltaClient.register("dashboards"):this.token?this.deltaClient.loginWithTokenKey(this.token,this.appid):this.deltaClient.login(this.username,t,this.appid,[],this.forceLogin)},t.getDashboardProperty=function(t){return this.properties[t]},t.changeUserPassword=function(t,e,n,i){this.changingPassword||(this.changingPassword=!0,this.changingPasswordOld=t,this.changingPasswordNew=e,this.changingPasswordSuccess=n,this.changingPasswordFail=i,this.changingPasswordFailed=!1,this.deltaClient.resetPassword(this.username,this.changingPasswordOld,this.changingPasswordNew))},t.onFirstLogin=function(){var e=this;this.deltaClient.request("ConfigAPI.getConfigParameter",function(t){t.rows.forEach(function(t){e.properties[t.Property.elementValue]=t.Value.elementValue}),"true"==e.properties.legacy_managed&&(e.startManagedQuery=e.startLegacyManagedQuery,e.startManagedQuery2=e.startLegacyManagedQuery2),r.Tools.timezone=$.cookie("dashboard-timezone")||e.properties.timezone||p.tz.guess(),e.clientLoggedIn=!0,e.deltaClient.clientLoggingEnabled()&&(e.properties.hasOwnProperty("log-level")&&(r.Log.ServerLogLevel=Number(e.properties["log-level"])),r.Log.setClientLogging()),$(e).trigger("DeltaClientLogin"),e.deltaClient.DeltaClientLogin=!0,e.successCallback&&e.successCallback(),$(e).trigger("DeltaClientConnect")},_.noop,"DASHproperties","DEFAULT","delta_install_default")},t.sendError=function(t,e){this.errorCallback&&this.errorCallback(t)},t.ssoLogout=function(t){this.deltaClient&&this.deltaClient.ssoLogout(t),$.removeCookie("deltaToken",{path:"/"}),_.delay(function(){location.reload()},500)},t.clientLoggedIn=!1,t.changingPassword=!1,t.changingPasswordFailed=!1,t.disconnected=!1,t.DEFAULT_TIMEOUT=6e4,r.DCBase=t}(I=I||{}),n=I=I||{},K=function(t,e){this.offset=t,this.qtype=e},n.qAtom=K,l(ut,H=K),z=ut,n.qVector=z,W=function(t,e,n){this.qtype=0,this.isSorted=t,this.values=e,this.end=n},n.qGenericList=W,Q=function(t,e){this.qtype=11,this.isSorted=t,this.offsets=e},n.qSymList=Q,j=function(t,e,n,i){this.keys=n,this.values=i,this.qtype=t,this.isSorted=e},n.qDict=j,n.getTypeSize=ct,n.u8u16=function(t){for(var e=[],n=0;n<t.length;n++){var i=t.charCodeAt(n);i<128?e.push(i):i<2048?e.push(192|i>>6,128|63&i):i<55296||57344<=i?e.push(224|i>>12,128|i>>6&63,128|63&i):(i=65536+((1023&i)<<10|1023&t.charCodeAt(++n)),e.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i))}return e},n.u16u8=pt,n.deserialize=function(t,e,n){var p=void 0===e?8:e,d=new DataView(t);function h(){return d.getInt8(p++)}function g(){return d.getUint8(p++)}function f(){var t=d.getInt32(p,!0);return p+=4,t}function m(t){var e,n=1===g(),i=f(),o=ct(t);if(o)return e=new z(t,n,i,p),p+=i*o,e;if(11===t){for(var r=new Array(i),s=0;s<i;s++){r[s]=p;for(;0!==g(););}return new Q(n,r)}if(0!==t)throw"Unsupported type";for(var a=new Array(i),s=0;s<i;s++)a[s]=v();return new W(n,a,p)}function y(){var t=1===g();return 99!==h()&&console.error("c.js Assertion type=99 failed."),new j(98,t,m(h()),m(h()))}function v(){var t,e,n,i=h();if(-20<i&&i<0){var o=i,r=new K(p,o),s=ct(-o);if(s)p+=s;else{if(-11!==o)throw"Unsupported type";for(;0!==g(););}return r}if(99<i){s=new K(p,i);if(100===i){for(var a,l=[];0!==(a=d.getUint8(p++));)l.push(a);return pt(l),v()}if(i<104)return 0===h()&&101===i?new K(p-1,i):s;if(105<i)v();else for(var u=0,c=f()||0;u<c;u++)v();return s}return 99===i?98===d.getUint8(p)?(t=1===g(),e=y(),p++,n=y(),new j(99,t,e,n)):(t=m(h()),n=98===(e=g())?y():m(e),new j(99,!1,t,n)):98===i?y():m(i)}if(n){if(0===h()){f();if(0===h()&&-6===h())return e=f(),h(),[e,g(),v()]}return[0,5,"Message parse error"]}return v()},f=I=I||{},G=f.DCBase,l(y,G),y.createLog=function(t,e,n){var i,o,r,s;this.deltaClient&&this.deltaClient.clientLoggingEnabled()&&(s=[],_.isString(t)&&(s=t.split("<--\x3e")),t=this.username,i=s[0]||"",o=s[1]||"",r=s[2]||"",s=s[3]||"",this.deltaClient.request("ClientLoggerAPI.log",function(t){_.isFunction(e)&&e()},function(t){console.log("Client logging FAILED\n\n"),null==t?console.log("Client logging: "+r+"failed. Data is null"):console.log("Client logging:",t.toString()),_.isFunction(n)&&n()},t,o,i,r,s))},y.deleteComponent=function(t,e,n){this.deltaClient.request("ComponentAPI.deleteComponent",function(t){e(t)},function(t){n(t)},t)},y.connectionCollectionSync=function(t,e,n){if("read"!==t)throw"data operation not supported for DocumentCollection";y.deltaClient.request("ConnectionAPI.getConnections",y.generateSuccessCallback(n),y.generateErrorCallback(n,"Error reading connections"))},y.connectionSync=function(t,e,n){var i,o=this;switch(t){case"update":(i=new win.ConnectionEntity).originalName=o.get("originalName");case"create":(i=i||new win.ConnectionEntity).name=o.id,i.host=o.get("host"),i.port=o.get("port"),i.user=o.get("user"),i.password=o.get("password"),i.type=o.get("type"),i.driver=o.get("driver"),i.tls=o.get("tls"),y.deltaClient.request("ConnectionAPI.updateConnections",y.generateSuccessCallback(n),y.generateErrorCallback(n,"Error "+t.substring(0,5)+"ing connection"),[i],[]);break;case"delete":y.deltaClient.request("ConnectionAPI.updateConnections",y.generateSuccessCallback(n),y.generateErrorCallback(n,"Error deleting connection"),[],[o.id]);break;default:throw"data operation not supported for Document"}},y.connectionGroupCollectionSync=function(t,e,n){if("read"!==t)throw"data operation not supported for ConnectionGroup Collection";y.deltaClient.request("ConnectionAPI.getConnectionGroups",y.generateSuccessCallback(n),y.generateErrorCallback(n,"Error reading connection groups"))},y.connectionGroupSync=function(t,e,n){var i,o=this;switch(t){case"create":(i=new win.ConnectionGroupEntity).name=o.id,i.type=o.get("type"),i.connections=o.get("connections"),i.connectionsType=o.get("connectionsType"),y.deltaClient.request("ConnectionAPI.createConnectionGroup",y.generateSuccessCallback(n),y.generateErrorCallback(n,"Error creating connection group"),i);break;case"update":(i=new win.ConnectionGroupEntity).name=o.id,i.type=o.get("type"),i.connections=o.get("connections");for(var r=0;r<i.connections.length;r+=1)i.connectionsType.push("default");y.deltaClient.request("ConnectionAPI.updateConnectionGroup",y.generateSuccessCallback(n),y.generateErrorCallback(n,"Error updating connection group"),i);break;case"delete":y.deltaClient.request("ConnectionAPI.deleteConnectionGroup",y.generateSuccessCallback(n),y.generateErrorCallback(n,"Error deleting connection group"),o.id);break;default:throw"data operation not supported for Connection Group"}},y.documentCollectionSync=function(t,e,i){if("read"!==t)throw"data operation not supported for DashCollection";y.deltaClient.request("ProjectAPI.getDashboards",function(t){var n=[];_.each(t,function(e){if(!e.accessLevel||!f.DocumentCollection.requiredAccessLevel||e.accessLevel===f.DocumentCollection.requiredAccessLevel)try{var t=JSON.parse(e.description);n.push(new f.Document({id:e.name,name:e.displayName,creationDate:t.creationDate,lastUpdateDate:t.lastUpdateDate||t.creationDate,screenDetails:t.screenDetails||[],thumb:t.thumb||null,tags:t.tags||[]}))}catch(t){f.Log.Error("Error parsing dashboard description",e)}}),i.success&&i.success(n)},function(t){alert("Retrieve Dashboards FAILED"),i.error&&i.error(t)})},y.documentSync=function(t,e,n){var i,o=this;switch(t){case"read":y.deltaClient.request("ProjectAPI.getDashboard",function(t){var e;t?((e=JSON.parse(t.dataJSON)).permissionEntity=t.permissionEntity,n.success&&n.success(e)):n.error&&n.error()},function(t){n.error&&n.error(t)},o.id);break;case"update":i={name:o.id,displayName:o.get("name"),description:JSON.stringify({creationDate:o.get("creationDate"),lastUpdateDate:o.get("lastUpdateDate"),tags:o.get("tags"),screenDetails:o.get("screenDetails"),thumb:o.get("thumb")},null,2),dataJSON:JSON.stringify(_.omit(o.attributes,["permissionEntity"]),null,2),class:"api.entity.DashboardEntity",permissionEntity:{permissions:o.get("permissionEntity")?o.get("permissionEntity").permissions:{}}},y.deltaClient.request("ProjectAPI.setDashboard",function(t){t?n.success&&n.success(o.attributes):n.error&&n.error()},function(t){n.error&&n.error(t)},i);break;case"delete":y.deltaClient.request("ProjectAPI.deleteDashboard",function(t){t?n.success&&n.success():n.error&&n.error()},function(t){n.error&&n.error(t)},o.id);break;default:throw"data operation not supported for Document"}},y.documentViewSync=function(t,e,n){var i,o=this;switch(t){case"read":i=y.generateErrorCallback(n,"Error reading viewstate"),y.deltaClient.request("UserSettingsAPI.readUserSetting",function(t){var e;t?n.success&&(t&&t[0]&&(e=JSON.parse(t[0].jsonData)),n.success(e)):i()},i,o.id);break;case"create":case"update":i=y.generateErrorCallback(n,"Error updating viewstate"),y.deltaClient.request("UserSettingsAPI.updateUserSetting",function(t){t?n.success&&n.success(o.attributes):i()},i,{class:"api.entity.UserSettingEntity",id:o.id,type:"dashboard_view_state",jsonData:o.attributes});break;case"delete":i=y.generateErrorCallback(n,"Error deleting viewstate"),y.deltaClient.request("UserSettingsAPI.deleteUserSetting",function(t){t?n.success&&n.success():i()},i,o.id);break;default:throw"data operation not supported for user settings: "+t}},y.exportAnalyticData=function(t,e,n,i,o,r,s){var a=[],l=null;n=n||[],_.keys(o).length&&(l=this.processExportParams(o)),this.createParamsObj(a,n),y.exportData(i,t,a,l,e,r,s)},y.exportQueryData=function(t,e,n,i,o,r,s){var a=[],e=kdb.KDBQuery.create(e,void 0,void 0,!0);n&&(this.createParamsObj(a,n),e.parameters=a,_.keys(o).length&&(e.uiParams=this.processExportParams(o))),y.exportData(i,e,null,null,t,r,s)},y.exportPivotData=function(t,e,n){var i,o=t.pivotSource,r=t.queryParams,s=[],a={},l="";t&&(t.exportName&&(l=t.exportName),t.exportParams&&(a=t.exportParams)),i=f.Pivot.constructPivotQuery(t),i=kdb.KDBQuery.create(i,void 0,void 0,!0),"query"===o&&(this.createParamsObj(s,r),i.parameters=s,_.keys(a).length&&(i.uiParams=this.processExportParams(a))),y.exportData(l,i,null,null,t.connection,e,n)},y.exportData=function(n,t,e,i,o,r,s){var a=this,s=["ExportAPI.export"+(n?"ToFile":""),function(t){var e;_.isFunction(r)&&(e=t+"/"+(t=(n||t)+".zip"),t=a.deltaClient.connection.url+"/FileDownloadServlet?client="+a.deltaClient.base64DeltaClient()+"&filename="+t+"&filepath="+e,r(t))},s,t];e&&s.push(e),i&&s.push(i),s.push(o),n&&s.push(n),this.deltaClient.request.apply(this.deltaClient.request,s)},y.generateSuccessCallback=function(e){return function(t){e.success&&e.success(t)}},y.generateErrorCallback=function(e,n){return function(t){f.Log.Error(n,t),e.error&&e.error(t)}},y.getComponents=function(e,n){f.Log.Info("Running Get Components"),this.deltaClient.request("ComponentAPI.getComponents",function(t){e(t)},function(t){n(t)})},y.getDeltaAnalytics=function(e){this.deltaClient.request("AnalyticAPI.getAnalytics",function(t){e&&e(t)},function(){f.Log.Error("Failed to retrieve Analytics\n\n")})},y.getDeltaInstances=function(e){this.deltaClient.request("ConnectionAPI.getProcessInstances",function(t){e&&e(t)},function(){f.Log.Error("Failed to retrieve Instances\n\n")})},y.getPivotData=function(t,i,e,o){var n=t.connection,r=t.pivotSource,s=t.queryParams,a=[],l=t.maxRows||null,u=f.Pivot.constructPivotQuery(t),u=kdb.KDBQuery.create(u,l);"query"===r&&(this.createParamsObj(a,s),u.parameters=a),o&&o.trigger("serverStart"),this.deltaClient.request("QueryAPI.runQueryBA",function(t,e){o&&o.trigger("serverEnd");var n=f.deserialize(e);i&&i(n,e)},function(){e&&e(arguments)},u,n),"subscription"===t.subscriptionType&&(o&&o.trigger("serverStart"),this.deltaClient.request("SubscriptionAPI.addSubscription",function(t,e){i&&(o&&o.trigger("serverEnd"),e&&e.byteLength&&(t.dataSet=f.deserialize(e)),i(t,e))},function(t){e&&e(t)},u,n,1e3*t.subscriptionInterval))},y.getPolledSubscription=function(e){return this.deltaClient.connection.oobupdate.filter(function(t){return"QRPolledMessage"===t.type&&t.data[0]===e})},y.getQueryData=function(t,e,n,i,o,r,s,a,l){y.getQueryData2(t,e,n,i,y.legacyRowCallback(o),r,s,a,l)},y.getQueryData2=function(t,n,e,i,o,r,s,a,l){var u,c,p,d=[],h=s&&0!=s?Number(s):null,g=this;a&&n&&_.includes(y.PAGING_TYPES,a.type)||(a={type:"NONE"}),"sql"===t?this.getSqlQueryData(n,this.strip(e),i,o,r,s):(a&&"NONE"!==a.type?(c=new kdb.QDict,_.each(a.sorting,function(t,e){c.add(e,!0===t,kdb.KDB.BOOLEAN)}),(u=kdb.KDBQuery.createPaged(this.strip(e),a.type,a.num,a.size,c)).unlimitedRows=-1===a.size):u=kdb.KDBQuery.create(this.strip(e),h),i&&(this.createParamsObj(d,i),u.parameters=d),f.Log.Info("QUERY: ",u),g=this,t=[n?"QueryAPI.runQueryBA":"QueryAPI.runQuery",function(t,e){l&&l.trigger("serverEnd"),g.deltaClient.connection.removeResponder(p.uid);t=n?f.deserialize(e):t;o&&o(t,e)},function(){g.deltaClient.connection.removeResponder(p.id),r&&r(arguments)},u],n&&t.push(n),l&&l.trigger("serverStart"),p=this.deltaClient.request.apply(this.deltaClient.request,t))},y.getConfigAPIDataWithProfile=function(t,e,n,i,o,r,s,a){n=[n,function(t){t&&s&&s(t)},function(){a&&a(arguments)},i,o,r];e&&n.push(e),this.deltaClient.request.apply(this.deltaClient.request,n)},y.getConfigAPIData=function(t,e,n,i,o,r){n=[n,function(t){t&&o&&o(t)},function(){r&&r(arguments)},i];e&&n.push(e),this.deltaClient.request.apply(this.deltaClient.request,n)},y.getConfigAPIDataNoParam=function(t,e,n,i,o){n=[n,function(t){t&&i&&i(t)},function(){o&&o(arguments)}];e&&n.push(e),this.deltaClient.request.apply(this.deltaClient.request,n)},y.getAPIQueryData=function(t,n,e,i,o,r){var s=[],a=kdb.APIQuery.create(e);a.lambda=e,this.createParamsObj(s,i),a.parameters=s,e=[n?"QueryAPI.runQueryBA":"QueryAPI.runQuery",function(t,e){t=n?f.deserialize(e):t;o&&o(t,e)},function(){r&&r(arguments)},a],n&&e.push(n),this.deltaClient.request.apply(this.deltaClient.request,e)},y.getSqlQueryData=function(t,e,n,i,o,r){var s,a=[],r=r||2e3;e=$.trim(e),n?(s=kdb.SQLQuery.create(e,r),this.createSqlParamsObj(a,n),s.parameters=a):s=kdb.SQLQuery.create(e,r),n&&(s=kdb.SQLQuery.create(e,r),this.createSqlParamsObj(a,n),s.parameters=a),this.deltaClient.request("QueryAPI.runQuery",function(t){i&&i(t)},function(){o&&o(arguments)},s,t)},y.isConnectionAlive=function(t){return this.deltaClient.request("ConnectionAPI.isAlive",function(t){f.Log.Info(t)},function(t){f.Log.Info(t)},t)},y.legacyRowCallback=function(n){return function(t,e){n&&(e&&e.byteLength&&(t.dataSet?t.dataSet=f.ipc.Parse.reshape(t.dataSet,e).toLegacy():t=f.ipc.Parse.reshape(t,e).toLegacy()),n(t))}},y.logout=function(){this.deltaClient?this.deltaClient.logout():($.removeCookie("deltaToken",{path:"/"}),location.reload())},y.processExportParams=function(o){var r=new kdb.QDict;return _.each({columnLabel:"SYMBOL",dateFormat:"STRING"},function(e,t){var n,i;o[t]&&o[t].length&&(n=new kdb.QDict,i=o[t].split("&&"),_.each(i,function(t){t=t.trim().split("#");n.add(t[0],t[1],kdb.KDB[e])}),r.add(t,n,kdb.KDB.DICT))}),r},y.runAnalytic=function(t,e,n,i,o,r,s,a){y.runAnalytic2(t,e,n,y.legacyRowCallback(i),o,r,s,a)},y.runAnalytic2=function(e,n,t,i,o,r,s,a){var l,u,c=[],r=r&&0!=r?Number(r):null,p=this;t=t||[],n=n||"ds_rdb_fx_eval",s&&n&&_.includes(y.PAGING_TYPES,s.type)||(s={type:"NONE"}),this.createParamsObj(c,t),s&&"NONE"!==s.type?(a&&a.trigger("serverStart"),l=this.deltaClient.request(n?"AnalyticAPI.runPagedBA":"AnalyticAPI.runPaged",function(t,e){a&&a.trigger("serverEnd"),p.deltaClient.connection.removeResponder(l.uid);t=n?f.deserialize(e):t;i&&i(t,e)},function(t){p.deltaClient.connection.removeResponder(l.uid),f.Log.Error("Analytic run failed ("+e+")",t),o&&o(t)},e,c,n,s.type,s.num,s.size,_.keys(s.sorting)[0]||"",_.values(s.sorting)[0]||!1)):(a&&a.trigger("serverStart"),u=this.deltaClient.request(n?"AnalyticAPI.runBA":"AnalyticAPI.run",function(t,e){a&&a.trigger("serverEnd"),p.deltaClient.connection.removeResponder(u.uid);t=n?f.deserialize(e):t;i&&i(t,e)},function(t){p.deltaClient.connection.removeResponder(u.uid),f.Log.Error("Analytic run failed ("+e+")",t),o&&o(t)},e,c,n,r))},y.runApiFunction=function(n,t,e,i,o){var r=_.once(function(t,e){t?e&&i&&i(e):(f.Log.Error("Api Analytic run failed ("+n+")",e),o&&o(e)),clearTimeout(this.timeout)});this.timeout=_.delay(function(){r&&r(!1,"timed out")},this.DEFAULT_TIMEOUT),e=_.flatten([n,_.partial(r,!0,_),_.partial(r,!1,_),e]),this.deltaClient.request.apply(this.deltaClient,e)},y.servicesSync=function(t,e,n){throw"data operation not supported for Service"},y.servicesCollectionSync=function(t,e,n){if("read"!==t)throw"data operation not supported for Service Collection";y.deltaClient.request("ConnectionAPI.getServiceClasses",y.generateSuccessCallback(n),y.generateErrorCallback(n,"Error reading services data"))},y.setComponent=function(e,t,n,i,o,r){this.deltaClient.request("ComponentAPI.setComponent",function(t){f.Log.Info("Save component "+e+" successful",t),o(t)},function(t){f.Log.Error("Save Dashboard "+e+" FAILED"),r(t)},{name:e,displayName:t,description:n,dataJSON:i,class:"api.entity.ComponentEntity"})},y.startManagedAnalytic=function(t,e,n,i,o,r,s,a){y.startManagedAnalytic2(t,e,n,y.legacyRowCallback(i),o,r,s,a)},y.startManagedAnalytic2=function(n,i,t,e,o,r,s,a){var l=this,u=[],c=e||_.noop,p=s||null;this.createParamsObj(u,t=t||[]),a&&a.trigger("serverStart"),this.deltaClient.request(i?"AnalyticAPI.runBA":"AnalyticAPI.run",function(t,e){a&&a.trigger("serverEnd"),t=t||{},e&&e.byteLength&&(t=f.deserialize(e)),c(t,e),l.deltaClient.request("AnalyticAPI.startPolled",function(t,e){"com.fd.delta.stream.queryrouter.entity.QRResponseMessage"==t.class&&t.success?c({class:"207",add:!0,subId:t.runID,clientId:"polled"},void 0):o(t),y.getPolledSubscription(t.runID).subscribe(function(t){t.data[1]||o("Analytic Failed: "+t.data),a&&a.trigger("serverEnd"),t.appMsg&&t.appMsg.byteLength&&(t.data.class="209",t.data.subId=t.data[0],t.data.clientId="polled",t.data.dataSet=f.deserialize(t.appMsg)),c(t.data,t.appMsg)})},function(t){f.Log.Error("Managed Analytic run failed.",t),o&&o(t)},n,u,i,r,p)},function(t){f.Log.Error("Analytic run failed.",t),o&&o(t)},n,u,i,p)},y.startLegacyManagedQuery=function(t,e,n,i,o,r,s,a,l){y.startLegacyManagedQuery2(t,e,n,y.legacyRowCallback(i),o,r,s,a,l)},y.startLegacyManagedQuery2=function(t,e,n,i,o,r,s,a,l){var u,c,p=this,d=i||_.noop,i=[],s=s&&0!=s?Number(s):null,a=(a=a&&t&&_.includes(y.PAGING_TYPES,a.type)?a:{type:"NONE"})&&"NONE"!==a.type?(u=new kdb.QDict,_.each(a.sorting,function(t,e){u.add(e,!0===t,kdb.KDB.BOOLEAN)}),kdb.KDBQuery.createPaged(this.strip(e),a.type,a.num,a.size,u)):kdb.KDBQuery.create(this.strip(e),s);n&&(this.createParamsObj(i,n),a.parameters=i),e=[t?"QueryAPI.runQueryBA":"QueryAPI.runQuery",function(t,e){t=t||{},l&&l.trigger("serverEnd"),e&&e.byteLength&&(t=f.deserialize(e)),d(t,e),p.deltaClient.request.apply(p.deltaClient.request,c)},function(){o&&o(arguments)},a,t],c=["SubscriptionAPI.addSubscription",function(t,e){d&&(e&&e.byteLength&&(t.dataSet=f.deserialize(e)),d(t,e))},function(t){o&&o(t)},a,t,r],l&&l.trigger("serverStart"),this.deltaClient.request.apply(this.deltaClient.request,e)},y.startManagedQuery=function(t,e,n,i,o,r,s,a,l){y.startManagedQuery2(t,e,n,y.legacyRowCallback(i),o,r,s,a,l)},y.startManagedQuery2=function(t,e,n,i,o,r,s,a,l){var u,c=i||_.noop,i=[],s=s&&0!=s?Number(s):null,a=(a=a&&t&&_.includes(y.PAGING_TYPES,a.type)?a:{type:"NONE"})&&"NONE"!==a.type?(u=new kdb.QDict,_.each(a.sorting,function(t,e){u.add(e,!0===t,kdb.KDB.BOOLEAN)}),kdb.KDBQuery.createPaged(this.strip(e),a.type,a.num,a.size,u)):kdb.KDBQuery.create(this.strip(e),s);n&&(this.createParamsObj(i,n),a.parameters=i),l&&l.trigger("serverStart"),this.deltaClient.request("QueryAPI.startPolledQuery",function(t){"com.fd.delta.stream.queryrouter.entity.QRResponseMessage"==t.class&&t.success?c({class:"207",add:!0,subId:t.runID,clientId:"polled"},void 0):o(t),y.getPolledSubscription(t.runID).subscribe(function(t){if(l&&l.trigger("serverEnd"),!t.data[1])return o("Query Failed: "+t.data);t.appMsg&&t.appMsg.byteLength&&(t.data.class="209",t.data.subId=t.data[0],t.data.clientId="polled",t.data.dataSet=f.deserialize(t.appMsg)),c(t.data,t.appMsg)})},function(){o&&o(arguments)},a,t,r)},y.startStreamingAnalytic=function(t,e,n,i,o,r){y.startStreamingAnalytic2(t,e,n,y.legacyRowCallback(i),o,r)},y.startStreamingAnalytic2=function(n,t,e,i,o,r){var s=[];this.createParamsObj(s,e||[]),r&&r.trigger("serverStart"),this.deltaClient.request("AnalyticAPI.startStreaming",function(t,e){r&&r.trigger("serverEnd"),e&&e.byteLength&&(t.dataSet=f.deserialize(e)),e&&10===e.byteLength&&101===new DataView(e).getInt8(8)?f.Log.Info("Streaming "+n+" returned unary primitive!"):i&&i(t,e)},function(t){f.Log.Info("Analytic run failed.",t),o&&o(t)},n,s,t)},y.strip=function(t){if(null==t||0==t.length)return t;t=t.replace(/((^|\s+)\/.*$)|^\s+|\s*\n/gm," ");var e=/^\{(.*)\}\s*\[\]\s*$/g.exec(t);return t=e?e[1]:t},y.removeSubscriptions=function(t){var n,i,o,e,r=this;t?(n=0==t.indexOf("polled:"),i=n?t.substr(7):t.split(":")[1],o=this.deltaClient.request(n?"QueryAPI.stopPolledQuery":"SubscriptionAPI.removeSubscription",function(t){var e;n&&-1!=(e=y.getPolledSubscription(i))&&e.unsubscribe(),r.deltaClient.connection.removeResponder(o.uid),f.Log.Info("Stop Subscriptions succeeded.",t)},function(t){r.deltaClient.connection.removeResponder(o.uid),f.Log.Error("Stop Subscriptions failed",t)},n?[i]:t),this.deltaClient.connection.removeResponder(i)):(e=this.deltaClient.request("SubscriptionAPI.removeSubscriptions",function(t){r.deltaClient.connection.removeResponder(e.uid),f.Log.Info("Stop Subscriptions succeeded.",t)},function(t){r.deltaClient.connection.removeResponder(e.uid),f.Log.Error("Stop Subscriptions failed",t)}),this.deltaClient.connection.oobupdate.filter(function(t){return"QRPolledMessage"===t.type}).unsubscribe())},y.updateTable=function(n,t,e){for(var i=this,o=[],r=0;r<3;r+=1)o[r]={type:"dict",value:{},index:r};_.each(n.updateParams,function(t){o.push(t)}),_.each(o,function(t,e){t.index=e}),_.each(n.addedDict.items,function(t,e){o[0].value[e]={type:i.updateTableGetListType(n.typeConfig[e],t),value:t}}),_.each(n.updatedDict.items,function(t,e){o[1].value[e]={type:i.updateTableGetListType(n.typeConfig[e],t),value:t}}),_.each(n.deletedDict.items,function(t,e){o[2].value[e]={type:i.updateTableGetListType(n.typeConfig[e],t),value:t}}),"analytic"===n.updateType?n.updateAnalytic&&i.runAnalytic(n.updateAnalytic,n.connection,o,t,e):i.getQueryData("kdb",n.connection,n.query,o,t,e)},y.updateTableGetListType=function(t,e){var n;switch(t){case 0:return n=_.isArray(e)?_.isBoolean(e[0])?"listlistboolean":_.isString(e[0])?"listliststring":"listlistsymbol":_.isString(e)?"string[]":"symbol[]";case 1:return"boolean[]";case 2:return"guid[]";case 4:return"byte[]";case 5:return"short[]";case 6:return"int[]";case 7:return"long[]";case 8:return"real[]";case 9:return"float[]";case 10:return n="char[]",_.each(e,function(t){1<t.length&&(n="string[]")}),n;case 11:return"symbol[]";case 12:return"timestamp[]";case 13:return"month[]";case 14:return"date[]";case 15:return"datetime[]";case 16:return"timespan[]";case 17:return"minute[]";case 18:return"second[]";case 19:return"time[]";default:return"symbol[]"}},y.createDeltaObj=function(n){function i(t){return _.has(t,"i")||"string"!=typeof t?t:(10<(t=t.replace("D","T").replace(/(\d\d\d\d)\.(\d\d)\.(\d\d)/,"$1-$2-$3")).length&&(t+="Z"),f.Tools.convertISODatetimeToKDBLikeObject(t))}var o,r,s,e;switch(n.type.toLowerCase()){case"boolean":(o=new kdb.QBoolean).setValue("string"==typeof n.value?"1b"==n.value:n.value);break;case"guid":o=new kdb.QGUID,e="string"==typeof n.value?n.value.match(/"G"\$"(.+)"$/):n.value,o.value=e?e[1]:"0Ng"==n.value?null:n.value;break;case"symbol":o=new kdb.QSymbol,e="string"==typeof n.value?n.value.match(/`\$"(.*)"$/):n.value,o.value=e?e[1]:n.value;break;case"byte":(o=new kdb.QByte).value="string"==typeof n.value?parseInt(n.value):n.value;break;case"short":(o=new kdb.QShort).value=parseInt(n.value,10);break;case"int":case"integer":(o=new kdb.QInt).value=parseInt(n.value,10);break;case"long":(o=new kdb.QLong).value="number"==typeof n.value?n.value:parseInt(n.value,10);break;case"real":(o=new kdb.QReal).value=parseFloat(n.value);break;case"float":case"double":(o=new kdb.QFloat).value=parseFloat(n.value);break;case"char":(o=new kdb.QChar).setValue(n.value);break;case"timestamp":o=new kdb.QTimeStamp,null!==n.value&&(s=i(n.value),o.setValue(s.i),s&&s.n&&(o.nanoValue=s.n));break;case"month":o=new kdb.QMonth,null!==n.value&&o.setValue(_.has(n.value,"i")?n.value.i:n.value);break;case"date":o=new kdb.QDate,null!==n.value&&o.setValue(i(n.value).i);break;case"datetime":o=new kdb.QDateTime,null!==n.value&&o.setValue(i(n.value).i);break;case"timespan":(o=new kdb.QTimeSpan).setValue(_.has(n.value,"i")?n.value.i:n.value);break;case"minute":(o=new kdb.QMinute).setValue(_.has(n.value,"i")?n.value.i:n.value);break;case"second":(o=new kdb.QSecond).setValue(_.has(n.value,"i")?n.value.i:n.value);break;case"time":(o=new kdb.QTime).setValue(_.has(n.value,"i")?n.value.i:n.value);break;case"string":(o=new kdb.QString).setValue(n.value);break;case"string[]":o=new kdb.QList,r=[],_.each(n.value,function(t){(s=new kdb.QString).setValue(t),r.push(s)}),o.value=r;break;case"symbol[]":case"liststring":case"list":o=new kdb.QList,r=[],"string"==typeof n.value&&(e=n.value.match(/^\((.+)\)$/),n.value=e?e[1].split(";"):[n.value]),_.each(n.value,function(t){e="string"==typeof t?/`\$"(.*)"$/.exec(t):null,(s=new kdb.QSymbol).setValue(e?e[1]:t),r.push(s)}),o.value=r;break;case"listobject":o=new kdb.QList,r=[],_.each(n.value,_.bind(function(t){_.isEmpty(t)||(t=this.createDeltaObj(t),r.push(t))},this)),o.value=r;break;case"listlistsymbol":(o=new kdb.QList).value=_.map(n.value,function(t){var e=new kdb.QList;return e.value=_.map(t,function(t){var e=new kdb.QSymbol;return e.setValue(t),e}),e});break;case"listlistboolean":(o=new kdb.QList).value=_.map(n.value,function(t){var e=new kdb.QList;return e.value=_.map(t,function(t){var e=new kdb.QBoolean;return e.setValue(t),e}),e});break;case"listliststring":(o=new kdb.QList).value=_.map(n.value,function(t){var e=new kdb.QList;return e.value=_.map(t,function(t){var e=new kdb.QString;return e.setValue(t),e}),e});break;case"listlong":o=new kdb.QList,r=[],_.each(n.value,function(t){(s=new kdb.QLong).setValue(t),r.push(s)}),o.value=r;break;case"listtimestamp":o=new kdb.QList,r=[],_.each(n.value,function(t){var e=new kdb.QTimeStamp;null===t?e.setValue("0Np"):(s=i(t),e.setValue(s.i),s&&s.n&&(e.nanoValue=s.n)),r.push(e)}),o.value=r;break;case"dict":o=new kdb.QDict,_.each(n.value,_.bind(function(t,e){var n=t;_.isString(t)&&(n={type:"symbol",value:t}),t=this.createDeltaObj(n),o.values.push(t),o.fields.push(e)},this));break;case"table":o=new kdb.QFlip,_.each(n.value.columns,function(t,e){o.fields.push(t),o.values.push(this.createDeltaObj({type:n.value.types[e]+"[]",value:n.value.values[e]}))}.bind(this));break;case"nulltype":o=new kdb.QDict;break;case"listdate":o=new kdb.QList,r=[],_.each(n.value,function(t){var e=new kdb.QDate;null===t?e.setValue("0Nd"):e.setValue(i(t).i),r.push(e)}),o.value=r;break;default:-1<n.type.toLowerCase().indexOf("[]")&&(o=new kdb.QList,r=[],_.each(n.value,_.bind(function(t,e){r.push(this.createDeltaObj({type:n.type.toLowerCase().replace("[]",""),value:t,index:e}))},this)),o.value=r)}return o.orderIndex=n.index,o},y.createParamsObj=function(e,t){var n,i=0;t.attributes?n=t.attributes:t&&(n=t),n&&(_.each(n,_.bind(function(t){t.type&&"t"!==t.type&&("symbol[]"===t.type&&(t.type="list"),e[i]=this.createDeltaObj(t),i+=1)},this)),e.sort(function(t,e){return t.orderIndex-e.orderIndex}))},y.createSqlParamsObj=function(e,t){var i,o,r,n,s,a=0;t.attributes?n=t.attributes:t&&(n=t),s=function(t){var n;switch(t.type.toLowerCase()){case"boolean":(n=new kdb.SQLBoolean).value=t.value;break;case"guid":case"symbol":(n=new kdb.SQLVarChar).value=t.value;break;case"byte":(n=new kdb.SQLByte).value=t.value;break;case"short":(n=new kdb.SQLShort).value=t.value;break;case"int":case"integer":(n=new kdb.SQLInt).value=parseInt(t.value,10);break;case"long":(n=new kdb.SQLLong).value=t.value;break;case"real":(n=new kdb.SQLFloat).value=t.value;break;case"float":(n=new kdb.SQLFloat).value=parseFloat(t.value);break;case"double":(n=new kdb.SQLDouble).setValue(t.value);break;case"char":(n=new kdb.SQLVarChar).value=t.value;break;case"timestamp":(n=new kdb.SQLTime).setValue(t.value);break;case"month":(n=new kdb.SQLInt).setValue(t.value);break;case"date":case"datetime":(n=new kdb.SQLTime).setValue(new Date(t.value));break;case"timespan":(n=new kdb.SQLTime).setValue(t.value);break;case"minute":case"second":(n=new kdb.SQLInt).setValue(t.value);break;case"time":(n=new kdb.SQLTime).setValue(t.value);break;case"string":n=new kdb.SQLList,r=t.value.split(""),i=[],_.each(r,function(t){(o=new kdb.SQLVarChar).value=t,i.push(o)}),n.value=i;break;case"list":n=new kdb.SQLList,i=[],_.each(t.value,function(t){(o=new kdb.SQLVarChar).setValue(t),i.push(o)}),n.value=i;break;case"symbol[]":n=new kdb.SQLList,i=[],_.each(t.value,function(t){(o=new kdb.SQLVarChar).setValue(t),i.push(o)}),n.value=i;break;case"listtimestamp":n=new kdb.SQLList,i=[],_.each(t.value,function(t){(o=new kdb.SQLTime).setValue(t),i.push(o)}),n.value=i;break;case"dict":n=new kdb.SQLDict,_.each(t.value,function(t,e){t=s(t);n.values.push(t),n.fields.push(e)});break;case"nulltype":n=new kdb.SQLDict}return n.orderIndex=t.index,n.setName(t.name),n},n&&(_.each(n,function(t){t.type&&"t"!==t.type&&("symbol[]"===t.type&&(t.type="list"),e[a]=s(t),a+=1)}),e.sort(function(t,e){return t.orderIndex-e.orderIndex}))},y.parameterRx=new RegExp("<%([^<>%]+?)%>","g"),y.DEFAULT_NULL_VAL=-0x8000000000000000,y.PAGING_TYPES=["OFFSET","OFFSET_NOCACHE","PAGENO","PAGENO_NOCACHE"],f.DeltaClientLib=y,function(t){function e(){}e.clearAll=function(t){t?$("body .field-error").fadeOut():$("body .field-error").remove()},e.clear=function(t,e){t&&(e?t.fadeOut():t.remove())},e.show=function(t,e,n){if(t&&e)return(t=$("<div/>",{text:t}).addClass("field-error").appendTo("body")).position({of:$(e),my:n?"right center":"left center",at:n?"left center":"right center",collision:"flip fit",using:function(t,e){"right"===e.horizontal?$(this).addClass("error-left-side"):$(this).removeClass("error-left-side"),$(this).css({left:t.left+"px",top:t.top+"px"})}}),t},t.ErrorTooltip=e}(I=I||{}),i=I=I||{},X=m.View,l(dt,X),dt.prototype.remove=function(){return m.View.prototype.remove.call(this)},dt.prototype.renderTemplate=function(t){try{var e=!this.anchorEl||this.anchorEl.offsetWidth&&this.anchorEl.offsetHeight;this.el.style.display=e?"":"none",e&&(this.el.innerHTML="<div>"+this.templateFn(_.extend({},this.data,t))+"</div>",this.updatePosition(this.position))}catch(t){console.log(this.cssClass+" handlebars render error.",t)}},dt.prototype.updateCSS=function(t){return this.$el.css(_.reduce(t,function(t,e,n){return t[n]=e,t},{})),this},dt.prototype.updatePosition=function(t){var n,i=this;return this.anchorEl&&(n=this.anchorEl.getBoundingClientRect()),this.updateCSS(_.mapValues(_.pickBy(t,function(t){return!_.isNil(t)}),function(t,e){t=Math.max(0,t);return t+=n?n[e]:0,("left"===e||"right"===e)&&$(window).width()<t+i.$el.outerWidth()?t=$(window).width()-i.$el.outerWidth():("top"===e||"bottom"===e)&&$(window).height()<t+i.$el.outerHeight()&&(t=$(window).height()-i.$el.outerHeight()),t+"px"}))},dt.prototype.updateTooltip=function(t){var n=this;return _.each(t,function(t,e){n[e]=t}),this},dt.prototype.compileTemplate=function(){try{this.templateFn=s.compile(this.text)}catch(t){console.log(this.cssClass+" handlebars compile error.",t)}},dt.directions=["left","right","top","bottom"],i.GenericTooltip=dt,function(r){function t(){}t.convertRollingToDate=function(t,e){var n,i,o=r.Tools.convertValueToMoment(null,e);if(t=t||"NOW","duration"===r.Tools.getTypeCategory(e)&&(o=r.Tools.convertValueToDuration(o.formatNano("HH:mm:ss.SSS"),e)),"T"===t)_.includes(["date","datetime","timestamp"],e)&&o.set({hour:0,minute:0,second:0,millisecond:0});else if(t.toString().match(r.RTTI.REGEX_ROLLING)){if((i=t.toString().match(/^T([\+|\-]\d+)/))&&(n=parseInt(i[1],10)))switch(e){case"date":case"datetime":case"timestamp":o.set({hour:0,minute:0,second:0,millisecond:0}),o.add(n,"days");break;case"time":case"minute":o.add(n,"minutes");break;case"second":o.add(n,"seconds")}(i=t.toString().match(/(?:@)(.+)$/))&&(e=r.Tools.convertUserInputToMoment(i[1],"HH:mm:ss.SSS")).isValid()&&!p.isDuration(o)&&(o.set({hour:e.hour(),minute:e.minute(),second:e.second(),millisecond:e.millisecond()}),e.nanosecond()&&o.nanosecond(e.nanosecond()))}return o.toDashString()},t.convertViewSchemaToBackbone=function(e){var n=this,i={};return _.each(_.keys(e),function(t){_.isObject(e[t])?i[t]=n.convertViewSchemaToBackbone(e[t]):i[t]=e[t]}),m.Model.extend({defaults:function(){var e={};return _.each(_.keys(i),function(t){"function"==typeof i[t]?e[t]=new i[t]:e[t]=i[t]}),e}})},t.getGUID=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},t.preventBackspaceBack=function(){$(document).on("keydown",function(t){var e,n=!1;(n=8===t.which?!("INPUT"===(e=t.srcElement||t.target).tagName.toUpperCase()&&!_.includes(["RADIO","CHECKBOX"],e.type.toUpperCase())||"TEXTAREA"===e.tagName.toUpperCase()||$(e).hasClass("nicEdit-main"))||(e.readOnly||e.disabled):n)&&t.preventDefault()})},t.validateGuid=function(t){return!!_.isString(t)&&t.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i)},r.Helpers=t}(I=I||{}),(Z=I=I||{}).InitializeQuickbase=function(i){var o=$.cookie("dashboard-language")||"en";require.config({paths:{cldr:"./locale/cldr","cldr-data":"./locale/cldr-data",globalize:"./locale/globalize",locales:"./locale/locales"}}),require(["json!locales/messages.json"],function(t){function e(t){return n[t]||t||""}var n=t[o||"en"]||{};window.t=e,s.registerHelper("moment",function(t,e,n){if(null!=t||!e){if(null==t&&null==e)return p.locale("en"),p().format("MMMM DD, YYYY");var i={lang:"en",date:new Date},i=_.extend({},i,t,e,n);if(i=_.extend({},i,i.hash),p.locale(i.lang),"string"==typeof t&&"string"==typeof e)return p(t).format(e);if(Z.Tools.isKDBTemporal(t))return n=Z.Tools.convertKDBTemporalToMoment(t),p.isDuration(n)?n.formatNano(e):n.format(e);if(i.hash){i.context&&_.extend(i.hash,i.context);var o,r=p(t);for(o in i.hash){if(r[o])return r[o](i.hash[o]);console.log('moment.js does not support "'+o+'"')}}return"object"==typeof t?p(t).format(e):"string"!=typeof t||e?p(t).format(e):p().format(t)}}),s.registerHelper("t",e),s.registerHelper("typeOf",function(t){var e=Object.prototype.toString,n=function(t){return t.constructor?t.constructor.name:null};if(void 0===t)return"undefined";if(null===t)return"null";var i=typeof t;if("boolean"===i)return"boolean";if("string"===i)return"string";if("number"===i)return"number";if("symbol"===i)return"symbol";if("function"===i)return"GeneratorFunction"===n(t)?"generatorfunction":"function";if(Z.Tools.isKDBTemporal(t))return Z.Tools.Types.kdbToDashboard[t.class];if(_.isArray(t))return"array";if(_.isBuffer(t))return"buffer";if(_.isArguments(t))return"arguments";if(_.isDate(t))return"date";if(_.isError(t))return"error";if(_.isRegExp(t))return"regexp";switch(n(t)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if("function"==typeof(n=t).throw&&"function"==typeof n.return&&"function"==typeof n.next)return"generator";switch(i=e.call(t)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return i.slice(8,-1).toLowerCase().replace(/\s/g,"")}),s.registerHelper("isNull",function(t,e){return!0!==e&&_.isString(t)?0===t.length:_.isNull(t)}),s.registerHelper("encodeURI",function(t){return null==t?"":encodeURI(t)}),s.registerHelper("encodeURIComponent",function(t){return null==t?"":encodeURIComponent(t)}),s.registerHelper("toISOString",function(t){return Z.Tools.convertKDBToViewstateValue(t)}),_.isFunction(i)&&i({globalize:void 0,language:o})})};var e=I=I||{},n=(ht.prototype.toDate=function(){return e.Tools.convertKDBTemporalToMoment(this)},ht.prototype.toString=function(){return this.toDate().formatNano("YYYY-MM-DD HH:mm:ss.SSSSSSSSS")},ht);function ht(t,e){this.i=t,this.n=e}e.rTimestampClass=n,gt.prototype.toDate=function(){return e.Tools.convertKDBTemporalToMoment(this)},gt.prototype.toString=function(){return"number"!=typeof this.i||isNaN(this.i)?"":this.i===Number.POSITIVE_INFINITY?"Infinity":this.i===Number.NEGATIVE_INFINITY?"-Infinity":this.toDate().format("YYYY-MM")};var i=gt;function gt(t){this.i=t}e.rMonthClass=i,ft.prototype.toDate=function(){return e.Tools.convertKDBTemporalToMoment(this)},ft.prototype.toString=function(){return"number"!=typeof this.i||isNaN(this.i)?"":this.i===Number.POSITIVE_INFINITY?"Infinity":this.i===Number.NEGATIVE_INFINITY?"-Infinity":p(new Date(this.i)).utcOffset(0).format("YYYY-MM-DD")};var o=ft;function ft(t,e){this.i=t,this.n=e}e.rDateClass=o,yt.prototype.toDate=function(){return e.Tools.convertKDBTemporalToMoment(this)},yt.prototype.toString=function(){return this.toDate().format("YYYY-MM-DD HH:mm:ss.SSS")};var mt=yt;function yt(t){this.i=t}e.rDateTimeClass=mt,bt.prototype.toDate=function(){return e.Tools.convertKDBTemporalToMoment(this)},bt.prototype.toString=function(){return this.toDate().formatNano("HH:mm:ss.SSSSSSSSS",{trim:!1})};var vt=bt;function bt(t){this.i=t}e.rTimespanClass=vt,St.prototype.toDate=function(){return e.Tools.convertKDBTemporalToMoment(this)},St.prototype.toString=function(){return this.toDate().format("HH:mm",{trim:!1})};var wt=St;function St(t){this.i=t,this.n=0}e.rMinuteClass=wt,Ct.prototype.toDate=function(){return e.Tools.convertKDBTemporalToMoment(this)},Ct.prototype.toString=function(){return this.toDate().format("HH:mm:ss",{trim:!1})};var _t=Ct;function Ct(t){this.i=t}e.rSecondClass=_t,Dt.prototype.toDate=function(){return e.Tools.convertKDBTemporalToMoment(this)},Dt.prototype.toString=function(){return this.toDate().format("HH:mm:ss.SSS",{trim:!1})};var Tt=Dt;function Dt(t){this.i=t}e.rTimeClass=Tt,n.prototype.class="1212",i.prototype.class="1213",o.prototype.class="1214",mt.prototype.class="1215",vt.prototype.class="1216",wt.prototype.class="1217",_t.prototype.class="1218",Tt.prototype.class="1219";n=I=I||{},d.isLong=function(t){return!0===(t&&t.__isLong__)},d.fromInt=function(t,e){var n,i,o;return e?(o=0<=(t>>>=0)&&t<256)&&(i=d.UINT_CACHE[t])?i:(n=d.fromBits(t,(0|t)<0?-1:0,!0),o&&(d.UINT_CACHE[t]=n),n):(o=-128<=(t|=0)&&t<128)&&(i=d.INT_CACHE[t])?i:(n=d.fromBits(t,t<0?-1:0,!1),o&&(d.INT_CACHE[t]=n),n)},d.fromNumber=function(t,e){if(isNaN(t))return e?d.UZERO:d.ZERO;if(e){if(t<0)return d.UZERO;if(d.TWO_PWR_64_DBL<=t)return d.MAX_UNSIGNED_VALUE}else{if(t<=-d.TWO_PWR_63_DBL)return d.MIN_VALUE;if(d.TWO_PWR_63_DBL<=t+1)return d.MAX_VALUE}return t<0?d.fromNumber(-t,e).neg():d.fromBits(t%d.TWO_PWR_32_DBL|0,t/d.TWO_PWR_32_DBL|0,e)},d.fromBits=function(t,e,n){return new d(t,e,n)},d.fromString=function(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return d.ZERO;if(e="number"==typeof e?(n=e,!1):!!e,(n=n||10)<2||36<n)throw RangeError("radix");var i;if(0<(i=t.indexOf("-")))throw Error("interior hyphen");if(0===i)return d.fromString(t.substring(1),e,n).neg();for(var o=d.fromNumber(Math.pow(n,8)),r=d.ZERO,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),l=parseInt(t.substring(s,s+a),n);r=a<8?(a=d.fromNumber(Math.pow(n,a)),r.mul(a).add(d.fromNumber(l))):(r=r.mul(o)).add(d.fromNumber(l))}return r.unsigned=e,r},d.fromValue=function(t,e){return"number"==typeof t?d.fromNumber(t,e):"string"==typeof t?d.fromString(t,e):d.fromBits(t.low,t.high,"boolean"==typeof e?e:t.unsigned)},d.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},d.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*d.TWO_PWR_32_DBL+(this.low>>>0):this.high*d.TWO_PWR_32_DBL+(this.low>>>0)},d.prototype.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";var e,n;if(this.isNegative())return this.eq(d.MIN_VALUE)?(n=d.fromNumber(t),n=(e=this.div(n)).mul(n).sub(this),e.toString(t)+n.toInt().toString(t)):"-"+this.neg().toString(t);for(var i=d.fromNumber(Math.pow(t,6),this.unsigned),o=this,r="";;){var s=o.div(i),a=(o.sub(s.mul(i)).toInt()>>>0).toString(t);if((o=s).isZero())return a+r;for(;a.length<6;)a="0"+a;r=""+a+r}},d.prototype.getHighBits=function(){return this.high},d.prototype.getHighBitsUnsigned=function(){return this.high>>>0},d.prototype.getLowBits=function(){return this.low},d.prototype.getLowBitsUnsigned=function(){return this.low>>>0},d.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(d.MIN_VALUE)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;0<e&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},d.prototype.isZero=function(){return 0===this.high&&0===this.low},d.prototype.isNegative=function(){return!this.unsigned&&this.high<0},d.prototype.isPositive=function(){return this.unsigned||0<=this.high},d.prototype.isOdd=function(){return 1==(1&this.low)},d.prototype.isEven=function(){return 0==(1&this.low)},d.prototype.equals=function(t){return d.isLong(t)||(t=d.fromValue(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},d.prototype.notEquals=function(t){return!this.eq(t)},d.prototype.lessThan=function(t){return this.comp(t)<0},d.prototype.lessThanOrEqual=function(t){return this.comp(t)<=0},d.prototype.greaterThan=function(t){return 0<this.comp(t)},d.prototype.greaterThanOrEqual=function(t){return 0<=this.comp(t)},d.prototype.compare=function(t){if(d.isLong(t)||(t=d.fromValue(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},d.prototype.negate=function(){return!this.unsigned&&this.eq(d.MIN_VALUE)?d.MIN_VALUE:this.not().add(d.ONE)},d.prototype.add=function(t){d.isLong(t)||(t=d.fromValue(t));var e=this.high>>>16,n=65535&this.high,i=this.low>>>16,o=65535&this.low,r=t.high>>>16,s=65535&t.high,a=t.low>>>16,l=0,u=0,c=0,p=0;return u+=(c=c+((p+=o+(65535&t.low))>>>16)+(i+a))>>>16,d.fromBits((c&=65535)<<16|(p&=65535),((l+=(u+=n+s)>>>16)+(e+r)&65535)<<16|(u&=65535),this.unsigned)},d.prototype.subtract=function(t){return d.isLong(t)||(t=d.fromValue(t)),this.add(t.neg())},d.prototype.multiply=function(t){if(this.isZero())return d.ZERO;if(d.isLong(t)||(t=d.fromValue(t)),d.wasm)return e=d.wasm.mul(this.low,this.high,t.low,t.high),d.fromBits(e,d.wasm.get_high(),this.unsigned);if(t.isZero())return d.ZERO;if(this.eq(d.MIN_VALUE))return t.isOdd()?d.MIN_VALUE:d.ZERO;if(t.eq(d.MIN_VALUE))return this.isOdd()?d.MIN_VALUE:d.ZERO;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(d.TWO_PWR_24)&&t.lt(d.TWO_PWR_24))return d.fromNumber(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,n=65535&this.high,i=this.low>>>16,o=65535&this.low,r=t.high>>>16,s=65535&t.high,a=t.low>>>16,t=65535&t.low,l=0,u=0,c=0,p=(p=0)+((u=u+((c+=o*t)>>>16)+i*t)>>>16)+((u=(u&65535)+o*a)>>>16);return d.fromBits((u&=65535)<<16|(c&=65535),((l+=(p+=n*t)>>>16)+((p=(p&65535)+i*a)>>>16)+((p=(p&65535)+o*s)>>>16)+(e*t+n*a+i*s+o*r)&65535)<<16|(p&=65535),this.unsigned)},d.prototype.divide=function(t){if((t=d.isLong(t)?t:d.fromValue(t)).isZero())throw Error("division by zero");if(d.wasm){if(!this.unsigned&&-2147483648===this.high&&-1===t.low&&-1===t.high)return this;var e=(this.unsigned?d.wasm.div_u:d.wasm.div_s)(this.low,this.high,t.low,t.high);return d.fromBits(e,d.wasm.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?d.UZERO:d.ZERO;var n,i,o;if(this.unsigned){if((t=t.unsigned?t:t.toUnsigned()).gt(this))return d.UZERO;if(t.gt(this.shru(1)))return d.UONE;i=d.UZERO}else{if(this.eq(d.MIN_VALUE))return t.eq(d.ONE)||t.eq(d.NEG_ONE)?d.MIN_VALUE:t.eq(d.MIN_VALUE)?d.ONE:(o=this.shr(1).div(t).shl(1)).eq(d.ZERO)?t.isNegative()?d.ONE:d.NEG_ONE:(n=this.sub(t.mul(o)),o.add(n.div(t)));if(t.eq(d.MIN_VALUE))return this.unsigned?d.UZERO:d.ZERO;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();i=d.ZERO}for(n=this;n.gte(t);){o=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var r=Math.ceil(Math.log(o)/Math.LN2),s=r<=48?1:Math.pow(2,r-48),a=d.fromNumber(o),l=a.mul(t);l.isNegative()||l.gt(n);)l=(a=d.fromNumber(o-=s,this.unsigned)).mul(t);a.isZero()&&(a=d.ONE),i=i.add(a),n=n.sub(l)}return i},d.prototype.modulo=function(t){var e;return d.isLong(t)||(t=d.fromValue(t)),d.wasm?(e=(this.unsigned?d.wasm.rem_u:d.wasm.rem_s)(this.low,this.high,t.low,t.high),d.fromBits(e,d.wasm.get_high(),this.unsigned)):this.sub(this.div(t).mul(t))},d.prototype.not=function(){return d.fromBits(~this.low,~this.high,this.unsigned)},d.prototype.and=function(t){return d.isLong(t)||(t=d.fromValue(t)),d.fromBits(this.low&t.low,this.high&t.high,this.unsigned)},d.prototype.or=function(t){return d.isLong(t)||(t=d.fromValue(t)),d.fromBits(this.low|t.low,this.high|t.high,this.unsigned)},d.prototype.xor=function(t){return d.isLong(t)||(t=d.fromValue(t)),d.fromBits(this.low^t.low,this.high^t.high,this.unsigned)},d.prototype.shiftLeft=function(t){return d.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?d.fromBits(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):d.fromBits(0,this.low<<t-32,this.unsigned)},d.prototype.shiftRight=function(t){return d.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?d.fromBits(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):d.fromBits(this.high>>t-32,0<=this.high?0:-1,this.unsigned)},d.prototype.shiftRightUnsigned=function(t){return d.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?d.fromBits(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):d.fromBits(32===t?this.high:this.high>>>t-32,0,this.unsigned)},d.prototype.rotateLeft=function(t){var e;return d.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:32===t?d.fromBits(this.high,this.low,this.unsigned):t<32?d.fromBits(this.low<<t|this.high>>>(e=32-t),this.high<<t|this.low>>>e,this.unsigned):d.fromBits(this.high<<(t-=32)|this.low>>>(e=32-t),this.low<<t|this.high>>>e,this.unsigned)},d.prototype.rotateRight=function(t){var e;return d.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:32===t?d.fromBits(this.high,this.low,this.unsigned):t<32?d.fromBits(this.high<<(e=32-t)|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned):d.fromBits(this.low<<(e=32-(t-=32))|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)},d.prototype.toSigned=function(){return this.unsigned?d.fromBits(this.low,this.high,!1):this},d.prototype.toUnsigned=function(){return this.unsigned?this:d.fromBits(this.low,this.high,!0)},d.prototype.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},d.prototype.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},d.prototype.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},d.fromBytes=function(t,e,n){return n?d.fromBytesLE(t,e):d.fromBytesBE(t,e)},d.fromBytesLE=function(t,e){return new d(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},d.fromBytesBE=function(t,e){return new d(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)},d.wasm=null,d.INT_CACHE={},d.UINT_CACHE={},d.TWO_PWR_16_DBL=65536,d.TWO_PWR_24_DBL=1<<24,d.TWO_PWR_63_DBL=(d.TWO_PWR_64_DBL=(d.TWO_PWR_32_DBL=d.TWO_PWR_16_DBL*d.TWO_PWR_16_DBL)*d.TWO_PWR_32_DBL)/2,d.TWO_PWR_24=d.fromInt(d.TWO_PWR_24_DBL),d.ZERO=d.fromInt(0),d.UZERO=d.fromInt(0,!0),d.ONE=d.fromInt(1),d.UONE=d.fromInt(1,!0),d.NEG_ONE=d.fromInt(-1),d.MAX_VALUE=d.fromBits(-1,2147483647,!1),d.MAX_UNSIGNED_VALUE=d.fromBits(-1,-1,!0),d.MIN_VALUE=d.fromBits(0,-2147483648,!1),i=d;function d(t,e,n){this.eqz=this.isZero.bind(this),this.eq=this.equals.bind(this),this.neq=this.notEquals.bind(this),this.ne=this.notEquals.bind(this),this.lt=this.lessThan.bind(this),this.lte=this.lessThanOrEqual.bind(this),this.le=this.lessThanOrEqual.bind(this),this.gt=this.greaterThan.bind(this),this.gte=this.greaterThanOrEqual.bind(this),this.ge=this.greaterThanOrEqual.bind(this),this.comp=this.compare.bind(this),this.neg=this.negate.bind(this),this.sub=this.subtract.bind(this),this.mul=this.multiply.bind(this),this.div=this.divide.bind(this),this.mod=this.modulo.bind(this),this.rem=this.modulo.bind(this),this.shl=this.shiftLeft.bind(this),this.shr=this.shiftRight.bind(this),this.shru=this.shiftRightUnsigned.bind(this),this.shr_u=this.shiftRightUnsigned.bind(this),this.rotl=this.rotateLeft.bind(this),this.rotr=this.rotateRight.bind(this),this.low=0|t,this.high=0|e,this.unsigned=!!n}n.Long=i,Object.defineProperty(i.prototype,"__isLong__",{value:!0});try{i.wasm=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function Mt(t,e,n,i){this.length=t,this.offset=e,this.qtype=n,this.dataView=i}function Et(t,e,n,i){return nt.call(this,t,e,n,i,8)||this}function Pt(t,e,n,i){this.length=t,this.keys=e,this.values=n,this.qtype=i||it.TypeNum.Dict}J=I=I||{},(tt=J.ipc||(J.ipc={})).fromString=function(t,e){return _.isString(e)&&t.fromString?t.fromString(e):e},(o=tt.TypeNum||(tt.TypeNum={}))[o.List=0]="List",o[o.Bool=1]="Bool",o[o.Guid=2]="Guid",o[o.Byte=4]="Byte",o[o.Short=5]="Short",o[o.Int=6]="Int",o[o.Long=7]="Long",o[o.Float=8]="Float",o[o.Double=9]="Double",o[o.Char=10]="Char",o[o.Symbol=11]="Symbol",o[o.Timestamp=12]="Timestamp",o[o.Month=13]="Month",o[o.Date=14]="Date",o[o.DateTime=15]="DateTime",o[o.Timespan=16]="Timespan",o[o.Minute=17]="Minute",o[o.Second=18]="Second",o[o.Time=19]="Time",o[o.Table=98]="Table",o[o.Dict=99]="Dict",o[o.Unary=101]="Unary",Mt.prototype.isAligned=function(){return!0},Mt.prototype.isTemporal=function(){return this.qtype<=12&&this.qtype<=19},Mt.prototype.toLegacy=function(t){return this.getValue(t)},Mt.prototype.toViewState=function(t){return{_type:tt.Parse.TYPE_NAMES[Math.abs(this.qtype)],value:J.Tools.convertKDBToViewstateValue(this.toLegacy(t))}},o=Mt,tt.TypeBase=o,function(i){var t,r;function e(t,e,n,i,o){e=r.call(this,t,e,n,i)||this;return e.indexOffset=0,e.index=null,e.rangeCache=null,e.SIZE=o,e.bufferLength=t,e}t=i.ipc||(i.ipc={}),r=t.TypeBase,l(e,r),e.prototype.getRange=function(){return this.index&&0!==this.index.length?[this.hash(this.index[0]),this.hash(this.index[this.index.length-1])]:this.rangeCache||(this.rangeCache=this.calcRange())},e.prototype.mergeIndexed=function(t){if(t.length>=this.length)throw"Invalid Merge Size";this.resetRangeCache(),new Uint8Array(this.dataView.buffer,this.offset,t.length*this.SIZE).set(new Uint8Array(t.dataView.buffer,t.offset,t.length*this.SIZE))},e.prototype.checkIndex=function(){for(var t=1;t<this.index.length;t++)if(this.hash(this.index[t-1])>this.hash(this.index[t]))return!0;return!1},e.prototype.hasIndex=function(){return!!this.index},e.prototype.getIndexFromSortedIndex=function(t){return(this.length+this.index[t]-this.indexOffset)%this.length},e.prototype.getScalarFromSortedIndex=function(t){return t=(this.indexOffset+t)%this.length,8===this.SIZE&&i.Tools.isIE11&&-1!==[9,15].indexOf(this.qtype)?this.getLegacyScalar(this.index[t]):this.getScalar(this.index[t])},e.prototype.findIndex=function(t){var n=this,e=8!==this.SIZE||-1!==[9,15].indexOf(this.qtype)?function(t,e){return t-n.hash(e)}:i.Tools.isIE11?function(t,e){return t.compare(n.hash(e))}:function(t,e){return Number(t-n.hash(e))};return i.Tools.binarySearch2(t,this.index,e)},e.prototype.mergeKeyedPrimary=function(t,e,n){this.resetRangeCache(),this.hasIndex()||this.generateIndex();for(var i=0;i<t.length;i++){var o,r,s=this.findIndex(t.hash(i));s<0?(o=void 0,this.length===e?(o=this.indexOffset%e,r=this.findIndex(this.hash(o)),this.index.splice(r,1),r<-s-1&&s++,this.index.splice(-s-1,0,o),this.indexOffset=(this.indexOffset+1)%e):((o=this.length)>=this.bufferLength&&this.reallocate(e),this.index.splice(-s-1,0,o),this.length++),new Uint8Array(this.dataView.buffer,this.offset+o*this.SIZE,this.SIZE).set(new Uint8Array(t.dataView.buffer,t.offset+i*this.SIZE,this.SIZE)),n.push(o)):(r=this.index[s],n.push(r))}return this.indexOffset},e.prototype.mergeKeyed=function(t,e,n,i){this.resetRangeCache();for(var o=0;o<e.length;o++){var r=e[o];r===this.length&&(r>=this.bufferLength&&this.reallocate(i),this.length++),new Uint8Array(this.dataView.buffer,this.offset+r*this.SIZE,this.SIZE).set(new Uint8Array(t.dataView.buffer,t.offset+o*this.SIZE,this.SIZE))}this.indexOffset=n},e.prototype.reallocate=function(t){this.bufferLength=t||this.bufferLength;t=new ArrayBuffer(this.bufferLength*this.SIZE);new Uint8Array(t,0,this.length*this.SIZE).set(new Uint8Array(this.dataView.buffer,this.offset,this.length*this.SIZE)),this.dataView=new DataView(t),this.offset=0},e.prototype.toTypedArray=function(){var t;if(this.align(),1===this.SIZE?t=Uint8Array:2===this.SIZE?t=Int16Array:4===this.SIZE?t=8===this.qtype?Float32Array:Int32Array:8===this.SIZE&&(t=-1!==[9,15].indexOf(this.qtype)?Float64Array:BigInt64Array),0===this.indexOffset)return new t(this.dataView.buffer,this.offset,this.length);var e=new t(this.length);return e.set(new t(this.dataView.buffer,this.indexOffset*this.SIZE,this.length-this.indexOffset)),e.set(new t(this.dataView.buffer,0,this.indexOffset),this.length-this.indexOffset),e},e.prototype.align=function(){this.offset%this.SIZE!=0&&this.reallocate()},e.prototype.getByteLocation=function(t){return this.offset+(t+this.indexOffset)%this.length*this.SIZE},e.prototype.getHashLocation=function(t){return this.offset+t*this.SIZE},e.prototype.generateIndex=function(){var n=this;this.index=new Array(this.length);for(var t=0;t<this.length;t++)this.index[t]=t;8!==this.SIZE||-1!==[9,15].indexOf(this.qtype)?this.index.sort(function(t,e){return n.hash(t)-n.hash(e)}):i.Tools.isIE11?this.index.sort(function(t,e){return n.hash(t).compare(n.hash(e))}):this.index.sort(function(t,e){return Number(n.hash(t)-n.hash(e))})},e.prototype.resetRangeCache=function(){this.rangeCache=null},t.Vector=e}(I=I||{}),function(t){var o;function r(t,e,n,i){return o.call(this,t,e,n,i,1)||this}t=t.ipc||(t.ipc={}),o=t.Vector,l(r,o),r.prototype.calcRange=function(){for(var t=r.MIN,e=r.MAX,n=0;n<this.length;n+=1){var i=this.getScalar(n);t<i&&(t=i),i<e&&(e=i)}return[e,t]},r.prototype.getScalar=function(t){return this.dataView.getUint8(this.getByteLocation(t))},r.prototype.hash=function(t){return this.dataView.getUint8(this.getHashLocation(t))},r.MIN=0,r.MAX=255,t.U8=r}(I=I||{}),function(t){var i,o;function r(t,e,n){return o.call(this,t,e,i.TypeNum.Bool,n)||this}i=t.ipc||(t.ipc={}),o=i.U8,l(r,o),r.listToIPC=function(t){var e=t.length+6,n=i.Util.createBuffer(e);return n.wb(r.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return n.wb(t?1:0)}),n.data},r.toIPC=function(t){var e=i.Util.createBuffer(2);return e.wb(256-r.TYPE_NUM),e.wb(t?1:0),e.data},r.prototype.getValue=function(t){return 1===this.getScalar(t)},r.TYPE_NUM=1,i.Boolean=r}(I=I||{}),function(t){var i,o;function r(t,e,n){return o.call(this,t,e,i.TypeNum.Byte,n)||this}i=t.ipc||(t.ipc={}),o=i.U8,l(r,o),r.listToIPC=function(t){var e=t.length+6,n=i.Util.createBuffer(e);return n.wb(r.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return n.wb(t)}),n.data},r.toIPC=function(t){var e=i.Util.createBuffer(2);return e.wb(256-r.TYPE_NUM),e.wb(t||0),e.data},r.prototype.getValue=function(t){return this.getScalar(t)},r.TYPE_NUM=4,i.Byte=r}(I=I||{}),et=I=I||{},mt=et.ipc||(et.ipc={}),nt=mt.Vector,l(Et,nt),Et.prototype.calcRange=function(){if("undefined"!=typeof BigInt){for(var t=this.getScalar(0),e=t,n=BigInt("-9223372036854775808"),i=1;i<this.length;i++){var o=this.getScalar(i);(t===n||t<o&&o!==n)&&(t=o),(e===n||o<e&&o!==n)&&(e=o)}return[e,t]}for(var r=this.getLegacyScalar(0),s=r,a=Et.LONG_NULL,i=1;i<this.length;i++){o=this.getLegacyScalar(i);(r.eq(a)||o.gt(r)&&!o.eq(a))&&(r=o),(s.eq(a)||o.lt(s)&&!o.eq(a))&&(s=o)}return[s,r]},Et.prototype.getLegacyScalar=function(t){t=new Uint8Array(this.dataView.buffer,this.getByteLocation(t),this.SIZE);return et.Long.fromBytesLE(t)},Et.prototype.getScalar=function(t){return this.dataView.getBigInt64(this.getByteLocation(t),!0)},Et.prototype.hash=function(t){return this.dataView.getBigInt64(this.getHashLocation(t),!0)},Et.LONG_NULL=new et.Long(0,2147483648),Et.LONG_INFINITY_NEGATIVE=new et.Long(1,2147483648),Et.LONG_INFINITY_POSITIVE=et.Long.MAX_VALUE,vt=Et,mt.I64=vt,et.Tools.isIE11&&(vt.prototype.hash=function(t){t=new Uint8Array(this.dataView.buffer,this.getHashLocation(t),this.SIZE);return et.Long.fromBytesLE(t)},vt.prototype.toTypedArray=function(){if(this.align(),0===this.indexOffset)return new Uint8Array(this.dataView.buffer,this.offset,this.length*this.SIZE);var t=new Uint8Array(this.length*this.SIZE);return t.set(new Uint8Array(this.dataView.buffer,this.indexOffset*this.SIZE,(this.length-this.indexOffset)*this.SIZE)),t.set(new Uint8Array(this.dataView.buffer,0,this.indexOffset*this.SIZE),(this.length-this.indexOffset)*this.SIZE),t}),function(i){var o,r;function s(t,e,n){return r.call(this,t,e,o.TypeNum.Char,n)||this}o=i.ipc||(i.ipc={}),r=o.U8,l(s,r),s.listToIPC=function(t){var t=t.map(function(t){return i.u8u16(t&&t.length?t[0]:" ")}),e=[].concat.apply([],t),t=t.length+6,n=o.Util.createBuffer(t);return n.wb(s.TYPE_NUM),n.wb(0),n.wi(e.length),_.each(e,function(t){return n.wb(t)}),n.data},s.toIPC=function(t){var t=i.u8u16(t&&t.length?t[0]:" "),e=o.Util.createBuffer(1+t.length);return e.wb(256-s.TYPE_NUM),t.forEach(function(t){return e.wb(t)}),e.data},s.u16u8=function(t){for(var e,n,i,o="",r=0;r<t.length;r++)switch((e=t[r])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(e);break;case 12:case 13:n=t[++r],o+=String.fromCharCode((31&e)<<6|63&n);break;case 14:n=t[++r],i=t[++r],o+=String.fromCharCode((15&e)<<12|(63&n)<<6|(63&i)<<0)}return o},s.prototype.getValue=function(t){t=this.getScalar(t);return 0===t?"":i.u16u8([t])},s.TYPE_NUM=10,o.Char=s}(I=I||{}),function(t){var o;function r(t,e,n,i){return o.call(this,t,e,n,i,4)||this}t=t.ipc||(t.ipc={}),o=t.Vector,l(r,o),r.prototype.calcRange=function(){for(var t=Number.NEGATIVE_INFINITY,e=Number.POSITIVE_INFINITY,n=0;n<this.length;n+=1){var i=this.getScalar(n);(t===r.NULL||t<i&&i!==r.NULL)&&(t=i),(e===r.NULL||i<e&&i!==r.NULL)&&(e=i)}return[e,t]},r.prototype.getScalar=function(t){return this.dataView.getInt32(this.getByteLocation(t),!0)},r.prototype.hash=function(t){return this.dataView.getInt32(this.getHashLocation(t))},r.NULL=-2147483648,r.INFINITY_NEGATIVE=-2147483647,r.INFINITY_POSITIVE=2147483647,t.I32=r}(I=I||{}),function(t){var e;function n(){}e=t.ipc||(t.ipc={}),n.QEPOCH=10957*(n.MSDAY=864e5),n.LONG_NULL=new t.Long(0,2147483648),n.LONG_INFINITY_NEGATIVE=new t.Long(1,2147483648),n.LONG_INFINITY_POSITIVE=t.Long.MAX_VALUE,n.JS_DATE_MIN=-864e13,n.TIME_PARTS_RX=/(-?\d{1,7}:\d\d:\d\d.\d\d\d)(\d\d\d\d\d\d)/,n.BQEPOCH=new rt.BigInteger((1e6*n.QEPOCH).toString()),e.Constants=n}(I=I||{}),function(e){var i,o;function r(t,e,n){return o.call(this,t,e,i.TypeNum.Date,n)||this}i=e.ipc||(e.ipc={}),o=i.I32,l(r,o),r.fromMoment=function(t){return null===t?null:new e.rDateClass(t.valueOf())},r.fromScalar=function(t){return null===t?null:new e.rDateClass(i.Constants.QEPOCH+t*i.Constants.MSDAY)},r.fromString=function(t){if(!t)return null;t=t.replace(/\./g,"-");t=p.utc(t);return r.fromMoment(t)},r.listToIPC=function(t){var e=4*t.length+6,n=i.Util.createBuffer(e);return n.wb(i.TypeNum.Date),n.wb(0),n.wi(t.length),_.each(t,function(t){return r.writeValue(t,n.wb)}),n.data},r.toIPC=function(t){var e=i.Util.createBuffer(5);return e.wb(256-i.TypeNum.Date),r.writeValue(t,e.wb),e.data},r.writeValue=function(t,e){i.Int.writeValue(null===t?null:r.toScalar(t),e)},r.toMoment=function(t){return null===t?null:p.tz(t.toString(),"UTC")},r.toScalar=function(t){return null===t?null:(t.i-i.Constants.QEPOCH)/i.Constants.MSDAY},r.toString=function(t,e){return void 0===e&&(e="YYYY-MM-DD"),null===t?null:r.toMoment(t).format(e)},r.prototype.getValue=function(t){t=o.prototype.getScalar.call(this,t);return t===i.I32.NULL?null:t===i.I32.INFINITY_NEGATIVE?-1/0:t===i.I32.INFINITY_POSITIVE?1/0:new e.rDateClass(i.Constants.QEPOCH+t*i.Constants.MSDAY)},i.QDate=r}(I=I||{}),function(t){var o;function e(t,e,n,i){return o.call(this,t,e,n,i,8)||this}t=t.ipc||(t.ipc={}),o=t.Vector,l(e,o),e.prototype.calcRange=function(){for(var t=Number.NEGATIVE_INFINITY,e=Number.POSITIVE_INFINITY,n=0;n<this.length;n+=1){var i=this.getScalar(n);(isNaN(t)||t<i&&!isNaN(i))&&(t=i),(isNaN(e)||i<e&&!isNaN(i))&&(e=i)}return[e,t]},e.prototype.getScalar=function(t){return this.dataView.getFloat64(this.getByteLocation(t),!0)},e.prototype.hash=function(t){return this.dataView.getFloat64(this.getHashLocation(t),!0)},e.prototype.toSplitTypedArray=function(){return this.align(),new Float32Array(this.dataView.buffer,this.offset,2*this.length)},t.F64=e}(I=I||{}),function(e){var i,o;function r(t,e,n){return o.call(this,t,e,i.TypeNum.DateTime,n)||this}i=e.ipc||(e.ipc={}),o=i.F64,l(r,o),r.fromMoment=function(t){return null===t?null:new e.rDateTimeClass(t.valueOf())},r.fromScalar=function(t){return isNaN(t)||null===t?null:new e.rDateTimeClass(i.Constants.QEPOCH+t*i.Constants.MSDAY)},r.fromString=function(t){if(null===t)return null;var e=t.match(/(.*)(D|T)(.*?)Z?$/);if(!e)return null;t=e[1].replace(/\./g,"-")+"T"+e[3]+"Z";e=p(t);return r.fromMoment(e)},r.listToIPC=function(t){var e=8*t.length+6,n=i.Util.createBuffer(e);return n.wb(i.TypeNum.DateTime),n.wb(0),n.wi(t.length),_.each(t,function(t){return r.writeValue(t,n.wb)}),n.data},r.toIPC=function(t){var e=i.Util.createBuffer(9);return e.wb(256-i.TypeNum.DateTime),r.writeValue(t,e.wb),e.data},r.toMoment=function(t){if(null===t)return null;t=p.tz(t.i,"UTC");return e.Tools.timezone&&t.isValid()&&t.tz(e.Tools.timezone),t},r.toScalar=function(t){return null===t?null:(t.i-i.Constants.QEPOCH)/i.Constants.MSDAY},r.toString=function(t,e){if(null===t)return"";t=r.toMoment(t);return void 0!==e?t.format(e):t.toISOString()},r.writeValue=function(t,e){i.Double.writeValue(r.toScalar(t),e)},r.prototype.getValue=function(t){return r.fromScalar(this.getScalar(t))},i.DateTime=r}(I=I||{}),wt=I=I||{},it=wt.ipc||(wt.ipc={}),Pt.toIPC=function(t,e){var n=_.sumBy(t,function(t){return t.length+1})+7+e.length,i=it.Util.createBuffer(n);return i.wb(99),i.wb(11),i.wb(0),i.wi(t.length),_.each(t,function(t){return it.Symbol.writeValue(t,i.wb)}),_.each(e,function(t){return i.wb(t)}),i.data},Pt.prototype.getKey=function(t){return this.keys.getValue(t)},Pt.prototype.getValue=function(t){return this.values.getValue(t)},Pt.prototype.toObject=function(){for(var t={},e=0;e<this.length;e++)t[this.getKey(e)]=this.getValue(e);return t},Pt.prototype.toLegacy=function(){var e=this,n=new it.Table;return 99===this.qtype?(n.addParsedColumn("Property",this.keys),n.addParsedColumn("Value",this.values)):_.times(this.keys.length,function(t){n.addParsedColumn(e.keys.toLegacy(t),e.values.getValue(t))}),n.toLegacy()},Pt.prototype.toViewState=function(){for(var t={},e=0;e<this.length;e++)t[this.getKey(e)]=this.values.toViewState(e);return{_type:"dict",value:t}},wt=Pt,(it.Dict=wt).prototype.qtype=99,function(t){var i,o;function r(t,e,n){return o.call(this,t,e,i.TypeNum.Double,n)||this}i=t.ipc||(t.ipc={}),o=i.F64,l(r,o),r.listToIPC=function(t){var e=8*t.length+6,n=i.Util.createBuffer(e);return n.wb(r.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return r.writeValue(t,n.wb)}),n.data},r.toIPC=function(t){var e=i.Util.createBuffer(9);return e.wb(256-r.TYPE_NUM),r.writeValue(t,e.wb),e.data},r.writeValue=function(t,e){var n;null!==t?((n=new Float64Array(1))[0]=t,_.each(new Uint8Array(n.buffer),function(t){return e(t)})):_.each([0,0,0,0,0,0,248,255],function(t){return e(t)})},r.prototype.getValue=function(t){t=this.getScalar(t);return isNaN(t)?null:t},r.TYPE_NUM=9,i.Double=r}(I=I||{}),function(t){var i,o;function r(t,e,n){return o.call(this,t,e,i.TypeNum.Float,n,4)||this}i=t.ipc||(t.ipc={}),o=i.Vector,l(r,o),r.listToIPC=function(t){var e=4*t.length+6,n=i.Util.createBuffer(e);return n.wb(r.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return r.writeValue(t,n.wb)}),n.data},r.toIPC=function(t){var e=i.Util.createBuffer(5);return e.wb(256-r.TYPE_NUM),r.writeValue(t,e.wb),e.data},r.writeValue=function(t,e){var n;null!==t?((n=new Float32Array(1))[0]=t,_.each(new Uint8Array(n.buffer),function(t){return e(t)})):_.each([0,0,192,255],function(t){return e(t)})},r.prototype.calcRange=function(){for(var t=Number.NEGATIVE_INFINITY,e=Number.POSITIVE_INFINITY,n=0;n<this.length;n+=1){var i=this.getScalar(n);(isNaN(t)||t<i&&!isNaN(i))&&(t=i),(isNaN(e)||i<e&&!isNaN(i))&&(e=i)}return[e,t]},r.prototype.getScalar=function(t){return this.dataView.getFloat32(this.getByteLocation(t),!0)},r.prototype.getValue=function(t){t=this.getScalar(t);return isNaN(t)?null:t},r.prototype.hash=function(t){return this.dataView.getFloat32(this.getHashLocation(t),!0)},r.TYPE_NUM=8,i.Float=r}(I=I||{}),function(t){var i,o;function r(t,e,n){return o.call(this,t,e,i.TypeNum.Int,n)||this}i=t.ipc||(t.ipc={}),o=i.I32,l(r,o),r.listToIPC=function(t){var e=4*t.length+6,n=i.Util.createBuffer(e);return n.wb(r.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return r.writeValue(t,n.wb)}),n.data},r.toIPC=function(t){var e=i.Util.createBuffer(5);return e.wb(256-r.TYPE_NUM),r.writeValue(t,e.wb),e.data},r.writeValue=function(t,e){var n;null!==t?((n=new Int32Array(1))[0]=t,_.each(new Uint8Array(n.buffer),function(t){return e(t)})):_.each([0,0,0,128],function(t){return e(t)})},r.prototype.getValue=function(t){t=this.getScalar(t);return-2147483648===t?null:-2147483647===t?-1/0:2147483647===t?1/0:t},r.TYPE_NUM=6,i.Int=r}(I=I||{});u.hash=function(t){t=u.md51_array(t);return u.hex(t)},u.rhex=function(t){for(var e="",n=0;n<4;n+=1)e+=u.hex_chr[t>>8*n+4&15]+u.hex_chr[t>>8*n&15];return e},u.hex=function(t){for(var e=0;e<t.length;e+=1)t[e]=u.rhex(t[e]);return t.join("")},u.md5cycle=function(t,e){var n=t[0],i=t[1],o=t[2],r=t[3],i=((i+=((o=((o+=((r=((r+=((n=((n+=(i&o|~i&r)+e[0]-680876936|0)<<7|n>>>25)+i|0)&i|~n&o)+e[1]-389564586|0)<<12|r>>>20)+n|0)&n|~r&i)+e[2]+606105819|0)<<17|o>>>15)+r|0)&r|~o&n)+e[3]-1044525330|0)<<22|i>>>10)+o|0;i=((i+=((o=((o+=((r=((r+=((n=((n+=(i&o|~i&r)+e[4]-176418897|0)<<7|n>>>25)+i|0)&i|~n&o)+e[5]+1200080426|0)<<12|r>>>20)+n|0)&n|~r&i)+e[6]-1473231341|0)<<17|o>>>15)+r|0)&r|~o&n)+e[7]-45705983|0)<<22|i>>>10)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i&o|~i&r)+e[8]+1770035416|0)<<7|n>>>25)+i|0)&i|~n&o)+e[9]-1958414417|0)<<12|r>>>20)+n|0)&n|~r&i)+e[10]-42063|0)<<17|o>>>15)+r|0)&r|~o&n)+e[11]-1990404162|0)<<22|i>>>10)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i&o|~i&r)+e[12]+1804603682|0)<<7|n>>>25)+i|0)&i|~n&o)+e[13]-40341101|0)<<12|r>>>20)+n|0)&n|~r&i)+e[14]-1502002290|0)<<17|o>>>15)+r|0)&r|~o&n)+e[15]+1236535329|0)<<22|i>>>10)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i&r|o&~r)+e[1]-165796510|0)<<5|n>>>27)+i|0)&o|i&~o)+e[6]-1069501632|0)<<9|r>>>23)+n|0)&i|n&~i)+e[11]+643717713|0)<<14|o>>>18)+r|0)&n|r&~n)+e[0]-373897302|0)<<20|i>>>12)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i&r|o&~r)+e[5]-701558691|0)<<5|n>>>27)+i|0)&o|i&~o)+e[10]+38016083|0)<<9|r>>>23)+n|0)&i|n&~i)+e[15]-660478335|0)<<14|o>>>18)+r|0)&n|r&~n)+e[4]-405537848|0)<<20|i>>>12)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i&r|o&~r)+e[9]+568446438|0)<<5|n>>>27)+i|0)&o|i&~o)+e[14]-1019803690|0)<<9|r>>>23)+n|0)&i|n&~i)+e[3]-187363961|0)<<14|o>>>18)+r|0)&n|r&~n)+e[8]+1163531501|0)<<20|i>>>12)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i&r|o&~r)+e[13]-1444681467|0)<<5|n>>>27)+i|0)&o|i&~o)+e[2]-51403784|0)<<9|r>>>23)+n|0)&i|n&~i)+e[7]+1735328473|0)<<14|o>>>18)+r|0)&n|r&~n)+e[12]-1926607734|0)<<20|i>>>12)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i^o^r)+e[5]-378558|0)<<4|n>>>28)+i|0)^i^o)+e[8]-2022574463|0)<<11|r>>>21)+n|0)^n^i)+e[11]+1839030562|0)<<16|o>>>16)+r|0)^r^n)+e[14]-35309556|0)<<23|i>>>9)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i^o^r)+e[1]-1530992060|0)<<4|n>>>28)+i|0)^i^o)+e[4]+1272893353|0)<<11|r>>>21)+n|0)^n^i)+e[7]-155497632|0)<<16|o>>>16)+r|0)^r^n)+e[10]-1094730640|0)<<23|i>>>9)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i^o^r)+e[13]+681279174|0)<<4|n>>>28)+i|0)^i^o)+e[0]-358537222|0)<<11|r>>>21)+n|0)^n^i)+e[3]-722521979|0)<<16|o>>>16)+r|0)^r^n)+e[6]+76029189|0)<<23|i>>>9)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i^o^r)+e[9]-640364487|0)<<4|n>>>28)+i|0)^i^o)+e[12]-421815835|0)<<11|r>>>21)+n|0)^n^i)+e[15]+530742520|0)<<16|o>>>16)+r|0)^r^n)+e[2]-995338651|0)<<23|i>>>9)+o|0,i=((i+=((r=((r+=(i^((n=((n+=(o^(i|~r))+e[0]-198630844|0)<<6|n>>>26)+i|0)|~o))+e[7]+1126891415|0)<<10|r>>>22)+n|0)^((o=((o+=(n^(r|~i))+e[14]-1416354905|0)<<15|o>>>17)+r|0)|~n))+e[5]-57434055|0)<<21|i>>>11)+o|0,i=((i+=((r=((r+=(i^((n=((n+=(o^(i|~r))+e[12]+1700485571|0)<<6|n>>>26)+i|0)|~o))+e[3]-1894986606|0)<<10|r>>>22)+n|0)^((o=((o+=(n^(r|~i))+e[10]-1051523|0)<<15|o>>>17)+r|0)|~n))+e[1]-2054922799|0)<<21|i>>>11)+o|0,i=((i+=((r=((r+=(i^((n=((n+=(o^(i|~r))+e[8]+1873313359|0)<<6|n>>>26)+i|0)|~o))+e[15]-30611744|0)<<10|r>>>22)+n|0)^((o=((o+=(n^(r|~i))+e[6]-1560198380|0)<<15|o>>>17)+r|0)|~n))+e[13]+1309151649|0)<<21|i>>>11)+o|0,i=((i+=((r=((r+=(i^((n=((n+=(o^(i|~r))+e[4]-145523070|0)<<6|n>>>26)+i|0)|~o))+e[11]-1120210379|0)<<10|r>>>22)+n|0)^((o=((o+=(n^(r|~i))+e[2]+718787259|0)<<15|o>>>17)+r|0)|~n))+e[9]-343485551|0)<<21|i>>>11)+o|0,t[0]=n+t[0]|0,t[1]=i+t[1]|0,t[2]=o+t[2]|0,t[3]=r+t[3]|0},u.md5blk_array=function(t){for(var e=[],n=0;n<64;n+=4)e[n>>2]=t[n]+(t[n+1]<<8)+(t[n+2]<<16)+(t[n+3]<<24);return e},u.md51_array=function(t){for(var e,n,i,o,r=t.length,s=[1732584193,-271733879,-1732584194,271733878],a=64;a<=r;a+=64)u.md5cycle(s,u.md5blk_array(t.subarray(a-64,a)));for(e=(t=a-64<r?t.subarray(a-64):new Uint8Array(0)).length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=0;a<e;a+=1)n[a>>2]|=t[a]<<(a%4<<3);if(n[a>>2]|=128<<(a%4<<3),55<a)for(u.md5cycle(s,n),a=0;a<16;a+=1)n[a]=0;return o=(o=8*r).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(o[2],16),o=parseInt(o[1],16)||0,n[14]=i,n[15]=o,u.md5cycle(s,n),s},u.hex_chr=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];var It=u;function u(){}!function(r){var s,i;function a(t,e,n){n=i.call(this,t.length,void 0,0,n)||this;return n.indexOffset=0,n.end=e,n.values=t,n}s=r.ipc||(r.ipc={}),i=s.TypeBase,l(a,i),a.toIPC=function(t){var e=_.sumBy(t,function(t){return t.length})+6,n=s.Util.createBuffer(e);return n.wb(0),n.wb(0),n.wi(t.length),_.each(t,function(t){_.each(t,function(t){return n.wb(t)})}),n.data},a.prototype.getFirstOffset=function(t){var e,t=this.values[t];return 0===(t=98!==t.qtype&&99!==t.qtype?t:(98===(e=t).keys.qtype||99===e.keys.qtype?e.keys:e).keys).qtype?new a((e=t).values,e.end,this.dataView).getFirstOffset(0):11===t.qtype?t.offsets[0]:(0<=t.qtype&&t.qtype,t.offset)},a.prototype.getEndOffset=function(t){t=this.values[t];if(0===(t=98!==t.qtype&&99!==t.qtype?t:(98===(e=t).values.qtype||99===e.values.qtype?e.values:e).values).qtype)return t.end;if(11===t.qtype){for(var e=t,n=e.offsets[e.offsets.length-1];0!==this.dataView.getUint8(n++););return n}if(-11===t.qtype){for(n=t.offset;0!==this.dataView.getUint8(n++););return n}if(0<=t.qtype&&t.qtype<=19)return(e=t).offset+r.getTypeSize(e.qtype)*e.length;e=t;return e.offset+r.getTypeSize(Math.abs(e.qtype))},a.prototype.getValue=function(t){t=this.values[t];return 98===t.qtype||99===t.qtype?s.Parse.table(t,this.dataView):s.Parse.col(t,this.dataView)},a.prototype.isolate=function(t){var e=this.getFirstOffset(t),n=this.getEndOffset(t)-e,i=new ArrayBuffer(n),o=new Uint8Array(i,0,n);return o.set(new Uint8Array(this.dataView.buffer,e,n)),this.offsetItem(t,-e),98===this.values[t].qtype||99===this.values[t].qtype?(this.values[t]=s.Parse.table(this.values[t],new DataView(i)),It.hash(o)):(this.values[t]=n=s.Parse.col(this.values[t],new DataView(i)),10===n.qtype?this.toLegacy(t):1===n.length&&-20<n.qtype&&n.qtype<20&&0!==n.qtype&&11!==n.qtype&&-11!==n.qtype?(e=n.hash(0),r.Long.isLong(e)?e.toString():e):It.hash(o))},a.prototype.offsetItem=function(t,e){var n,i=this.values[t];98!==i.qtype&&99!==i.qtype||(i=(98===(n=i).keys.qtype||99===n.keys.qtype?n.keys:n).keys,n=(98===n.values.qtype||99===n.values.qtype?n.values:n).values,this.offsetQTyped(t,e,n)),this.offsetQTyped(t,e,i)},a.prototype.offsetQTyped=function(t,e,n){if(0===n.qtype)for(var i=new a(n.values,n.end,this.dataView),o=0;o<i.length;o++)i.offsetItem(o,e);else if(11===n.qtype)for(var r=n,s=0;s<r.offsets.length;s++)r.offsets[s]+=e;else n.offset+=e},a.prototype.mergeIndexed=function(t){if(t.length>=this.length)throw"Invalid Merge Size";if(0!==t.length){var e=t.getFirstOffset(0),n=t.end-e,i=this.getFirstOffset(t.values.length),o=this.end-i,r=new ArrayBuffer(n+o);new Uint8Array(r,0,n).set(new Uint8Array(t.dataView.buffer,e,n)),new Uint8Array(r,n,o).set(new Uint8Array(this.dataView.buffer,i,o));for(var s=0;s<t.length;s++)this.values[s]=t.values[s],this.offsetItem(s,-e);for(var a=n-i,s=t.length;s<this.length;s++)this.offsetItem(s,a);this.end+=a,this.dataView=new DataView(r)}},a.prototype.mergeKeyedPrimary=function(t,e,n){var i=this;if(void 0===this.keyIndex){for(var o={},r=0;r<this.length;r++)o[this.isolate(r)]=r;this.keyIndex=o,delete this.dataView,this.getValue=function(t){return i.values[(t+i.indexOffset)%i.length]}}for(r=0;r<t.length;r++){var s,a=t.isolate(r),l=t.values[r],u=this.keyIndex[a];void 0===u?this.length===e?(s=this.indexOffset%e,this.keyIndex[a]=s,this.values[s]=l,n.push(s),this.indexOffset++):(this.keyIndex[a]=this.length,n.push(this.length),this.values.push(l),this.length++):n.push(u)}return this.indexOffset},a.prototype.mergeKeyed=function(t,e,n,i){var o=this;if(void 0===this.values){for(var r=[],s=0;s<this.length;s++){var a=this.getValue(s);r.push(a)}this.values=r,delete this.dataView,this.getValue=function(t){return o.values[(t+o.indexOffset)%o.length]}}for(s=0;s<e.length;s++){var l=t.getValue(s),u=e[s];u===this.length?(this.values.push(l),this.length++):u>this.length||(this.values[u]=l)}this.indexOffset=n},a.prototype.toLegacy=function(t){var e,n=this.values[t],i=this.dataView;if(10!==n.qtype)return-20<n.qtype&&n.qtype<0?s.Parse.col(n,i).toLegacy(0):0<=n.qtype&&n.qtype<20?(e=s.Parse.col(n,i),_.times(e.length).map(function(t){return e.toLegacy(t)})):98===n.qtype||99===n.qtype?s.Parse.table(n,i).toLegacy():101===n.qtype?null:void 0;var o=n,r=[];for(t=0;t<o.length;t++)r.push(i.getUint8(o.offset+t));return s.Char.u16u8(r)},a.prototype.toViewState=function(t){var e=this.values[t];return 99===e.qtype||98===e.qtype?s.Parse.table(e,this.dataView).toViewState():{_type:10===e.qtype?"string":s.Parse.TYPE_NAMES[Math.abs(e.qtype)],value:r.Tools.convertKDBToViewstateValue(this.toLegacy(t))}},s.List=a}(I=I||{}),function(n){var i,o;function r(t,e,n){return o.call(this,t,e,i.TypeNum.Long,n)||this}i=n.ipc||(n.ipc={}),o=i.I64,l(r,o),r.listToIPC=function(t){var e=8*t.length+6,n=i.Util.createBuffer(e);return n.wb(r.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return r.writeValue(t,n.wb)}),n.data},r.toIPC=function(t){var e=i.Util.createBuffer(9);return e.wb(256-r.TYPE_NUM),r.writeValue(t,e.wb),e.data},r.writeValue=function(t,e){null!==t?(t=n.Long.fromString(""+t),_.each(t.toBytesLE(),function(t){return e(t)})):_.each([0,0,0,0,0,0,0,128],function(t){return e(t)})},r.prototype.getValue=function(t){t=this.getLegacyScalar(t);return t.equals(i.I64.LONG_INFINITY_NEGATIVE)?-1/0:t.equals(i.I64.LONG_INFINITY_POSITIVE)?1/0:t.equals(i.I64.LONG_NULL)?null:t.toString()},r.TYPE_NUM=7,i.QLong=r}(I=I||{}),function(e){var i,o;function r(t,e,n){return o.call(this,t,e,i.TypeNum.Minute,n)||this}i=e.ipc||(e.ipc={}),o=i.I32,l(r,o),r.fromMoment=function(t){return r.fromScalar(t.asMinutes())},r.fromScalar=function(t){return null===t?null:new e.rMinuteClass(t)},r.fromString=function(t){var e=(t=t.replace("1970-01-01T","").replace("Z","")).match(i.Constants.TIME_PARTS_RX),e=p.duration(e&&e[1]?e[1]:t);return r.fromMoment(e)},r.listToIPC=function(t){var e=4*t.length+6,n=i.Util.createBuffer(e);return n.wb(i.TypeNum.Minute),n.wb(0),n.wi(t.length),_.each(t,function(t){return r.writeValue(t,n.wb)}),n.data},r.toMoment=function(t){return null===t?null:p.duration(60*t.i*1e3)},r.toScalar=function(t){return null===t?null:t.i},r.toString=function(t,e,n){return void 0===e&&(e="HH:mm:ss.SSS"),void 0===n&&(n={trim:!1}),null===t?"":r.toMoment(t).format(e,n)},r.toIPC=function(t){var e=i.Util.createBuffer(5);return e.wb(256-i.TypeNum.Minute),r.writeValue(t,e.wb),e.data},r.writeValue=function(t,e){i.Int.writeValue(r.toScalar(t),e)},r.prototype.getValue=function(t){t=o.prototype.getScalar.call(this,t);return t===i.I32.NULL?null:new e.rMinuteClass(t)},i.Minute=r}(I=I||{}),function(e){var i,o;function r(t,e,n){return o.call(this,t,e,i.TypeNum.Month,n)||this}i=e.ipc||(e.ipc={}),o=i.I32,l(r,o),r.fromMoment=function(t){return null===t?null:new e.rMonthClass(Math.round(t.diff(p([2e3]),"months",!0)))},r.fromScalar=function(t){return null===t?null:new e.rMonthClass(t)},r.fromString=function(t){if(null===t)return null;t=t.replace(/\./g,"-").replace(/m$/,"");t=p.utc(t);return r.fromMoment(t)},r.listToIPC=function(t){var e=4*t.length+6,n=i.Util.createBuffer(e);return n.wb(r.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return r.writeValue(t,n.wb)}),n.data},r.toIPC=function(t){var e=i.Util.createBuffer(5);return e.wb(256-r.TYPE_NUM),r.writeValue(t,e.wb),e.data},r.toMoment=function(t){if(null===t)return null;var e=p.tz("2000-01-01","UTC");return e.add(t.i,"month"),e},r.toScalar=function(t){return null===t?null:t.i},r.toString=function(t,e){return void 0===e&&(e="YYYY-MM"),null===t?"":r.toMoment(t).format(e)},r.writeValue=function(t,e){i.Int.writeValue(r.toScalar(t),e)},r.prototype.getValue=function(t){t=o.prototype.getScalar.call(this,t);return t===i.I32.NULL?null:new e.rMonthClass(t)},r.TYPE_NUM=13,i.Month=r}(I=I||{}),function(e){var i,o;function r(t,e,n){return o.call(this,t,e,i.TypeNum.Second,n)||this}i=e.ipc||(e.ipc={}),o=i.I32,l(r,o),r.fromMoment=function(t){return null===t?null:new e.rSecondClass(t.asSeconds())},r.fromScalar=function(t){return null===t?null:new e.rSecondClass(t)},r.fromString=function(t){var e=(t=t.replace("1970-01-01T","").replace("Z","")).match(i.Constants.TIME_PARTS_RX),e=p.duration(e&&e[1]?e[1]:t);return r.fromMoment(e)},r.listToIPC=function(t){var e=4*t.length+6,n=i.Util.createBuffer(e);return n.wb(i.TypeNum.Second),n.wb(0),n.wi(t.length),_.each(t,function(t){return r.writeValue(t,n.wb)}),n.data},r.toIPC=function(t){var e=i.Util.createBuffer(5);return e.wb(256-i.TypeNum.Second),r.writeValue(t,e.wb),e.data},r.toMoment=function(t){return null===t?null:p.duration(1e3*t.i)},r.toScalar=function(t){return null===t?null:t.i},r.toString=function(t,e,n){return void 0===e&&(e="HH:mm:ss.SSS"),void 0===n&&(n={trim:!1}),null===t?"":r.toMoment(t).format(e,n)},r.writeValue=function(t,e){i.Int.writeValue(r.toScalar(t),e)},r.prototype.getValue=function(t){t=o.prototype.getScalar.call(this,t);return t===i.I32.NULL?null:new e.rSecondClass(t)},i.Second=r}(I=I||{}),function(t){var i,o;function r(t,e,n){return o.call(this,t,e,i.TypeNum.Short,n,2)||this}i=t.ipc||(t.ipc={}),o=i.Vector,l(r,o),r.listToIPC=function(t){var e=2*t.length+6,n=i.Util.createBuffer(e);return n.wb(r.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return r.writeValue(t,n.wb)}),n.data},r.toIPC=function(t){var e=i.Util.createBuffer(3);return e.wb(256-r.TYPE_NUM),r.writeValue(t,e.wb),e.data},r.writeValue=function(t,e){var n;null!==t?((n=new Int16Array(1))[0]=t,_.each(new Uint8Array(n.buffer),function(t){return e(t)})):_.each([0,128],function(t){return e(t)})},r.prototype.getValue=function(t){t=this.getScalar(t);return-32768===t?null:-32767===t?-1/0:32767===t?1/0:t},r.prototype.calcRange=function(){for(var t=Number.NEGATIVE_INFINITY,e=Number.POSITIVE_INFINITY,n=0;n<this.length;n+=1){var i=this.getScalar(n);(t===r.SHORT_NULL||t<i&&i!==r.SHORT_NULL)&&(t=i),(e===r.SHORT_NULL||i<e&&i!==r.SHORT_NULL)&&(e=i)}return[e,t]},r.prototype.getScalar=function(t){return this.dataView.getInt16(this.getByteLocation(t),!0)},r.prototype.hash=function(t){return this.dataView.getInt16(this.getHashLocation(t))},r.TYPE_NUM=5,r.SHORT_NULL=-32768,i.Short=r}(I=I||{}),function(o){var i,r;function s(t,e,n){t=r.call(this,t,t?e[0]:void 0,i.TypeNum.Symbol,n)||this;return t.indexOffset=0,t.offsets=e,t}i=o.ipc||(o.ipc={}),r=i.TypeBase,l(s,r),s.listToIPC=function(t){var e=_.sumBy(t,function(t){return t.length+1})+6,n=i.Util.createBuffer(e);return n.wb(11),n.wb(0),n.wi(t.length),_.each(t,function(t){return s.writeValue(t,n.wb)}),n.data},s.toIPC=function(t){var e=t?t.length+2:2,e=i.Util.createBuffer(e);return e.wb(245),null===t&&void 0===t||s.writeValue(t,e.wb),e.data},s.writeValue=function(t,e){null!=t&&_.each(""+t,function(t){return e(t.charCodeAt(0))}),e(0)},s.prototype.getValue=function(t){if(this.values)return this.values[(t+this.indexOffset)%this.length];for(var e,n=this.offsets[(t+this.indexOffset)%this.length],i=[];0!==(e=this.dataView.getUint8(n++));)i.push(e);return o.u16u8(i)},s.prototype.hash=function(t){return this.getValue(t)},s.prototype.mergeIndexed=function(t){if(t.length>=this.length)throw"Invalid Merge Size";if(null!==t.offset){for(var e=_.last(t.offsets);0!==t.dataView.getUint8(e++););for(var n=e-t.offset,i=this.offsets[t.length],o=_.last(this.offsets);0!==this.dataView.getUint8(o++););var r=o-i,s=new ArrayBuffer(n+r);new Uint8Array(s,0,n).set(new Uint8Array(t.dataView.buffer,t.offset,n)),new Uint8Array(s,n,r).set(new Uint8Array(this.dataView.buffer,i,r));for(var a=0;a<t.length;a++)this.offsets[a]=t.offsets[a]-t.offset;for(var l=n-i,a=t.length;a<this.length;a++)this.offsets[a]=this.offsets[a]+l;this.offset=0,this.dataView=new DataView(s)}},s.prototype.mergeKeyedPrimary=function(t,e,n){if(void 0===this.keyIndex){for(var i={},o=[],r=0;r<this.length;r++){var s=this.getValue(r);i[s]=r,o.push(s)}this.keyIndex=i,this.values=o,delete this.offsets,delete this.dataView}for(r=0;r<t.length;r++){var a,l=t.getValue(r),u=this.keyIndex[l];void 0===u?this.length===e?(a=this.indexOffset%e,this.keyIndex[l]=a,this.values[a]=l,n.push(a),this.indexOffset++):(this.keyIndex[l]=this.length,n.push(this.length),this.values.push(l),this.length++):n.push(u)}return this.indexOffset},s.prototype.mergeKeyed=function(t,e,n,i){if(void 0===this.values){for(var o=[],r=0;r<this.length;r++){var s=this.getValue(r);o.push(s)}this.values=o,delete this.offsets,delete this.dataView}for(r=0;r<e.length;r++){var a=t.getValue(r),l=e[r];l===this.length?(this.values.push(a),this.length++):l>this.length||(this.values[l]=a)}this.indexOffset=n},i.Symbol=s}(I=I||{}),function(i){function o(){}o.u8u16=function(t){for(var e=[],n=0;n<t.length;n++){var i=t.charCodeAt(n);i<128?e.push(i):i<2048?e.push(192|i>>6,128|63&i):i<55296||57344<=i?e.push(224|i>>12,128|i>>6&63,128|63&i):(i=65536+((1023&i)<<10|1023&t.charCodeAt(++n)),e.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i))}return e},o.listToIPC=function(t){return i.List.toIPC(t.map(function(t){return o.toIPC(t)}))},o.toIPC=function(t){var t=t?o.u8u16(t):[],e=t.length+6,n=i.Util.createBuffer(e);return n.wb(o.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return n.wb(t)}),n.data},o.TYPE_NUM=10,i.QString=o}((_t=I=I||{}).ipc||(_t.ipc={})),function(e){var i,o;function r(t,e,n){return o.call(this,t,e,i.TypeNum.Time,n)||this}i=e.ipc||(e.ipc={}),o=i.I32,l(r,o),r.fromMoment=function(t){return null===t?null:new e.rTimeClass(t.asMilliseconds())},r.fromScalar=function(t){return null===t?null:new e.rTimeClass(t)},r.fromString=function(t){var e=(t=t.replace("1970-01-01T","").replace("Z","")).match(i.Constants.TIME_PARTS_RX),e=p.duration(e&&e[1]?e[1]:t);return r.fromMoment(e)},r.listToIPC=function(t){var e=4*t.length+6,n=i.Util.createBuffer(e);return n.wb(i.TypeNum.Time),n.wb(0),n.wi(t.length),_.each(t,function(t){return r.writeValue(t,n.wb)}),n.data},r.toIPC=function(t){var e=i.Util.createBuffer(5);return e.wb(256-i.TypeNum.Time),r.writeValue(t,e.wb),e.data},r.toMoment=function(t){return null===t?null:p.duration(t.i)},r.toScalar=function(t){return null===t?null:t.i},r.toString=function(t,e,n){return void 0===e&&(e="HH:mm:ss.SSS"),void 0===n&&(n={trim:!1}),null===t?"":r.toMoment(t).format(e,n)},r.writeValue=function(t,e){i.Int.writeValue(r.toScalar(t),e)},r.prototype.getValue=function(t){t=o.prototype.getScalar.call(this,t);return t===i.I32.NULL?null:new e.rTimeClass(t)},i.Time=r}(I=I||{}),function(e){var i,o;function r(t,e,n){return o.call(this,t,e,i.TypeNum.Timespan,n)||this}i=e.ipc||(e.ipc={}),o=i.I64,l(r,o),r.fromScalar=function(t){return null===t?null:new e.rTimespanClass(t)},r.fromMoment=function(t){return null===t?null:new e.rTimespanClass(t.valueOfNano())},r.fromString=function(t){var e,n=(t=t.replace("1970-01-01T","").replace("Z","")).match(i.Constants.TIME_PARTS_RX);return n&&n[1]?(-1!==t.indexOf("D")&&(e=t.substring(0,t.indexOf(":")).split("D"),(e=Number(e[1])+24*Number(e[0]))&&(n[1]=e+n[1].substring(2))),e=p.duration(n[1]),(n=Number(n[2]||0))&&!_.isNaN(n)&&e.nanoseconds(n)):e=p.duration(t),r.fromMoment(e)},r.listToIPC=function(t){var e=8*t.length+6,n=i.Util.createBuffer(e);return n.wb(i.TypeNum.Timespan),n.wb(0),n.wi(t.length),_.each(t,function(t){return r.writeValue(t,n.wb)}),n.data},r.toIPC=function(t){var e=i.Util.createBuffer(9);return e.wb(256-i.TypeNum.Timespan),r.writeValue(t,e.wb),e.data},r.toMoment=function(t){if(null===t)return null;var e=p.duration((0<t.i?Math.floor:Math.ceil)(t.i/1e6));return e.nanoseconds(t.i%1e6),e},r.toScalar=function(t){return null===t?null:t.i},r.toString=function(t,e,n){if(null===t)return"";t=r.toMoment(t),n=t.format(e||"HH:mm:ss.SSS",n||{trim:!1});return e?n:n+_.padEnd(""+t.nanoseconds(),6,"0")},r.writeValue=function(t,e){i.QLong.writeValue(t?r.toScalar(t).toFixed(0):null,e)},r.prototype.getValue=function(t){t=this.getLegacyScalar(t),t="bigint"==typeof t||"number"==typeof t?e.Long.fromString(t.toString()):t;return t.equals(i.I64.LONG_NULL)?null:new e.rTimespanClass(Number(t.toString()))},i.Timespan=r}(I=I||{}),function(n){var i,o;function r(t,e,n){return o.call(this,t,e,i.TypeNum.Timestamp,n)||this}i=n.ipc||(n.ipc={}),o=i.I64,l(r,o),r.fromMoment=function(t){return null===t?null:new n.rTimestampClass(t.valueOf(),1e6*t.milliseconds()+t.nanoseconds())},r.fromScalar=function(t){t="bigint"==typeof t||"number"==typeof t?n.Long.fromString(t.toString()):t;if(t.equals(i.Constants.LONG_NULL))return null;t=new rt.BigInteger(t.toString()).add(i.Constants.BQEPOCH).toString();return new n.rTimestampClass(Number(t.substring(0,t.length-6)),Number(t.substring(t.length-9)))},r.fromString=function(t){if(null===t)return null;var e=t.match(/(.*)(D|T)(.*?)Z?$/);if(!e)return null;t=e[1].replace(/\./g,"-")+"T"+e[3]+"Z";e=p(t);return e.nanoseconds(n.Tools.extractNanos(t)),r.fromMoment(e)},r.listToIPC=function(t){var e=8*t.length+6,n=i.Util.createBuffer(e);return n.wb(i.TypeNum.Timestamp),n.wb(0),n.wi(t.length),_.each(t,function(t){return i.DateTime.writeValue(t,n.wb)}),n.data},r.toIPC=function(t){var e=i.Util.createBuffer(9);return e.wb(256-i.TypeNum.Timestamp),r.writeValue(t,e.wb),e.data},r.toMoment=function(t){if(null===t)return null;var e=p.tz(t.i,"UTC");return e.nanoseconds(t.n%1e6),n.Tools.timezone&&e.isValid()&&e.tz(n.Tools.timezone),e},r.toScalar=function(t){return null===t?null:BigInt(r.toScalarString(t))},r.toString=function(t,e){if(null===t)return"";var t=r.toMoment(t),n=t.format(e||"YYYY-MM-DDTHH:mm:ss.SSS");return e?n:n.substr(0,23)+_.padEnd(""+t.nanoseconds(),6,"0")+"Z"},r.writeValue=function(t,e){t=r.toScalarString(t);i.QLong.writeValue(t,e)},r.toScalarString=function(t){if(null===t)return null;_.isNumber(t)&&(t=this.fromMoment(p(t)));var e=_.padStart(t.n.toFixed(0),9,"0"),t=t.i.toFixed(0);return new rt.BigInteger(t+e.substring(3)).subtract(i.Constants.BQEPOCH).toString()},r.prototype.getValue=function(t){t=new Uint8Array(this.dataView.buffer,this.getByteLocation(t),this.SIZE),t=n.Long.fromBytesLE(t);if(t.equals(r.LONG_NULL))return null;t=new rt.BigInteger(t.toString()).add(i.Constants.BQEPOCH).toString();return new n.rTimestampClass(Number(t.substring(0,t.length-6)),Number(t.substring(t.length-9)))},i.Timestamp=r}(I=I||{}),function(t){function n(){}t=t.ipc||(t.ipc={}),n.getType=function(t){return n.typeDict[t]},n.mergeTypedArraysUnsafe=function(t,e){var n=new t.constructor(t.length+e.length);return n.set(t),n.set(e,t.length),n},n.fromHexString=function(t){return new Uint8Array(((t||"").match(/.{1,2}/g)||[]).map(function(t){return parseInt(t,16)}))},n.toHexString=function(t){for(var e="",n=0;n<t.length;n++){var i=t[n].toString(16);e+=1===i.length?"0"+i:i}return e},n.pack=function(t){for(var e=[],n=0,i=t.length;n<i;)e.push((255&t[n++])<<8|255&t[n++]);return String.fromCharCode.apply(null,e)},n.base64=function(t){return btoa(String.fromCharCode.apply(null,t))},n.toMessage=function(t){var e=n.createBuffer(8);return e.wi(1),e.wi(t.length+8),n.mergeTypedArraysUnsafe(e.data,t)},n.createBuffer=function(t){var e={data:new Uint8Array(t),i:0,wb:function(t){e.data[e.i++]=t},wi:function(t){_.times(4,function(){e.wb(255&t),t>>=8})}};return e},n.typeDict={10:t.QString,0:t.List,"-1":t.Boolean,"-2":t.Symbol,"-4":t.Byte,"-5":t.Short,"-6":t.Int,"-7":t.QLong,"-8":t.Float,"-9":t.Double,"-10":t.Char,"-11":t.Symbol,"-12":t.Timestamp,"-13":t.Month,"-14":t.QDate,"-15":t.DateTime,"-16":t.Timespan,"-17":t.Minute,"-18":t.Second,"-19":t.Time},t.Util=n}(I=I||{});function kt(t,e){if(("Accordion"===t||"Popup"===t)&&e&&e.widgets&&1<e.widgets.length&&!(e.widgets instanceof m.Collection))if("Popup"===t){t=_.findLast(e.widgets,function(t){return t.component});e.widgets.length=0,t&&e.widgets.push(t)}else for(var n,i={},o=e.widgets.length-1;0<=o;o--)i[n=e.widgets[o].sectionId]?e.widgets.splice(o,1):i[n]=!0}At=m.Model,l(b,At),b.objToPaths=function(t,e,n){var i,o,r=!1,s={},a=b.keyPathSeparator;for(o in t){var l=t[o];if(n=n?n+a+o:o,(!0===e||e&&"string"==typeof e&&e!==n&&0===e.indexOf(n))&&(r=!0),l&&l.constructor===Object)if(_.isEmpty(l))s[o]=l;else if(_.has(l,"_dashboardsType"))s[o]=l;else for(var u in i=this.objToPaths(l,e,n)){var c=i[u];s[o+a+u]=c}else if(l&&l.constructor===Array&&r)for(var u in i=this.objToPaths(l,e,n)){c=i[u];s[o+a+u]=c}else s[o]=l}return s},b.getNested=function(t,e,n){for(var i=e?e.split(b.keyPathSeparator):[],o=t,r=0,s=i.length;r<s;r++){if(n&&!_.has(o,i[r]))return!1;if(void 0===(o=null==(o=o[i[r]])&&r<s-1?{}:o))return!!n||o}return!!n||o},b.setNested=function(t,e,n,i){i=i||{};for(var o=e?e.split(b.keyPathSeparator):[],r=t,s=0,a=o.length;s<a&&void 0!==r;s++){var l,u=o[s];s===a-1?i.unset?delete r[u]:r[u]=n:(void 0!==r[u]&&_.isObject(r[u])||(l=o[s+1],r[u]=/^\d+$/.test(l)?[]:{}),r=r[u])}},b.deleteNested=function(t,e){this.setNested(t,e,null,{unset:!0})},b.prototype.toJSON=function(t){return _.merge({},this.attributes)},b.prototype.get=function(t){return b.getNested(this.attributes,t)},b.prototype.set=function(t,e,n){var i,o,r,s,a,l,u,c;if(null==t)return this;if("object"==typeof t?(o=t,n=e||{}):(o={})[t]=e,!this._validate(o,n=n||{}))return null;for(i in r=n.unset,a=n.silent,s=[],l=this._changing,this._changing=!0,l||(this._previousAttributes=_.merge({},this.attributes),this.changed={}),c=this.attributes,u=this._previousAttributes,this.idAttribute in o&&(this.id=o[this.idAttribute]),o=b.objToPaths(o))e=o[i],_.isEqual(b.getNested(c,i),e)||s.push(i),_.isEqual(b.getNested(u,i),e)?b.deleteNested(this.changed,i):b.setNested(this.changed,i,e),r?b.deleteNested(c,i):b.setNested(c,i,e);if(_.each(this.changed,_.bind(function(t,e){_.isEmpty(t)&&_.isObject(t)&&!_.isArray(t)&&delete this.changed[e]},this)),!a){s.length&&(this._pending=!0);for(var p=b.keyPathSeparator,d={},h=0,g=s.length;h<g;h++)for(var t=s[h],f=(d.hasOwnProperty(t)&&d[t]||(d[t]=!0,this.trigger("change:"+t,this,b.getNested(c,t),n)),t.split(p)),m=f.length-1;0<m;m--){var y=f.slice(0,m).join(p),v=y+p+"*";d.hasOwnProperty(v)&&d[v]||(d[v]=!0,this.trigger("change:"+v,this,b.getNested(c,y),n)),d.hasOwnProperty(y)&&d[y]||(d[y]=!0,this.trigger("change:"+y,this,b.getNested(c,y),n))}}if(l)return this;if(!a)for(;this._pending;)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},b.prototype.clear=function(t){var e,n={};for(e in b.objToPaths(this.attributes))n[e]=void 0;return this.set(n,_.extend({},t,{unset:!0}))},b.prototype.hasChanged=function(t){return null==t?!_.isEmpty(this.changed):void 0!==b.getNested(this.changed,t)},b.prototype.changedAttributes=function(t,e){if(!t)return!!this.hasChanged()&&b.objToPaths(this.changed,e);var n,i=this._changing?this._previousAttributes:this.attributes,o=b.objToPaths(t),r=b.objToPaths(i),s=!1;for(n in o)_.includes(["array","object"],typeof i[n])&&void 0===t[n]?(s=s||{})[n]=void 0:_.isEqual(r[n],o[n])||((s=s||{})[n]=o[n]);return s},b.prototype.previous=function(t){return null!=t&&this._previousAttributes?b.getNested(this._previousAttributes,t):null},b.prototype.previousAttributes=function(){return _.merge({},this._previousAttributes)},b.prototype.toFlat=function(t){return b.objToPaths(this.attributes,t)},b.keyPathSeparator=".";var At,Tt=b;function b(t,e){var n,i=At.call(this,t,e)||this,o=t||{};return i.cid=_.uniqueId("c"),i.attributes={},e&&e.collection&&(i.collection=e.collection),e&&e.parse&&(o=i.parse(o,e)||{}),(n=_.result(i,"defaults"))&&(o=_.merge(n,o)),i.set(o,e),i.changed={},i.initialize.apply(i,arguments),i}m.DeepModel=Tt;function xt(){return{appArgs:{json:{Style:{advanced:"",cssClasses:""},Alignment:{paddingLeft:null,paddingRight:null,paddingTop:null,paddingBottom:null,innerPaddingLeft:null,innerPaddingRight:null,innerPaddingTop:null,innerPaddingBottom:null,titlePaddingLeft:null,titlePaddingRight:null,titlePaddingTop:7,titlePaddingBottom:7},format:{widgetTitle:null,titleFontSize:16,titleHorizontal:"Center",titleColor:null,titleBottomBorderWidth:null,titleFontBold:null,titleShadow:!1,titleBackgroundColor:null,titleTransparentBackground:null,tileBorderWidth:null,tileBorderRounding:null,tileBorderColor:null,tileBackgroundColor:null,tileTransparentBackground:null,tileShadow:null}},schema:{properties:{Style:{type:"object",title:"Style",options:{collapsed:!0},properties:{advanced:{type:"css",title:"Advanced CSS",default:""},cssClasses:{type:"string",title:"CSS Classes",default:""}}},Alignment:{type:"object",title:"Margins",options:{collapsed:!0},properties:{paddingLeft:{type:"number",title:"Outer Left",default:null,format:"number",propertyOrder:2001},paddingRight:{type:"number",title:"Outer Right",default:null,format:"number",propertyOrder:2002},paddingTop:{type:"number",title:"Outer Top",default:null,format:"number",propertyOrder:2003},paddingBottom:{type:"number",title:"Outer Bottom",default:null,format:"number",propertyOrder:2004},innerPaddingLeft:{type:"number",title:"Inner Left",default:null,format:"number",propertyOrder:2005},innerPaddingRight:{type:"number",title:"Inner Right",default:null,format:"number",propertyOrder:2006},innerPaddingTop:{type:"number",title:"Inner Top",default:null,format:"number",propertyOrder:2007},innerPaddingBottom:{type:"number",title:"Inner Bottom",default:null,format:"number",propertyOrder:2008},titlePaddingLeft:{type:"number",title:"Title Left",default:null,format:"number",propertyOrder:2009},titlePaddingRight:{type:"number",title:"Title Right",default:null,format:"number",propertyOrder:2010},titlePaddingTop:{type:"number",title:"Title Top",default:null,format:"number",propertyOrder:2011},titlePaddingBottom:{type:"number",title:"Title Bottom",default:null,format:"number",propertyOrder:2012}}},format:{type:"object",title:"Format",options:{collapsed:!0},properties:{widgetTitle:{type:"string",title:"Title",propertyOrder:2001},titleFontSize:{type:"number",title:"Title Font Size",propertyOrder:2002},titleColor:{type:"gradient",title:"Title Font Color",options:{gradient:!1,noColor:!0},default:null,propertyOrder:2003},titleFontBold:{type:"boolean",title:"Title Bold",default:!1,format:"checkbox",propertyOrder:2004},titleShadow:{type:"boolean",title:"Title Shadow",default:!1,format:"checkbox",propertyOrder:2005},titleHorizontal:{type:"string",title:"Title Horizontal Align",enum:["Left","Center","Right"],propertyOrder:2006},titleBottomBorderWidth:{type:"number",title:"Title Bottom Border Size",default:null,format:"number",propertyOrder:2007},titleBackgroundColor:{type:"gradient",title:"Title Background Color",default:null,options:{gradient:!1,noColor:!0},propertyOrder:2008},titleTransparentBackground:{type:"boolean",title:"Title Transparent Background",default:!1,format:"checkbox",propertyOrder:2009},tileBackgroundColor:{type:"gradient",title:"Background Color",default:null,options:{gradient:!1,noColor:!0},propertyOrder:2010},tileTransparentBackground:{type:"boolean",title:"Transparent Background",default:!1,format:"checkbox",propertyOrder:2011},tileBorderWidth:{type:"number",title:"Border Size",default:null,format:"number",propertyOrder:2012},tileBorderRounding:{type:"number",title:"Border Rounding",default:null,format:"number",propertyOrder:2013},tileBorderColor:{type:"gradient",title:"Border Color",default:null,options:{gradient:!1,noColor:!0},propertyOrder:2014},tileShadow:{type:"boolean",title:"Component Shadow",default:!1,format:"checkbox",propertyOrder:2015}}}}}}}}var Nt,Lt,n=I=I||{};(i=Vt=n.CommandOp||(n.CommandOp={}))[i.Add=0]="Add",i[i.Remove=1]="Remove",i[i.Set=2]="Set";var Vt,Ot=function(t,e,n){this.op=t,this.key=e,this.payload=n},Bt=(n.Todo=Ot,Rt.pathArrayToText=function(t){return t.reverse().join(".")},Rt.prototype.pathText=function(){return Rt.pathArrayToText(this.path)},Rt);function Rt(t,e,n,i){this.title=t,this.path=e,this.todo=n,this.undo=i}n.Command=Bt,$t=m.Model,l(Ut,$t),Ut.prototype.setParent=function(t){this.parent=t},Ut.prototype.getComponents=function(){return[]};var $t,i=Ut;function Ut(t,e,n){t=$t.call(this,t,e)||this;return t.parent=n,t}n.CommandoModel=i,Ft=m.Collection,l(r,Ft),r.prototype.commandAdd=function(t,e){var n=_.isArray(t)?t:[t];this.postCommand(this,new Bt(this.getCommandDescription(Vt.Add,t,e||"Add"),[],n.map(function(t){return new Ot(Vt.Add,"",{attributes:t.toJSON()})}),n.map(function(t){return new Ot(Vt.Remove,"",t.id)})))},r.prototype.commandRemove=function(t){var e=this,n=_.isArray(t)?t:[t];this.postCommand(this,new Bt(this.getCommandDescription(Vt.Remove,t),[],n.map(function(t){return new Ot(Vt.Remove,"",t.id)}),n.map(function(t){return new Ot(Vt.Add,"",{attributes:t.toJSON(),index:e.findIndex(t)})})))},r.prototype.commandSet=function(t){var i=this,e=t.map(function(t,e){var n=i.get(t.id)||i.at(e);if(n)return e=n.changedAttributes(t),t=_.mapValues(e,function(t,e){return n.previous(e)}),n.id&&(t.id=n.id),t});this.postCommand(this,new Bt(this.getCommandDescription(Vt.Set,t),[],[new Ot(Vt.Set,"",t)],[new Ot(Vt.Set,"",e)]))},r.prototype.doCommand=function(t,e){var n=this,i=t.pop();i?(i=this.get(i))&&i.doCommand(t,e):e.forEach(function(t){n.doCommandByOp[t.op](t.payload)})},r.prototype.doCommandAdd=function(t){this.add(t.attributes,{at:t.index})},r.prototype.doCommandSet=function(t){this.set(t,{remove:!1})},r.prototype.doCommandRemove=function(t){this.remove(t)},r.prototype.getCommandDescription=function(t,e,n){var i=this.getCommandDescriptor(e);return(n=n||Vt[t])+" "+(i=i&&_.isArray(e)&&1<e.length?this.getPluralDescriptor(i):i)},r.prototype.getCommandDescriptor=function(t){return this.descriptor},r.prototype.getComponents=function(){return _.flatMap(this.models,function(t){return t.getComponents()})},r.prototype.getPluralDescriptor=function(t){return t+"s"},r.prototype.postCommand=function(t,e){return this.parent.postCommand(this,e)},r.prototype.preinitialize=function(t,e){this.parent=e.parent},r.prototype.setParent=function(t){this.parent=t},r.prototype._prepareModel=function(t,e){if(this._isModel(t))return t.collection||(t.collection=this),t;t=new((e=e?_.clone(e):{}).collection=this).model(t,e,this);return t.validationError?(this.trigger("invalid",this,t.validationError,e),!1):t};var Ft,i=r;function r(t,e,n){t=Ft.call(this,t,_.extend(e,{parent:n}))||this;return t.doCommandByOp=((e={})[Vt.Add]=t.doCommandAdd.bind(t),e[Vt.Remove]=t.doCommandRemove.bind(t),e[Vt.Set]=t.doCommandSet.bind(t),e),t}n.ComandoCollection=i;var c=I=I||{};qt=m.DeepModel,l(Ht,qt),Ht.setDataProperties=function(t){if(t){for(var e in t)t[e]&&t[e].path?t[e]instanceof c.DocumentDataModel?t[e]={_dashboardsType:"data",value:t[e].path}:t[e]instanceof c.DocumentViewModel&&(t[e]={_dashboardsType:"viewstate",value:t[e].path}):"object"==typeof t[e]&&(t[e]=Ht.setDataProperties(t[e]));return t}},Ht.prototype.initialize=function(){this.listenTo(this,"change",this.determineMaterialChange.bind(this))},Ht.prototype.clone=function(t){var o,r,s,e={},a=function(n,i){_.each(_.keys(n),function(t){var e=0;if(n[t]instanceof c.DocumentViewModel||n[t]instanceof c.DocumentDataModel)i[t]=n[t];else if(n[t]instanceof Array)for(i[t]=new Array(n[t].length),e=0;e<n[t].length;e+=1)_.isObjectLike(n[t][e])?(i[t][e]=n[t][e]instanceof Array?[]:{},a(n[t][e],i[t][e])):i[t][e]=n[t][e];else n[t]instanceof Date?(i[t]=new Date,i[t].setTime(n[t].getTime())):_.isObject(n[t])?(i[t]={},a(n[t],i[t])):"advanced"===t&&-1!==n[t].indexOf(o)&&r?i[t]=n[t].replace(s,r):i[t]=n[t]})};return t&&(o=t.previousWidgetId,r=t.widgetId,s=new RegExp(o,"g")),a(this.attributes,e),new Ht(e,{},this.parent)},Ht.prototype.commandSet=function(t){var n=this,e=_.mapValues(t,function(t,e){return n.get(e)}),i=_.keys(t),o="Set ",i=(i[0]&&(o+=_.last(i[0].split("."))),1<i.length&&(o+=" & "+(i.length-1)+" more"),new c.Command(o,[],[new c.Todo(c.CommandOp.Set,"",t)],[new c.Todo(c.CommandOp.Set,"",e)]));this.postCommand(this,i)},Ht.prototype.determineMaterialChange=function(t,e){t.changed&&!_.isEmpty(_.omit(t.changed,t.IMMATERIAL_ATTRIBUTES))&&this.trigger("materialChange")},Ht.prototype.doCommand=function(t,e){var n=this;e.forEach(function(t){n.set(t.payload)})},Ht.prototype.postCommand=function(t,e){return this.parent&&this.parent.postCommand(this,e)},Ht.prototype.setParent=function(t){this.parent=t},Ht.prototype.toDiff=function(t){var o={},r=this._templates;return r&&r.Defaults&&(_.defaultsDeep(r.Defaults,xt().appArgs.json),_.each(t,_.bind(function(t,i){var e;r.Defaults[i]&&("string"==typeof t?o[i]=t:_.isArray(t)||(e=st.getDiff(t,r.Defaults[i]),_.isEmpty(e)||(o[i]=e)),_.isArray(t)&&_.each(t,_.bind(function(t,e){var n={},n=t&&t._Hidden&&t._Hidden._Type?st.getDiff(t,r[i][t._Hidden._Type]):void 0!==r[i]&&r[i][i]?st.getDiff(t,r[i][i]):t;o[i]=void 0===o[i]?[]:o[i],o[i].push(n)},this)))},this))),o},Ht.prototype.toJSON=function(){var t=$.extend(!0,{},this.attributes),e=(Ht.setDataProperties(t),this.toDiff(t));return _.isEmpty(e)?t:e};var qt,Yt=Ht;function Ht(t,e,n){t=qt.call(this,t,e)||this;return t.IMMATERIAL_ATTRIBUTES=["version","poss_sel_cols","possible_axis","possible_colors","possible_columns","possible_dashboards","possible_floats","possible_keys","possible_labels","possible_Period","possible_screens","possible_selected_columns","possible_servers","possible_shapes","possible_strings","possible_track","possible_values","possible_viewstates","possibleColumns","possibleConnections","possibleKeys","possibleLabels","possibleValues","datagridPossibleColumns","datagridPossibleColumnsWithItself","selectedColumnPossibleValues","highlightTargetPossibleValues","sortingPossibleValues","Selection"],t.parent=n,t}c.ComponentOptions=Yt,Kt=c.CommandoModel,l(h,Kt),h.convertDashboardTypesToModels=function(i,t,e){var o,r,s,a=m.DeepModel.keyPathSeparator;i&&(o={data:t,viewstate:e},t=i.toFlat(!0),r=_.keys(o),s=function(t,e){var n;_.isObject(t)&&_.includes(r,t._dashboardsType)&&"string"==typeof(n=t.value)&&((t=(t=o[t._dashboardsType](n))||{}).path=n,i.set(e,t,{silent:!0}))},_.each(t,function(t,i){_.isArray(t)?_.each(t,function(t,n){_.each(t,function(t,e){s(t,i+a+n+a+e)})}):s(t,i)}))},h.prototype.initialize=function(){var t=this.get("key");t&&/App$/.test(t)&&this.set("key",t.replace(/App$/,""),{silent:!0}),this.silentCast("options",Yt),this.silentCast("components",Qt),this.listenTo(this.get("components"),"materialChange",function(){this.trigger("materialChange")}),kt(this.attributes.key,this.attributes),this.silentCast("widgets",c.WidgetCollection),this.listenTo(this.get("widgets"),"materialChange",function(){this.trigger("materialChange")}),this.listenTo(this.get("options"),"materialChange",this.onOptionsMaterialChange)},h.prototype.clone=function(t){var e=new h({definitionId:this.get("definitionId"),key:this.get("key"),containerId:this.get("containerId"),components:this.get("components").clone(),widgets:this.get("widgets").clone()},{},this.parent);return t=t||{previousWidgetId:this.id,widgetId:e.id},e.set("options",this.get("options").clone(t),{silent:!0}),e},h.prototype.defaults=function(){return{id:c.Helpers.getGUID(),key:null,options:new Yt({},{},this),containerId:null,components:new Qt([],{},this),widgets:new c.WidgetCollection([],{},this)}},h.prototype.doCommand=function(t,e){if(0<t.length){var n=t.pop();if(-1!=["options","components","widgets"].indexOf(n))return this.get(n).doCommand(t,e);throw"Unsupported command key"}},h.prototype.getComponents=function(){return[this].concat(this.get("widgets").getComponents()).concat(this.get("components").getComponents())},h.prototype.getInnermostComponents=function(t){var e=this.get("components");return 0<e.length&&e.at(0).get("key")===t?e.at(0).getInnermostComponents(t):e},h.prototype.postCommand=function(t,e){return t instanceof Qt?e.path.push("components"):t instanceof c.WidgetCollection?e.path.push("widgets"):t instanceof Object&&e.path.push("options"),e.path.push(this.id),this.parent&&this.parent.postCommand(this,e)},h.prototype.onOptionsMaterialChange=function(){this.get("upgrading")||this.trigger("materialChange")},h.prototype.silentCast=function(t,e,n){this.get(t)instanceof e||this.set(t,new e(this.get(t),n,this),{silent:!0})},h.prototype.parseCastAndListen=function(t,e,n,i,o){var r=this;!t||!t[e]||t[e]instanceof n||(t[e]=new n(t[e],o,this),this.listenTo(t[e],i,function(t){r.trigger("change",r)}))},h.prototype.parse=function(t){return this.parseCastAndListen(t,"components",Qt,"change add remove"),this.parseCastAndListen(t,"options",Yt,"change"),kt(this.attributes.key,t),this.parseCastAndListen(t,"widgets",c.WidgetCollection,"change add remove"),t},h.prototype.setParent=function(t){this.parent=t,this.get("components")&&this.get("components").setParent(this),this.get("options")&&this.get("options").setParent(this),this.get("widgets")&&this.get("widgets").setParent(this)};var Kt,zt=h;function h(){return null!==Kt&&Kt.apply(this,arguments)||this}c.Component=zt,Wt=c.ComandoCollection,l(jt,Wt),jt.prototype.clone=function(){return new jt(_.map(this.models,function(t){return t.clone()}),{model:this.model,comparator:this.comparator},this.parent)},jt.prototype.getCommandDescriptor=function(t){var e,n=Wt.prototype.getCommandDescriptor.call(this,t);return _.isArray(t)&&1===t.length?e=t[0]:t instanceof zt&&(e=t),(n=e instanceof m.Model?e.get("key"):n)||this.descriptor},jt.prototype.setParent=function(t){var e=this;this.parent=t,this.map(function(t){return t.setParent(e)})};var Wt,Qt=jt;function jt(){var t=null!==Wt&&Wt.apply(this,arguments)||this;return t.descriptor="Component",t}(c.ComponentCollection=Qt).prototype.model=zt;o=I=I||{};Gt=m.Model,l(Jt,Gt),Jt.prototype.defaults=function(){return{listViewThumb:null,ghostViewThumb:null,buildViewThumb:null,appKey:null,appArgs:null,name:null,description:null}};var Gt,Xt,Zt=Jt;function Jt(){return null!==Gt&&Gt.apply(this,arguments)||this}function te(){var t=null!==Xt&&Xt.apply(this,arguments)||this;return t.model=Zt,t}o.ComponentDefinition=Zt,Xt=m.Collection,l(te,Xt),o.ComponentDefinitionCollection=te,m.emulateHTTP=!0;mt=I=I||{};ee=m.Model,l(oe,ee),Object.defineProperty(oe.prototype,"idAttribute",{get:function(){return"name"},enumerable:!1,configurable:!0}),oe.prototype.defaults=function(){return{name:"default",type:"q",host:"localhost",port:"80",tls:"false",user:"",password:""}};var ee,ne,ie=oe;function oe(){return null!==ee&&ee.apply(this,arguments)||this}function re(){var t=null!==ne&&ne.apply(this,arguments)||this;return t.model=ie,t}mt.Connection=ie,ne=m.Collection,l(re,ne),mt.ConnectionCollection=re,m.emulateHTTP=!0;vt=I=I||{};se=m.Model,l(ue,se),Object.defineProperty(ue.prototype,"idAttribute",{get:function(){return"name"},enumerable:!1,configurable:!0}),ue.prototype.defaults=function(){return{name:"default",type:"kdb",connections:[],connectionsType:[]}};var se,ae,le=ue;function ue(){return null!==se&&se.apply(this,arguments)||this}function ce(){var t=null!==ae&&ae.apply(this,arguments)||this;return t.model=le,t}vt.ConnectionGroup=le,ae=m.Collection,l(ce,ae),vt.ConnectionGroupCollection=ce,m.emulateHTTP=!0;wt=I=I||{};pe=m.Model,l(ge,pe),Object.defineProperty(ge.prototype,"idAttribute",{get:function(){return"name"},enumerable:!1,configurable:!0}),ge.prototype.defaults=function(){return{name:"default",type:"q",host:"localhost",port:"80",tls:"false",user:"",password:""}};var pe,de,he=ge;function ge(){return null!==pe&&pe.apply(this,arguments)||this}function fe(){var t=null!==de&&de.apply(this,arguments)||this;return t.model=he,t}function me(t,e,n){t=Lt.call(this,t,e,n)||this;return t.IMMATERIAL_ATTRIBUTES=["isGridstack"],t.parent=n,t.listenTo(t,"change",t.determineMaterialChange.bind(t)),t}wt.Service=he,de=m.Collection,l(fe,de),wt.ServiceCollection=fe,Nt=I=I||{},Lt=Nt.CommandoModel,l(me,Lt),me.prototype.commandSet=function(t){this.postCommand(this,new Nt.Command("Set Layout",[],[new Nt.Todo(Nt.CommandOp.Set,"",t)],[new Nt.Todo(Nt.CommandOp.Set,"",_.clone(this.toJSON()))]))},me.prototype.defaults=function(){return{row:null,column:null,rowSpan:12,colSpan:6}},me.prototype.determineMaterialChange=function(){this.changed&&!_.isEmpty(_.omit(this.changed,this.IMMATERIAL_ATTRIBUTES))&&this.trigger("materialChange")},me.prototype.doCommand=function(t,e){var n=this;e.forEach(function(t){n.set(t.payload)})},me.prototype.postCommand=function(t,e){return this.parent.postCommand(this,e)},Nt.Layout=me;var ye,g,ve,be,v,we,Se,_e,Ce,Te,De,Me,Ee,w=I=I||{};Pe=w.CommandoModel,l(ke,Pe),ke.prototype.clone=function(t){var e=new ke({},{},this.parent),t=(t&&e.set("id",t),_.omit(this.attributes,"id"));return t.component=this.get("component").clone({previousWidgetId:this.id,widgetId:e.id}),t.layout=this.get("layout").clone(),e.set(t),e},ke.prototype.defaults=function(){return{id:w.Helpers.getGUID(),layout:new w.Layout({},{},this),component:null}},ke.prototype.commandSet=function(t){var e=this.clone(this.id).toJSON();this.postCommand(this,new w.Command("Set Widget",[],[new w.Todo(w.CommandOp.Set,"",t)],[new w.Todo(w.CommandOp.Set,"",e)]))},ke.prototype.doCommand=function(t,e){var n=this;if(0<t.length){var i=t.pop();if(-1!==["layout","component"].indexOf(i))return this.get(i).doCommand(t,e);throw"Unsupported command key"}e.forEach(function(t){t.payload.component&&(t.payload.component instanceof m.Model?n.set("component",t.payload.component):n.set("component",new w.Component(t.payload.component,{},n)))})},ke.prototype.getComponents=function(){return this.get("component").getComponents()},ke.prototype.postCommand=function(t,e){return t instanceof w.Layout?e.path.push("layout"):t instanceof w.Component&&(e.path.pop(),e.path.push("component")),e.path.push(this.id),this.parent.postCommand(this,e)},ke.prototype.onComponentChanged=function(t,e,n){e&&this.listenTo(e,"change",function(t,e){this.trigger("change",t,e)})},ke.prototype.onMaterialChange=function(){this.trigger("materialChange")},ke.prototype.setParent=function(t){this.parent=t,this.get("component")&&this.get("component").setParent(this),this.get("layout")&&this.get("layout").setParent(this)};var Pe,Ie=ke;function ke(t,e,n){t=Pe.call(this,t,e,n)||this;return t.IMMATERIAL_ATTRIBUTES=[],!t.get("layout")||t.get("layout")instanceof w.Layout||t.set({layout:new w.Layout(t.get("layout"),{},t)},{silent:!0}),!t.get("component")||t.get("component")instanceof w.Component||t.set({component:new w.Component(t.get("component"),{},t)},{silent:!0}),t.get("component")&&t.listenTo(t.get("component"),"materialChange",t.onMaterialChange.bind(t)),t.get("layout")&&t.listenTo(t.get("layout"),"materialChange",t.onMaterialChange.bind(t)),t.listenTo(t,"change:component",t.onComponentChanged.bind(t)),t.onComponentChanged(t,t.get("component")),t}w.Widget=Ie,Ae=w.ComandoCollection,l(xe,Ae),xe.prototype.clone=function(){return new xe(_.map(this.models,function(t){return t.clone()}),{model:Ie,comparator:this.comparator},this.parent)},xe.prototype.commandSet=function(t){var i=this,e=t.map(function(t,e){var n=i.get(t.id)||i.at(e);if(n)return e=n.changedAttributes(t),t=_.mapValues(e,function(t,e){e=n.get(e);return e instanceof m.Model?e.toJSON():e}),n.id&&(t.id=n.id),t}),t=new w.Command(this.getCommandDescription(w.CommandOp.Set,t),[],[new w.Todo(w.CommandOp.Set,"",t)],[new w.Todo(w.CommandOp.Set,"",e)]);this.postCommand(this,t)},xe.prototype.doCommandSet=function(t){var n=this;t.forEach(function(t){var e=n.get(t.id);e&&(t.component&&e.get("component").set(t.component),t.layout&&e.get("layout").set(t.layout))})},xe.prototype.getCommandDescriptor=function(t){var e,n=Ae.prototype.getCommandDescriptor.call(this,t);return _.isArray(t)&&1===t.length?e=t[0]:t instanceof Ie&&(e=t),(n=e instanceof m.Model&&e.get("component")?e.get("component").get("key"):n)||this.descriptor},xe.prototype.setParent=function(t){var e=this;this.parent=t,this.map(function(t){return t.setParent(e)})};var Ae,_t=xe;function xe(){var t=null!==Ae&&Ae.apply(this,arguments)||this;return t.commandQueue=[],t.descriptor="Widget",t.model=Ie,t}function Ne(t,n,i){var o=this;this.class="203",this.columns=[],this.meta={},this.cols={},void 0!==t&&(this.columns=t).forEach(function(t,e){o.meta[t]=n[e].qtype,o.cols[t]=ye.Parse.col(n[e],i)})}function S(t){var e=this,n=(this.requests={},this.requestId=1,this.httpOn=!1,this.insightsAPI=!1,(S.client=this).insightsAPI=t.insightsAPI||!1,this.debouncedHeartbeat=t.httpOnly?_.noop.bind(this):_.debounce(this.heartbeat.bind(this),15e3),(t.httpOn||t.httpOnly||t.insightsAPI)&&(this.httpOn=!0),t.httpOnly||t.insightsAPI);if(t.noWorker||n)n?_.defer(function(){return e.onOpen(void 0)}):this.init();else{n=requirejs.toUrl("worker")+".js";g.Log.Log(S.WORK+n);try{!window.SharedWorker||"FSBL"in window?(this.worker=new Worker(n,t),this.worker.onmessage=function(t){return e.onWsMessage(t)},this.worker.onerror=function(t){return e.onWorkerError(t)}):(this.worker=new SharedWorker(n,t),this.worker.port.onmessage=function(t){return e.onWsMessage(t)},this.worker.port.onmessageerror=function(t){return e.onWorkerError(t)},this.worker.port.start(),this.worker.onerror=function(t){return e.onWorkerError(t)})}catch(t){throw g.Log.Log(S.WORK+"create err",t),t}}}function C(t,e,n,i,o,r){var s=we.call(this,t)||this,a=(s.agent=new v.Agent,s.callbacks=[],s.dataMapper=null,s.dataSet=null,s.dataSet2=null,s.forceInternalReset=!1,s.isClone=!1,s.isDirty=!1,s.isPending=!1,s.legacyFlushTime=0,s.consolidateCount=0,s.dataExecuteSuccessCount=0,s.onExecuteBeginCount=0,s.durationMovingAverage=C.FAST_THRESHOLD,s.paramChanged=[],s.parameterModels=[],s.performance=new v.PerformanceMetrics,s.pollingEvent=null,s.subscriptionId=null,s.subscriptionTypes=["polling","subscription","streaming"],s.viewStateBindings={},s.virtualSubscriptions={},[]);return s.root=e||s,s.path=n,s.viewState=i,s.group=o,s.virtualSubscriptions=r||{},s.group&&(s.unset("_pagingType",{silent:!0}),s.unset(C.AUTO_EXECUTE,{silent:!0})),s.get("_queryString")||!s.get("_pivotQuery")&&!s.get("_table")||(s.set("_queryString",s.get("_pivotQuery")||"select from "+s.get("_table")),s.unset("_pivotQuery"),s.unset("_table")),_.keys(s.attributes).forEach(function(t){var e,n=s.get(t);_.isArray(n)||!_.isObject(n)||n instanceof m.Model||(n._dataType?("copy"===n._dataType&&(n._dataType="query"),_.includes(["analytic","streaming","pivot","query","virtual","builder","sql"],n._dataType)?(e=new C(n,s.root,s.path?s.path+"/"+t:t,s.viewState),a.push(e),s.set(t,e,{silent:!0}),s.listenTo(e,"materialChange",s.onMaterialChange)):v.Log.Error(s.logPrefix()+" unsupported datatype: ",n._dataType)):"viewstate"===n._dashboardsType?(e=s.viewState.getByPath(n.value),s.set(t,e,{silent:!0})):_.includes(["_analyticParams","_mappings","_pageSort"],t)||n instanceof m.Model&&n.get("_viewType")||(e=new C(n,s.root,s.path?s.path+"/"+t:t,s.viewState,!0),s.set(t,e,{silent:!0}),s.listenTo(e,"change",function(){return s.trigger("change",s)}),s.listenTo(e,"materialChange",s.onMaterialChange)))}),s.has("_pagingNum")&&s.set("_pagingNum",0,{silent:!0}),s.has("_pageSort")&&s.set("_pageSort",{},{silent:!0}),s.debouncedParameterChange=_.throttle(s.applyParameterChange.bind(s),60,{leading:!1}),s.listenTo(s,"change",s.onModelChange),s}function T(t,e,n){t=_e.call(this,t,e,n)||this;return t.MATERIAL_ATTRIBUTES=["_type","_default"],t.withAllProperties=!1,e&&(e.path&&(t.path=e.path),t.root=!0===e.root?t:e.root),_.each(_.keys(t.attributes),function(t){var e,n=this.get(t);if(_.isObject(n)&&-1===["_default","value",".settings"].indexOf(t))e=new T(n,{path:this.path?this.path+"/"+t:t,root:this.root},this),this.set(t,e,{silent:!0}),this.listenTo(e,"change",this.onChildModelChange),this.listenTo(e,"materialChange",this.onMaterialChange);else if(".settings"===t){if(!(n instanceof m.Model)){for(var i in n)n.hasOwnProperty(i)&&(n[i]=new m.Model(n[i]));this.set(t,new m.Model(n))}}else this.set(t,n),"_default"===t&&(this.get("_rolling")?this.set("value",Se.Helpers.convertRollingToDate(n,this.get("_type"))):this.set("value",n))}.bind(t)),_.has(t.attributes,"_default")&&_.has(t.attributes,"value")&&(t.attributes._type=t.attributes._type||"symbol",t.schema={_type:{type:"Select",options:["boolean","byte","char","date","datetime","dict","double","float","guid","int","list","long","minute","month","second","short","string","symbol","time","timespan","timestamp"]}},t.updateSchema()),t.listenTo(t,"change",t.onChange),t}(w.WidgetCollection=_t).prototype.model=Ie,function(t){var i,o;function e(t,e,n){return o.call(this,t,e,i.TypeNum.Guid,n,16)||this}i=t.ipc||(t.ipc={}),o=i.Vector,l(e,o),e.prototype.calcRange=function(){throw"Not implemented"},e.prototype.hash=function(t){throw"GUID hash not implemented "+t},e.prototype.getScalar=function(t){return this.dataView.getBigInt64(this.getByteLocation(t),!0)},e.prototype.getValue=function(t){for(var e=this.getByteLocation(t),n=e+this.SIZE,i="0123456789abcdef",o="",r=e;r<n;r++)var s=this.dataView.getUint8(r),a=r-e,o=(o+=4==a||6==a||8==a||10==a?"-":"")+i[s>>4]+i[15&s];return"00000000-0000-0000-0000-000000000000"===o?null:o},i.Guid=e}(I=I||{}),function(t){var i,o;function e(t,e,n){return o.call(this,t,e,i.TypeNum.Unary,n)||this}i=t.ipc||(t.ipc={}),o=i.U8,l(e,o),e.prototype.getValue=function(t){return this.getScalar(t)},i.Unary=e}(I=I||{}),Tt=I=I||{},ye=Tt.ipc||(Tt.ipc={}),Ne.toLegacy=function(t,i,o){for(var e=0<i.length?o[i[0]].length:0,r=new Array(e),n=0;n<e;n++)!function(e){var n=new Object;i.forEach(function(t){return n[t]=o[t].toLegacy(e)}),r[e]=n}(n);return{class:"203",columns:i.slice(0),meta:_.clone(t),rows:r}},Ne.prototype.addColumn=function(t,e,n){this.columns.push(t),this.meta[t]=e.qtype,this.cols[t]=ye.Parse.col(e,n)},Ne.prototype.addParsedColumn=function(t,e){this.columns.push(t),this.meta[t]=e.qtype,this.cols[t]=e},Ne.prototype.merge=function(e){var n=this;return this.columns=this.columns.concat(e.columns),e.columns.forEach(function(t){n.meta[t]=e.meta[t],n.cols[t]=e.cols[t]}),this},Ne.prototype.toLegacy=function(){return Ne.toLegacy(this.meta,this.columns,this.cols)},Ne.prototype.toViewState=function(){return{_type:"table",value:this.toLegacy()}},Tt=Ne,(ye.Table=Tt).prototype.qtype=98,function(u){var c;function p(){}c=u.ipc||(u.ipc={}),p.col=function(t,e){if(-11===t.qtype)return new c.Symbol(1,[t.offset],e);if(11===t.qtype)return new c.Symbol(t.offsets.length,t.offsets,e);if(0===t.qtype)return new c.List(t.values,t.end,e);if(101===t.qtype)return new c.Unary(1,t.offset,e);if(98===t.qtype||99===t.qtype)return p.table(t,e);if(101===t.qtype)return new c.Unary(1,t.offset,e);var n=p.VECTOR_COLUMN_CLASSES[Math.abs(t.qtype)];return n?t.qtype<0?new n(1,t.offset,e):new n(t.length,t.offset,e):null},p.dict=function(t,e){var n=p.col(t.keys,e),e=p.col(t.values,e);return new c.Dict(n.length,n,e,t.qtype)},p.flipDict=function(t,e){var n=p.col(t.keys,e),i=p.col(t.values,e);return new c.Table(_.times(n.length,function(t){return n.toLegacy(t)}),_.times(i.length,function(t){return i.getValue(t)}),e)},p.reshape=function(t,e){var n=t.qtype,i=new DataView(e);if("com.fd.business.querymanager.subscriptions.StreamingSubscription"===t.class||"210"===t.class||"207"===t.class)return t;e=p.table(t,i);if(e&&98===e.qtype)return e;var o=new c.Table;if(-20<n&&n<0){e=p.TYPE_NAMES[-n]||"unknown";o.addColumn(e,-11===n?new u.qSymList(!0,[t.offset]):new u.qVector(-n,!0,1,t.offset),i)}else if(99===n){e=t;o.addColumn("Property",e.keys,i),o.addColumn("Value",e.values,i)}else if(10===n){var r=t;o.addColumn("string",new u.qGenericList(!0,[r],r.offset+r.length*u.getTypeSize(r.qtype)),i)}else if(0===n)t.values.forEach(function(t,e){null!==t&&(e=(10===t.qtype?"string":p.TYPE_NAMES[Math.abs(t.qtype)]||"unknown")+e,t.qtype<0?o.addColumn(e,-11===t.qtype?new u.qSymList(!0,[t.offset]):new u.qVector(-t.qtype,!0,1,t.offset),i):o.addColumn(e,10!==t.qtype&&t.qtype<=19?t:new u.qGenericList(!0,[t],10===t.qtype?t.offset+u.getTypeSize(t.qtype)*t.length:t.offset),i))});else if(11===n){var s=t;s.offsets.forEach(function(t,e){o.addColumn((p.TYPE_NAMES[s.qtype]||"unknown")+e,new u.qSymList(!0,[t]),i)})}else{if(!(0<=n&&n<20)){if(101===n)return o;throw"Unsupported Root Object"}for(var r=t,a=u.getTypeSize(r.qtype),l=0;l<r.length;l++)o.addColumn((p.TYPE_NAMES[r.qtype]||"unknown")+l,new u.qVector(r.qtype,!0,1,r.offset+a*l),i)}return o},p.table=function(t,e){if(98===t.qtype)return p.flipDict(t,e);if(99===t.qtype){var n,i,o,r=t;if(98!==r.values.qtype)return p.dict(t,e);if(98===r.keys.qtype)return t=p.flipDict(r.keys,e),n=p.flipDict(r.values,e),t.merge(n);if(11===r.keys.qtype&&11===r.values.keys.qtype)return i=p.col(r.values.keys,e),t=["key"].concat(_.times(i.length,function(t){return i.toLegacy(t)})),o=p.col(r.values.values,e),new c.Table(t,[r.keys].concat(_.times(o.length,function(t){return o.getValue(t)})),e);throw"Unsupported nested table/dict"}},p.TYPE_NAMES=["list","boolean","guid",void 0,"byte","short","int","long","real","float","char","symbol","timestamp","month","date","datetime","timespan","minute","second","time"],p.VECTOR_COLUMN_CLASSES=[null,c.Boolean,c.Guid,null,c.Byte,c.Short,c.Int,c.QLong,c.Float,c.Double,c.Char,null,c.Timestamp,c.Month,c.QDate,c.DateTime,c.Timespan,c.Minute,c.Second,c.Time],c.Parse=p}(I=I||{}),g=I=I||{},ve=function(t,e,n,i,o,r){this.maxResults=2147483647,this.timestamp=(new Date).getTime(),this.op=t,this.connectionId=e,this.query=n,i&&(this.maxResults=i),this.success=o,this.error=r},g.DCRequest=ve,S.createLog=function(t,e,n){},S.getQueryData=function(t,e,n,i,o,r,s,a,l){S.getQueryData2(t,e,n,i,S.legacyRowCallback(o),r,s,a,l)},S.getQueryData2=function(t,e,n,i,o,r,s,a,l){a&&g.Log.Error("Paging not supported in lite"),"sql"===t&&g.Log.Error("SQL not supported in lite");a=this.parametersToString(i);a&&(n=n+"["+a+"]"),l&&l.trigger("serverStart"),S.client.send(2,s,e,n,function(t,e,n){n&&l&&(l.set("serverStart",n[0]),l.set("serverEnd",n[1])),o(t,e)},r)},S.parametersToString=function(t){var n,e="";return _.isEmpty(t)||(n=[],_.each(t,function(t,e){n.push(g.RTTI.getByName(t.type).toKDBInput(t.value))}),e=n.join(";")),e},S.parametersToIPC=function(t){function n(t){var e=S.deltaNameMap[t.type];if(e)return e.toIPC(g.ipc.fromString(e,t.value));throw"Unsupported param type: "+t.type}var i=[];return _.isEmpty(t)||_.each(t,function(t,e){"dict"===t.type?i.push(g.ipc.Dict.toIPC(_.map(t.value,function(t,e){return e}),g.ipc.List.toIPC(_.map(t.value,n)))):"list"===t.type?i.push(g.ipc.Symbol.listToIPC(t.value.map(function(t){return _.isNil(t)?"":t.toString()}))):i.push(n(t))}),g.ipc.List.toIPC(i)},S.runAnalytic=function(t,e,n,i,o,r,s,a){S.runAnalytic2(t,e,n,function(t,e){var t=g.ipc.Parse.reshape(t,e),n=t.toLegacy();return delete t.cols,e=null,i(n)},o,r,null,a)},S.runAnalytic2=function(t,e,n,i,o,r,s,a){n&&_.values(n).length||(n=[{type:"symbol",value:null}]),S.client.send(2,r,e,[{type:"symbol",value:t}].concat(_.values(n)),function(t,e,n){n&&a&&(a.set("serverStart",n[0]),a.set("serverEnd",n[1])),i(t,e)},o)},S.runAPI=function(t,e,n,i,o,r,s,a){n&&_.values(n).length||(n=[{type:"symbol",value:null}]),S.client.send(1,r,e,[{type:"symbol",value:t}].concat(_.values(n)),function(t,e){var t=g.ipc.Parse.reshape(t,e),n=t.toLegacy();return delete t.cols,e=null,i(n)},o)},S.getDeltaAnalytics=function(e,t){S.runAnalytic(".api.getFunctions",t,[],function(t){return e(_.map(t.rows,function(t){return t.parameters=t.parameters.rows,t.name=".api."+t.name,t}))},function(){})},S.legacyRowCallback=function(n){return function(t,e){n&&(e&&e.byteLength&&(t.dataSet?t.dataSet=g.ipc.Parse.reshape(t.dataSet,e).toLegacy():t=g.ipc.Parse.reshape(t,e).toLegacy()),n(t))}},S.updateTable=function(n,t,e){for(var i=[],o=0;o<3;o+=1)i[o]={type:"dict",value:{},index:o};_.each(i,function(t,e){t.index=e}),_.each(n.addedDict.items,function(t,e){i[0].value[e]={type:S.updateTableGetListType(n.typeConfig[e],t),value:t}}),_.each(n.updatedDict.items,function(t,e){i[1].value[e]={type:S.updateTableGetListType(n.typeConfig[e],t),value:t}}),_.each(n.deletedDict.items,function(t,e){i[2].value[e]={type:S.updateTableGetListType(n.typeConfig[e],t),value:t}}),"analytic"===n.updateType?n.updateAnalytic&&S.runAnalytic(n.updateAnalytic,n.connection,i,t,e):S.getQueryData("kdb",n.connection,n.query,i,t,e)},S.updateTableGetListType=function(t,e){var n;switch(t){case 0:return n=_.isArray(e)?_.isBoolean(e[0])?"listlistboolean":_.isString(e[0])?"listliststring":"listlistsymbol":_.isString(e)?"string[]":"symbol[]";case 1:return"boolean[]";case 2:return"guid[]";case 4:return"byte[]";case 5:return"short[]";case 6:return"int[]";case 7:return"long[]";case 8:return"real[]";case 9:return"float[]";case 10:return n="char[]",_.each(e,function(t){1<t.length&&(n="string[]")}),n;case 11:return"symbol[]";case 12:return"timestamp[]";case 13:return"month[]";case 14:return"date[]";case 15:return"datetime[]";case 16:return"timespan[]";case 17:return"minute[]";case 18:return"second[]";case 19:return"time[]";default:return"symbol[]"}},S.prototype.destroy=function(){if(this.ws)try{this.ws.onopen=_.noop.bind(this),this.ws.onclose=_.noop.bind(this),this.ws.onmessage=_.noop.bind(this),this.ws.close(),this.ws=null}catch(t){this.ws=null}},S.prototype.send=function(t,e,n,i,o,r){return this.sendRequest(new ve(t,n,i,e,o,r))},S.prototype.subscribe=function(t,e,n,i,o,r){if(void 0===r){var s=void 0,a=/^(`[a-zA-Z]\w+)+$/gm;if(e.match(/^\((`\$"([^"]+)")(;`\$"([^"]+)")*\)$/gm))s=e.match(/`\$"([^"]+)"/g).map(function(t){return t.substring(3,t.length-1)});else{if(!e.match(a))return void o('Enter stream query as a symbol list in the form: (`$"symA";`$"symB")');s=e.match(a).map(function(t){return t.substring(1,t.length)})}r=(1<s.length?s.slice(1):[]).map(function(t){return{type:"symbol",value:t}})}return _.first(r)||r.push({type:"symbol",value:null}),r.splice(0,0,{type:"symbol",value:e}),this.send(3,-t,n,r,i,o)},S.prototype.unsubscribe=function(t){delete this.requests[t],this.sendRequest(new ve(4,null,null,_.noop.bind(this),_.noop.bind(this)),t)},S.prototype.heartbeat=function(){this.ws?this.sendRequest(new ve(0)):this.init()},S.prototype.init=function(){try{var t="file:"===location.protocol?"ws://localhost:10001/":("https:"===location.protocol?"wss://":"ws://")+location.host+"/api/ws";g.Log.Log(S.SOCK+t),this.ws=new WebSocket(t),this.ws.binaryType="arraybuffer",this.ws.onopen=this.onWsOpen.bind(this),this.ws.onclose=this.onWsClose.bind(this),this.ws.onerror=this.onWsError.bind(this),this.ws.onmessage=this.onWsMessage.bind(this)}catch(t){g.Log.Log(S.SOCK+"Create Err",t)}this.debouncedHeartbeat()},S.prototype.sendRequest=function(e,n){function t(t,e){return e.push(g.ipc.Symbol.toIPC(t.connectionId)),e.push(g.ipc.List.toIPC([g.ipc.Int.toIPC(t.maxResults),"string"==typeof t.query?g.ipc.Char.listToIPC(t.query.split("")):t.query instanceof Array?S.parametersToIPC(t.query):t.query])),e}var i,o,r,s,a=this,l=(n=n||this.requestId++,this.requests[n]=e,[g.ipc.Int.toIPC(this.httpOn?0:n),g.ipc.Int.toIPC(e.op)]);switch(e.op){case 3:if(this.insightsAPI||!e.query||2!==e.query.length)throw new Error("Client: Unsupported Operation");case 1:case 2:this.worker&&!this.httpOn?(o=t(e,[n,e.op]),(!window.SharedWorker||"FSBL"in window?this.worker:this.worker.port).postMessage(o)):((i=new XMLHttpRequest).onprogress=function(t){t.lengthComputable&&(t=t.loaded/t.total*100,g.Log.Log("DashClient download: "+t+"%"))},i.onload=function(){delete a.requests[n],500===i.status?e.error(g.u16u8(new Uint8Array(i.response,Math.min(i.response.byteLength,14)))):i.response&&10<=i.response.byteLength?e.success(g.deserialize(i.response),i.response,[e.timestamp,Date.now()]):e.error("Invalid response")},i.onerror=function(t){delete a.requests[n],e.error("Network failure")},o=location.protocol+"//"+location.host+"/",r="object"==typeof e.query&&".s.e"===(null==(r=e.query[0])?void 0:r.value),this.insightsAPI&&2===e.op&&("string"==typeof e.query||r)?(o+="servicegateway/sandbox/"+encodeURIComponent(e.connectionId)+(r?"/sql":"/qsql"),s=JSON.stringify({query:r?e.query[1].value:e.query,maxResults:Number(e.maxResults)}),i.open("POST",o,!0),i.responseType="arraybuffer",i.send(s)):(s=g.ipc.Util.toMessage(g.ipc.List.toIPC(t(e,l)))).byteLength<2048?(i.open("GET",o+"api/"+btoa(s.reduce(function(t,e){return t+String.fromCharCode(e)},"")).replace(/\//g,"+"),!0),i.responseType="arraybuffer",i.send()):(i.open("POST",o,!0),i.responseType="arraybuffer",i.send(s)));break;case 0:case 4:this.ws&&this.ws.readyState===WebSocket.OPEN&&(this.ws.send(g.ipc.Util.toMessage(g.ipc.List.toIPC(t(e,l)))),this.debouncedHeartbeat());break;default:throw new Error("Client: Unsupported Operation")}return n},S.prototype.onDisconnect=function(t){g.Log.Log("DashClient Disconnect",t),$(this).trigger("DeltaClientDisconnect",t)},S.prototype.onOpen=function(t){g.Log.Log("DashClient Connect"),$(this).trigger("DeltaClientConnect"),g.Log.Log("DashClient Login"),$(this).trigger("DeltaClientLogin")},S.prototype.onWorkerError=function(t){g.Log.Log(S.WORK+"error",t),this.onDisconnect(t)},S.prototype.onWsClose=function(t){g.Log.Log(S.SOCK+"Closed",t),this.destroy()},S.prototype.onWsError=function(t){g.Log.Log(S.SOCK+"Error",t),this.onDisconnect(t),this.destroy()},S.prototype.onWsMessage=function(t){if(t.data instanceof Array){if(6===t.data[0])return void(t.data[1]===WebSocket.OPEN?this.onOpen(null):this.onWorkerError(t.data[2]||"ws not open"));if(5===t.data[0])return this.onWorkerError(t.data[1])}var e=g.deserialize(t.data,8,!0),n=e[0],i=e[1],o=this.requests[n];o?(3!==o.op&&delete this.requests[n],2!==o.op&&1!==o.op&&3!==o.op||(5===i?(i=e[2],o.error(g.u16u8(new Uint8Array(t.data,i.offset,i.length)))):(i=this.httpOn&&3!==o.op?Date.now():new Float64Array(t.data,0,1)[0],o.success(e[2]||{},t.data,[o.timestamp,i])))):g.Log.Warn('Stray Response "'+n+'"')},S.prototype.onWsOpen=function(t){console.log("websocket open",t),this.ws.readyState===WebSocket.OPEN?(g.Log.Log(S.SOCK+"Open",t),this.onOpen(t)):(g.Log.Log(S.SOCK+"Open Error",t),this.onDisconnect(t))},S.SOCK="Socket ",S.WORK="Worker ",S.deltaNameMap={boolean:g.ipc.Boolean,guid:g.ipc.Symbol,byte:g.ipc.Byte,short:g.ipc.Short,int:g.ipc.Int,long:g.ipc.QLong,real:g.ipc.Float,float:g.ipc.Double,char:g.ipc.Char,symbol:g.ipc.Symbol,timestamp:g.ipc.Timestamp,month:g.ipc.Month,date:g.ipc.QDate,datetime:g.ipc.DateTime,timespan:g.ipc.Timespan,minute:g.ipc.Minute,second:g.ipc.Second,time:g.ipc.Time,string:g.ipc.QString},g.DashClient=S,function(t){function e(){this.perf={}}e.prototype.trigger=function(t){this.perf[t]=Date.now()},e.prototype.set=function(t,e){this.perf[t]=e},Object.defineProperty(e.prototype,"performance",{get:function(){return this.perf},enumerable:!1,configurable:!0}),t.PerformanceMetrics=e}(I=I||{}),function(n){function t(){this.legacySubscribers={},this.rawSubscribers={}}t.prototype.notifyAllLegacyChange=function(e,n,i,o){var r=this;_.each(this.legacySubscribers,function(t){return r.notifyChange(t,e,n,i,o)})},t.prototype.notifyAllRawChange=function(e,n,i,o){var r=this;_.each(this.rawSubscribers,function(t){return r.notifyChange(t,e,n,i,o)})},t.prototype.notifyChange=function(t,e,n,i,o){this.callSubscriber(t,t.onData,e,n,i,o)},t.prototype.getSubscribers=function(){return _.union(_.keys(this.legacySubscribers),_.keys(this.rawSubscribers))||[]},t.prototype.subscribe=function(t,e,n){n=n?this.rawSubscribers:this.legacySubscribers;return!n[t]&&(n[t]=e,!0)},t.prototype.subscriberCount=function(){return this.subscriberLegacyCount()+this.subscriberRawCount()},t.prototype.subscriberLegacyCount=function(){return _.keys(this.legacySubscribers).length},t.prototype.subscriberRawCount=function(){return _.keys(this.rawSubscribers).length},t.prototype.unsubscribe=function(t){return this.legacySubscribers[t]?(delete this.legacySubscribers[t],!0):!!this.rawSubscribers[t]&&(delete this.rawSubscribers[t],!0)},t.prototype.unsubscribeAll=function(){return this.legacySubscribers={},this.rawSubscribers={},!0},t.prototype.callSubscriber=function(e,t,n,i,o,r){if(t)try{t.apply(e,Array.prototype.slice.call(arguments,2))}catch(t){this.onSubscriberError(e,t)}},t.prototype.onSubscriberError=function(t,e){n.Log.Error("ERROR: Subscriber error!",e)},n.Agent=t}(I=I||{}),function(d){function t(t){var n=this,i=t.mappings||{};this.setDataModelMappings=t.setMappings,this.subscriptionKey=_.uniqueId("mapper_"),this.subscribe=t.subscribe,this.subscribed=!1,this.unsubscribe=t.unsubscribe,this.viewState=t.viewState,this.model=new m.Model({key:i.key||"",value:i.value||""}),this.mappings=new m.Collection(_.map(i.mappings,function(t,e){return new m.Model({key:e,value:"",viewstate:t&&t._dashboardsType?n.viewState.getByPath(i.mappings[e].value):t})})||[]),_.extend(this,m.Events)}t.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n]},t.prototype.listenTo=function(t,e,n){},t.prototype.stopListening=function(t,e,n){},t.prototype.initialize=function(){this.setSubscription(),this.initializeEvents()},t.prototype.initializeEvents=function(){this.listenTo(this.mappings,"add reset remove",this.onMappingsCollectionChange),this.listenTo(this.mappings,"change:key",this.onMappingItemKeyChange),this.listenTo(this.mappings,"change:viewstate",this.onMappingItemViewStateChange),this.listenTo(this.model,"change:key",this.onMappingKeyChange),this.listenTo(this.model,"change:value",this.onMappingValueChange)},t.prototype.addMapping=function(){var t=this.getPossibleKeys(),e=_.difference(t,this.mappings.map(function(t){return t.get("key")})),e=e?e[0]:t[0]||"",t=_.isString(e)?this.viewState.getByPath(e):"";this.mappings.add({key:e,value:this.getValue(e),viewstate:t||""})},t.prototype.cleanUp=function(){this.stopListening(),this.mappings.reset(),this.setSubscription()},t.prototype.generateValues=function(){this.mappings.each(function(t){t.set("value",this.getValue(t.get("key")))}.bind(this))},t.prototype.getColumns=function(){return this.columns||[]},t.prototype.getPossibleKeys=function(){return this.data?_.keys(this.data):[]},t.prototype.getValue=function(t){return this.data?this.data[t]:void 0},t.prototype.onData=function(t,e,n){var i,o=this.model.get("key"),r=this.model.get("value"),s={},a=[],l=this.mappings.reduce(function(t,e){return t[e.get("key")]=e.get("viewstate"),t},{}),u=e.cols?e.cols[o]?e.cols[o].length:0:(i=e.collection.models.map(function(t){return t.attributes})).length;this.columns=t.columns.collection.map("id"),this.columns.length&&!_.isEqual(this.columns,["unknown0"])&&(this.model.get("key")&&_.includes(this.columns,this.model.get("key"))||this.model.set("key",(_.intersection(this.columns,["k","Key","key"])||[])[0]||this.columns[0]||""),this.model.get("value")&&_.includes(this.columns,this.model.get("value"))||this.model.set("value",(_.intersection(this.columns,["v","Val","val"])||[])[0]||this.columns[1]||""));for(var c=0;c<u;c++){var p=i?i[c][o]:e.cols[o].getValue(c);s[p]=i?d.Tools.convertKDBToViewstateValue(i[c][r]):(e.cols[r]&&e.cols[r].toViewState(c)||{}).value,a.push({Key:p,Viewstate:l[p]})}this.data=s,this.trigger("on-data"),_.each(a,function(t){var e=t.Key,e=s[e],t=_.isString(t.Viewstate)?this.viewState.getByPath(t.Viewstate):t.Viewstate&&t.Viewstate.path?this.viewState.getByPath(t.Viewstate.path):null;_.isObject(e)&&_.each(e,function(t){t&&t._type&&(t.type=t._type,delete t._type)}),t&&_.isFunction(t.set)&&!_.isUndefined(e)&&t.setModelValue(e)}.bind(this))},t.prototype.onMappingItemKeyChange=function(t){t.set("value",this.getValue(t.get("key"))),this.setDataModel()},t.prototype.onMappingItemViewStateChange=function(){this.setDataModel()},t.prototype.onMappingKeyChange=function(){this.generateValues(),this.setDataModel(),this.trigger("key-change")},t.prototype.onMappingsCollectionChange=function(){this.setSubscription(),this.setDataModel(),this.trigger("mappings-change")},t.prototype.onMappingValueChange=function(){this.generateValues(),this.setDataModel(),this.trigger("value-change")},t.prototype.removeMapping=function(t){this.mappings.remove(t)},t.prototype.resetMappings=function(){var e=this;this.mappings.reset(_.map(this.getPossibleKeys(),function(t){return new m.Model({key:t,value:e.getValue(t),viewstate:""})})),this.onMappingsCollectionChange()},t.prototype.setDataModel=function(){this.setDataModelMappings(this.toJSON())},t.prototype.setSubscription=function(t){this.mappings.isEmpty()&&!t?this.subscribed&&(this.subscribed=!1,this.unsubscribe(this.subscriptionKey)):this.subscribed||(this.subscribed=!0,this.subscribe(this.subscriptionKey,{onData:this.onData.bind(this)}))},t.prototype.toJSON=function(){return{key:this.model.get("key"),mappings:this.mappings.reduce(function(t,e){var n=e.get("key"),e=e.get("viewstate");return e instanceof d.DocumentViewModel?t[n]={_dashboardsType:"viewstate",value:e.path}:t[n]=e,t},{}),value:this.model.get("value")}},d.DataMapper=t}(I=I||{}),function(t){function e(t){this.collection=t}e.prototype.assign=function(t){this.collection=t},e.prototype.items=function(){return this.reset||_.map(this.collection.models,function(t){return t.attributes})},t.ChangeSet=e}(I=I||{}),function(u){var s={1212:!0,1213:!0,1214:!0,1215:!0,1216:!0,1217:!0,1218:!0,1219:!0};m.Model;function e(t,e,n){if(null==t)return this;var i,o;for(o in"object"==typeof t?(i=t,0):(i={})[t]=e,this.changed={},i){var r=this.attributes[o];e=i[o],(r&&e&&"object"==typeof r&&"object"==typeof e?s[r.class]&&s[e.class]?r.i===e.i&&r.n===e.n:_.isEqual(r,e):r==e)||(this.attributes[o]=this.changed[o]=e)}return this.idAttribute in i&&(this.id=this.get(this.idAttribute)),this}function n(){return!!this.hasChanged()&&this.changed}function g(t){this.breakdownColumns=[],this.columns=new m.Collection,this.columnDict={},this.preferBackground=!1,this.breakdownColumns=[],this.agent=t.agent,this.collection=new t.collectionFunc,this.collectionFunc=t.collectionFunc,this.collection.model.prototype.set=e,this.collection.model.prototype.changedAttributes=n,this.idAttribute=t.idAttribute,this.maxRows=t.maxRows||100,this.primaryKey=t.primaryKey||g.DEFAULT_ROW_INDEX,this.lazyLoading=t.lazyLoading||!1}g.columnsToCollection=function(t){var e=new m.Collection;return e.models=t.map(function(t){var e=new m.Model;return e.id=t.id,e.attributes=t,e}),e.length=t.length,e},g.updateColumns=function(e,t,n,i){var r=[],s=[],o=t.columns||[],t=[];return i||_.isEmpty(e)?(e={},o.forEach(function(t){return e[t.id]=t}),n.reset=o):(o.forEach(function(t){var n,i,o=e[t.id];o?(i=!(n={}),_.each(t,function(t,e){o[e]!==t&&(i=!0,n[e]=t)}),i&&s.push(_.extend(n,{id:t.id}))):r.push(t)}),(t=(i=_.values(e)).length+r.length>o.length?_.reject(i,function(e){return _.find(o,function(t){return t.id===e.id})}):t).forEach(function(t){return delete e[t.id]}),r.forEach(function(t){return e[t.id]=t}),r.length&&(n.add=r),s.length&&(n.change=s),t&&t.length&&(n.remove=t)),e},g.prototype.addOrExtendExisting=function(t,e,n){var i=t[e=_.isObject(e)?e.toString():e];return i?(_.extend(i,n),!1):(t[e]=n,!0)},g.prototype.addSubscribeFunctions=function(t){var e=this;return t.forEach(function(t){var n=e.collection.get(t[e.primaryKey]);n&&(n.subscribe&&(t.subscribe=function(t,e){n.subscribe(t,e)}),n.unsubscribe&&(t.unsubscribe=function(t){n.unsubscribe(t)}))}),t},g.prototype.background=function(){this.preferBackground=!0},g.prototype.cleanUp=function(){this.columnDict={},this.columns=g.columnsToCollection([]),this.collection.reset(),this.visibilityChangeHandler&&document.removeEventListener("visibilitychange",this.visibilityChangeHandler)},g.prototype.flushUpdates=function(){this.tempDataSet&&(this.onDataInternal({breakdownColumns:this.tempDataSet.breakdownColumns,columns:_.values(this.tempDataSet.columnDict),paging:this.tempDataSet.pagingMeta},this.tempDataSet.collection.models.map(function(t){return t.attributes}),this.tempDataSet.forceReset),delete this.tempDataSet,this.preferBackground=!1)},g.prototype.indexArray=function(t){var e,n;if(this.lazyLoading)for(n=this.pagingMeta.startRows,e=0;e<t.length;e+=1,n+=1)t[e][g.DEFAULT_ROW_INDEX]=n;else for(e=0;e<t.length;e+=1)t[e][g.DEFAULT_ROW_INDEX]=e},g.prototype.isBackground=function(){return!this.noBackground&&(this.preferBackground||document.hidden&&!("FSBL"in window))},g.prototype.isEmpty=function(){return!(this.collection&&this.collection.models&&this.collection.models.length)&&(!this.tempDataSet||this.tempDataSet.isEmpty())},g.prototype.mergeData=function(t,e,n,i){var o,r,s,a,l,u=this,c={},p={},d=[],h=[];if(u.primaryKey===g.DEFAULT_ROW_INDEX&&u.indexArray(t),0===u.collection.length&&0<t.length)t.forEach(function(t){_.isNull(t[u.primaryKey])&&(t[u.primaryKey]=""),d.push(t)}),n.reset=d,u.collection.model&&u.collection.model.prototype.defaults?u.collection.reset(d):u.collection.reset(d.map(function(t){var e=new u.collection.model;return e.attributes=t,e.idAttribute in t&&(e.id=t[e.idAttribute]),e})),u.addSubscribeFunctions(d);else{for(o=0;o<t.length;o+=1)_.isNull(t[o][u.primaryKey])&&(t[o][u.primaryKey]=""),r=t[o][u.primaryKey],r=_.isObject(r)?r.toString():r,!c[r]&&u.collection.get(r)?u.addOrExtendExisting(p,r,t[o]):u.addOrExtendExisting(c,r,t[o])&&d.push(t[o]);l=[],e?l=u.collection.filter(function(t){return r=t.get(u.primaryKey),!(_.has(p,r)||_.has(c,r))}):(a=u.collection.length+d.length,(a-=(l=a>u.maxRows?u.collection.models.slice(0,a-u.maxRows):l).length)>u.maxRows&&(d=d.slice(a-u.maxRows))),l.length&&(u.collection.remove(l),i||(n.remove=_.map(l,function(t){return t.attributes}))),_.each(p,function(t){r=t[u.primaryKey],(s=u.collection.get(r))&&(s.set(t),i||(t=s.changedAttributes())&&(t[u.primaryKey]=r,h.push(t)))}),u.collection.add(d),u.addSubscribeFunctions(d),i||(d.length&&(n.add=d),h.length&&(n.change=h),e&&0===t.length&&!(n.add||n.change||n.remove)&&(n.reset=[]))}},g.prototype.onData=function(t,e,n,i,o){if(this.isBackground())return this.tempDataSet||(this.tempDataSet=new g({idAttribute:this.idAttribute,collectionFunc:this.collectionFunc,agent:new u.Agent,maxRows:this.maxRows,primaryKey:this.primaryKey}),this.tempDataSet.forceReset=!1),this.tempDataSet.onDataInternal(t,e,n,i,void 0,!0),void(n&&(this.tempDataSet.forceReset=!0));this.onDataInternal(t,e,n,i,o)},g.prototype.onDataInternal=function(t,e,n,i,o,r){var s,a=new u.ChangeSet(this.collection),l=new u.ChangeSet(void 0);t&&(_.isUndefined(t.breakdownColumns)||(this.breakdownColumns=t.breakdownColumns),this.columnDict=g.updateColumns(this.columnDict,t,l,r),l.remove&&(s=l.remove.map(function(t){return t.id}),this.collection.models.forEach(function(e){s.forEach(function(t){delete e.attributes[t],delete e.changed[t]})}))),this.pagingMeta=t.paging,e&&(this.mergeData(e,n,a,r),u.Log.Info("Data: "+this.updateSetCountToString(a,this.collection.models))),r||(t={primaryKey:this.primaryKey,columns:l},e=i||void 0,this.pagingMeta&&(t.paging=this.pagingMeta),_.isArray(this.breakdownColumns)&&(t.breakdownColumns=this.breakdownColumns,t.breakdownColumns instanceof m.Model&&(t.breakdownColumns=t.breakdownColumns.get("value"))),o&&o.trigger("onAgentNotify"),t.columns.assign(this.columns=g.columnsToCollection(_.values(this.columnDict))),this.agent.notifyAllLegacyChange(t,a,e,o))},g.prototype.onDataRefresh=function(t){var e=_.values(this.columnDict),n=new u.ChangeSet(this.collection),i=new u.ChangeSet(this.columns),o={};i.reset=e,o={primaryKey:this.primaryKey,columns:i},_.isArray(this.breakdownColumns)&&(o.breakdownColumns=this.breakdownColumns,o.breakdownColumns instanceof m.Model&&(o.breakdownColumns=o.breakdownColumns.get("value"))),this.pagingMeta&&(o.paging=this.pagingMeta),n.reset=this.addSubscribeFunctions(this.collection.map(function(t){return t.attributes})),t?this.agent.notifyChange(t,o,n):this.agent.notifyAllLegacyChange(o,n)},g.prototype.updateSetCountToString=function(t,e){return(t.add?" +"+t.add.length:"")+(t.remove?" -"+t.remove.length:"")+(t.change?" ~"+t.change.length:"")+(t.reset?" ="+t.reset.length:"")+" ==>"+e.length},g.DEFAULT_ROW_INDEX="_rowIndex",u.DataSet=g}(I=I||{}),function(p){function t(t){this.breakdownColumns=[],this.columns=new m.Collection,this.columnDict={},this.breakdownColumns=[],this.agent=t.agent,this.idAttribute=t.idAttribute,this.maxRows=Number(t.maxRows||100),this.primaryKey=t.primaryKey||p.DataSet.DEFAULT_ROW_INDEX}t.prototype.cleanUp=function(){this.columnDict={},this.columns=p.DataSet.columnsToCollection([]),this.cols=void 0},t.prototype.indexArray=function(t){for(var e=0;e<t.length;e+=1)t[e][p.DataSet.DEFAULT_ROW_INDEX]=e},t.prototype.isEmpty=function(){var t=Object.keys(this.columnDict);return!this.cols||0==t.length||!this.cols[t[0]]||0==this.cols[t[0]].length},t.prototype.onData=function(t,e,n,i,o){var r,s,a=this,l=new p.ChangeSet(this.collection),u=new p.ChangeSet(void 0),c={},i=i||void 0;t&&(_.isUndefined(t.breakdownColumns)||(this.breakdownColumns=t.breakdownColumns),this.columnDict=p.DataSet.updateColumns(this.columnDict,t,u)),c={primaryKey:this.primaryKey,columns:u},this.pagingMeta=t.paging,this.pagingMeta&&(c.paging=this.pagingMeta),_.isArray(this.breakdownColumns)&&(c.breakdownColumns=this.breakdownColumns,c.breakdownColumns instanceof m.Model&&(c.breakdownColumns=c.breakdownColumns.get("value"))),n||!this.cols?this.cols=e:null==this.primaryKey||"_rowIndex"===this.primaryKey?_.each(e,function(t,e){var n=a.cols[e];n&&(t.length<n.length?t.qtype!==n.qtype?p.Log.Error("Column '"+e+"': meta mis-match - cannot merge kdb type "+t.qtype+" -> "+n.qtype):n.mergeIndexed(t):a.cols[e]=t)}):(t=this.cols[this.primaryKey],e[this.primaryKey]&&e[this.primaryKey].length>=this.maxRows?this.cols=e:(s=t.mergeKeyedPrimary(e[this.primaryKey],this.maxRows,r=[]),_.each(e,function(t,e){var n;e!==a.primaryKey&&((n=a.cols[e])?n.mergeKeyed(t,r,s,a.maxRows):a.cols[e]=t)}))),l.cols=this.cols,u.assign(this.columns=p.DataSet.columnsToCollection(_.values(this.columnDict))),this.agent.notifyAllRawChange(c,l,i,o)},t.prototype.onDataRefresh=function(t){var e=_.values(this.columnDict),n=new p.ChangeSet(this.collection),i=new p.ChangeSet(this.columns),e=(i.reset=e,{primaryKey:this.primaryKey,columns:i});_.isArray(this.breakdownColumns)&&(e.breakdownColumns=this.breakdownColumns,e.breakdownColumns instanceof m.Model&&(e.breakdownColumns=e.breakdownColumns.get("value"))),this.pagingMeta&&(e.paging=this.pagingMeta),n.cols=this.cols,t?this.agent.notifyChange(t,e,n):this.agent.notifyAllRawChange(e,n)},t.prototype.updateSetCountToString=function(t,e){return(t.add?" +"+t.add.length:"")+(t.remove?" -"+t.remove.length:"")+(t.change?" ~"+t.change.length:"")+(t.reset?" ="+t.reset.length:"")+" ==>"+e.length},p.DataSet2=t}(I=I||{}),(I||(I={})).LegacyUpdate=function(t,e,n,i){this.table=t,this.forceReset=e,this.pagingMeta=n,this.pivotMeta=i},(I||(I={})).ViewStateBinding=function(t,e){this.callback=t,this.model=e},function(a){var t,n;function i(t){var e=n.call(this,t)||this;return e.options=t,e.setSchema(),e}t=a.DataFilter||(a.DataFilter={}),n=m.Model,l(i,n),i.prototype.defaults=function(){return{propertyName:null,propertyType:null,operator:null,value:null,value2:null,active:!0,type:"normal",compareFields:!1}},i.prototype.getBindingValue=function(e){var t=_.find(this.get("appModel").get("settingsModel").get("Bindings"),function(t){return t.Key===e});return t&&t.ViewState instanceof a.DocumentViewModel?t.ViewState.get("value"):""},i.prototype.getTypeOperators=function(t){void 0===t&&(t=null);function e(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];_.each(t,function(t){return n.push.apply(n,t)})}var n=[],i={equal:[{label:"equal",val:"equal"},{label:"not equal",val:"not_equal"}],like:[{label:"like",val:"like"},{label:"not like",val:"not_like"}],blank:[{label:"is blank",val:"is_blank"},{label:"is not blank",val:"is_not_blank"}],compare:[{label:"less",val:"less"},{label:"less or equal",val:"less_or_equal"},{label:"greater",val:"greater"},{label:"greater or equal",val:"greater_or_equal"}],in:[{label:"in",val:"in"},{label:"not in",val:"not_in"}]};switch(this.get("compareFields")&&(i.like=i.blank=i.in=[]),e(i.equal),t){case 0:e(i.like,i.blank);break;case 5:case 6:case 7:case 8:case 9:case 4:e(i.compare,i.blank,i.in);break;case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:e(i.compare,i.blank);break;case 11:e(i.in,i.like,i.blank);break;case 2:e(i.in,i.blank);break;case 10:case 1:e(i.blank)}return n},i.prototype.replaceBindings=function(t){var e=this;return _.isString(t)&&this.get("appModel").get("Bindings")?t.replace(i.VSRx,function(t){t=t.substring(2,t.length-2);return e.getBindingValue(t)}):t},i.prototype.setSchema=function(){var n,t,i,o,e,r=this,s=this.get("propertyType");"histogram"===this.get("type")?(n=[5,6,7,8,9,12,13,14,15,16,17,18,19],t=this.options.appModel.get("data.items").filter(function(t,e){return _.includes(n,r.options.appModel.get("data.meta.columns.models")[e].get("kdbType"))}).map(function(t){return{label:t.get("propertyName"),val:t.get("propertyName")}}),this.schema={active:{title:"Is Active:",type:"Checkbox"},propertyName:{title:"Property:",type:"Select",options:_.sortBy(t,"label")},value:_.extend({title:"From"},a.RTTI.getByQTypeNum(s||11).editor),value2:_.extend({title:"To"},a.RTTI.getByQTypeNum(s||11).editor)}):(t=this.options.appModel.get("data.items").map(function(t){return{label:t.get("propertyName"),val:t.get("propertyName")}}),this.schema={active:{title:"Is Active:",type:"Checkbox"},propertyName:{title:"Property:",type:"Select",options:_.sortBy(t,"label")},operator:{title:"Operator:",type:"Select",options:this.getTypeOperators(s)},value:_.extend({title:"Value"},a.RTTI.getByQTypeNum(s||11).editor)}),this.get("compareFields")?this.schema.value={title:"Value",type:"Select"}:this.get("operator")&&this.get("propertyName")&&_.some(["in","not_in","equal","not_equal","greater","less","greater_or_equal","less_or_equal"],function(t){return t===r.get("operator")})&&(t=this.options.appModel.get("data.items").get(this.get("propertyName")),s=0<=_.indexOf(["equal","not_equal","greater","less","greater_or_equal","less_or_equal"],this.get("operator")),t&&(e=null,t.get("result")&&t.get("result").data?(i=t.get("DataSourceMapping.Text")||this.get("propertyName"),o=t.get("DataSourceMapping.Value")||this.get("propertyName"),e=t.get("result").data.collection.map(function(t){var e=t.get(i),t=t.get(o);return{label:_.isBoolean(e)?e+"":e,val:_.isBoolean(t)?t+"":t}}),(e=_.uniqBy(_.reject(e,function(t){return _.isNil(t.label)}),function(t){return t.label})).length<=0&&this.get("value")&&_.isArray(this.get("value"))&&0<this.get("value").length&&_.each(this.get("value"),function(t){e.push({label:t,val:t})}),e.splice(0,0,{label:"",val:""}),this.schema.value={title:"Value",type:s?"Select":"MultiSelect",options:e,modelKey:"value"}):0<t.get("items").length?((e=_.map(t.get("items"),function(t){return{label:t.Text,val:t.Value}})).splice(0,0,{label:"",val:""}),this.schema.value={title:"Value",type:s?"Select":"MultiSelect",options:e,modelKey:"value"}):s||(this.schema.value=_.extend({title:"Value"},a.RTTI.getByQTypeNum(0).editor))))},i.prototype.isValueValid=function(t){return!!_.includes(["is_not_blank","is_blank"],this.get("operator"))||!(_.isUndefined(t)||_.isNull(t)||""===t)},i.prototype.toJSON=function(){var t="histogram"===this.get("type")?_.pick(this.attributes,"propertyName","propertyType","value","value2","active","type"):_.pick(this.attributes,"propertyName","propertyType","operator","value","active","type","compareFields");return null===t.propertyType&&(t.propertyType=11),t},i.prototype.toIPC=function(){return"histogram"===this.get("type")?this.toIPCHistogram():this.toIPCNormal()},i.prototype.toIPCHistogram=function(){var t=new Uint8Array([102,5]),e=[],n=this.get("propertyName"),i=this.get("propertyType"),o=7===i?Math.ceil(this.get("value")):this.get("value"),r="greater_or_equal",i=7===i?Math.floor(this.get("value2")):this.get("value2"),s="less_or_equal";return this.get("active")&&n&&this.isValueValid(o)&&this.isValueValid(i)?(e.push(this.toIPCNormal(n,r,o)),e.push(this.toIPCNormal(n,s,i)),a.ipc.List.toIPC([t].concat(e))):null},i.prototype.toIPCNormal=function(t,e,n){var i=this,o=(void 0===e&&(e=null),void 0===n&&(n=null),t=(t=void 0===t?null:t)||this.get("propertyName"),e=e||this.get("operator"),n=this.replaceBindings(n||this.get("value")),-this.get("propertyType")||10);return this.get("active")&&t&&e&&this.isValueValid(n)?(t=a.ipc.Util.getType(o),n=this.get("compareFields")&&n===this.get("value")?a.ipc.Symbol.toIPC(n):"in"===e||"not_in"===e?(_.isArray(n)||(n=null===n?[]:[n]),t.listToIPC(_.map(n,function(t){return i.typeCast(t)}))):(-1===o&&_.isString(n)&&(n="true"===n),t.toIPC(a.ipc.fromString(t,n))),a.ipc.Dict.toIPC(["src","comparison","value","dataType","compareFields"],a.ipc.List.toIPC(_.map([this.get("propertyName"),e],function(t){return a.ipc.Symbol.toIPC(t)}).concat([n,a.ipc.Short.toIPC(o),a.ipc.Boolean.toIPC(this.get("compareFields"))])))):null},i.prototype.toKDB=function(){var t,e;return this.get("active")&&this.get("propertyName")&&this.get("operator")&&this.isValueValid(this.get("value"))?(e="in"===this.get("operator")||"not_in"===this.get("operator")?(t=a.RTTI.getByQTypeNum(0),e=this.get("value"),t.toKDBInput(e)):(t=a.RTTI.getByQTypeNum(this.get("propertyType")||11)).toKDBInput(this.get("value")),"(`src`comparison`value!(`"+this.get("propertyName")+";`"+this.get("operator")+";"+e+"))"):null},i.prototype.typeCast=function(t){switch(this.get("propertyType")){case 4:case 5:case 6:case 7:case 8:case 9:if(!_.isNaN(Number(t)))return Number(t)}return null!==t?""+t:""},i.prototype.validate=function(t,e){var n,t=isNaN(t)||isNaN(e)?(n=p(t),p(e)):(n=new Number(t),new Number(e));return t<=n},i.VSRx=/^<%[^<>%]*%>$/i,t.RuleModel=i}(I=I||{}),function(i){var o,r;function s(e){var n,t=r.call(this,e)||this,i=t.get("children");return i&&!_.isArray(i)||(n=new m.Collection,_.each(i||[],function(t){_.extend(t,{appModel:e.appModel}),t=new(t.hasOwnProperty("children")?s:o.RuleModel)(t),n.add(t)}),t.set("children",n)),0<t.get("children").length&&t.set("active",!0,{silent:!0}),t.listenTo(t.get("children"),"add remove reset change",function(){0<t.get("children").filter(function(t){return t.get("active")}).length?t.set("active",!0):t.set("active",!1),t.trigger("change")}),t}o=i.DataFilter||(i.DataFilter={}),r=m.Model,l(s,r),s.prototype.defaults=function(){return{children:new m.Collection,operator:"AND",active:!1}},s.prototype.isNull=function(){return _.every(this.get("children").filter(function(t){return t.get("active")}),function(t){return t instanceof s?t.isNull():_.isNull(t.toIPC())})},s.prototype.toJSON=function(){return{operator:this.get("operator"),children:this.get("children").toJSON()}},s.prototype.toIPC=function(){var e,n=new Array,t=this.get("children").filter(function(t){return t.get("active")}),t=(0<t.length&&_.each(t,function(t){(e=t instanceof s&&t.isNull()?null:t.toIPC())&&n.push(e)}),new Uint8Array([102,"AND"===this.get("operator")?5:6]));return i.ipc.List.toIPC([t].concat(n))},s.prototype.toKDB=function(){var e,t="("+this.get("operator")+";",n=[];return 0<this.get("children").length?(this.get("children").each(function(t){(e=t.toKDB())&&n.push(e)}),n.length<=0?null:(t+=n.join(";"))+")"):null},o.GroupModel=s}(I=I||{}),function(e){var n,t;function i(){return null!==t&&t.apply(this,arguments)||this}n=e.DataFilter||(e.DataFilter={}),t=m.View,l(i,t),i.generateIpcHexMessage=function(t){t=new n.GroupModel(_.extend({appModel:new m.DeepModel({"data.items":new m.Collection})},t));return e.ipc.Util.toHexString(e.ipc.Util.toMessage(t.toIPC()))},n.App=i}(I=I||{}),function(t){function s(t){this.id=t.id,this.group=t.group,t.meta&&(this.meta=t.meta),"result"!==this.group&&(this.data=t.data||{})}s.getBindingKeysFromArray=function(t,e){return t.concat(_.filter(e,function(t){return _.isString(t)&&s.VSRx.exec(t)}).map(function(t){return t.substring(2,t.length-2)}))},s.getActiveBindingKeys=function(t){return[]},s.replaceAllBindings=function(t,e){void 0===e&&(e="value"),_.each(t,function(t){!t[e]&&t.children?s.replaceAllBindings(t.children):t[e]="string"==typeof t[e]&&s.VSRx.test(t[e])?s.replaceBindings(t[e]):t[e]})},s.replaceBindings=function(t){var e,t=t.substring(2,t.length-2);return s.viewModel?(e=s.viewModel.getByPath(t))&&e.get("value"):s.bindings[t]},s.replaceKeys=function(t){var o=this,r=!1;_.each(t,function(t,e,n){var i;s.VSRx.exec(e)&&(i=e.replace(s.VSRx,s.replaceBindings.bind(o)),r=!0),r&&(delete n[e],n[i||e]=t)})},s.prototype.toIPC=function(){return be.ipc.Dict.toIPC(["type","data"],be.ipc.List.toIPC([be.ipc.Symbol.toIPC(this.group),t.App.groupToClass[this.group].dataToIPC(this.data)]))},s.bindings={},s.VSRx=/^<%[^<>%]*%>$/i,t.GraphNode=s}((be=I=I||{}).QueryBuilder||(be.QueryBuilder={})),function(i){var e,t;function o(){return null!==t&&t.apply(this,arguments)||this}e=i.QueryBuilder||(i.QueryBuilder={}),t=e.GraphNode,l(o,t),o.partitionParameterToIPC=function(t,e){return t instanceof Array?i.ipc.List.toIPC(t.map(function(t){return e.toIPC(i.ipc.fromString(e,""+t))})):e.toIPC(i.ipc.fromString(e,""+t))},o.dataToIPC=function(t){var e,n;return(t=o.processBindings(t)).name&&t.params?i.ipc.List.toIPC([i.ipc.Symbol.toIPC(t.name)].concat(o.recursiveToIPC(t.params))):t.name&&t.partition?(n=i.RTTI.getByName(t.partition.type).num,e=i.ipc.Util.getType("-"+n),n="equals"===t.partition.operator?8:"in"===t.partition.operator?23:24,i.ipc.Dict.toIPC(["table","operator","type","values"],i.ipc.List.toIPC([i.ipc.Symbol.toIPC(t.partition.name),new Uint8Array([102,n]),i.ipc.Symbol.toIPC("long"===t.partition.type?"year":t.partition.type),1<t.partition.parameters.length?i.ipc.List.toIPC(t.partition.parameters.map(function(t){return o.partitionParameterToIPC(t.value,e)})):o.partitionParameterToIPC(t.partition.parameters[0].value,e)]))):i.ipc.QString.toIPC(t)},o.processBindings=function(t){return(t=_.cloneDeep(t))&&t.params?o.replaceAllBindings(t.params):t&&t.partition&&o.replaceAllBindings(t.partition.parameters),t},o.getActiveBindingKeys=function(t){return t.params?t.params.filter(function(t){return!!_.isString(t.value)&&e.GraphNode.VSRx.exec(t.value)}).map(function(t){return t.value.substring(2,t.value.length-2)}):[]},o.recursiveToIPC=function(t){return _.flatten(_.map(t,function(t){var e=i.RTTI.getByName("list"===t.type?"List":t.type),n=e?e.num:11;return 98===n?o.recursiveToIPC(t.value):(7===n&&""===t.value&&(t.value="0"),e=i.ipc.Util.getType(0<n?"-"+n:""+n)||i.ipc.Util.getType("-11"),0===n&&t.value instanceof Array?e.toIPC(t.value.map(function(t){return i.ipc.Symbol.toIPC(t)})):e.toIPC(i.ipc.fromString(e,t.value)))}))},e.DataNode=o}(I=I||{}),function(e){var t,n;function i(){return null!==n&&n.apply(this,arguments)||this}t=e.QueryBuilder||(e.QueryBuilder={}),n=t.GraphNode,l(i,n),i.dataToIPC=function(t){return t=i.processBindings(t),e.ipc.Dict.toIPC(["select","where","distinct"],e.ipc.List.toIPC([e.ipc.Dict.toIPC(_.keys(t.select),e.ipc.Symbol.listToIPC(_.values(t.select))),e.ipc.Util.fromHexString(e.DataFilter.App.generateIpcHexMessage(t.where).slice(16)),e.ipc.Boolean.toIPC(t.distinct)]))},i.getActiveBindingKeys=function(t){var e=[];return _.each(t.where.children,function(t){return e=i.getBindingKeysFromArray(e,_.keys(t))}),i.getBindingKeysFromArray(e,_.keys(t.select))},i.processBindings=function(t){return t=_.cloneDeep(t),this.replaceAllBindings(t.where.children),this.replaceKeys(t.select),t},i.operatorMap={AND:" and ",OR:" or ",equal:"=",in:" in ",like:" like ",greater_or_equal:">=",less:"<",less_or_equal:"<=",greater:">",is_blank:" is blank",not_equal:"!=",not_in:" not in ",not_like:" not like ",is_not_blank:" is not blank"},t.FilterNode=i}(I=I||{}),function(e){var n,t;function i(){return null!==t&&t.apply(this,arguments)||this}n=e.QueryBuilder||(e.QueryBuilder={}),t=n.GraphNode,l(i,t),i.dataToIPC=function(t){return t=i.processBindings(t),e.ipc.Dict.toIPC(["groupBy","agg"],e.ipc.List.toIPC([e.ipc.Dict.toIPC(_.keys(t.groupBy),e.ipc.List.toIPC(_.values(t.groupBy).map(function(t){return _.isString(t)?e.ipc.Symbol.toIPC(t):e.ipc.Dict.toIPC(_.keys(t),e.ipc.Symbol.listToIPC(_.values(t)))}))),_.isEmpty(t.agg)?e.ipc.List.toIPC([]):e.ipc.Dict.toIPC(_.keys(t.agg),e.ipc.List.toIPC(_.map(_.values(t.agg),function(t){return e.ipc.Symbol.listToIPC(t.map(function(t){return String(t)}))})))]))},i.getActiveBindingKeys=function(t){return i.getBindingKeysFromArray([],_.union(_.keys(t.agg),_.keys(t.groupBy)))},i.processBindings=function(t){return t=_.cloneDeep(t),n.GraphNode.replaceKeys(t.agg),n.GraphNode.replaceKeys(t.groupBy),t},n.GroupByNode=i}(I=I||{}),function(e){var t,n;function i(t){t=n.call(this,t)||this;return _.isEmpty(t.data)&&(t.data={fn:"lj",swap:!1,left:[],right:[]}),t}t=e.QueryBuilder||(e.QueryBuilder={}),n=t.GraphNode,l(i,n),i.dataToIPC=function(t){return t?e.ipc.Dict.toIPC(["fn","swap","left","right"],e.ipc.List.toIPC([e.ipc.Symbol.toIPC(t.fn),e.ipc.Boolean.toIPC(t.swap),e.ipc.List.toIPC(_.map(t.left,function(t){return e.ipc.Symbol.toIPC(String(t))})),e.ipc.List.toIPC(_.map(t.right,function(t){return e.ipc.Symbol.toIPC(String(t))}))])):e.ipc.Int.toIPC(null)},t.JoinNode=i}(I=I||{}),function(t){var e,n;function i(){return null!==n&&n.apply(this,arguments)||this}e=t.QueryBuilder||(t.QueryBuilder={}),n=e.GraphNode,l(i,n),i.dataToIPC=function(){return t.ipc.Int.toIPC(null)},e.ResultNode=i}(I=I||{}),function(n){var e,t;function i(){return null!==t&&t.apply(this,arguments)||this}e=n.QueryBuilder||(n.QueryBuilder={}),t=e.GraphNode,l(i,t),i.dataToIPC=function(t){return t=i.processBindings(t),n.ipc.Dict.toIPC(["filter","update"],n.ipc.List.toIPC([n.ipc.Util.fromHexString(n.DataFilter.App.generateIpcHexMessage(t.filter).slice(16)),n.ipc.Dict.toIPC(_.map(t.update,"column"),n.ipc.List.toIPC(_.map(t.update,function(t){var e=n.ipc.Util.getType(t.propertyType),e=e.toIPC(n.ipc.fromString(e,t.val));return-11===t.propertyType?n.ipc.List.toIPC([e]):e})))]))},i.getActiveBindingKeys=function(t){var e=[];return _.each(t.filter.children,function(t){return e=i.getBindingKeysFromArray(e,_.keys(t))}),_.each(t.update,function(t){return e=i.getBindingKeysFromArray(e,_.values(t))}),e},i.processBindings=function(t){return t=_.cloneDeep(t),e.GraphNode.replaceAllBindings(t.filter.children),e.GraphNode.replaceAllBindings(t.update,"val"),t},e.UpdateNode=i}(I=I||{}),function(u){var e,n;function s(){var t=null!==n&&n.apply(this,arguments)||this;return t.docDataModel=null,t.bindingParams=[],t}e=u.QueryBuilder||(u.QueryBuilder={}),n=m.View,l(s,n),s.calculateReverseEdges=function(t){t=_.reduce(t,function(e,t,n){return _.each(t,function(t){void 0===e[t]?e[t]=[n]:e[t].push(n)}),e},{});return _.fromPairs(_.map(t,function(t,e){return[e,_.sortBy(t)]}))},s.createNode=function(t){switch(t.group){case"data":case"function":case"stream":return new e.DataNode(t);case"filter":return new e.FilterNode(t);case"groupBy":return new e.GroupByNode(t);case"join":return new e.JoinNode(t);case"update":return new e.UpdateNode(t);case"result":return new e.ResultNode(t);default:throw"Invalid node "+t}},s.graphToIPC=function(e,n,i){var o=this,r={},s={},a=this.calculateReverseEdges(n),l=function(t){_.extend(r,_.pick(e,t)),t!==i&&_.extend(s,_.pick(n,t)),_.each(a[t],function(t){l(t)})},t=(l(i||"result"),e=r,n=s,u.ipc.Dict.toIPC(["nodes","edges"],u.ipc.List.toIPC([u.ipc.Dict.toIPC(_.keys(e),u.ipc.List.toIPC(_.values(e).map(function(t){return o.createNode(t).toIPC()}))),u.ipc.Dict.toIPC(_.keys(a),u.ipc.List.toIPC(_.values(a).map(function(t){return u.ipc.List.toIPC(_.sortBy(t).map(function(t){return u.ipc.Symbol.toIPC(t)}))})))])));return u.ipc.Util.toHexString(u.ipc.Util.toMessage(t))},s.prototype.getIPC=function(t,e,n){t=JSON.parse(t);return this.docDataModel=n,t=this.replaceBindingsInGraph(t),s.graphToIPC(t.nodes,t.edges,e)},s.prototype.replaceBindings=function(t){var e=t.substring(2,t.length-2),e=this.docDataModel.getViewState().getByPath(e);return this.bindingParams.push({value:t}),e&&e.get("value")},s.prototype.replaceBindingsInGraph=function(t){var n=this;return this.bindingParams=[],_.values(t.nodes).forEach(function(e){[{type:"params",value:"value",children:null},{type:"filter",value:"value",children:"children"},{type:"where",value:"value",children:"children"},{type:"update",value:"val",children:null}].forEach(function(t){return e.data&&e.data[t.type]&&n.replaceAllBindings(e.data[t.type],t.value,t.children)}),["select","agg","groupBy"].forEach(function(t){return e.data&&e.data[t]&&n.replaceKeys(e.data[t])})}),this.docDataModel.set("_builderParams",this.bindingParams),t},s.prototype.replaceAllBindings=function(t,e,n){var i=this;void 0===e&&(e="value"),void 0===n&&(n=""),_.isEmpty(n)||(t=t[n]),_.each(t,function(t){!t[e]&&t.children?i.replaceAllBindings(t.children):void 0!==t[e]&&(t[e]="string"==typeof t[e]&&s.VSRx.test(t[e])?i.replaceBindings(t[e]):t[e])})},s.prototype.replaceKeys=function(t){var o=this,r=!1;_.each(t,function(t,e,n){var i;s.VSRx.exec(e)&&(i=e.replace(s.VSRx,o.replaceBindings.bind(o)),r=!0),r&&(delete n[e],n[i||e]=t)})},s.groupToClass={data:e.DataNode,function:e.DataNode,stream:e.DataNode,filter:e.FilterNode,update:e.UpdateNode,groupBy:e.GroupByNode,join:e.JoinNode,result:e.ResultNode},s.VSRx=/^<%[^<>%]*%>$/i,e.App=s}(I=I||{}),v=I=I||{},we=m.Model,l(C,we),C.convertDeltaClientColumnSpecToMeta=function(n){return(n.columns||[]).map(function(t,e){return{id:t,index:e,kdbType:n.meta[t]}})},C.convertMetaToDeltaClientColumnSpec=function(t){return{columns:_.map(t,function(t){return t.id}),meta:_.fromPairs(_.map(t,function(t){return[t.id,t.kdbType]}))}},C.prototype.apply=function(){var n=this,i=(this.performance.trigger("apply"),!1);if(this.has("error")||this.set("error",null,{silent:!0}),"pivot"===this.get("_dataType")&&this.set({_dataType:"query",_pivotType:"server"},{silent:!0}),this.stop(),this.reset(),this.get("_pivotType"))this.applyPivot();else switch(this.get("_dataType")){case"query":this.applyQuery();break;case"analytic":case"builder":case"streaming":this.applyAnalytic();break;case"copy":this.applyCopy();break;case"virtual":this.applyVirtual(),i=!0;break;case"sql":this.applyQuery()}this.forceInternalReset=!0,i&&this.performance&&this.performance.trigger("serverStart"),this.updateVirtualSubscriptions(),i&&this.performance&&this.performance.trigger("serverEnd"),this.dataMapper=new v.DataMapper({mappings:this.get("_mappings"),setMappings:function(t){n.set("_mappings",t)},subscribe:function(t,e){return n.subscribe(t,e,!i)},unsubscribe:function(t){return n.unsubscribe(t)},viewState:this.viewState}),this.dataMapper.initialize()},C.prototype.applyCopy=function(){var t=this.get("_subscriptionKey")||v.DataSet.DEFAULT_ROW_INDEX;this.dataSet=new v.DataSet({idAttribute:t,collectionFunc:m.Collection.extend({model:m.Model.extend({idAttribute:t})}),agent:this.agent,maxRows:this.get("_maxRows"),primaryKey:t}),this.unset("error"),this.unset("queryStatus"),this.updateParameters(),this.isDirty=!1,this.execute=_.noop.bind(this)},C.prototype.applyAnalytic=function(){function t(t,e){o.onExecuteSubscriptionSuccess(t,o.get("_forceReset"),e)}function e(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];o.onError(o,o.attributes,t,"Error",e)}var n,i,o=this,r=this.get("_subscriptionKey")||v.DataSet.DEFAULT_ROW_INDEX,s=this.applyViewStateAttributes();this.dataSet=new v.DataSet({idAttribute:r,collectionFunc:m.Collection.extend({model:m.Model.extend({idAttribute:r})}),agent:this.agent,maxRows:this.get("_maxRows"),primaryKey:r}),this.dataSet2=new v.DataSet2({idAttribute:r,agent:this.agent,maxRows:this.get("_maxRows"),primaryKey:r}),this.unset("error"),this.unset("queryStatus"),this.updateParameters(!0),"subscription"===this.get("_subscriptionType")?(i=this.formatValue(s._subscriptionInterval,"_subscriptionInterval"),this.execute=this.wrapWithErrorHandler(function(){o.onExecuteBegin(),o.get("_serverPaging")&&(n={type:o.getPagingType(),num:o.get("_pagingNum")||0,size:o.get("_pageSize")||C.DEFAULT_PAGE_SIZE,sorting:o.get("_pageSort")||{}}),o.runWithConnectionCheck(e,function(){o.updateBuilder(function(){v.DeltaClientLib.startManagedAnalytic2(o.get("_selectedAnalytic"),o.get("_connection"),o.bindViewStateToKdbParams(o.get("_analyticParams")),t,e,i,o.get("_maxRows")||C.DEFAULT_MAX_ROWS,o.performance)},e)})},this,this.attributes)):"streaming"===this.get("_subscriptionType")?this.execute=this.wrapWithErrorHandler(function(){o.updateBuilder(function(){o.onExecuteBegin(),o.runWithConnectionCheck(e,function(){v.DeltaClientLib.startStreamingAnalytic2(o.get("_selectedAnalytic"),o.get("_connection"),o.bindViewStateToKdbParams(o.get("_analyticParams")),t,e,o.performance)})},e)},this,this.attributes):this.execute=this.wrapWithErrorHandler(function(){o.updateBuilder(function(){o.onExecuteBegin(),o.get("_serverPaging")&&(n={type:o.getPagingType(),num:o.get("_pagingNum")||0,size:o.get("_pageSize")||C.DEFAULT_PAGE_SIZE,sorting:o.get("_pageSort")||{}}),o.runWithConnectionCheck(e,function(){v.DeltaClientLib.runAnalytic2(o.get("_selectedAnalytic"),o.get("_connection"),o.bindViewStateToKdbParams(o.get("_analyticParams")),t,e,o.get("_maxRows")||C.DEFAULT_MAX_ROWS,n,o.performance)})},e)},this,this.attributes)},C.prototype.updateBuilder=function(t,e){var n,i;"builder"===this.get("_dataType")&&(n="streaming"===this.get("_subscriptionType"),i=(new v.QueryBuilder.App).getIPC(this.get("_graphJSON"),this.get("_selectedNode"),this),n?(this.set("_selectedAnalytic",i),this.set("_analyticParams",[],{silent:!0})):(this.set("_selectedAnalytic",".queryBuilder.processGraph2"),this.set("_analyticParams",[{id:"graph",name:"graph",index:0,type:n?"symbol":"string",value:i}],{silent:!0}))),t()},C.prototype.runWithConnectionCheck=function(t,e){var n=this.get("_connection");!this.get("_ignoreNullConnectionCheck")&&(null==n||"DC"===n)?t({message:"Invalid connection specified"}):e()},C.prototype.applyPivot=function(){var r,s=this,a=this.get("_breakdownCols"),l={dataSource:this.get("_dataSource"),connection:this.get("_connection"),pivotSource:"query",queryString:this.get("_queryString"),queryParams:this.get("_queryParams"),breakdownCols:this.get("_breakdownCols"),aggFn:this.get("_aggFn"),ordering:this.get("_ordering"),maxRows:this.get("_maxRows"),subscriptionType:this.get("_subscriptionType"),subscriptionInterval:this.get("_subscriptionInterval"),columnLabel:this.get("_columnLabel")},n=this.applyViewStateAttributes();_.each(n,function(t,e){"_subscriptionInterval"===e?n[e]=s.formatValue(t,"_subscriptionInterval"):_.isString(t)&&(n[e]=t.trim(),n[e]=t.split(",")),l[e.replace("_","")]=t}),a=l.breakdownCols,r=m.Model.extend({idAttribute:_.last(a),getRoot:function(){return s}}),_.each(a,function(t,e){var n={},i=a[a.length-e-1],o=e===a.length-1?"id":a[a.length-e-2];_.extend(n,l,{dimensions:a.slice(0,a.length-e),wheres:a.slice(0,a.length-e-1),id:o}),r=s.generatePivotModel(o,i,r,n)}),this.unset("error"),this.unset("queryStatus"),this.updateParameters(),_.extend(this,{dataSet:new v.DataSet({idAttribute:r.prototype.childId,collectionFunc:m.Collection.extend({model:r.prototype.childModelType||r}),agent:this.agent,maxRows:l.maxRows,primaryKey:r.prototype.childId}),dataSet2:new v.DataSet2({idAttribute:r.prototype.childId,agent:this.agent,maxRows:l.maxRows,primaryKey:r.prototype.childId}),execute:r.prototype.execute||_.noop.bind(this),exportPivotData:r.prototype.exportPivotData,staticIdAttribute:r.staticIdAttribute})},C.prototype.applyQuery=function(){function n(t,e){r.onExecuteSubscriptionSuccess(t,r.get("_forceReset"),e)}function i(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];r.onError(r,r.attributes,t,"Error",e)}var o,r=this,t=this.get("_subscriptionKey")||v.DataSet.DEFAULT_ROW_INDEX,e=this.applyViewStateAttributes();this.dataSet=new v.DataSet({idAttribute:t,collectionFunc:m.Collection.extend({model:m.Model.extend({idAttribute:t})}),agent:this.agent,lazyLoading:this.get("_lazyLoading"),maxRows:this.get("_maxRows"),primaryKey:t}),this.dataSet2=new v.DataSet2({idAttribute:t,agent:this.agent,lazyLoading:this.get("_lazyLoading"),maxRows:this.get("_maxRows"),primaryKey:t}),this.unset("error"),this.unset("queryStatus"),this.updateParameters(),"subscription"===this.get("_subscriptionType")?(o=this.formatValue(e._subscriptionInterval,"_subscriptionInterval"),this.execute=this.wrapWithErrorHandler(function(){var t=null,e=(r.onExecuteBegin(),r.replaceViewStateParams(r.get("_queryString")));r.get("_serverPaging")&&(t={type:r.getPagingType(),num:r.get("_pagingNum")||0,size:r.get("_pageSize")||C.DEFAULT_PAGE_SIZE,sorting:r.get("_pageSort")||{}}),r.runWithConnectionCheck(i,function(){v.DeltaClientLib.startManagedQuery2(r.get("_connection"),e,r.bindViewStateToKdbParams(r.get("_queryParams")),n,i,o,r.get("_maxRows")||C.DEFAULT_MAX_ROWS,t,r.performance)})},this,this.attributes)):this.execute=this.wrapWithErrorHandler(function(){var t=null,e=(r.onExecuteBegin(),r.replaceViewStateParams(r.get("_queryString")));r.get("_serverPaging")&&(t={type:r.getPagingType(),num:r.get("_pagingNum")||0,size:r.get("_pageSize")||C.DEFAULT_PAGE_SIZE,sorting:r.get("_pageSort")||{}}),r.runWithConnectionCheck(i,function(){v.DeltaClientLib.getQueryData2(r.get("_dataSource"),r.get("_connection"),e,r.bindViewStateToKdbParams(r.get("_queryParams")),n,i,r.get("_maxRows")||C.DEFAULT_MAX_ROWS,t,r.performance)})},this,this.attributes)},C.prototype.applyVirtual=function(){function t(t,e){n.onExecuteSuccess(t,n.get("_forceReset"),e)}var n=this,e=this.get("_subscriptionKey")||v.DataSet.DEFAULT_ROW_INDEX;this.dataSet=new v.DataSet({idAttribute:e,collectionFunc:m.Collection.extend({model:m.Model.extend({idAttribute:e})}),agent:this.agent,maxRows:9007199254740991,primaryKey:e}),this.unset("error"),this.unset("queryStatus"),this.updateParameters(),this.execute=this.wrapWithErrorHandler(function(){this.onExecuteBegin(),this.updateVirtualSubscriptions(),this.executeVirtualQuery(this.get("_virtualQueryString"),this.get("_virtualParams"),t)},this,this.attributes)},C.prototype.applyParameterChange=function(){var t,e;this.paramChanged&&this.paramChanged.length&&(t=!!_.find(this.paramChanged,function(t){return"#forced"===t}),e=!!_.find(this.paramChanged,function(t){return t.runApply}),v.Log.Info(this.logPrefix()+"apply parameter change",this.paramChanged),this.paramChanged=[],this.agent.subscriberCount()?e?(this.apply(),this.start()):this.isPending?this.isDirty=!0:(this.isDirty=this.isDirty||t,this.performance.trigger("paramChange"),this.start()):t&&(e=this.onExecuteBeginCount,this.dataSet||this.apply(),e===this.onExecuteBeginCount&&this.execute()))},C.prototype.applyViewStateAttributes=function(){var e=this,r={},t=_.clone(C.VIEW_STATE_ATTRIBUTES[this.get("_dataType")])||{},s=_.clone(this.viewStateBindings);return this.get("_pivotType")&&_.extend(t,C.VIEW_STATE_ATTRIBUTES.pivot),_.each(t,function(n,i){var o=e.get(i),t=_.findKey(s,function(t,e){return e===i&&t.callback===n&&t.model===o});t?(s=_.omit(s,t),o=o.get("value")):o instanceof m.Model&&(e.listenTo(o,"change:value",e[n]),e.viewStateBindings[i]=new v.ViewStateBinding(n,o),o=o.get("value")),r[i]=o}),this.get("_pivotType")&&r[C.AGGREGATE_COLS_PROP]&&r[C.AGGREGATE_LABELS_PROP]&&r[C.AGGREGATE_COLS_PROP].length!==r[C.AGGREGATE_LABELS_PROP].length&&(v.Log.Warn(this.logPrefix()+"invalid aggregate labels length"),r[C.AGGREGATE_LABELS_PROP]=[]),_.each(s,function(t){e.stopListening(t.model,"change:value",t.callback)}),r},C.prototype.bindViewStateToKdbParams=function(t){var o,r,n,s=this,e=[];return $.extend(!0,e,t),e&&0<e.length&&e.forEach(function(i){var t,e;"string"==typeof i.value&&(n=i.value.match(C.PARAMETER_RX))&&(t=s.getViewState().getByPath($.trim(n[0].substring(2,n[0].length-2))))&&(void 0===(t=_.isFunction(t.get)?t.get("value"):t.value)&&(i.value=null),i.value=_.isObject(t)&&!_.isArray(t)?$.extend(!0,{},t):t),"dict"===i.type&&_.isObject(i.value)?_.keys(i.value).forEach(function(t){if(i.value[t]instanceof m.Model)i.value[t]={type:i.value[t].get("_type"),IsKdbParam:!0,isViewState:!0,name:i.value[t].path,value:i.value[t].get("value")};else if("object"==typeof i.value[t]){if(_.has(i.value[t],"_isKdbReady"))return;"string"==typeof i.value[t].value&&0===i.value[t].value.indexOf("<%")?(e=$.trim(i.value[t].value.substring(2,i.value[t].value.length-2)),(n=s.getViewState().getByPath(e))&&(i.value[t].type=n.get("_type"),i.value[t].value=n.get("value"))):"dict"===i.value[t].type&&(i.value[t]=s.bindViewStateToKdbParams([i.value[t]])[0])}else{var e,n;"string"==typeof i.value[t]&&(e=void 0,0===i.value[t].indexOf("<%")&&(e=$.trim(i.value[t].substring(2,i.value[t].length-2)),(n=s.getViewState().getByPath(e))&&(i.value[t]={type:n.get("_type"),IsKdbParam:!0,isViewState:!0,name:i.value[t],value:n.get("value")})))}o=i.value[t].type,(r=o?v.RTTI.getByName(o):null)&&r.toKDBInput&&(i.value[t].value=_.includes(C.TYPES_TO_PARSE,o)?r.toKDBInput(i.value[t].value):i.value[t].value,v.Log.Info(s.logPrefix()+"View State  Binding ["+i.name+"]",i.value[t].value))}):(o=i.type,(r=v.RTTI.getByName(o))&&("dict"!==r.name&&r.toKDBInput?(i.value=_.includes(C.TYPES_TO_PARSE,o)?r.toKDBInput(i.value):i.value,v.Log.Info(s.logPrefix()+"View State  Binding ["+i.name+"]",i.value)):"dict"===r.name&&(t=i.value.split(""),e={},t.forEach(function(t){t=t.split("");6===t.length&&(e[t[0]]={type:t[1],IsKdbParam:!0,isViewState:!0,name:t[0],value:t[2]})}),i.value=e)))}),e},C.prototype.clearVirtualSubscriptions=function(t){var n=this;_.each(t,function(t){var e=n.virtualSubscriptions[t];e&&(e instanceof C&&e.unsubscribe(t),delete n.virtualSubscriptions[t])})},C.prototype.clearVirtualSubscriptionsAll=function(){var t=_.keys(this.virtualSubscriptions);this.clearVirtualSubscriptions(t)},C.prototype.clone=function(){var t=new C(this.attributes,this.root,this.path,this.viewState,this.group);return t.isClone=!0,t},C.prototype.defaults=function(){var t={_pagingType:"NONE"};return t[C.AUTO_EXECUTE]=!0,t},C.prototype.destroy=function(){this.stop(),this.reset(),this.agent&&this.agent.unsubscribeAll(),m.Model.prototype.destroy.call(this)},C.prototype.determineMaterialChange=function(){this.changed&&!_.isEmpty(_.omit(this.changed,C.IMMATERIAL_ATTRIBUTES))&&this.trigger("materialChange")},C.prototype.doCommand=function(t,e){var n;if(0<t.length)return n=t.reverse().join("/"),this.getByPath(n).doCommand(t,e)},C.prototype.executeClientPivotQuery=function(n,t){var r=this,i={columns:[],meta:{},rows:[]};if(!n)return i;var s=this.getViewStateAttribute("_aggregateCols")||[],a=this.getViewStateAttribute("_aggregateFns")||[],l=this.getViewStateAttribute("_aggregateLabels")||[],o=this.getViewStateAttribute("_breakdownCols")||[],u=s.map(function(t){return v.Tools.getComparator(n.meta[t]||0,function(t){return t})}),l=_.map(s,function(t,e){return l[e]||t}),c=t&&t.wheres?t.wheres:[],c=_.filter(c,function(t,e){return t.comparator=v.Tools.getComparator(n.meta[t.columnName]||0,function(t){return t}),t.columnName===o[e]}),p=_.take(o,c.length+1),d=_.last(p),h=v.Tools.getComparator(n.meta[d]||0,function(t){return t[d]});return n.rows.forEach(function(o){for(var t,r,e=0;e<c.length;e++){var n=c[e];if(0!==n.comparator(n.columnValue,o[n.columnName]))break}e<c.length||(t=o[d],(t=v.Tools.binarySearch2(t,i.rows,h))<0?(r=_.pick(o,p),i.rows.splice(-t-1,0,r),l.forEach(function(t,e){"count"===a[e]?r[t]=0:_.includes(["max","min","sum"],a[e])?r[t]=null:r[t]=[]})):r=i.rows[t],s.forEach(function(t,e){var n=a[e],i=l[e];switch(n){case"count":r[i]+=1;break;case"max":null===o[t]||null!==r[i]&&-1!==u[e](r[i],o[t])||(r[i]=o[t]);break;case"min":null===o[t]||null!==r[i]&&1!==u[e](r[i],o[t])||(r[i]=o[t]);break;case"sum":null!==o[t]&&(r[i]+=Number(o[t]));break;default:r[i]=r[i]||[],r[i].push(o)}}))}),_.every(a,function(t){return _.includes(["count","max","min","sum"],t)})||i.rows.forEach(function(o){l.forEach(function(t,e){var n=o[t],i=a[e];if(_.isArray(n))switch(i){case"avg":n=_.map(n,function(t){return _.transform(t,function(t,e,n){return t[n]=Number(e)})}),o[t]=_.meanBy(n,s[e]);break;case"first":o[t]=_.first(n)[s[e]];break;case"last":o[t]=_.last(n)[s[e]];break;default:o[t]=r.executeUserJavascript(i,["data"],[n])}})}),_.each(p,function(t){i.columns.push(t),i.meta[t]=n.meta[t]||11}),_.each(s,function(t,e){i.columns.push(l[e]),i.meta[l[e]]=n.meta[t]||11}),i},C.prototype.executeUserJavascript=function(e,n,i){try{return new Function(n,e).apply({},i)}catch(t){n=/<anonymous>:(\d+):(\d+)/.exec(t.stack);if(n&&3===n.length)throw e=Number(n[1]),i=Number(n[2]),t.message+" ("+(e-2)+":"+i+")";throw t.message}},C.prototype.executeVirtualQuery=function(t,e,n){var o=this,t=C.VIRTUAL_QUERY_REGEX.exec(t),r=[],s=[],a=!1;if(!t)throw"Invalid function definition";_.each(e,function(t){switch(t.type){case"datasource":var e,n,i=o.path+"_"+t.value;o.get("isSourceDataDialog")&&(i+="#edit"),r.push(t.name),(i=o.virtualSubscriptions[i])?(e=i.get("_subscriptionKey")||v.DataSet.DEFAULT_ROW_INDEX,n=o.get("_subscriptionKey")||v.DataSet.DEFAULT_ROW_INDEX,a=a||n===v.DataSet.DEFAULT_ROW_INDEX&&(e===v.DataSet.DEFAULT_ROW_INDEX||"virtual"===i.get("_dataType")),s.push(_.extend(C.convertMetaToDeltaClientColumnSpec(i.dataSet?_.sortBy(i.dataSet.columns.map(function(t){return t.attributes}),"index"):[]),{rows:i.dataSet?i.dataSet.collection.models.map(function(t){return t.attributes}):[]}))):s.push(null);break;case"text":r.push(t.name),s.push(t.value);break;case"viewstate":r.push(t.name),(i=o.viewState.getByPath(t.value))?s.push(i.get("value")):s.push(null)}}),r.push("callback"),s.push(function(t){t.rows&&a&&(t.rows=t.rows.map(function(t){return Object.assign({},t)})),n(t)}),r.push("Tools"),s.push(v.Tools),t&&6===t.length&&(e=t[4],this.executeUserJavascript(e,r,s))},C.prototype.exportData=function(t,e,n){var i,o,r={},s="";n&&(n.exportName&&(s=n.exportName),n.exportParams&&(r=n.exportParams)),"analytic"===this.get("_dataType")?this.runWithConnectionCheck(e,function(){v.DeltaClientLib.exportAnalyticData(this.get("_selectedAnalytic"),this.get("_connection"),this.bindViewStateToKdbParams(this.get("_analyticParams")),s,r,t,e)}.bind(this)):"pivot"===this.get("_dataType")||this.get("_pivotType")?(i=this,n&&n.focus&&_.isString(n.focus)&&(o=n.focus.split(","),_.each(o,function(t){i.dataSet.collection.has(t)&&(i=i.dataSet.collection.get(t))})),i.exportPivotData(t,e,n)):"query"===this.get("_dataType")?this.runWithConnectionCheck(e,function(){v.DeltaClientLib.exportQueryData(this.get("_connection"),this.replaceViewStateParams(this.get("_queryString")),this.bindViewStateToKdbParams(this.get("_queryParams")),s,r,t,e)}.bind(this)):e("Export not currently supported for type "+this.get("_dataType"))},C.prototype.flatten=function(){return _.includes(["analytic","streaming","pivot","query","virtual","builder","sql"],this.get("_dataType"))?[this]:_.reduce(_.omit(this.attributes,"error"),function(t,e){return t.concat(e.flatten())},[])},C.prototype.flattenObject=function(t){var e={};if(_.keys(t).length){for(var n in t)if(t.hasOwnProperty(n))if("object"==typeof t[n]){var i,o=this.flattenObject(t[n]);for(i in o)o.hasOwnProperty(i)&&(e[n+"."+i]=o[i])}else e[n]=t[n];return e}return{0:t.toString()}},C.prototype.forceExecute=function(t,e){this.paramChanged.push("#forced"),e&&this.callbacks.push(e),this.debouncedParameterChange()},C.prototype.formatValue=function(t,e){return t="_subscriptionInterval"===e?1e3*Math.min(3600,Math.max(.5,Number(t||0))):t},C.prototype.toSQLString=function(t,e){var i=t.replace(/"/g,"'");return _.each(e,function(t){var e,n=t.type,n=n?v.RTTI.getByName(n):null;n&&n.toSQLInput&&(e=new RegExp("{{"+t.name+"}}","g"),i=i.replace(e,n.toSQLInput(t.value)))}),i},C.prototype.generatePivotModel=function(t,e,n,s){var a=this,l=(s.breakdownCols instanceof m.Model&&(s.breakdownCols=s.breakdownCols.get("value")),a.meta={},m.Model.extend({defaults:{_dataType:a.get("_dataType"),_pivotType:a.get("_pivotType"),_subscriptionType:a.get("_subscriptionType"),_subscriptionInterval:a.get("_subscriptionInterval")},idAttribute:t,childId:e,childModelType:n,initialize:function(){this.isDirty=!0,this.isPending=!1,this.legacyUpdates=[],this.agent=new v.Agent},apply:function(){this.dataSet=new v.DataSet({idAttribute:e,collectionFunc:m.Collection.extend({model:n}),agent:this.agent,maxRows:s.maxRows,primaryKey:e})},getRoot:function(){return a},getViewState:function(){return a.getViewState()},execute:function(e){function n(t){t?o(t):o(a.executeClientPivotQuery(a.clientPivotData,{wheres:s.wheres}),a.get("_forceReset"))}var i=this,t=!a.clientPivotData||a.isDirty||e&&e.intervalQuery,o=(this.wheres||(this.wheres=s.wheres),i.onExecuteSubscriptionSuccess.bind(i));i.onExecuteBegin();try{s.topX=null,s.ordering=null,s.queryParams=a.bindViewStateToKdbParams(a.get("_queryParams")),s.maxRows=a.get("_maxRows")||C.DEFAULT_MAX_ROWS,_.each(s.wheres,function(t,e){var t="string"==typeof t?t:t.columnName,n=a.meta[t];s.wheres[e]={columnName:t,columnType:n,columnOperator:"=",columnValue:i.get(t)}});function r(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];a.onError(l,s,t,"Error",e)}"client"===i.get("_pivotType")?t?(i.stop(),a.runWithConnectionCheck(r,function(){switch(a.get("_dataType")){case"query":var t=a.replaceViewStateParams(s.queryString);"subscription"===i.get("_subscriptionType")?v.DeltaClientLib.startManagedQuery(s.connection,t,a.bindViewStateToKdbParams(s.queryParams),function(t,e){t&&t.dataSet&&t.dataSet.rows?(a.clientPivotData=t.dataSet,n()):n(t)},r,1e3*s.subscriptionInterval,s.maxRows,null,i.performance):v.DeltaClientLib.getQueryData(s.dataSource,s.connection,t,a.bindViewStateToKdbParams(s.queryParams),function(t){a.clientPivotData=t,n()},r,s.maxRows,null,i.performance);break;case"analytic":case"streaming":"subscription"===i.get("_subscriptionType")?v.DeltaClientLib.startManagedAnalytic(a.get("_selectedAnalytic"),a.get("_connection"),a.bindViewStateToKdbParams(a.get("_analyticParams")),function(t,e){t&&t.rows?(a.clientPivotData=t,n()):n(t)},r,1e3*s.subscriptionInterval,s.maxRows,i.performance):v.DeltaClientLib.runAnalytic(a.get("_selectedAnalytic"),a.get("_connection"),a.bindViewStateToKdbParams(a.get("_analyticParams")),function(t){a.clientPivotData=t,n()},r,s.maxRows,null,i.performance);break;case"virtual":a.executeVirtualQuery(a.get("_virtualQueryString"),a.get("_virtualParams"),function(t){a.clientPivotData=t,n()});break;case"builder":"subscription"===i.get("_subscriptionType")?v.DeltaClientLib.startManagedQuery(s.connection,i.get("_analyticString"),i.get("_queryBuilderParams"),function(t,e){t&&t.dataSet&&t.dataSet.rows?(a.clientPivotData=t.dataSet,n()):n(t)},r,1e3*s.subscriptionInterval,s.maxRows,null,i.performance):v.DeltaClientLib.getQueryData(s.dataSource,s.connection,i.get("_analyticString"),i.get("_queryBuilderParams"),function(t){a.clientPivotData=t,n()},r,s.maxRows,null,i.performance)}})):n():("builder"===a.get("_dataType")&&(s.queryString=a.get("_analyticString"),s.queryParams=a.get("_queryBuilderParams")),a.runWithConnectionCheck(r,function(){v.DeltaClientLib.getPivotData(s,function(t,e){_.extend(a.meta,t.meta),"subscription"===a.get("_subscriptionType")?i.onExecuteSubscriptionSuccess(t,a.get("_forceReset"),e,a.meta):i.onExecuteSuccess(t,a.get("_forceReset"),e,a.meta)},r,i.performance)}))}catch(t){a.onError(l,s,t,"Error",e)}},exportPivotData:function(t,e,n){a.runWithConnectionCheck(e,function(){v.DeltaClientLib.exportPivotData($.extend({},s,n),t,e)})},clearVirtualSubscriptions:_.noop,clearVirtualSubscriptionsAll:_.noop,executeClientPivotQuery:a.executeClientPivotQuery,formatValue:a.formatValue,getViewStateAttribute:a.getViewStateAttribute,isPagingData:a.isPagingData,logPrefix:a.logPrefix,legacyFlush:a.legacyFlush,legacyUpdate:a.legacyUpdate,onComplete:a.onComplete,onExecuteSubscriptionSuccess:a.onExecuteSubscriptionSuccess,onExecuteBegin:a.onExecuteBegin,onExecuteSuccess:a.onExecuteSuccess,reset:a.reset,start:a.start,stop:a.stop,subscribe:a.subscribe,triggerCallbacks:_.noop,updateVirtualSubscriptions:_.noop,unsubscribe:a.unsubscribe},{staticIdAttribute:t}));return l},C.prototype.getByPath=function(t){var e;if(t)return t=_.filter(t.split("/"),function(t){return t&&0<t.length}),e=this,_.each(t,function(t){e=e&&e.get(t)}),e},C.prototype.getExecutionRate=function(){var t;return this.performance&&(t=this.performance.performance.apply)?6e4*this.dataExecuteSuccessCount/(Date.now()-t):0},C.prototype.getMappedViewStates=function(){var t=this.get("_mappings"),e=[];return t&&t.mappings&&_.each(t.mappings,function(t){e.push(t&&t._dashboardsType?this.viewState.getByPath(t.value):t)}.bind(this)),e},C.prototype.getMeta=function(e){var n=this,i=_.uniqueId("getMeta_");this.subscribe(i,{onData:function(t){e(t),_.defer(function(){return n.unsubscribe(i)})}})},C.prototype.getRoot=function(){return this},C.prototype.getTreeList=function(){var t=_.filter(this.attributes,function(t){return t instanceof C});return t.length?_.chain(t).map(function(t){return t.getTreeList()}).flatten().value():[this]},C.prototype.getViewState=function(){return this.viewState},C.prototype.getPagingType=function(){var t=C.DEFAULT_PAGING;return t=this.get("_serverPaging")?this.get("_forceReset")?"PAGENO_NOCACHE":this.get("_pagingType")&&"NONE"!==this.get("_pagingType")?this.get("_pagingType"):"PAGENO":t},C.prototype.getParameters=function(){var n,e,t,i=this,o=[];return this.get("_queryParams")?t=this.get("_queryParams"):this.get("_updateQueryParams")?t=this.get("_updateQueryParams"):this.get("_builderParams")?t=this.get("_builderParams"):this.get("_analyticParams")?t=this.get("_analyticParams"):this.get("_virtualParams")&&(t=_.filter(this.get("_virtualParams"),{type:"viewstate"}).map(function(t){return{value:"<%"+t.value+"%>"}})),t&&_.each(t,function(t){"string"==typeof t.value&&(e=t.value.match(C.PARAMETER_RX))&&(n={path:e[0].substring(2,e[0].length-2)},(e=i.viewState.getByPath(e[0].substring(2,e[0].length-2)))&&"dict"===e.get("_type")&&(n.dictParameters=[],_.each(e.get("value"),function(t,e){t instanceof m.Model?n.dictParameters.push({path:t.path,key:e}):_.isObject(t)?t.name?n.dictParameters.push({path:t.name,key:e}):t.type&&n.dictParameters.push({raw:!0,key:e,type:t.type,value:t.value}):_.isString(t)?t.match(C.PARAMETER_RX)?n.dictParameters.push({path:t.substring(2,t.length-2)}):n.dictParameters.push({path:t}):t&&n.dictParameters.push({path:t.name||t})})),o.push(n))}),o},C.prototype.getViewStateAttribute=function(t){t=this.get(t);return t instanceof m.Model?t.get("value"):t},C.prototype.getViewStateDict=function(){var i={},e=[],n=_.union(_.filter(this.get("_analyticParams"),function(t){return"dict"===t.type&&e.push(t),t.isViewState}),_.filter(this.get("_queryParams"),function(t){return"dict"===t.type&&e.push(t),t.isViewState}),_.filter(this.get("_virtualParams"),function(t){return"dict"===t.type&&e.push(t),t.isVirtual=!0,"viewstate"===t.type}));return _.each(e,function(t){_.each(t.value,function(t){t.isViewState&&n.push(t)})}),n&&0<n.length&&_.each(n,_.bind(function(n){var t=this.parseViewState(n.value,n.isVirtual);t&&(i[n.name]=t),"dict"===n.type&&_.isObject(n.value)&&_.each(n.value,function(t,e){t=this.parseViewState(t);t&&(i[n.name+"."+e]=t)}.bind(this))},this)),_.each(_.reduce(_.values(C.VIEW_STATE_ATTRIBUTES),function(t,e){return t.concat(_.keys(e))},[]),_.bind(function(t){var e=this.get(t);e instanceof m.Model&&(i[t]=e)},this)),i},C.prototype.isMapping=function(){return this.get("_mappings")&&!_.isEmpty(this.get("_mappings").mappings)},C.prototype.isPagingData=function(t){return t&&t.rows&&t.rows[0]&&"startRows"===t.rows[0].Property&&t.rows[3]},C.prototype.legacyFlush=function(){var t;this.legacyFlushTime=Date.now(),this.legacyFlushFrame=void 0,(this.deferredUpdate&&this.agent.subscriberLegacyCount()||this.get("_dataType").match(/virtual|copy/))&&(t=this.legacyUpdate(this.deferredUpdate),this.dataSet&&this.dataSet.flushUpdates(),this.deferredUpdate&&this.deferredUpdate.forceReset&&t.rows&&!t.rows.length||!this.dataSet||this.dataSet&&this.dataSet.isEmpty()?0===this.agent.subscriberRawCount()&&this.set("queryStatus",{type:"NoResults",options:{}}):this.unset("queryStatus"),0<this.consolidateCount?v.Log.Info(this.logPrefix()+"consolidated "+(this.consolidateCount+1)):v.Log.Info(this.logPrefix()+"deferred")),this.consolidateCount=0,this.deferredUpdate=void 0,this.durationMovingAverage=(2*this.durationMovingAverage+(Date.now()-this.legacyFlushTime))/3},C.prototype.legacyUpdate=function(t){var e=t.forceReset,n=t.table,i=t.pivotMeta,o=this.get("_breakdownCols"),i=(o instanceof m.Model&&(o=o.get("value")),i&&_.extend(i,n.meta),n.rows?n:n.toLegacy());return this.dataSet.onData({breakdownColumns:o,columns:C.convertDeltaClientColumnSpecToMeta(i),paging:_.omit(t.pagingMeta,"data")},i.rows,e,void 0,this.performance),i},C.prototype.logPrefix=function(){return"DataModel "+this.agent.subscriberCount()+" "+this.path+" "},C.prototype.objToString=function(e){var n=[];return _.each(_.keys(e),function(t){n.push(t+": "+e[t])}),n.join("\n")},C.prototype.onComplete=function(){this.isDirty&&!this.isPending&&(this.stop(),this.forceInternalReset=!0,this.start())},C.prototype.onError=function(t,e,n,i,o){n={error:_.isObject(n)?this.objToString(this.flattenObject(n)):n,type:i,options:$.extend({},e),args:void 0};this.triggerCallbacks(n),o&&(n.args=$.extend({},o)),this.set({error:n}),this.set({queryStatus:n}),this.isPending=!1,this.onComplete();try{this.dataSet&&this.dataSet.onData([],[],this.forceInternalReset,n),this.dataSet2&&this.dataSet2.onData([],{},this.forceInternalReset,n)}catch(t){}v.Log.Error(this.logPrefix()+"onError ",n),t&&t.trigger&&t.trigger("error",t,n)},C.prototype.onExecuteBegin=function(){this.isPending=!0,this.isDirty=!1,this.onExecuteBeginCount++,this.set({queryStatus:{type:"Loading"}}),v.Log.Info(this.logPrefix()+"execute begin")},C.prototype.onExecuteSuccess=function(e,t,n,i){var o,r={},s=this.get("_breakdownCols");if(s instanceof m.Model&&(s=s.get("value")),this.dataExecuteSuccessCount++,this.triggerCallbacks(),n&&n.byteLength){var a=["startRows","numRows","totalNumRows","data"];if(e&&99===e.qtype&&11===e.keys.qtype&&4===e.keys.offsets.length&&_.isEqual(a,_.times(4,function(t){return v.ipc.Parse.col(e.keys,new DataView(n)).toLegacy(t)}))){for(var l=v.ipc.Parse.col(e.values,new DataView(n)),u=0;u<3;u++)r[a[u]]=l.toLegacy(u);r.pagingType=this.getPagingType(),r.pageSize=this.get("_pageSize"),o=v.ipc.Parse.reshape(l.values[3],n),t=!0}else o=v.ipc.Parse.reshape(e.dataSet||e,n);i&&_.extend(i,o.meta),t=t||this.forceInternalReset,this.agent.subscriberRawCount()&&(this.unset("error"),this.dataSet2.onData({breakdownColumns:s,columns:C.convertDeltaClientColumnSpecToMeta(o),paging:_.omit(r,"data")},o.cols,t,void 0,this.performance),this.forceInternalReset=!1,!this.dataSet2||this.dataSet2&&this.dataSet2.isEmpty()?this.set("queryStatus",{type:"NoResults",options:{}}):this.unset("queryStatus"))}else this.isPagingData(e)?(_.each(e.rows,function(t){r[t.Property]=t.Value}),r.pagingType=this.getPagingType(),r.pageSize=this.get("_pageSize"),o=r.data||{},t=!0):o=e;(this.agent.subscriberLegacyCount()||this.get("_dataType").match(/virtual|copy/))&&(t=t||this.forceInternalReset,s=new v.LegacyUpdate(o,t,r,i),this.forceInternalReset=!1,this.deferredUpdate?(this.dataSet.background(),this.consolidateCount++,this.legacyUpdate(this.deferredUpdate),this.deferredUpdate=s):!this.dataSet.isBackground()&&(this.durationMovingAverage<=C.FAST_THRESHOLD||Date.now()-this.legacyFlushTime-this.durationMovingAverage>C.OLD_THRESHOLD)?(this.deferredUpdate=s,this.legacyFlush(),v.Log.Info(this.logPrefix()+" Express")):this.deferredUpdate=s,!this.legacyFlushFrame&&this.deferredUpdate&&(this.legacyFlushFrame=window.requestAnimationFrame(this.legacyFlush.bind(this)),this.deferredUpdate=s)),this.isPending=!1,this.unset("error"),v.Log.Info(this.logPrefix()+"execute success"),this.onComplete()},C.prototype.onExecuteSubscriptionSuccess=function(t,e,n,i){if("207"===t.class)return this.stop(),void(t.add?(this.subscriptionId=t.clientId+":"+t.subId,this.isPending=!1,v.Log.Info(this.logPrefix()+"sub started "+t.subId)):v.Log.Info(this.logPrefix()+"sub stopped "+t.subId));if("208"===t.class)return v.Log.Info(this.logPrefix()+"sub failed "+t.subId+": "+t.reason),void v.DeltaClientLib.removeSubscriptions(t.clientId+":"+t.subId);if("209"===t.class){if(this.subscriptionId!==t.clientId+":"+t.subId)return v.Log.Warn(this.logPrefix()+"sub stray persisting: "+t.clientId+":"+t.subId),void v.DeltaClientLib.removeSubscriptions(t.clientId+":"+t.subId)}else{if("210"===t.class)return;if("com.fd.business.querymanager.subscriptions.ManagedSubscription"===t.class||"com.fd.business.querymanager.subscriptions.StreamingSubscription"===t.class)return}this.onExecuteSuccess(t.dataSet||t,e,n,i)},C.prototype.onMaterialChange=function(){this.trigger("materialChange")},C.prototype.onModelChange=function(t,e){var t=_.keys(t.changed),n=_.intersection(t,C.PAGING_ATTRIBUTES);_.find(t,function(t){return 0===t.indexOf("_")})&&(this.determineMaterialChange(),_.some(t,function(t){return 0===t.indexOf("_")&&!_.includes(["_layout","_mappings"],t)})&&(this.isDirty=!0),_.includes(t,C.AUTO_EXECUTE)&&this.updateParameters(),n&&n.length&&(this.paramChanged=this.paramChanged.concat(n),this.stop(),this.isDirty=!0,this.forceInternalReset=!0,this.debouncedParameterChange()))},C.prototype.onParameterChange=function(t,e,n){n={runApply:!(!n||!n.runApply)||!!this.get("_pivotType"),modelPath:t.path,previous:t.previous("value"),new:e};this.paramChanged.push(n),v.Log.Info(this.logPrefix()+"parameter change",n),this.stop(),this.isDirty=!0,this.forceInternalReset=!0,this.get("_pagingType")!==C.DEFAULT_PAGING&&0!==this.get("_pagingNum")&&this.set("_pagingNum",0),this.debouncedParameterChange()},C.prototype.onPivotSettingChange=function(t,e){this.onParameterChange(t,e,{runApply:!0})},C.prototype.onQuerySettingChange=function(t,e,n){n=_.extend(!0,{runApply:!0},n),this.onParameterChange(t,e,n)},C.prototype.parseViewState=function(t,e){if("string"==typeof t){if(e)return this.getViewState().getByPath(t);e=t.match(C.PARAMETER_RX);return e?this.getViewState().getByPath($.trim(e[0].substring(2,e[0].length-2))):void 0}},C.prototype.postCommand=function(t,e){return this.root.postCommand(this,e)},C.prototype.removeSubscriptions=function(){this.stop(),this.group&&this.values().forEach(function(t){return t.removeSubscriptions()})},C.prototype.replaceViewStateParams=function(t){var i=this;return"string"==typeof t?t.replace(C.PARAMETER_RX,function(t,e){var n=i.getViewState().getByPath(e);return n?void 0===(n=n.get("value"))?null:n:(v.Log.Error(i.logPrefix()+"replace parameter: "+e+" not found"),"")}):t},C.prototype.reset=function(){this.dataMapper&&(this.dataMapper.cleanUp(),delete this.dataMapper),this.dataSet&&(this.dataSet.cleanUp(),delete this.dataSet),this.dataSet2&&(this.dataSet2.cleanUp(),delete this.dataSet2),this.deferredUpdate=void 0,this.isDirty=!0,this.isPending=!1,this.dataExecuteSuccessCount=0,this.onExecuteBeginCount=0},C.prototype.start=function(){var t,e,n=this;0===this.agent.subscriberCount()?v.Log.Info(this.logPrefix()+"start: no subscriptions"):(t=this.formatValue(this.getViewStateAttribute("_subscriptionInterval"),"_subscriptionInterval"),"polling"===(e=this.get("_subscriptionType"))?this.pollingEvent?v.Log.Info(this.logPrefix()+"start: already polling!"):(v.Log.Info(this.logPrefix()+"start: polling now..."),this.pollingEvent=setInterval(function(){n.isPending||(v.Log.Info(n.logPrefix()+"poll"),n.execute({intervalQuery:!0}))},t),this.execute()):"subscription"===e||"streaming"===e?this.subscriptionId||this.execute():this.isDirty&&!this.isPending&&this.execute())},C.prototype.stop=function(){this.pollingEvent&&(clearInterval(this.pollingEvent),this.pollingEvent=null),this.subscriptionId&&(v.DeltaClientLib.removeSubscriptions(this.subscriptionId),v.Log.Info(this.logPrefix()+" unsubcribed "+this.subscriptionId),this.subscriptionId=null)},C.prototype.subscribe=function(t,e,n,i){this.agent.subscribe(t,e,n)?(v.Log.Info(this.logPrefix()+"subscribed "+t),i?this.set(i,{silent:!0}):this.has("_lazyLoading")&&(this.unset("_lazyLoading"),this.dataSet&&(this.dataSet.lazyLoading=!1),this.set({_pagingType:"NONE",_pageNum:0},{silent:!0})),this.dataSet?(n||this.dataSet.collection.isEmpty()&&this.dataSet.columns.isEmpty()?this.dataSet2&&!this.dataSet2.columns.isEmpty()?n?this.dataSet2.onDataRefresh(e):(i=v.ipc.Table.toLegacy(_.mapValues(_.keyBy(this.dataSet2.columns.map(function(t){return t.attributes}),"id"),"kdbType"),this.dataSet2.columns.map(function(t){return t.id}),this.dataSet2.cols),this.dataSet.onData({breakdownColumns:this.dataSet2.breakdownColumns,columns:C.convertDeltaClientColumnSpecToMeta(i)},i.rows,!0,void 0)):n&&!this.dataSet.columns.isEmpty()&&this.apply():this.dataSet.onDataRefresh(e),this.trigger("change:queryStatus",this,this.get("queryStatus"))):this.apply(),this.start()):v.Log.Error(this.logPrefix()+"subscribe: already subscribed",t)},C.prototype.toJSON=function(){var i=this,o={};return _.keys(this.attributes).forEach(function(t){var e=i.attributes[t],n={};_.isObject(e)&&e.has&&e.has("_dataType")?(_.each(_.filter(_.keys(e.attributes),function(t){return 0===t.indexOf("_")&&!_.includes(["_pageSort","_pagingNum"],t)}),function(t){e.get(t)instanceof m.Model?n[t]={_dashboardsType:"viewstate",value:e.get(t).path}:n[t]=e.get(t)}),o[t]=n):e instanceof v.DocumentViewModel?o[t]={_dashboardsType:"viewstate",value:e.path}:(_.isObject(e)&&"Error"===e.type&&(e.options={}),o[t]=e)}),o},C.prototype.triggerCallbacks=function(e){void 0===e&&(e=null),this.callbacks.forEach(function(t){t({success:!e,error:e})}),this.callbacks=[]},C.prototype.unsubscribe=function(t){this.agent.unsubscribe(t)?(v.Log.Info(this.logPrefix()+"unsubscribed "+t),0===this.agent.subscriberCount()&&(this.stop(),this.reset(),this.clearVirtualSubscriptionsAll(),v.Log.Info(this.logPrefix()+"0 subscribers, data source reset"))):v.Log.Warn("unsubscribe not found",t,this)},C.prototype.updateParameterPath=function(t,e,n){var i=new RegExp("^<%"+e);"vs"===t?(_.each([this.get("_analyticParams"),this.get("_queryParams"),this.get("_updateQueryParams")],function(t){_.each(t,function(t){"viewstate"===t.isViewState&&(t.value=t.value.replace(i,"<%"+n))})}),_.each(this.get("_virtualParams"),function(t){"viewstate"===t.type&&(t.value=t.value.replace(i,"<%"+n))})):"ds"===t&&_.each(this.get("_virtualParams"),function(t){"datasource"===t.type&&(t.value=t.value.replace(i,"<%"+n))})},C.prototype.updateParameters=function(t){var e,n,i,o=this,r=[];_.each(_.filter(_.keys(o.attributes),function(t){return 0===t.indexOf("_")}),function(t){"string"==typeof o.get(t)&&o.get(t).replace(C.PARAMETER_RX,function(t,e){return r.push(e),""})}),o.get("_queryParams")&&0<o.get("_queryParams").length?_.each(o.get("_queryParams"),function(t){"string"==typeof t.value&&((e=t.value.match(C.PARAMETER_RX))&&(r.push(e[0].substring(2,e[0].length-2)),i=o.viewState.getByPath(e[0].substring(2,e[0].length-2))),i&&"dict"===i.get("_type")&&_.each(i.get("value"),function(t,e){var n;t instanceof m.Model?r.push(t.path):_.isObject(t)&&t.value?(n=t.value,_.isString(n)&&n.match(C.PARAMETER_RX)&&r.push(n.substring(2,n.length-2))):_.isString(t)&&t.match(C.PARAMETER_RX)&&r.push(t.substring(2,t.length-2))}))}):o.get("_updateQueryParams")&&0<o.get("_updateQueryParams").length?_.each(o.get("_updateQueryParams"),function(t){"string"==typeof t.value&&((e=t.value.match(C.PARAMETER_RX))&&(r.push(e[0].substring(2,e[0].length-2)),i=o.viewState.getByPath(e[0].substring(2,e[0].length-2))),i&&"dict"===i.get("_type")&&_.each(i.get("value"),function(t,e){var n;t instanceof m.Model?r.push(t.path):_.isObject(t)&&t.value?(n=t.value,_.isString(n)&&n.match(C.PARAMETER_RX)&&r.push(n.substring(2,n.length-2))):_.isString(t)&&t.match(C.PARAMETER_RX)&&r.push(t.substring(2,t.length-2))}))}):o.get("_analyticParams")&&0<o.get("_analyticParams").length?_.each(o.get("_analyticParams"),function(t){"string"==typeof t.value?((e=t.value.match(C.PARAMETER_RX))&&(r.push(e[0].substring(2,e[0].length-2)),i=o.viewState.getByPath(e[0].substring(2,e[0].length-2))),i&&"dict"===i.get("_type")&&_.each(i.get("value"),function(t,e){var n;t instanceof m.Model?r.push(t.path):_.isObject(t)&&t.value?(n=t.value,_.isString(n)&&n.match(C.PARAMETER_RX)&&r.push(n.substring(2,n.length-2))):_.isString(t)&&t.match(C.PARAMETER_RX)&&r.push(t.substring(2,t.length-2))})):"object"==typeof t.value&&"dict"===t.type&&_.each(t.value,function(t){_.has(t,"_isKdbReady")||(n="object"==typeof t?t.value:"<%"+t+"%>",(e="string"==typeof n&&n.match(C.PARAMETER_RX))&&r.push(e[0].substring(2,e[0].length-2)))})}):o.get("_virtualParams")&&0<o.get("_virtualParams").length&&_.each(o.get("_virtualParams"),function(t){(e=t.value)&&"viewstate"===t.type&&(r.push(e),i=o.viewState.getByPath(e)),i&&"dict"===i.get("_type")&&_.each(i.get("value"),function(t,e){var n;t instanceof m.Model?r.push(t.path):_.isObject(t)&&t.value?(n=t.value,_.isString(n)&&n.match(C.PARAMETER_RX)&&r.push(n.substring(2,n.length-2))):_.isString(t)&&t.match(C.PARAMETER_RX)&&r.push(t.substring(2,t.length-2))})}),o.parameterModels&&_.each(o.parameterModels,function(t){t&&o.stopListening(t,"change:value",o.onParameterChange)}),o.parameterModels=[],o.get(C.AUTO_EXECUTE)&&_.each(r,function(t){t=o.getViewState().getByPath(t);t&&(o.listenTo(t,"change:value",o.onParameterChange),o.parameterModels.push(t))})},C.prototype.updateVirtualSubscriptions=function(){var i,o=this,n=[];"virtual"!==this.get("_dataType")?this.clearVirtualSubscriptionsAll():(_.each(this.get("_virtualParams"),function(t){var e=t.value;e&&"datasource"===t.type&&n.push(e)}),i=_.keys(this.virtualSubscriptions),_.each(n,function(t){var e,n=o.path+"_"+t;o.get("isSourceDataDialog")&&(n+="#edit"),_.includes(i,n)?i=_.without(i,n):(e=o.root?o.root.getByPath(t):e)&&!o.virtualSubscriptions[n]&&((o.virtualSubscriptions[n]=e).unsubscribe(n),e.subscribe(n,{key:n,onData:function(t,e,n){o.onParameterChange({path:"#virtual",previous:_.noop.bind(o)},Math.random(),{})},source:e}))}),this.clearVirtualSubscriptions(i))},C.prototype.wrapWithErrorHandler=function(t,e,n){var i=this;return function(){try{t.apply(i,arguments)}catch(t){i.onError(e,$.extend(!0,{},n),t,"Error",Array.prototype.slice.call(3,arguments))}}},C.DEFAULT_MAX_ROWS=null,C.DEFAULT_PAGE_SIZE=2e3,C.DEFAULT_PAGING="NONE",C.IMMATERIAL_ATTRIBUTES=["error","queryStatus"],C.NO_DATA_ERROR_TEXT="No data returned from selected data source",C.PAGING_ATTRIBUTES=["_pagingNum","_pageSize","_pagingType","_pageSort","_serverPaging"],C.PARAMETER_RX=new RegExp("<%([^<>%]+?)%>","g"),C.TYPES_TO_PARSE=["date","datetime","guid","minute","month","second","time","timespan","timestamp"],C.VIEW_STATE_ATTRIBUTES={analytic:{_subscriptionInterval:"onQuerySettingChange"},pivot:{_aggregateCols:"onPivotSettingChange",_aggregateFns:"onPivotSettingChange",_aggregateLabels:"onPivotSettingChange",_breakdownCols:"onPivotSettingChange"},query:{_subscriptionInterval:"onQuerySettingChange"}},C.VIRTUAL_QUERY_REGEX=/^(function(?: )?\()([a-z0-9A-Z,\w\/ ]+?)(,(?: +)?callback\)(?: ){)([\s\S]+)(\})$/,C.AGGREGATE_COLS_PROP="_aggregateCols",C.AGGREGATE_LABELS_PROP="_aggregateLabels",C.AUTO_EXECUTE="_autoExecute",C.OLD_THRESHOLD=2e3,C.FAST_THRESHOLD=10,v.DocumentDataModel=C,Se=I=I||{},_e=Se.CommandoModel,l(T,_e),T.prototype.postInitialize=function(){var i=this;_.each(i.getViewStateList(),function(t){"dict"===t.model.get("_type")&&(t.model.set("_default",_.mapValues(t.model.get("_default"),function(t,e){var n;return _.isString(t)&&0===t.indexOf("<%")?n=i.getByPath(t.substring(2,t.length-2)):_.isObject(t)&&(t._viewType?t=t.value:t.isViewState&&(n=i.getByPath(t.name))),n||t}),{silent:!0}),t.model.set("value",t.model.get("_default")))})},T.prototype.destroyOnServer=function(e){e=e?_.clone(e):{};function n(){s.trigger("destroy",s,s.collection,e)}var i,o,r,s=this,a=e.success,l=e.wait,t=!(e.success=function(t){l&&n(),a&&a.call(e.context,s,t,e),s.isNew()||s.trigger("sync",s,t,e)});return this.isNew()?_.defer(e.success):(i=this,r=(o=e).error,o.error=function(t){r&&r.call(o.context,i,t,o),i.trigger("error",i,t,o)},t=this.sync("delete",this,e)),l||n(),t},T.prototype.doCommand=function(t,e){var n;if(0<t.length)return n=t.reverse().join("/"),this.getByPath(n).doCommand(t,e)},T.prototype.getByPath=function(t){var e;if(t)return _.isObject(t)?(console.warn("getByPath is deprecated, please update component."),t):(t=_.filter(t.split("/"),function(t){return t&&0<t.length}),e=this,_.each(t,function(t){e&&e.get&&(e=e.get(t))}),e)},T.prototype.getViewStateExport=function(){var s={},a=function(e,n){var i,o,r;if(e&&e.attributes)return _.each(_.keys(e.attributes),function(t){r=n?n+"/"+t:t,o=e.get(t),_.isObject(o)&&_.isFunction(o.get)&&(o.get("_viewType")?_.isEqual(o.get("value"),o.get("_default"))||(s[r]=o.get("value")):".settings"===r?(i=_.mapValues(o.attributes,function(t){return t.omit("version")}),_.isEmpty(i)||(s[".csettings"]=Se.Tools.encodeToBase64(Se.Tools.compress(JSON.stringify(i))))):a(o,r))}),s};return a(this)},T.prototype.getViewStateList=function(t){return this.viewStates=[],this.getViewStates(this),this.viewStates},T.prototype.getViewStates=function(e,n,i){var o,r,s=this;e.attributes&&_.each(_.keys(e.attributes),function(t){r=n?n+"/"+t:t,o=e.get(t),!i&&".settings"===t||(_.isObject(o)&&_.isFunction(o.get)&&o.get("_viewType")&&"."!==t.substr(0,1)?s.viewStates.push({model:o,path:r}):s.getViewStates(o,r,i))})},T.prototype.onChange=function(){var n=this;_.each(this.changedAttributes(),function(t,e){void 0===n.previous(e)&&t instanceof T?(n.stopListening(t,"change materialChange"),n.listenTo(t,"change",n.onChildModelChange),n.listenTo(t,"materialChange",n.onMaterialChange)):void 0===t&&n.previous(e)instanceof T&&(n.stopListening(n.previous(e),"change"),n.stopListening(n.previous(e),"materialChange"))}),this.changed&&_.some(this.MATERIAL_ATTRIBUTES,function(t){return n.hasChanged(t)})&&this.trigger("materialChange")},T.prototype.onChildModelChange=function(t,e){this.trigger("change",t,e)},T.prototype.postCommand=function(t,e){return e.path.push(this.id),this.parent.postCommand(this,e)},T.prototype.onMaterialChange=function(){this.trigger("materialChange")},T.prototype.setModelValue=function(i){var o=this,r=!1;"dict"===this.get("_type")&&_.each(_.pickBy(i,function(t,e){return o.get("value")[e]instanceof Se.DocumentViewModel}),function(t,e){t=_.includes(_.keys(t),"value")?t.value:t;var n=o.get("value")[e];n.get("value")!==t&&(r=!0),n.setModelValue(t),i[e]=n}),this.set("value",i),r&&_.isEmpty(this.changed)&&this.trigger("change:value",this,i)},T.prototype.toJSON=function(o){var r=this,s={},t=_.keys(r.attributes);return o=!0===o||this.root&&this.root.withAllProperties,r.get("_rolling")&&Se.Helpers.convertRollingToDate(r.get("_default"),r.get("_type"))===r.get("value")&&(t=_.without(t,"value")),_.each(t,function(t){var e,n=r.attributes[t],i={};if(".settings"===t)for(e in s[t]=n.toJSON(),s[t])s[t].hasOwnProperty(e)&&(s[t][e]=s[t][e].toJSON());else _.isObject(n)&&n.has&&n.has("_viewType")?(_.each(_.filter(_.keys(n.attributes),function(t){return!!o||0===t.indexOf("_")}),function(t){i[t]=n.get(t)}),"dict"===i._type&&(i._default=_.mapValues(n.get("_default"),function(t,e){return t instanceof T?"<%"+t.path+"%>":t}),i.value=_.mapValues(n.get("value"),function(t,e){return t instanceof T?"<%"+t.path+"%>":t})),s[t]=i):s[t]=n}),s},T.prototype.parse=function(t){var e;if(t&&t[".settings"]&&!((e=t[".settings"])instanceof m.Model)){for(var n in e)e.hasOwnProperty(n)&&(e[n]=new m.Model(e[n]));t[".settings"]=new m.Model(e)}return t},T.prototype.updateBinding=function(t,e,n,i,o){var r=_.isString(t)?this.getByPath(t):t;e.stopListening(n,"change:"+i),t&&r&&(o.push(r),n.set(i,r.get("value")),e.listenTo(r,"change:value",function(t,e){n.set(i,e)}),e.listenTo(n,"change:"+i,function(t,e){r.set("value",e)}))},T.prototype.updateBindingDeep=function(t,e,n,i,o){var r=this.get(t);e.stopListening(n,"change:"+i),t&&r&&(o.push(r),n.set(i,r.get("value")),e.listenTo(r,"change:value",function(t,e){n.set(i,e)}),e.listenTo(n,"change:"+i,function(t,e){r.set("value",e)}))},T.prototype.updateSchema=function(){var t=Se.RTTI.getByName(this.get("_type")).editor;this.schema._default=t,this.schema.value=t},T.prototype.silentCast=function(t,e,n){this.get(t)instanceof e||this.set(t,new e(this.get(t),n),{silent:!0})},Se.DocumentViewModel=T;var Le=I=I||{};Ve=Le.CommandoModel,l(Oe,Ve),Oe.prototype.clone=function(){var t=this.toJSON(),e=(delete t.id,t.widgets=t.widgets.clone(),new Oe(t,{},this.parent));return t.widgets.setParent(e),e},Oe.prototype.defaults=function(){return{id:null,name:"Screen 1",thumb:null,widgets:new Le.WidgetCollection([],{},this),relativeHeight:void 0,rowCount:void 0,rowHeight:void 0,colCount:36,floatable:!0}},Oe.prototype.commandSet=function(t){var n=this,e=_.mapValues(t,function(t,e){return n.previous(e)});this.postCommand(this,new Le.Command("Set Screen",[],[new Le.Todo(Le.CommandOp.Set,"",t)],[new Le.Todo(Le.CommandOp.Set,"",e)]))},Oe.prototype.determineMaterialChange=function(){this.changed&&!_.isEmpty(_.omit(this.changed,this.IMMATERIAL_ATTRIBUTES))&&this.trigger("materialChange")},Oe.prototype.doCommand=function(t,e){var n=this;if(0<t.length){var i=t.pop();if("widgets"===i)return this.get(i).doCommand(t,e);throw"Unsupported command key"}e.forEach(function(t){n.set(t.payload)})},Oe.prototype.getComponents=function(){return this.get("widgets").getComponents()},Oe.prototype.onMaterialChange=function(){this.trigger("materialChange")},Oe.prototype.parseCastAndListen=function(t,e,n,i){!t||!t[e]||t[e]instanceof n||(t[e]=new n(t[e],{},this),this.listenTo(t[e],i,function(){this.trigger("change",this)}))},Oe.prototype.parse=function(t){return this.parseCastAndListen(t,"widgets",Le.WidgetCollection,"change add remove"),t},Oe.prototype.postCommand=function(t,e){return t instanceof Le.WidgetCollection&&e.path.push("widgets"),e.path.push(this.id),this.parent&&this.parent.postCommand(this,e)},Oe.prototype.silentCast=function(t,e){this.get(t)instanceof e||this.set(t,new e(this.get(t),{},this),{silent:!0})};var Ve,n=Oe;function Oe(t,e,n){t=Ve.call(this,t,e,n)||this;return t.IMMATERIAL_ATTRIBUTES=["isDefault","thumb","widgets"],t.get("id")||t.set({id:Le.Helpers.getGUID()},{silent:!0}),t.get("widgets")&&(t.silentCast("widgets",Le.WidgetCollection),t.listenTo(t.get("widgets"),"change add remove",function(t){this.trigger("change")})),t.listenTo(t,"change",t.determineMaterialChange.bind(t)),t.listenTo(t.get("widgets"),"materialChange",t.onMaterialChange.bind(t)),t}Le.Screen=n,Be=Le.ComandoCollection,l(Re,Be);var Be,i=Re;function Re(){var t=null!==Be&&Be.apply(this,arguments)||this;return t.descriptor="Screen",t}(Le.ScreenCollection=i).prototype.model=n;var $e=I=I||{};Ue=$e.CommandoModel,l(qe,Ue),qe.prototype.convertPathsToModels=function(o){var e=this;_.each(this.attributes,function(i,t){i instanceof Array&&_.each(i,function(t,n){_.each(t,function(t,e){"viewstate"===t._dashboardsType&&(i[n][e]=o.getByPath(t.value))})}),"viewstate"===i._dashboardsType&&e.set(t,o.getByPath(i.value),{silent:!0})})},qe.prototype.defaults=function(){return{visible:!1,dialogTitle:"",dialogHeight:0,dialogWidth:0,modal:!1,resizable:!1,widgets:new $e.WidgetCollection([],{},this),id:$e.Helpers.getGUID()}},qe.prototype.doCommand=function(t,e){var n=this;if(0<t.length){var i=t.pop();if("widgets"===i)return this.get(i).doCommand(t,e);throw"Unsupported command key"}e.forEach(function(t){t=_.isArray(t.payload)?_.find(t.payload,{id:n.id}):t.payload;t&&n.set(t)})},qe.prototype.getComponents=function(){return this.get("widgets").getComponents()},qe.prototype.postCommand=function(t,e){return t instanceof $e.WidgetCollection&&e.path.push("widgets"),e.path.push(this.id),this.parent.postCommand(this,e)},qe.prototype.onMaterialChange=function(){this.trigger("materialChange")},qe.prototype.transformToWidgetCollection=function(){var t=this.get("widgets");t instanceof $e.WidgetCollection||(t=new $e.WidgetCollection(t?t[0]:[],{},this),this.set("widgets",t,{silent:!0}))};var Ue,Fe=qe;function qe(t,e,n){t=Ue.call(this,t,e,n)||this;return t.idAttribute="id",t.get("id")||t.set({id:$e.Helpers.getGUID()},{silent:!0}),t.transformToWidgetCollection(),t.listenTo(t,"change",t.onMaterialChange.bind(t)),t.listenTo(t.get("widgets"),"add remove materialChange",t.onMaterialChange.bind(t)),t}$e.Popup=Fe,Ye=$e.ComandoCollection,l(He,Ye),He.prototype.commandSet=function(t){var n=this,e=[],i=this.toJSON(),o=[],e=_.differenceBy(t,i,function(t){return t.id}),r=_.filter(t,function(t){var e=n.get(t.id);return!!e&&e.changedAttributes(t)}),o=_.differenceBy(i,t,function(t){return t.id});e.length&&this.commandAdd(e.map(function(t){return new Fe(t,{},n)})),_.each(r,function(t){n.postCommand(n,new $e.Command(n.getCommandDescription($e.CommandOp.Set,t),[t.id],[new $e.Todo($e.CommandOp.Set,"",t)],[new $e.Todo($e.CommandOp.Set,"",i)]))}),o.length&&this.commandRemove(o.map(function(t){return n.get(t.id)||new Fe(t,{},n)}))},He.prototype.postInitialize=function(e){this.each(function(t){t.convertPathsToModels(e)}),this.trigger("viewStatesParsed"),this.listenTo(this,"add remove reset",function(){this.trigger("materialChange")})};var Ye,o=He;function He(){var t=null!==Ye&&Ye.apply(this,arguments)||this;return t.descriptor="Popup",t}($e.PopupCollection=o).prototype.model=Fe;var D=I=I||{};Ke=m.Model,l(M,Ke),M.reorganizePopupsAndMappers=function(d,h){var g={"Basics.DialogHeight":"dialogHeight","Basics.DialogTitle":"dialogTitle","Basics.DialogWidth":"dialogWidth","Basics.Modal":"modal","Basics.Resizable":"resizable","Basics.Visible":"visible"},f=function(t){var n=[],p=function(e){var n,i,o,r,s,t,a,l,u=e.get("components"),c=e.get("widgets");e&&"Popup"===e.get("key")?(a=(t=e).get("options"),l={},_.each(g,function(t,e){e=a.get(e);_.isObject(e)&&"viewstate"===e._dashboardsType?l[t]=d.get("viewState").getByPath(e.value):l[t]=e}),l.widgets=t.get("widgets"),d.get("popups").add(l),h&&f(l.widgets)):e&&"QueryMapper"===e.get("key")?(o=(t=e).get("options").get("Basics.Mapping"),t=t.get("options").get("Basics.Data"),r={key:void 0,value:void 0,mappings:void 0},s=_.uniqueId("queryMapperUpgrade_"),(n=_.isObject(t)&&"data"===t._dashboardsType?d.get("data").getByPath(t.value):n)&&o&&o.length&&(i=n.get("_mappings")||{},n.subscribe(s,{onData:function(t,e){t=t.columns.collection.map("id");n.unsubscribe(s),r.key=t[0]||"",r.value=t[1]||"",r.mappings=i.mappings||{},_.each(o,function(t){t.Viewstate instanceof m.Model?r.mappings[t.Key]={_dashboardsType:"viewstate",value:t.Viewstate.path}:r.mappings[t.Key]=t.Viewstate||""}),n.set("_mappings",r),n.apply()}},!1))):u&&!u.isEmpty()?u.each(function(t){e&&_.includes(["Popup","QueryMapper"],e.get("key"))&&u.remove(t),p(t)}):c&&!c.isEmpty()&&f(c)};t.each(function(t){var e;(e=(t=t).get("component"))&&(_.includes(["Popup","QueryMapper"],e.get("key"))&&n.push(t),p(e))}),t.remove(n)};d.get(h?"popups":"screens").each(function(t){f(t.get("widgets"))})},M.renameCookie=function(t){_.each({viewStateDialogSize:"dashboard-viewStateDialog-size",viewStateDialogPosition:"dashboard-viewStateDialog-position",viewStateDialogWeights:"dashboard-viewStateDialog-weights","kx-datadialog-settings":"dashboard-datadialog-settings"},function(t,e){var n=$.cookie(e);$.removeCookie(e,{path:"/"}),$.cookie(t,n)})},M.prototype.commandSet=function(t){var n=this,e=_.mapValues(t,function(t,e){return n.previous(e)}),t=new D.Command("Set Options",[],[new D.Todo(D.CommandOp.Set,"",t)],[new D.Todo(D.CommandOp.Set,"",e)]);this.postCommand(this,t)},M.prototype.defaults=function(){var t=new D.DocumentViewModel({selected:{_viewType:!0,_default:"0",value:""},".settings":new m.Model},{root:!0},this),e=new D.ScreenCollection([],{},this);return e.add(new D.Screen({},{},e)),{id:null,name:"My New Dashboard",creationDate:null,lastUpdateDate:null,thumb:null,screenDetails:[],screens:e,popups:new D.PopupCollection([],{},this),tags:[],dashboardTheme:_.capitalize(($.cookie("dashboard-theme")||"dark").replace(/(kx-|room)/g,"")),themeSwitchable:!0,saveTimestamp:null,relativeHeight:void 0,rowCount:void 0,rowHeight:void 0,colCount:36,floatable:!0,viewState:t,data:new D.DocumentDataModel({},null,"",t,!0),permissionEntity:null,worksheetPadding:10,widgetsSpacing:0,borderColor:"000000",borderBackground:"000000",transparentBackground:!0,borderWidth:0,borderRounding:0,borderSpacing:0,borderShadow:!1,saveViewerState:"enabled",enableShareDashboard:!1,notifications:null,showLoadingIndicators:!0,unsavedViewerPrompt:!1,advancedCss:"",cssClasses:"",version:"4.7.0"}},M.prototype.doCommand=function(t,e){var n=this;if(0<t.length){var i=t.pop();if(-1!=["screens","popups","data","viewState"].indexOf(i))return this.get(i).doCommand(t,e);throw"Unsupported command key"}e.forEach(function(t){n.set(t.payload)})},M.prototype.determineMaterialChange=function(){this.changed&&!_.isEmpty(_.omit(this.changed,this.IMMATERIAL_ATTRIBUTES))&&this.trigger("materialChange")},M.prototype.getComponents=function(){return this.get("screens").getComponents().concat(this.get("popups").getComponents())},M.prototype.onViewStateInit=function(){this.get("viewState").postInitialize();var t=this.get("cssClasses");t&&"viewstate"===t._dashboardsType&&this.set("cssClasses",this.get("viewState").getByPath(t.value),{silent:!0}),this.get("popups").postInitialize(this.get("viewState")),this.viewStateInit=!0},M.prototype.saveDelayed=function(t){var e=this;this.saveTimeout&&clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(function(){return e.saveNow(t)},this.SAVE_DELAY)},M.prototype.saveNow=function(t,e){var n=this,i=[];if(_.isEmpty(this.get("screens").models))return t("Document is empty, skipping save."),void D.Log.Warn("Document is empty, skipping save.");this.saveTimeout&&clearTimeout(this.saveTimeout),D.Log.Info("SAVE",this.id),this.set({lastUpdateDate:(new Date).toUTCString()},{silent:!0}),_.each(this.get("screens").models,function(t){i.push({label:t.get("name"),value:t.id})}),this.set({screenDetails:i}),this.set({thumb:0<this.get("screens").models.length?this.get("screens").models[0].get("thumb"):null},{silent:!0});var o=$.extend(!0,{},this.attributes);this.setDataProperties(o.notifications),this.setDataProperties(o.shortcuts),o.popups.each(function(t){t.set(n.setDataProperties(_.omit(t.attributes,"widgets")),{silent:!0})}),o.cssClasses=this.setViewStateProperty(o.cssClasses),this.save(o,{error:t,success:function(t){D.Log.Info("success",arguments),n.trigger("documentSaved"),n.set("wasChanged",!1),e&&e(t)}})},M.prototype.silentCast=function(t,e,n){this.get(t)instanceof e||this.set(t,new e(this.get(t),n,this),{silent:!0})},M.prototype.setDataProperties=function(t){if(t){for(var e in t)t[e]&&t[e].path?t[e]instanceof D.DocumentDataModel?t[e]={_dashboardsType:"data",value:t[e].path}:t[e]instanceof D.DocumentViewModel&&(t[e]={_dashboardsType:"viewstate",value:t[e].path}):"object"==typeof t[e]&&(t[e]=this.setDataProperties(t[e]));return t}},M.prototype.setViewStateProperty=function(t){return t=t instanceof D.DocumentViewModel?{_dashboardsType:"viewstate",value:t.path}:t},M.prototype.toJSON=function(){var e=this,t=$.extend(!0,{},this.attributes);return this.setDataProperties(t.notifications),this.setDataProperties(t.shortcuts),t.popups.each(function(t){t.set(e.setDataProperties(_.omit(t.attributes,"widgets")))}),t.cssClasses=this.setViewStateProperty(t.cssClasses),t},M.prototype.toJSONClone=function(){var e=this,t=_.cloneDeep(this.attributes);return this.setDataProperties(t.notifications),this.setDataProperties(t.shortcuts),t.popups.each(function(t){t.attributes=_.extend(e.setDataProperties(_.omit(t.attributes,"widgets")),{widgets:t.get("widgets")})}),t.cssClasses=this.setViewStateProperty(t.cssClasses),t},M.prototype.parseCastAndListen=function(t,e,n,i,o){!t||!t[e]||t[e]instanceof n||(t[e]=o?o(t[e]):new n(t[e],{},this))},M.prototype.postCommand=function(t,e){return t instanceof D.ScreenCollection?e.path.push("screens"):t instanceof D.PopupCollection?e.path.push("popups"):t instanceof D.DocumentDataModel?e.path.push("data"):t instanceof D.DocumentViewModel&&e.path.push("viewState"),this.trigger("postCommand"),this.set("wasChanged",!0),M.parent&&M.parent.postCommand(this,e)},M.prototype.parse=function(n){var t=this.get("cssClasses");return t&&"viewstate"===t._dashboardsType&&this.set("cssClasses",this.get("viewState").getByPath(t.value)),this.parseCastAndListen(n,"viewState",D.DocumentViewModel,"change",function(t){return new D.DocumentViewModel(t,{root:!0},this)}),this.parseCastAndListen(n,"data",D.DocumentDataModel,"change",function(t){return new D.DocumentDataModel(t,null,"",n.viewState,!0)}),this.parseCastAndListen(n,"screens",D.ScreenCollection,"change add remove"),this.parseCastAndListen(n,"popups",D.PopupCollection,"change add remove"),this.viewStateInit&&this.get("popups").postInitialize(this.get("viewState")),_.each(n.shortcuts,function(t){var e=t.Data;e&&"data"===e._dashboardsType&&(t.Data=n.data.getByPath(e.value))}),n},M.prototype.upgrade=function(){var t,e;if(0<_.keys(this.attributes).length)for(t=D.Document.upgrades.indexOf(_.find(D.Document.upgrades,{version:this.get("version")}))+1;t<D.Document.upgrades.length;t+=1)(e=D.Document.upgrades[t]).fn(this),this.set("version",e.version)},M.upgrades=[{version:"4.3.0",fn:function(n){_.each(n.get("viewState").getViewStateList(),function(t){function e(t){return t=t instanceof D.DocumentViewModel?t.path:_.isObject(t)?t.name:t,n.get("viewState").getByPath(t)}"dict"===t.model.get("_type")&&(t.model.set("_default",_.mapValues(t.model.get("_default"),e)),t.model.set("value",_.mapValues(t.model.get("value"),e)))})}},{version:"4.4.0",fn:function(t){M.reorganizePopupsAndMappers(t,!1)}},{version:"4.4.0p7",fn:function(t){M.reorganizePopupsAndMappers(t,!0)}},{version:"4.6.0",fn:function(t){t.set("saveViewerState",!1===t.get("enableSaveViewState")?"disabled":"enabled")}},{version:"4.6.0P1",fn:function(t){M.renameCookie(t)}}];var Ke,mt=M;function M(t,e){var t=Ke.call(this,t,e)||this,n=(t.IMMATERIAL_ATTRIBUTES=["data","viewState","wasChanged"],t.sampleData=null,t.SAVE_DELAY=3e4,t.saveTimeout=null,t.viewStateInit=!1,t);return t.get("id")||t.set({id:D.Helpers.getGUID()},{silent:!0}),t.silentCast("viewState",D.DocumentViewModel,{root:!0}),t.silentCast("popups",D.PopupCollection),t.silentCast("screens",D.ScreenCollection),t.get("data")instanceof D.DocumentDataModel||t.set("data",new D.DocumentDataModel(t.get("data"),null,"",t.get("viewState"),!0),{silent:!0}),t.listenTo(t,"view-state-init",t.onViewStateInit),t.listenTo(t,"change",t.determineMaterialChange),t.listenTo(t.get("screens"),"change add remove",function(t){n.trigger("change",arguments)}),t.has("showLoadingIndicators")||t.set("showLoadingIndicators",!0,{silent:!0}),t}D.Document=mt,ze=m.Collection,l(We,ze),We.prototype.getSortedDocuments=function(){return this.sortBy(function(t){return 3-(2*(_.includes(t.get("tags"),"defaultdash")?1:0)+(_.includes(t.get("tags"),"starred")?1:0))+t.get("name")})},We.requiredAccessLevel=null;var ze,vt=We;function We(t,e){t=ze.call(this,t,e)||this;if(We.singleton)throw"Singleton Error! DocumentCollection() invoked 2x.";return We.singleton=t}function Qe(t,e){t=Te.call(this,t,e)||this;return(Ce.Document.parent=t).listenTo(t,"change:selectedDocumentId",t.resetCommands.bind(t)),t}function je(){}function Ge(e){var n=Me.call(this,e)||this;return n.$dialog=null,n.$nameInput=null,n.container=null,n.appModel=null,n.viewModel=null,n.appModel=e.appModel,n.container=e.container,n.viewModel=e.viewModel,n.el.className="quick-base window dashboard-name-prompt",n.$el.html(De.T.AboutDialog(_.extend({DeltaClientHost:location.hostname,DeltaClientPort:location.port||("https:"==location.protocol?443:80)},n.appModel.toJSON()))),n.$nameInput=n.$el.find(".name-input"),n.$dialog=n.$el.dialog(_.extend({appendTo:n.container,dialogClass:"quick-base about-dialog",title:t("About"),resizable:!0,height:329,width:470,modal:!0,autoOpen:!0,draggable:!0,open:function(){$('<i class="fa fa-info-circle" />').insertBefore(n.$el.parent().find(".ui-dialog-title"))},close:function(){n.remove()}},e)),n}function Xe(t){var n=Ee.call(this)||this;return n.HEADING_HEIGHT=28,n.onUpdate=t.onUpdate,n.sections=t.sections||[],n.$el=t.el,n.$el.addClass("dash-accordion accordion"),n.sections.forEach(function(t,e){t.$el&&(t.$heading=t.$el.find(t.$heading),t.$content=t.$el.find(t.$content),t.$el.addClass("section"),t.$heading.click(function(){n.onClick(t)}))}),n.debouncedRemoveAnimate=_.debounce(function(){n.$el.removeClass("animate"),n.onUpdate&&n.onUpdate(n.sections)},300),n.updateLayout(!1),n}(D.DocumentCollection=vt).prototype.model=mt,Ce=I=I||{},Te=m.Model,l(Qe,Te),Qe.prototype.defaults=function(){return{commands:[],commandIndex:-1,buildMode:!0,isInspecting:!1,selectedDocumentId:null,selectedScreenId:null,selectedWidgetId:null,selectedSubComponent:null,userConfigurable:!1,componentsPanel:new m.Model({search:null})}},Qe.prototype.goToCommandIndex=function(t){var e=this.get("commandIndex"),n=this.get("commands"),i=Ce.DocumentCollection.singleton.get(this.get("selectedDocumentId"));if(t===e&&(t-=1),e<t)for(var o=e+1;o<=t;o++)0<=o&&o<n.length&&i.doCommand(_.clone(n[o].path),n[o].todo);else if(t<e)for(o=e;t<o;o--)0<=o&&o<n.length&&i.doCommand(_.clone(n[o].path),n[o].undo);this.set("commandIndex",t)},Qe.prototype.doCommand=function(t,e){},Qe.prototype.postCommand=function(t,e){var n=this.get("commands"),i=this.get("commandIndex");i<n.length-1&&n.splice(i+1,n.length-i-1),n.push(e),Ce.Log.Info("AppViewModel::onCommand",this.get("commands")),this.goToCommandIndex(i+1)},Qe.prototype.redo=function(){this.goToCommandIndex(this.get("commandIndex")+1)},Qe.prototype.resetCommands=function(){this.set("commands",[],{silent:!0}),this.set("commandIndex",-1,{silent:!0}),this.trigger("change:commandIndex")},Qe.prototype.undo=function(){this.goToCommandIndex(this.get("commandIndex")-1)},Ce.AppViewModel=Qe,wt=I=I||{},je.AboutDialog=s.template({1:function(t,e,n,i,o){var r,s=t.lambda,a=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"            <tr>\n                <td>Delta Control Host:</td>\n                <td>"+a(s(null!=(r=null!=e?t(e,"dashboardControlDetails"):e)?t(r,"dchost"):r,e))+"</td>\n            </tr>\n            <tr>\n                <td>Delta Control Port:</td>\n                <td>"+a(s(null!=(r=null!=e?t(e,"dashboardControlDetails"):e)?t(r,"dcport"):r,e))+"</td>\n            </tr>\n            <tr>\n                <td>Delta Control TLS:</td>\n                <td>"+a(s(null!=(r=null!=e?t(e,"dashboardControlDetails"):e)?t(r,"dctls"):r,e))+"</td>\n            </tr>\n            <tr>\n                <td>KDB Banner:</td>\n                <td>"+a(s(null!=(r=null!=e?t(e,"dashboardControlDetails"):e)?t(r,"bannerText"):r,e))+"</td>\n            </tr>\n            <tr>\n                <td>KDB Version:</td>\n                <td>"+a(s(null!=(r=null!=e?t(e,"dashboardControlDetails"):e)?t(r,"kdbVersion"):r,e))+"</td>\n            </tr>\n            <tr>\n                <td>KDB Release Date:</td>\n                <td>"+a(s(null!=(r=null!=e?t(e,"dashboardControlDetails"):e)?t(r,"releaseDate"):r,e))+"</td>\n            </tr>\n            <tr>\n                <td>KDB Update Date:</td>\n                <td>"+a(s(null!=(r=null!=e?t(e,"dashboardControlDetails"):e)?t(r,"updateDate"):r,e))+"</td>\n            </tr>\n"},3:function(t,e,n,i,o){var r,s=null!=e?e:t.nullContext||{},a=t.hooks.helperMissing,l=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"            <tr>\n                <td>"+l("function"==typeof(r=null!=(r=t(n,"key")||(null!=e?t(e,"key"):e))?r:a)?r.call(s,{name:"key",hash:{},data:o,loc:{start:{line:63,column:20},end:{line:63,column:27}}}):r)+":</td>\n                <td>"+l("function"==typeof(r=null!=(r=t(n,"value")||(null!=e?t(e,"value"):e))?r:a)?r.call(s,{name:"value",hash:{},data:o,loc:{start:{line:64,column:20},end:{line:64,column:29}}}):r)+"</td>\n            </tr>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){var r=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,a="function",l=t.escapeExpression,u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]},l='<div class="splash">\n    <div class="version">'+l(typeof(c=null!=(c=u(n,"PackageName")||(null!=e?u(e,"PackageName"):e))?c:s)==a?c.call(r,{name:"PackageName",hash:{},data:o,loc:{start:{line:2,column:25},end:{line:2,column:40}}}):c)+'</div>\n    <div class="scroll">\n        <p>Copyright in Kx Dashboards belongs to First Derivatives plc.  First Derivatives plc 2009-2018. All rights reserved. Use of the software is subject to the terms of First Derivatives plcs license agreement. Kx and kdb+ are trademarks of Kx Systems Inc.<br/>Kx System Inc. is a subsidiary of First Derivatives plc. Portions of the Kx Dashboards software use code and/or materials under license from third-party suppliers.</p>\n        <table style="width: 100%;">\n            <tr>\n                <td>'+l((u(n,"t")||e&&u(e,"t")||s).call(r,"User Name",{name:"t",hash:{},data:o,loc:{start:{line:7,column:20},end:{line:7,column:37}}}))+":</td>\n                <td>"+l(typeof(c=null!=(c=u(n,"userName")||(null!=e?u(e,"userName"):e))?c:s)==a?c.call(r,{name:"userName",hash:{},data:o,loc:{start:{line:8,column:20},end:{line:8,column:32}}}):c)+"</td>\n            </tr>\n            \x3c!--\n            <tr>\n                <td>"+l((u(n,"t")||e&&u(e,"t")||s).call(r,"Delta Client Host",{name:"t",hash:{},data:o,loc:{start:{line:12,column:20},end:{line:12,column:45}}}))+":</td>\n                <td>"+l(typeof(c=null!=(c=u(n,"DeltaClientHost")||(null!=e?u(e,"DeltaClientHost"):e))?c:s)==a?c.call(r,{name:"DeltaClientHost",hash:{},data:o,loc:{start:{line:13,column:20},end:{line:13,column:39}}}):c)+"</td>\n            </tr>\n            <tr>\n                <td>"+l((u(n,"t")||e&&u(e,"t")||s).call(r,"Delta Client Port",{name:"t",hash:{},data:o,loc:{start:{line:16,column:20},end:{line:16,column:45}}}))+":</td>\n                <td>"+l(typeof(c=null!=(c=u(n,"DeltaClientPort")||(null!=e?u(e,"DeltaClientPort"):e))?c:s)==a?c.call(r,{name:"DeltaClientPort",hash:{},data:o,loc:{start:{line:17,column:20},end:{line:17,column:39}}}):c)+"</td>\n            </tr>\n            <tr>\n                <td>&nbsp;</td>\n            </tr>\n            <tr>\n                <td>"+l((u(n,"t")||e&&u(e,"t")||s).call(r,"Delta Control",{name:"t",hash:{},data:o,loc:{start:{line:23,column:20},end:{line:23,column:41}}}))+":</td>\n            </tr>--\x3e\n"+(null!=(p=u(n,"unless").call(r,null!=e?u(e,"isLite"):e,{name:"unless",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:25,column:12},end:{line:54,column:23}}}))?p:"")+"            <tr>\n                <td>&nbsp;</td>\n            </tr>\n            <tr>\n                <td>"+l((u(n,"t")||e&&u(e,"t")||s).call(r,"UI Components",{name:"t",hash:{},data:o,loc:{start:{line:59,column:20},end:{line:59,column:41}}}))+":</td>\n            </tr>\n",c=null!=(c=u(n,"paths")||(null!=e?u(e,"paths"):e))?c:s,s={name:"paths",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:61,column:12},end:{line:66,column:22}}},p=typeof c==a?c.call(r,s):c;return null!=(p=u(n,"paths")?p:t.hooks.blockHelperMissing.call(e,p,s))&&(l+=p),l+"        </table>\n    </div>\n</div>"},useData:!0}),je.AreYouSureDialog=s.template({1:function(t,e,n,i,o){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<p>\n    "+t.escapeExpression("function"==typeof(n=null!=(n=r(n,"message")||(null!=e?r(e,"message"):e))?n:t.hooks.helperMissing)?n.call(null!=e?e:t.nullContext||{},{name:"message",hash:{},data:o,loc:{start:{line:3,column:4},end:{line:3,column:15}}}):n)+"\n</p>\n"},3:function(t,e,n,i,o){var r,s=null!=e?e:t.nullContext||{},a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<p>\n    Components "+(null!=(r=a(n,"if").call(s,null!=e?a(e,"dashChanged"):e,{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.noop,data:o,loc:{start:{line:8,column:15},end:{line:8,column:46}}}))?r:"")+"have unsaved changes:\n    <ul>\n"+(null!=(r=a(n,"each").call(s,null!=e?a(e,"components"):e,{name:"each",hash:{},fn:t.program(6,o,0),inverse:t.noop,data:o,loc:{start:{line:10,column:8},end:{line:12,column:17}}}))?r:"")+"    </ul>\n</p>\n"},4:function(t,e,n,i,o){return"also "},6:function(t,e,n,i,o){var r=t.lambda,s=t.escapeExpression,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <li><span title="'+s(r(null!=e?a(e,"widget"):e,e))+'">'+s(r(null!=e?a(e,"component"):e,e))+"</span>"+(null!=(s=a(n,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"message"):e,{name:"if",hash:{},fn:t.program(7,o,0),inverse:t.noop,data:o,loc:{start:{line:11,column:67},end:{line:11,column:112}}}))?s:"")+"</li>\n"},7:function(t,e,n,i,o){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return": "+t.escapeExpression(t.lambda(null!=e?r(e,"message"):e,e))},compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){var r,s=null!=e?e:t.nullContext||{},a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(r=a(n,"if").call(s,null!=e?a(e,"dashChanged"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:0},end:{line:5,column:7}}}))?r:"")+(null!=(r=a(n,"if").call(s,null!=e?a(e,"components"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:6,column:0},end:{line:15,column:7}}}))?r:"")+'<p>Would you like to save?</p>\n<div class="error-info" style="color: red;">\n    There was an error saving this dashboard.\n\n    <ul class="error-list"></ul>\n</div>'},useData:!0}),je.ComponentView=s.template({compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){var r=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,a=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="border-div">\n    <div class="title-div"></div>\n    <div class="app-div dashboard-dark"></div>\n</div>\n\n<div class="errorMessage ui-state-header">\n    <div class="errorPanel ui-state-error">\n        <div class="errorTitle"><i class="fa fa-exclamation-triangle"></i><span>'+a((t(n,"t")||e&&t(e,"t")||s).call(r,"Error",{name:"t",hash:{},data:o,loc:{start:{line:8,column:80},end:{line:8,column:93}}}))+'</span></div>\n        <span class="errorText"></span>\n    </div>\n    <div class="errorPanel ui-state-warning">\n        <div class="errorTitle"><i class="fa fa-exclamation-circle"></i><span>'+a((t(n,"t")||e&&t(e,"t")||s).call(r,"Warning",{name:"t",hash:{},data:o,loc:{start:{line:12,column:78},end:{line:12,column:93}}}))+'</span></div>\n        <span class="errorText"></span>\n    </div>\n    <div class="errorPanel ui-state-highlight">\n        <div class="errorTitle"><i class="fa fa-info-circle"></i><span>'+a((t(n,"t")||e&&t(e,"t")||s).call(r,"Info",{name:"t",hash:{},data:o,loc:{start:{line:16,column:71},end:{line:16,column:83}}}))+'</span></div>\n        <span class="errorText"></span>\n    </div>\n</div>\n\n<div class="queryStatus ui-state-header">\n    <div class="statusPanel Error ui-state-error">\n        <div class="statusTitle"><i class="fa fa-exclamation-triangle"></i><span>'+a((t(n,"t")||e&&t(e,"t")||s).call(r,"Error",{name:"t",hash:{},data:o,loc:{start:{line:23,column:81},end:{line:23,column:94}}}))+'</span></div>\n        <span class="statusText"></span>\n    </div>\n    <div class="statusPanel Warning ui-state-warning">\n        <div class="statusTitle"><i class="fa fa-exclamation-circle"></i><span>'+a((t(n,"t")||e&&t(e,"t")||s).call(r,"Warning",{name:"t",hash:{},data:o,loc:{start:{line:27,column:79},end:{line:27,column:94}}}))+'</span></div>\n        <span class="statusText"></span>\n    </div>\n    <div class="statusPanel Info ui-state-highlight">\n        <div class="statusTitle"><i class="fa fa-info-circle"></i><span>'+a((t(n,"t")||e&&t(e,"t")||s).call(r,"Info",{name:"t",hash:{},data:o,loc:{start:{line:31,column:72},end:{line:31,column:84}}}))+'</span></div>\n        <span class="statusText"></span>\n    </div>\n    <div class="statusPanel Loading ui-state-highlight">\n        <div class="statusTitle"><i class="fa fa-spinner fa-pulse"></i><span>'+a((t(n,"t")||e&&t(e,"t")||s).call(r,"Loading",{name:"t",hash:{},data:o,loc:{start:{line:35,column:77},end:{line:35,column:92}}}))+'</span></div>\n        <span class="statusText"></span>\n    </div>\n<div class="statusPanel NoResults ui-state-highlight">\n        <div class="statusTitle"><i class="fa fa-info-circle"></i><span>'+a((t(n,"t")||e&&t(e,"t")||s).call(r,"No Results",{name:"t",hash:{},data:o,loc:{start:{line:39,column:72},end:{line:39,column:90}}}))+'</span></div>\n        <span class="statusText"></span>\n    </div>\n</div>\n\n<div class="progress-bar-div" style="width: 100%; height: 100%; overflow: hidden; position: absolute; left: 0; top: 0; z-index: 999;">\n    <div class="loading" style="display: table; width: 100%; height: 100%; max-height: 100%; opacity: 0.9; overflow: hidden;">\n        <div style="display: table-cell; width: 100%; height: 100%; max-height: 100%; vertical-align: middle; text-align: center;">\n            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="32" height="32" fill="#ffffff">\n                <circle cx="16" cy="3" r="0">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\n                </circle>\n                <circle transform="rotate(45 16 16)" cx="16" cy="3" r="0">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.125s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\n                </circle>\n                <circle transform="rotate(90 16 16)" cx="16" cy="3" r="0">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.25s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\n                </circle>\n                <circle transform="rotate(135 16 16)" cx="16" cy="3" r="0.567031">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.375s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\n                </circle>\n                <circle transform="rotate(180 16 16)" cx="16" cy="3" r="1.82452">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.5s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\n                </circle>\n                <circle transform="rotate(225 16 16)" cx="16" cy="3" r="2.88475">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.625s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\n                </circle>\n                <circle transform="rotate(270 16 16)" cx="16" cy="3" r="2.1029">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.75s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\n                </circle>\n                <circle transform="rotate(315 16 16)" cx="16" cy="3" r="0.60761">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.875s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\n                </circle>\n                <circle transform="rotate(180 16 16)" cx="16" cy="3" r="1.82452">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.5s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\n                </circle>\n            </svg>\n            <div class="loadingText" style="font-weight: bold; margin-top: 7px; font-size: 11px; letter-spacing: 1px;">\n                '+a((t(n,"t")||e&&t(e,"t")||s).call(r,"loading",{name:"t",hash:{},data:o,loc:{start:{line:77,column:16},end:{line:77,column:31}}}))+" "+a("function"==typeof(a=null!=(a=t(n,"componentName")||(null!=e?t(e,"componentName"):e))?a:s)?a.call(r,{name:"componentName",hash:{},data:o,loc:{start:{line:77,column:32},end:{line:77,column:49}}}):a)+"...\n            </div>\n        </div>\n    </div>\n</div>"},useData:!0}),je.DocumentSelector=s.template({1:function(t,e,n,i,o){var r,s=null!=e?e:t.nullContext||{},a=t.hooks.helperMissing,l=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <option value="'+l("function"==typeof(r=null!=(r=t(n,"id")||(null!=e?t(e,"id"):e))?r:a)?r.call(s,{name:"id",hash:{},data:o,loc:{start:{line:3,column:19},end:{line:3,column:25}}}):r)+'">'+l("function"==typeof(r=null!=(r=t(n,"name")||(null!=e?t(e,"name"):e))?r:a)?r.call(s,{name:"name",hash:{},data:o,loc:{start:{line:3,column:27},end:{line:3,column:35}}}):r)+"</option>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){return"<select>\n"+(null!=(n=(t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]})(n,"each").call(null!=e?e:t.nullContext||{},e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:4},end:{line:4,column:13}}}))?n:"")+"</select>\n"},useData:!0}),je.DocumentView=s.template({compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){return'<div class="screen-view-div">\n</div>\n\n'},useData:!0}),je.InBrowserNotification=s.template({1:function(t,e,n,i,o){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <i class="icon fa fa-'+t.escapeExpression("function"==typeof(n=null!=(n=r(n,"icon")||(null!=e?r(e,"icon"):e))?n:t.hooks.helperMissing)?n.call(null!=e?e:t.nullContext||{},{name:"icon",hash:{},data:o,loc:{start:{line:3,column:25},end:{line:3,column:33}}}):n)+'"></i>\n'},3:function(t,e,n,i,o){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <div class="ttl">'+t.escapeExpression("function"==typeof(n=null!=(n=r(n,"title")||(null!=e?r(e,"title"):e))?n:t.hooks.helperMissing)?n.call(null!=e?e:t.nullContext||{},{name:"title",hash:{},data:o,loc:{start:{line:7,column:21},end:{line:7,column:30}}}):n)+"</div>\n"},5:function(t,e,n,i,o){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <div class="msg">'+(null!=(r="function"==typeof(n=null!=(n=r(n,"message")||(null!=e?r(e,"message"):e))?n:t.hooks.helperMissing)?n.call(null!=e?e:t.nullContext||{},{name:"message",hash:{},data:o,loc:{start:{line:11,column:21},end:{line:11,column:34}}}):n)?r:"")+"</div>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){var r,s=null!=e?e:t.nullContext||{},a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="inBrowserNotification">\n'+(null!=(r=a(n,"if").call(s,null!=e?a(e,"icon"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:4},end:{line:4,column:11}}}))?r:"")+"\n"+(null!=(r=a(n,"if").call(s,null!=e?a(e,"title"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:6,column:4},end:{line:8,column:11}}}))?r:"")+"\n"+(null!=(r=a(n,"if").call(s,null!=e?a(e,"message"):e,{name:"if",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:10,column:4},end:{line:12,column:11}}}))?r:"")+'\n    <i class="fa fa-times-circle"></i>\n</div>'},useData:!0}),je.LoginDialog=s.template({compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){var r=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,a=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="login-container quick-base login-dialog ui-widget ui-widget-content ui-corner-all ui-front">\n    <div class="logo"></div>\n    <div class="login-form user-login-form open">\n\n        <div class="input-container" style="margin-top: 7px">\n\n            <span>'+a((t(n,"t")||e&&t(e,"t")||s).call(r,"User",{name:"t",hash:{},data:o,loc:{start:{line:7,column:18},end:{line:7,column:30}}}))+':\n            </span>\n            <span>\n                <input class="username" tabindex="1" type="text" name="username" />\n            </span>\n\n        </div>\n        <div class="input-container" style="margin-top: 11px;">\n            <span >'+a((t(n,"t")||e&&t(e,"t")||s).call(r,"Password",{name:"t",hash:{},data:o,loc:{start:{line:15,column:19},end:{line:15,column:35}}}))+':\n            </span>\n            <span>\n                <input class="password" tabindex="2" type="password" name="password" />\n            </span>\n        </div>\n        <div class="forgot-info">'+a((t(n,"t")||e&&t(e,"t")||s).call(r,"forgot password",{name:"t",hash:{},data:o,loc:{start:{line:21,column:33},end:{line:21,column:56}}}))+'?</div>\n        <div class="loginErrorPanel">'+a((t(n,"t")||e&&t(e,"t")||s).call(r,null!=e?t(e,"An"):e,null!=e?t(e,"error"):e,null!=e?t(e,"has"):e,null!=e?t(e,"occurred"):e,e,{name:"t",hash:{},data:o,loc:{start:{line:22,column:37},end:{line:22,column:65}}}))+'</div>\n    </div>\n    <div class="login-form forgot-password-form">\n        <div class="form-text">Reset Password</div>\n        <div class="input-container">\n            <span>'+a((t(n,"t")||e&&t(e,"t")||s).call(r,"User",{name:"t",hash:{},data:o,loc:{start:{line:27,column:18},end:{line:27,column:30}}}))+':\n            </span>\n            <span>\n                <input class="reset-username" type="text"/>\n            </span>\n        </div>\n        <div class="reset-password-error">'+a((t(n,"t")||e&&t(e,"t")||s).call(r,"Please enter valid user name",{name:"t",hash:{},data:o,loc:{start:{line:33,column:42},end:{line:33,column:78}}}))+'</div>\n    </div>\n    <div class="login-form password-reset-info">\n        <div class="recovery-response form-text"></div>\n    </div>\n    <div class="login-button-panel ui-dialog-buttonpane ui-helper-clearfix">\n        <button class="login-btn ui-button ui-widget" tabindex="3" ></button>\n        <button class="reset-btn ui-button ui-widget"></button>\n        <button class="back-btn ui-button ui-widget"></button>\n    </div>\n</div>'},useData:!0}),je.ProfileMenu=s.template({1:function(t,e,n,i,o){var r=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <option value="'+r(t.lambda(null!=e?s(e,"id"):e,e))+'">'+r((s(n,"t")||e&&s(e,"t")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},null!=e?s(e,"name"):e,{name:"t",hash:{},data:o,loc:{start:{line:6,column:40},end:{line:6,column:55}}}))+"</option>\n"},3:function(t,e,n,i,o){var r=t.lambda,s=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                <option value="'+s(r(null!=e?t(e,"value"):e,e))+'">'+s(r(null!=e?t(e,"label"):e,e))+"</option>\n"},5:function(t,e,n,i,o){var r,s=null!=e?e:t.nullContext||{},a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <optgroup label="'+t.escapeExpression("function"==typeof(r=null!=(r=a(n,"key")||o&&a(o,"key"))?r:t.hooks.helperMissing)?r.call(s,{name:"key",hash:{},data:o,loc:{start:{line:43,column:29},end:{line:43,column:37}}}):r)+'">\n'+(null!=(r=a(n,"each").call(s,e,{name:"each",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:44,column:16},end:{line:46,column:25}}}))?r:"")+"            </optgroup>\n"},7:function(t,e,n,i,o){var r=t.lambda,s=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <option value="'+s(r(null!=e?t(e,"value"):e,e))+'">'+s(r(null!=e?t(e,"label"):e,e))+"</option>\n"},9:function(t,e,n,i,o){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li data-options="document-breadcrumbs" class="breadcrumbs '+(null!=(n=r(n,"if").call(null!=e?e:t.nullContext||{},null!=e?r(e,"showBreadcrumbs"):e,{name:"if",hash:{},fn:t.program(10,o,0),inverse:t.noop,data:o,loc:{start:{line:64,column:63},end:{line:64,column:100}}}))?n:"")+'">\n        <label>Show Selection Breadcrumb</label>\n        <i class="fa fa-check ui-checkboxradio-icon" />\n    </li>\n'},10:function(t,e,n,i,o){return"checked"},12:function(t,e,n,i,o){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li class="ext-link" data-options="open-viewer">'+t.escapeExpression((r(n,"t")||e&&r(e,"t")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},"Open Viewer",{name:"t",hash:{},data:o,loc:{start:{line:70,column:52},end:{line:70,column:71}}}))+'<i class="fa fa-external-link"\n            aria-hidden="true"></i></li>\n'},14:function(t,e,n,i,o){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(n=r(n,"if").call(null!=e?e:t.nullContext||{},null!=e?r(e,"isLite"):e,{name:"if",hash:{},fn:t.program(15,o,0),inverse:t.noop,data:o,loc:{start:{line:73,column:4},end:{line:76,column:11}}}))?n:""},15:function(t,e,n,i,o){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li class="ext-link" data-options="open-editor">'+t.escapeExpression((r(n,"t")||e&&r(e,"t")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},"Open Editor",{name:"t",hash:{},data:o,loc:{start:{line:74,column:52},end:{line:74,column:71}}}))+'<i class="fa fa-external-link"\n            aria-hidden="true"></i></li>\n'},17:function(t,e,n,i,o){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li data-options="login-history">'+t.escapeExpression((r(n,"t")||e&&r(e,"t")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},"Login History",{name:"t",hash:{},data:o,loc:{start:{line:79,column:37},end:{line:79,column:58}}}))+"</li>\n"},19:function(t,e,n,i,o){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li data-options="helpguide">'+t.escapeExpression((r(n,"t")||e&&r(e,"t")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},"Help",{name:"t",hash:{},data:o,loc:{start:{line:83,column:33},end:{line:83,column:45}}}))+"</li>\n"},21:function(t,e,n,i,o){var r=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,a=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li data-options="logout-local">'+a((t(n,"t")||e&&t(e,"t")||s).call(r,"Local Logout",{name:"t",hash:{},data:o,loc:{start:{line:86,column:36},end:{line:86,column:56}}}))+'</li>\n    <li data-options="logout-global">'+a((t(n,"t")||e&&t(e,"t")||s).call(r,"Global Logout",{name:"t",hash:{},data:o,loc:{start:{line:87,column:37},end:{line:87,column:58}}}))+"</li>\n"},23:function(t,e,n,i,o){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(n=r(n,"unless").call(null!=e?e:t.nullContext||{},null!=e?r(e,"isLite"):e,{name:"unless",hash:{},fn:t.program(24,o,0),inverse:t.noop,data:o,loc:{start:{line:89,column:4},end:{line:92,column:15}}}))?n:""},24:function(t,e,n,i,o){var r=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,a=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li data-options="change-password">'+a((t(n,"t")||e&&t(e,"t")||s).call(r,"Change Password",{name:"t",hash:{},data:o,loc:{start:{line:90,column:39},end:{line:90,column:62}}}))+'</li>\n    <li data-options="logout">'+a((t(n,"t")||e&&t(e,"t")||s).call(r,"Logout",{name:"t",hash:{},data:o,loc:{start:{line:91,column:30},end:{line:91,column:44}}}))+"</li>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){var r,s=null!=e?e:t.nullContext||{},a=t.hooks.helperMissing,l=t.escapeExpression,u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="row theme">\n    <div class="label">'+l((u(n,"t")||e&&u(e,"t")||a).call(s,"Editor Theme",{name:"t",hash:{},data:o,loc:{start:{line:2,column:23},end:{line:2,column:43}}}))+'</div>\n    <div class="control">\n        <select style="width: 100%" class="select-theme">\n'+(null!=(r=u(n,"each").call(s,null!=e?u(e,"themes"):e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:5,column:12},end:{line:7,column:21}}}))?r:"")+'        </select>\n    </div>\n</div>\n<div class="row viewer-theme">\n    <div class="label">'+l((u(n,"t")||e&&u(e,"t")||a).call(s,"Theme",{name:"t",hash:{},data:o,loc:{start:{line:12,column:23},end:{line:12,column:36}}}))+'</div>\n    <div class="control">\n        <select style="width: 100%" class="select-viewer-theme">\n'+(null!=(r=u(n,"each").call(s,null!=e?u(e,"themes"):e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:15,column:12},end:{line:17,column:21}}}))?r:"")+'        </select>\n    </div>\n</div>\n\x3c!-- <div class="row language">\n    <div class="label">'+l((u(n,"t")||e&&u(e,"t")||a).call(s,"Language",{name:"t",hash:{},data:o,loc:{start:{line:22,column:23},end:{line:22,column:39}}}))+'</div>\n    <div class="control">\n        <select style="width: 100%" class="select-language">\n            <option value="en">'+l((u(n,"t")||e&&u(e,"t")||a).call(s,"English",{name:"t",hash:{},data:o,loc:{start:{line:25,column:31},end:{line:25,column:46}}}))+'</option>\n            <option value="zh-HK">'+l((u(n,"t")||e&&u(e,"t")||a).call(s,"Chinese HK",{name:"t",hash:{},data:o,loc:{start:{line:26,column:34},end:{line:26,column:52}}}))+'</option>\n            <option value="de">'+l((u(n,"t")||e&&u(e,"t")||a).call(s,"German",{name:"t",hash:{},data:o,loc:{start:{line:27,column:31},end:{line:27,column:45}}}))+'</option>\n            <option value="ja">'+l((u(n,"t")||e&&u(e,"t")||a).call(s,"Japanese",{name:"t",hash:{},data:o,loc:{start:{line:28,column:31},end:{line:28,column:47}}}))+'</option>\n            <option value="ar">'+l((u(n,"t")||e&&u(e,"t")||a).call(s,"Arabic",{name:"t",hash:{},data:o,loc:{start:{line:29,column:31},end:{line:29,column:45}}}))+'</option>\n        </select>\n    </div>\n</div> --\x3e\n<div class="row timezone">\n    <div class="label">'+l((u(n,"t")||e&&u(e,"t")||a).call(s,"Timezone",{name:"t",hash:{},data:o,loc:{start:{line:34,column:23},end:{line:34,column:39}}}))+'</div>\n    <div class="control">\n        <select style="width: 100%" class="select-timezone">\n            <optgroup label="Major">\n'+(null!=(r=u(n,"each").call(s,null!=e?u(e,"majorTimezones"):e,{name:"each",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:38,column:16},end:{line:40,column:25}}}))?r:"")+"            </optgroup>\n"+(null!=(r=u(n,"each").call(s,null!=e?u(e,"timezones"):e,{name:"each",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:42,column:12},end:{line:48,column:21}}}))?r:"")+'        </select>\n    </div>\n</div>\n<div class="row log-level">\n    <div class="label">'+l((u(n,"t")||e&&u(e,"t")||a).call(s,"Log Level",{name:"t",hash:{},data:o,loc:{start:{line:53,column:23},end:{line:53,column:40}}}))+'</div>\n    <div class="control">\n        <select style="width: 100%" class="select-log-level">\n'+(null!=(r=u(n,"each").call(s,null!=e?u(e,"logLevel"):e,{name:"each",hash:{},fn:t.program(7,o,0),inverse:t.noop,data:o,loc:{start:{line:56,column:12},end:{line:58,column:21}}}))?r:"")+'        </select>\n    </div>\n</div>\n<ul class="buttonset">\n'+(null!=(r=u(n,"if").call(s,null!=e?u(e,"editor"):e,{name:"if",hash:{},fn:t.program(9,o,0),inverse:t.noop,data:o,loc:{start:{line:63,column:4},end:{line:68,column:11}}}))?r:"")+(null!=(r=u(n,"if").call(s,null!=e?u(e,"editor"):e,{name:"if",hash:{},fn:t.program(12,o,0),inverse:t.program(14,o,0),data:o,loc:{start:{line:69,column:4},end:{line:77,column:11}}}))?r:"")+(null!=(r=u(n,"unless").call(s,null!=e?u(e,"isLite"):e,{name:"unless",hash:{},fn:t.program(17,o,0),inverse:t.noop,data:o,loc:{start:{line:78,column:4},end:{line:80,column:15}}}))?r:"")+'    <li data-options="about">'+l((u(n,"t")||e&&u(e,"t")||a).call(s,"About",{name:"t",hash:{},data:o,loc:{start:{line:81,column:29},end:{line:81,column:42}}}))+"</li>\n"+(null!=(r=u(n,"if").call(s,null!=e?u(e,"editor"):e,{name:"if",hash:{},fn:t.program(19,o,0),inverse:t.noop,data:o,loc:{start:{line:82,column:4},end:{line:84,column:11}}}))?r:"")+(null!=(r=u(n,"if").call(s,null!=e?u(e,"saml"):e,{name:"if",hash:{},fn:t.program(21,o,0),inverse:t.program(23,o,0),data:o,loc:{start:{line:85,column:4},end:{line:93,column:11}}}))?r:"")+"</ul>"},useData:!0}),je.fileExporter=s.template({compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){var r=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,a=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="pnlButtons">\n    <span class="lnksExport link-disabled">\n        <i class="fa fa-fw fa-download" title="'+a((t(n,"t")||e&&t(e,"t")||s).call(r,"Data",{name:"t",hash:{},data:o,loc:{start:{line:3,column:47},end:{line:3,column:59}}}))+'"></i>\n        <a class="lnkExcelExport" title="'+a((t(n,"t")||e&&t(e,"t")||s).call(r,"Download the current dataset in Excel format",{name:"t",hash:{},data:o,loc:{start:{line:4,column:41},end:{line:4,column:93}}}))+'">'+a((t(n,"t")||e&&t(e,"t")||s).call(r,"Excel",{name:"t",hash:{},data:o,loc:{start:{line:4,column:95},end:{line:4,column:108}}}))+'</a>\n        <a class="lnkCsvExport" title="'+a((t(n,"t")||e&&t(e,"t")||s).call(r,"Download the current dataset in CSV format",{name:"t",hash:{},data:o,loc:{start:{line:5,column:39},end:{line:5,column:89}}}))+'">'+a((t(n,"t")||e&&t(e,"t")||s).call(r,"CSV",{name:"t",hash:{},data:o,loc:{start:{line:5,column:91},end:{line:5,column:102}}}))+'</a>\n        <a class="lnkFullExport" title="'+a((t(n,"t")||e&&t(e,"t")||s).call(r,"Download the full dataset from the server",{name:"t",hash:{},data:o,loc:{start:{line:6,column:40},end:{line:6,column:89}}}))+'">'+a((t(n,"t")||e&&t(e,"t")||s).call(r,"Full",{name:"t",hash:{},data:o,loc:{start:{line:6,column:91},end:{line:6,column:103}}}))+'</a>\n        <a class="lnkDownloadScreenshot" title="'+a((t(n,"t")||e&&t(e,"t")||s).call(r,"Download a PNG image of the chart",{name:"t",hash:{},data:o,loc:{start:{line:7,column:48},end:{line:7,column:89}}}))+'">'+a((t(n,"t")||e&&t(e,"t")||s).call(r,"PNG",{name:"t",hash:{},data:o,loc:{start:{line:7,column:91},end:{line:7,column:102}}}))+"</a>\n    </span> \n</div> \n"},useData:!0}),je.popup=s.template({compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){return'<div class="dialog">\n    <div class="content-panel" tabindex="1"></div>\n</div>'},useData:!0}),wt.T=je,De=I=I||{},Me=m.View,l(Ge,Me),Ge.prototype.remove=function(){return this.stopListening(),this.$el.off(),m.View.prototype.remove.call(this)},De.AboutDialog=Ge,_t=I=I||{},Ee=m.View,l(Xe,Ee),Xe.prototype.adjustWeights=function(t,n){var i=this.sum(_.map(t,function(t){return t.weight})),o=this.sum(n);_.each(t,function(t,e){t.weight=i*(n[e]/o)})},Xe.prototype.onClick=function(t){t.isExpanded=!t.isExpanded,this.updateLayout(!0)},Xe.prototype.onSectionResize=function(t,e,n){for(var i,o,r=0,s=t.$el.height(),a=s-n.originalSize.height,l=[t],u=[s],c=this.sections.indexOf(t)+1;c<this.sections.length&&(!(i=this.sections[c]).isExpanded||i.fixed||(o=Math.max(this.HEADING_HEIGHT,i.startHeight-(a-r)),r+=Math.min(i.startHeight-this.HEADING_HEIGHT,a-r),i.$el.height(o+"px"),l.push(i),u.push(o),r!==a));c+=1);this.adjustWeights(l,u)},Xe.prototype.resize=function(){this.updateLayout(!1)},Xe.prototype.setExpanded=function(t,e,n){n=n||!0,this.sections[t].isExpanded=e,this.updateLayout(n)},Xe.prototype.sum=function(t){return _.reduce(t,function(t,e){return t+e},0)},Xe.prototype.updateLayout=function(t){var n,e,i=this,o=i.$el.height();i.$el.toggleClass("animate",t),e=_.filter(i.sections,{isExpanded:!0}),o=(o-=(i.sections.length-e.length)*i.HEADING_HEIGHT)-this.sum(_.map(_.filter(e,function(t){return t.isExpanded&&t.fixed}),function(t){return t.fixed})),e=this.sum(_.map(e,function(t){return t.weight})),n=o/e,_.each(i.sections,function(t,e){t.$el.toggleClass("expanded",t.isExpanded),t.isExpanded?t.$el.height((t.fixed||t.weight*n)+"px"):t.$el.height(0),t.resize&&t.resize(),t.isResizable&&t.isExpanded&&!t.fixed&&e<i.sections.length-1&&_.some(i.sections.slice(e+1),function(t){return t.isExpanded&&!t.fixed})?t.resizeable=t.$el.resizable({handles:"s",resize:$.proxy(i.onSectionResize,i,t),start:function(){_.each(i.sections,function(t){t.startHeight=t.$el.height()}),t.$el.resizable("option","maxHeight",i.$el.height()-(i.sections.length-1)*i.HEADING_HEIGHT)},stop:function(){i.updateLayout()}}):t.resizeable&&(t.$el.resizable("destroy"),delete t.resizeable)}),t?this.debouncedRemoveAnimate():i.onUpdate&&i.onUpdate(i.sections)},_t.AccordionView=Xe,function(t){function e(){_.extend(this,m.Events)}e.prototype.on=function(t,e,n){},e.prototype.off=function(t,e,n){},e.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n]},e.prototype.bind=function(t,e,n){},e.prototype.unbind=function(t,e,n){},e.prototype.once=function(t,e,n){},e.prototype.listenTo=function(t,e,n){},e.prototype.listenToOnce=function(t,e,n){},e.prototype.stopListening=function(t,e,n){},t.CustomEvents=e}(I=I||{});Nn.getComponentViewStates=function(t,n){void 0===n&&(n=!0);function i(e){e&&(e instanceof I.Component?(n&&(e.get("components").each(function(t){i(t)}),e.get("widgets").each(function(t){i(t.get("component"))})),i(e.get("options"))):_.isArray(e)?_.each(e,function(t){i(t)}):e.attributes?e.path?e.get("_dataSource")||_.includes(o,e.path)||(o.push(e.path),"dict"===e.get("_type")&&_.each(e.get("_default"),function(t){t instanceof I.DocumentViewModel&&o.push(t.path)})):i(e.attributes):!_.isObject(e)||e instanceof m.View||("viewstate"===e._dashboardsType?_.includes(o,e.value)||o.push(e.value):_.each(_.keys(e),function(t){i(e[t])})))}var o=[];return i(t),o},Nn.mergeViewStates=function(t,r){var s;t&&r&&(_.each(t,function(t,e){if(!r.get("viewState").getByPath(e)){var n=e.split("/"),i=null,e=void 0;if(n.length<=1)s=n[0],i=new I.DocumentViewModel(t,null);else{for(var i=r.get("viewState"),o=0;o<n.length-1;o+=1)i.set(n[o],i.get(n[o])||new I.DocumentViewModel(null,null)),i=i.get(n[o]),s=0===o?n[o]:n.slice(0,o).join("/"),i.path=s;s=n.join("/"),e=new I.DocumentViewModel(t,null),i.set(n[n.length-1],e),e.path=s}r.get("viewState").getByPath(s)||(i.path=s,r.get("viewState").set(s,i))}}),r.get("viewState").postInitialize())},Nn.getMappingDataSources=function(n,t){var i=[];return t.get("data").getTreeList().forEach(function(e){e.get("_mappings")&&_.each(e.get("_mappings").mappings,function(t){_.includes(n,t.value)&&(i[e.path]=e.toJSON())})}),i},Nn.mergeDataSources=function(t,a){var l;t&&(l=a.get("data"),_.each(t,function(t,e){for(var n,i=_.filter(e.split("/"),function(t){return t&&0<t.length}),o=l,r="",s=0;s<i.length;s+=1)r=(r+=0===s?"":"/")+i[s],n=new I.DocumentDataModel(s!==i.length-1?{}:t,l,r,a.get("viewState"),s!==i.length-1),o=a.get("data").getByPath(r)?a.get("data").getByPath(r):(o.set(i[s],n),n.viewState=a.attributes.viewState,n)}))},Nn.getComponentDataSources=function(t,n,i,o){void 0===o&&(o=!0);var r,s={},a={},l=function(t){return t._cpKey||(_.isObject(t)||_.isArray(t))&&(Object.defineProperty(t,"_cpKey",{enumerable:!1,writable:!0}),t._cpKey=_.uniqueId("_cpKey_")),t._cpKey||null},u=function(e){!e||(r=l(e))&&a[r]||(r&&(a[r]=!0),!o&&(e instanceof I.WidgetCollection||e instanceof I.ComponentCollection)||(_.isArray(e)?_.each(e,function(t){u(t)}):e.attributes?(e.attributes._dataType&&_.includes(["analytic","pivot","query","virtual","builder"],e.attributes._dataType)&&(_.each(e.getViewStateDict(),function(t){_.includes(n,t.path)||(n.push(t.path),"dict"===t.get("_type")&&_.each(t.get("_default"),function(t){t instanceof I.DocumentViewModel&&n.push(t.path)}))}),"virtual"===e.attributes._dataType&&_.each(e.get("_virtualParams"),function(t){var e;"datasource"===t.type&&(e=i.getByPath(t.value))&&(_.each(e.getViewStateDict(),function(t){_.includes(n,t.path)||n.push(t.path)}),s[t.value]=e.toJSON())}),s[e.path]=e.toJSON()),u(e.attributes)):!_.isObject(e)||e instanceof m.View||("data"===e._dashboardsType?s[e.value]||u(i.getByPath(e.value)):_.each(_.keys(e),function(t){u(e[t])}))))};return u(t),s};var Ze,Je,tn,E,en,nn,on,rn,sn,an,ln,un,cn,pn,dn,hn,gn,fn,mn,yn,vn,bn,wn,Sn,_n,Cn,Tn,P,Dn,Mn,En,Pn,In,kn,I,An,xn=Nn;function Nn(t){}function k(t,e,n,i,o){var r=Je.call(this)||this;return r.nodes={},r.edges={},r.edgesR={},r.subscriptions={},r.activeViewStateToSubscriptions={},r.getDataSourceByPath=i,r.viewState=t,r.dataSources=e,r.onNodeUpdate=o,r.viewState.getViewStateList().forEach(function(t){var e=r.addNode("vs",t.path,t.model);"dict"===t.model.get("_type")&&_.each(t.model.get("value"),function(t){t&&t.path&&(t=r.addNode("vs",t.path,t),r.addEdge({fromNodeId:t,toNodeId:e}))})}),_.each(r.dataSources.flatten(),function(e){var n;e&&e.path&&(n=r.addNode("ds",e.path,e),_.each(e.getViewStateDict(),function(t){t&&t.path&&r.addEdge({fromNodeId:"vs:"+t.path,toNodeId:n})}),_.each(e.getMappedViewStates(),function(t){t&&t.path&&r.addEdge({fromNodeId:n,toNodeId:"vs:"+t.path})}),"virtual"===e.get("_dataType")&&_.each(_.filter(e.get("_virtualParams"),{type:"datasource"}).map(function(t){return t.value}),function(t){r.getDataSourceByPath(t)?(t=r.addNode("ds",t,e),r.addEdge({fromNodeId:t,toNodeId:n})):Ze.Log.Warn("DocumentGraph: "+e.path+" has invalid source parameter  "+e.path)}))}),_.isUndefined(r.hierarchical)&&(r.hierarchical=_.keys(r.nodes).length<20),_.each(n,function(t){var n,e=xn.getComponentViewStates(t,!1),i=xn.getComponentDataSources(t,e,r.dataSources,!1);!e.length&&_.isEmpty(i)||(n=r.addNode(t.get("key"),t.get("key")+"-"+t.get("_cpKey").substring(7),t),_.each(e,function(t){r.addEdge({fromNodeId:"vs:"+t,toNodeId:n})}),_.each(i,function(t,e){r.addEdge({fromNodeId:"ds:"+e,toNodeId:n})}))}),r}function A(){}function x(t){var e=en.call(this)||this,n=(e.saveSettingsNowDebounced=_.debounce(e.saveSettingsNow.bind(e),100),e.activeViewStateToPropertyPaths={},e.propertyPathsToViewStates={},e.activeViewStateToSubscriptions={},e.subscriptionsToViewStates={},e.viewStateSubscriptions={},e.interface={},e.subscriptions={},e.getTemplateViewStates=function(t){return this.processTemplateViewStates(this.getViewStates(this.extractTemplateViewStates(t)))},e.notifyViewStateSubscriber=function(t){var e=this.viewStateSubscriptions[t],t=this.subscriptionsToViewStates[t];_.isFunction(e)&&e(this.getViewStates(t))},e.subscribe=function(t,e,n,i){var o;if("data"===this.getSourceType(t)){if(o=this.getDataSourceKey(t),this.subscriptions[o])return this.subscriptions[o].callback=e,!1;this.subscriptions[o]={key:this.getSubscriptionKey(t.path),source:t,onData:e},t.subscribe(this.subscriptions[o].key,this.subscriptions[o],n,i)}else E.Log.Warn("Source type not implemented")},e.subscribeTemplateViewStates=function(t,e){var n=this;return this.subscribeViewStates(this.extractTemplateViewStates(t),function(t){e(n.processTemplateViewStates(t))})},e.subscribeViewStates=function(t,e){var n=this,i=_.uniqueId("vs_");return this.viewStateSubscriptions[i]=e,this.subscriptionsToViewStates[i]=[],_.each(t,function(t){t=n.docViewModel.getByPath(t);t&&(n.subscriptionsToViewStates[i].push(t.path),n.activeViewStateToSubscriptions[t.path]?-1===n.activeViewStateToSubscriptions[t.path].indexOf(i)&&n.activeViewStateToSubscriptions[t.path].push(i):(n.activeViewStateToSubscriptions[t.path]=[i],n.listenTo(t,"change:value",function(t,e){var n=this;_.each(this.activeViewStateToSubscriptions[t.path],function(t){n.notifyViewStateSubscriber(t)})})))}),this.notifyViewStateSubscriber(i),i},e.unsubscribe=function(t){var e;switch(this.getSourceType(t)){case"data":e=this.getDataSourceKey(t),this.subscriptions[e]&&(t.unsubscribe(this.subscriptions[e].key),delete this.subscriptions[e]);break;case"viewstate":this.stopListening(t,"change:value")}},e.unsubscribeAll=function(){var i=this;_.each(this.subscriptions,function(t,e){t.source.unsubscribe(t.key),delete i.subscriptions[e]}),_.defer(function(){_.each(i.activeViewStateToPropertyPaths,function(t,e){var n=i.docViewModel.getByPath(e);i.stopListening(n,"change:value"),delete i.activeViewStateToPropertyPaths[e]}),_.each(i.activeViewStateToSubscriptions,function(t,e){var n=i.docViewModel.getByPath(e);i.stopListening(n,"change:value"),delete i.activeViewStateToSubscriptions[e]})})},e.unsubscribeViewStates=function(n){var i=this;this.viewStateSubscriptions[n]&&(_.each(this.subscriptionsToViewStates[n],function(t){var e;i.activeViewStateToSubscriptions[t]=_.without(i.activeViewStateToSubscriptions[t],n),_.isEmpty(i.activeViewStateToSubscriptions[t])&&_.isEmpty(i.activeViewStateToPropertyPaths[t])&&(e=i.docViewModel.getByPath(t),i.stopListening(e,"change:value"),delete i.activeViewStateToSubscriptions[t])}),delete this.subscriptionsToViewStates[n],delete this.viewStateSubscriptions[n])},e.unsubscribeTemplateViewStates=function(t){this.unsubscribeViewStates(t)},[]);return e.appKey=t.appKey,e.componentId=t.componentId,e.dashboardAppModel=t.dashboardAppModel,e.dashboardViewModel=t.dashboardViewModel,e.deltaClient=t.deltaClient,e.deltaClientLib=t.deltaClientLib,e.docDataModel=t.docDataModel,e.docViewModel=t.docViewModel,e.settingsModel=t.settingsModel,e.quickView=t.quickView,e.widgetId=t.widgetId,e.activeViewStateToPropertyPaths={},e.propertyPathsToViewStates={},e.interface={},e.subscriptions={},n=_.union(n,x.API_METHODS),t.advancedMethods&&(n=_.union(n,x.ADVANCED_METHODS)),_.each(n,_.bind(function(t){_.isFunction(this[t])?this.interface[t]=_.bind(this[t],this):_.isUndefined(this[t])||(this.interface[t]=this[t])},e)),e.listenTo(e.docViewModel,"change",function(t,e){var i,o;e&&e.unset?(this.renamingViewState=(t.path?t.path+"/":"")+_.first(_.keys(t.changed)),_.defer(_.bind(function(){this.renamingViewState=null},this))):(this.renamingViewState&&(i=this.renamingViewState,o=(t.path?t.path+"/":"")+_.first(_.keys(t.changed)),i!==o&&(this.activeViewStateToPropertyPaths[i]&&(this.activeViewStateToPropertyPaths[o]=this.activeViewStateToPropertyPaths[i],delete this.activeViewStateToPropertyPaths[i]),this.activeViewStateToSubscriptions[i]&&(this.activeViewStateToSubscriptions[o]=this.activeViewStateToSubscriptions[i],delete this.activeViewStateToSubscriptions[i]),_.each(this.propertyPathsToViewStates,_.bind(function(t,e){t===i&&(this.propertyPathsToViewStates[e]=o)},this)),_.each(this.subscriptionsToViewStates,_.bind(function(t,n){_.each(t,function(t,e){t===i&&(this.subscriptionsToViewStates[n][e]=o)})},this)))),this.renamingViewState=null)}),e}function Ln(t){var e=on.call(this,t)||this;return e.$appDiv=null,e.app=null,e.appOnSettingsChange=null,t.el||e.el.classList.add("component-build-view"),_.extend(e,_.pick(t,Ln.COMMON_OPTIONS)),t.key?(e.componentId=t.namespace||_.uniqueId("component_"),e.appOptions=t.appOptions,e.key=t.key,e.settingsModel=t.settings instanceof m.Model?t.settings:new nn.ComponentOptions(t.settings,{},null)):(e.componentId=e.model.id,e.key=e.model.get("key"),e.settingsModel=e.model.get("options")),e.initializeApi(),e.render(),e.requireApp(),e}function Vn(t){var e=sn.call(this,t)||this;return e.isCancel=!1,e.options=t,e.preRender(),e.render(),e.postRender(),e.resizeListener=e.onResize.bind(e),$(window).on("resize",e.resizeListener),e}function On(t){return ln.call(this,_.extend({iconClass:"fa-asterisk",dialogTitle:"Save Changes",minHeight:110,width:300},t,{userClass:"areyousure-dialog"+(t.userClass?" "+t.userClass:"")}))||this}function Bn(e){var n=cn.call(this,e)||this,i=(n.MESSAGE_TYPES=["error","success","warning"],n.clicked=!1,m.Model.extend({schema:{username:{title:t("Username")},oldpassword:{title:t("Current Password"),type:"Password",validators:["required"]},password1:{title:t("New Password"),type:"Password",validators:["required"]},password2:{title:t("Re-Enter"),type:"Password",validators:[{type:"match",field:"password1",message:"Passwords must match!"},"required"]}}}));return n.boundToggleCaps=n.toggleCapsLockMsg.bind(n),n.model=new i({username:void 0}),delete n.model.schema.username,n.form=new m.Form({model:n.model}).render(),n.$el.append(n.form.el),n.$el.append('<div class="message-box">'),$(n.form.el).submit($.proxy(n.onSubmit,n)),n.$messageBox=n.$el.find(".message-box"),e.message?n.showMessage(e.message):n.showMessage(),n.onChangeSuccess=e.onChangeSuccess,n.$dialog=n.$el.dialog(_.extend({appendTo:e.container,dialogClass:"quick-base change-password-dialog",title:t("Change Password"),resizable:!1,height:262,width:320,modal:!0,autoOpen:!0,draggable:!0,buttons:[{text:t("OK"),click:$.proxy(n.onSubmit,n),icons:{primary:"fa fa-check"}},{text:t("Cancel"),click:$.proxy(n.close,n),icons:{primary:"fa fa-times"}}],open:function(){$('<i class="fa fa-check" />').insertBefore(n.$el.parent().find(".ui-dialog-title")),$(".quick-base").addClass("disturbed"),n.$okBtn=$(n).parent().find(".ui-dialog-buttonpane button").first(),n.$el.find(".old-password-input").focus()},close:function(){$(".quick-base").removeClass("disturbed"),un.ErrorTooltip.clearAll(),_.isFunction(e.onClose)&&e.onClose(),n.onRemove(),_.isFunction(e.onDialogClose)&&e.onDialogClose()}},e)),$(n.form.el).find("input").on("keydown",function(t){13===t.which&&n.onSubmit()}),$(n.form.el).find("input").on("keypress",function(e){un.LoginDialog.checkCapslockOn(e.originalEvent)?n.showMessage('<i class="fa fa-warning"/>'+t("Caps Lock is on"),"warning"):n.showMessage()}),window.addEventListener("keydown",n.boundToggleCaps,!0),n}function Rn(t){var e=pn.call(this,_.extend({iconClass:"fa-trash-o",dialogTitle:"Confirm Delete",minHeight:110,width:275},t,{userClass:"confirm-dialog"+(t.userClass?" "+t.userClass:"")}))||this;return _.isFunction(t.renderTemplate)&&(e.renderTemplate=t.renderTemplate),e}function $n(t){return dn.call(this,_.extend({iconClass:"fa-exclamation-triangle",dialogTitle:"Error",minHeight:110,width:275},t,{userClass:"error-dialog"+(t.userClass?" "+t.userClass:"")}))||this}function Un(t){return gn.call(this,_.extend({dialogTitle:"Warning"},t,{userClass:"warning-dialog"+(t.userClass?" "+t.userClass:"")}))||this}function N(t){t=mn.call(this,t)||this;return t.COMPONENT_SAVE_TIMEOUT=2e3,t.QUERY_STATUS_DELAY=200,t.QUERY_STATUS_FADE=3e3,t.showNoResultsIndicators=!1,t.customErrorClass="",t.model.set("upgrading",!0,{silent:!0}),N._instances.push(t),t}function L(t){t=vn.call(this,t)||this;return t.widgetClass="component-drop-widget",t}function Fn(t){var e=wn.call(this,t)||this;return e.appModel=null,e.availableHeight=0,e.documentsList=null,e.documentTypeMap=null,e.showManage=!1,e.viewModel=null,e.RECENT_DOCUMENT_COUNT=3,e.appModel=t.appModel,e.viewModel=t.viewModel,e.showManage=t.showManage,e.debouncedRender=_.debounce(e.render,100),e.initializeEvents(),e}function V(t){var e=_n.call(this,t)||this;return e.cssClasses=null,e.customCss=null,e.$customCss=null,e.popups=[],e.prevCssViewModel=null,e.appModel=t.appModel,e.viewModel=t.viewModel,e.quickView=t.quickView,e.model.upgrade(),e.el.className="document-view",e.$el.html(Sn.T.DocumentView({})),e.initializeEvents(),e.applyCustomCss(),e.onCssClassesChanged(),e.onSelectedScreenChanged(),e.quickView||e.onResetPopups(),e}function qn(t){var e=Tn.call(this,t)||this;return e.errorMessage=t.errorMessage,e.appModel=t.appModel,e.container=t.container,e.doLogin=t.doLogin,e.container.html(e.render().$el),e.boundCapsLockFn=$.proxy(e.onWindowCapsLockClick,e),e.initializeEvents(),e}function Yn(t){var e=Dn.call(this,t)||this;return e.MAJOR_TIMEZONES=[{label:"UTC / Unaltered",value:"UTC"},{label:"Frankfurt",value:"Europe/Berlin"},{label:"London",value:"Europe/London"},{label:"New York",value:"America/New_York"},{label:"Sydney",value:"Australia/Sydney"},{label:"Tokyo",value:"Asia/Tokyo"}],e.logLevels=[{label:"None",value:0},{label:"Errors",value:1},{label:"Handled/Warnings",value:2},{label:"Log & Debugs",value:3},{label:"All",value:4}],e.dialogContainer=null,e.isQuickView=!1,e.el.className="account-menu ui-widget ui-widget-content",e.appModel=t.appModel,e.dialogContainer=t.dialogContainer,e.themes=t.themes,e.viewModel=t.viewModel,e.isQuickView=!!t.isQuickView,e.$el.click(function(t){$(t.target).is("li")||t.stopPropagation()}),e.listenTo(e.viewModel,"change:themeSwitchable",e.onThemeSwitchableChange),e.getTimezones(),e.render(),e}function O(t){var e=En.call(this,t)||this;return e.viewStateListeners={},e.appModel=t.appModel,e.viewModel=t.viewModel,e.quickView=t.quickView,e.isEditing=t.isEditing,e.$el.html(Mn.T.popup({})),e.$dialog=e.$el.find(".dialog"),e.$contentPanel=e.$dialog.find(".content-panel"),t.container?e.$dialogContainer=t.container:e.$dialogContainer=$(".quick-dash > .content-panel > .document-view"),e.onDialogAttributeChange=_.debounce(e.initializeDialog,100),e.initializeDialog(),e.initializeEvents(),e.initializeVisible(),e}function Hn(t){return Pn.call(this,_.extend({iconClass:"fa-keyboard-o",dialogTitle:"Simple Input",userClass:"simpleinput-dialog",width:275,height:140},t,{userClass:"simpleinput-dialog"+(t.userClass?" "+t.userClass:"")}))||this}function Kn(t){var e=kn.call(this,t)||this;return e.DATA_SOURCE_PROPERTY="Basics.Data",e.EXPORT_PROPERTY_OBJECT="FileExport",e.EXPORT_PROPERTY_KEYS=["ShowExportCsvButton","ShowExportExcelButton","ShowFullExportButton","ShowClipboard","ShowScreenshot"],_.extend(e,_.pick(t,e.SETTINGS)),e.isIE=HTMLCanvasElement&&HTMLCanvasElement.prototype&&HTMLCanvasElement.prototype.msToBlob,e.$el.html(In.T.fileExporter({})),e.$root=e.$el.find(">.pnlButtons"),e.$lnksExport=e.$el.find(".lnksExport"),e.$lnkCsvExport=e.$el.find("a.lnkCsvExport"),e.$lnkExcelExport=e.$el.find("a.lnkExcelExport"),e.$lnkFullExport=e.$el.find("a.lnkFullExport"),e.$lnksScreenshot=e.$el.find(".lnksScreenshot"),e.$lnkCopyScreenshot=e.$el.find("a.lnkCopyScreenshot"),e.$lnkDownloadScreenshot=e.$el.find("a.lnkDownloadScreenshot"),e.initializeEvents(),e}function B(){}Ze=I=I||{},Je=Ze.CustomEvents,l(k,Je),k.addEdgeToCollection=function(t,e,n){var i=t[e];i?-1===i.indexOf(n)&&i.push(n):t[e]=[n]},k.prototype.getFormDataSources=function(t,e,n){var i=this,o=this.getRelatedDataSources(_.map(t,function(t){return"vs:"+t}),this.edges),t=this.getRelatedDataSources(_.map(t,function(t){return"vs:"+t}),this.edgesR),e=this.getRelatedDataSources(_.map(e,function(t){return"ds:"+t}),this.edgesR),n=this.getRelatedDataSources(_.map(n,function(t){return"vs:"+t}),this.edgesR);return _.map(_.union(_.intersection(o,e),_.intersection(o,t),n),function(t){return i.nodes[t].model})},k.prototype.getIsolatedNodes=function(t,e){var n=this;return _.filter(t,function(t){t=e+t.path;return!n.edges[t]&&!n.edgesR[t]})},k.prototype.getIsolatedDataSources=function(){return this.getIsolatedNodes(this.dataSources.flatten(),"ds:")},k.prototype.getIsolatedViewStates=function(){return this.getIsolatedNodes(this.viewState.getViewStateList(),"vs:")},k.prototype.onSearch=function(t){var e=this;_.each(this.nodes,function(t){t.searched=!1}),_.each(t,function(t){e.depthFirstSearch(t)})},k.prototype.unsubscribeAll=function(){var e=this;_.each(this.subscriptions,function(t){return e.unsubscribe(t.source)}),_.each(this.activeViewStateToSubscriptions,function(t){return e.unsubscribeViewStates(t)})},k.prototype.addEdge=function(t){var e=t.fromNodeId,t=t.toNodeId;k.addEdgeToCollection(this.edges,e,t),k.addEdgeToCollection(this.edgesR,t,e)},k.prototype.addNode=function(t,e,n){var i=t+":"+e;return this.nodes[i]||(this.nodes[i]={id:i,label:e,model:n,visited:!1,searched:!1}),this.onNodeUpdate&&("ds"===t&&n.agent.subscriberCount()&&this.subscribe(n,this.onNodeUpdate(i),i),"vs"===t&&(this.activeViewStateToSubscriptions[n.path]=n,this.listenTo(n,"change:value",this.onNodeUpdate(i)))),i},k.prototype.breadthFirstSearch=function(t,e){return _.each(this.nodes,function(t){t.visited=!1}),this.visitAndMeetNeighbors(t,e)},k.prototype.depthFirstSearch=function(t){var e=this,n=this.edges[t]||[],i=this.edgesR[t]||[];this.nodes[t].searched=!0,_.each(n.concat(i),function(t){e.nodes[t].searched||e.depthFirstSearch(t)})},k.prototype.getDataSourceKey=function(t){if(t)return t.path||t.cid},k.prototype.getRelatedDataSources=function(t,n){var i=this,t=_.reduce(t,function(t,e){return t.concat(i.breadthFirstSearch(e,n))},[]);return _.uniq(t.filter(function(t){return 0===t.indexOf("ds")}))},k.prototype.subscribe=function(t,e,n,i,o){var r=this.getDataSourceKey(t);return this.subscriptions[r]?(this.subscriptions[r].callback=e,!1):(this.subscriptions[r]={source:t,onData:e},this.subscriptions[r].key=_.uniqueId(n+"_"),t.subscribe(this.subscriptions[r].key,this.subscriptions[r],i,o),!0)},k.prototype.unsubscribe=function(t){var e=this.getDataSourceKey(t);this.subscriptions[e]&&(t.unsubscribe(this.subscriptions[e].key),delete this.subscriptions[e])},k.prototype.unsubscribeViewStates=function(i){var o=this;_.each(this.activeViewStateToSubscriptions,function(t,e){var n=i.getByPath(e);o.stopListening(n,"change:value"),delete o.activeViewStateToSubscriptions[e]})},k.prototype.visitAndMeetNeighbors=function(t,n){var i=this,e=[];return this.nodes[t]&&!this.nodes[t].visited&&(this.nodes[t].visited=!0,e.push(t),(t=n[t])&&(e=_.reduce(t,function(t,e){return t.concat(i.visitAndMeetNeighbors(e,n))},e))),e},Ze.DocumentGraph=k,function(t){function e(t){this.datasources={},this.templates={},this.triggers=[],this.sendNotification=t}e.prototype.onTriggerChange=function(t){var o=this,e=(this.triggers=t).map(function(t){if(t.source)return t.source.cid});t.forEach(function(t){var e=t.template,n=t.source,i=t.icon,t=t.sound;n&&!o.datasources[n.cid]?o.datasources[n.cid]=new r(n,e,i,t,o.sendNotification):n&&o.datasources[n.cid].updateTemplate(e,i,t)}),Object.keys(this.datasources).filter(function(t){return-1===e.indexOf(t)}).forEach(function(t){o.datasources[t].unsubscribe(),o.datasources[t]=void 0,delete o.datasources[t]})},t.DatasourceNotifier=e;n.prototype.updateTemplate=function(t,e,n){this.template=s.compile(t),this.icon=e,this.sound=n},n.prototype.subscribe=function(){this.source.subscribe("notifications",this),this.source.dataSet.noBackground=!0},n.prototype.unsubscribe=function(){this.source.unsubscribe("notifications")},n.prototype.onData=function(t,e){var o=this;e.add&&e.add.length&&e.add.forEach(function(t){t=_.omit(t,["_rowIndex"]);var t=o.template(t),e=o.source.path,n=o.sound,i=o.icon;o.sendNotification("datasource-notifications",{title:e,message:t,icon:i},{sound:n})})};var r=n;function n(t,e,n,i,o){this.source=t,this.sound=i,this.icon=n,this.template=s.compile(e),this.sendNotification=o,this.subscribe()}}(I=I||{}),tn=I=I||{},A.generateAggregatedMessage=function(t){var e=[];return _.each(t,function(t){t&&t[1]&&(t=t[1].message||"",e.push(37<t.length?t.substring(0,37)+" ..":t))}),e.join("\r\n")},A.generateAudio=function(t){var e=_.now(),n=A.suspendedAudioNotifications[t];return void 0===n||n<e?(A.suspendedAudioNotifications[t]=e+5e3,new Audio(A.MEDIA_LOCATION+t+".mp3")):null},A.notify=function(t,e,n){var i=A.currentSettings.Notifications;if(t!==A.AGGREGATED_ID&&i.Grouping&&i.GroupingInterval)return 0===A.pendingNotifications.length&&(A.pendingNotificationsTimeoutId=setTimeout(function(){1<A.pendingNotifications.length?A.notify(A.AGGREGATED_ID,{title:A.pendingNotifications.length+" alerts received",message:A.generateAggregatedMessage(A.pendingNotifications)},!0):(A.pendingNotifications[0][0]=A.AGGREGATED_ID,A.notify.apply(A,A.pendingNotifications[0])),A.pendingNotificationsTimeoutId=void 0,A.pendingNotifications=[]},1e3*i.GroupingInterval)),void A.pendingNotifications.push(_.concat([],arguments));if(n&&i.SoundVolume&&"Audio"in window)try{var o=void 0;_.isBoolean(n)&&"none"!==i.Sound?o=A.generateAudio(i.Sound):"none"!=n.sound&&(o=A.generateAudio(n.sound)),o&&(o.volume=i.SoundVolume/100,o.play().then(function(){}).catch(function(){A.hasNotified||(A.notify("Notification API",{icon:"fa-volume-off",message:"Your browser is blocking notification audio, interact with the page to enable audio.",title:"Notification Audio Error"}),A.hasNotified=!0)}))}catch(t){tn.Log.Error("Audio API ERROR",arguments)}if(e){var o=i.InBrowserNotifications||!("Notification"in window)||"denied"===Notification.permission,r=e.title||"Alert",s=e.message||"",a=e.icon||("none"!==i.Icon?i.Icon:null);if(a=a.substring(3),o)A.$pnlNotifications||(o=function(){var t=$(this).closest(".inBrowserNotification"),e=t.data("fadeOutId");e&&clearTimeout(e),t.remove()},(A.$pnlNotifications=$("<div></div>",{class:"pnlInBrowserNotifications"}).appendTo($(".document-view"))).on("click","i",o),A.$pnlNotifications.on("dblclick",".inBrowserNotification",o)),A.positionPanel(A.$pnlNotifications,i.Position),A.$pnlNotifications.children().length>=i.MaxVisibleCount&&A.$pnlNotifications.children().first().remove(),o=$(tn.T.InBrowserNotification({title:r,message:s.replace(/\r\n/g,"<br/>"),icon:a})).appendTo(A.$pnlNotifications),i.FadeOut&&o.data("fadeOutId",setTimeout(o.remove.bind(o),1e3*i.FadeOut));else try{var l,u=new Notification(r,{body:s,icon:a?A.isWindows10()?A.ICON_LOCATION_LIGHT+a+".png":A.ICON_LOCATION+a+".png":void 0,silent:!0});i.FadeOut&&(l=function(){u.close(),window.removeEventListener("beforeunload",l)},u.onshow=function(){setTimeout(l,1e3*i.FadeOut)},window.addEventListener("beforeunload",l))}catch(t){tn.Log.Error("Notification API ERROR",arguments)}}},A.positionPanel=function(t,e){e={"Top Left":"","Top Center":"position_center","Top Right":"position_right","Center Left":"position_middle","Center Center":"position_middle position_center","Center Right":"position_middle position_right","Bottom Left":"position_bottom","Bottom Center":"position_bottom position_center","Bottom Right":"position_bottom position_right"}[e];t.removeClass("position_middle position_bottom position_center position_right").addClass(e)},A.isWindows10=function(){return 0<=window.navigator.userAgent.search(/(Windows 10.0)|(Windows NT 10.0)/)},A.setOptions=function(t){A.currentSettings=t,A.datasourceNotifier.onTriggerChange(t.Notifications.triggers||[]),A.pendingNotificationsTimeoutId&&(clearTimeout(A.pendingNotificationsTimeoutId),A.pendingNotificationsTimeoutId=void 0,A.pendingNotifications=[])},A.show=function(t,e,n){var i;A.currentSettings.Notifications.Enabled&&(!A.currentSettings.Notifications.InBrowserNotifications&&"Notification"in window&&"granted"!==Notification.permission&&"denied"!==Notification.permission?(i=arguments,Notification.requestPermission(function(){A.show.apply(this,i)})):A.notify(t,e,n))},A.upgradeConfig=function(t){var e;return t?(e=void 0,t.Notifications._Version!==(e=A.DEFAULT_JSON.Notifications._Version)&&(t.Notifications._Version=e)):t=A.DEFAULT_JSON,t.Notifications.triggers=t.Notifications.triggers?t.Notifications.triggers.map(function(t){var e=t.source;return ot(ot({},t),{source:"data"===e._dashboardsType?A.documentDataModel.getByPath(e.value):e})}):[],t},A.setDocumentDataModel=function(t){this.documentDataModel=t},A.pendingNotifications=[],A.AGGREGATED_ID="AGGREGATED_NOTIFICATION",A.hasNotified=!1,A.suspendedAudioNotifications={},A.MEDIA_LOCATION=require.toUrl("QuickBase").replace("/main","")+"/notifications/",A.ICON_LOCATION=require.toUrl("QuickBase").replace("/main","")+"/images/black/",A.ICON_LOCATION_LIGHT=require.toUrl("QuickBase").replace("/main","")+"/images/white/",A.SCHEMA={type:"object",title:"Properties",properties:{Notifications:{type:"object",title:"Notifications",options:{collapsed:!0},properties:{_Version:{type:"string",default:"4.2.0s2",options:{hidden:!0}},Enabled:{title:"Enabled",propertyOrder:100,type:"boolean",format:"checkbox",default:!0},InBrowserNotifications:{title:"InBrowser",propertyOrder:110,type:"boolean",format:"checkbox",default:!1},Position:{title:"Position",propertyOrder:120,type:"string",enum:["Top Left","Top Center","Top Right","Center Left","Center Center","Center Right","Bottom Left","Bottom Center","Bottom Right"],default:"Bottom Right"},MaxVisibleCount:{title:"Max Count",propertyOrder:130,type:"number",minimum:1,default:3},FadeOut:{title:"FadeOut (s)",propertyOrder:140,type:"number",minimum:0,default:5},Icon:{title:"Icon",propertyOrder:150,type:"icon",default:"fa-bell-o",iconTypes:"fa"},Sound:{title:"Sound",propertyOrder:160,type:"string",enum:A.NOTIFICATION_SOUNDS=["beep","beepbeep","ding","exquisite","long-expected","festive","job-done","arcade","echo","case-closed","none"],default:"beep"},SoundVolume:{title:"Sound Volume",propertyOrder:170,type:"number",format:"range",minimum:0,maximum:100,default:100},Grouping:{title:"Group Notifications",propertyOrder:180,type:"boolean",format:"checkbox",default:!1},GroupingInterval:{title:"Grouping Interval (s)",propertyOrder:190,type:"number",minimum:0,default:1},triggers:{title:"Additional Triggers",type:"array",items:{type:"object",id:"arrItem",additionalProperties:!1,options:{collapsed:!0},title:"Datasource Trigger",properties:{source:{type:"data",propertyOrder:100,title:"Datasource"},template:{type:"tooltipTemplate",propertyOrder:101,title:"Notification Template",default:"{{#each this}}{{@key}}: {{this}}\n{{/each}}"},sound:{title:"Sound",propertyOrder:103,type:"string",enum:A.NOTIFICATION_SOUNDS,default:"beep"},icon:{title:"Icon",iconTypes:"fa",propertyOrder:102,type:"icon",default:"fa-bell-o"}}}}}}}},A.DEFAULT_JSON={Notifications:_.mapValues(A.SCHEMA.properties.Notifications.properties,"default")},A.currentSettings=A.DEFAULT_JSON,A.datasourceNotifier=new tn.DatasourceNotifier(A.show),A.CONFIG={SCHEMA:A.SCHEMA,upgradeConfig:A.upgradeConfig},tn.NotificationManager=A,E=I=I||{},en=E.CustomEvents,l(x,en),x.prototype.getDataSourceMap=function(t,e,n){var i=this.dashboardViewModel.get("selectedDocumentId"),i=this.dashboardAppModel.get("documents").get(i);try{return new E.DocumentGraph(i.get("viewState"),i.get("data"),i.getComponents(),i.get("data").getByPath.bind(i.get("data")),null).getFormDataSources(t,e,n)}catch(t){console.error("ComponentApi.getDataSourceMap error",t)}},x.prototype.convertPathsToModels=function(t,e,s){var a,l=m.DeepModel.keyPathSeparator;if(!t)return!1;switch(t){case"data":a=$.proxy(this.docDataModel.getByPath,this.docDataModel);break;case"viewstate":a=$.proxy(this.docViewModel.getByPath,this.docViewModel)}t=this.getPropertiesByType(t,e.properties,e.definitions),_.each(t,function(t){var n,i,o,r,e,t=t.replace(/\.properties/g,"");1<(e=(t=t.replace(/\.oneOf\.\d+/g,"")).split(".items.")).length?(o=e[0],r=e[1],e=s.get(o),_.each(e,function(t,e){(i=function(t,e){e=e.split(".");for(var n=t,i=0;i<e.length;i++)n=n&&n[e[i]];return n}(t,r))&&"string"==typeof(i=i._dashboardsType?i.value:i)&&(n=(n=a(i))||{},s.set(o+l+e+l+r,n,{silent:!0}))})):(i=s.get(t))&&"string"==typeof(i=i._dashboardsType?i.value:i)&&(n=(n=a(i))||{},s.set(t,n,{silent:!0}))})},x.prototype.destroySettings=function(){var t;this.quickView&&(t=this.docViewModel.get(".settings"))&&t.unset(this.componentId)},x.prototype.exportData=function(t,n,e){"data"===this.getSourceType(t)?t.exportData(function(t){var e;(-1<navigator.userAgent.toLowerCase().indexOf("firefox")||-1<navigator.userAgent.toLowerCase().indexOf("safari"))&&-1===navigator.userAgent.toLowerCase().indexOf("chrome")?((e=document.createElement("a")).setAttribute("href",t),e.setAttribute("download",""),document.body.appendChild(e),e.click(),document.body.removeChild(e)):window.open(t,"_blank"),_.isFunction(n)&&n(t)},function(t){t="Export Data error"+(t?": "+t.toString():"");E.Log.Error(t),E.ErrorDialog.ShowError(t),_.isFunction(n)&&n()},e):_.isFunction(n)&&n()},x.prototype.doActions=function(t,s){var a=this,l={dashboard:"<none>",screen:"<none>",target:""};_.each(t,function(t,e){t._Type||(_.isObject(t)?t._Type="nav":t={_Type:"nav",Value:t});var e=t._PropertyIndex||e,n=(s||"Actions")+"."+e;switch(t._Type){case"map":var i=a.getPropertyMeta(n+".Current"),o=a.getPropertyMeta(n+".Target"),r=void 0;l.viewstate||(l.viewstate={}),i&&(r=_.has(t,"Value")?t.Value:"viewstate"===i.type?i.value:t.Current,E.Tools.isKDBTemporal(r)&&(r=E.Tools.convertKDBTemporalToMoment(r).toDashString()),o&&"viewstate"===o.type&&o.path?a.setProperty(n+".Target",r):l.viewstate[t.Target]=r);break;case"nav":i=a.getPropertyMeta(n+".SelectDashboardScreen"),o="viewstate"===i.type?i.value:t.SelectDashboardScreen;_.isString(o)?(l.dashboard=o,l.screen=null):_.isObject(t)&&(t["SelectDashboardScreen._dashboardsType"]?_.extend(l,{dashboard:t["SelectDashboardScreen.dashboard"],screen:t["SelectDashboardScreen.screen"]}):_.isObject(o)&&_.extend(l,o)),t.Target&&(l.target=t.Target);break;case"query":t.DataSource&&t.DataSource.forceExecute(void 0,t.callback);break;case"url":r=t.Url;/\S+/g.test(r)&&(/^https?:\/\//i.test(r)||(r="//"+r),window.open(r,t.Target||"_blank"))}}),"<none>"===l.dashboard&&"<none>"===l.screen||a.navigate(l)},x.prototype.removeTooltip=function(){var t;this.unsubscribeTemplateViewStates(this.tooltipSubscriptionKey),this.tooltipSubscriptionKey="",null!=(t=this.genericTooltip)&&t.remove(),delete this.genericTooltip},x.prototype.setTooltip=function(t){var e=this;return this.genericTooltip?this.genericTooltip.updateTooltip(t):this.genericTooltip=new E.GenericTooltip(_.extend(t,{cssClass:this.appKey+"-tooltip"})),this.unsubscribeTemplateViewStates(this.tooltipSubscriptionKey),this.tooltipSubscriptionKey=this.subscribeTemplateViewStates(this.genericTooltip.text,function(t){e.genericTooltip.renderTemplate(t)}),this.genericTooltip},x.prototype.extractTemplateViewStates=function(t){var e=this,t=t.match(/\$[^$]*\$/gi);return _.map(_.uniq(t),function(t){t=e.docViewModel.getByPath(t.substring(1,t.length-1).replace(/\./g,"/"));if(t)return t.path})},x.prototype.getDashboardId=function(e){var t="<none>"===e?null:e&&"<this>"!==e?this.dashboardAppModel.get("documents").find(function(t){return t.get("name")===e}):this.dashboardAppModel.get("documents").get(this.dashboardViewModel.get("selectedDocumentId"));return t?t.id:"<none>"},x.prototype.getScreenId=function(t,e){var n,i,o,t=this.dashboardAppModel.get("documents").get(t);return t&&(e&&"<none>"!==e?t.has("screens")?(o=t.get("screens").find(function(t){return t.get("name")===e}))&&(i=o.id):(n=_.find(t.get("screenDetails"),function(t){return t.label===e}))&&(i=n.value):(n=t.get("screenDetails")[0])&&(i=n.value)),i||"<none>"},x.prototype.getDataSourceKey=function(t){return!!t&&(t.path||t.cid)},x.prototype.getDictValue=function(t){var i=this,o={};return"dict"!==t.get("_type")||"object"!=typeof t.get("value")?t.get("value"):(_.each(t.get("value"),function(t,e){var n;t instanceof E.DocumentViewModel?n=t.path:t instanceof m.Model?o[e]=t.get("value"):_.isObject(t)&&t.name?n=t.name:_.isString(t)&&t.match(E.DocumentDataModel.PARAMETER_RX)&&(n=t.substring(2,t.length-2)),n?(n=i.docViewModel.getByPath(n),o[e]=n?n.get("value"):t):o[e]=t}),o)},x.prototype.getPropertiesByType=function(n,t,i,o,r){var s=this,a=m.DeepModel.keyPathSeparator;return o=o||"",i=i||{},r=r||[],t&&(t.type===n?r.push(o):t&&t.constructor===Object?_.each(t,function(t,e){"$ref"===e?s.getPropertiesByType(n,i[t.replace("#/definitions/","")],i,o,r):s.getPropertiesByType(n,t,i,(o?o+a:"")+e,r)}):t&&t.constructor===Array&&_.each(t,function(t,e){s.getPropertiesByType(n,t,i,(o?o+a:"")+e,r)})),_.uniq(r)},x.prototype.getProperty=function(t){var e,n;if(!t)return null;switch(e=this.settingsModel.get(t),this.getSourceType(e)){case"data":n=null;break;case"viewstate":n=this.getPropertyValue(e);break;default:n=e}return n},x.prototype.getPropertyMeta=function(t){var e,n,i,o;if(!t)return null;if(null==(e=this.settingsModel.get(t)))return null;switch(t=this.getSourceType(e)){case"data":o=null;break;case"viewstate":o=this.getPropertyValue(e),n=e.get("_default"),i=e.get("_type");break;default:o=e}return{path:e.path||null,type:t,value:o,viewstateType:i||null,defaultValue:n||null}},x.prototype.getPropertyValue=function(t){return"viewstate"===this.getSourceType(t)?"dict"===t.get("_type")?this.getDictValue(t):t.get("value"):t},x.prototype.getSourceType=function(t){return t?t instanceof E.DocumentViewModel||t.get&&t.get("_viewType")||t.has&&t.has("_default")&&t.has("value")?"viewstate":t instanceof E.DocumentDataModel||t.subscribe&&t.unsubscribe?"data":null:null},x.prototype.getSubscriptionKey=function(t){var e=this.appKey?this.appKey+" ":"";return e+=t||this.widgetId,_.uniqueId(e+":")},x.prototype.getViewState=function(t){return!(!t||!t.attributes)&&t.get("value")},x.prototype.getViewStates=function(t){var e=this;return _.zipObject(t,_.map(t,function(t){t=e.docViewModel.getByPath(t);if(t)return t.get("value")}))},x.prototype.hideErrorMessage=function(){this.trigger("hideErrorMessage")},x.prototype.hideQueryStatus=function(){this.trigger("hideQueryStatus")},x.prototype.isBuildMode=function(){return this.dashboardViewModel.get("buildMode")&&!this.quickView},x.prototype.isSelected=function(){var t=this.dashboardViewModel.get("selectedWidget");return!!t&&t.id===this.widgetId},x.prototype.loadApp=function(t,e,n,i,o,r){t&&e&&(r=r||t,new E.AppView(_.extend({},{el:e,key:t,settings:n,appOptions:i,callback:function(t){_.isFunction(o)&&o(t)},namespace:this.componentId+x.NAMESPACE_SEPARATOR+r},_.pick(this,E.AppView.COMMON_OPTIONS))))},x.prototype.loadSetting=function(t,e){var n,i;return t&&this.quickView?(i=this.docViewModel.get(".settings"),n=this.componentId,e&&(n+=x.NAMESPACE_SEPARATOR+e),i&&(e=i.get(n))?e.get(t):null):null},x.prototype.navigate=function(t){var e,n,i=null,o=null,r=null,s=null,a=null,l="";_.isString(t)?(n=t,r=this.dashboardAppModel.get("documents").get(n)?n:this.getDashboardId(n),a="<none>"):_.isObject(t)&&(i=t.dashboard,s=t.screen,e=t.viewstate,i instanceof m.Model?i=i.get("value"):_.isObject(i)&&i.id&&(i=i.id),s instanceof m.Model?s=s.get("value"):_.isObject(s)&&s.id&&(s=s.id),"<this>"===i&&(i=this.dashboardViewModel.get("selectedDocumentId")),(o=this.dashboardAppModel.get("documents").get(i))?r=i:(r=this.getDashboardId(i),o=this.dashboardAppModel.get("documents").get(r)),o&&(a=_.isEmpty(o.get("screenDetails"))&&E.Helpers.validateGuid(s)||_.find(o.get("screenDetails"),function(t){return t.value===s})?s:this.getScreenId(r,s))),_.isObject(e)&&!_.isEmpty(e)&&(l="?viewstate="+encodeURIComponent(JSON.stringify(e))),r&&a&&"<none>"!==r&&("_blank"===t.target||"FSBL"in window&&r!==window.finApi.documentId?(n=(n="#"+r)+(a?"/"+a:"")+(l||""),window.open(n)):"<none>"===a?this.dashboardAppModel.get("router").navigate(r+l,{trigger:!0}):this.dashboardAppModel.get("router").navigate(r+"/"+a+l,{trigger:!0}))},x.prototype.page=function(t,e){if(!_.isObject(e)||"data"!==this.getSourceType(t))return!1;e=_.pick(e,"_pagingType","_pagingNum","_pageSize","_pageSort"),t.set(e)},x.prototype.processSettings=function(t,u){var c=this,p=m.DeepModel.keyPathSeparator,d=function(e,n,i,o){var r,s,a,l,t;if(n=n||"",o=o||{},l=_.isUndefined(i)?n:i,e&&e.constructor===Object&&!_.isEmpty(e))_.each(e,function(t,e){d(a=t,s=(n?n+p:"")+e,r=(i?i+p:"")+e,o)});else if(e&&e.constructor===Array&&!_.isEmpty(e))_.keys(e).length<e.length?_.each(_.keys(e),function(t){a=e[t],d(a,s=(n?n+p:"")+t,r=(i?i+p:"")+t,o)}):_.each(e,function(t,e){o[l]||(o[l]=[]),a=t,s=(n?n+p:"")+e,r="",o[l][e]=d(a,s,r,null)});else if("viewstate"===c.getSourceType(e)&&(c.activeViewStateToPropertyPaths[e.path]?-1===c.activeViewStateToPropertyPaths[e.path].indexOf(n)&&c.activeViewStateToPropertyPaths[e.path].push(n):(c.activeViewStateToPropertyPaths[e.path]=[n],c.listenTo(e,"change:value",function(t,e){var n=c.activeViewStateToPropertyPaths[t.path],t=("dict"===t.get("_type")&&(e=_.transform(e,function(t,e,n){t[n]=c.getPropertyValue(e)})),_.zipObject(n,_.times(n.length,_.constant(e))));u&&u(t)})),c.propertyPathsToViewStates[n]=e.path),t=c.getPropertyValue(e),!_.isUndefined(t)){if(!l)return t;o[l]=t}return o},t=d(t);return _.each(c.activeViewStateToPropertyPaths,function(t,e){var t=_.filter(t,function(t){return c.propertyPathsToViewStates[t]===e&&"viewstate"===c.getSourceType(c.settingsModel.get(t))});0<t.length?c.activeViewStateToPropertyPaths[e]=t:(t=c.docViewModel.getByPath(e),c.stopListening(t,"change:value"),delete c.activeViewStateToPropertyPaths[e])}),t},x.prototype.processTemplateViewStates=function(t){return _.mapKeys(t,function(t,e){return"$"+e.replace(/\//g,".")+"$"})},x.prototype.saveSetting=function(t,e,n){var i;t&&this.quickView&&(i=this.componentId,n&&(i+=x.NAMESPACE_SEPARATOR+n),(n=this.docViewModel.get(".settings"))||(n=new m.Model,this.docViewModel.set(".settings",n)),(n=n.get(i))||(n=new m.Model,this.docViewModel.get(".settings").set(i,n),n.set("version",0)),n.set(t,e),this.autosaveDashboardId=this.getDashboardId(null),this.saveSettingsNowDebounced())},x.prototype.saveSettingsNow=function(){var e,n=this.getDashboardId(null);this.autosaveDashboardId===n&&(e=this.docViewModel.get(".settings"),new E.DocumentViewModel({id:n},null).fetch({success:function(t){t.set(".settings",e),t.save({},{error:function(){E.Log.Error("Autosave user settings FAILED",n)},success:function(){E.Log.Info("Autosave user settings SUCCEEDED",n)}})}.bind(this),error:function(t,e){this.dashboardAppModel.get("isLite")&&"Record Not Found"===e?new E.DocumentViewModel({id:n},null).save({},{success:function(){this.saveSettingsNow()}.bind(this)}):E.Log.Error("Unable to fetch user settings for Autosave",n)}.bind(this)}))},x.prototype.setProperty=function(t,e,n){var i;t&&(i=this.settingsModel.get(t),"viewstate"===this.getSourceType(i)?i.setModelValue(e):this.settingsModel.set(t,e,_.extend({},n,{propertyPath:t})))},x.prototype.setViewState=function(t,e){return!(!t||!t.attributes)&&t.set("value",e)},x.prototype.showErrorMessage=function(t){this.trigger("showErrorMessage",t)},x.prototype.showNotification=function(t,e){E.NotificationManager.show(this.widgetId,t,e)},x.prototype.showQueryStatus=function(t){this.trigger("showQueryStatus",t)},x.prototype.updateTable=function(t,e,n,i){"data"===this.getSourceType(t)&&(e.query=t?t.get("_updateQueryString"):"",e.connection=t?t.get("_connection"):"",e.updateType=t?t.get("_updateType"):"",e.updateAnalytic=t?t.get("_updateAnalytic"):"",e.updateParams=t.bindViewStateToKdbParams(t.get("_updateQueryParams")),E.DeltaClientLib.updateTable(e,function(){n(),t.isDirty=!0,t.forceInternalReset=!0,t.execute()},i))},x.ADVANCED_METHODS=["deltaClient"],x.NAMESPACE_SEPARATOR=":",x.API_METHODS=["destroySettings","doActions","exportData","getProperty","getPropertyMeta","getDataSourceMap","getViewState","getTemplateViewStates","hideErrorMessage","hideQueryStatus","isBuildMode","isSelected","loadApp","loadSetting","navigate","page","removeTooltip","saveSetting","setProperty","setTooltip","setViewState","showErrorMessage","showNotification","showQueryStatus","subscribe","subscribeTemplateViewStates","unsubscribe","unsubscribeTemplateViewStates","updateTable"],E.ComponentApi=x,nn=I=I||{},on=m.View,l(Ln,on),Ln.prototype.initializeApi=function(){this.componentApi=new nn.ComponentApi(_.extend({},_.pick(this,Ln.COMMON_OPTIONS),{advancedMethods:!0,appKey:this.key,componentId:this.componentId,deltaClient:this.deltaClient?this.deltaClient.deltaClient:null,deltaClientLib:this.deltaClient,settingsModel:this.settingsModel}))},Ln.prototype.initalizeEvents=function(){this.settingsModel&&this.listenTo(this.settingsModel,"change",this.onSettingsModelChange)},Ln.prototype.initializeOnSettingsChange=function(){var t=!1;this.app&&_.isFunction(this.app.onSettingsChange)&&(this.appOnSettingsChange=_.bind(this.app.onSettingsChange,this.app)),this.appOnSettingsChange&&_.isFunction(this.settingsModel.toFlat)&&(this.appOnSettingsChange(this.componentApi.processSettings(this.settingsModel.toFlat(),this.appOnSettingsChange)),"BasicComponents"===this.key&&!_.isFunction(this.app.$view.onSettingsChange)||(t=!0)),this.model&&(t?this.model.set("hasOnSettingsChange",!0,{silent:!0}):this.model.unset("hasOnSettingsChange"))},Ln.prototype.onSettingsModelChange=function(r,t){try{var e,s=r.changedAttributes(null,t&&t.propertyPath?t.propertyPath:null);_.each(s,function(t,e){var n,i;function o(t,e){var n,i=/^(\w+)((?:\.\w+)+)$/.exec(e);return i?(n=_.isArray(t)?Number(i[1]):i[1],_.isObject(t)?o(t[n],i[2].substring(1)):t):_.isObject(t)?t[e]:t}n=o(r.attributes,e),i=o(r.previousAttributes(),e),_.isEqual(i,n)&&delete s[e]}),e=this.componentApi.processSettings(s,this.appOnSettingsChange),this.appOnSettingsChange&&!_.isEmpty(e)&&this.appOnSettingsChange(e)}catch(t){nn.Log.Error("AppView Settings Error",t,this)}},Ln.prototype.onResize=function(t){this.app&&this.app.onResize&&this.app.onResize(t)},Ln.prototype.onResizeStart=function(t){this.app&&this.app.onResizeStart&&this.app.onResizeStart(t)},Ln.prototype.onResizeStop=function(t){this.app&&this.app.onResizeStop&&this.app.onResizeStop(t)},Ln.prototype.remove=function(){return this.app&&_.isFunction(this.app.remove)&&this.app.remove(),this.componentApi&&(this.componentApi.removeTooltip(),this.componentApi.unsubscribeAll()),m.View.prototype.remove.apply(this)},Ln.prototype.render=function(){return this.$appDiv=this.$el,this},Ln.prototype.requireApp=function(){var e=this;requirejs([e.key],function(t){try{e.initializeApi(),e.app=new t(_.extend({el:e.$appDiv,viewModel:e.docViewModel,dataModel:e.docDataModel,dashboardAppModel:e.dashboardAppModel,dashboardViewModel:e.dashboardViewModel,settingsModel:e.settingsModel,websiteUrl:e.dashboardAppModel.get("websiteUrl"),DeltaClientLib:e.deltaClient,api:e.componentApi.interface,widgetId:e.widgetId},e.appOptions)),e.initalizeEvents(),e.initializeOnSettingsChange(),_.isFunction(e.callback)&&e.callback(e.app)}catch(t){nn.Log.Error("loading app error, require key: "+e.key,t),_.isFunction(e.callback)&&e.callback(t)}},function(t){nn.Log.Error("ComponentView:loadApp require error",t),_.isFunction(e.callback)&&e.callback(t)})},Ln.COMMON_OPTIONS=["callback","dashboardAppModel","dashboardViewModel","deltaClient","docDataModel","docViewModel","widgetId","quickView"],nn.AppView=Ln,rn=I=I||{},sn=m.View,l(Vn,sn),Vn.prototype.dialogClass=function(){return"dialog-base "+(this.options.userClass||"")},Vn.prototype.dialogButtons=function(){var t=this;return[{text:"Cancel",click:function(){return t.dialogClose()},icons:{primary:"fa fa-times"}}]},Vn.prototype.dialogClose=function(){function t(){e.$dialog&&e.$dialog.dialog("close")}var e=this;this.isCancel?(this.options.cancelBtnCallback&&this.options.cancelBtnCallback(),t()):this.options.requireSuccess?this.options.callback&&this.options.callback(this.model,t,function(t,e){rn.ErrorDialog.ShowError(e||"Unspecified Error")}):(this.options.callback&&this.options.callback(this.model),t())},Vn.prototype.dialogOpen=function(){},Vn.prototype.onResize=function(){var t=$(window).height();this.$dialogRoot.position({of:$(window)}),t=.95*t-(this.$dialogTitlebar.outerHeight(!0)+this.$dialogButtonpane.outerHeight(!0)),this.$dialog.css("max-height",t)},Vn.prototype.preRender=function(){},Vn.prototype.postRender=function(){},Vn.prototype.remove=function(){return this.$dialog&&this.$dialog.dialog("destroy"),this.options=null,this.$dialog=null,this.$dialogTitlebar=null,this.$dialogButtonpane=null,this.$dialogRoot=null,$(window).off("resize",this.resizeListener),m.View.prototype.remove.apply(this)},Vn.prototype.openDialog=function(){this.$el.dialog("open")},Vn.prototype.render=function(){var t=this,e={};return this.options.container&&(e.appendTo=this.options.container),this.preRender(),this.$el.html((this.options.renderTemplate?this.options:this).renderTemplate()),this.$dialog=this.$el.dialog(_.extend({dialogClass:this.dialogClass(),title:this.options.dialogTitle,resizable:!1,minHeight:this.options.minHeight||300,width:this.options.width||"57em",height:this.options.height||"auto",modal:!0,autoOpen:!0,draggable:!1,closeOnEscape:!0,buttons:this.dialogButtons(),position:{my:"center",at:"center",of:$(window)},open:function(){t.$el.parent().find(".titleIcon").remove(),$('<i class="titleIcon fa '+t.options.iconClass+'" />').insertBefore(t.$el.parent().find(".ui-dialog-title")),t.$dialogRoot=$(".ui-dialog.dialog-base"),t.$dialogTitlebar=t.$dialogRoot.find(".ui-dialog-titlebar"),t.$dialogButtonpane=t.$dialogRoot.find(".ui-dialog-buttonpane"),t.dialogOpen(),t.$dialogButtonpane.find(".ui-dialog-buttonpane > div > button:nth-child(1)").focus(),t.options.onOpen&&t.options.onOpen()},close:function(){t.trigger("closing"),t.options.onClose&&t.options.onClose(),t.remove()},resize:$.proxy(this.onResize,this)},e)),this},Vn.prototype.renderTemplate=function(){return""},rn.DialogBase=Vn,an=I=I||{},ln=an.DialogBase,l(On,ln),On.prototype.dialogButtons=function(){return[{text:"Save",click:_.bind(this.onClickSave,this),icons:{primary:"fa fa-floppy-o"}},{text:"Don't Save",click:_.bind(this.onClickDontSave,this),icons:{primary:"fa fa-ban"}},{text:"Cancel",click:_.bind(this.onClickCancel,this),icons:{primary:"fa fa-times"}}]},On.prototype.doSave=function(){var t=$.Deferred();return this.model.saveNow(t.reject,t.resolve),t.promise()},On.prototype.onKeyDown=function(t){switch(t.stopPropagation(),t.keyCode){case $.ui.keyCode.ESCAPE:this.onClickCancel();break;case 78:this.onClickDontSave();break;case 83:case 89:this.onClickSave()}},On.prototype.onClickCancel=function(){this.isCancel=!0,this.closeArgs="cancel",this.dialogClose()},On.prototype.onClickDontSave=function(){this.options&&this.options.noSaveCb&&this.options.noSaveCb(),this.dialogClose()},On.prototype.onClickSave=function(){this.options&&this.options.saveCb?(this.options.saveCb(),this.dialogClose()):(this.$firstBtn.button("disable"),this.$firstBtn.next().button("disable"),this.$firstBtn.next().next().button("disable"),this.doSave().done(_.bind(this.onSaveDone,this)).fail(_.bind(this.onSaveFail,this)))},On.prototype.onSaveDone=function(){var n,i=this,o=[];_.isEmpty(this.options.components)?this.dialogClose():(n=_.after(this.options.components.length,function(){_.isEmpty(o)?i.dialogClose():(i.$errorInfo.show(),i.$errorList.empty(),_.each(o,function(t){var e=$("<li />"),n=$("<span />");n.attr("title",t.widget),n.text(t.component),e.text(": "+t.message),e.prepend(n),i.$errorList.append(e)}),i.$firstBtn.button("enable"),i.$firstBtn.next().button("enable"),i.$firstBtn.next().next().button("enable"))}),_.each(this.options.components,function(e){_.isFunction(e.callback)&&e.callback(function(t){t&&o.push(_.extend({message:t},_.pick(e,["component","widget"]))),n()})}))},On.prototype.onSaveFail=function(){this.$errorInfo.show(),this.$firstBtn.button("enable"),this.$firstBtn.next().button("enable"),this.$firstBtn.next().next().button("enable")},On.prototype.getPromptMessage=function(){return this.options.message||"There are unsaved changes in this dashboard."},On.prototype.postRender=function(){$(window).on("keydown.AreYouSureDialog",_.bind(this.onKeyDown,this)),this.$errorInfo=this.$(".error-info"),this.$errorList=this.$(".error-list"),this.$firstBtn=this.$dialog.next().find("button").first(),this.$errorInfo.hide()},On.prototype.renderTemplate=function(){return an.T.AreYouSureDialog({dashChanged:this.options.dashChanged,components:this.options.components,message:this.getPromptMessage()})},On.prototype.remove=function(){return $(window).off(".AreYouSureDialog"),this.trigger("close",this.closeArgs),an.DialogBase.prototype.remove.apply(this)},an.AreYouSureDialog=On,un=I=I||{},cn=m.View,l(Bn,cn),Bn.prototype.close=function(){this.$dialog.dialog("close")},Bn.prototype.onSubmit=function(e){var n,i,o,r,s=this;e&&e.stopPropagation(),this.clicked||(e=this.form.commit(),_.isEmpty(e)&&(this.clicked=!0,this.$messageBox.hide(),r=function(){o.removeClass("fa-spinner fa-pulse"),o.css({width:"",height:""}),o.addClass("fa-check"),n.find(".ui-button-text").text(t("OK")),i.button("enable"),s.clicked=!1,un.DeltaClientLib.changingPassword=!1},n=this.$okBtn,(o=n.find(".ui-button-icon-primary.fa-check")).removeClass("fa-check"),o.css({width:"auto",height:"auto"}),o.addClass("fa-spinner fa-pulse"),n.find(".ui-button-text").text(t("wait...")),(i=n.next()).button("disable"),un.DeltaClientLib.changeUserPassword(s.model.get("oldpassword"),s.model.get("password1"),function(){un.Log.Info("Password changed successfully"),s.showMessage("Password changed successfully","success"),_.isFunction(s.onChangeSuccess)&&s.onChangeSuccess(),_.delay(function(){s.close()},1e3)},function(t){un.Log.Error("Password change failed"),s.showMessage(t),r()})))},Bn.prototype.onRemove=function(){$(this.form.el).find("input").off(),window.removeEventListener("keydown",this.boundToggleCaps,!0),this.remove()},Bn.prototype.showMessage=function(t,e){t?(this.$messageBox.html(t),this.$messageBox.removeClass(this.MESSAGE_TYPES.join(" ")).addClass(e||"error"),this.$messageBox.show()):(this.$messageBox.html(),this.$messageBox.removeClass(this.MESSAGE_TYPES.join(" ")),this.$messageBox.hide())},Bn.prototype.toggleCapsLockMsg=function(e){20===e.which&&(e.getModifierState("CapsLock")?this.showMessage('<i class="fa fa-warning"/>'+t("Caps Lock is on"),"warning"):this.showMessage())},un.ChangePasswordDialog=Bn,Tt=I=I||{},pn=Tt.DialogBase,l(Rn,pn),Rn.prototype.dialogButtons=function(){var t=this;return[{text:"OK",click:function(){t.dialogClose()},icons:{primary:"fa fa-check"}},{text:"Cancel",click:function(){t.isCancel=!0,t.dialogClose()},icons:{primary:"fa fa-times"}}]},Rn.prototype.renderTemplate=function(){return t("Are you sure you want to delete this item?")},Rn.ShowDelete=function(t,e){new Rn(_.extend({iconClass:"fa-trash-o",dialogTitle:"Confirm Delete",callback:t},e?{renderTemplate:function(){return e}}:{}))},Rn.ShowConfirm=function(e){var n=e.txt||"",i=e.container?{container:e.container}:{};new Rn(_.extend({iconClass:e.iconClass||"fa-question-circle",dialogTitle:e.dialogTitle||"Confirmation",callback:e.callback,cancelBtnCallback:e.cancelBtnCallback||_.noop,renderTemplate:e.renderTemplate||function(){return n+t("<br/>Are you sure you want to reload the Application?")}},i))},Tt.ConfirmDialog=Rn,i=I=I||{},dn=i.DialogBase,l($n,dn),$n.prototype.dialogButtons=function(){var t=this;return[{text:"OK",click:function(){t.dialogClose()},icons:{primary:"fa fa-check"}}]},$n.prototype.renderTemplate=function(){return t("Are you sure you want to delete this item?")},$n.ShowError=function(t,e){new $n(_.extend({callback:_.isFunction(e)?e:_.noop},t?{renderTemplate:function(){return t}}:{}))},i.ErrorDialog=$n,hn=I=I||{},gn=hn.ErrorDialog,l(Un,gn),Un.ShowWarning=function(e,n){new hn.ErrorDialog(_.extend({dialogTitle:"Warning",callback:_.isFunction(n)?n:_.noop},e?{renderTemplate:function(){return t(e)}}:{}))},hn.WarningDialog=Un,fn=I=I||{},mn=fn.AppView,l(N,mn),N.getInstances=function(){return N._instances},N.prototype.initalizeEvents=function(){var n=this,t=this.getContainerDocument();fn.AppView.prototype.initalizeEvents.apply(this,arguments),this.listenTo(this.model,"beforeRemove",this.beforeRemove),this.listenTo(this.dashboardViewModel,"change:buildMode",this.onBuildModeChanged),this.listenTo(this.componentApi,"hideErrorMessage",this.hideErrorMessage),this.listenTo(this.componentApi,"hideQueryStatus",this.hideQueryStatus),this.listenTo(this.componentApi,"showErrorMessage",this.showErrorMessage),this.listenTo(this.componentApi,"showQueryStatus",this.showQueryStatus),this.listenTo(t,"change:borderBackground",function(t,e){return n.setOptionsValue("format",{tileBackgroundColor:"#"+e})}),this.listenTo(t,"change:transparentBackground",function(t,e){return n.setOptionsValue("format",{tileTransparentBackground:e})}),this.listenTo(t,"change:borderColor",function(t,e){return n.setOptionsValue("format",{tileBorderColor:"#"+e})}),this.listenTo(t,"change:borderRounding",function(t,e){return n.setOptionsValue("format",{tileBorderRounding:e})}),this.listenTo(t,"change:borderSpacing",function(t,e){return n.setOptionsValue("Alignment",{innerPaddingLeft:e,innerPaddingRight:e,innerPaddingTop:e,innerPaddingBottom:e,titlePaddingLeft:e,titlePaddingRight:e,titlePaddingTop:e})}),this.listenTo(t,"change:borderWidth",function(t,e){return n.setOptionsValue("format",{tileBorderWidth:e})}),this.listenTo(t,"change:widgetsSpacing",function(t,e){return n.setOptionsValue("Alignment",{paddingLeft:e,paddingRight:e,paddingTop:e,paddingBottom:e})}),this.listenTo(t,"change:borderShadow",function(t,e){return n.setOptionsValue("format",{tileShadow:e})}),this.listenTo(t,"change:showLoadingIndicators",this.onShowLoadingIndicatorsChanged),this.listenTo(this.model.get("options"),"change:format",this.onFormatChanged),this.debouncedOnAlignmentChanged=_.debounce(this.onAlignmentChanged,240),this.listenTo(this.model.get("options"),"change:Alignment",this.debouncedOnAlignmentChanged)},N.prototype.applyCustomCss=function(t){t?(this.$customCss&&this.$customCss.length?this.$customCss.html(t):this.$customCss=$("<style />",{"data-widgetid":this.widgetId,html:t,type:"text/css"}).appendTo(document.head),this.customCss=t):this.$customCss&&(this.$customCss.remove(),this.$customCss=null,this.customCss=null)},N.prototype.applyCssClasses=function(t){this.$appDiv.removeClass(this.cssClasses),t?(_.isString(t)?this.cssClasses=t:this.cssClasses=_.reduce(t,function(t,e){return t+" "+e}),this.$appDiv.addClass(this.cssClasses)):this.cssClasses=null},N.prototype.applyDashboardStyleSettings=function(){var t=this.dashboardViewModel.get("selectedDocumentId"),t=this.dashboardAppModel.get("documents").get(t),e=this.model.get("options").get("format"),n=this.model.get("options").get("Alignment");null===e.tileBackgroundColor&&(e.tileBackgroundColor="#"+t.get("borderBackground")),null===e.tileBorderColor&&(e.tileBorderColor="#"+t.get("borderColor")),null===e.tileBorderRounding&&(e.tileBorderRounding=t.get("borderRounding")),null===e.tileBorderWidth&&(e.tileBorderWidth=t.get("borderWidth")),null===e.tileTransparentBackground&&(e.tileTransparentBackground=t.get("transparentBackground")),null===e.tileShadow&&(e.tileShadow=t.get("borderShadow")),this.model.get("options").set("format",e),null===n.innerPaddingLeft&&(n.innerPaddingLeft=t.get("borderSpacing")),null===n.innerPaddingRight&&(n.innerPaddingRight=t.get("borderSpacing")),null===n.innerPaddingTop&&(n.innerPaddingTop=t.get("borderSpacing")),null===n.innerPaddingBottom&&(n.innerPaddingBottom=t.get("borderSpacing")),null===n.titlePaddingLeft&&(n.titlePaddingLeft=t.get("borderSpacing")),null===n.titlePaddingRight&&(n.titlePaddingRight=t.get("borderSpacing")),null===n.titlePaddingTop&&(n.titlePaddingTop=t.get("borderSpacing")),null===n.titlePaddingBottom&&(n.titlePaddingBottom=0),null===n.paddingLeft&&(n.paddingLeft=t.get("widgetsSpacing")),null===n.paddingRight&&(n.paddingRight=t.get("widgetsSpacing")),null===n.paddingTop&&(n.paddingTop=t.get("widgetsSpacing")),null===n.paddingBottom&&(n.paddingBottom=t.get("widgetsSpacing")),this.model.get("options").set("Alignment",n)},N.prototype.beforeRemove=function(){var i,t,e,o=this;if(this.app&&_.isFunction(this.app.beforeRemove)&&((e=this.app.beforeRemove())&&(_.isFunction(e)?i=e:_.isFunction(e.callback)&&(i=e.callback,t=e.message)),i))return{callback:function(t){var e=_.once(t),n=_.delay(function(){e("Timed out")},o.COMPONENT_SAVE_TIMEOUT);try{i(function(t){clearTimeout(n),e(t)})}catch(t){fn.Log.Error("Save error",t),clearTimeout(n),e("Save error")}},component:o.model.get("key"),message:t,widget:o.model.id}},N.prototype.getComponentName=function(){var t=this.dashboardAppModel.get("components").get(this.model.get("definitionId"))||this.dashboardAppModel.get("components").find({appKey:this.model.get("key")});return t?t.get("componentName"):""},N.prototype.getContainerDocument=function(){var t=this.dashboardViewModel.get("selectedDocumentId");return this.dashboardAppModel.get("documents").get(t)},N.prototype.hideErrorMessage=function(){this.$errorMessage.hide()},N.prototype.hideQueryStatus=function(){var t=this;clearTimeout(this.queryStatusTimer),clearInterval(this.loadingTimer),this.queryStatusRemoveTimer=_.delay(function(){t.$queryStatus.hide()},200)},N.prototype.onAlignmentChanged=function(t){var e=this,n=this.model.get("options").get("Alignment"),i=function(t){return Number(e.componentApi.getPropertyValue(n[t],"Alignment."+t))},o={"margin-left":i("paddingLeft"),"margin-right":i("paddingRight"),"margin-top":i("paddingTop"),"margin-bottom":i("paddingBottom")};this.$borderDiv.css(o),o={"margin-left":i("titlePaddingLeft"),"margin-right":i("titlePaddingRight"),"padding-top":i("titlePaddingTop"),"padding-bottom":i("titlePaddingBottom")},this.$titleDiv.css(o),o=e.$titleDiv.is(":visible")?e.$titleDiv.outerHeight(!0)+i("innerPaddingTop"):i("innerPaddingTop"),o={left:i("innerPaddingLeft"),right:i("innerPaddingRight"),top:o,bottom:i("innerPaddingBottom")},e.$appDiv.css(o),t||e.onResize()},N.prototype.onBuildModeChanged=function(t,e,n){this.dashboardViewModel.get("buildMode")?this.$el.removeClass("build-off"):this.$el.addClass("build-off")},N.prototype.onFormatChanged=function(t){var e=this.model.get("options").get("format"),n=this,i=function(t){return n.componentApi.getPropertyValue(e[t],"Format."+t)},o={"border-width":i("tileBorderWidth"),"border-radius":i("tileBorderRounding"),"border-color":i("tileBorderColor"),"background-color":i("tileTransparentBackground")?"transparent":i("tileBackgroundColor"),"box-shadow":i("tileShadow")?"rgba(0, 0, 0, 0.78) 2px 2px 5px":"none"},o=(this.$borderDiv.css(o),{"font-size":i("titleFontSize"),"font-weight":i("titleFontBold")?"bold":"normal","text-align":i("titleHorizontal"),color:i("titleColor"),"background-color":i("titleTransparentBackground")?"transparent":i("titleBackgroundColor"),"border-bottom-width":i("titleBottomBorderWidth"),"text-shadow":i("titleShadow")?"rgba(0, 0, 0, 0.5) 2px 2px 3px":"none"}),r=0;0<i("tileBorderRounding")&&(r=.85*i("tileBorderRounding")-i("tileBorderWidth")/4),this.$titleDiv.css("border-top-left-radius",r),this.$titleDiv.css("border-top-right-radius",r),r=n.model.get("options").get("Alignment"),(i=i("widgetTitle"))?(this.$titleDiv.css(o),this.$titleDiv.text(i),this.$titleDiv.show(),n.$appDiv.css("top",r.innerPaddingTop+n.$titleDiv.outerHeight(!0))):(this.$titleDiv.hide(),n.$appDiv.css("top",r.innerPaddingTop)),t||this.onResize()},N.prototype.onShowLoadingIndicatorsChanged=function(t,e){this.showLoadingIndicators=e},N.prototype.onShowNoResultsIndicatorsChanged=function(t,e){this.showNoResultsIndicators=e},N.prototype.onStyleChanged=function(){function t(t){return e.componentApi.getPropertyValue(n[t],"Style."+t)}var e=this,n=this.model.get("options").get("Style"),i=t("advanced"),i=(i!==this.customCss&&this.applyCustomCss(i),t("cssClasses"));i!==this.cssClasses&&this.applyCssClasses(i)},N.prototype.postComponentLoad=function(n,i){var t,o=this;this.appOnSettingsChange=function(t){var e=Object.keys(t);o.quickStart(n.appArgs.quickStart),_.find(e,function(t){return 0===t.indexOf("Style")})&&o.onStyleChanged(),_.find(e,function(t){return 0===t.indexOf("format")})&&o.onFormatChanged(),_.find(e,function(t){return 0===t.indexOf("Alignment")})&&o.onAlignmentChanged(),i?i.settings=t:o.app&&_.isFunction(o.app.onSettingsChange)&&o.app.onSettingsChange(t)},this.appOnSettingsChange&&this.model.get("options").toFlat&&(t=this.componentApi.processSettings(this.model.get("options").toFlat(),this.appOnSettingsChange),i?(i.settings=t,this.quickStart(n.appArgs.quickStart)):(this.app&&_.isFunction(this.app.onSettingsChange)&&(this.app.onSettingsChange(t),this.quickStart(n.appArgs.quickStart)),_.isFunction(this.app.onSettingsChange)&&("BasicComponents"!==this.model.get("key")||_.isFunction(this.app.$view.onSettingsChange))?this.model.set("hasOnSettingsChange",!0,{silent:!0}):this.model.unset("hasOnSettingsChange",{silent:!0}))),this.model.trigger("componentLoaded")},N.prototype.processComponentDefinition=function(t,e){var n=this;t&&t.set(_.omit(e,"id","componentName","componentDescription","appKey","buildModeOnly","listViewThumb")),e.buildModeOnly&&this.$el.addClass("build-mode-only"),this.dashboardViewModel.get("buildMode")||this.$el.addClass("build-off"),this.updateComponentDefinition(e,this.model),$.isEmptyObject(this.model.get("options").attributes)&&e?this.model.get("options").set(e.appArgs.json):(this.model.get("options").set("Alignment",_.extend({},e.appArgs.json.Alignment,this.model.get("options").get("Alignment")),{silent:!0}),this.model.get("options").set("Style",_.extend({},e.appArgs.json.Style,this.model.get("options").get("Style")),{silent:!0}),delete(t=_.extend({},e.appArgs.json.format,this.model.get("options").get("format"))).titlePaddingLeft,delete t.titlePaddingRight,delete t.titlePaddingTop,delete t.titlePaddingBottom,this.model.get("options").set({format:null},{silent:!0}),this.model.get("options").set({format:t},{silent:!0})),this.componentApi.convertPathsToModels("data",e.appArgs.schema,this.model.get("options")),this.componentApi.convertPathsToModels("viewstate",e.appArgs.schema,this.model.get("options")),fn.Component.convertDashboardTypesToModels(this.model.get("options"),function(t){return n.docDataModel.getByPath(t)},function(t){return n.docViewModel.getByPath(t)}),this.applyDashboardStyleSettings(),this.model.unset("upgrading",{silent:!0}),this.onStyleChanged(),this.onFormatChanged(),this.onAlignmentChanged()},N.prototype.quickStart=function(e){var i=this;_.each(e,function(e){var n;if(!i.settingsModel.get(e.path)&&!i.quickView)return n=e.message||"populate widget",i.showErrorMessage({error:t("Click to ")+" <b> "+n+"</b>",type:"QuickStart",onClick:function(){i.dashboardViewModel.get("selectedWidgetId")!==i.widgetId&&i.$el.trigger("click"),i.model.get("options").trigger("quickStart",e.path)}}),!1;i.hideErrorMessage()})},N.prototype.remove=function(){this.$customCss&&this.$customCss.remove(),N._instances=_.without(N._instances,this),fn.AppView.prototype.remove.apply(this,arguments)},N.prototype.render=function(){var t=this.getContainerDocument().get("showLoadingIndicators");return this.$el.html(fn.T.ComponentView(this.model.toJSON())),this.$errorMessage=this.$el.find(".errorMessage"),this.$queryStatus=this.$el.find(".queryStatus"),this.$titleDiv=this.$el.find(".title-div"),this.$borderDiv=this.$el.find(".border-div"),this.$appDiv=this.$el.find(".app-div"),this.widgetId&&(this.$customCss=$("head style[data-widgetid='"+this.widgetId+"']")),this.$progressBarDiv=this.$el.find(".progress-bar-div"),this.onShowLoadingIndicatorsChanged(null,t),this.model.set("upgrading",!0,{silent:!0}),this},N.prototype.requireApp=function(){var e,n=this,i=this,t=i.model.get("key"),o=i.dashboardAppModel.get("components").get(i.model.get("definitionId")),r=(o=o||i.dashboardAppModel.get("components").find({appKey:i.model.get("key")})).get("customElement");r&&customElements.get(r)?(e=document.createElement(r),i.$appDiv.append(e),e.addEventListener("componentDefinition",function(t){t=t.detail;e.componentApi=n.componentApi.interface,n.processComponentDefinition(o,t),n.initalizeEvents(),e.theme=n.dashboardViewModel.get("DashboardTheme"),n.listenTo(i.dashboardViewModel,"change:DashboardTheme",function(){e.theme=n.dashboardViewModel.get("DashboardTheme")}),n.listenTo(i.dashboardViewModel,"change:buildMode",function(){return e.resize=""}),n.postComponentLoad(t,e)}),_.delay(function(){e.options={api:i.componentApi.interface,componentId:parseInt(i.model.get("definitionId"),10),componentModel:i.model,dashboardAppModel:i.dashboardAppModel,dashboardViewModel:i.dashboardViewModel,dataModel:i.docDataModel,settingsModel:i.model.get("options"),viewModel:i.docViewModel,websiteUrl:i.dashboardAppModel.get("websiteUrl")},n.$progressBarDiv.fadeOut(0,function(){$(this).remove()})},1e3)):requirejs([t],function(t){try{i.$progressBarDiv.fadeOut(0,function(){$(this).remove()}),t.mergeWithDefault&&i.model.set("options",t.mergeWithDefault(i.model.get("options")),{silent:!0}),t.getDefaultJSONTemplates&&(i.model.get("options")._templates=t.getDefaultJSONTemplates(),i.model.get("options")._templates.Defaults=_.extend({},i.model.get("options")._templates.Defaults));var e=_.isFunction(t.getComponentDefinition)?t.getComponentDefinition({api:i.componentApi.interface,componentId:parseInt(i.model.get("definitionId"),10),componentModel:i.model,dashboardAppModel:i.dashboardAppModel,dashboardViewModel:i.dashboardViewModel,dataModel:i.docDataModel,settingsModel:i.model.get("options"),viewModel:i.docViewModel,websiteUrl:i.dashboardAppModel.get("websiteUrl")}):_.cloneDeep({appArgs:{json:{},schema:{properties:{},type:"object"}}});i.processComponentDefinition(o,e),i.app=new t({el:i.$appDiv[0],viewModel:i.docViewModel,dataModel:i.docDataModel,dashboardAppModel:i.dashboardAppModel,dashboardViewModel:i.dashboardViewModel,settingsModel:i.model.get("options"),websiteUrl:i.dashboardAppModel.get("websiteUrl"),componentModel:i.model,DeltaClientLib:i.deltaClient,api:i.componentApi.interface,widgetId:i.widgetId,quickView:i.quickView}),i.initalizeEvents(),i.postComponentLoad(e),_.isFunction(i.callback)&&i.callback(i.app)}catch(t){fn.Log.Error("loading app error, require key: "+i.model.get("key"),t),_.isFunction(i.callback)&&i.callback(t)}},function(t){fn.Log.Error("ComponentView:loadApp require error",t),_.isFunction(i.callback)&&i.callback(t)})},N.prototype.showErrorMessage=function(n){var e=this,i=n.type||"Error",o=n.error,r=this.$errorMessage.find(".errorText");0===o.indexOf("0.0")&&(o=o.substring(4)),this.$errorMessage.removeClass("Error Warning Info QuickStart").addClass(i),this.$errorMessage.find(".errorTitle span").text(t(i)),r.html(o),this.$errorMessage.show(),this.fadeTimer&&clearTimeout(this.fadeTimer),this.$errorMessage.off("click"),n.onClick&&this.$errorMessage.click(function(t){var e=$(t.target);(e.hasClass("errorPanel")||e.parents(".errorPanel").length)&&(t.stopPropagation(),n.onClick(t))}),"Info"===i&&(this.fadeTimer=_.delay(function(){return e.$errorMessage.fadeOut("slow")},3e3))},N.prototype.showQueryStatus=function(e){var n,i=this,o=e.message||e.error||"",e=e.type||"Error";if(i.customErrorClass&&(i.$queryStatus.removeClass(i.customErrorClass),i.customErrorClass=""),clearInterval(i.loadingTimer),"Loading"===e){var r,s=p();if(!i.showLoadingIndicators)return;o="0s",i.loadingTimer=setInterval(function(){r=p.duration(p().diff(s)),o=r.format("m[m] s[s]"),i.$queryStatus.find(".statusText").html(o)},1e3)}n="NoResults"===e?"No Results":e,0===o.indexOf("0.0")&&(o=o.substring(4)),i.$queryStatus.css("margin",i.$borderDiv.css("border-width")),i.$queryStatus.css("border-radius",i.$borderDiv.css("border-radius")),i.$queryStatus.removeClass("Error Warning Info Loading NoResults").addClass(e),i.$queryStatus.find(".statusTitle span").text(t(n)+(o&&"Loading"!==e?": ":"")),"Error"===e&&(n=/(.*)cssClass:"(.*)":(.*)/m.exec(o))&&(i.customErrorClass=n[2],i.$queryStatus.addClass(i.customErrorClass),o=n[3]),i.$queryStatus.find(".statusText").html(o),clearTimeout(i.queryStatusTimer),clearTimeout(i.queryStatusRemoveTimer),i.queryStatusTimer=_.delay(function(){i.$queryStatus.show()},i.QUERY_STATUS_DELAY),i.fadeTimer&&clearTimeout(i.fadeTimer),"Info"===e&&(i.fadeTimer=_.delay(function(){i.$queryStatus.fadeOut("slow")},i.QUERY_STATUS_FADE))},N.prototype.updateComponentDefinition=function(t,e){var n=xt(),i=t.appArgs.schema.properties.Alignment,o=t.appArgs.schema.properties.format,r=t.appArgs.schema.properties.Style,s=t.appArgs.json.Style;r?_.each(n.appArgs.schema.properties.Style.properties,function(t,e){r.properties[e]=t}):t.appArgs.schema.properties.Style=n.appArgs.schema.properties.Style,t.appArgs.json.Style=s?_.extend({},n.appArgs.json.Style,s):_.clone(n.appArgs.json.Style),i?_.each(n.appArgs.schema.properties.Alignment.properties,function(t,e){i.properties[e]=t}):t.appArgs.schema.properties.Alignment=n.appArgs.schema.properties.Alignment,s=t.appArgs.json.Alignment,t.appArgs.json.Alignment=s?_.extend({},n.appArgs.json.Alignment,s):_.clone(n.appArgs.json.Alignment),o?(_.each(n.appArgs.schema.properties.format.properties,function(t,e){o.properties[e]=t}),delete o.properties.titlePaddingLeft,delete o.properties.titlePaddingRight,delete o.properties.titlePaddingTop,delete o.properties.titlePaddingBottom):t.appArgs.schema.properties.format=n.appArgs.schema.properties.format,(s=t.appArgs.json.format)?(t.appArgs.json.format=_.extend({},n.appArgs.json.format,s),delete t.appArgs.json.format.titlePaddingLeft,delete t.appArgs.json.format.titlePaddingRight,delete t.appArgs.json.format.titlePaddingTop,delete t.appArgs.json.format.titlePaddingBottom):t.appArgs.json.format=_.clone(n.appArgs.json.format)},N.prototype.setOptionsValue=function(t,e){var n=this.model.get("options").get(t);this.model.get("options").set(t,_.extend({},n,e))},N._instances=[],fn.ComponentView=N,yn=I=I||{},vn=m.View,l(L,vn),L.prototype.initialize=function(t){this.$el.addClass("component-drop"),this.dashboardAppModel=t.dashboardAppModel,this.dashboardViewModel=t.dashboardViewModel,this.DeltaClientLib=t.DeltaClientLib,this.quickView=t.quickView,this.websiteUrl=t.websiteUrl,this.widgetsCollection=this.widgetsCollection||t.widgets,this.widgets=this.widgets||[],this.ignoreWidgetSelect=!1,this.widgetClass="component-drop-widget",this.initializeEvents(),this.initializeEvents_widgetCollection(),this.quickView?this.switchOffBuildMode():this.switchBuildMode(this.dashboardViewModel.get("buildMode")),this.applyCurrentWidgets()},L.prototype.initializeEvents=function(){this.listenTo(this.dashboardViewModel,"change:buildMode",this.onBuildModeChanged),this.listenTo(this.dashboardViewModel,"change:selectedWidget",this.onSelectedWidgetChanged),this.listenTo(this.dashboardAppModel,"change:pendingSelectionWidgetId",this.onSelectingWidget)},L.prototype.initializeEvents_widgetCollection=function(){this.listenTo(this.widgetsCollection,"add",this.onWidgetCollectionAdd),this.listenTo(this.widgetsCollection,"remove",this.onWidgetCollectionRemove)},L.prototype.events=function(){return{dragenter:"onDragEnter",dragleave:"onDragLeave",dragover:"onDragOver",drop:"onDrop"}},L.prototype.addComponentToWidget=function(t,e,n){var i=this.dashboardAppModel.get("components").get(e),i=this.getAppKey(i),o=t.get("component"),r=this.findWidgetItem(t.id),e=this.createNewComponent(e,i,t);o?"Tabs"===(i=o.get("key"))?((o=o.getInnermostComponents(i)).add(e),e.setParent(o)):(r&&r.view&&(r.view.remove(),r.view=null),n?t.commandSet({component:e}):t.set("component",e)):n?t.commandSet({component:e}):t.set("component",e)},L.prototype.addWidget=function(e,t,n){var i,o=this,r=this,s=e.id,a=this.renderWidget(e),l=$(document.createElement("div"));return l.addClass("fa fa-times remove-btn"),l.appendTo(a),l.click(function(t){t.preventDefault(),t.stopPropagation(),e.trigger("removeWidget")}),a.addClass(this.getWidgetClass(n)),a.attr("data-widgetid",s),this.dashboardViewModel.get("buildMode")||a.addClass("build-off"),this.addWidgetEvents(a),i={$remove:l,$widget:a,widgetId:s,model:e,view:null},this.widgets.push(i),e.get("component")&&this.renderComponent(i,t?function(){}:function(){return o.selectWidget(i)}),r.stopListening(e,"change:component"),r.listenTo(e,"change:component",_.bind(function(){i.view&&(i.view.remove(),i.view=null),i.$widget.find(".grid-stack-item-content").remove(),r.renderComponent(i,function(){return r.selectWidget(i)})},r,i)),r.stopListening(e,"removeWidget"),r.listenTo(e,"removeWidget",r.onRemoveWidget.bind(r,e)),i},L.prototype.addNewWidget=function(t,e,n){return t=t||new yn.Widget({},{},this.widgetsCollection),e&&!n&&this.addComponentToWidget(t,e,!1),this.widgetsCollection.commandAdd(t,n?"Paste":null),_.findLast(this.widgets,{widgetId:t.id})},L.prototype.addWidgetEvents=function(t){var e,n=this;if(!(t instanceof $))throw"Wrong parameter.";_.each(t,function(t){(e=$(t)).off("click"),e.on("click",$.proxy(n.onWidgetClick,n))})},L.prototype.applyCurrentWidgets=function(){var e=this;_.each(this.widgetsCollection.models,function(t){e.addWidget(t,!0,null)})},L.prototype.clearWidgets=function(t){this.deselectCurrentWidget(),0<this.widgets.length&&(_.each(this.widgets,function(t){t.view&&_.isFunction(t.view.remove)&&t.view.remove()}),this.widgets=[]),t&&t()},L.prototype.createComponentView=function(t,e){var n=t.model.get("component"),i=this.getSelectedDocument();return this.listenToOnce(n,"componentLoaded",function(){t.model.trigger("componentLoaded")}),n=new yn.ComponentView({model:n,callback:e,dashboardAppModel:this.dashboardAppModel,dashboardViewModel:this.dashboardViewModel,deltaClient:this.dashboardAppModel.get("isLite")?yn.DashClient:yn.DeltaClientLib,docViewModel:i.get("viewState"),docDataModel:i.get("data"),quickView:this.quickView,websiteUrl:this.websiteUrl,widgetId:t.widgetId}),(t.view=n).model&&(t.$widget.attr("data-componentid",n.model.get("key")),t.$remove.attr("title",n.getComponentName())),n},L.prototype.createNewComponent=function(t,e,n){n=new yn.Component({},{},n);return n.set({definitionId:t,key:e}),n},L.prototype.deselectCurrentWidget=function(){this.dashboardViewModel.set("selectedWidget",null),this.dashboardViewModel.set("selectedWidgetView",null,{silent:!0})},L.prototype.disableWidgetSelect=function(t){t&&t.stopPropagation&&t.stopPropagation(),this.ignoreWidgetSelect=!0},L.prototype.enableWidgetSelect=function(){this.ignoreWidgetSelect=!1},L.prototype.findWidgetItem=function(e){return e?_.find(this.widgets,function(t){return t.widgetId===e}):null},L.prototype.getAppKey=function(t){var e=t.get("appKey");return e=t.get("user")&&!e.match(/^(?:[a-z]+:)?\/\/|^\//)?e.replace(/\.js$/,""):e},L.prototype.getSafeDragNDropHandler=function(e){return function(t){return!(!this.isDragValid()&&!this.isDraggingSupportedFile(t))&&e.apply(this,arguments)}.bind(this)},L.prototype.getSelectedDocument=function(){return this.dashboardAppModel.get("documents").get(this.dashboardViewModel.get("selectedDocumentId"))},L.prototype.getWidgetClass=function(t){return this.widgetClass},L.prototype.isDragValid=function(){return this.dashboardAppModel.has("draggedComponentId")&&!this.quickView},L.prototype.isDraggingSupportedFile=function(t){return!!t.originalEvent.dataTransfer&&_.includes(t.originalEvent.dataTransfer.types,"Files")&&!this.quickView&&(void 0===t.originalEvent.dataTransfer.items||_.some(t.originalEvent.dataTransfer.items,function(t){return _.includes(["application/json","text/xml"],t.type)}))},L.prototype.onBuildModeChanged=function(t,e,n){this.switchBuildMode(this.dashboardViewModel.get("buildMode"),n.userInitiated)},L.prototype.onDragEnter=function(t){return this.isDragValid()&&this.userCan("addNew")&&this.$el.addClass("drop-target"),!1},L.prototype.onDragLeave=function(t){this.isDragValid()&&this.$el.removeClass("drop-target")},L.prototype.onDragOver=function(t){return this.isDragValid()&&!this.$el.hasClass("drop-target")&&this.$el.addClass("drop-target"),!1},L.prototype.onDrop=function(t){var e,n,i;if(this.isDragValid()){if(this.$el.removeClass("drop-target"),!(n=t.originalEvent.dataTransfer?t.originalEvent.dataTransfer.getData("text"):n))return!1;if(e=this.dashboardAppModel.get("components").get(n),t=$(t.currentTarget).find(".component-drop-widget").first().attr("data-widgetid"),!e)return!1;t&&(i=this.findWidgetItem(t),this.deselectCurrentWidget()),i?this.addComponentToWidget(i.model,n,!0):this.addNewWidget(new yn.Widget({},{},this.widgetsCollection),n,!1)}return!1},L.prototype.onRemoveWidget=function(t){this.widgetsCollection.commandRemove(t)},L.prototype.onResizeStart=function(){_.each(this.widgets,function(t){t.view.onResizeStart&&t.view.onResizeStart(!0)})},L.prototype.onResize=function(t){_.each(this.widgets,function(t){t.view.onResize&&t.view.onResize(!0)})},L.prototype.onResizeStop=function(){_.each(this.widgets,function(t){t.view.onResizeStop&&t.view.onResizeStop(!0)}),this.userCan()?this.$el.find(".component-build-view").removeClass("build-off"):this.$el.find(".component-build-view").addClass("build-off")},L.prototype.onSelectedWidgetChanged=function(t,e){this.selected&&this.selected.$widget.removeClass("selected"),e?(e=this.findWidgetItem(e.id))&&(this.selected=e,this.selected.$widget.addClass("selected")):this.selected=null},L.prototype.onSelectingWidget=function(t,e){t&&(this.onWidgetClick(null,e),this.dashboardAppModel.set("pendingSelectionWidgetId",null,{silent:!0}))},L.prototype.onWidgetClick=function(t,e){var n;t&&(e=$(t.currentTarget).attr("data-widgetid")),!(n=this.findWidgetItem(e))||!e&&$(t.target).is(n.$remove)||this.ignoreWidgetSelect||(t&&t.stopPropagation&&t.stopPropagation(),t&&$(t.target).parent().hasClass("QuickStart")||(this.dashboardViewModel.get("selectedWidget")===n.model?(this.dashboardViewModel.set("selectedWidget",null),this.dashboardViewModel.set("selectedWidgetView",null,{silent:!0})):(this.dashboardViewModel.set("selectedWidget",n.model),this.dashboardViewModel.set("selectedWidgetView",n.view,{silent:!0}))))},L.prototype.onWidgetCollectionAdd=function(t,e,n){this.addWidget(t,!1,null)},L.prototype.onWidgetCollectionRemove=function(t,e,n){this.removeWidget(t)},L.prototype.remove=function(){return this.clearWidgets(),m.View.prototype.remove.apply(this)},L.prototype.removeWidget=function(t){t=_.find(this.widgets,{model:t});t&&(this.selected&&this.selected===t&&this.deselectCurrentWidget(),this.widgets=_.without(this.widgets,t),t.$widget.css({border:"none",background:"none","box-shadow":"none","pointer-events":"none"}),t.view&&_.isFunction(t.view.remove)&&t.view.remove(),t.$widget.off(),t.$widget.remove())},L.prototype.renderComponent=function(t,e){e=this.createComponentView(t,e);t.$widget.append(e.$el),this.$el.append(t.$widget)},L.prototype.renderWidget=function(t){return $("<div/>")},L.prototype.selectWidget=function(t){this.ignoreWidgetSelect||(this.dashboardViewModel.set("selectedWidget",t.model),this.dashboardViewModel.set("selectedWidgetView",t.view,{silent:!0}))},L.prototype.setTheme=function(e){_.each(this.widgets,function(t){t.view&&t.view.app&&_.isFunction(t.view.app.setTheme)&&t.view.app.setTheme(e)})},L.prototype.showReplaceConfirmationDialog=function(e,n){var i=_.get(this.dashboardAppModel.get("components").get(_.get(n,"model.attributes.component.attributes.definitionId",null)),"attributes.componentName","");yn.ConfirmDialog.ShowConfirm({dialogTitle:"Confirm Replace",renderTemplate:function(){return t("Are you sure you would like to replace this "+i+" component?")},callback:e})},L.prototype.switchBuildMode=function(t,e){t?this.switchOnBuildMode(e):this.switchOffBuildMode(e)},L.prototype.switchOffBuildMode=function(t){this.disableWidgetSelect(),_.each(this.widgets,function(t){t.$widget&&t.$widget.addClass("build-off")})},L.prototype.switchOnBuildMode=function(t){this.enableWidgetSelect(),_.each(this.widgets,function(t){t.$widget&&t.$widget.removeClass("build-off")})},L.prototype.userCan=function(t){return this.dashboardViewModel.get("buildMode")&&!this.quickView},yn.ComponentDropView=L,bn=I=I||{},wn=m.View,l(Fn,wn),Fn.prototype.initializeEvents=function(){var t=this.appModel.get("documents");this.listenTo(t,"reset",this.onDocumentsReset),this.listenTo(t,"add",this.onDocumentsAdd),this.listenTo(t,"remove",this.onDocumentsRemove),this.listenTo(this.viewModel,"change:selectedDocumentId",this.onViewModelSelectedChanged)},Fn.prototype.blurSelect=function(){this.select2.data("select2").$container.find(".select2-selection").blur()},Fn.prototype.getDocuments=function(){var e=this,n=[],i=[],o=[];this.documentTypeMap={},_.sortBy(this.appModel.get("documents").map(function(t){return t.attributes}),function(t){return-Date.parse(t.lastUpdateDate)}).forEach(function(t){e.appModel.get("quickview")&&0===t.name.indexOf("Draft:")||(_.includes(t.tags,"starred")?(o.push(t),e.documentTypeMap[t.id]="starred"):i.length<e.RECENT_DOCUMENT_COUNT?(i.push(t),e.documentTypeMap[t.id]="recent"):(n.push(t),e.documentTypeMap[t.id]="other"))}),o=_.sortBy(o,function(t){return t.name.toLowerCase()}),n=_.sortBy(n,function(t){return t.name.toLowerCase()}),this.documentsList=i.concat(o,n)},Fn.prototype.onDocumentsAdd=function(t){this.listenTo(t,"change:name",this.render),this.$el.find("select").select2("close"),this.render()},Fn.prototype.onDocumentsRemove=function(t){this.stopListening(t),this.render()},Fn.prototype.onDocumentsReset=function(t,e){var n=this;_.each(e.previousModels,function(t){n.stopListening(t)}),t.each(function(t){n.listenTo(t,"change:name",n.render)}),this.render()},Fn.prototype.onResize=function(){this.availableHeight=.4*$("body").height()},Fn.prototype.onViewModelSelectedChanged=function(t,e){e!==this.$el.find("select").val()&&this.selectDocument(e)},Fn.prototype.render=function(){var i=this,o=this;return this.getDocuments(),this.$el.html(bn.T.DocumentSelector(this.documentsList)),this.select2=this.$el.find("select").select2({language:{noResults:function(){return"No Dashboards found"}},templateResult:function(t,e){var n;switch(o.documentTypeMap[t.id]){case"starred":n=$('<span><i class="dashboard-selector-icon fa fa-star" title="Starred"></i>'+_.escape(t.text)+"</span>"),$(e).addClass("starred");break;case"recent":n=$('<span><i class="dashboard-selector-icon fa fa-clock-o" title="Recent"></i>'+_.escape(t.text)+"</span>"),$(e).addClass("recent");break;default:n=$("<span>"+_.escape(t.text)+"</span>")}return n},theme:"document-selector",width:"225px"}),this.onResize(),this.select2.on("select2:open",function(){var e,n=$(".select2-container--document-selector .select2-dropdown");i.showManage&&0==n.find(".manage").length&&((e=$('<a class="manage" title="'+t("Manage Dashboards")+'">'+t("Manage Dashboards")+"</a>")).button({icons:{secondary:"fa fa-share-square-o"}}).click(function(){e.removeClass("ui-state-hover"),i.select2.select2("close"),i.trigger("manage")}),n.append("<hr>"),n.append(e)),n.find(".select2-results > ul").css("max-height",i.availableHeight+"px"),bn.Tools.isIE()||$(".select2-search__field").attr("placeholder","Search...")}),this.select2.on("select2:close",function(){_.defer(function(){o.blurSelect()})}),this.select2.on("select2:select",function(){var t=o.select2.val();if(t!==o.viewModel.get("selectedDocumentId"))try{o.appModel.get("router").onNavCancel=function(){o.select2.val(o.viewModel.get("selectedDocumentId")).trigger("change")},o.appModel.get("router").navigate(t,{trigger:!0})}catch(t){bn.Log.Error("Select Document Error:",t)}o.blurSelect()}),this.selectDocument(this.viewModel.get("selectedDocumentId")),this},Fn.prototype.selectDocument=function(t){var e=this.$el.find("select"),n=this.appModel.get("documents").get(t);e.val(t).trigger("change"),n&&this.$el.find("input").val(n.get("name"))},bn.DocumentSelector=Fn,Sn=I=I||{},_n=m.View,l(V,_n),V.prototype.initializeEvents=function(){this.listenTo(this.model.get("popups"),"reset viewStatesParsed",this.onResetPopups),this.listenTo(this.model.get("popups"),"add",this.onAddPopup),this.listenTo(this.model.get("popups"),"remove",this.onRemovePopup),this.listenTo(this.model,"change:advancedCss",this.applyCustomCss),this.listenTo(this.model,"change:cssClasses",this.onCssClassesChanged),this.listenTo(this.viewModel,"change:selectedScreenId",this.onSelectedScreenChanged),this.listenTo(this.viewModel,"change:DashboardTheme",function(t){this.applyTheme(t.get("DashboardTheme"))}),$(window).on("keydown",this.onKeyDown.bind(this))},V.prototype.applyCustomCss=function(){var t=this.model.get("advancedCss");t?t!==this.customCss&&(this.$customCss&&this.$customCss.length?this.$customCss.html(t):this.$customCss=$("<style />",{documentid:this.model.id,html:t,type:"text/css"}).appendTo(document.head),this.customCss=t):this.$customCss&&(this.$customCss.remove(),this.$customCss=null,this.customCss=null)},V.prototype.applyCssClasses=function(t){t?(t=_.isArray(t)?_.reduce(t,function(t,e){return t+" "+e}):t)!==this.cssClasses&&(this.$el.removeClass(this.cssClasses),this.$el.addClass(t),this.cssClasses=t):(this.$el.removeClass(this.cssClasses),this.cssClasses=null)},V.prototype.applyDataSources=function(){_.each(this.model.get("data").flatten(),function(t){t.isMapping()&&t.get(Sn.DocumentDataModel.AUTO_EXECUTE)&&t.apply()})},V.prototype.applyTheme=function(e){var n=this;this.screenView&&_.each(this.screenView.widgets,function(t){n.applyThemeToWidget(t,e)})},V.prototype.applyThemeToWidget=function(t,e){t.view.app&&t.view.app.setTheme&&t.view.app.setTheme(e)},V.prototype.changeScreen=function(e){this.screenView&&this.screenView.remove();var n=$(document.createElement("div"));n.addClass("screen-view"),n.appendTo(this.$el.find(".screen-view-div")),this.screenView=null,require(["Panel"],function(t){this.screenView||(this.applyDataSources(),this.passScreenPropertiesToDocumentModel(e,this.model),this.screenView=new t({el:n,model:e,dashboardAppModel:this.appModel,documentModel:this.model,dashboardViewModel:this.viewModel,websiteUrl:this.appModel.get("websiteUrl"),DeltaClientLib:this.deltaClient,api:{},isBasePanel:!0,quickView:this.quickView}))}.bind(this))},V.prototype.createPopup=function(t){return new Sn.PopupView({viewModel:this.viewModel,appModel:this.appModel,container:this.$el,quickView:this.quickView,model:t})},V.prototype.onAddPopup=function(){this.popups.push(this.createPopup(arguments[0]))},V.prototype.onRemovePopup=function(e){var t=_.find(this.popups,function(t){return t.model.get("id")===e.get("id")});this.popups.splice(this.popups.indexOf(t),1),t.remove()},V.prototype.onResetPopups=function(){var e=this;_.each(this.popups,function(t){t.remove()}),this.popups=[],this.model.get("popups").each(function(t){e.popups.push(e.createPopup(t))})},V.prototype.onKeyDown=function(t){var e,n=t.keyCode;(t.ctrlKey||t.metaKey)&&(t=this.model.get("shortcuts"),e=String.fromCharCode(n).toLowerCase(),(n=_.find(t,function(t){return t.Key===e}))&&n.Data&&n.Data.forceExecute())},V.prototype.onCssClassesChanged=function(){var t=this.model.get("cssClasses");t&&t._dashboardsType||(this.prevCssViewModel&&(this.stopListening(this.prevCssViewModel),this.prevCssViewModel=null),t instanceof m.Model&&(this.listenTo(t,"change:value",function(t,e){this.applyCssClasses(e)}),t=(this.prevCssViewModel=t).get("value")),this.applyCssClasses(t))},V.prototype.onResize=function(){this.screenView&&this.screenView.onResize(!0)},V.prototype.onSelectedScreenChanged=function(){var t,e=!1,n=this.viewModel.get("selectedScreenId");n&&(t=this.model.get("screens").get(n))&&(this.changeScreen(t),e=!0),e||((t=this.model.get("screens").findWhere({isDefault:!0}))?this.viewModel.set("selectedScreenId",t.id):(t=this.model.get("screens").first())&&(t.set("isDefault",!0),this.viewModel.set("selectedScreenId",t.id)))},V.prototype.passScreenPropertiesToDocumentModel=function(t,e){var n=t.get("relativeHeight"),i=t.get("rowCount")||24,o=t.get("rowHeight")||25;void 0===n&&void 0===(n=e.get("relativeHeight"))&&(n=!0),t.set(n={relativeHeight:n,rowCount:i,rowHeight:o}),e.set(_.extend(n,{colCount:t.get("colCount"),floatable:t.get("floatable")})),e.trigger("basePanelLayoutChanged")},V.prototype.pasteWidget=function(t){this.screenView&&!this.quickView&&this.screenView.pasteWidget(t)},V.prototype.remove=function(){var t;return this.stopListening(),this.screenView&&this.screenView.remove(),_.each(this.popups,function(t){t.remove()}),this.$customCss&&this.$customCss.remove(),(t=this.model.get("data"))&&(t.stopPolledQueries&&t.stopPolledQueries(),t.removeSubscriptions&&t.removeSubscriptions()),$(window).off("keydown"),m.View.prototype.remove.call(this)},Sn.DocumentView=V,Cn=I=I||{},Tn=m.View,l(qn,Tn),qn.checkCapslockOn=function(t){var e=/Mac/.test(navigator.platform),n=t.charCode,i=t.shiftKey,o=!1;return 97<=n&&n<=122?o=i:!(65<=n&&n<=90)||i&&e?122<n&&t.getModifierState("CapsLock")&&(o=!0):o=!i,o},qn.prototype.onWindowCapsLockClick=function(t){20===t.which&&(t.getModifierState("CapsLock")?this.setErrorMessage("capsLock","#ffc800"):this.$el.find(".loginErrorPanel").css("visibility","hidden"))},qn.prototype.render=function(){var e=this;return this.$el.html(Cn.T.LoginDialog({})),$(".quick-base").addClass("disturbed"),$(document).find(".loadingScreen svg").hide(),$(document).find(".loading-info svg").hide(),e.$userLoginForm=this.$el.find(".user-login-form"),e.$forgotPasswordForm=this.$el.find(".forgot-password-form"),e.$forgotPasswordBtn=this.$el.find(".forgot-info"),e.$passwordResetInfo=this.$el.find(".password-reset-info"),e.$recoveryResponse=this.$el.find(".recovery-response"),e.$resetUserName=this.$el.find(".reset-username"),this.$restPasswordError=this.$el.find(".reset-password-error"),e.$dialog=this.$el.find(".login-form"),e.$buttonPanel=this.$el.find(".login-button-panel"),this.$el.find(".login-btn").button({label:t("Login"),icons:{primary:"fa fa-check"}}),this.$el.find(".back-btn").button({label:t("Back"),icons:{primary:"fa fa-arrow-left"}}),this.$el.find(".reset-btn").button({icons:{primary:"fa fa-undo"},label:t("Reset")}),e.$loginBtn=this.$el.find(".login-btn"),e.$backBtn=this.$el.find(".back-btn"),e.$backBtn.hide(),e.$resetBtn=this.$el.find(".reset-btn"),e.$resetBtn.hide(),(e=$.cookie("deltaLoginError"))?$.removeCookie("deltaLoginError",{path:"/"}):e=this.errorMessage,e&&this.setErrorMessage(e),this},qn.prototype.initializeEvents=function(){var e=this;e.$el.find(".password, .username").on("keydown",function(t){13===t.which&&e.onLoginButtonClick(t)}),window.addEventListener("keydown",this.boundCapsLockFn,!0),e.$el.find(".password").on("keypress",function(t){qn.checkCapslockOn(t.originalEvent)?e.setErrorMessage("capsLock","#ffc800"):e.$el.find(".loginErrorPanel").css("visibility","hidden")}),e.$forgotPasswordBtn.on("click",function(){e.showForgotPasswordForm()}),e.$loginBtn.on("click",function(t){t.preventDefault(),e.onLoginButtonClick(t)}),e.$backBtn.on("click",function(t){t.preventDefault(),e.hideForgotPasswordForm()}),e.$resetBtn.on("click",function(t){t.preventDefault(),e.onResetButtonClick()}),$(Cn.DeltaClientLib).one("DeltaClientLogin",$.proxy(e.onLoginSuccess,e))},qn.prototype.clickLoginButton=function(){this.onLoginButtonClick({currentTarget:$(".login-button-panel .login-btn")})},qn.prototype.onLoginButtonClick=function(e){var n,i,o=this;if(!this.clicked){if(n=this.$el.find(".username").val(),i=this.$el.find(".password").val(),this.$buttonText=$(e.currentTarget).find(".ui-button-text"),!n||!i)return this.setErrorMessage("Please enter your username and password."),void e.preventDefault();this.setErrorMessage("Connecting please wait...","#fff"),this.clicked=!0,e&&($(e.currentTarget).find(".ui-button-icon-primary").removeClass("fa-check"),$(e.currentTarget).find(".ui-button-icon-primary").css({width:"auto",height:"auto"}),$(e.currentTarget).find(".ui-button-icon-primary").addClass("fa-spinner fa-pulse"),this.$buttonText.text(t("wait")+"...")),this.$el.find("input").attr("disabled","disabled"),_.isFunction(o.doLogin)&&o.doLogin(n,i,function(t){o.setErrorMessage(t)})}},qn.prototype.onLoginSuccess=function(){this.appModel.set("userName",Cn.DeltaClientLib.deltaClient.user()),$.cookie("deltaToken",Cn.DeltaClientLib.deltaClient.tokenKey(),{expires:30,path:"/"}),$(".quick-base").removeClass("disturbed"),this.onRemove()},qn.prototype.onRemove=function(){this.$loginBtn.off(),this.$backBtn.off(),this.$resetBtn.off(),this.$forgotPasswordBtn.off(),$(document).find(".loadingScreen svg").show(),$(document).find(".loading-info svg").show(),$(Cn.DeltaClientLib).off("DeltaClientLogin",this.onLoginSuccess),window.removeEventListener("keydown",this.boundCapsLockFn,!0),this.remove()},qn.prototype.onResetButtonClick=function(){var t,n=this;this.$restPasswordError.css("visibility","hidden"),this.$userLoginForm.removeClass("open"),(t=this.$resetUserName.val())&&0<t.length?(this.showPasswordResetInfo(),$.get("/kxuseradmin?operation=request&data="+t).done(function(t){n.$recoveryResponse.text(t)}).fail(function(t){var e="Error";_.isString(t)?e+=": "+t:t&&t.statusText&&(e+=": "+t.statusText),n.$recoveryResponse.text(e)})):this.$restPasswordError.css("visibility","visible")},qn.prototype.setErrorMessage=function(e,n){var i=this,o=i.$dialog.parent().find(".ui-button-icon-primary.fa-spinner.fa-pulse");this.$el.find(".loginErrorPanel").removeClass("warning"),"#fff"===n?this.$el.find(".loginErrorPanel").addClass("info"):"#ffc800"===n?this.$el.find(".loginErrorPanel").addClass("warning"):this.$el.find(".loginErrorPanel").removeClass("info"),"locked"===e?e=t("Account is locked; please contact your administrator"):"capsLock"===e&&(e='<i class="fa fa-warning"/>'+t("Caps Lock is on")),this.$el.find(".loginErrorPanel").css({}),this.$el.find(".loginErrorPanel").html(e).css("visibility","visible"),i.clicked=!1,o.length&&(o.removeClass("fa-spinner fa-pulse"),o.addClass("fa-check"),this.$loginBtn.find(".ui-button-text").text(t("Login"))),i.$el.find("input").removeAttr("disabled"),"Please reset password"!==e&&"Your password has expired"!==e||i.changePasswordDialog||(i.changePasswordDialog=new Cn.ChangePasswordDialog({appModel:i.appModel,container:i.container,message:e,onChangeSuccess:function(){i.$el.find(".loginErrorPanel").css("visibility","hidden"),i.$el.data("uiDialog")&&i.$el.dialog("close")},onDialogClose:_.bind(function(){i.changePasswordDialog=null},i)}))},qn.prototype.showForgotPasswordForm=function(){this.$userLoginForm.removeClass("open"),this.$forgotPasswordForm.addClass("open"),this.$passwordResetInfo.removeClass("open"),this.$loginBtn.hide(),this.$backBtn.show(),this.$resetBtn.show()},qn.prototype.showPasswordResetInfo=function(){this.$userLoginForm.removeClass("open"),this.$forgotPasswordForm.removeClass("open"),this.$passwordResetInfo.addClass("open"),this.$loginBtn.hide(),this.$resetBtn.hide(),this.$backBtn.show()},qn.prototype.hideForgotPasswordForm=function(){this.$forgotPasswordForm.removeClass("open"),this.$passwordResetInfo.removeClass("open"),this.$userLoginForm.addClass("open"),this.$loginBtn.show(),this.$backBtn.hide(),this.$resetBtn.hide()},Cn.LoginDialog=qn,function(t){function e(){}e.getStringColumns=function(t){t=t.source||t;return _.filter(t.dataSet.columns.models,function(t){return 11===Number(t.get("kdbType"))}).map(function(t){return t.id})},e.getScalarColumns=function(t){t=t.source||t;return _.filter(t.dataSet.columns.models,function(t){t=Number(t.get("kdbType"));return 3<t&&t<11||11<t&&t<20}).map(function(t){return t.id})},e.getNumericColumns=function(t){t=t.source||t;return _.filter(t.dataSet.columns.models,function(t){t=Number(t.get("kdbType"));return 3<t&&t<11}).map(function(t){return t.id})},e.getTimeColumns=function(t){t=t.source||t;return _.filter(t.dataSet.columns.models,function(t){t=Number(t.get("kdbType"));return 11<t&&t<20}).map(function(t){return t.id})},e.getListColumns=function(t){t=t.source||t;return _.filter(t.dataSet.columns.models,function(t){return 0===Number(t.get("kdbType"))}).map(function(t){return t.id})},t.HeuristicHelpers=e}(I=I||{}),(I||(I={})).HelpDialog=m.View.extend({$dialog:null,appModel:null,className:"quick-base window",viewModel:null,initialize:function(t){this.appModel=t.appModel,this.container=t.container,this.viewModel=t.viewModel,this.tag=t.tag,this.render()},remove:function(){this.$el.dialog("destroy").remove(),this.stopListening(),this.$el.off(),this.$el.remove()},render:function(){var e=this,n=$(document),i=this.appModel.get("DocsUrl"),o=this.appModel.get("websiteUrl").replace("/edit",""),i=void 0!==i?i:o+"docs/",o=this.appModel.get("isHelpDialogTabbed")||!1,i=void 0!==this.tag?i+"/"+this.tag:i;o?window.open(i,"_blank"):(this.$el.html($("<iframe />").attr("src",i)),this.$dialog=this.$el.dialog(_.extend({appendTo:this.container,dialogClass:"quick-base help-dialog",title:t("Help"),resizable:!0,height:.8*n.height(),width:.8*n.width(),modal:!0,autoOpen:!0,draggable:!0,open:function(){$('<i class="fa fa-question-circle" />').insertBefore(e.$el.parent().find(".ui-dialog-title"))},close:function(){e.remove()}},this.options)))}}),P=I=I||{},Dn=m.View,l(Yn,Dn),Yn.prototype.getTimezones=function(){this.timezones=_.map(p.tz.names(),function(t){return{group:t.substr(0,t.indexOf("/")),label:t.substr(t.indexOf("/")+1),value:t}}),this.timezones=_.groupBy(this.timezones,"group")},Yn.prototype.onAbout=function(){new P.AboutDialog({appModel:this.appModel,container:this.dialogContainer,viewModel:this.viewModel})},Yn.prototype.onHelp=function(){new P.HelpDialog({appModel:this.appModel,container:this.dialogContainer,viewModel:this.viewModel})},Yn.prototype.onChangeLanguage=function(){var t=this.$selectLanguage.val();t&&t!==$.cookie("dashboard-language")&&($.cookie("dashboard-language",t,{expires:90,path:"/"}),window.location.reload(!1))},Yn.prototype.onChangeLogLevel=function(){var t=this.$selectLogLevel.val();t&&t!==$.cookie("dashboard-log-level")&&$.cookie("dashboard-log-level",t,{expires:90,path:"/"}),P.Log.trace(t.toString())},Yn.prototype.onChangePassword=function(){new P.ChangePasswordDialog({appModel:this.appModel,container:this.dialogContainer})},Yn.prototype.onChangeTheme=function(){var t=this.$selectTheme.val();t&&t!==$.cookie("dashboard-theme")&&($.cookie("dashboard-theme",t,{expires:90,path:"/"}),this.trigger("themeChange",t))},Yn.prototype.onChangeViewerTheme=function(){var t=this.$selectViewerTheme.val();t&&t!==$.cookie("dashboard-viewer-theme")&&($.cookie("dashboard-viewer-theme",t,{expires:90,path:"/"}),this.trigger("themeChange",t))},Yn.prototype.onChangeTimezone=function(){var t=this.$selectTimezone.val();t&&t!==$.cookie("dashboard-timezone")&&($.cookie("dashboard-timezone",t,{expires:90,path:"/"}),window.location.reload(!1))},Yn.prototype.onLogout=function(){var e=this,n=this.viewModel.get("selectedDocumentId"),i=this.appModel.get("documents").find(function(t){return t.id===n});!(this.isQuickView?i&&i.get("viewState").wasChanged:i&&i.get("wasChanged"))||this.isQuickView&&!i.get("unsavedViewerPrompt")?P.DeltaClientLib.logout():new P.AreYouSureDialog({userClass:this.isQuickView?"quick-view":"quick-dash",container:this.dialogContainer,noSaveCb:_.bind(P.DeltaClientLib.logout,P.DeltaClientLib),saveCb:function(){var t;e.isQuickView?((t=i.get("viewState")).withAllProperties=!0,i.get("viewState").save({id:n},{success:_.bind(P.DeltaClientLib.logout,P.DeltaClientLib)}),t.withAllProperties=!1):i.saveNow($.noop,_.bind(P.DeltaClientLib.logout,P.DeltaClientLib))}})},Yn.prototype.onThemeSwitchableChange=function(){this.viewModel.get("themeSwitchable")?this.$selectViewerTheme.prop("disabled",!1):this.$selectViewerTheme.prop("disabled",!0)},Yn.prototype.render=function(){var t,e=this;return this.$el.html(P.T.ProfileMenu({majorTimezones:this.MAJOR_TIMEZONES,saml:this.appModel.get("saml"),isLite:this.appModel.get("isLite"),logLevel:this.logLevels,themes:this.themes,timezones:this.timezones,editor:!this.isQuickView,showBreadcrumbs:this.appModel.get("showBreadcrumbs")})),this.$buttonset=this.$el.find(".buttonset"),this.$selectLanguage=this.$el.find(".select-language"),this.$selectLogLevel=this.$el.find(".select-log-level"),this.$selectTheme=this.$el.find(".select-theme"),this.$selectTimezone=this.$el.find(".select-timezone"),this.$selectViewerTheme=this.$el.find(".select-viewer-theme"),this.$breadcrumbs=this.$el.find(".breadcrumbs"),this.$buttonset.buttonset(),this.$buttonset.menu({select:function(t){switch($(t.currentTarget).attr("data-options")){case"change-password":e.onChangePassword();break;case"about":e.onAbout();break;case"helpguide":e.onHelp();break;case"logout":e.onLogout();break;case"login-history":e.trigger("login-history");break;case"logout-local":e.ssoLogout("local");break;case"logout-global":e.ssoLogout("global");case"open-editor":window.open("./edit#"+P.Tools.getHash(),"_blank");break;case"open-viewer":window.open("../#"+P.Tools.getHash(),"_blank");break;case"document-breadcrumbs":e.toggleBreadcrumbs()}}}),t=[{$el:this.$selectLanguage,value:$.cookie("dashboard-language")||"en",options:{},callback:this.onChangeLanguage},{$el:this.$selectLogLevel,value:$.cookie("dashboard-log-level")||"4",options:{minimumResultsForSearch:10},callback:this.onChangeLogLevel},{$el:this.$selectTheme,value:$.cookie("dashboard-theme")||"kx-darkroom",options:{minimumResultsForSearch:3},callback:this.onChangeTheme},{$el:this.$selectViewerTheme,value:$.cookie("dashboard-viewer-theme")||"kx-darkroom",options:{minimumResultsForSearch:3},callback:this.onChangeViewerTheme},{$el:this.$selectTimezone,value:P.Tools.timezone,options:{},callback:this.onChangeTimezone}],_.each(t,function(t){t.$el.val(t.value),t.$el.select2(_.extend({theme:"dashboards"},t.options)),t.$el.on("select2:select",_.bind(t.callback,e)),t.$el.on("select2:open",function(){$("body > .select2-container--dashboards.select2-container--open").addClass("select2--environment"),$(".select2-search__field").on("click",function(t){t.stopPropagation()})}),t.$el.on("select2:close",function(){$(".select2-search__field").off()})}),(this.isQuickView?this.$el.find(".row.theme"):this.$el.find(".row.viewer-theme")).css("display","none"),this},Yn.prototype.ssoLogout=function(t){P.DeltaClientLib.ssoLogout(t)},Yn.prototype.toggleBreadcrumbs=function(){this.appModel.set("showBreadcrumbs",!this.appModel.get("showBreadcrumbs")),this.appModel.get("showBreadcrumbs")?this.$breadcrumbs.addClass("checked"):this.$breadcrumbs.removeClass("checked")},P.ProfileMenu=Yn,Mn=I=I||{},En=m.View,l(O,En),O.prototype.initializeEvents=function(){this.listenTo(this.viewModel,"change:buildMode",this.onBuildModeChange),this.listenTo(this.model,"change:dialogTitle change:dialogWidth change:dialogHeight change:modal change:resizable",this.onDialogAttributeChange),this.listenTo(this.model,"change:visible",this.initializeVisible)},O.prototype.destroyDialog=function(){this.$dialog.dialog("instance")&&this.$dialog.dialog("destroy")},O.prototype.initializeComponentDrop=function(){var t;this.componentDropView||(t=$("<div></div>",{class:"component-drop"}),this.$contentPanel.append(t),this.componentDropView=new Mn.ComponentDropView({el:t,dashboardAppModel:this.appModel,dashboardViewModel:this.viewModel,DeltaClientLib:Mn.DeltaClientLib,quickView:this.quickView,widgets:this.model.get("widgets")}))},O.prototype.popupPosition=function(){var t,e=this.model.get("dialogTop"),n=this.model.get("dialogLeft"),i=$(".main-toolbar").height()||34;return!e&&0!==e||!n&&0!==n||((t=localStorage.getItem("popupDialog-"+this.model.get("id")))&&(e=(t=JSON.parse(t)).top,n=t.left),e=parseFloat(e)-i,n=parseFloat(n)),{top:e,left:n}},O.prototype.initializeDialog=function(){var e,n=this,t=!1,i=this.processSettings(),o=(this.popupPosition(),{my:"center",at:"center",of:this.$dialogContainer}),r={appendTo:this.$dialogContainer,autoOpen:!1,close:function(){var t=n.model.get("visible");!n.isEditing&&t instanceof m.Model&&!1!==t.get("value")&&t.set("value",!1),n.doActions(n.model.get("Actions")),n.isEditing?n.remove():n.removeComponentDropView()},dialogClass:"popup-dialog",drag:function(t,e){localStorage.setItem("popupDialog-"+n.model.get("id"),JSON.stringify(e.offset))},open:function(){n.componentDropView&&n.componentDropView.onResize(),n.$dialog.dialog("option",{position:o});var t=n.$dialog.parent();t.attr("data-widgetid",n.widgetId),(e=n.popupPosition()).top&&e.left&&t.css({top:e.top,left:e.left}),n.isEditing&&$("<div />").addClass("popup-mask ui-widget-overlay").appendTo(n.$dialogContainer).click(function(){n.$dialog.dialog("close")})},position:o,resizeStop:function(){n.componentDropView&&n.componentDropView.onResize()},title:i.dialogTitle};_.assign(r,this.getAdjustedSize(i)),this.isEditing?(r.modal=!1,r.resizable=!1):(r.modal=!0===i.modal,r.resizable=!0===i.resizable),this.$dialog.dialog("instance")?(this.$dialog.dialog("option","modal")!==r.modal&&(t=this.$dialog.dialog("isOpen")),this.$dialog.dialog("option",r),t&&(this.$dialog.dialog("close"),this.$dialog.dialog("open"))):this.$dialog.dialog(r)},O.prototype.initializeVisible=function(){var t=this.model.get("visible");this.visibleListener&&this.stopListening(this.visibleListener),t instanceof Mn.DocumentViewModel&&(this.listenTo(t,"change:value",this.onVisibleChange),this.visibleListener=t),this.onVisibleChange()},O.prototype.onBuildModeChange=function(){this.isEditing?this.remove():this.viewModel.get("buildMode")?this.$dialog.dialog("close"):(this.initializeDialog(),this.onVisibleChange())},O.prototype.getAdjustedSize=function(t){return{height:Math.min(t.dialogHeight,this.$dialogContainer.height())||.8*this.$dialogContainer.height(),width:Math.min(t.dialogWidth,this.$dialogContainer.width())||.8*this.$dialogContainer.width()}},O.prototype.onVisibleChange=function(){var t=this,e=this.model.get("visible");this.viewModel.get("buildMode")||(e instanceof Mn.DocumentViewModel&&(e=e.get("value")),this.$dialog.dialog("instance")&&_.defer(function(){t.toggleDialog(e)}))},O.prototype.pasteWidget=function(t){var e=t.get("component").get("definitionId"),n=this.componentDropView.widgetsCollection.first();n?((t=t.clone(n.get("id"))).setParent(this.componentDropView.widgetsCollection),n.commandSet({component:t.get("component")})):(t.setParent(this.componentDropView.widgetsCollection),this.componentDropView.addNewWidget(t,e,!0))},O.prototype.processSettings=function(){var n=this,t=_.omit(this.model.attributes,"visible"),i={};return _.each(this.viewStateListeners,function(t){n.stopListening(t,"change:value")}),this.viewStateListeners={},_.each(t,function(t,e){t instanceof Mn.DocumentViewModel?(i[e]=t.get("value"),n.viewStateListeners[t.path]||(n.listenTo(t,"change:value",function(){n.$dialog.dialog("instance")&&n.$dialog.dialog("isOpen")&&("height"===t.path||"width"===t.path)?n.$dialog.dialog(n.getAdjustedSize(n.processSettings())):n.initializeDialog()}),n.viewStateListeners[t.path]=t)):i[e]=t}),i},O.prototype.remove=function(){return this.isEditing&&this.$dialogContainer.find(".popup-mask").remove(),this.onDialogAttributeChange.cancel(),this.destroyDialog(),this.removeComponentDropView(),this.viewStateListeners={},m.View.prototype.remove.apply(this)},O.prototype.removeComponentDropView=function(){this.componentDropView&&(this.componentDropView.remove(),this.componentDropView=null)},O.prototype.stringToBoolean=function(t){if("boolean"==typeof t)return t;if(!t)return!1;var e=t.toString();switch(e.toLowerCase().trim()){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":case null:return!1;default:return Boolean(e)}},O.prototype.toggleDialog=function(t){var t=_.isUndefined(t)?!this.$dialog.dialog("isOpen"):t;this.$dialog.dialog("instance")&&(this.stringToBoolean(t)?(this.initializeComponentDrop(),t=_.pick(this.$dialog.dialog("option"),["width","height"]),0!==Number(t.width)&&0!==Number(t.height)||this.$dialog.dialog("option",this.getAdjustedSize(this.processSettings())),this.$dialog.dialog("open"),this.viewModel.get("buildMode")&&(this.viewModel.set("selectedWidget",this.model),this.viewModel.set("selectedWidgetView",this,{silent:!0}))):this.$dialog.dialog("close"))},O.prototype.doActions=function(t){var o=this;_.each(t,function(t,e){var n=o.getPropertyMeta(e,"Current"),i=o.getPropertyMeta(e,"Target");n&&(n="viewstate"===n.type?n.value:t.Current,Mn.Tools.isKDBTemporal(n)&&(n=Mn.Tools.convertKDBTemporalToMoment(n).toDashString()),i&&"viewstate"===i.type&&i.path&&o.model.get("Actions")[e].Target.set("value",n))})},O.prototype.getPropertyMeta=function(t,e){var n,i,o,t=this.model.get("Actions")[t][e];if(_.isNil(t))return null;e=this.getSourceType(t);return"viewstate"===e?(o=t.get("value"),n=t.get("_default"),i=t.get("_type")):o=t,{path:t.path||null,type:e,value:o,viewstateType:i||null,defaultValue:n||null}},O.prototype.getSourceType=function(t){return t&&(t instanceof Mn.DocumentViewModel||t.get&&t.get("_viewType")||t.has&&t.has("_default")&&t.has("value"))?"viewstate":null},Mn.PopupView=O,function(c){function p(){}p.applyFormatToValue=function(t,e,n,i,o){var r={1:"Boolean",2:"String",4:"Number",5:"Number",6:"Number",7:"Number",8:"Number",9:"Number",10:"String",11:"String",12:"Timestamp",13:"Month",14:"Date",15:"Datetime",16:"Timespan",17:"Minute",18:"Second",19:"Time"}[i],i=3<i&&i<10?"Number":11<i&&i<20?"DateTime":"String";return"TO_STRING"==e?t.toString():e?p._applyFormat(t,e,n,r,o,i):p._applyDefaultFormat(t,n,r,o,i)},p._applyFormat=function(t,e,n,i,o,r){var s=t.toString();switch(i=0===e.indexOf("SmartNumber")?"Smart Number":i){case"Smart Number":"DateTime"===r&&(u=c.Tools.convertKDBTemporalToMoment(t),t=_.escape(u)),a=-1!==e.indexOf(".")?e.split(".")[1].length:0,s=c.Tools.smartFormatNumber(t,a,!o);break;case"Number":!_.isNaN(Number(t))&&_.isFinite(Number(t))&&(s=XLSX.SSF.format(e,Number(t)),o&&(s=p._hideTrailingZeroes(s)));break;case"Date":case"Month":case"Timestamp":case"Datetime":case"Timespan":case"Minute":case"Second":case"Time":var a="Time"===n,l="DateTime"===n,u=c.Tools.convertKDBTemporalToMoment(t);"Number"===n?(s=_.escape(u),!_.isNaN(Number(s))&&_.isFinite(Number(s))&&(s=XLSX.SSF.format(e,Number(s)),o&&(s=p._hideTrailingZeroes(s)))):s=_.isFunction(u.isValid)&&!u.isValid()?_.escape(u):a||l?u.formatNano(e,{trim:!1,trimNano:!1}):u.formatNano(e);break;default:s=t.toString()}return s},p._applyDefaultFormat=function(t,e,n,i,o){var r=t.toString(),s=null;return c.Tools.isKDBTemporal(t)&&(s=c.Tools.convertKDBTemporalToMoment(t)),"DateTime"===o?"Number"===e?r=_.escape(s):s&&_.isFunction(s.format)?r=s.format():_.isFunction(t.toString)&&(r=t.toString()):"Number"===o&&i&&(r=p._hideTrailingZeroes(r)),r},p._hideTrailingZeroes=function(t){var e=t;if(0<=e.indexOf(".")){for(e[e.length-1],0;"0"===e[e.length-1];)e=e.slice(0,-1);"."===e[e.length-1]&&(e=e.slice(0,-1)),e+=""}return e},c.RawDataFormatter=p}(I=I||{}),function(h){function g(){}g.getFormData=function(i,t,o){var e=[],r=[];e.push(_.map(t,function(t,e){t=t.colName||t.colId;return i.length||(r[e]={isStringType:!1,format:"",type:"String"}),{formattedVal:t,value:t,type:"String"}}));for(var s=0;s<i.length;s++){var a=[];_.each(t,function(t,e){var n=i[s][t.colId];null!=n?(n=g.generateExportData(t,n,e,o,r),a.push(n)):(r[e]=r[e]||{isStringType:!1,format:t.dataFormat,type:t.dataType},a.push({formattedVal:"",value:"",type:null}),console.log("Cell value is either undefined or null: "+t.colId))}),e.push(a)}return{data:e,columnHeaders:r}},g.generateExportData=function(t,e,n,i,o){var r,s=t.dataFormat,a=t.dataKdbType,l=t.dataType,u=t.hideTrailingZeroes,c=t.prefix,t=t.suffix,p={},d=g.checkIfFormatXLSXCompatible(s),d=!("Boolean"===l||s&&d);return o[n]=o[n]||{isStringType:!1,format:s,type:l},""!==e?(a=h.RawDataFormatter.applyFormatToValue(e,s,l,a,u),"csv"===i&&/^[-\+=@]/.test(a)&&(a="'"+a),d?(p={formattedVal:a,value:c+a+t},o[n].type="String"):"Boolean"===l?p={formattedVal:a,value:"true"===a}:"Number"===l&&"%"===t?(r=0<(d=100*Number(e))-Math.floor(d)?d.toFixed(2):d.toFixed(0),a=d+"%",s=-1!==r.indexOf(".")?"0.00%":"0%",16<r.length&&(o[n].isStringType=!0),p={formattedVal:a,value:Number(e),format:s}):_.includes(["Date","Time","DateTime","Boolean"],l)||!c&&!t?p=g._convertToExportFormat(n,a,e,l,s,i,u,o):(p={formattedVal:a,value:c+a+t},o[n].type="String")):p={formattedVal:"",value:"",type:"String"},p},g.checkIfFormatXLSXCompatible=function(t){var e=!0;return e=!_.includes(g.EXCEL_INCOMPATIBLE_FORMATS,t)&&-1===t.indexOf(".SSS")?e:!1},g._convertToExportFormat=function(t,e,n,i,o,r,s,a){var l,u,c={format:void 0,formattedVal:e,value:"",type:void 0};switch("Number"===i&&(isNaN(Number(n))||!_.isFinite(Number(n))?c.type=i="String":_.isString(e)&&16<e.length&&(i="String",a[t].isStringType=!0)),i){case"Number":s&&!/[%]/.test(o)&&(u=(u=-1!==e.indexOf(".")?e.split(".")[1].length:0)?"."+Array(u+1).join("0"):"",(u=(-1!==o.indexOf(".")?o.split(".")[0]:o)+u)!==o&&(c.format=u)),l=Number(n);break;case"Date":"csv"!==r&&p.utc(e,o).isValid()&&"Invalid date"!==p.utc(e,o).format()?l=p.utc(e,o).format():"csv"===r?(l=e,a[t].type="String"):(l=e,a[t].isStringType=!0);break;case"Time":case"DateTime":l=e,a[t].type="String";break;default:l=e}return c.value=l,c},g.EXCEL_INCOMPATIBLE_FORMATS=["","SmartNumber","SmartNumber.0","SmartNumber.00","SmartNumber.000","SmartNumber.0000","SmartNumber.00000","SmartNumber.000000","SmartNumber.0000000","SmartNumber.00000000","SmartNumber.000000000","SmartNumber.0000000000","HH:mm","HH:mm:ss","HH:mm:ss.SSS","HH:mm:ss.SSSSSS","HH:mm:ss.SSSSSSSSS","YYYY-MM-DD HH:mm:ss.SSS","YYYY-MM-DD HH:mm:ss.SSSSSS","YYYY-MM-DD HH:mm:ss.SSSSSSSSS","mm:ss","mm:ss.SSS","Mm:ss.SSSSSS","mm:ss.SSSSSSSSS","ss","ss.SSS","ss.SSSSSS","ss.SSSSSSSSS"],h.FileExportDataGenerator=g}(I=I||{}),n=I=I||{},Pn=n.DialogBase,l(Hn,Pn),Hn.prototype.dialogButtons=function(){var t=this;return[{text:"OK",click:function(){t.options&&(t.options.showLoading?(t.showLoadingSpinner(),_.defer(function(){t.dialogClose()})):t.dialogClose())},icons:{primary:"fa fa-check"}},{text:"Cancel",click:function(){t.isCancel=!0,t.dialogClose()},icons:{primary:"fa fa-times"}}]},Hn.prototype.postRender=function(){var e=this;this.$("input").val(this.options.inputValue),this.$("input").on("input",function(t){e.options.inputValue=e.inputValue=$(t.target).val()})},Hn.prototype.renderTemplate=function(){return t("<span>what?</span><input />")},Hn.prototype.showLoadingSpinner=function(){var t=this.$dialogButtonpane.find("span.fa.fa-check");t.removeClass("fa-check"),t.addClass("fa-spinner fa-pulse")},Hn.ShowInput=function(e,n,i,o,r,s,a){return new Hn(_.extend({iconClass:o,dialogTitle:n,callback:e,inputValue:r,userClass:s,showLoading:a},i?{renderTemplate:function(){return t("<div>"+i+"</div><input style='width: 100%; box-sizing: border-box;' />")}}:{}))},n.SimpleInputDialog=Hn,function(p){function d(t){this.csvExportDelimiter=t.csvExportDelimiter,this.dataSet=t.dataSet,this.metaData=t.metaData,this.configSets=t.configSets,this.workSheetTitle=t.workSheetTitle,this.fileFormat=t.fileFormat,this.fileName=t.fileName,this.bookType={".xlsx":"xlsx",".xls":"xlml",".csv":"csv"}[t.fileFormat]}d.prototype.createExportOfCurrentData=function(n){var i,o,r=this,t=r.configSets,e=r.dataSet,s=r.metaData,a=[],l={SheetNames:[],Sheets:{}},u=",",c=r.bookType;t&&_.keys(t).length?_.each(t,function(t){a.push(p.FileExportDataGenerator.getFormData(t.dataSet,t.metaData,c))}):e&&e.length&&s&&s.length&&(a[0]=p.FileExportDataGenerator.getFormData(e,s,c)),a.length&&a[0].data.length?(_.each(a,function(t,e){var n=r.workSheetTitle||"Work_sheet";n+=1<a.length?"_"+e:"",e=r.convertDataToWorksheet(t.data,t.columnHeaders),l.SheetNames.push(n),l.Sheets[n]=e}),"csv"!==c?(i=XLSX.write(l,{bookType:c,bookSST:!1,type:"binary"}),t=d.s2ab(i),r.downloadExportFile(n,t)):(o=1,r.csvExportDelimiter&&r.csvExportDelimiter.length&&(u=r.csvExportDelimiter),_.each(l.Sheets,function(t){var e=1<a.length?n.slice(0,-4)+"part"+o+".csv":n;try{i=XLSX.utils.sheet_to_csv(t,{FS:u})}catch(t){return void console.log("Error",t)}0===i.indexOf("ID")&&(/[-\+\{\}\[\]\?\^\*\.\|\$]/.test(u)&&(u="\\"+u),t=new RegExp("(ID[^"+u+"\n]*)"),i=i.replace(t,'"$1"')),r.downloadExportFile(e,i),o+=1}))):console.error("Data formatter function returned invalid parameter or no data")},d.prototype.downloadExportFile=function(t,e){var n,i="application/octet-stream",o=document.createElement("a");window.Blob?(n=new Blob([e],{type:i}),window.navigator.msSaveOrOpenBlob?o.onclick=function(){window.navigator.msSaveOrOpenBlob(n,t)}:void 0!==o.download&&o.setAttribute("href",URL.createObjectURL(n))):o.setAttribute("href",encodeURI(i+","+e)),void 0!==o.download&&o.setAttribute("download",t),document.body.appendChild(o),o.click(),document.body.removeChild(o)},d.prototype.showDialog=function(){var e=this,n=e.fileFormat,i={".csv":"Csv",".xlsx":"Excel"}[n],o=e.fileName+n;p.SimpleInputDialog.ShowInput(function(){var t=this.inputValue;t=(t=""+t||p.ExportTools.getDefaultExportFileName(i)).replace(/:/g,"-").replace(/[^\w \.\-]/g,""),new RegExp(n+"$").test(t)||(t+=n),e.createExportOfCurrentData(t)},t("Export file"),t("Please enter the filename"),"fa fa-download",o,"",!0)},d.prototype.convertDataToWorksheet=function(t,e){for(var n={},i={s:{c:1e7,r:1e7},e:{c:0,r:0}},o=0;o!=t.length;++o)for(var r=0;r!=t[o].length;++r){i.s.r>o&&(i.s.r=o),i.s.c>r&&(i.s.c=r),i.e.r<o&&(i.e.r=o),i.e.c<r&&(i.e.c=r);var s=t[o][r],a=(void 0!==s.type&&""!==s.type?s:e[r]).type,l=s.format||e[r].format,u={};if(null!==a){e[r].isStringType&&(a="String",s.value=s.formattedVal||s.value);var c=XLSX.utils.encode_cell({c:r,r:o});switch(a){case"Number":l?(u.t="n",u.z=l):u.t="s";break;case"Boolean":u.t="b";break;case"Date":case"DateTime":u.t="d",u.z=l;break;default:u.t="s"}u.s={alignment:{horizontal:"top"}},u.v=s.value,n[c]=u}}return i.s.c<1e7&&(n["!ref"]=XLSX.utils.encode_range(i)),n},d.s2ab=function(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),i=0;i!=t.length;++i)n[i]=255&t.charCodeAt(i);return e},p.FileExport=d}(I=I||{}),In=I=I||{},kn=m.View,l(Kn,kn),Kn.prototype.initializeEvents=function(){this.listenTo(this.appViewModel,"change:"+this.EXPORT_PROPERTY_OBJECT+this.EXPORT_PROPERTY_KEYS.concat(" change:"+this.EXPORT_PROPERTY_OBJECT),this.displayChoiceLinkButtons),this.$lnkCsvExport.click(_.bind(this.fileExport,this,".csv")),this.$lnkExcelExport.click(_.bind(this.fileExport,this,".xlsx")),this.$lnkFullExport.click(_.bind(this.apiExport,this)),this.$lnkDownloadScreenshot.click(_.bind(this.downloadImage,this))},Kn.prototype.apiExport=function(){var e=this,n=this.getExportConfig(),n=In.ExportTools.getExportFileName(n.fileName,n.altFileName,"FullExport"),i=$("<span />").addClass("export-spinner fa fa-spinner fa-pulse").attr("title",t("Download in progress")).appendTo(this.$lnkFullExport);e.$lnkFullExport.addClass("export-in-progress"),e.api.exportData(this.appViewModel.get(e.DATA_SOURCE_PROPERTY),function(){i.remove(),e.$lnkFullExport.removeClass("export-in-progress")},{exportName:n})},Kn.prototype.displayChoiceLinkButtons=function(){var t=!1,e=!1,n=this.appViewModel.get(this.EXPORT_PROPERTY_OBJECT);n&&(n.changed&&(t=!0),n.ShowExportCsvButton||n.ShowExportExcelButton||n.ShowFullExportButton||n.ShowScreenshot&&!this.isIE?(this.$lnksExport.hasClass("link-disabled")&&t&&(e=!0),this.$lnksExport.removeClass("link-disabled"),this.$lnkCsvExport.toggleClass("link-disabled",!n.ShowExportCsvButton),this.$lnkExcelExport.toggleClass("link-disabled",!n.ShowExportExcelButton),this.$lnkFullExport.toggleClass("link-disabled",!n.ShowFullExportButton),this.$lnkDownloadScreenshot.toggleClass("link-disabled",!(n.ShowScreenshot&&!this.isIE))):(this.$lnksExport.addClass("link-disabled"),t&&(e=!0)),n.ShowExportCsvButton||n.ShowExportExcelButton||n.ShowFullExportButton||n.ShowScreenshot&&!this.isIE?this.trigger("enable-links"):this.trigger("disable-links"),e&&this.trigger("redraw-chart"))},Kn.prototype.downloadImage=function(){var e=this.getFileName(),e=_.isString(e)&&e.length?e:"Screenshot";e+=".png",this.generateImage(function(t){In.Tools.fileSave(e,t)})},Kn.prototype.generateImage=function(t){var i,o,e,n,r=document.createElement("canvas"),s=r.getContext("2d"),a=new Image,l=this.getSvgNode();function u(t){var n=document.defaultView.getComputedStyle(t,"");try{return n.cssText||Array.from(n).reduce(function(t,e){return t+e+": "+n[e]+"; "},"").trim()}catch(t){return""}}n=l.getBoundingClientRect(),i=Math.round(n.height),o=Math.round(n.width),r.width=o,r.height=i,r.style.display="block",l.style.width=o,l.style.height=i,n=function(t){var t=function(t){for(var e=t,t=t.cloneNode(!0),n=(t.style.cssText=u(e),e.getElementsByTagName("*")),i=t.getElementsByTagName("*"),o=n.length;o--;){var r=n[o];i[o].style.cssText=u(r)}return t}(t),e=(new XMLSerializer).serializeToString(t);if(e=(e=(e=e.replace(/<svg/,'<svg width="'+o+'" height="'+i+'"')).replace(/(\w+)?:?xlink=/g,"xmlns:xlink=")).replace(/NS\d+:href/g,"xlink:href"),/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))for(var n=void 0;n=/(<rect[^>]*) style="[^>]*"([^>]*>)/.exec(e);)e=e.replace(n[0],n[1]+n[2]);return e}(l),this.isIE?alert("This feature is not supported in your browser"):(s.clearRect(0,0,o,i),s.fillStyle=function t(e){var n=document.defaultView.getComputedStyle(e)["background-color"];return/^rgb\(/.test(n)?n:t(e.parentNode)}(l),s.fillRect(0,0,o,i),l=new Blob([n],{type:"image/svg+xml;charset=utf-8"}),e=URL.createObjectURL(l),a.onload=function(){URL.revokeObjectURL(e),s.drawImage(a,0,0),r.toBlob(t)},a.src=e)},Kn.prototype.getButtonSettings=function(){},Kn.prototype.getFileName=function(){var t=this.getExportConfig(),e="";return e=_.isObject(t)&&(_.isArray(t.fileName)&&t.fileName.length||t.altFileName)?In.ExportTools.getExportFileName(t.fileName,t.altFileName,""):e},Kn.prototype.remove=function(){return this.$lnkCsvExport.off(),this.$lnkExcelExport.off(),this.$lnkFullExport.off(),this.$lnkCopyScreenshot.off(),this.$lnkDownloadScreenshot.off(),m.View.prototype.remove.apply(this,arguments)},Kn.prototype.showExportError=function(t){t=t||"Export of .csv or .xlsx for pivot charts is not supported.";In.ErrorDialog.ShowError(t)},o=Kn,(In.FileExporterView=o).prototype.SETTINGS=["api","appViewModel"],An=I=I||{},B.resolveChartColumnFormatAndType=function(t,e,n){var i=B.CHARTS_DATA_FORMAT_MAP[e],o=!!B.CHARTS_DATE_FORMAT_MAP[i],r=8===n||9===n,s=11<n&&n<20,a=3<n&&n<10;return 3===n||n<1||19<n?(n=11,i="TO_STRING",t="String"):void 0===(i=o||r||-1===i.indexOf(".")?i:i.split(".")[0])?(console.log("Invalid format: "+i+" or kdbType: "+n+". Exporting with default formats as String type"),i="",t="String"):("String"===t?i="":(!s||"Number"!==t&&o)&&(s||!o&&"Date"!==t)?"Number"!==t||a||(t="String"):(t="String",i="",console.log("!ExportTools format mismatch, using default format.Params, value kdbType : "+n+", col type: "+t+", format: "+e)),"Date"===t&&o&&(t=B.getTemporalTypeFromFormat(i)),0===i.indexOf("SmartNumber")&&(t="String")),{dataType:t=1===n?"Boolean":t,dataFormat:i,dataKdbType:n}},B.getExportFileName=function(t,e,n){return t=(t=(t=t&&_.isObject(t)?_.map(t,function(t){return(t=null!==(t=t.FileNamePart)&&!_.isObject(t)?t:"").toString()}).join(""):t)||(e||B.getDefaultExportFileName(n))).replace(/:/g,"-").replace(/[^\w \.\-]/g,"")},B.getDefaultExportFileName=function(t){function e(t){return t=1===(t=""+t).length?"0"+t:t}var t=t?t+"_":"",n=new Date,i=n.getMonth()+1,o=n.getDate();return t+n.getFullYear()+e(i)+e(o)},B.onQueryChange=function(e,n){var i;e&&(i=e.get("_dataType"),e=e.get("_subscriptionType"),"virtual"===i||"streaming"===e?(n.toggleClass("events-disabled",!0),n.attr("title",t("Full export is not supported in Virtual and Streaming queries"))):(n.toggleClass("events-disabled",!1),n.attr("title",t("Download the full dataset from the server"))))},B.openFileExportDialog=function(t){var e,n={};try{if(!(4<=_.keys(t).length))throw"Incorrect number of FileExport parameters expected 5, got: "+t.length;if(t.configSets&&_.keys(t.configSets).length)n.configSets=t.configSets;else{if(!(t.dataSet&&_.isArray(t.dataSet)&&_.isObject(t.dataSet[0])))throw"Missing or invalid dataSet parameter";if(n.dataSet=t.dataSet,!t.metaData||!_.isArray(t.metaData))throw"Missing or invalid metaData parameter";if(e=t.metaData,!_.every(e,function(t){var e=0===_.difference(_.keys(t),["colId","dataType","dataKdbType","dataFormat","hideTrailingZeroes","prefix","suffix","colName"]).length,t=0<t.dataKdbType&&t.dataKdbType<20&&3!==t.dataKdbType;return e&&t}))throw"Invalid metaData properities.";n.metaData=t.metaData}if(void 0===t.fileFormat||!_.isString(t.fileFormat)||!_.includes([".xlsx",".xls",".csv"],t.fileFormat))throw"Invalid file format property";if(n.fileFormat=t.fileFormat,void 0===t.fileName||!_.isString(t.fileName))throw"Invalid file name property";if(n.fileName=t.fileName,void 0===t.workSheetTitle||!_.isString(t.workSheetTitle))throw"Invalid workSheetTitle property";n.workSheetTitle=t.workSheetTitle,void 0!==t.csvExportDelimiter&&_.isString(t.csvExportDelimiter)&&(n.csvExportDelimiter=t.csvExportDelimiter),new An.FileExport(n).showDialog()}catch(t){console.error("FileConverterTools validation error: ",t)}},B.getTemporalTypeFromFormat=function(t){var e,n="";return t&&(e=!!/[M,Y,D,d,Q]/.test(t),t=!!/[H,h,k,m,S,s]/.test(t),e?n=t?"DateTime":"Date":t&&(n="Time")),n},B.regExValidateColumnIDs=function(t,e){var t=0==t.indexOf("/")?t.substring(1):"^"+t.replace(/\*/g,"(.*)")+"$",n=new RegExp(t);return _.filter(e,function(t){return t.match(n)})},B.FileExporterView=An.FileExporterView,B.CHARTS_DATETIME_FORMAT_MAP={"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ss","YYYY-MM-DD hh:mm:ss":"YYYY-MM-DD hh:mm:ss","YYYY-MM-DD kk:mm:ss":"YYYY-MM-DD kk:mm:ss","YYYY-MM-DD HH:mm:ss.SSS":"YYYY-MM-DD HH:mm:ss.SSS","YYYY-MM-DD HH:mm:ss.SSSSSS":"YYYY-MM-DD HH:mm:ss.SSSSSS","YYYY-MM-DD HH:mm:ss.SSSSSSSSS":"YYYY-MM-DD HH:mm:ss.SSSSSSSSS"},B.TIME_FORMAT_MAP={"HH:mm":"HH:mm","HH:mm:ss":"HH:mm:ss","hh:mm:ss":"hh:mm:ss","kk:mm:ss":"kk:mm:ss","hh:mm:ss.SS":"hh:mm:ss.SS","HH:mm:ss.SSS":"HH:mm:ss.SSS","HH:mm:ss.SSSSSS":"HH:mm:ss.SSSSSS","HH:mm:ss.SSSSSSSSS":"HH:mm:ss.SSSSSSSSS","mm:ss":"mm:ss","kk:mm":"kk:mm","mm:ss.SS":"mm:ss.SS","mm:ss.SSS":"mm:ss.SSS","mm:ss.SSSSSS":"mm:ss.SSSSSS","mm:ss.SSSSSSSSS":"mm:ss.SSSSSSSSS",ss:"ss","ss.SSS":"ss.SSS","ss.SSSSSS":"ss.SSSSSS","ss.SSSSSSSSS":"ss.SSSSSSSSS"},B.DATE_FORMAT_MAP={"YYYY-MM-DD":"YYYY-MM-DD","DD.MM.YYYY":"DD.MM.YYYY","YYYY-MMM-DD":"YYYY-MMM-DD","YYYY-MMMM-DD":"YYYY-MMMM-DD","YYYY-MM":"YYYY-MM","YYYY-MMM":"YYYY-MMM","YYYY-MMMM":"YYYY-MMMM","MM/DD/YYYY":"MM/DD/YYYY","DD/MM/YYYY":"DD/MM/YYYY","D/M/YYYY":"D/M/YYYY","M/D/YYYY":"M/D/YYYY","D/M/YY":"D/M/YY","M/D/YY":"M/D/YY","D MMM":"D MMM","D MMM YYYY":"D MMM YYYY","MMM D":"MMM D","MMM DD":"MMM DD","MMM Do":"MMM Do","MMM D, YYYY":"MMM D, YYYY","MM/YYYY":"MM/YYYY","M/YY":"M/YY","MMM YYYY":"MMM YYYY"},B.CHARTS_DATE_FORMAT_MAP=_.extend({},B.DATE_FORMAT_MAP,B.TIME_FORMAT_MAP,B.CHARTS_DATETIME_FORMAT_MAP),B.CHARTS_NUMBERS_FORMAT_MAP={"no decimal":"0","No Decimal Point":"0",0:"0",1:"#0.0","1 decimal":"#0.0","1 Decimal Points":"#0.0",2:"#0.00","2 decimal":"#0.00","2 Decimal Points":"#0.00",3:"#0.000","3 decimal":"#0.000","3 Decimal Points":"#0.000",4:"#0.0000","4 decimal":"#0.0000","4 Decimal Points":"#0.0000",5:"#0.00000","5 Decimal Points":"#0.00000",6:"#0.000000","6 Decimal Points":"#0.000000","no decimal + seperator":"#,##0","1 decimal + seperator":"#,##0.0","2 decimal + seperator":"#,##0.00","3 decimal + seperator":"#,##0.000","4 decimal + seperator":"#,##0.0000","Smart Number":"SmartNumber",Logarithmic:"","no format":""},B.CHARTS_DATA_FORMAT_MAP=_.extend({},B.CHARTS_DATE_FORMAT_MAP,B.CHARTS_NUMBERS_FORMAT_MAP),An.ExportTools=B,I.BigInteger=rt.BigInteger;vt={language:$.cookie("dashboard-language")||"en",logLevel:$.cookie("dashboard-log-level")||1,theme:$.cookie("dashboard-theme")||"kx-darkroom",viewerTheme:$.cookie("dashboard-viewer-theme")||"kx-darkroom"};return $.cookie("dashboard-language",vt.language,{expires:30,path:"/"}),$.cookie("dashboard-log-level",vt.logLevel,{expires:30,path:"/"}),$.cookie("dashboard-theme",vt.theme,{expires:30,path:"/"}),$.cookie("dashboard-viewer-theme",vt.viewerTheme,{expires:30,path:"/"}),_.extend(m.History.prototype,{decodeFragment:function(t){return t}}),I});