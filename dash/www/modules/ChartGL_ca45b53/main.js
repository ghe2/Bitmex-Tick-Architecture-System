define(["Handlebars","QuickBase","moment","css!./css/app.css"],function(e,C,f){"use strict";var Y,i=this&&this.__extends||(Y=function(t,e){return(Y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Y(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),k=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;for(var n=Array(t),r=0,e=0;e<i;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,r++)n[r]=o[a];return n},X=this&&this.__assign||function(){return(X=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},n={Trigger:{default:"Click",enum:["Click","Hover"],propertyOrder:2,title:"Trigger Action",type:"string"}},r={RuleName:{default:"",propertyOrder:1,title:"Rule Name",type:"string"},RuleSource:{default:"",enumSource:"possible_columns",propertyOrder:3,title:"Rule Source",type:"string",watch:{possibleCols:"arrItem.possibleRulesColumns"}},RuleTarget:{enumSource:"possible_columns",default:"",propertyOrder:2,title:"Rule Target",type:"string",watch:{possibleCols:"arrItem.possibleYColumns"}},RuleType:{options:{hidden:!0},propertyOrder:4,title:"Rule Type",type:"string"},Show:{default:!1,format:"checkbox",propertyOrder:5,title:"Show Rule in Legend",type:"boolean"}},z=(o.getComponentDefinition=function(t){var e={id:667,componentName:"Editable Dropdown",componentDescription:"Editable dropdown",appKey:"EditableList",css:"EditableList",appArgs:{quickStart:[{path:"Layers.0.Data",message:"populate Data Source"}],json:{version:"4.6.1",Style:{advanced:""},Basics:{Hover:"",Selected:"",Duration:400,Easing:"easeOutQuart"},Layers:[{_Id:"L0",_Type:"Bubble",Data:"",XAxis:"",YAxis:"",XAxisId:"X-Axis 1",YAxisId:"Y-Axis 1",Color:_.clone(o.COLOR_DEFAULT),ColorData:"None",Opacity:80,Name:"",Enabled:!0,Legend:!0,Palette:_.cloneDeep(o.PALETTE_DEFAULT),Actions:[],RadiusData:"Fixed Size",RadiusScaling:4,ScaleOnZoom:!0,Icon:"",HighlightRules:[],possibleRadiusData:["Fixed Size"],possibleRulesColumns:[],possibleXColumns:[],possibleYColumns:[],possibleXAxes:["X-Axis 1"],possibleYAxes:["Y-Axis 1"]}],Xaxes:[{Bounds:"",Type:"Linear",Position:"Bottom",Width:0,Ticks:10,Title:{Display:!1,LabelString:"",FontSize:16},Format:{Display:!0,BeginAtZero:!1,Format:"Number",Precision:2,FontSize:12,Prefix:"",Suffix:"",HideTrailingZeroes:!1},Range:{UseMinMax:!1,Min:"",Max:"",SelectionMin:"",SelectionMax:""},Gridlines:{GridlinesOffset:!1,GridlinesColor:"",GridlinesOpacity:15}}],Yaxes:[{Bounds:"",Type:"Linear",Position:"Left",Width:0,Ticks:10,Title:{Display:!1,LabelString:"",FontSize:16},Format:{Display:!0,BeginAtZero:!1,Format:"Number",Precision:2,FontSize:12,Prefix:"",Suffix:"",HideTrailingZeroes:!1},Range:{UseMinMax:!1,Min:"",Max:"",SelectionMin:"",SelectionMax:""},Gridlines:{GridlinesOffset:!1,GridlinesColor:"",GridlinesOpacity:15}}],Overlay:{ShowCrosshairs:!0,ShowCoordinates:!0,SnapToPoint:!0,UseCustomTooltip:!1,CustomTooltip:o.CUSTOM_TOOLTIP_DEFAULT,ShowAllPoints:!1,GroupByLayer:!1}},schema:{type:"object",title:"Properties",properties:{possibleXColumns:{type:"readOnlyArray",items:{type:"string"},default:[],options:{collapsed:!0,hidden:!0}},possibleYColumns:{type:"readOnlyArray",items:{type:"string"},default:[],options:{collapsed:!0,hidden:!0}},Basics:{propertyOrder:0,type:"object",title:"Basics",options:{collapsed:!0},properties:{Hover:{title:"Hover",type:"string",default:""},Selected:{title:"Selected",type:"string",default:""},Duration:{title:"Animation Duration",type:"number",default:400},Easing:{title:"Animation Easing",type:"string",default:"easeOutQuart",enum:["swingFromTo","swingFrom","swingTo","easeFromTo","easeFrom","easeTo","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","easeOutSine","easeInOutSine","easeInExpo","easeOutExpo","easeInOutExpo","easeInCirc","easeOutCirc","easeInOutCirc","easeOutBounce","easeInBack","easeOutBack","easeInOutBack","bounce","bouncePast","elastic"]}}},Layers:{propertyOrder:1,type:"array",items:{type:"object",id:"arrItem",title:"Layer",options:{collapsed:!0},headerTemplate:"{{#if self.Name}}{{valueProp self.Name }}{{else}}Layer {{ i1 }}{{/if}}",oneOf:[{title:"Bubble",options:{linked_oneof_property:{property:"_Type",value:"Bubble"}},properties:_.extend({},o.LAYER_COMMON,{RadiusData:{title:"Radius Data",type:"",propertyOrder:7,default:"Fixed Size",enumSource:"possible_columns",watch:{possibleCols:"arrItem.possibleRadiusData"}},RadiusScaling:{title:"Radius Scaling",type:"number",propertyOrder:7,default:4},ScaleOnZoom:{title:"Scale on Zoom",type:"boolean",default:!0,propertyOrder:7},Icon:{type:"icon",title:"Icon",iconTypes:"fa",propertyOrder:8,default:""}})},{title:"Line",options:{linked_oneof_property:{property:"_Type",value:"Line"}},properties:_.extend({},o.LAYER_COMMON,{Fill:{title:"Fill",type:"dropdown",default:"No Fill",data:"possible_columns",watch:{possible_layers:"arrItem.possibleLayers"},propertyOrder:8},FillColor:{default:"#0061FF",options:{gradient:!1,noColor:!1},propertyOrder:8,title:"Fill Color",type:"gradient"},FillOpacity:{title:"Fill Opacity",type:"number",default:80,propertyOrder:8},FadeToTransparent:{title:"Fade to Transparent",type:"boolean",default:!1,propertyOrder:8}})},{title:"Bar",options:{linked_oneof_property:{property:"_Type",value:"Bar"}},properties:_.extend({},o.LAYER_COMMON,o.BAR_PROPERTIES)},{title:"Candlestick",options:{linked_oneof_property:{property:"_Type",value:"Candlestick"}},properties:_.extend({},o.LAYER_COMMON,{Open:{enumSource:"possible_columns",propertyOrder:3,title:"Open",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}},High:{enumSource:"possible_columns",propertyOrder:3,title:"High",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}},Low:{enumSource:"possible_columns",propertyOrder:3,title:"Low",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}},Close:{enumSource:"possible_columns",propertyOrder:3,title:"Close",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}},CandlestickFormat:{type:"object",title:"Candlestick Format",propertyOrder:9,options:{collapsed:!0},properties:_.extend({},o.BAR_PROPERTIES,{BearColor:{default:"#ff0000",options:{gradient:!1,noColor:!1},propertyOrder:5,title:"Bear Color",type:"gradient"},BullColor:{default:"#00ff00",options:{gradient:!1,noColor:!1},propertyOrder:5,title:"Bull Color",type:"gradient"},NeutralColor:{default:"#ffffff",options:{gradient:!1,noColor:!1},propertyOrder:5,title:"Neutral Color",type:"gradient"},WickColor:{default:"#7b8284",options:{gradient:!1,noColor:!1},propertyOrder:5,title:"Wick Color",type:"gradient"}})},YAxis:{options:{hidden:!0}}})}]}},Xaxes:{title:"X-Axes",type:"array",propertyOrder:2,options:{collapsed:!0},items:{title:"X-Axis",type:"object",options:{collapsed:!0},properties:{Bounds:{options:{hidden:!0}},Type:{title:"X-Axis Type",type:"string",propertyOrder:1,enum:["Linear","Category"],default:"Linear"},Position:{title:"Position",type:"string",enum:["Top","Bottom"],propertyOrder:2,default:"Bottom"},Width:{title:"Height",type:"number",propertyOrder:2,default:0},Ticks:{type:"number",title:"Number of Ticks",propertyOrder:2,default:10},Title:{type:"object",title:"Title",options:{collapsed:!0},properties:{Display:{title:"Display",type:"boolean",default:!1},LabelString:{title:"Label String",type:"string",default:""},FontSize:{title:"Font Size",type:"number",default:16}}},Range:{type:"object",title:"Range",propertyOrder:2,options:{collapsed:!0,hidden:!1},properties:{UseMinMax:{title:"Use min max",type:"boolean",default:!1},Min:{title:"Min",type:"string",default:""},Max:{title:"Max",type:"string",default:""},SelectionMin:{title:"Selection Min",type:"string",default:""},SelectionMax:{title:"Selection Max",type:"string",default:""}}},Gridlines:{type:"object",title:"Gridlines",propertyOrder:3,options:{collapsed:!0},properties:{GridlinesOffset:{title:"Offset Gridlines",type:"boolean",default:!1},GridlinesColor:{title:"Gridlines Color",type:"gradient",options:{noColor:!0,gradient:!1},default:""},GridlinesOpacity:{title:"Gridlines Opacity",type:"number",default:15}}},Format:{type:"object",title:"Format",propertyOrder:4,options:{collapsed:!0},properties:{Display:{title:"Display",type:"boolean",default:!0},BeginAtZero:{type:"boolean",title:"Begin at Zero",format:"checkbox",default:!1},Format:{title:"Numeric Format",type:"string",enum:["Number","Smart Number","Formatted Number"],default:"Number"},Precision:{title:"Decimal Places",type:"number",default:2},FontSize:{title:"Font Size",type:"number",format:"number",default:12},Prefix:{title:"Prefix",type:"string",default:""},Suffix:{title:"Suffix",type:"string",default:""},HideTrailingZeroes:{type:"boolean",propertyOrder:4,title:"Hide Trailing Zeroes",format:"checkbox",default:!1}}}}}},Yaxes:{title:"Y-Axes",type:"array",propertyOrder:2,options:{collapsed:!0},items:{title:"Y-Axis",type:"object",options:{collapsed:!0},properties:{Bounds:{options:{hidden:!0}},Type:{title:"Y-Axis Type",type:"string",propertyOrder:1,enum:["Linear","Category"],default:"Linear"},Position:{title:"Position",type:"string",enum:["Left","Right"],propertyOrder:2,default:"Left"},Width:{title:"Width",type:"number",propertyOrder:2,default:0},Ticks:{type:"number",title:"Number of Ticks",propertyOrder:2,default:10},Title:{type:"object",title:"Title",options:{collapsed:!0},properties:{Display:{title:"Display",type:"boolean",default:!1},LabelString:{title:"Label String",type:"string",default:""},FontSize:{title:"Font Size",type:"number",default:16}}},Range:{type:"object",title:"Range",propertyOrder:2,options:{collapsed:!0,hidden:!1},properties:{UseMinMax:{title:"Use min max",type:"boolean",default:!1},Min:{title:"Min",type:"string",default:""},Max:{title:"Max",type:"string",default:""},SelectionMin:{title:"Selection Min",type:"string",default:""},SelectionMax:{title:"Selection Max",type:"string",default:""}}},Gridlines:{type:"object",title:"Gridlines",propertyOrder:3,options:{collapsed:!0},properties:{GridlinesOffset:{title:"Offset Gridlines",type:"boolean",default:!1},GridlinesColor:{title:"Gridlines Color",type:"gradient",options:{noColor:!0,gradient:!1},default:""},GridlinesOpacity:{title:"Gridlines Opacity",type:"number",default:15}}},Format:{type:"object",title:"Format",propertyOrder:3,options:{collapsed:!0},properties:{Display:{title:"Display",type:"boolean",default:!0},BeginAtZero:{type:"boolean",title:"Begin at Zero",format:"checkbox",default:!1},Format:{title:"Numeric Format",type:"string",enum:["Number","Smart Number","Formatted Number"],default:"Number"},Precision:{title:"Decimal Places",type:"number",default:2},FontSize:{title:"Font Size",type:"number",format:"number",default:12},Prefix:{title:"Prefix",type:"string",default:""},Suffix:{title:"Suffix",type:"string",default:""},HideTrailingZeroes:{type:"boolean",propertyOrder:4,title:"Hide Trailing Zeroes",format:"checkbox",default:!1}}}}}},Overlay:{type:"object",title:"Overlay",options:{collapsed:!0},propertyOrder:209,properties:{ShowCrosshairs:{type:"boolean",title:"Show Crosshairs",default:!0},ShowCoordinates:{type:"boolean",title:"Show Coordinates",default:!0},SnapToPoint:{type:"boolean",title:"Snap Crosshair to Data",default:!0},UseCustomTooltip:{type:"boolean",title:"Use custom tooltip",default:!1},CustomTooltip:{type:"tooltipTemplate",title:"Custom tooltip",templateItems:{this:{type:"array",items:{color:"color",data:"data",icon:"icon",image:"image",name:"name",width:"width",xAxis:"xAxis",yAxis:"yAxis"}}},default:'<table><thead><tr><th>{{this.0.xAxis}}</th><th></th></tr></thead>{{#each this}}<tr><td width="{{width}}"><i class="{{icon}}" style="color:{{color}}; {{image}};"></i> {{name}}: </td><td>{{yAxis}}</td></tr>{{/each}}</table>'},ShowAllPoints:{type:"boolean",title:"Show all data points",default:!1},GroupByLayer:{type:"boolean",title:"Group tooltip by layer",default:!1}}},Style:{type:"object",title:"Style",options:{collapsed:!0},propertyOrder:211,properties:{advanced:{type:"css",title:"Advanced CSS",default:""}}}}}}};if(0<_.keys(t.settingsModel.attributes).length)for(var i=_.find(o.upgrades,{version:t.settingsModel.get("version")}),n=void 0===i?1:o.upgrades.indexOf(i)+1;n<o.upgrades.length;n+=1){var r=o.upgrades[n];r.fn(t.settingsModel,t),t.settingsModel.set("version",r.version)}return e},o.PALETTE_DEFAULT=[{type:"#0061FF"},{type:"#F23A66"},{type:"#009BAB"},{type:"#7647CC"},{type:"#FFC300"},{type:"#9FA3A6"},{type:"#003A99"},{type:"#A90B31"},{type:"#005D67"},{type:"#452481"}],o.COLOR_DEFAULT="#0061FF",o.TOOLTIP_DEFAULT='<table><thead><tr><th>{{this.0.xAxis}}</th><th></th></tr></thead>{{#each this}} {{#if open}}<tr><td width="{{width}}">Open: </td><td>{{open}} </td></tr><tr><td width="{{width}}">High: </td><td>{{high}} </td></tr><tr><td width="{{width}}">Low: </td><td>{{low}} </td></tr><tr><td width="{{width}}">Close: </td><td>{{close}} </td></tr>{{else}}<tr><td width="{{width}}"><i class="{{icon}}" style="color:{{color}};{{image}};"></i> {{name}}: </td><td>{{#if grouped}}{{#each grouped}}<td> {{this}} </td>{{/each}} {{else}} <td>{{yAxis}}</td> {{/if}}</td></tr>{{/if}}{{/each}}</table>',o.BAR_PROPERTIES={BarWidth:{title:"Bar Percentage",type:"number",default:95,propertyOrder:8},BarFixedWidth:{title:"Bar Fixed Width",type:"number",default:10,propertyOrder:8},BarWidthType:{title:"Bar Width Type",type:"string",default:"Percentage",enum:["Percentage","Fixed Width"],propertyOrder:8}},o.BASICS={Hover:"",Selected:"",Duration:400,Easing:"easeOutQuart"},o.CUSTOM_TOOLTIP_DEFAULT='<table><thead><tr><th>{{this.0.xAxis}}</th><th></th></tr></thead>{{#each this}}<tr><td width="{{width}}"><i class="{{icon}}" style="color:{{color}}; {{image}};"></i> {{name}}: </td><td>{{yAxis}}</td></tr>{{/each}}</table>',o.LAYER_COMMON={_Id:{type:"string",options:{hidden:!0}},_Type:{type:"string",options:{hidden:!0}},possibleColorColumns:{type:"array",options:{hidden:!0}},possibleRadiusData:{type:"array",options:{hidden:!0}},possibleLayers:{type:"array",options:{hidden:!0}},possibleRulesColumns:{type:"array",options:{hidden:!0}},possibleXColumns:{type:"array",options:{hidden:!0}},possibleYColumns:{type:"array",options:{hidden:!0}},possibleXAxes:{type:"array",options:{hidden:!0}},possibleYAxes:{type:"array",options:{hidden:!0}},Data:{title:"Data Source",type:"data",default:"",propertyOrder:1},Name:{title:"Name",type:"string",default:"",propertyOrder:2},XAxis:{title:"X-Axis Data",type:"dropdown",default:"",data:"possible_columns",watch:{possible_columns:"arrItem.possibleXColumns"},propertyOrder:3},XAxisId:{title:"X-Axis",default:"X-Axis 1",type:"string",enumSource:"possible_xaxis",watch:{possible_xaxis:"arrItem.possibleXAxes"},propertyOrder:3},YAxis:{title:"Y-Axis Data",type:"customDropdown",default:"",data:"possible_columns",watch:{possible_columns:"arrItem.possibleYColumns"},propertyOrder:3},YAxisId:{title:"Y-Axis",default:"Y-Axis 1",type:"string",enumSource:"possible_yaxis",watch:{possible_yaxis:"arrItem.possibleYAxes"},propertyOrder:3},Color:{title:"Color",type:"gradient",options:{gradient:!1},default:_.clone(o.COLOR_DEFAULT),propertyOrder:8},ColorData:{title:"Color Enumeration",type:"dropdown",default:"None",data:"possible_columns",watch:{possible_columns:"arrItem.possibleColorColumns"},propertyOrder:8},Opacity:{title:"Opacity",type:"number",default:80,propertyOrder:8},Enabled:{title:"Enabled",type:"boolean",default:!0,propertyOrder:9},Legend:{title:"Legend Enabled",type:"boolean",default:!0,propertyOrder:9},Palette:{type:"array",format:"table",title:"Color Palette",options:{collapsed:!0},uniqueItems:!1,items:{type:"object",title:"Palette Color",properties:{type:{type:"gradient",options:{gradient:!1},title:"color",default:"#ffa500"}}},default:_.cloneDeep(o.PALETTE_DEFAULT),propertyOrder:10},Actions:{title:"Actions",type:"actions",fields:{map:_.extend({Current:{enumSource:"possible_columns",propertyOrder:10,title:"Source Column",type:"string",watch:{possibleColumns:"arrItem.possibleColorColumns"}}},n),nav:n,query:n,url:n},options:{collapsed:!0}},HighlightRules:{title:"Highlight Rules",type:"array",options:{collapsed:!0},items:{title:"Highlight Rule",type:"object",oneOf:[{options:{linked_oneof_property:{property:"RuleType",value:"discrete"}},properties:Object.assign({},r,{RuleColor:{default:"#F8F8F8",options:{gradient:!1,noColor:!1},propertyOrder:11,title:"Rule Color",type:"gradient"},RuleOperation:{default:"",enum:["","search","regexp","contains","starts with","ends with","==","<",">","<=",">=","!=","in"],propertyOrder:9,title:"Rule Operation",type:"string"},RuleValue:{data:"possible_columns",default:"",propertyOrder:10,title:"Rule Value",type:"string"}}),title:"Discrete"},{options:{additionalProperties:!1,linked_oneof_property:{property:"RuleType",value:"gradient"}},properties:Object.assign({},r,{Palette:{default:[{type:"#b71c1c"},{type:"#F57F17"},{type:"#33691E"}],format:"table",items:{properties:{type:{default:"#ffa500",options:{gradient:!1},title:"color",type:"gradient"}},title:"Palette Color",type:"object"},options:{collapsed:!0},propertyOrder:8,title:"Color Palette",type:"array",uniqueItems:!1},RuleMax:{default:1,format:"number",propertyOrder:7,title:"Rule Max",type:"number"},RuleMin:{default:0,format:"number",propertyOrder:6,title:"Rule Min",type:"number"}}),title:"Gradient"}]}}},o.upgrades=[{version:"0",fn:function(t,e){}},{version:"4.5.0",fn:function(t){t.get("Basics")&&!t.get("Basics.Easing")&&t.unset("Basics")}},{version:"4.5.1.1",fn:function(r){r.get("Palette")||r.set("Palette",o.PALETTE_DEFAULT),_.each(r.get("Layers"),function(t,e){r.get("Layers."+e+".Name")||r.set("Layers."+e+".Name","Layer "+(e+1))}),r.get("Xaxis")&&!r.get("Xaxes.Range.SelectionMin")&&(r.set("Xaxis.Range.SelectionMin",""),r.set("Xaxis.Range.SelectionMax",""),r.set("Yaxis.Range.SelectionMin",""),r.set("Yaxis.Range.SelectionMax","")),r.get("Basics.Easing")||r.set("Basics",o.BASICS),r.get("Xaxes")&&r.get("Xaxes.0.Format")||(r.set("Xaxes",[_.extend({},r.get("Xaxis"),{Position:{title:"Position",type:"string",enum:["Top","Bottom"],default:"Bottom"}})]),r.set("Yaxes",[_.extend({},r.get("Yaxis"),{Position:{title:"Position",type:"string",enum:["Left","Right"],default:"Left"}})]),r.set("Yaxes.0.Position","Left"),r.set("Xaxes.0.Position","Bottom"),r.unset("Xaxis"),r.unset("Yaxis"),_.each(r.get("Layers"),function(t,e){r.set("Layers."+e+".XAxisId","X-Axis 1"),r.set("Layers."+e+".YAxisId","Y-Axis 1"),r.set("Layers."+e+".possibleXAxes",["X-Axis 1"]),r.set("Layers."+e+".possibleYAxes",["Y-Axis 1"])}));'<table>{{#each this}}{{#eq @index 0}}<thead><tr><th>{{xAxis}}</th><th></th></tr></thead>{{/eq}}<tr><td width="{{width}}"><i class="{{icon}}" style="color:{{color}}"></i> {{name}}: </td><td>{{yAxis}}</td></tr>{{/each}}</table>'===r.get("Overlay.CustomTooltip")&&r.set("Overlay.CustomTooltip",'<table><thead><tr><th>{{this.0.0.xAxis}}</th><th></th></tr></thead>{{#each this}}{{#each this}}<tr><td width="{{width}}"><i class="{{icon}}" style="color:{{color}}; {{image}};"></i> {{name}}: </td><td>{{yAxis}}</td></tr>{{/each}}{{/each}}</table>'),r.get("Overlay.ShowAllPoints")||r.set("Overlay.ShowAllPoints",!1),r.get("Overlay.GroupByLayer")||r.set("Overlay.GroupByLayer",!1),_.each(r.get("Layers"),function(t,e){r.get("Layers."+e+".Enabled")||r.set("Layers."+e+".Enabled",!0),r.get("Layers."+e+".Opacity")||r.set("Layers."+e+".Opacity",80);var i="Layers."+e+".BarWidth",n="Layers."+e+".BarFixedWidth",e="Layers."+e+".BarWidthType";r.get(i)&&!r.get(n)&&(r.set(i,100*r.get(i)),r.set(e,"Percentage"),r.set(n,10))})}},{version:"4.6.0a",fn:function(n){_.each(n.get("Layers"),function(t,e){var i;void 0===n.get("Layers."+e+".ScaleOnZoom")&&(i=n.get("Layers."+e+".PointSize"),n.set("Layers."+e+".ScaleOnZoom",!0),n.set("Layers."+e+".RadiusData","Fixed Size"),n.set("Layers."+e+".RadiusScaling",i),n.unset("Layers."+e+".PointSize"))});'<table><thead><tr><th>{{this.0.0.xAxis}}</th><th></th></tr></thead>{{#each this}}{{#each this}}<tr><td width="{{width}}"><i class="{{icon}}" style="color:{{color}}; {{image}};"></i> {{name}}: </td><td>{{yAxis}}</td></tr>{{/each}}{{/each}}</table>'===n.get("Overlay.CustomTooltip")&&n.set("Overlay.CustomTooltip",o.CUSTOM_TOOLTIP_DEFAULT),n.get("Layers").forEach(function(t,e){"Line"===n.get("Layers."+e+"._Type")&&(n.get("Layers."+e+".Fill")||(n.set("Layers."+e+".Fill","No Fill"),n.set("Layers."+e+".FillColor","#0061FF"),n.set("Layers."+e+".FillOpacity",80)),"Line"===n.get("Layers."+e+"._Type")&&void 0===n.get("Layers."+e+".FadeToTransparent")&&n.set("Layers."+e+".FadeToTransparent",!1))})}},{version:"4.6.0b",fn:function(t){void 0===t.get("Overlay.ShowCoordinates")&&t.set("Overlay.ShowCoordinates",!0),void 0===t.get("Overlay.SnapToPoint")&&t.set("Overlay.SnapToPoint",!0)}},{version:"4.6.0c",fn:function(i){i.get("Layers").forEach(function(t,e){void 0===t.ColorData&&(i.set("Layers."+e+".possibleColorColumns",["None"]),i.set("Layers."+e+".ColorData","None")),void 0===t.Palette&&(t=i.get("Palette")||o.PALETTE_DEFAULT,i.set("Layers."+e+".Palette",t))}),i.get("Xaxes").forEach(function(t,e){void 0===t.Format.BeginAtZero&&i.set("Xaxes."+e+".Format.BeginAtZero",!1)}),i.get("Yaxes").forEach(function(t,e){void 0===t.Format.BeginAtZero&&i.set("Yaxes."+e+".Format.BeginAtZero",!1)})}},{version:"4.6.0d",fn:function(i){i.get("Layers").forEach(function(t,e){e="Layers."+e;void 0===t.Palette&&(t=i.get("Palette")||o.PALETTE_DEFAULT,i.set(e+".Palette",t)),"No Fill"===i.get(e+".Fill")&&(i.set(e+".FillColor",void 0),i.set(e+".Fade",void 0),i.set(e+".FillOpacity",void 0))})}}],o);function o(){}a.app=e.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,r){var o=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<canvas class="axis"></canvas>\n<canvas id='+t.escapeExpression("function"==typeof(i=null!=(i=o(i,"uid")||(null!=e?o(e,"uid"):e))?i:t.hooks.helperMissing)?i.call(null!=e?e:t.nullContext||{},{name:"uid",hash:{},data:r,loc:{start:{line:2,column:11},end:{line:2,column:18}}}):i)+'></canvas>\n<div class="legend-div"></div>\n<svg class="overlay">\n    <defs>\n        <marker id="sArrow" markerWidth="9" markerHeight="6" orient="auto" refY="3" refX="0">\n            <path d="M7,0 L7,6 L0,3 z"></path>\n        </marker>\n        <marker id="eArrow" markerWidth="9" markerHeight="6" orient="auto" refY="3" refX="7">\n            <path d="M0,0 L0,6 L7,3 z"></path>\n        </marker>\n    </defs>\n</svg>\n<div class="GL-highlight-rule"></div>\n<img />'},useData:!0}),a.dualVertex=e.template({1:function(t,e,i,n,r){return"#version 300 es"},3:function(t,e,i,n,r,o,a){var s=null!=e?e:t.nullContext||{},l=t.hooks.helperMissing,h="function",u=t.escapeExpression,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(t=c(i,"if").call(s,null!=a[1]?c(a[1],"isWebGL2"):a[1],{name:"if",hash:{},fn:t.program(4,r,0,o,a),inverse:t.program(6,r,0,o,a),data:r,loc:{start:{line:4,column:0},end:{line:4,column:45}}}))?t:"")+" "+u(typeof(o=null!=(o=c(i,"vt")||(null!=e?c(e,"vt"):e))?o:l)==h?o.call(s,{name:"vt",hash:{},data:r,loc:{start:{line:4,column:46},end:{line:4,column:52}}}):o)+" "+u(typeof(o=null!=(o=c(i,"name")||(null!=e?c(e,"name"):e))?o:l)==h?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:4,column:53},end:{line:4,column:61}}}):o)+"_position;\nuniform "+u(typeof(o=null!=(o=c(i,"ut")||(null!=e?c(e,"ut"):e))?o:l)==h?o.call(s,{name:"ut",hash:{},data:r,loc:{start:{line:5,column:8},end:{line:5,column:14}}}):o)+" "+u(typeof(o=null!=(o=c(i,"name")||(null!=e?c(e,"name"):e))?o:l)==h?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:5,column:15},end:{line:5,column:23}}}):o)+"_u_min;\nuniform "+u(typeof(o=null!=(o=c(i,"ut")||(null!=e?c(e,"ut"):e))?o:l)==h?o.call(s,{name:"ut",hash:{},data:r,loc:{start:{line:6,column:8},end:{line:6,column:14}}}):o)+" "+u(typeof(o=null!=(o=c(i,"name")||(null!=e?c(e,"name"):e))?o:l)==h?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:6,column:15},end:{line:6,column:23}}}):o)+"_u_max;\n"},4:function(t,e,i,n,r){return"in"},6:function(t,e,i,n,r){return"attribute"},8:function(t,e,i,n,r){var o,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(o=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(4,r,0),inverse:t.program(6,r,0),data:r,loc:{start:{line:10,column:0},end:{line:10,column:42}}}))?o:"")+" vec4 h_color;\n"+(null!=(o=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(9,r,0),inverse:t.program(11,r,0),data:r,loc:{start:{line:11,column:0},end:{line:11,column:41}}}))?o:"")+" lowp vec4 v_color;\n"},9:function(t,e,i,n,r){return"out"},11:function(t,e,i,n,r){return"varying"},13:function(t,e,i,n,r){return"vec2 ds_sub (vec2 dsa, vec2 dsb) {\n    vec2 dsc;\n    float e, t1, t2;\n    t1 = dsa.x - dsb.x;\n    e = t1 - dsa.x;\n    t2 = ((-dsb.x - e) + (dsa.x - (t1 - e))) + dsa.y - dsb.y;\n    dsc.x = t1 + t2;\n    dsc.y = t2 - (dsc.x - t1);\n    return dsc;\n}\n\nvec2 ds_div(vec2 dsa, vec2 dsb)\n{\n    vec2 dsc;\n    float c11, c21, c2, e, s1, s2, t1, t2, t11, t12, t21, t22;\n    float a1, a2, b1, b2, cona, conb, split = 8193.;\n\n    // Compute a DP approximation to the quotient.\n    s1 = dsa.x / dsb.x;\n\n    // On systems with a fused multiply add, such as IBM systems, it is faster to\n    // uncomment the next two lines and comment out the following lines until !>.\n    // On other systems, do the opposite.\n    //  c11 = s1 * dsb(1)\n    // c21 = s1 * dsb(1) - c11\n    cona = s1 * split;\n    conb = dsb.x * split;\n    a1 = cona - (cona - s1);\n    b1 = conb - (conb - dsb.x);\n    a2 = s1 - a1;\n    b2 = dsb.x - b1;\n\n    // Multiply s1 * dsb.x using Dekker's method.\n    c11 = s1 * dsb.x;\n    c21 = (((a1 * b1 - c11) + a1 * b2) + a2 * b1) + a2 * b2;\n\n    // Compute s1 * dsb.y (only high-order word is needed).\n    c2 = s1 * dsb.y;\n    \n    // Compute (c11, c21) + c2 using Knuth's trick.\n    t1 = c11 + c2;\n    e = t1 - c11;\n    t2 = ((c2 - e) + (c11 - (t1 - e))) + c21;\n\n    // The result is t1 + t2, after normalization.\n    t12 = t1 + t2;\n    t22 = t2 - (t12 - t1);\n\n    // Compute dsa - (t12, t22) using Knuth's trick.\n    t11 = dsa.x - t12;\n    e = t11 - dsa.x;\n    t21 = ((-t12 - e) + (dsa.x - (t11 - e))) + dsa.y - t22;\n\n    // Compute high-order word of (t11, t21) and divide by dsb(1).\n    s2 = (t11 + t21) / dsb.x;\n    \n    // The result is s1 + s2, after normalization.\n    dsc.x = s1 + s2;\n    dsc.y = s2 - (dsc.x - s1);\n\n    return dsc;\n}\n"},15:function(t,e,i,n,r){var o,a=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(o=(l(i,"eq")||e&&l(e,"eq")||s).call(a,null!=e?l(e,"vt"):e,"uint",{name:"eq",hash:{},fn:t.program(16,r,0),inverse:t.noop,data:r,loc:{start:{line:85,column:4},end:{line:89,column:11}}}))?o:"")+(null!=(o=(l(i,"eq")||e&&l(e,"eq")||s).call(a,null!=e?l(e,"vt"):e,"int",{name:"eq",hash:{},fn:t.program(18,r,0),inverse:t.noop,data:r,loc:{start:{line:90,column:4},end:{line:94,column:11}}}))?o:"")+(null!=(o=(l(i,"eq")||e&&l(e,"eq")||s).call(a,null!=e?l(e,"vt"):e,"float",{name:"eq",hash:{},fn:t.program(20,r,0),inverse:t.noop,data:r,loc:{start:{line:95,column:4},end:{line:98,column:11}}}))?o:"")+(null!=(o=(l(i,"eq")||e&&l(e,"eq")||s).call(a,null!=e?l(e,"vt"):e,"vec2",{name:"eq",hash:{},fn:t.program(22,r,0),inverse:t.noop,data:r,loc:{start:{line:99,column:4},end:{line:104,column:11}}}))?o:"")},16:function(t,e,i,n,r){var o,a=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    float "+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:86,column:10},end:{line:86,column:18}}}):o)+"_u_range = float(int("+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:86,column:39},end:{line:86,column:47}}}):o)+"_u_max) - int("+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:86,column:61},end:{line:86,column:69}}}):o)+"_u_min));\n    float "+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:87,column:10},end:{line:87,column:18}}}):o)+"a = float(int("+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:87,column:32},end:{line:87,column:40}}}):o)+"_position) - "+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:87,column:53},end:{line:87,column:61}}}):o)+"_u_min);\n    zeroToOne."+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:88,column:14},end:{line:88,column:22}}}):o)+" = "+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:88,column:25},end:{line:88,column:33}}}):o)+"a / "+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:88,column:37},end:{line:88,column:45}}}):o)+"_u_range;\n"},18:function(t,e,i,n,r){var o,a=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    float "+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:91,column:10},end:{line:91,column:18}}}):o)+"_u_range = float(int("+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:91,column:39},end:{line:91,column:47}}}):o)+"_u_max) - int("+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:91,column:61},end:{line:91,column:69}}}):o)+"_u_min));\n    float "+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:92,column:10},end:{line:92,column:18}}}):o)+"a = float("+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:92,column:28},end:{line:92,column:36}}}):o)+"_position - "+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:92,column:48},end:{line:92,column:56}}}):o)+"_u_min);\n    zeroToOne."+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:93,column:14},end:{line:93,column:22}}}):o)+" = "+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:93,column:25},end:{line:93,column:33}}}):o)+"a / "+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:93,column:37},end:{line:93,column:45}}}):o)+"_u_range;\n"},20:function(t,e,i,n,r){var o,a=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    float "+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:96,column:10},end:{line:96,column:18}}}):o)+"_u_range = float("+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:96,column:35},end:{line:96,column:43}}}):o)+"_u_max - "+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:96,column:52},end:{line:96,column:60}}}):o)+"_u_min);\n    zeroToOne."+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:97,column:14},end:{line:97,column:22}}}):o)+" = ("+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:97,column:26},end:{line:97,column:34}}}):o)+"_position - "+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:97,column:46},end:{line:97,column:54}}}):o)+"_u_min) / "+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:97,column:64},end:{line:97,column:72}}}):o)+"_u_range;\n"},22:function(t,e,i,n,r){var o,a=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    vec2 "+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:100,column:9},end:{line:100,column:17}}}):o)+"_u_range = ds_sub("+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:100,column:35},end:{line:100,column:43}}}):o)+"_u_max, "+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:100,column:51},end:{line:100,column:59}}}):o)+"_u_min);  \n    vec2 "+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:101,column:9},end:{line:101,column:17}}}):o)+"_position2 = ds_sub("+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:101,column:37},end:{line:101,column:45}}}):o)+"_position, "+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:101,column:56},end:{line:101,column:64}}}):o)+"_u_min);             \n    vec2 "+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:102,column:9},end:{line:102,column:17}}}):o)+"_zeroToOne = ds_div("+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:102,column:37},end:{line:102,column:45}}}):o)+"_position2,"+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:102,column:56},end:{line:102,column:64}}}):o)+"_u_range);\n    zeroToOne."+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:103,column:14},end:{line:103,column:22}}}):o)+" = "+h(typeof(o=null!=(o=t(i,"name")||(null!=e?t(e,"name"):e))?o:s)==l?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:103,column:25},end:{line:103,column:33}}}):o)+"_zeroToOne.x;\n"},24:function(t,e,i,n,r){return"    gl_PointSize = pointSize;\n    "},26:function(t,e,i,n,r){return" gl_PointSize = u_point_size;\n"},28:function(t,e,i,n,r){return"    v_color = h_color;\n"},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,r,o,a){var s,l=null!=e?e:t.nullContext||{},h=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(s=h(i,"if").call(l,null!=e?h(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(1,r,0,o,a),inverse:t.noop,data:r,loc:{start:{line:1,column:0},end:{line:1,column:38}}}))?s:"")+"\n\n"+(null!=(s=h(i,"each").call(l,null!=e?h(e,"axis"):e,{name:"each",hash:{},fn:t.program(3,r,0,o,a),inverse:t.noop,data:r,loc:{start:{line:3,column:0},end:{line:7,column:9}}}))?s:"")+"\n"+(null!=(s=h(i,"if").call(l,null!=e?h(e,"isColored"):e,{name:"if",hash:{},fn:t.program(8,r,0,o,a),inverse:t.noop,data:r,loc:{start:{line:9,column:0},end:{line:12,column:7}}}))?s:"")+"\nuniform float u_point_size;\n"+(null!=(s=h(i,"if").call(l,null!=e?h(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(4,r,0,o,a),inverse:t.program(6,r,0,o,a),data:r,loc:{start:{line:15,column:0},end:{line:15,column:42}}}))?s:"")+" float pointSize;\n\n"+(null!=(s=h(i,"if").call(l,null!=e?h(e,"math"):e,{name:"if",hash:{},fn:t.program(13,r,0,o,a),inverse:t.noop,data:r,loc:{start:{line:17,column:0},end:{line:80,column:7}}}))?s:"")+"\nvoid main() {\n    vec2 zeroToOne;\n"+(null!=(s=h(i,"each").call(l,null!=e?h(e,"axis"):e,{name:"each",hash:{},fn:t.program(15,r,0,o,a),inverse:t.noop,data:r,loc:{start:{line:84,column:4},end:{line:105,column:13}}}))?s:"")+"\n    // 32-bit below here                \n    // convert from 0->1 to 0->2\n    vec2 zeroToTwo = zeroToOne * 2.0;\n\n    // convert from 0->2 to -1->+1 (clip space)\n    vec2 clipSpace = zeroToTwo - 1.0;\n\n    gl_Position = vec4(clipSpace, 0, 1);\n\n"+(null!=(s=h(i,"if").call(l,null!=e?h(e,"isSize"):e,{name:"if",hash:{},fn:t.program(24,r,0,o,a),inverse:t.program(26,r,0,o,a),data:r,loc:{start:{line:116,column:4},end:{line:119,column:11}}}))?s:"")+"\n"+(null!=(s=h(i,"if").call(l,null!=e?h(e,"isColored"):e,{name:"if",hash:{},fn:t.program(28,r,0,o,a),inverse:t.noop,data:r,loc:{start:{line:121,column:4},end:{line:123,column:11}}}))?s:"")+"}\n"},useData:!0,useDepths:!0}),a.fragment=e.template({1:function(t,e,i,n,r){return"#version 300 es"},3:function(t,e,i,n,r){var o=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(i=o(i,"if").call(null!=e?e:t.nullContext||{},null!=e?o(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(4,r,0),inverse:t.program(6,r,0),data:r,loc:{start:{line:9,column:0},end:{line:9,column:40}}}))?i:"")+" vec4 v_color;\n"},4:function(t,e,i,n,r){return"in"},6:function(t,e,i,n,r){return"varying"},8:function(t,e,i,n,r){return"uniform vec4 a_color; \n"},10:function(t,e,i,n,r){return"out vec4 outColor;\n"},12:function(t,e,i,n,r){return"uniform sampler2D spriteTexture;\n"},14:function(t,e,i,n,r){return"outColor"},16:function(t,e,i,n,r){return"gl_FragColor"},18:function(t,e,i,n,r){var o=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"texture"+(null!=(i=o(i,"unless").call(null!=e?e:t.nullContext||{},null!=e?o(e,"isWebGL2"):e,{name:"unless",hash:{},fn:t.program(19,r,0),inverse:t.noop,data:r,loc:{start:{line:22,column:83},end:{line:22,column:116}}}))?i:"")+"(spriteTexture, gl_PointCoord) * "},19:function(t,e,i,n,r){return"2D"},21:function(t,e,i,n,r){return"v_color"},23:function(t,e,i,n,r){return"a_color"},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,r){var o,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(o=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(1,r,0),inverse:t.noop,data:r,loc:{start:{line:1,column:0},end:{line:1,column:38}}}))?o:"")+"\n\n// fragment shaders don't have a default precision so we need\n// to pick one. mediump is a good default\n\nprecision mediump float;\n\n"+(null!=(o=s(i,"if").call(a,null!=e?s(e,"isColored"):e,{name:"if",hash:{},fn:t.program(3,r,0),inverse:t.program(8,r,0),data:r,loc:{start:{line:8,column:0},end:{line:12,column:7}}}))?o:"")+"\n"+(null!=(o=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(10,r,0),inverse:t.noop,data:r,loc:{start:{line:14,column:0},end:{line:16,column:7}}}))?o:"")+"\n"+(null!=(o=s(i,"if").call(a,null!=e?s(e,"isTextured"):e,{name:"if",hash:{},fn:t.program(12,r,0),inverse:t.noop,data:r,loc:{start:{line:18,column:0},end:{line:19,column:7}}}))?o:"")+"\nvoid main() {\n    "+(null!=(o=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(14,r,0),inverse:t.program(16,r,0),data:r,loc:{start:{line:22,column:4},end:{line:22,column:55}}}))?o:"")+" = "+(null!=(o=s(i,"if").call(a,null!=e?s(e,"isTextured"):e,{name:"if",hash:{},fn:t.program(18,r,0),inverse:t.noop,data:r,loc:{start:{line:22,column:58},end:{line:22,column:156}}}))?o:"")+(null!=(o=s(i,"if").call(a,null!=e?s(e,"isColored"):e,{name:"if",hash:{},fn:t.program(21,r,0),inverse:t.program(23,r,0),data:r,loc:{start:{line:22,column:156},end:{line:22,column:202}}}))?o:"")+";\n}\n"},useData:!0}),a.highlightRule=e.template({1:function(t,e,i,n,r){var o,a=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li><svg style="background:'+h(typeof(o=null!=(o=t(i,"ruleColor")||(null!=e?t(e,"ruleColor"):e))?o:s)==l?o.call(a,{name:"ruleColor",hash:{},data:r,loc:{start:{line:3,column:31},end:{line:3,column:44}}}):o)+'; margin-right:4px;" width="15" height="16"></svg>\n    <span style="color:'+h(typeof(o=null!=(o=t(i,"color")||(null!=e?t(e,"color"):e))?o:s)==l?o.call(a,{name:"color",hash:{},data:r,loc:{start:{line:4,column:23},end:{line:4,column:32}}}):o)+'">'+h(typeof(o=null!=(o=t(i,"ruleName")||(null!=e?t(e,"ruleName"):e))?o:s)==l?o.call(a,{name:"ruleName",hash:{},data:r,loc:{start:{line:4,column:34},end:{line:4,column:46}}}):o)+"</span></li>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,r){return'<ul class="chartgl-highlight-rule">\n'+(null!=(i=(t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]})(i,"each").call(null!=e?e:t.nullContext||{},e,{name:"each",hash:{},fn:t.program(1,r,0),inverse:t.noop,data:r,loc:{start:{line:2,column:0},end:{line:5,column:9}}}))?i:"")+"</ul>"},useData:!0}),a.legend=e.template({1:function(t,e,i,n,r){var o=null!=e?e:t.nullContext||{},a=t.hooks.helperMissing,s="function",l=t.escapeExpression,h=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    <li>"+(null!=(t=h(i,"if").call(o,null!=e?h(e,"icon"):e,{name:"if",hash:{},fn:t.program(2,r,0),inverse:t.program(4,r,0),data:r,loc:{start:{line:3,column:8},end:{line:16,column:17}}}))?t:"")+'      <span style="color:'+l(typeof(t=null!=(t=h(i,"color")||(null!=e?h(e,"color"):e))?t:a)==s?t.call(o,{name:"color",hash:{},data:r,loc:{start:{line:17,column:25},end:{line:17,column:34}}}):t)+"; text-decoration:"+l(typeof(t=null!=(t=h(i,"strike")||(null!=e?h(e,"strike"):e))?t:a)==s?t.call(o,{name:"strike",hash:{},data:r,loc:{start:{line:17,column:52},end:{line:17,column:62}}}):t)+'">'+l(typeof(t=null!=(t=h(i,"text")||(null!=e?h(e,"text"):e))?t:a)==s?t.call(o,{name:"text",hash:{},data:r,loc:{start:{line:17,column:64},end:{line:17,column:72}}}):t)+"</span>\n    </li>\n"},2:function(t,e,i,n,r){var o,a=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\n            <svg width="'+h(typeof(o=null!=(o=t(i,"width")||(null!=e?t(e,"width"):e))?o:s)==l?o.call(a,{name:"width",hash:{},data:r,loc:{start:{line:4,column:24},end:{line:4,column:33}}}):o)+'" height="'+h(typeof(o=null!=(o=t(i,"width")||(null!=e?t(e,"width"):e))?o:s)==l?o.call(a,{name:"width",hash:{},data:r,loc:{start:{line:4,column:43},end:{line:4,column:52}}}):o)+'" style="padding:2px">\n              <i style="height:'+h(typeof(o=null!=(o=t(i,"width")||(null!=e?t(e,"width"):e))?o:s)==l?o.call(a,{name:"width",hash:{},data:r,loc:{start:{line:5,column:31},end:{line:5,column:40}}}):o)+"px;color:"+h(typeof(o=null!=(o=t(i,"fillStyle")||(null!=e?t(e,"fillStyle"):e))?o:s)==l?o.call(a,{name:"fillStyle",hash:{},data:r,loc:{start:{line:5,column:49},end:{line:5,column:62}}}):o)+";margin-top:2.5px;margin-right:5px;"+h(typeof(o=null!=(o=t(i,"image")||(null!=e?t(e,"image"):e))?o:s)==l?o.call(a,{name:"image",hash:{},data:r,loc:{start:{line:5,column:97},end:{line:5,column:106}}}):o)+'"class="fa '+h(typeof(o=null!=(o=t(i,"icon")||(null!=e?t(e,"icon"):e))?o:s)==l?o.call(a,{name:"icon",hash:{},data:r,loc:{start:{line:5,column:117},end:{line:5,column:125}}}):o)+'"></i>\n            </svg>\n'},4:function(t,e,i,n,r){var o=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <svg width="10" height="10"  style="margin-left:14.5px;margin-right:2.8px;margin-top: 2px;padding:2px">\n'+(null!=(i=o(i,"if").call(null!=e?e:t.nullContext||{},null!=e?o(e,"bullColor"):e,{name:"if",hash:{},fn:t.program(5,r,0),inverse:t.program(7,r,0),data:r,loc:{start:{line:9,column:10},end:{line:14,column:17}}}))?i:"")+"              </svg>\n"},5:function(t,e,i,n,r){var o,a=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                <rect height="10" width="1.5" x="6.8" fill="'+h(typeof(o=null!=(o=t(i,"fillStyle")||(null!=e?t(e,"fillStyle"):e))?o:s)==l?o.call(a,{name:"fillStyle",hash:{},data:r,loc:{start:{line:10,column:60},end:{line:10,column:73}}}):o)+'" />\n                <rect height="5" width="5" x="5" y="2.5" fill="'+h(typeof(o=null!=(o=t(i,"bullColor")||(null!=e?t(e,"bullColor"):e))?o:s)==l?o.call(a,{name:"bullColor",hash:{},data:r,loc:{start:{line:11,column:63},end:{line:11,column:76}}}):o)+'" />\n'},7:function(t,e,i,n,r){var o,a=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                <rect height="'+h(typeof(o=null!=(o=t(i,"width")||(null!=e?t(e,"width"):e))?o:s)==l?o.call(a,{name:"width",hash:{},data:r,loc:{start:{line:13,column:30},end:{line:13,column:39}}}):o)+'" width="'+h(typeof(o=null!=(o=t(i,"width")||(null!=e?t(e,"width"):e))?o:s)==l?o.call(a,{name:"width",hash:{},data:r,loc:{start:{line:13,column:48},end:{line:13,column:57}}}):o)+'" fill="'+h(typeof(o=null!=(o=t(i,"fillStyle")||(null!=e?t(e,"fillStyle"):e))?o:s)==l?o.call(a,{name:"fillStyle",hash:{},data:r,loc:{start:{line:13,column:65},end:{line:13,column:78}}}):o)+'" />\n'},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,r){return'<ul class="chartgl-legend">\n'+(null!=(i=(t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]})(i,"each").call(null!=e?e:t.nullContext||{},e,{name:"each",hash:{},fn:t.program(1,r,0),inverse:t.noop,data:r,loc:{start:{line:2,column:2},end:{line:19,column:11}}}))?i:"")+"</ul>"},useData:!0});var h=a;function a(){}s.prototype.getBarWidth=function(){return this.barWidth},s.prototype.getXBarPoints=function(i,t,e,n,r){var o=this,a=[],s=n.z-n.x,n=(s||(l=.01*n.x,s=n.z+l-(n.x-l)),i.slice(1).map(function(t,e){return t-i[e]})),l=n.length?0:.01*s,n=n.length?w.getDistance(n,i):l,r=t/r*100,h=(s=s?Math.abs(s+l+l):10,"Percentage"===e?n/2*t:s/100*r);return _.each(i,function(t,e){var i=t-h,t=t+h;a.push(i,i,t,i,t,t),e===Number(0)&&(e=w.convertJSToNumber(w.convertToJsScalar(o.tx,i)),i=w.convertJSToNumber(w.convertToJsScalar(o.tx,t)),o.barWidth=Math.abs(e-i))}),a},s.prototype.getYBarPoints=function(t){var e=[];return _.each(t,function(t){return e.push(0,t,0,t,0,t)}),e},s.prototype.getCandlesticks=function(r,o,a){var s=[],l=[];return r[0].forEach(function(t,e){var i,e=r[1][e],n=t===e&&a;n&&(t+=.002*o,e-=.002*o),s.push(t,e,t,e,t,e),a&&(i=Number(a[4]),n=n?a[2]:t<e?a[1]:a[0],t=xt.hexColorToVec4(n,i),l.push(Object.values(t)))}),[s,l]};var H=s;function s(t,e){this.tx=t,this.tys=e,this.barWidth=0}W.prototype.getXLineFill=function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i],r=t[i+1];e.push(n,n,r,n,r,r)}return e},W.prototype.getYLineFill=function(t,e){var i=[],n=e.fromBounds?Number(e.fromBounds.y):0,r=e.fromBounds?Number(e.fromBounds.w):0,o=e.toBounds?Number(e.toBounds.y):0,a=e.toBounds?Number(e.toBounds.w):0,s=_.min(t)||0,l=_.max(t)||0,h=n;s<0&&0<l||s<0&&l<0&&0<r?h=0:s<0&&l<0&&(h=r);for(var u=0;u<t.length;u++){var c=h,p=h,d=("Origin"!==e.fill&&(c=(y=e.cols[0])[u],p=y[u+1],y=new b(o,a),d=new b(n,r),_.isEqual(y,d)||(c=(r-n)*((c-o)/(y=a-o))+n,p=(r-n)*((p-o)/y)+n)),t[u]),y=t[u+1];i.push(d,c,p,d,p,y)}return i};var V=W;function W(){}function Z(t,e,i){if(!(t=t.getUniformLocation(e,i)))throw new Error(i+" failed getUniformLocation");this.location=t}i(j,G=Z),j.prototype.set=function(t,e){t.uniform1f(this.location,e)};var G,U=j;function j(){return null!==G&&G.apply(this,arguments)||this}i(K,J=Z),K.prototype.set=function(t,e){t.uniform4f(this.location,e.x,e.y,e.z,e.w)};var J,q=K;function K(){return null!==J&&J.apply(this,arguments)||this}l.MIN_KEY="_u_min",l.MAX_KEY="_u_max";n=l;function l(t,e,i){var n=t.getUniformLocation(e,i+l.MIN_KEY),t=t.getUniformLocation(e,i+l.MAX_KEY);if(!n||!t)throw new Error(i+" axis failed getUniformLocation");this.min=n,this.max=t}i(tt,Q=n),tt.prototype.set=function(t,e){t.uniform1i(this.min,e.x),t.uniform1i(this.max,e.y)};var Q,$=tt;function tt(){return null!==Q&&Q.apply(this,arguments)||this}i(nt,et=n),nt.prototype.set=function(t,e){t.uniform1f(this.min,e.x),t.uniform1f(this.max,e.y)};var et,it=nt;function nt(){return null!==et&&et.apply(this,arguments)||this}i(at,rt=n),at.prototype.set=function(t,e){t.uniform2f(this.min,e.x,e.x-Math.fround(e.x)),t.uniform2f(this.max,e.y,e.y-Math.fround(e.y))};var rt,ot=at;function at(){return null!==rt&&rt.apply(this,arguments)||this}st.prototype.apply=function(t,e){t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(this.location),this.glType===WebGLRenderingContext.FLOAT?t.vertexAttribPointer(this.location,this.size,this.glType,!1,this.stride||0,this.offset||0):t.vertexAttribIPointer(this.location,this.size,this.glType,this.stride||0,this.offset||0)};var u=st;function st(t,e,i,n,r){this.location=t,this.glType=e,this.size=i,this.stride=n,this.offset=r}Object.defineProperty(c.prototype,"Program",{get:function(){return this.program},enumerable:!1,configurable:!0}),c.createBuffer=function(t,e){var i=t.createBuffer();if(i)return t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),i;throw new Error("gl error creating buffer")},c.createTexture=function(t,e,i){var n=t.createTexture();if(n)return t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.generateMipmap(t.TEXTURE_2D),n;throw new Error("gl error creating texture")},c.getShader=function(t,e,i,n,r,o,a){var s=[i,n,r,o,a,t.canvas.id].join(":");return c.shaders[s]||(c.shaders[s]=new c(t,i,n,e,r,o,a)),this.shaders[s]},c.composeFragment=function(t,e,i,n){return h.fragment({isWebGL2:t,isTextured:e,isColored:i,isSize:n})},c.composeVertex=function(t,e,i,n,r){t={x:t,y:e};return h.dualVertex({isWebGL2:i,isColored:n,isSize:r,math:_.some(_.values(t),function(t){return w.isLong(t)||w.isDouble(t)}),axis:_.map(t,function(t,e){return _.extend(c.getShaderConfig(t),{name:e})})})},c.createProgram=function(t,e,i){var n=t.createProgram();if(!n)throw new Error("gl error creating program");if(t.attachShader(n,e),t.attachShader(n,i),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS))return n;throw e=t.getProgramInfoLog(n),t.deleteProgram(n),new Error("gl error linking program: "+e)},c.createShader=function(t,e,i){e=t.createShader(e);if(!e)throw new Error("gl error creating shader");if(t.shaderSource(e,i),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS))return e;throw i=t.getShaderInfoLog(e),t.deleteShader(e),new Error("gl error compiling shader: "+i)},c.getShaderConfig=function(t){switch(t){case A.Byte:case A.Char:return{vt:"uint",ut:"int"};case A.Short:case A.Int:case A.Month:case A.Date:case A.Minute:case A.Second:case A.Time:return{vt:"int",ut:"int"};case A.Float:return{vt:"float",ut:"float"};case A.Long:case A.Double:case A.Timestamp:case A.DateTime:case A.Timespan:return{vt:"vec2",ut:"vec2"};default:throw"Not implemented"}},c.prototype.remove=function(t){t.deleteProgram(this.program),t.deleteShader(this.vertexShader),t.deleteShader(this.fragmentShader)},c.prototype.setTexture=function(t,e){t.uniform1i(this.textureLocation,e)},c.prototype.createRange=function(t,e,i){return new(w.isDouble(t)||w.isLong(t)?ot:w.isFloat(t)?it:$)(e,this.program,i)},c.prototype.getVertexBinding=function(t,e,i){var n=t.getAttribLocation(this.Program,i+"_position");switch(e){case A.Byte:case A.Char:return new u(n,t.UNSIGNED_BYTE,1);case A.Short:return new u(n,t.SHORT,1);case A.Int:case A.Month:case A.Date:case A.Minute:case A.Second:case A.Time:return new u(n,t.INT,1);case A.Float:return new u(n,t.FLOAT,1);case A.Long:case A.Double:case A.Timestamp:case A.DateTime:case A.Timespan:return new u(n,t.FLOAT,2);default:throw"Not implemented"}},c.shaders={};var lt,L=c;function c(t,e,i,n,r,o,a){this.textureLocation=null;var s,l=c.composeVertex(e,i,n,o,a),n=c.composeFragment(n,r,o,a);this.vertexShader=c.createShader(t,t.VERTEX_SHADER,l),this.fragmentShader=c.createShader(t,t.FRAGMENT_SHADER,n),this.program=c.createProgram(t,this.vertexShader,this.fragmentShader),this.xRange=this.createRange(e,t,"x"),this.yRange=this.createRange(i,t,"y"),this.xBinding=this.getVertexBinding(t,e,"x"),this.yBinding=this.getVertexBinding(t,i,"y"),r&&(this.textureLocation=t.getUniformLocation(this.Program,"spriteTexture")),o?(s=t.getAttribLocation(this.Program,"h_color"),this.colorLocation=new u(s,t.FLOAT,4)):this.color=new q(t,this.Program,"a_color"),a?(s=t.getAttribLocation(this.Program,"pointSize"),this.sizeLocation=new u(s,t.FLOAT,1)):this.pointSize=new U(t,this.Program,"u_point_size")}Math.fround=Math.fround||(lt=new Float32Array(1),function(t){return lt[0]=t,lt[0]});ht.prototype.applyFn=function(t){return new ht(t(this.x),t(this.y))};var b=ht;function ht(t,e){this.x=t,this.y=e}p.fromVec2=function(t,e){return new p(t.x,e.x,t.y,e.y)},p.prototype.toString=function(){return _.map([this.x,this.y,this.z,this.w],function(t){return""+t}).join(",")},p.prototype.applyFn=function(t){return new p(t(this.x),t(this.y),t(this.z),t(this.w))};var S=p;function p(t,e,i,n){this.x=t,this.y=e,this.z=i,this.w=n}var y,A=C.ipc.TypeNum,w=(d.calculateCroppedBounds=function(t,e,i,n){function r(t,e,i){return e+(i-e)*t}function o(t){return new b(Math.floor(t.x),Math.ceil(t.y))}var a=new b(r(t.x,e.x,e.z),r(t.z,e.x,e.z)),t=new b(r(t.y,e.y,e.w),r(t.w,e.y,e.w));return i&&(d.isInt(i)||d.isLong(i))&&(a=o(a)),n&&(d.isInt(n)||d.isLong(n))&&(t=o(t)),new S(a.x,t.x,a.y,t.y)},d.calculateCroppedJsBounds=function(t,e,i,n){var r=d.scaleJs(t.x,e.x,e.z),o=d.scaleJs(t.z,e.x,e.z),a=d.scaleJs(t.y,e.y,e.w),t=d.scaleJs(t.w,e.y,e.w),e=d.calculatePrecision(i,new b(r,o)),i=d.calculatePrecision(n,new b(a,t));return new S(e.x,i.x,e.y,i.y)},d.calculatePrecision=function(e,t){var i;return e&&(d.isInt(e)||d.isLong(e))&&(i=t.applyFn(function(t){return d.convertJSToScalar(e,t)}),i=i,i=new b(Math.floor(Number(i.x)),Math.ceil(Number(i.y))),t=new b(d.convertToJsScalar(e,i.x),d.convertToJsScalar(e,i.y))),t},d.calculateCroppedJs2=function(t,e,i){var n=d.scaleJs(t.x,e.x,e.y),t=d.scaleJs(t.y,e.x,e.y),e=new b(n,t);return i?d.calculatePrecision(i,e):e},d.calculateCrop=function(t,e){t=new b(d.calcCrop(t.x,e.x,e.y),d.calcCrop(t.y,e.x,e.y));return new b(isNaN(t.x)?0:t.x,isNaN(t.y)?1:t.y)},d.calcCrop=function(t,e,i){return t=d.convertJSToNumber(t),e=d.convertJSToNumber(e),1-(t-(i=d.convertJSToNumber(i)))/(e-i)},d.calculateBoundsDiagonal=function(t){var e=t.z-t.x,t=t.w-t.y;return Math.sqrt(e*e+t*t)},d.calculateInset=function(t,e){var i=t.z-t.x,n=t.w-t.y,r=2*e;return new S(r<=n?t.x+e:t.x,r<=i?t.y+e:t.y,r<=n?t.z-e:t.z,r<=i?t.w-e:t.w)},d.calculateMergedRange=function(t){if(0===t.length)return null;if(1===t.length)return t[0];for(var e=t[0].x,i=t[0].y,n=1;n<t.length;n++)var r=t[n],e=d.min(e,r.x),i=d.max(i,r.y);return new b(e,i)},d.convertStringToScalar=function(t,e){var i;return isNaN(Number(t))?e?(i=e.fromString(t),e.toScalar(i)):t:Number(t)},d.convertJSToNumber=function(t){return f.isMoment(t)||f.isDuration(t)?t.valueOfNano()/1e6:t},d.convertJSToScalar=function(t,e){var i,n=C.ipc;(i={})[A.Date]=n.QDate,i[A.DateTime]=n.DateTime,i[A.Minute]=n.Minute,i[A.Month]=n.Month,i[A.Second]=n.Second,i[A.Time]=n.Time,i[A.Timespan]=n.Timespan,i[A.Timestamp]=n.Timestamp;n=i[t];if(n)return n.toScalar(n.fromMoment(e));if(f.isMoment(e)||f.isDuration(e))throw"Invalid Type Conversion";return e},d.convertStringToJsScalar=function(t,e){t=d.convertStringToScalar(t,d.ipcTemp(e));return d.convertToJsScalar(e,t)},d.convertToJsScalar=function(t,e,i){var n=C.ipc;(r={})[A.Date]=n.QDate,r[A.DateTime]=n.DateTime,r[A.Minute]=n.Minute,r[A.Month]=n.Month,r[A.Second]=n.Second,r[A.Time]=n.Time,r[A.Timespan]=n.Timespan,r[A.Timestamp]=n.Timestamp;var r,n=r[t];return n?(t===A.Timespan&&(e=Number(e)),r=d.isLong(t)&&C.Long.isLong(e)?C.Long.fromString(e.toString()):e,i?n.fromScalar(r):C.Tools.convertKDBTemporalToMoment(n.fromScalar(r))):Number(e)},d.convertVec2ToJsScalar=function(t,e,i){return new b(d.convertToJsScalar(e,t.x),d.convertToJsScalar(i,t.y))},d.convertVec4ToJsScalar=function(t,e,i){return new S(d.convertToJsScalar(e,t.x),d.convertToJsScalar(i,t.y),d.convertToJsScalar(e,t.z),d.convertToJsScalar(i,t.w))},d.convertVec4ToScalar=function(t,e,i){return new S(d.convertJSToScalar(e,t.x),d.convertJSToScalar(i,t.y),d.convertJSToScalar(e,t.z),d.convertJSToScalar(i,t.w))},d.dist=function(t,e){var i=t.x-e.x,t=t.y-e.y;return Math.sqrt(i*i+t*t)},d.expandNestedViewStates=function(t,e){var i,n=/([a-zA-Z]+)\.[0-9]+\./,r=Object.keys(t),o=[];return(o=_.every(function(t){t=e.getPropertyMeta(t[0]);return t&&"viewstate"===t.type})?_.uniq(_.filter(_.map(r,function(t){t=n.exec(t);return t?t[1]:null}))):o).length?(i={},_.each(o,function(t){return i[t]=e.getProperty(t)}),i):t},d.floatToEmulateDoubleArray=function(t){for(var e=2*t.length,i=new Float32Array(e),n=0,r=0;r<e;r+=2){var o=t.getScalar(n++);i[r]=o,i[r+1]=o-Math.fround(o)}return i},d.getDistance=function(t,e){for(var i=e[e.length-1]-e[0],n=t.length,r=1/0,o=1/0;n--;)r=t[n]<r&&0<t[n]?t[n]:r,o=Math.abs(t[n]<o&&t[n]<0?t[n]:o);var a=r<o?r:o;return a>i/e.length?a:i/e.length},d.getFormatter=function(i,n,r){return"Number"===i||"Formatted Number"===i||"Smart Number"===i?function(t){var e;if("Smart Number"!==i&&"Formatted Number"!==i||"string"==typeof t&&(t=/^(\-|\+)?([0-9]+(\.[0-9]+)?|Infinity)$/.test(t)?parseFloat(t):t),null==t)return"";if(e="Smart Number"===i?_.isNumber(t)?C.Tools.smartFormatNumber(t,n):_.escape(t):"number"==typeof t?"Formatted Number"===i?C.Tools.formatNumber(t,n):t.toFixed(n):_.escape(t),r&&0<=e.toString().indexOf(".")){for(;"0"===e[e.length-1];)e=e.slice(0,-1);e.indexOf(".")===e.length-1&&(e=e.slice(0,-1))}return e}:"General"===i?function(t){return f.isMoment(t)||f.isDuration(t)?t.format():_.escape(t)}:"Boolean"===i?function(t){return _.escape(t)}:function(t){return _.escape(t)}},d.getMajorPerformanceCaveat=function(t){var e=document.createElement("canvas"),i=(e.setAttribute("width","1"),e.setAttribute("height","1"),document.getElementsByTagName("body")[0]),t=(i.appendChild(e),e.getContext(t,{failIfMajorPerformanceCaveat:!0}));return i.removeChild(e),!t},d.getValueFromObject=function(t){for(var e="",i=0;i<t.length;i++)e+=t.getValue(i);return e},d.ipcTemp=function(t){switch(t){case 12:return C.ipc.Timestamp;case 13:return C.ipc.Month;case 14:return C.ipc.QDate;case 15:return C.ipc.DateTime;case 16:return C.ipc.Timespan;case 17:return C.ipc.Minute;case 18:return C.ipc.Second;case 19:return C.ipc.Time}},d.isDouble=function(t){return-1!==d.DOUBLE_TYPES.indexOf(t)},d.isFloat=function(t){return t===A.Float},d.isInt=function(t){return-1!==d.INT_TYPES.indexOf(t)},d.isLong=function(t){return-1!==d.LONG_TYPES.indexOf(t)},d.isRegexOrWild=function(t){t="object"==typeof t&&t.attributes?t.attributes.value:t;return!!t&&(0===t.indexOf("/")||-1!==t.indexOf("*"))},d.limitWithin=function(t,e,i){return t=d.toNumber(t),e=d.toNumber(e),i=d.toNumber(i),t<e?e:i<t?i:t},d.log10=function(t){return Math.log10?Math.log10(t):Math.log(t)/Math.LN10},d.longToEmulateDoubleArray=function(e){for(var t=2*e.length,i=new Float32Array(t),n=0,r="undefined"!=typeof BigInt?e.getScalar.bind(e):function(t){return e.getLegacyScalar(t).toString()},o=0;o<t;o+=2){var a=Number(r(n++));i[o]=a,i[o+1]=a-Math.fround(a)}return i},d.mergeRange=function(t){if(0<t.length){for(var e=t[0],i=1;i<t.length;i++)e=new b(d.minJs(e.x,t[i].x),d.maxJs(e.y,t[i].y));return e}},d.max=function(t,e){if(C.Long.isLong(t)){if(C.Long.isLong(e))return t.gt(e)?t:e;t=t.toNumber()}else C.Long.isLong(e)&&(e=e.toNumber());return e<t?t:e},d.maxJs=function(t,e){return f.isMoment(t)&&f.isMoment(e)?t.valueOfNano()>e.valueOfNano()?t:e:e<t?t:e},d.min=function(t,e){if(C.Long.isLong(t)){if(C.Long.isLong(e))return t.gt(e)?e:t;t=t.toNumber()}else C.Long.isLong(e)&&(e=e.toNumber());return e<t?e:t},d.minJs=function(t,e){return f.isMoment(t)&&f.isMoment(e)||f.isDuration(t)&&f.isDuration(e)?t.valueOfNano()>e.valueOfNano()?e:t:e<t?e:t},d.replaceViewStates=function(i,t,l,h){var u=function(t,e){return function i(t,e,n){n=n?n+".":"";e+="";var r=h.getPropertyMeta(n+e);var o=t&&t.has&&t.has("_dataSource")&&t.has("_dataType");o=(_.isArray(t)||_.isObject(t))&&!o;{var a,s;return r&&"data"===r.type?t:r&&"viewstate"===r.type?(s=(n+e).split("."),a=s.pop(),s=s.join("."),l(s,void 0===a?"":a,t,r)):o?(n+=e,u=function(t,e){return i(t,e,n)},(c=_.isArray(t)?_.map:_.mapValues)(t,u)):t}}(t,e,i||"")},c=_.isArray(t)?_.map:_.mapValues;return c(t,u)},d.replaceViewStatesWithValue=function(t,e,i){return d.replaceViewStates(t,e,function(t,e,i,n){return n.value,n.value},i)},d.intToFloat=function(t){for(var e=0,i=new Float32Array(t.length),n=0;n<t.length;n++){var r=t.getScalar(e++);i[n]=r}return i},d.toLong=function(t){return d.isIE11?C.Long.isLong(t)?t:new C.Long(Math.round(Number(t))):"bigint"==typeof t?t:BigInt(Math.round(t))},d.toNumber=function(t){return C.Long.isLong(t)?t.toNumber():"bigint"==typeof t?Number(t):t},d.calculateRelativePoint=function(t,e){return new b(d.calculateRelativeValue(t.x,e.x,e.z),d.calculateRelativeValue(t.y,e.y,e.w))},d.calculateRelativeValue=function(t,e,i){var n;return d.isIE11?((C.Long.isLong(t)?t.toNumber():Number(t))-(n=C.Long.isLong(e)?e.toNumber():Number(e)))/((C.Long.isLong(i)?i.toNumber():Number(i))-n):(Number(t)-Number(e))/(Number(i)-Number(e))},d.scale=function(t,e,i){return e+t*(i-e)},d.scale2=function(t,e,i){return new b(e.x+t*(i.x-e.x),e.y+t*(i.y-e.y))},d.scale4=function(t,e,i){return new S(e.x+t*(i.x-e.x),e.y+t*(i.y-e.y),e.z+t*(i.z-e.z),e.w+t*(i.w-e.w))},d.scaleJs=function(t,e,i){var n,r;return f.isMoment(e)&&f.isMoment(i)?(n=e.valueOfNano()+t*(i.valueOfNano()-e.valueOfNano()),(r=f(n/1e6)).nanoseconds(n%1e6),r):f.isDuration(e)&&f.isDuration(i)?(n=e.valueOfNano()+t*(i.valueOfNano()-e.valueOfNano()),(r=f.duration(n/1e6)).nanoseconds(n%1e6),r):Number(e)+t*(Number(i)-Number(e))},d.toS=function(t){return"number"!=typeof t&&t.toDashString?t.toDashString():t.toString?t.toString():""},d.xPart=function(t){return new b(t.x,t.z)},d.yPart=function(t){return new b(t.y,t.w)},d.isIE11=/Trident\/.*rv:11/.test(navigator.userAgent),d.isWebGL2="undefined"!=typeof WebGL2RenderingContext,d.glContext=d.isWebGL2?"webgl2":d.isIE11?"experimental-webgl":"webgl",d.isWebGLHWAcclEnabled=!d.getMajorPerformanceCaveat("webgl"),d.DOUBLE_TYPES=[A.Double,A.DateTime],d.INT_TYPES=[A.Byte,A.Short,A.Int,A.Char,A.Month,A.Date,A.Minute,A.Second],d.LONG_TYPES=[A.Long,A.Timespan,A.Timestamp],d);function d(){}(r=y=y||{})[r.Nanosecond=0]="Nanosecond",r[r.Millisecond=1]="Millisecond",r[r.Second=2]="Second",r[r.Minute=3]="Minute",r[r.Hour=4]="Hour",r[r.Day=5]="Day",r[r.Month=6]="Month",r[r.Year=7]="Year";m.prototype.getBaseSize=function(t){return this.displayTitle?t+m.TICKSIZE+1.8*this.titleFontSize:(t+=2*m.TICKSIZE,this.width?t-(t-this.width):t)},m.prototype.getGridlines=function(){return{color:this.gridlinesColor,offset:this.gridlinesOffset,opacity:this.gridlinesOpacity}},m.prototype.getSimpleTicks=function(){var t=f.isMoment(this.bounds.x),e=f.isDuration(this.bounds.x),i=w.convertJSToNumber(this.bounds.x),n=w.convertJSToNumber(this.bounds.y);if(t||e){for(var r,o,a=[],t=this.determineUnitForAutoTicks(i,n,this.ticks),s=m.INTERVALS[t],l=t===y.Month||t===y.Year,h=l||t===y.Year,u=(i/=s.size,(n/=s.size)-i),t=this.niceNum(n-i,!1),c=t&&t<this.ticks-1?t:this.ticks-1,p=this.niceNum(t/c,!0),d=Math.floor(i/p)*p;d<=n;d+=p)i<=d&&(o=void 0,o=e?C.Tools.convertValueToDuration(d*s.size).format(h?"":s.format):(r=(l?d+1:d)*s.size,(this.type===A.Date?f(r):C.Tools.convertValueToMoment(r)).format(s.format)),a.push({pos:(d-i)/u,label:this.prefix+o+this.suffix}));return a}return this.niceScale(i,n)},m.prototype.measureText=function(t,e){return t.font=this.fontSize+"px "+m.FONTFACE,t.measureText(e)},m.prototype.setRangeViewstate=function(t,e,i){var n=t?w.toS(t.x):"",t=t?w.toS(t.y):"";this.api.getPropertyMeta(e+"."+i+m.PROP_SEL_MIN).viewstateType&&this.api.setProperty(e+"."+i+m.PROP_SEL_MIN,n),this.api.getPropertyMeta(e+"."+i+m.PROP_SEL_MAX).viewstateType&&this.api.setProperty(e+"."+i+m.PROP_SEL_MAX,t)},m.prototype.updateBounds=function(t,e){_.isEqual(t,this.bounds)||(this.bounds=t,this.type=_.min(e))},m.prototype.niceNum=function(t,e){var i=Math.floor(w.log10(t)),t=t/Math.pow(10,i),e=e?t<1.5?1:t<3?2:t<7?5:10:t<=1?1:t<=2?2:t<=5?5:10;return e*Math.pow(10,i)},m.prototype.determineUnitForAutoTicks=function(t,e,i){var n,r=Number.MAX_SAFE_INTEGER||9007199254740991,o=this.getUnitFromLayer(this.type);for(n in y){var a=isNaN(Number(n))?y[n]:Number(n),s=m.INTERVALS[a],l=s.steps||r,s=Math.ceil((e-t)/(l*s.size)),l=Math.ceil((e-t)/(l*m.INTERVALS[o].size));if(s<=i){if(l<s)return o;if(Number(a)>=o)return a}}return y.Year},m.prototype.getUnitFromLayer=function(t){switch(t){case A.Date:return y.Day;case A.Month:return y.Month;case A.Minute:return y.Minute;case A.Second:return y.Second;case A.Timespan:case A.Timestamp:return y.Nanosecond;case A.DateTime:case A.Time:return y.Millisecond;default:return y.Year}},m.prototype.niceScale=function(t,e){for(var i=[],n=e-t,r=this.niceNum(e-t,!1),o=this.niceNum(r/(this.ticks-1),!0),r=Math.floor(t/o)*o,a=Math.max(-Math.floor(w.log10(o)),0),s=w.getFormatter(this.format,Math.max(a,this.decPlaces),this.hideTrailingZeroes),l=r;l<=e;l+=o)t<=l&&i.push({pos:(l-t)/n,label:this.prefix+s(l)+this.suffix});return i},m.FONTFACE="Segoe UI,Helvetica,Arial,sans-serif",m.PROP_BEGIN_ZERO=".Format.BeginAtZero",m.PROP_MIN=".Range.Min",m.PROP_MAX=".Range.Max",m.PROP_SEL_MIN=".Range.SelectionMin",m.PROP_SEL_MAX=".Range.SelectionMax",m.TICKSIZE=7,m.PROP_USE_MIN_MAX=".Range.UseMinMax",m.PROP_DISPLAY=".Format.Display",m.PROP_FONTSIZE=".Format.FontSize",m.PROP_FORMAT=".Format.Format",m.PROP_GRIDLINESCOLOR=".Gridlines.GridlinesColor",m.PROP_GRIDLINESOFFSET=".Gridlines.GridlinesOffset",m.PROP_GRIDLINESOPACITY=".Gridlines.GridlinesOpacity",m.PROP_HIDETRAIL=".Format.HideTrailingZeroes",m.PROP_POSITION=".Position",m.PROP_PRECISION=".Format.Precision",m.PROP_PREFIX=".Format.Prefix",m.PROP_SUFFIX=".Format.Suffix",m.PROP_TICKS=".Ticks",m.PROP_TITLEDISPLAY=".Title.Display",m.PROP_TITLESTRING=".Title.LabelString",m.PROP_TITLEFONTSIZE=".Title.FontSize",m.PROP_WIDTH=".Width",m.INTERVALS=[{common:!0,size:1e-6,steps:1e6,format:"H:mm:ss.SSSSSSSSS"},{common:!0,size:1,steps:1e3,format:"H:mm:ss.SSS"},{common:!0,size:1e3,steps:60,format:"H:mm:ss"},{common:!0,size:6e4,steps:60,format:"H:mm"},{common:!0,size:36e5,steps:24,format:"HH:mm"},{common:!0,size:864e5,steps:30,format:"YYYY-MM-DD"},{common:!0,size:2628e6,steps:12,format:"MMM YY"},{common:!0,size:3154e7,format:"Y"}];var O=m;function m(t,e){this.bounds=new b(0,1),this.type=0,this.api=t,this.width=t.getProperty(e+m.PROP_WIDTH),this.displayTitle=t.getProperty(e+m.PROP_TITLEDISPLAY),this.display=t.getProperty(e+m.PROP_DISPLAY),this.gridlinesOpacity=t.getProperty(e+m.PROP_GRIDLINESOPACITY),this.gridlinesOffset=t.getProperty(e+m.PROP_GRIDLINESOFFSET),this.gridlinesColor=t.getProperty(e+m.PROP_GRIDLINESCOLOR),this.title=t.getProperty(e+m.PROP_TITLESTRING),this.titleFontSize=t.getProperty(e+m.PROP_TITLEFONTSIZE),this.ticks=t.getProperty(e+m.PROP_TICKS),this.fontSize=t.getProperty(e+m.PROP_FONTSIZE),this.position=t.getProperty(e+m.PROP_POSITION),this.prefix=t.getProperty(e+m.PROP_PREFIX),this.suffix=t.getProperty(e+m.PROP_SUFFIX),this.format=t.getProperty(e+m.PROP_FORMAT),this.decPlaces=t.getProperty(e+m.PROP_PRECISION),this.hideTrailingZeroes=t.getProperty(e+m.PROP_HIDETRAIL)}var ut=function(t,e,i,n,r){this.layer=t,this.index=e,this.overpoint=i,this.yAxis=n,this.yIndex=r},ct=(g.prototype.drawCoordinates=function(t,e,i,n,r,o){var a,s,l,h=n.getElementsByClassName("xCoord")[0],u=n.getElementsByClassName("yCoord")[0],c=(h||u||(h=this.setUpCoordinate(!0,n),u=this.setUpCoordinate(!1,n)),t.width*e.x),e=t.height*e.y;!r||h.innerText===(s=this.formatData("Xaxis",r.val))&&"none"!==h.style.display||(h.style.display="block",l=h.offsetHeight,a=h.offsetWidth,r="Top"===r.position?i.y-l-3:t.height+i.y+3,t=c+i.x,c=a/2,h.style.top=(r+l>n.offsetHeight?r-l:r)+"px",h.style.left=(t-c<0?0:t+c>n.offsetWidth?n.offsetWidth-a:t-c)+"px",h.innerText=s),!o||u.innerText===(s=this.formatData("Yaxis",o.val))&&"none"!==u.style.display||(u.style.display="block",l="Right"===o.position?n.offsetWidth-i.z+3:i.x-u.offsetWidth-3,r=u.offsetHeight,u.style.top=e+i.y-r/2+"px",u.style.left=(l<0?0:l)+"px",u.innerText=s)},g.prototype.hideCoordinates=function(t,e){var i=t.getElementsByClassName("yCoord")[0],t=t.getElementsByClassName("xCoord")[0];"x"===e&&t?t.style.display="none":"y"===e&&i?i.style.display="none":t&&i&&(i.style.display="none",t.style.display="none")},g.prototype.updateTheme=function(t,e){var i,n=e.getElementsByClassName("xCoord")[0],e=e.getElementsByClassName("yCoord")[0];this.theme=t,n&&e&&(n.style.backgroundColor=i=(t="Light"===t)?"rgba(48, 48, 48, 0.9)":"rgba(248, 248, 248, 0.9)",n.style.color=t?"white":"black",e.style.backgroundColor=i,e.style.color=t?"white":"black")},g.prototype.updateTooltipPalette=function(t){this.palette=t},g.prototype.hideTooltip=function(){this.api.removeTooltip(),delete this.tooltip},g.prototype.render=function(t,e,i,n){var r=this,o=t.width*e.overpoint.x+6,a=t.height*(1-e.overpoint.y)+6,s=this.api.getProperty(g.PROP_GROUPBYLAYER),l=this.api.getProperty(g.PROP_SHOWALLPOINTS),h=this.api.getProperty(g.PROP_USECUSTOMTOOLTIP),u=this.api.getProperty(e.layer.indexProp(D.PROP_XAXIS)),c=e,e=(this.closestPointInfo=this.getRowData(c.layer,c.index,c.yAxis,c.yIndex),e.layer.getRowData(c.index)),p=e?e[u]:null,d=[],y=[];_.each(i,function(t){var e=r.api.getProperty(t.layer.indexProp(D.PROP_XAXIS)),i=t.layer.getRowData(t.index),i=i?i[e]:null;null!==i&&(e=function(t){return t.i+""+(t.n||0===t.n?t.n:"")},(i="object"==typeof i&&i.i?e(i):i)===(p="object"==typeof p&&p.i?e(p):p)&&(s&&l&&!h?y.push(t):d.push(r.getRowData(t.layer,t.index,t.yAxis,t.yIndex))))}),s&&l&&!h&&(d=this.groupedLayers(n,y));c={text:h?this.api.getProperty(g.PROP_CUSTOMTOOLTIP):z.TOOLTIP_DEFAULT,data:d,position:{top:a,left:o},anchorEl:t};return this.tooltip=this.api.setTooltip(c),e},g.prototype.returnPointInfo=function(){return this.closestPointInfo},g.prototype.formatData=function(t,e){var i=this.api.getProperty((t="Xaxis"===t?"Xaxes.0":"Yaxes.0")+g.PROP_FORMAT),n=this.api.getProperty(t+g.PROP_PRECISION),t=this.api.getProperty(t+g.PROP_HIDETRAIL);return w.getFormatter(i,n,t)(e)},g.prototype.formattedData=function(t,e){var n=t.getRowData(e);return n&&_.each(n,function(t,e){var i;C.Tools.isKDBTemporal(t)&&(i=C.Tools.convertKDBTemporalToMoment(t),n[e]=i.format(g.FORMATS[t.class]))}),n},g.prototype.getRowData=function(i,t,e,n,r){var o,a=this,s=this.api.getProperty(i.indexProp(D.PROP_XAXIS)),l=this.api.getProperty(i.indexProp(D.PROP_HIGHLIGHTRULES)),h=(i.isRegexOrWild()?(o=this.palette[i.index][n],(l&&l.length||i.hasColorData())&&(o=i.getColorArr(t,n))):(o=this.api.getProperty(i.indexProp(D.PROP_COLOR)),(l&&l.length||i.hasColorData())&&(o=i.getColorArr(t))),this.formattedData(i,t)),n=i.getLayerName(),l=i.isRegexOrWild()?e:n,t=h?this.formatData("Xaxis",h[s]):"",n=h?this.formatData("Yaxis",h[e]):"",s=this.getWidth(l,12),e=this.getWidth(t,12),u=this.api.getProperty(i.indexProp(D.PROP_ICON)),c={color:o,data:h,icon:u&&0===u.indexOf("fa")?"fa "+u:"fa fa-square",image:u&&0===u.indexOf("data:image/")?"width: 15px; content: url('"+u+"')":"",name:l,width:Math.max(s+30,e+30),xAxis:t,yAxis:n,grouped:r?_.map(r,function(t){return a.formatData("Yaxis",t)}):null};return i.isCandlestick()&&["Open","High","Low","Close"].forEach(function(t){var e=a.api.getProperty(i.indexProp(t));c[t.toLowerCase()]=h?a.formatData("Yaxis",h[e]):""}),c},g.prototype.getWidth=function(t,e){var i=document.createElement("canvas").getContext("2d");if(i)return i.font=e+"px "+O.FONTFACE,i.measureText(t).width;throw new Error("2d context not supported or canvas already initialized")},g.prototype.groupedLayers=function(n,o){var a=this,r=[],t=_.map(n,function(t){return t.layer.getAllCols()}),s=[];return _.each(t,function(t,e){var i=n[e];1===t.length?r.push(_.filter(o,function(t){return t.layer===i.layer&&t.yIndex===i.yIndex})):_.each(t,function(t,e){r.push(_.filter(o,function(t){return t.layer===i.layer&&t.yIndex===Number(e)}))})}),_.each(r,function(n,r){_.each(o,function(t){var e,i=n[0];i&&i.layer===t.layer&&(e=n[0].yAxis,t=_.map(n,function(t){t=a.formattedData(t.layer,t.index);return t?t[e]:null}),s[r]=a.getRowData(i.layer,i.index,i.yAxis,i.yIndex,t))})}),s.filter(function(t){return t})},g.prototype.setUpCoordinate=function(t,e){var i=document.createElement("div");return i.className=t?"xCoord":"yCoord",i.style.borderRadius="3px",i.style.padding="3px",i.style.position="absolute",i.style.fontFamily="sans-serif",e.appendChild(i),this.updateTheme(this.theme,e),i},g.PROP_CUSTOMTOOLTIP="Overlay.CustomTooltip",g.PROP_USECUSTOMTOOLTIP="Overlay.UseCustomTooltip",g.PROP_GROUPBYLAYER="Overlay.GroupByLayer",g.PROP_SHOWALLPOINTS="Overlay.ShowAllPoints",g.PROP_FORMAT=".Format.Format",g.PROP_HIDETRAIL=".Format.HideTrailingZeroes",g.PROP_PRECISION=".Format.Precision",g.FORMATS={1212:"YYYY-MM-DD HH:mm:ss.SSSSSSSSS",1213:"YYYY-MM",1214:"YYYY-MM-DD",1215:"YYYY-MM-DD HH:mm:ss.SSS",1216:"YYYY-MM-DD HH:mm:ss.SSSSSSSSS",1217:"YYYY-MM-DD HH:mm",1218:"YYYY-MM-DD HH:mm:ss",1219:"YYYY-MM-DD HH:mm:ss.SSS"},g);function g(t){this.subscriptionKey="",this.palette=[],this.api=t}P.prototype.hideCrosshair=function(t){var e=this.el.getElementsByClassName("crosshairX")[0],i=this.el.getElementsByClassName("crosshairY")[0],n=this.el.getElementsByClassName("crosshair-selected")[0];e&&this.el&&(e.setAttribute("visibility","hidden"),i.setAttribute("visibility","hidden"),"hide-both"===t&&n&&n.setAttribute("visibility","hidden"))},P.prototype.render=function(t,e,i,n){this.margin=t,"click"===i&&(this.overpoint=e);var r=this.canvas.width*e.x,e=this.canvas.height*(1-e.y),n="Light"===n?"black":"white";this.api.getProperty(P.PROP_CROSSHAIR)?(this.crosshairX?(this.crosshairX=this.el.getElementsByClassName("hover"===i?"crosshairX":"crosshair-selected")[0],this.crosshairY=this.el.getElementsByClassName("crosshairY")[0]):(this.crosshairX=document.createElementNS("http://www.w3.org/2000/svg","line"),this.crosshairY=document.createElementNS("http://www.w3.org/2000/svg","line"),"hover"===i?(this.crosshairX.setAttribute("class","crosshairX"),this.crosshairY.setAttribute("class","crosshairY")):this.crosshairX.setAttribute("class","crosshair-selected")),"number"==typeof r&&this.crosshairX&&isFinite(r)&&(this.setCrosshair(this.crosshairX,n,i),this.crosshairX.setAttribute("x1",r+""),this.crosshairX.setAttribute("y1","0"),this.crosshairX.setAttribute("x2",r+""),this.crosshairX.setAttribute("y2",this.canvas.height+t.y+"")),"number"==typeof e&&this.crosshairY&&isFinite(e)&&"hover"===i&&(this.setCrosshair(this.crosshairY,n),this.crosshairY.setAttribute("x1","0"),this.crosshairY.setAttribute("y1",e+""),this.crosshairY.setAttribute("x2",this.canvas.width+t.x+""),this.crosshairY.setAttribute("y2",e+""))):this.hideCrosshair("hide-both")},P.prototype.onPan=function(t){var e;this.isSelected()&&this.crosshairX&&(e=Number(this.crosshairX.getAttribute("x1"))/this.canvas.width,this.setPosition(e+t),this.overpoint=new b(e+t,this.overpoint.y))},P.prototype.updateSelected=function(t,e){var i;this.isSelected()&&(i=this.overpoint.x,e&&(e=t.y-t.x,i>t.x&&i<t.y?i=(i-t.x)/e:this.hideCrosshair("hide-both"),this.setPosition(i)))},P.prototype.isSelected=function(){return this.crosshairX&&this.crosshairX===this.el.getElementsByClassName("crosshair-selected")[0]&&"visible"===this.crosshairX.getAttribute("visibility")},P.prototype.setPosition=function(t){var e=this.canvas.width*t,i=this.canvas.height+this.margin.y+"";!isNaN(t)&&isFinite(e)&&this.crosshairX&&(this.crosshairX.setAttribute("x1",e+""),this.crosshairX.setAttribute("y1","0"),this.crosshairX.setAttribute("x2",e+""),this.crosshairX.setAttribute("y2",i))},P.prototype.setCrosshair=function(t,e,i){t.setAttribute("visibility","visible"),t.setAttribute("opacity",.7),t.setAttribute("stroke",e),t.setAttribute("stroke-dasharray","click"===i?0:3),this.el.getElementsByClassName("overlay")[0].appendChild(t)},P.SVG_NS="http://www.w3.org/2000/svg",P.PROP_CROSSHAIR="Overlay.ShowCrosshairs";var pt=P;function P(t,e,i){this.el=t,this.api=e,this.canvas=i,this.crosshairX=null,this.crosshairY=null,this.overpoint=new b(0,1),this.margin=new S(0,0,1,1)}yt.prototype.render=function(a){function s(t){return"object"==typeof t&&t.attributes?t.attributes.value:t}var l=[];_.each(this.api.getProperty("Layers"),function(t){_.each(_.filter(t.HighlightRules,function(t){return t.Show}),function(t){var e;if("gradient"===t.RuleType){if(!t.Palette.length)return;for(var i=t.Palette.map(function(t){return"object"==typeof t.type&&t.type.attributes?{type:t.type.attributes.value}:t}),n=new Array(i.length),r=0;r<i.length;r++){var o=(r/i.length*100).toFixed(2);n[r]=i[r].type+" "+o+"%"}e="linear-gradient(to right, "+n.join(", ")+")"}else e=s(t.RuleColor);l.push({ruleColor:e,ruleName:s(t.RuleName),color:a})})}),this.el.getElementsByClassName("GL-highlight-rule")[0].innerHTML=h.highlightRule(l)};var dt=yt;function yt(t,e){this.api=t,this.el=e}x.prototype.render=function(t){var u=this,c=[],p=this.color,d=k(this.layers),t=(this.legendHeight=void 0,this.ruleLegendHeight=void 0,this.updatePalette(this.layers,t),_.each(this.api.getProperty("Layers"),function(i,t){var n,r,e,o,a,s,l,h=d[t];u.disabledColumns[t]||(u.disabledColumns[t]=i.Enabled?[]:h.getAllCols()),u.api.getProperty("Layers."+t+".Legend")&&(n=u.api.getProperty("Layers."+t+".Icon"),r=h.isEnabled(),h.hasColorData()?(e=(a=h.getColorData())[0],o=a[1],e.forEach(function(t,e){c.push({fillStyle:o[e],icon:n,image:n&&0===n.indexOf("data:image/")?"content: url('"+n+"')":"",width:12,radius:6,text:t,color:p,strike:r?"":"line-through"})})):h.isRegexOrWild()?(a=h.getAllCols(),s=u.disabledColumns[t],l=h.getPaletteProperty(),_.each(a,function(t,e){c.push({fillStyle:l[e%l.length],icon:n,image:n&&0===n.indexOf("data:image/")?"content: url('"+n+"')":"",width:12,radius:6,text:t,color:p,strike:i.Enabled&&-1===s.indexOf(t)?"":"line-through"})})):c.push({fillStyle:u.api.getProperty("Layers."+t+(h.isCandlestick()?".CandlestickFormat.WickColor":".Color")),icon:n,image:n&&0===n.indexOf("data:image/")?"content: url('"+n+"')":"",width:12,radius:6,text:u.api.getProperty("Layers."+t+".Name"),color:p,strike:r?"":"line-through",bullColor:h.isCandlestick()?u.api.getProperty("Layers."+t+".CandlestickFormat.BullColor"):null}))}),this.el.getElementsByClassName("legend-div")[0]),r=(t.innerHTML=h.legend(c),t.style.top="5px",this.highlightRule.render(p),[]),t=(_.each(d,function(t,e){var i=u.api.getProperty("Layers."+e+".Legend"),n=r.filter(function(t){return t}),n=n[n.length-1],t=t.isCandlestick()?1:t.getAllCols().length;r.push(i?t+(0<e&&n?n:0):0)}),this.el.getElementsByClassName("legend-div")[0].getElementsByTagName("li"));_.each(t,function(t,e){return t.onclick=function(){return u.updateState(t,(i=e,n=0,_.each(r,function(t,e){if(i+1<=t)return n=e,!1}),n));var i,n}})},x.prototype.getLayers=function(t){this.layers=t},x.prototype.getHeight=function(){return void 0!==this.legendHeight?this.legendHeight:this.api.getProperty("Layers").filter(function(t){return t.Legend}).some(function(t){return t})?(t=this.el.getElementsByClassName("legend-div")[0],this.legendHeight=t.getBoundingClientRect().height):this.legendHeight=0;var t},x.prototype.getRulesHeight=function(){if(void 0!==this.ruleLegendHeight)return this.ruleLegendHeight;var t=this.el.getElementsByClassName("chartgl-highlight-rule")[0];return this.ruleLegendHeight=(null==t?void 0:t.getBoundingClientRect().height)||0},x.prototype.onResize=function(){this.legendHeight=void 0,this.ruleLegendHeight=void 0},x.prototype.updateTheme=function(t){this.color="Light"===t?"black":"white"},x.prototype.updateWildcards=function(t,e,i,n){t&&(this.updatePalette([t]),this.disabledColumns[e]=i&&t.isEnabled()?[]:t.getAllCols(),t.updateColumns(this.disabledColumns[e],n))},x.prototype.updatePalette=function(l,h){var u=this,c=[];_.each(this.api.getProperty("Layers"),function(e,i){e.Palette.forEach(function(t,e){""===t.type&&(e=(t=z.PALETTE_DEFAULT)[e%t.length],u.api.setProperty("Layers."+i+".Palette."+i,e))});var t=_.findIndex(l,function(t){return t.getId()===e._Id}),t=l[t],n=t?t.getPaletteProperty():[];if(t&&t.isRegexOrWild()){for(var r=[],o=t.getAllCols(),a=0;r.length<o.length;)r[a]=n[a%n.length],a++;var s=u.disabledColumns[i];_.each(s,function(t){return r[o.indexOf(t)]=""}),r=r.filter(function(t){return 0<t.length}),t.updateLayerPalette(r,h),c[i]=r}else t&&(c[i]=[],u.disabledColumns[i]=[],t.updateLayerPalette(n),t.hasColorData()&&t.updateColumns([]))}),this.tooltips.updateTooltipPalette(c)},x.prototype.updateState=function(t,e){var t=t.getElementsByTagName("span")[0],i=this.layers[e],n=i.isEnabled(),r=i.isRegexOrWild(),o=i.hasColorData();this.setIgnoreSettings(!0),""===t.style.textDecoration?(t.style.textDecoration="line-through",!r&&n&&this.api.setProperty("Layers."+e+".Enabled",!1),r&&(this.disabledColumns[e].length+1!==i.getAllCols().length&&!o||this.api.setProperty("Layers."+e+".Enabled",!1),o||this.disabledColumns[e].push(t.innerHTML))):(t.style.textDecoration="",n||this.api.setProperty("Layers."+e+".Enabled",!0),r&&(o?(this.api.setProperty("Layers."+e+".Enabled",!0),this.disabledColumns[e]=[]):this.disabledColumns[e].splice(this.disabledColumns[e].indexOf(t.innerHTML),1))),o&&this.render(!0),this.updateLayers(!0),r&&(this.updatePalette(this.layers),this.layers[e].updateColumns(this.disabledColumns[e])),this.setIgnoreSettings(!1),this.appInvalidate(M.Process)};var ft=x;function x(t,e,i,n,r,o){this.el=t,this.api=e,this.tooltips=i,this.appInvalidate=n,this.setIgnoreSettings=r,this.updateLayers=o,this.color="black",this.disabledColumns=[],this.layers=[],this.highlightRule=new dt(this.api,this.el)}v.prototype.onAxisPan=function(t,e){var i=t.clientX-e.left,n=t.clientY-e.top,r=e.right-t.clientX,e=e.bottom-t.clientY,t=this.axis.getMargin(),o=i<t.x,a=r<t.z,s=n<t.y,t=e<t.w,o=o?"Left":a?"Right":s?"Top":t?"Bottom":"";return[new S(i,n,r,e),o]},v.prototype.onPanning=function(t,e,i,n,r,o,a){var s,l="",h="Top"===e||"Bottom"===e,e="Left"===e||"Right"===e;this.activePan||(this.activePan=t),e?l=this.calculatePanDirection(t.y,"y",this.activePan):h&&(l=this.calculatePanDirection(t.x,"x",this.activePan)),l&&(a=h?a.offsetWidth:a.offsetHeight,a=this.pixelDiff/a,s=this.num-1,this.activePan=t,document.body.style.cursor=h?"e-resize":"n-resize",t=("Right"===l||"Left"===l?r:o)[s],r=i[s]||new b(0,1),o=n[s]||new b(0,1),i=(t.y-t.x)*(r.y-r.x)*a,n=(t.y-t.x)*(o.y-o.x)*a,r="Right"===l?-i:"Left"===l?i:0,o="Top"===l?-n:"Bottom"===l?n:0,i=new S(t.x+(h?r:0),t.x+(e?o:0),t.y+(h?r:0),t.y+(e?o:0)),this.onPan(i,"Right"===l?a:"Left"===l?-a:0,s,l))},v.prototype.onPointDown=function(t,e){this.activePan=t;var i="Top"===e||"Bottom"===e,n="Left"===e||"Right"===e,r=this.axis.getAxes("x"),o=this.axis.getAxes("y"),a=this.axis.getAxes("x","Top"),s=this.axis.getAxes("x","Bottom"),l=this.axis.getAxes("y","Left"),h=this.axis.getAxes("y","Right"),u=0,c=0,p=i?this.axis.getSize(e,"x"):n?this.axis.getSize(e,"y"):[];_.each(p,function(t,e){0<Number(e)&&(p[e]=p[Number(e)-1]+p[e])}),"Right"===e&&(u=t.z),"Left"===e&&(u=t.x),"Top"===e&&(u=t.y),"Bottom"===e&&(u=t.w),_.each(p,function(t,e){if(u<=t)return c=p.length-Number(e),!1}),"Right"===e&&(c=o.indexOf(h[c-1])+1),"Left"===e&&(c=o.indexOf(l[c-1])+1),"Top"===e&&(c=r.indexOf(a[c-1])+1),"Bottom"===e&&(c=r.indexOf(s[c-1])+1),this.num=c},v.prototype.calculatePanDirection=function(t,e,i){if("y"===e){if(this.pixelDiff=Math.abs(i.y-t),i.y<t)return"Bottom";if(i.y>t)return"Top"}else{if(this.pixelDiff=Math.abs(i.x-t),i.x<t)return"Right";if(i.x>t)return"Left"}return""};var mt=v;function v(t,e,i){this.api=t,this.axis=e,this.onPan=i,this.activePan=null,this.num=0,this.pixelDiff=0}R.prototype.getAxes=function(t,i){return i?_.map(this[t],function(t,e){if(t.position===i)return Number(e)+1}).filter(function(t){return void 0!==t}):_.map(this[t],function(t,e){return Number(e)+1})},R.prototype.getBounds=function(t,e,i,n){var r=this.api.getProperty(e+"."+i+O.PROP_BEGIN_ZERO),o=this.api.getProperty(e+"."+i+O.PROP_USE_MIN_MAX),a=this.api.getProperty(e+"."+i+O.PROP_MIN),e=this.api.getProperty(e+"."+i+O.PROP_MAX),a=/\S/.test(a)?a:t.x,e=/\S/.test(e)?e:t.y,i=o?new b(w.convertStringToJsScalar(a,n),w.convertStringToJsScalar(e,n)):t,o=t.y<0;return new b(r&&!o?0:i.x,r&&o?0:i.y)},R.prototype.getMargin=function(){return this.margin},R.prototype.getSelectionZoomBounds=function(t,e,i,n){var r=this.api.getProperty(e+"."+i+O.PROP_SEL_MIN),e=this.api.getProperty(e+"."+i+O.PROP_SEL_MAX),i=t?t.x:0,t=t?t.y:1,r=/\S/.test(r)?w.convertStringToScalar(r,w.ipcTemp(n)):"",e=/\S/.test(e)?w.convertStringToScalar(e,w.ipcTemp(n)):"";return"number"!=typeof r&&"bigint"!=typeof r||(i=w.convertToJsScalar(n,r)),"number"!=typeof e&&"bigint"!=typeof e||(t=w.convertToJsScalar(n,e)),new b(i,t)},R.prototype.getSize=function(e,t){var i,n,r=this,o=("x"===t?this.x:this.y).filter(function(t){return t.position===e&&t.display});return"x"===t?(i="Top"===e?this.legend.getHeight()+5:this.legend.getRulesHeight(),_.map(o,function(t,e){return(t.display?t.getBaseSize(t.fontSize):0)+(0===e?i:0)})):(t=this.getWidth(o),n="Left"===e?0:this.margin.z-t,_.map(o,function(t,e){var i=t.getSimpleTicks(),i=_.maxBy(i,function(t){return t.label.length}),i=t.measureText(r.ctx,(null==i?void 0:i.label)||"");return(t.display?t.getBaseSize(i.width):0)+(0===e?n:0)}))},R.prototype.onResize=function(){this.renderAll=!0},R.prototype.onSettingsChange=function(t,e){"Xaxes"===t&&(this.x[e]=new O(this.api,"Xaxes."+e)),"Yaxes"===t&&(this.y[e]=new O(this.api,"Yaxes."+e)),this.renderAll=!0},R.prototype.render=function(i,n,t,e){var r,o,a,s,l,h=this,u=(this.x.length!==t.length&&(this.x=[],_.each(t,function(t,e){h.x[e]=new O(h.api,"Xaxes."+e)})),this.y.length!==e.length&&(this.y=[],_.each(e,function(t,e){h.y[e]=new O(h.api,"Yaxes."+e)})),this.x.length&&_.some(this.x,function(t){return!0===t.display})),c=this.y.length&&_.some(this.y,function(t){return!0===t.display}),p=this.y.filter(function(t){return"Right"===t.position&&t.display}),d=i!==this.width||n!==this.height||this.renderAll,y=(i!==this.width&&(this.width=i,this.canvas.width=i),n!==this.height&&(this.height=n,this.canvas.height=n),d&&(this.updateTheme(),this.ctx.clearRect(0,0,i,n)),_.some(this.x,function(t,e){return t.bounds&&h.xBounds[e]&&(t.bounds.x!==h.xBounds[e].x||t.bounds.y!==h.xBounds[e].y)})),f=_.some(this.y,function(t,e){return t.bounds&&h.yBounds[e]&&(t.bounds.x!==h.yBounds[e].x||t.bounds.y!==h.yBounds[e].y)}),c=((d||f)&&c&&(f=this.margin,c=O.TICKSIZE,this.ctx.clearRect(0,f.y-c,f.x-O.TICKSIZE,n-f.y-f.w+2*c),this.ctx.clearRect(i-f.z+c,f.y-c,f.z+c,n-f.y-f.w+2*c),this.ctx.clearRect(f.x,f.y,i-f.z-f.x,n-f.y-f.w),this.ctx.clearRect(f.x-c,f.y-c,c+.5,n-f.y+2*c-f.w),this.ctx.clearRect(i-f.z-2,f.y-c-1,c+2,n-f.y+c-f.w+1),this.ctx.clearRect(i-f.z,f.y-1,c,n-f.y+O.TICKSIZE+1-f.w),_.each(e,function(t,e){h.api.getProperty("Yaxes."+e+O.PROP_DISPLAY)&&h.renderY(e,i,n)})),this.m.x!==this.margin.x||this.m.z!==this.margin.z),m=((d||c||y)&&u&&(f=this.margin,e=O.TICKSIZE,u=this.calcTickWidth("Left"),m=this.calcTickWidth("Right"),l=_.some(this.y,function(t){return!0===t.display&&"Left"===t.position}),r=_.some(this.y,function(t){return!0===t.display&&"Right"===t.position}),o=_.some(this.x,function(t){return!0===t.display&&"Top"===t.position}),a=f.x-.5,s=f.z,u&&(u>f.x||!l)&&(a=u),m&&(m>f.z||!r)&&(s=u),this.ctx.clearRect(0,n-f.w+O.TICKSIZE,i,f.w-1+O.TICKSIZE),o&&this.ctx.clearRect(0,0,i,f.y-(!c||d||y?e:0)),this.ctx.clearRect(a,n-f.w,(l=r?i-a-s:i)+1,O.TICKSIZE),o&&this.ctx.clearRect(a,f.y-O.TICKSIZE,l+.5,O.TICKSIZE-1),_.each(t,function(t,e){h.api.getProperty("Xaxes."+e+O.PROP_DISPLAY)&&h.renderX(e,i,n)})),this.margin),u=p.length?i-m.x-m.z-2:i;return this.ctx.clearRect(m.x,m.y,u,n-m.w-m.y),this.drawXGridlines(i,n),this.drawYGridlines(i,n),this.ctx.globalAlpha=1,this.updateTheme(),_.each(this.x,function(t,e){return h.xBounds[e]=t.bounds}),_.each(this.y,function(t,e){return h.yBounds[e]=t.bounds}),this.m=this.margin,this.renderAll=!1,this.margin},R.prototype.renderAxes=function(){this.renderAll=!0},R.prototype.updateTheme=function(t){this.theme=t||this.theme,"Light"===this.theme?(this.ctx.strokeStyle="#000000",this.ctx.fillStyle="#000000"):(this.ctx.strokeStyle="#ffffff",this.ctx.fillStyle="#ffffff")},R.prototype.calcTickWidth=function(t){var i=this,e=0,t="Left"===t?_.map(this.x,function(t){return _.first(t.getSimpleTicks())}):_.map(this.x,function(t){return _.last(t.getSimpleTicks())});return t.length&&(t=_.map(t,function(t){return t?t.label:""}),(t=_.max(_.map(t,function(t,e){return i.x[e].measureText(i.ctx,t).width})))&&(e=Math.ceil(t/2)+1)),e},R.prototype.drawXGridlines=function(h,u){var c=this;_.each(this.x,function(t){var e=t.getSimpleTicks(),i=h-c.margin.x-c.margin.z,n=t.getGridlines(),r=_.maxBy(e,function(t){return t.label.length}),t=t.measureText(c.ctx,(null==r?void 0:r.label)||"").width+12,r=0<Math.round(i/t)?Math.round(i/t):1,o=e.length>r?Math.round(e.length/r):1;c.ctx.beginPath(),c.ctx.strokeStyle=n.color,c.ctx.globalAlpha=void 0!==n.opacity?n.opacity/100:.15;for(var a=0;a<e.length;a+=o){var s=Math.round(c.margin.x+e[a].pos*i)+.5,l=(0!==a||!n.offset||(l=s/2)>c.margin.x&&(c.ctx.moveTo(l,u-c.margin.w),c.ctx.lineTo(l,c.margin.y)),n.offset?a===e.length-1?c.canvas.width-c.margin.z:c.margin.x+e[a+1].pos*i:0),s=n.offset?s+Math.abs(s-l)/2:s;s<h-c.margin.z&&(c.ctx.moveTo(s,u-c.margin.w),c.ctx.lineTo(s,c.margin.y))}c.ctx.stroke(),c.ctx.closePath()})},R.prototype.drawYGridlines=function(l,h){var u=this;_.each(this.y,function(t){var e=t.getSimpleTicks(),i=h-u.margin.w,n=i-u.margin.y,r=t.getGridlines();u.ctx.beginPath(),u.ctx.strokeStyle=r.color,u.ctx.globalAlpha=void 0!==r.opacity?r.opacity/100:.15;for(var o=0;o<e.length;o++){var a=Math.round(i-e[o].pos*n),s=r.offset?0===o?i:i-e[o-1].pos*n:0,s=r.offset?s-Math.abs(a-s)/2-.5:a+.5;u.ctx.moveTo(u.margin.x,s),u.ctx.lineTo(l-u.margin.z-2.5,s)}u.ctx.stroke(),u.ctx.closePath()})},R.prototype.getHeight=function(t){return _.sumBy(t,function(t){return t.display?t.getBaseSize(t.fontSize):0})},R.prototype.getWidth=function(t){var i=this;return _.sumBy(t,function(t){var e=t.getSimpleTicks(),e=_.maxBy(e,function(t){return t.label.length}),e=t.measureText(i.ctx,(null==e?void 0:e.label)||"");return t.display?t.getBaseSize(e.width):0})},R.prototype.renderX=function(t,e,i){function n(t,e,i,n){return e<=t&&!i?t:e<=t&&i?n+(t-n):n}var t=this.x[t],r=t.getSimpleTicks(),o=_.some(this.y,function(t){return!0===t.display&&"Left"===t.position}),a=_.some(this.y,function(t){return!0===t.display&&"Right"===t.position}),s=o?this.margin.x:0,l="Top"===t.position,h=this.x.filter(function(t){return"Top"===t.position&&t.display}),u=this.x.filter(function(t){return"Bottom"===t.position&&t.display}),c=this.getHeight(h)+this.legend.getHeight()+5,p=(p=this.getHeight(u)+this.legend.getRulesHeight())||5,d=l?this.legend.getHeight()+5+this.getHeight(h.slice(h.indexOf(t))):this.margin.y,y=l?0:this.getHeight(u.slice(u.indexOf(t)))+this.legend.getRulesHeight(),h=this.margin.z,u=n(this.calcTickWidth("Left"),this.margin.x,o,s),o=n(this.calcTickWidth("Right"),this.margin.z,a,h),f=s=s<u?u:s,m=e-s-(h=h<o?o:h)-1,a=_.maxBy(r,function(t){return t.label.length}),u=t.measureText(this.ctx,(null==a?void 0:a.label)||"").width+12,o=0<Math.round(m/u)?Math.round(m/u):1,g=r.length>o?Math.ceil(r.length/o):1;this.ctx.beginPath(),this.ctx.moveTo(s-.5,l?d-.5:i-y+.5),this.ctx.lineTo(e-h-.5,l?d-.5:i-y+.5);for(var P=0;P<r.length;P+=g){var x=Math.round(f+r[P].pos*m)+.5;this.ctx.moveTo(x,.5+(l?d:i-y)),this.ctx.lineTo(x,.5+(l?d-O.TICKSIZE:i-y+O.TICKSIZE))}this.ctx.stroke(),this.ctx.closePath(),this.ctx.textBaseline=l?"bottom":"top",this.ctx.textAlign="center",this.ctx.font=t.fontSize+"px "+O.FONTFACE;for(P=0;P<r.length;P+=g)0===(x=f+r[P].pos*m)&&(x=10),this.ctx.fillText(r[P].label,x+.5,l?d-O.TICKSIZE-.5:i-y+O.TICKSIZE+.5);t.displayTitle&&(this.ctx.textBaseline="middle",this.ctx.font=t.titleFontSize+"px "+O.FONTFACE,this.ctx.fillText(t.title,(e+s-h)/2,l?d-t.titleFontSize-15:i-y+t.titleFontSize+15)),this.margin=new S(s,c,h,p)},R.prototype.renderY=function(t,e,i){var n,t=this.y[t],r=this.x.length&&_.some(this.x,function(t){return t.display}),o="Left"===t.position,a=this.y.filter(function(t){return"Left"===t.position&&t.display}),s=this.y.filter(function(t){return"Right"===t.position&&t.display}),l=this.getWidth(a),h=this.getWidth(s),u=h,c=this.getHeight(this.x.filter(function(t){return"Bottom"===t.position})),p=this.getHeight(this.x.filter(function(t){return"Top"===t.position})),r=Math.round(r?c:5)+this.legend.getRulesHeight(),d=t.getSimpleTicks(),c=_.maxBy(d,function(t){return t.label.length}),c=t.measureText(this.ctx,(null==c?void 0:c.label)||""),p=p+(c.emHeightAscent||t.fontSize/2)+this.legend.getHeight(),y=this.getWidth(a.slice(a.indexOf(t))),u=o?u:this.getWidth(s.slice(s.indexOf(t))),f=this.calcTickWidth("Left"),a=(f&&(a.length?l<f&&(l+=n=f-l,y+=n):l=f),this.calcTickWidth("Right")),m=(a&&(s.length?h<a&&(h+=n=a-h,u+=n):h=a),r=r||8,p=p||8,Math.floor(o?y:e-u)+.5),g=i-r,P=g-p;this.ctx.beginPath(),this.ctx.moveTo(m-1,p-2),this.ctx.lineTo(m-1,1+g);for(var x=0;x<d.length;x++){var v=Math.round(g-d[x].pos*P)+.5;this.ctx.moveTo(m-1,v),this.ctx.lineTo(o?m-O.TICKSIZE-1:m+O.TICKSIZE,v)}this.ctx.stroke(),this.ctx.closePath(),this.ctx.textBaseline="middle",this.ctx.textAlign="Left"===t.position?"right":"left",this.ctx.font=t.fontSize+"px "+O.FONTFACE;for(x=0;x<d.length;x++){v=g-d[x].pos*P+.5;this.ctx.fillText(d[x].label,o?m-O.TICKSIZE:m+O.TICKSIZE,v)}t.displayTitle&&(this.ctx.textAlign="center",this.ctx.textBaseline="bottom",this.ctx.font=t.titleFontSize+"px "+O.FONTFACE,this.ctx.save(),this.ctx.translate(o?Math.abs(t.titleFontSize-m-2)-c.width:m+t.titleFontSize+c.width-2,(i-r+p)/2),this.ctx.rotate(o?-Math.PI/2:Math.PI/2),this.ctx.fillText(t.title,0,0),this.ctx.restore()),this.margin=new S(l,p,h,r)};var gt=R;function R(t,e,i){this.api=t,this.canvas=e,this.legend=i,this.x=[],this.y=[],this.margin=new S(0,0,0,0),this.m=new S(0,0,0,0),this.xBounds=[],this.yBounds=[],this.renderAll=!0;t=this.canvas.getContext("2d");if(!t)throw new Error("ChartGL: failed to get 2D context");this.ctx=t}T.prototype.getZoomDirection=function(){return this.direction},T.prototype.isDragging=function(){return null!==this.dragBounds},T.prototype.remove=function(){this.el.removeEventListener("mousedown",this.mouseDownHandler),document.removeEventListener("mousemove",this.mouseOverHandler,{capture:!0}),document.removeEventListener("mouseup",this.mouseUpHandler,{capture:!0}),document.removeEventListener("mousemove",this.mouseMoveHandler,{capture:!0})},T.prototype.resize=function(t,e,i,n){this.el.style.left=t+"px",this.el.style.top=e+"px",this.el.style.width=i+"px",this.el.style.height=n+"px"},T.prototype.createMask=function(){var t=document.createElementNS(T.SVG_NS,"path");return this.el.append(t),t},T.prototype.createDragLine=function(){var t=document.createElementNS(T.SVG_NS,"line");return t.setAttribute("class","drag-line"),t.setAttribute("stroke-dasharray","8,4"),this.el.append(t),t},T.prototype.createLines=function(){var e=this;return _.times(2,function(){var t=document.createElementNS(T.SVG_NS,"line");return e.el.append(t),t})},T.prototype.createRect=function(){var t=document.createElementNS(T.SVG_NS,"rect");return t.style.fill="none",this.el.append(t),t},T.prototype.onOverlayMouseDown=function(t){if(0!==t.button)return this.onOverlayMouseUp(t);if(this.clickTime){if(Date.now()-this.clickTime<325)return this.onOverlayMouseUp(t),this.onReset();this.clickTime=Date.now()}else this.clickTime=Date.now();this.bounds=this.el.getBoundingClientRect(),this.downPoint=new b(t.clientX-this.bounds.left,t.clientY-this.bounds.top),document.body.style["pointer-events"]="none",document.addEventListener("mouseup",this.mouseUpHandler,{capture:!0}),document.addEventListener("mousemove",this.mouseMoveHandler,{capture:!0}),t.preventDefault(),t.stopPropagation()},T.prototype.onOverlayMouseMove=function(t){if(t.stopPropagation(),this.bounds&&this.downPoint){var e,i=this.bounds.right-this.bounds.left,n=this.bounds.bottom-this.bounds.top,r=w.limitWithin(t.clientX,this.bounds.left,this.bounds.right)-this.bounds.left,o=w.limitWithin(t.clientY,this.bounds.top,this.bounds.bottom)-this.bounds.top,a=Math.min(this.downPoint.x,r),s=Math.min(this.downPoint.y,o),l=Math.abs(this.downPoint.x-r),h=Math.abs(this.downPoint.y-o),t=((t=e=e||{})[t.XY=0]="XY",t[t.X=1]="X",t[t.Y=2]="Y",e.XY);switch(l<T.SNAP_SZ&&h<T.SNAP_SZ?((u=l/h)<T.ASPECT_RATIO||1/T.ASPECT_RATIO<u)&&(t=u<1?e.Y:e.X):l<T.SNAP_SZ?t=e.Y:h<T.SNAP_SZ&&(t=e.X),t){case e.X:s=0,h=n;break;case e.Y:a=0,l=i}this.dragBounds=new S(a,s,a+l,s+h);var u=w.calculateBoundsDiagonal(this.dragBounds);if(0<u?(this.mask=this.mask||this.createMask(),this.mask.setAttribute("d","M0,0H"+i+"V"+n+"H0V0M"+(Math.round(a)+.5)+","+(Math.round(s)+.5)+"v"+h+"h"+l+"v-"+h+"h-"+l+"Z")):this.removeMask(),15<u)switch(this.dragLine=this.dragLine||this.createDragLine(),t){case e.X:this.direction="x",this.lines=this.lines||this.createLines(),this.removeRect(),this.dragLine.x1.baseVal.value=this.downPoint.x+.5,this.dragLine.y1.baseVal.value=this.downPoint.y+.5,this.dragLine.x2.baseVal.value=.5+r,this.dragLine.y2.baseVal.value=this.downPoint.y+.5,this.lines[0].x1.baseVal.value=this.downPoint.x+.5,this.lines[0].y1.baseVal.value=0,this.lines[0].x2.baseVal.value=this.downPoint.x+.5,this.lines[0].y2.baseVal.value=n,this.lines[1].x1.baseVal.value=.5+r,this.lines[1].y1.baseVal.value=0,this.lines[1].x2.baseVal.value=.5+r,this.lines[1].y2.baseVal.value=n;break;case e.Y:this.direction="y",this.lines=this.lines||this.createLines(),this.removeRect(),this.dragLine.x1.baseVal.value=this.downPoint.x+.5,this.dragLine.y1.baseVal.value=this.downPoint.y+.5,this.dragLine.x2.baseVal.value=this.downPoint.x+.5,this.dragLine.y2.baseVal.value=.5+o,this.lines[0].x1.baseVal.value=0,this.lines[0].y1.baseVal.value=this.downPoint.y+.5,this.lines[0].x2.baseVal.value=i,this.lines[0].y2.baseVal.value=this.downPoint.y+.5,this.lines[1].x1.baseVal.value=0,this.lines[1].y1.baseVal.value=.5+o,this.lines[1].x2.baseVal.value=i,this.lines[1].y2.baseVal.value=.5+o;break;default:this.direction="xy",this.rectangle=this.rectangle||this.createRect(),this.removeLines(),this.dragLine.x1.baseVal.value=this.downPoint.x+.5,this.dragLine.y1.baseVal.value=this.downPoint.y+.5,this.dragLine.x2.baseVal.value=.5+r,this.dragLine.y2.baseVal.value=.5+o,this.rectangle.x.baseVal.value=this.downPoint.x<r?this.downPoint.x+.5:.5+r,this.rectangle.y.baseVal.value=this.downPoint.y<o?this.downPoint.y+.5:.5+o,this.rectangle.width.baseVal.value=l,this.rectangle.height.baseVal.value=h}else this.removeDragLine(),this.removeLines(),this.removeRect()}},T.prototype.onOverlayMouseOver=function(t){var e=this.el.getBoundingClientRect();if(t.clientX<e.left||t.clientX>e.right||t.clientY<e.top||t.clientY>e.bottom)return this.onOver(null);var i=t.clientX-e.left,t=t.clientY-e.top;this.onOver(new b(i/(e.right-e.left),t/(e.top-e.bottom)))},T.prototype.onOverlayMouseUp=function(t){var e;this.bounds&&(document.body.style["pointer-events"]="auto",document.removeEventListener("mouseup",this.mouseUpHandler,{capture:!0}),document.removeEventListener("mousemove",this.mouseMoveHandler,{capture:!0}),t.stopPropagation(),this.dragBounds&&w.calculateBoundsDiagonal(this.dragBounds)>T.SNAP_SZ/3?(t=this.bounds.right-this.bounds.left,e=this.bounds.bottom-this.bounds.top,this.onZoom(new S(this.dragBounds.x/t,this.dragBounds.y/e,this.dragBounds.z/t,this.dragBounds.w/e))):this.onClick(),this.removeMask(),this.removeDragLine(),this.removeLines(),this.removeRect(),this.dragBounds=null)},T.prototype.removeDragLine=function(){this.dragLine&&this.el.removeChild(this.dragLine),this.dragLine=void 0},T.prototype.removeLines=function(){var e=this;this.lines&&this.lines.forEach(function(t){return e.el.removeChild(t)}),this.lines=void 0},T.prototype.removeRect=function(){this.rectangle&&this.el.removeChild(this.rectangle),this.rectangle=void 0},T.prototype.removeMask=function(){this.mask&&this.el.removeChild(this.mask),this.mask=void 0},T.SVG_NS="http://www.w3.org/2000/svg",T.SNAP_SZ=28,T.ASPECT_RATIO=.45;var Pt=T;function T(t,e,i,n,r){this.direction="",this.dragBounds=null,this.el=t,this.onOver=e,this.onZoom=i,this.onReset=n,this.onClick=r,this.mouseDownHandler=this.onOverlayMouseDown.bind(this),this.mouseUpHandler=this.onOverlayMouseUp.bind(this),this.mouseMoveHandler=this.onOverlayMouseMove.bind(this),this.mouseOverHandler=this.onOverlayMouseOver.bind(this),this.el.addEventListener("mousedown",this.mouseDownHandler),document.addEventListener("mousemove",this.mouseOverHandler,{capture:!0})}E.hexColorToVec4=function(t,e){t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return t&&4===t.length?new S(parseInt(t[1],16)/256,parseInt(t[2],16)/256,parseInt(t[3],16)/256,e/100):new S(.5,.5,.5,1)},E.prototype.convertFillToLayerData=function(){var i=this,n=[],r={fill:"",cols:null,toBounds:null,fromBounds:null};return this.yCols.forEach(function(t,e){n[e]=i.convertData(w.isWebGL2,t,"y",void 0,void 0,r)}),n},E.prototype.getBarWidth=function(){return this.barWidth},E.prototype.remove=function(e){_.each(this.buffers,function(t){e.deleteBuffer(t)})},E.prototype.render=function(a,e,i,n,s,l,h){var u=this,c="Bubble"===s||""===s?a.POINTS:"Line"===s?a.LINE_STRIP:a.TRIANGLES;this.shaders.forEach(function(r,o){void 0!==r&&(a.useProgram(r.Program),"Candlestick"===s?r.xBinding.apply(a,u.buffers[o]):r.xBinding.apply(a,u.buffers[0]),null!=h&&r.setTexture(a,h));var t="Candlestick"===s?u.colorBuffers[0]:u.colorBuffers[o];r.yBinding.apply(a,u.buffers[o+("Candlestick"===s?2:1)]),t&&r.colorLocation&&r.colorLocation.apply(a,t),u.sizeBuffer&&r.sizeLocation&&r.sizeLocation.apply(a,u.sizeBuffer),_.each([new b(e.x,e.z),new b(e.y,e.w)],function(t,e){var i=0===e?r.xRange:r.yRange,n=0===e?u.tx:u.tys[o],e=t.applyFn(function(t){return w.convertJSToScalar(n,t)});w.isLong(n)?(t=new b(C.Long.fromString(e.x.toString().split(".")[0]),C.Long.fromString(e.y.toString().split(".")[0])),i.set(a,t.applyFn(w.toNumber))):i.set(a,e.applyFn(w.toNumber))}),r.color&&(t=E.hexColorToVec4(i[o%i.length],l),r.color.set(a,t)),r.pointSize&&r.pointSize.set(a,n),u.drawGL(a,c)})},E.prototype.updatePointSizeOnZoom=function(i,t){var n=[];this.pointSizes&&(_.each(this.pointSizes,function(t){var e=t*(t*(2-i));n.push(e<t?t:e)}),this.sizeBuffer=L.createBuffer(t,new Float32Array(n)))},E.prototype.convertData=function(t,i,e,n,r,o,a,s){var l=i.qtype;if(!t&&w.isInt(l)&&(h=w.intToFloat(i),l=A.Float),void 0!==n||o||"Candlestick"===e){t=void 0;if(h=w.isDouble(l)?this.calcBarData(i,function(t,e){return i.getScalar(e)}):w.isLong(l)?(t=new C.Long(0,2147483648),"undefined"!=typeof BigInt&&(t=BigInt(t)),this.calcBarData(i,function(t,e){return Number("bigint"==typeof t?i.getScalar(e):i.getLegacyScalar(e).toString())},t)):this.calcBarData(i,function(t,e){return i.getScalar(e)},t=5===l?-32768:-2147483648),"Candlestick"===e)return h;if(void 0===n&&null!=o&&o.fill)var t=new V,h="x"===e?t.getXLineFill(h):t.getYLineFill(h,o);else if(void 0!==n){t=new H(this.tx,this.tys);if("x"===e){if(!a)throw"Missing merged";if("Fixed Width"===r&&void 0===s)throw"Missing width";o=w.convertVec4ToScalar(a,this.tx,this.tys[0]).applyFn(w.toNumber);h=t.getXBarPoints(h,n,r,o,s||0),this.barWidth=t.getBarWidth()}else h=t.getYBarPoints(h)}h="x"===e?this.getXBars(h):this.getYBars(h)}else h=w.isDouble(l)?w.floatToEmulateDoubleArray(i):w.isLong(l)?w.longToEmulateDoubleArray(i):h||i.toTypedArray();return h},E.prototype.calcBarData=function(i,n,r){var o=[];return _.each(i,function(t,e){e=n(i,e);(isNaN(e)||r&&e===Number(r))&&(e=0),o.push(e)}),o},E.prototype.drawGL=function(t,e){var i=this.count;e===t.TRIANGLES&&(i*=6),t.drawArrays(e,0,i)},E.prototype.getPointSizes=function(i,n,r){var o=[],t=i.qtype,a=w.isLong(t)?function(t,e){return Number("bigint"==typeof t?i.getScalar(e):i.getLegacyScalar(e).toString())}:function(t,e){return i.getScalar(e)};return _.each(i,function(t,e){e=a(i,e);o.push(e*(n*(r?1.333:1)))}),o},E.prototype.getXBars=function(t){if(this.tx!==A.DateTime&&this.tx!==A.Timestamp)return new Float32Array(t);for(var e=new Float32Array(2*t.length),i=0,n=0;n<e.length;n+=2){var r=t[i++];e[n]=r,e[n+1]=r-Math.fround(r)}return e},E.prototype.getYBars=function(r){var o=new Float32Array(0);return _.each(this.tys,function(t){if(t===A.DateTime||t===A.Timestamp){o=new Float32Array(2*r.length);for(var e=0,i=0;i<o.length;i+=2){var n=r[e++];o[i]=n,o[i+1]=n-Math.fround(n)}}}),o.length?o:new Float32Array(r)},E.prototype.processCandlesticks=function(t,i,s,e,l,h,u){var c=this,n=[],t=(t.forEach(function(t,e){n[e]=c.convertData(i,t,"Candlestick")}),[n[1],n[2]]),r=[n[0],n[3]],p=new H(this.tx,this.tys),d=this.convertData(i,e,"Candlestick"),y=[];[t,r].forEach(function(t,e){var i=0===e,n=i?l[3]/10:l[3],r=i?void 0:l,o=l[5],a=Math.abs(h.w-h.y)||0,t=p.getCandlesticks(t,a,r),a=(i||(y=t[1]),c.buffers[e]=L.createBuffer(s,c.getXBars(p.getXBarPoints(d,n,o,h,u))),c.buffers[e+2]=L.createBuffer(s,new Float32Array(t[0])),p.getBarWidth());a>c.barWidth&&(c.barWidth=a)}),y.length&&this.setColorArray(!1,!0,[y],s,!1)},E.prototype.setColorArray=function(o,e,t,i,a){var n=this,s=[];t&&t.length&&(t.forEach(function(t){var r;t=e?(r=[],_.each(t,function(t){for(var e=0;e<6;++e){var i,n=t;o&&a&&(i=1===e||2===e||4===e?0:t[3],n=[t[0],t[1],t[2],i]),r.push(Array.prototype.concat.apply([],n))}}),new Float32Array(Array.prototype.concat.apply([],r))):(t=Array.prototype.concat.apply([],t),new Float32Array(t)),s.push(t)}),s.forEach(function(t,e){n.colorBuffers[e]=L.createBuffer(i,t)}))};var xt=E;function E(t,e,n,r,o,i,a,s,l,h,u,c,p,d,y){var f=this,m=(this.barWidth=0,this.buffers=[],this.colorBuffers=[],this.pointSizes=[],this.yCols=[],this.count=Math.min(t.length,_.max(e.map(function(t){return t.length}))||0),this.tx=t.qtype,this.tys=e.map(function(t){return t.qtype}),this.yCols=e,!r&&w.isInt(this.tx)&&(this.tx=A.Float),r||(this.tys=this.tys.map(function(t){return w.isInt(t)?A.Float:t})),this.shaders=new Array(i.length?2:e.length),this.buffers=new Array(i.length?4:e.length+1),u&&u[0]),g=!(!m||!m.fill||"No Fill"===m.fill),P=void 0!==c||g||0<i.length,x=!!u&&u[1],u=u?h:l&&l.length?l:a&&a.length?a:null,v=(u&&u.length&&this.setColorArray(g,P,u,n,x),s[0]&&(this.pointSizes=this.getPointSizes(s[0],s[1],o),this.sizeBuffer=L.createBuffer(n,new Float32Array(this.pointSizes))),this.tx===A.DateTime||this.tx===A.Timestamp);if(i.length&&d&&y){var O=e.map(function(t){return t.qtype}).map(function(t){return w.isInt(t)?A.Float:t}),R=O[0]===A.DateTime||O[0]===A.Timestamp,h=w.convertVec4ToScalar(d,this.tx,this.tys[0]).applyFn(w.toNumber);this.processCandlesticks(e,r,n,t,i,h,y);for(var b=0;b<this.shaders.length;b++){var S=0===b?void 0:this.colorBuffers[0],S=L.getShader(n,r,v?this.tx:A.Float,R?O[0]:A.Float,o,void 0!==S,void 0!==this.sizeBuffer);this.shaders[b]=S,n.useProgram(S.Program)}}else{var T=m,l=this.convertData(r,t,"x",c,p,T,d,y);this.buffers[0]=L.createBuffer(n,l),e.forEach(function(t,e){var i=f.tys[e]===A.DateTime||f.tys[e]===A.Timestamp,i=L.getShader(n,r,P&&!v?A.Float:f.tx,P&&!i?A.Float:f.tys[e],o,void 0!==f.colorBuffers[e],void 0!==f.sizeBuffer),i=(f.shaders[e]=i,n.useProgram(i.Program),f.convertData(r,t,"y",c,p,T));f.buffers[e+1]=L.createBuffer(n,i)})}}I.getConditionResult=function(t,e,i){var n,r,o=!1,a=isNaN(parseFloat(t))||_.isObject(t)?(""+t).toLowerCase():parseFloat(t),s=isNaN(parseFloat(e))||_.isObject(e)?(""+e).toLowerCase():parseFloat(e);switch(t&&t.class&&0<=["1212","1213","1214","1215"].indexOf(t.class)?(a=C.Tools.convertKDBTemporalToMoment(t).unix(),"in"===i?(n=[],_.each(e.toString().split(","),function(t){n.push(C.Tools.convertDateStringValueToMoment(t).unix()),s=n.toString()})):s=C.Tools.convertDateStringValueToMoment(e).unix()):t&&t.class&&0<=["1216","1217","1218","1219"].indexOf(t.class)&&(a=C.Tools.convertKDBTemporalToMoment(t).valueOfNano(),"in"===i?(r=[],_.each(e.toString().split(","),function(t){r.push(C.Tools.convertDateStringValueToMoment(t).valueOfNano()),s=r.toString()})):s=C.Tools.convertDateStringValueToMoment(e).valueOfNano()),i){case"contains":o=0<=a.toString().indexOf(s.toString());break;case"starts with":o=0===a.toString().indexOf(s.toString());break;case"ends with":o=-1!==a.toString().indexOf(s.toString(),a.toString().length-s.toString().length);break;case"==":o=a===s;break;case"<":o=a<s;break;case">":o=s<a;break;case"<=":o=a<=s;break;case">=":o=s<=a;break;case"!=":o=a!==s;break;case"in":o=0<=s.toString().split(",").indexOf(a.toString());break;case"search":o=!!a.toString().match(s.toString());break;case"regexp":o=new RegExp(e.toString()).test(t?t.toString():"")}return o},I.getScalarResult=function(t,e,i,n){var r=t.getScalar(e);switch("bigint"==typeof r&&"bigint"!=typeof i&&(i=w.toLong(i)),n){case"==":return r===i;case"<":return r<i;case">":return i<r;case"<=":return r<=i;case">=":return i<=r;case"!=":return r!==i}},I.interpolateColor=function(t,e,i,n){if(!t.length)return"";for(var i=(i-e)/(t.length-1),n=this.clamp((n-e)/i,0,t.length-1),n=_.isNaN(n)?0:n,e=t[Math.floor(n)].type,i=t[Math.ceil(n)].type,r=this.hex2RGB(e),o=this.hex2RGB(i),a=n-Math.floor(n),s=r.slice(),l=0;l<3;l++)s[l]=Math.round(s[l]+a*(o[l]-r[l]));return this.RGB2hex(s)},I.clamp=function(t,e,i){return i<t?i:t<e?e:t},I.hex2RGB=function(t){t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[255,255,255]},I.RGB2hex=function(t){return"#"+((1<<24)+(t[0]<<16)+(t[1]<<8)+t[2]).toString(16).slice(1)};var vt=I;function I(){}_t.prototype.computeHighlightRules=function(r,t,e,i,o,n,a,s,l){var h=this;if(!o)return[""];var u={},c=(_.each(_.keys(o),function(t){u[t]=o[t]}),[]),p=[],d=i.length?i:e,y=t;if(r||a){var f,m=r.map(function(t){return new RegExp((t.RuleTarget||"*").replace(/\*/g,"(.*)$"))});if(u[d]){for(var g=0;g<u[d].length;g++){l&&l.length&&(y=l[g]);var P=r.length?this.computeColorInternal(d,g,r,m,u):s;c.push(P||y)}p.push(c)}else w.isRegexOrWild(i)&&(delete n[e],f=0,_.each(n,function(t,e){c=[];for(var i=0;i<t.length;i++){var n=r.length?h.computeColorInternal(e,i,r,m,o):s[f];c.push(n||(l&&l.length&&l[f]?l[f][i]:y[f]))}f++,p.push(c)}));return p}return[y]},_t.prototype.getColorArray=function(t,i,n,r){var o,e=[];return _.each(t,function(t){o=[],_.each(t,function(t){var e=xt.hexColorToVec4(t,n?r:i);o.push(Object.keys(e).map(function(t){return e[t]}))}),e.push(o)}),e},_t.prototype.computeColorInternal=function(s,l,t,h,u){var c,p={};return t.forEach(function(t,e){if(h[e].test(s)&&t.RuleSource){var e=u[t.RuleSource],i=u[t.RuleSource].qtype;if((3<i&&i<11||11<i&&i<20)&&{"==":!0,"<":!0,">":!0,"<=":!0,">=":!0,"!=":!0}[t.RuleOperation]&&!w.isIE11)return i=w.convertStringToScalar(t.RuleValue,w.ipcTemp(i)),void(vt.getScalarResult(e,l,i,t.RuleOperation)&&(c=t.RuleColor));_.each(_.keys(u),function(t){p[t]=u[t].getValue(l)});var n,e=t.RuleSource,r=p[e];if(r&&"object"==typeof r&&!r.i){for(var o="",a=0;a<r.length;a++)o+=""+r.getValue(a);r=o}"gradient"===t.RuleType?(i=t.Palette,e=t.RuleMin,n=t.RuleMax,c=vt.interpolateColor(i,e,n,r)):t.RuleOperation&&(i=t.RuleOperation,e=t.RuleValue,vt.getConditionResult(r,e,i)&&(c=t.RuleColor))}}),c};var Ot=_t;function _t(){}bt.prototype.getJSDataBounds=function(t){var e=this.xCol.qtype,i=this.yCols[0]?this.yCols[0].qtype:e;return w.convertVec4ToJsScalar(t,e,i)},bt.prototype.createRenderer=function(t,e,i,n,r,o,a,s){return new xt(this.xCol,this.yCols,t,e,i,n,r,this.radiusInfo,this.highlightRules,this.lineFillColors,o,this.barWidth,this.barType,a,s)},bt.prototype.getPoint=function(e){function t(t){return w.isIE11&&w.isLong(t.qtype)?t.getLegacyScalar(e):t.getScalar(e)}return[t(this.xCol)].concat(this.yCols.map(t))};var Rt=bt;function bt(t,e,i,n,r,o,a,s){this.xCol=t,this.yCols=e,this.yColNames=i,this.barWidth=n,this.barType=r,this.radiusInfo=o,this.highlightRules=a,this.lineFillColors=s}Object.defineProperty(N.prototype,"RenderState",{get:function(){return this.renderState},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"Config",{get:function(){return this.config},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"Renderer",{get:function(){return this.renderer},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"XType",{get:function(){return this.config?this.config.xCol.qtype:null},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"YType",{get:function(){return this.config&&this.config.yCols.length?this.config.yCols[0].qtype:null},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"datasourceError",{get:function(){var t;return null==(t=null==(t=this.datasource)?void 0:t.attributes)?void 0:t.error},enumerable:!1,configurable:!0}),N.prototype.getAllPointsFromRelativeX=function(){return this.points},N.prototype.getAxisId=function(t){return this.api.getProperty(this.indexProp(t+"AxisId")).replace(/.*?(\d+)$/,"$1")-1},N.prototype.getClosestPointFromRelativeX=function(n,e,t,r){var o=this;if(!this.config)return null;var a=this.config,i=a.xCol;if(i.hasIndex())s=i.length,h=function(t){return i.getIndexFromSortedIndex(t)};else{if(!this.workerIndex.length)return null;var s=this.workerIndex.length,l=this.workerIndex,h=function(t){return l[t]}}var u,c=w.isLong(i.qtype);function p(t){return"bigint"==typeof t?t:BigInt(Math.round(t))}u=c?(u=Math.round(n*t),w.isIE11?(r=r.applyFn(w.toLong)).x.add(new C.Long(u).mul(r.z.sub(r.x)).div(new C.Long(t))):p(r.x)+p(u)*(p(r.z)-p(r.x))/p(t)):Number(r.x)+n*(Number(r.z)-Number(r.x));function d(t){for(var e=a.getPoint(h(t)),i=1;i<e.length;i++){var n=w.calculateRelativeValue(e[i],r.y,r.w);if(0<=n&&n<=1)return 1}}function y(t,e){for(var i=[];e?0<=t:t<s;)g(t)||i.push(t),e?t--:t++;return i.length?o.getClosestXPoint(i,r,a,h,n):t}var f,m=0<=(t=i.hasIndex()?i.findIndex(u):c&&w.isIE11?C.Tools.binarySearch2(u,this.workerIndex,function(t,e){e=i.getLegacyScalar(e);return t.compare(e)}):C.Tools.binarySearch2(u,this.workerIndex,function(t,e){e=i.getScalar(e);return e<t?1:t<e?-1:0}))?f=t:(f=-t-2)+1,g=function(t){var t=a.getPoint(h(t)),e=t[0],t=t.slice(1);return isNaN(Number(e))||_.every(t,function(t){return isNaN(Number(t))})},t=a.getPoint(h(f)),P=a.getPoint(h(m)),t=isNaN(Number(t[0])),P=isNaN(Number(P[0]));if(t)f=y(f,!0);else if(g(f))for(;0<=f&&g(f);)f--;if(P)m=y(m,!1);else if(g(m))for(;m<s&&g(m);)m++;(t||P)&&(f=m=this.getClosestXPoint([f,m],r,a,h,n));for(var x=[],v=[],O=a.getPoint(h(f)),R=a.getPoint(h(m));0<=f&&a.getPoint(h(f))[0]===O[0];)d(f)&&x.push(f),f--;for(;m<s&&a.getPoint(h(m))[0]===R[0];)d(m)&&v.push(m),m++;f=x.length?this.getY(x,r,a,h,e):f,m=v.length?this.getY(v,r,a,h,e):m;var b,t=_.union(x,v);if(this.api.getProperty("Overlay.ShowAllPoints")&&(b=[],_.each(t,function(t){b.push(o.isRegexOrWild()?o.getAllWildcards(t,r,a,h):[o.getClosestPoint(t,r,a,h,e)])}),this.points=b),f<0&&s<=m)return null;if(f<0)return this.getClosestPoint(m,r,a,h,e);if(s<=m)return this.getClosestPoint(f,r,a,h,e);var S,T,P=this.getY(t,r,a,h,e);return t=w.isIE11&&c?(S=u.sub(i.getLegacyScalar(h(f))),T=i.getLegacyScalar(h(m)).sub(u),S.equals(T)?P:S.lt(T)?f:m):(S=Number(u)-Number(i.getScalar(h(f))))===(T=Number(i.getScalar(h(m)))-Number(u))?P:S<T?f:m,this.getClosestPoint(t,r,a,h,e)},N.prototype.getColorArr=function(t,e){return(e||0===e?this.colorArr[e]:this.colorArr)[t]},N.prototype.getColorData=function(){return this.colorDataInfo},N.prototype.getAllCols=function(){return _.union(this.yAxes,this.disabledColumns)},N.prototype.getFillToLayerData=function(){return this.renderer?this.renderer.convertFillToLayerData():[]},N.prototype.getFillType=function(){return"Line"===this.propertyCache[N.PROP_TYPE]?this.propertyCache[N.PROP_FILL]:""},N.prototype.getId=function(){return this.uid},N.prototype.getLayerName=function(){return this.api.getProperty(this.indexProp("Name"))},N.prototype.getLayerType=function(){return this.propertyCache[N.PROP_TYPE]},N.prototype.hasColorData=function(){var t=this.api.getProperty(this.indexProp(N.PROP_COLORDATA));return!this.isCandlestick()&&t&&"None"!==t},N.prototype.hasPadding=function(){return"Line"!==this.propertyCache[N.PROP_TYPE]},N.prototype.hasTexture=function(){return!(!this.icon||!this.texture)},N.prototype.isBubble=function(){return"Bubble"===this.api.getProperty(this.indexProp(N.PROP_TYPE))},N.prototype.isCandlestick=function(){return"Candlestick"===this.api.getProperty(this.indexProp(N.PROP_TYPE))},N.prototype.isEnabled=function(){return!0===this.api.getProperty(this.indexProp(N.PROP_ENABLED))},N.prototype.hasFixedWidth=function(){var t=this.api.getProperty(this.indexProp(N.PROP_TYPE)),e=this.api.getProperty(this.indexProp(N.PROP_BARWIDTHTYPE));return"Bar"===t&&"Fixed Width"===e},N.prototype.updateLayerPalette=function(t,e){this.palette=t;var t=!1,i=(this.hasColorData()&&this.cols&&(i=this.propertyCache[N.PROP_COLORDATA],i=this.calculateColorData(i),this.setColorData(i),t=!0),this.propertyCache[N.PROP_HIGHLIGHTRULES]),i=(i&&i.length&&(this.onHighlightRuleChange(i),t=!0),this.propertyCache[N.PROP_FILL]);i&&"No Fill"!==i&&(t=!0),e&&t&&this.configure()},N.prototype.getRowData=function(e){if(!this.cols)return null;var i=this.cols,n={};return _.each(_.keys(i),function(t){n[t]=i[t].getValue(e),n[t]&&"object"==typeof n[t]&&!C.Tools.isKDBTemporal(n[t])&&(n[t]=w.getValueFromObject(n[t]))}),n},N.prototype.getColumnKeysFromAxisString=function(t){var e,i=/\/[gimsuy]*$/,n="",r=(0===t.indexOf("/")?(e=t.substring(1).replace(i,""),n=(i=t.match(i))?i[0].substring(1):""):e="^"+(t=t.replace(/[\-\[\]\/\{\}\(\)\+\?\.\\\^\$\|]/g,"\\$&")).replace(/\*/g,"(.*)")+"$",new RegExp(e,n));return this.scalarColumns.filter(function(t){return t.match(r)})},N.prototype.getDataRangeX=function(){var t,e;return this.cols&&this.hasData()?(e=(t=this.cols[this.api.getProperty(this.indexProp(N.PROP_XAXIS))]).length?t.calcRange():[0,1],w.convertVec2ToJsScalar(new b(e[0],e[1]),t.qtype,t.qtype)):new b(0,1)},N.prototype.getDataRangeY=function(){var e,t;return this.cols&&this.hasData()?(t=_.difference(this.yAxes,this.disabledColumns),e=this.cols,t=t.map(function(t){return e[t]}).filter(function(t){return t}).map(function(t){var e=t.calcRange();return w.convertVec2ToJsScalar(new b(e[0],e[1]),t.qtype,t.qtype)}),w.mergeRange(t)||new b(0,1)):new b(0,1)},N.prototype.getPaddedRange=function(t,e){var i,n,r,o,a=t.applyFn(f.isMoment),s=t.applyFn(f.isDuration),l=t.applyFn(w.convertJSToNumber),h=this.propertyCache[N.PROP_TYPE],u="Bar"===h,c=l.x,p=l.z,d=l.y,y=l.w;return l.y===l.w&&(y+=r=.01*d,d-=r),l.x===l.z&&(p+=r=.01*c,c-=r),u||this.isCandlestick()?(i=(null==(r=this.renderer)?void 0:r.getBarWidth())||0,r=(y-d)*N.BAR_MIN_RELATIVE_SZ,n=u&&0<y&&0<d?Math.max(0,d-r):d,u=u&&y<0?Math.min(0,y+r):y,l=new S(c-i,n,p+i,u)):"Bubble"===h&&(r=this.propertyCache[N.PROP_RADIUS_DATA],i=n=Number(this.propertyCache[N.PROP_RADIUS_SCALE])/2,o=u=0,"Fixed Size"!==r&&this.cols&&(r=(r=this.cols[r]).length?r.calcRange():[0,1],i=n*Number(r[1])),n=i/e.x,r=i/e.y,l=new S(c-(u=n*(p-c)),d-(o=r*(y-d)),p+u,y+o)),"Line"!==h?(["x","y","z","w"].forEach(function(t){a[t]?l[t]=f(l[t]):s[t]&&(l[t]=f.duration(l[t]))}),l):t},N.prototype.getPaletteProperty=function(){return this.api.getProperty(this.indexProp(N.PROP_PALETTE)).map(function(t){return"object"==typeof t.type&&t.type.attributes?t.type.attributes.value:t.type})},N.prototype.hasData=function(){if(this.datasource){var t=this.datasource.attributes,e=t.queryStatus;if(t.error)return!1;if(e){if("Loading"===e.type)return!1;if("NoResults"===e.type)return}return!0}},N.prototype.hasNoResults=function(){var t;return!!this.datasource&&"NoResults"===(null==(t=this.datasource.get("queryStatus"))?void 0:t.type)},N.prototype.indexProp=function(t){return N.PROP_PREFIX+this.index+"."+t},N.prototype.isRegexOrWild=function(){return w.isRegexOrWild(this.api.getProperty(this.indexProp(N.PROP_YAXIS)))},N.prototype.onData=function(t,i,e){this.renderState=M.Loaded,e&&this.appInvalidate(this.renderState);var e=_.find(this.cols,function(t,e){return!i.cols||t!==i.cols[e]}),t=(this.cols=_.clone(i.cols),_.filter(t.columns.collection.models,function(t){t=Number(t.get("kdbType"));return 3<t&&t<11||11<t&&t<20}).map(function(t){return t.id})),n=!_.isEqual(t,this.scalarColumns);if(e||n){this.scalarColumns=t,this.updateWildcardLayers(!1,!0);try{this.setIgnoreSettings(!0),this.api.setProperty(this.indexProp("possibleXColumns"),this.scalarColumns),this.api.setProperty(this.indexProp("possibleYColumns"),["*"].concat(this.scalarColumns)),this.api.setProperty(this.indexProp("possibleColorColumns"),["None"].concat(this.cols?Object.keys(this.cols):[]));var r,o,a=this.api.getProperty(this.indexProp(N.PROP_COLORDATA)),s=(!a||i.cols&&!i.cols[a]?(this.api.setProperty(this.indexProp(N.PROP_COLORDATA),"None"),this.colorData=[],this.colorDataArr=[]):this.hasColorData()&&this.cols&&(r=this.calculateColorData(a),this.setColorData(r)),this.propertyCache[N.PROP_HIGHLIGHTRULES]||this.api.getProperty(this.indexProp(N.PROP_HIGHLIGHTRULES))),l=s&&s.length,h=(l&&(o=this.cols?Object.keys(this.cols):[],this.api.setProperty(this.indexProp("possibleRulesColumns"),o),this.onHighlightRuleChange(s)),this.propertyCache[N.PROP_FILL]),u=this.propertyCache[N.PROP_FADE],c=(h&&"No Fill"!==h&&(u||l)&&this.onLineFillChange(s),this.indexProp(N.PROP_XAXIS)),p=this.api.getProperty(c),d=((i.cols&&!i.cols[p]||!p)&&this.scalarColumns[0]&&this.api.setProperty(c,this.scalarColumns[0]),this.indexProp(N.PROP_YAXIS)),y=this.api.getProperty(d);this.isCandlestick()?(this.setCandlestickProperties(),y&&this.api.setProperty(d,void 0)):(!i.cols||i.cols[y]||this.isRegexOrWild())&&y||!this.scalarColumns[1]||(this.api.setProperty(d,"*"),this.setColorProperties())}catch(t){}this.setIgnoreSettings(!1),this.configure()}else this.config?this.onConfigComplete():this.appInvalidate(this.renderState)},N.prototype.onResize=function(){this.renderState=M.Process},N.prototype.onSettingsChange=function(t){var e=[N.PROP_TYPE,N.PROP_XAXIS,N.PROP_YAXIS,N.PROP_BARWIDTHTYPE,N.PROP_BARPERCENT,N.PROP_BARFIXED,N.PROP_FILL,N.PROP_FADE,N.PROP_RADIUS_DATA,N.PROP_RADIUS_SCALE,N.PROP_COLORDATA,N.PROP_HIGHLIGHTRULES],i=t[N.PROP_DATA],i=(void 0!==i&&i!==this.datasource&&(this.propertyCache[N.PROP_DATA]=i,this.onDataSourceChange(i)),t[N.PROP_COLOR]),i=(""!==i&&i||this.setColorProperties(),t[N.PROP_HIGHLIGHTRULES]),n=i&&i.length,r=(i&&!i.length&&this.highlightRules&&this.highlightRules.length&&(this.highlightRules=void 0),n&&this.cols&&e.push(N.PROP_COLOR,N.PROP_OPACITY),this.hasColorData()&&this.cols?e.push(N.PROP_OPACITY):(this.colorData=[],this.colorDataArr=[]),t[N.PROP_ICON]),r=(void 0!==r&&r!==this.icon&&(this.propertyCache[N.PROP_ICON]=r,this.onIconChange(r)),this.isCandlestick()&&e.push(N.PROP_OPEN,N.PROP_HIGH,N.PROP_LOW,N.PROP_CLOSE,N.PROP_BEARCOLOR,N.PROP_BULLCOLOR,N.PROP_NEUTRALCOLOR,N.PROP_CANDLEWIDTHTYPE,N.PROP_CANDLEPERCENT,N.PROP_CANDLEFIXED,N.PROP_OPACITY),t[N.PROP_ENABLED]),r=(r!==this.propertyCache[N.PROP_ENABLED]&&(this.propertyCache[N.PROP_ENABLED]=r,this.invalidate(M.Process)),t[N.PROP_FADE]),o=t[N.PROP_FILL];this.cols&&o&&"No Fill"!==o&&(r||n?this.onLineFillChange(i):this.lineFillColors=void 0,e.push(N.PROP_FILLCOLOR,N.PROP_FILLOPACITY)),this.configureIfDiff(t,e),this.invalidateIfDiff(t,N.PROP_COLOR,M.Uniforms),this.invalidateIfDiff(t,N.PROP_WICKCOLOR,M.Uniforms),this.invalidateIfDiff(t,N.PROP_OPACITY,M.Uniforms),this.invalidateIfDiff(t,N.PROP_FILLCOLOR,M.Uniforms),this.invalidateIfDiff(t,N.PROP_FILLOPACITY,M.Uniforms)},N.prototype.processData=function(t,e,i){var n,r,o,a,s,l,h,u,c,p=this;this.renderState===M.Process&&this.config&&(n=(r=this.config).xCol,r=r.yCols,n&&n.length&&(this.renderer&&this.renderer.remove(t),this.rendererFill&&this.rendererFill.remove(t),this.propertyCache[N.PROP_ICON]&&this.image&&this.image.height&&(this.texture=L.createTexture(t,this.image,this.index)),a=[],this.isCandlestick()&&(s=this.api.getProperty(this.indexProp(N.PROP_BEARCOLOR)),l=this.api.getProperty(this.indexProp(N.PROP_BULLCOLOR)),h=this.api.getProperty(this.indexProp(N.PROP_NEUTRALCOLOR)),o=this.api.getProperty(this.indexProp(N.PROP_CANDLEWIDTHTYPE)),u=this.api.getProperty(this.indexProp(N.PROP_CANDLEPERCENT))/100,c=this.api.getProperty(this.indexProp(N.PROP_CANDLEFIXED)),a=[s,l,h,"Percentage"===o?u:c,this.api.getProperty(this.indexProp(N.PROP_OPACITY)),o]),s=this.propertyCache[N.PROP_TYPE]||this.api.getProperty(this.indexProp(N.PROP_TYPE)),l=null!==this.texture,this.renderer=this.config.createRenderer(t,this.isWebGL2,l,a,this.colorData,void 0,"Bar"===s||this.isCandlestick()?i:void 0,!this.hasFixedWidth()&&!this.isCandlestick()||null==e?void 0:e.x)),h="Line"===this.propertyCache[N.PROP_TYPE],u=this.propertyCache[N.PROP_FILL],h&&"No Fill"!==u||(this.renderState=M.Uniforms),this.workerIndex=[],!n.hasIndex()&&r.length?(this.worker||(c=requirejs.toUrl("ChartGL").slice(0,-4)+"worker.js",this.worker=new Worker(c),this.worker.onmessage=function(t){"ready"!==t.data||p.workerQueued?(p.workerIndex=t.data,p.invalidate(M.Tooltip)):(p.workerQueued=!0,window.requestAnimationFrame(function(){var t;p.Config&&p.Config.xCol&&(t=p.Config.xCol,p.workerQueued=!1,p.worker&&p.worker.postMessage([t.qtype,t.toTypedArray()]))}))},this.worker.onerror=function(t){return C.Log.Error(t)}),n&&r.length&&this.worker.postMessage("queue")):this.worker&&(this.worker.terminate(),this.worker=null))},N.prototype.processLineFillData=function(t,e){var i,n;this.config&&(n=this.api.getProperty(this.indexProp(N.PROP_COLORDATA)),i=[],this.hasColorData()&&this.cols&&(n=this.calculateColorData(n),i=this.setColorData(n,!0)),n=null!==this.texture,this.rendererFill=this.config.createRenderer(t,this.isWebGL2,n,[],i,[e,this.propertyCache[N.PROP_FADE]])),this.renderState=M.Uniforms},N.prototype.remove=function(t,e){e&&(this.renderer&&this.renderer.remove(t),this.texture&&t.deleteTexture(this.texture)),this.datasource&&(this.datasource.unsubscribe(this.subId),this.datasource.off("change:queryStatus",this.datasourceStatusFn)),this.renderer&&this.renderer.remove(t),this.rendererFill&&this.rendererFill.remove(t),this.texture&&(t.deleteTexture(this.texture),this.texture=null),this.worker&&this.worker.terminate()},N.prototype.render=function(t,e,i,n){var r=this.propertyCache[n?N.PROP_FILL:N.PROP_TYPE],o=this.propertyCache[N.PROP_WICKCOLOR],a=this.propertyCache[n?N.PROP_FILLCOLOR:N.PROP_COLOR],s=this.propertyCache[N.PROP_RADIUS_DATA],l=this.propertyCache[n?N.PROP_FILLOPACITY:N.PROP_OPACITY],h=this.texture?1.333*Number(this.propertyCache[N.PROP_RADIUS_SCALE]):Number(this.propertyCache[N.PROP_RADIUS_SCALE]),u=h*(h*(2-i)),s=(i&&"Bubble"===r&&"Fixed Size"!==s&&null!=(s=this.renderer)&&s.updatePointSizeOnZoom(i,t),n?this.rendererFill:this.renderer);s&&s.render(t,e,this.isRegexOrWild()?this.palette:this.isCandlestick()?[o]:[a],i&&h<=u?u:h,r,l,this.texture?this.index:void 0)},N.prototype.getDataSource=function(){return this.datasource},N.prototype.updateAxisId=function(t,i){var n=[],t=(_.each(t,function(t,e){n.push(i+"-Axis "+(e+1))}),this.api.setProperty(this.indexProp("possible"+i+"Axes"),n),this.api.getProperty(this.indexProp(i+"AxisId")));n.length&&-1===n.indexOf(t)&&this.api.setProperty(this.indexProp(i+"AxisId"),i+"-Axis 1")},N.prototype.updateColumns=function(t,e){this.disabledColumns=t,e||this.configure()},N.prototype.updateLayer=function(t,e,i){var n=this;this.api.setProperty(this.indexProp(N.PROP_DATA),t),_.each(e,function(t,e){n.api.setProperty(n.indexProp(i[e]),t)})},N.prototype.wildcardDataChanged=function(t){return this.isRegexOrWild()&&this.propertyCache[N.PROP_DATA]!==t},N.prototype.calculateColorData=function(t){var e=[];if(this.cols&&this.cols[t]){for(var i,n=this.cols,r=[],o=[],a=function(t){return null===t?null:C.Tools.isKDBTemporal(t)?C.Tools.convertKDBTemporalToMoment(t).toDashString():w.getValueFromObject(t)},s=0,l=0;l<n[t].length;l++)"object"==typeof(h=n[t].getValue(l))&&(h=a(h)),-1===r.indexOf(h)&&(r.push(h),i=this.getPaletteProperty(),o.push(i[s%i.length]),s++);this.colorDataInfo=[r,o];for(var h,l=0;l<n[t].length;l++)"object"==typeof(h=n[t].getValue(l))&&(h=a(h)),e.push(o[r.indexOf(h)])}else this.colorDataInfo=[[],[]],this.colorData=[],this.colorDataArr=[];return e},N.prototype.configure=function(){var e=this;if(this.config=null,this.cols){var i=this.cols,n=this.indexProp(N.PROP_XAXIS),n=this.api.getProperty(n),r=this.indexProp(N.PROP_YAXIS),r=this.api.getProperty(r),o=this.cols[n],a=(this.isCandlestick()||r||(this.setIgnoreSettings(!0),this.api.setProperty(this.indexProp(N.PROP_YAXIS),"*"),this.setIgnoreSettings(!1)),this.isRegexOrWild()?this.getColumnKeysFromAxisString(r):[r]);if(r&&-1!==r.indexOf("*")&&(s=_.maxBy(_.values(_.groupBy(a,function(t){return i[t].qtype})),function(t){return t.length}),a=_.without(s,n)),this.isRegexOrWild()&&-1===r.indexOf("*")){var s=_.keys(_.groupBy(a,function(t){return i[t].qtype})),l=[A.Byte,A.Short,A.Int,A.Long,A.Double,A.Float,A.Char],h=[A.Timestamp,A.Month,A.Date,A.DateTime,A.Timespan,A.Minute,A.Second,A.Time];if(s.some(function(t){return 0<=h.indexOf(Number(t))})&&s.some(function(t){return 0<=l.indexOf(Number(t))}))return void this.api.showErrorMessage({error:t("Can't mix date types with number types on ")+"<b>"+t("Properties > Layer > Y-Axis Data")+"</b>",type:"Error"})}this.isCandlestick()&&(this.setCandlestickProperties(),a=[N.PROP_OPEN,N.PROP_HIGH,N.PROP_LOW,N.PROP_CLOSE].map(function(t){return e.api.getProperty(e.indexProp(t))})),_.isEqual(this.yAxes,a)||(this.disabledColumns=[]),this.yAxes=a;var n=_.difference(a,this.disabledColumns),r=(this.setColorProperties(),this.setIgnoreSettings(!0),this.propertyCache[N.PROP_TYPE]),s=["Fixed Size"].concat(this.scalarColumns),a=this.api.getProperty(this.indexProp("possibleRadiusData")),a=("Bubble"!==r||_.isEqual(s,a)||this.api.setProperty(this.indexProp("possibleRadiusData"),s),"Line"===r&&this.setLineFillProperties(),this.setIgnoreSettings(!1),n.map(function(t){return i[t]})),s=this.api.getProperty(this.indexProp(N.PROP_BARWIDTHTYPE)),r=this.api.getProperty(this.indexProp(N.PROP_BARPERCENT))/100,u=this.api.getProperty(this.indexProp(N.PROP_BARFIXED)),r="Percentage"===s?r:u,u=this.api.getProperty(this.indexProp(N.PROP_RADIUS_DATA)),c=this.api.getProperty(this.indexProp(N.PROP_RADIUS_SCALE)),u="Fixed Size"===u?"":this.cols[u];o&&a&&a.length&&(this.config=new Rt(o,a,n,r,s,[u,c],this.highlightRules,this.lineFillColors),this.onConfigComplete())}},N.prototype.configureIfDiff=function(i,t){var n=this,r=!1,e=this.propertyCache[N.PROP_HIGHLIGHTRULES],o=e&&e.length,a=this.propertyCache[N.PROP_COLORDATA],s=!1,l=!1;t.forEach(function(t){var e=i.hasOwnProperty(t)&&!n.propertyCache.hasOwnProperty(t)||!_.isEqual(i[t],n.propertyCache[t]);!e||"Opacity"!==t&&"Color"!==t&&"YAxis"!==t&&"ColorData"!==t&&"HighlightRules"!==t||(o&&(l=!0),a&&(s=!0)),e&&(r=r||e,n.propertyCache[t]=i[t])}),s&&(e=this.api.getProperty(this.indexProp(N.PROP_COLORDATA)),this.hasColorData()&&(t=this.calculateColorData(e),this.setColorData(t))),l&&this.onHighlightRuleChange(this.propertyCache[N.PROP_HIGHLIGHTRULES]),r&&this.configure()},N.prototype.getAllWildcards=function(t,e,i,n){t=n(t);for(var r=i.getPoint(t),o=[],a=1;a<r.length;a++)o.push([t,w.calculateRelativePoint(new b(r[0],r[a]),e),i.yColNames[a-1],a-1]);return o},N.prototype.getClosestPoint=function(t,e,i,n,r){for(var o=1,a=(t=n(t),i.getPoint(t)),s=Math.abs(r-w.calculateRelativeValue(a[1],e.y,e.w)),l=2;l<a.length;l++){var h=w.calculateRelativeValue(a[l],e.y,e.w),h=Math.abs(h-r);(h<s||isNaN(Number(a[o])))&&(s=h,o=l)}return[t,w.calculateRelativePoint(new b(a[0],a[o]),e),i.yColNames[o-1],o-1]},N.prototype.getClosestXPoint=function(i,n,e,r,o){var a=i[0],t=i.map(function(t){return e.getPoint(r(t))[0]}),s=Math.abs(o-w.calculateRelativeValue(t[0],n.x,n.z));return _.each(t,function(t,e){"number"!=typeof t&&"bigint"!=typeof t||(t=w.calculateRelativeValue(t,n.x,n.z),(t=Math.abs(t-o))<s&&(s=t,a=i[e]))}),a},N.prototype.getY=function(i,n,e,r,o){var a,s,l,h=i[0],u=[];if(_.each(i,function(t){t=r(t),(a=e.getPoint(t))&&(2<a.length?u.push(a.slice(1)):u.push(a[1]))}),!u.length)return null;var t=(2<a.length?u[0]:u)[0],c=Math.abs(o-w.calculateRelativeValue(t,n.y,n.w));return _.each(u,function(t,e){2<a.length&&Array.isArray(t)?_.each(t,function(t){s=w.calculateRelativeValue(t,n.y,n.w),(l=Math.abs(s-o))<c&&(c=l,h=i[e])}):"number"!=typeof t&&"bigint"!=typeof t||(s=w.calculateRelativeValue(t,n.y,n.w),(l=Math.abs(s-o))<c&&(c=l,h=i[e]))}),h},N.prototype.invalidate=function(t){t<this.renderState&&(this.renderState=t),this.appInvalidate(this.renderState)},N.prototype.invalidateIfDiff=function(t,e,i){void 0!==t[e]&&t[e]!==this.propertyCache[e]&&(this.propertyCache[e]=t[e],this.invalidate(i))},N.prototype.onDataSourceChange=function(t){var i=this;this.datasource&&(this.datasource.unsubscribe(this.subId),this.datasource.off("change:queryStatus",this.datasourceStatusFn)),this.datasource=t,this.datasource?(this.cols=void 0,this.scalarColumns=[],this.renderState=M.Data,this.datasource.subscribe(this.subId,this,!0),this.datasourceStatusFn=function(t,e){e&&"Loading"===e.type&&i.invalidate(M.Data)},this.datasource.on("change:queryStatus",this.datasourceStatusFn)):this.renderState=M.Init,this.appInvalidate(this.renderState)},N.prototype.onConfigComplete=function(){this.renderState=M.Process,this.appInvalidate(this.renderState)},N.prototype.onLineFillChange=function(t){var e=this,i=this.api.getProperty(this.indexProp(N.PROP_FILL)),n=this.api.getProperty(this.indexProp(N.PROP_FADE)),r=this.api.getProperty(this.indexProp(N.PROP_FILLCOLOR)),o=this.api.getProperty(this.indexProp(N.PROP_FILLOPACITY)),a=this.api.getProperty(this.indexProp(N.PROP_YAXIS)),s=new Ot,r=this.isRegexOrWild()?this.palette.length?this.palette:this.getPaletteProperty():r,l=this.getColumnKeysFromAxisString(a),h={},t=(_.keys(this.cols).forEach(function(t){-1!==l.indexOf(t)&&e.cols&&(h[t]=e.cols[t])}),s.computeHighlightRules(t,r,this.propertyCache[N.PROP_XAXIS],a,this.cols,h,n,r,this.colorDataArr));this.lineFillColors=s.getColorArray(t,0,i&&"No Fill"!==i,o)},N.prototype.onHighlightRuleChange=function(t){var e=this,i=this.api.getProperty(this.indexProp(N.PROP_YAXIS)),n=this.api.getProperty(this.indexProp(N.PROP_COLOR)),r=this.api.getProperty(this.indexProp(N.PROP_OPACITY)),o=new Ot,a=this.getColumnKeysFromAxisString(i),s={},t=(_.keys(this.cols).forEach(function(t){-1!==a.indexOf(t)&&e.cols&&(s[t]=e.cols[t])}),o.computeHighlightRules(t,this.isRegexOrWild()?this.palette.length?this.palette:this.getPaletteProperty():n,this.api.getProperty(this.indexProp(N.PROP_XAXIS)),i,this.cols,s,!1,"",this.colorDataArr)),n=this.cols?Object.keys(this.cols):[];this.api.setProperty(this.indexProp("possibleRulesColumns"),n),this.highlightRules=o.getColorArray(t,r),this.isRegexOrWild()?this.colorArr=t:this.colorArr=Array.prototype.concat.apply([],t)},N.prototype.onIconChange=function(t){var e,i=this;if(!(this.icon=t))return this.texture=null,void this.invalidate(M.Process);if(0===t.indexOf("fa-"))e=requirejs.toUrl("QuickBase").replace(/main$/,"")+"images/white/"+t.replace(/^fa-/,"")+".png";else{if(0!==t.indexOf("data:image/"))throw Error("Unsupported icon scheme!");e=t}this.image||(this.image=document.createElement("img")),this.el.append(this.image),this.image.height=1,this.image.style.visibility="hidden",this.image.src=e,this.image.onload=function(){i.image&&i.el.removeChild(i.image),i.invalidate(M.Process)}},N.prototype.setCandlestickProperties=function(){var n=this,r=this.scalarColumns,o=this.api.getProperty(this.indexProp(N.PROP_XAXIS)),t=[N.PROP_OPEN,N.PROP_HIGH,N.PROP_LOW,N.PROP_CLOSE],a=[N.PROP_YAXIS,N.PROP_COLORDATA,N.PROP_COLOR];this.setIgnoreSettings(!0),t.forEach(function(t,e){var i=n.indexProp(t);n.api.getProperty(i)||n.api.setProperty(i,-1!==r.indexOf(t)?t:o),a[e]&&(i=n.indexProp(a[e]),n.api.getProperty(i)&&n.api.setProperty(i,void 0))}),this.setIgnoreSettings(!1)},N.prototype.setColorData=function(e,t){var i=[],n=t?this.propertyCache[N.PROP_FILLOPACITY]:this.propertyCache[N.PROP_OPACITY],r=(_.each(e,function(t){t=xt.hexColorToVec4(t,n);i.push(Object.values(t))}),this.api.getProperty(this.indexProp(N.PROP_XAXIS))),r=this.yAxes.length?this.yAxes:_.without(this.scalarColumns,r),r=(this.colorDataArr=this.isRegexOrWild()?r.map(function(t){return e}):e,this.isRegexOrWild()?r.map(function(t){return i}):[i]);return t||(this.colorArr=this.colorDataArr,this.colorData=r),r},N.prototype.setColorProperties=function(){this.setIgnoreSettings(!0);var t=this.indexProp(N.PROP_COLOR),e=this.api.getProperty(t);this.isRegexOrWild()||this.isCandlestick()?(void 0!==e&&(this.colorCache=e),this.api.setProperty(t,void 0)):void 0!==e&&""!==e||this.api.setProperty(t,this.colorCache||z.COLOR_DEFAULT),this.setIgnoreSettings(!1)},N.prototype.setLineFillProperties=function(){var t=this.api.getProperty(this.indexProp(N.PROP_FILLCOLOR)),e=this.api.getProperty(this.indexProp(N.PROP_FILLOPACITY)),i=this.api.getProperty(this.indexProp(N.PROP_FADE));"No Fill"===this.api.getProperty(this.indexProp(N.PROP_FILL))?(this.fillCache=[t||this.fillCache[0],e||this.fillCache[1],i||this.fillCache[2]],this.api.setProperty(this.indexProp(N.PROP_FILLCOLOR),void 0),this.api.setProperty(this.indexProp(N.PROP_FILLOPACITY),void 0),this.api.setProperty(this.indexProp(N.PROP_FADE),void 0)):(void 0===t&&this.api.setProperty(this.indexProp(N.PROP_FILLCOLOR),this.fillCache[0]||this.propertyCache[N.PROP_COLOR]),void 0===e&&this.api.setProperty(this.indexProp(N.PROP_FILLOPACITY),this.fillCache[1]||80),void 0===i&&this.api.setProperty(this.indexProp(N.PROP_FADE),this.fillCache[2]||!1))},N.PROP_DATA="Data",N.PROP_TYPE="_Type",N.PROP_XAXIS="XAxis",N.PROP_YAXIS="YAxis",N.PROP_COLOR="Color",N.PROP_BARPERCENT="BarWidth",N.PROP_BARFIXED="BarFixedWidth",N.PROP_BARWIDTHTYPE="BarWidthType",N.PROP_BEARCOLOR="CandlestickFormat.BearColor",N.PROP_CANDLEPERCENT="CandlestickFormat.BarWidth",N.PROP_CANDLEFIXED="CandlestickFormat.BarFixedWidth",N.PROP_CANDLEWIDTHTYPE="CandlestickFormat.BarWidthType",N.PROP_BULLCOLOR="CandlestickFormat.BullColor",N.PROP_NEUTRALCOLOR="CandlestickFormat.NeutralColor",N.PROP_FILL="Fill",N.PROP_FILLCOLOR="FillColor",N.PROP_FILLOPACITY="FillOpacity",N.PROP_ICON="Icon",N.PROP_PALETTE="Palette",N.PROP_WICKCOLOR="CandlestickFormat.WickColor",N.PROP_ACTIONS="Actions",N.PROP_HIGHLIGHTRULES="HighlightRules",N.PROP_XAXISID="XAxisId",N.PROP_YAXISID="YAxisId",N.BAR_MIN_RELATIVE_SZ=.02,N.PROP_COLORDATA="ColorData",N.PROP_ENABLED="Enabled",N.PROP_FADE="FadeToTransparent",N.PROP_OPACITY="Opacity",N.PROP_PREFIX="Layers.",N.PROP_RADIUS_SCALE="RadiusScaling",N.PROP_RADIUS_DATA="RadiusData",N.PROP_OPEN="Open",N.PROP_HIGH="High",N.PROP_LOW="Low",N.PROP_CLOSE="Close";var D=N;function N(t,e,i,n,r,o,a){this.index=t,this.uid=e,this.api=i,this.appInvalidate=n,this.setIgnoreSettings=r,this.el=o,this.updateWildcardLayers=a,this.config=null,this.colorArr=[],this.colorCache=null,this.colorData=[],this.colorDataArr=[],this.colorDataInfo=null,this.datasource=null,this.disabledColumns=[],this.fillCache=[],this.icon="",this.image=null,this.isWebGL2="undefined"!=typeof WebGL2RenderingContext,this.palette=[],this.points=[],this.propertyCache={},this.renderer=null,this.rendererFill=null,this.texture=null,this.subId=_.uniqueId("glLayer"),this.renderState=M.Init,this.scalarColumns=[],this.workerIndex=[],this.worker=null,this.workerQueued=!1,this.yAxes=[]}F.easeInQuad=function(t){return Math.pow(t,2)},F.easeOutQuad=function(t){return-(Math.pow(t-1,2)-1)},F.easeInOutQuad=function(t){return(t/=.5)<1?.5*Math.pow(t,2):-.5*((t-=2)*t-2)},F.easeInCubic=function(t){return Math.pow(t,3)},F.easeOutCubic=function(t){return Math.pow(t-1,3)+1},F.easeInOutCubic=function(t){return(t/=.5)<1?.5*Math.pow(t,3):.5*(Math.pow(t-2,3)+2)},F.easeInQuart=function(t){return Math.pow(t,4)},F.easeOutQuart=function(t){return-(Math.pow(t-1,4)-1)},F.easeInOutQuart=function(t){return(t/=.5)<1?.5*Math.pow(t,4):-.5*((t-=2)*Math.pow(t,3)-2)},F.easeInQuint=function(t){return Math.pow(t,5)},F.easeOutQuint=function(t){return Math.pow(t-1,5)+1},F.easeInOutQuint=function(t){return(t/=.5)<1?.5*Math.pow(t,5):.5*(Math.pow(t-2,5)+2)},F.easeInSine=function(t){return 1-Math.cos(t*(Math.PI/2))},F.easeOutSine=function(t){return Math.sin(t*(Math.PI/2))},F.easeInOutSine=function(t){return-.5*(Math.cos(Math.PI*t)-1)},F.easeInExpo=function(t){return 0===t?0:Math.pow(2,10*(t-1))},F.easeOutExpo=function(t){return 1===t?1:1-Math.pow(2,-10*t)},F.easeInOutExpo=function(t){return 0===t?0:1===t?1:(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*--t))},F.easeInCirc=function(t){return-(Math.sqrt(1-t*t)-1)},F.easeOutCirc=function(t){return Math.sqrt(1-Math.pow(t-1,2))},F.easeInOutCirc=function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},F.easeOutBounce=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},F.easeInBack=function(t){return t*t*(2.70158*t-1.70158)},F.easeOutBack=function(t){return(t-=1)*t*(2.70158*t+1.70158)+1},F.easeInOutBack=function(t){var e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},F.elastic=function(t){return-1*Math.pow(4,-8*t)*Math.sin((6*t-1)*(2*Math.PI)/2)+1},F.swingFromTo=function(t){var e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},F.swingFrom=function(t){return t*t*(2.70158*t-1.70158)},F.swingTo=function(t){return--t*t*(2.70158*t+1.70158)+1},F.bounce=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},F.bouncePast=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?2-(7.5625*(t-=1.5/2.75)*t+.75):t<2.5/2.75?2-(7.5625*(t-=2.25/2.75)*t+.9375):2-(7.5625*(t-=2.625/2.75)*t+.984375)},F.easeFromTo=function(t){return(t/=.5)<1?.5*Math.pow(t,4):-.5*((t-=2)*Math.pow(t,3)-2)},F.easeFrom=function(t){return Math.pow(t,4)},F.easeTo=function(t){return Math.pow(t,.25)};var M,St=F;function F(){}function B(t){this.ignoreSettingsChange=!1,this.layers=[],this.isLoading=!1,this.xAxisLayer={},this.yAxisLayer={},this.layerXAxis={},this.layerYAxis={},this.xAxisDataBounds=[],this.yAxisDataBounds=[],this.xAxisViewBounds=[],this.yAxisViewBounds=[],this.activeZoom=new S(0,0,1,1),this.animateZoom=!1,this.selZoom=!1,this.lastXZoom=[],this.lastYZoom=[],this.xAxisZoom=[],this.yAxisZoom=[],this.onXZoom=!1,this.onYZoom=!1,this.zoomTime=0,this.resetZoom=!1,this.activeBounds=[],this.activeXPan=[],this.activeYPan=[],this.expressTime=Date.now()-B.REST_MS,this.overPoint=null,this.size=new b(1,1),this.renderedMargin=new S(0,0,0,0),this.renderedSize=new b(1,1),this.click=!1,this.hover=!1,this.settingsSelected=!1,this.settingsHovered=!1,this.renderState=M.Valid,this.panning=!1,this.options=t,this.api=t.api,this.el=t.el,this.el.className+=" ChartGL",this.uid=_.uniqueId("ChartGL"),this.el.innerHTML=h.app({uid:this.uid}),this.tooltips=new ct(this.api),this.legend=new ft(this.el,this.api,this.tooltips,this.invalidate.bind(this),this.setIgnoreSettings.bind(this),this.updateWildcardLayers.bind(this)),this.axis=new gt(this.api,this.el.getElementsByClassName("axis")[0],this.legend),this.pan=new mt(this.api,this.axis,this.onPan.bind(this)),this.canvas=this.el.getElementsByTagName("canvas")[1],this.image=document.createElement("img"),this.image.style.opacity="0",this.crosshairHover=new pt(this.el,this.api,this.canvas),this.crosshairSelected=new pt(this.el,this.api,this.canvas),this.overlay=new Pt(this.el.getElementsByClassName("overlay")[0],this.onOverlayOver.bind(this),this.onOverlayZoom.bind(this),this.onOverlayReset.bind(this),this.onOverlayClick.bind(this)),w.isWebGLHWAcclEnabled||C.Log.Warn("ChartGL: Hardware Acceleration not enabled"),this.gl=this.canvas.getContext(w.glContext,{premultipliedAlpha:w.isWebGLHWAcclEnabled,preserveDrawingBuffer:!0}),this.gl?(this.setTheme(t.dashboardViewModel.get(B.APP_THEME)),this.onResize(),this.initializeEventListeners()):C.Log.Error("ChartGL: Context Not Initialized")}return(e=M=M||{})[e.Init=0]="Init",e[e.Data=1]="Data",e[e.Loaded=2]="Loaded",e[e.Process=3]="Process",e[e.Legend=4]="Legend",e[e.Axis=5]="Axis",e[e.Uniforms=6]="Uniforms",e[e.Tooltip=7]="Tooltip",e[e.Valid=8]="Valid",B.getNewLayerId=function(t){for(var e=0;t["L"+e];)e++;return"L"+e},B.prototype.onOverlayOver=function(t){var e;(null==t?void 0:t.x)===(null==(e=this.overPoint)?void 0:e.x)&&(null==t?void 0:t.y)===(null==(e=this.overPoint)?void 0:e.y)||(!t&&this.overPoint&&this.api.setProperty(B.PROP_HOVER,""),this.overPoint=t,this.invalidate(M.Tooltip),t&&(this.hover=!0))},B.prototype.onOverlayZoom=function(t){var i=this,n=(C.Log.Log("Region: "+t),new S(t.x,1-t.w,t.z,1-t.y)),t=new b(this.activeZoom.x,this.activeZoom.z),e=new b(this.activeZoom.y,this.activeZoom.w),r=w.calculateCroppedJs2(new b(n.x,n.z),t),o=w.calculateCroppedJs2(new b(n.y,n.w),e);this.onXZoom=!_.isEqual(t,r),this.onYZoom=!_.isEqual(e,o),this.activeZoom=this.activeZoom?w.calculateCroppedBounds(n,this.activeZoom):n,this.zoomTime=Date.now(),this.onXZoom&&this.axis.x.forEach(function(t,e){i.xAxisZoom[e]=i.xAxisZoom[e]?w.calculateCroppedJs2(new b(n.x,n.z),i.xAxisZoom[e]).applyFn(w.convertJSToNumber):new b(i.activeZoom.x,i.activeZoom.z)}),this.onYZoom&&this.axis.y.forEach(function(t,e){return i.yAxisZoom[e]=i.yAxisZoom[e]?w.calculateCroppedJs2(new b(n.y,n.w),i.yAxisZoom[e]).applyFn(w.convertJSToNumber):new b(i.activeZoom.y,i.activeZoom.w)}),this.invalidate(M.Process)},B.prototype.onOverlayReset=function(){var i=this;this.zoomTime=Date.now(),this.activeZoom=new S(0,0,1,1),this.resetZoom=!0,this.activeXPan.forEach(function(t,e){return i.activeXPan[e]=new b(0,1)}),this.activeYPan.forEach(function(t,e){return i.activeYPan[e]=new b(0,1)}),this.setIgnoreSettings(!0),this.axis.x.forEach(function(t,e){return t.setRangeViewstate(null,"Xaxes",e)}),this.axis.y.forEach(function(t,e){return t.setRangeViewstate(null,"Yaxes",e)}),this.setIgnoreSettings(!1),this.getSelectionViewstates(),this.invalidate(M.Process)},B.prototype.onPan=function(t,e,i,n){e&&this.crosshairSelected.onPan(e),"Right"===n||"Left"===n?this.activeXPan[i]=new b(t.x,t.z):this.activeYPan[i]=new b(t.y,t.w),this.invalidate(M.Axis)},B.prototype.onResize=function(){this.size=new b(this.el.offsetWidth,this.el.offsetHeight),this.legend.onResize(),this.axis.onResize();var t=this.layers.filter(function(t){return t.hasFixedWidth()||t.isCandlestick()});_.each(t,function(t){return t.onResize()}),this.invalidate(t.length?M.Process:M.Axis)},B.prototype.onSettingsChange=function(i){var e,n,r,o,a,s,t,l,h=this;this.ignoreSettingsChange||(t=_.find(_.keys(i),function(t){return 0===t.indexOf(B.PROP_SELECT)}),l=_.find(_.keys(i),function(t){return 0===t.indexOf(B.PROP_HOVER)}),(!t&&l||!l&&t)&&(this.settingsSelected=!(!t||this.click),this.settingsHovered=!(!l||this.hover),this.invalidate(M.Tooltip)),i.hasOwnProperty("Layers")||(t=w.expandNestedViewStates(i,this.api),l=w.replaceViewStatesWithValue("",t,this.api),i=l),0<(t=_.filter(_.keys(i),function(t){return-1!==t.indexOf("Layers.")})).length&&(e={},_.each(t,function(t){_.set(e,t,i[t]),delete i[t]}),_.extend(i,e)),i[B.PROP_LAYERS]&&(n=this.api.getProperty(B.PROP_LAYERS),r=!1,o=_.reduce(n,function(t,e){return t[e[B.PROP_LAYER_ID]]=!0,t},{}),_.each(this.layers,function(t){void 0===t||o[t.getId()]||(r=!0,t.remove(h.gl),h.layers.splice(h.layers.indexOf(t),1),h.activeBounds.splice(h.layers.indexOf(t),1))}),_.each(this.layers,function(e){var t=_.findIndex(n,function(t){return t._Id===e.getId()});e.index!==t&&(e.index=t)}),(l=this.layers.find(function(t){var e;if(i&&i.Layers)return e=i.Layers[t.index],t.getLayerType()!==e._Type||t.wildcardDataChanged(e[D.PROP_DATA])||h.layers.length!==i[B.PROP_LAYERS].length}))||this.updateWildcardLayers(),this.drawLayers(i),this.invalidate(this.layers.length?r||l?M.Process:M.Legend:M.Uniforms)),a=_.find(_.keys(i),function(t){return 0===t.indexOf("Xaxes")}),s=_.find(_.keys(i),function(t){return 0===t.indexOf("Yaxes")}),t=this.api.getProperty("Xaxes"),l=this.api.getProperty("Yaxes"),(a||s)&&(a&&_.each(t,function(t,e){return h.axis.onSettingsChange(a,e)}),s&&_.each(l,function(t,e){return h.axis.onSettingsChange(s,e)}),this.selZoom||this.checkRangeViewstatesChanged(t,"Xaxes"),this.selZoom||this.checkRangeViewstatesChanged(l,"Yaxes"),this.selZoom&&(this.getSelectionViewstates(),this.zoomTime=Date.now()),this.invalidate(M.Process)),(t=_.find(_.keys(i),function(t){return 0===t.indexOf(B.PROP_CROSSHAIRS)}))&&!i[t]&&this.crosshairHover.hideCrosshair("hide-both"),(l=_.find(_.keys(i),function(t){return 0===t.indexOf(B.PROP_COORDS)}))&&!i[l]&&this.tooltips.hideCoordinates(this.el))},B.prototype.updateWildcardLayers=function(i,n){var r=this,t=_.filter(this.api.getProperty("Layers"),function(t){return w.isRegexOrWild(t.YAxis)});_.each(t,function(e){var t=_.findIndex(r.layers,function(t){return t.getId()===e._Id});e.Enabled||r.legend.updateWildcards(r.layers[t],t),!0!==e.Enabled||i||r.legend.updateWildcards(r.layers[t],t,"reset",n)}),this.legend.getLayers(this.layers)},B.prototype.remove=function(){var e=this;return this.overlay&&this.overlay.remove(),this.layers.forEach(function(t){return t.remove(e.gl)}),this},B.prototype.setTheme=function(t){"Light"===t?this.el.classList.add("Light"):this.el.classList.remove("Light"),this.axis.updateTheme(t),this.axis.renderAxes(),this.legend.updateTheme(t),this.tooltips.updateTheme(t,this.el),this.theme=t,this.invalidate(M.Legend)},B.prototype.calculateLayerAxisMaps=function(){var n=this;this.xAxisLayer={},this.yAxisLayer={},this.layerXAxis={},this.layerYAxis={},this.layers.forEach(function(t,e){var i=n.api.getProperty(t.indexProp(D.PROP_XAXISID)).replace(/.*?(\d+)$/,"$1"),t=n.api.getProperty(t.indexProp(D.PROP_YAXISID)).replace(/.*?(\d+)$/,"$1");i&&(i=Number(i)-1,void 0===n.xAxisLayer[i]?n.xAxisLayer[i]=[e]:n.xAxisLayer[i].push(e),n.layerXAxis[e]=i),t&&(t=Number(t)-1,void 0===n.yAxisLayer[t]?n.yAxisLayer[t]=[e]:n.yAxisLayer[t].push(e),n.layerYAxis[e]=t)})},B.prototype.checkRangeViewstatesChanged=function(t,o){var a=this;_.each(t,function(t,e){var i=a.api.getPropertyMeta(o+"."+e+O.PROP_SEL_MIN),n=a.api.getPropertyMeta(o+"."+e+O.PROP_SEL_MAX),e=("Xaxes"===o?a.xAxisViewBounds:a.yAxisViewBounds)[e],r=!e&&(i.value||n.value);(i.viewstateType||n.viewstateType)&&(e||r)&&(a.selZoom=!0)})},B.prototype.createDataBounds=function(t,r,o,a){var s=this;return t.map(function(t,e){var i=new b(0,1),n=(o[e]&&(n=o[e].map(function(t){return s.layers[t].isEnabled()&&s.layers[t].hasData()?r[t]:null}).filter(function(t){return t}),i=w.mergeRange(n)||new b(0,1)),_.max(s.getLayerTypes(a?"X":"Y",e)));return s.axis.getBounds(i,a?"Xaxes":"Yaxes",e,n)})},B.prototype.createViewBounds=function(l,h,u,c,t){var p=this;return t.map(function(t,e){var i=new b(0,1),n=new b(0,1),r=c?p.xAxisLayer:p.yAxisLayer;if(!r[e])return[i,n];var o,r=r[e].map(function(t){if(l[t])return c?w.xPart(l[t]):w.yPart(l[t])}).filter(function(t){return t}),i=w.mergeRange(r)||new b(0,1),r=_.max(p.getLayerTypes(c?"X":"Y",e)),a=(p.updateZoomValues(i,e,r,c),(c?p.xAxisZoom:p.yAxisZoom)[e]),a=a?a.applyFn(w.convertJSToNumber):c?new b(p.activeZoom.x,p.activeZoom.z):new b(p.activeZoom.y,p.activeZoom.w),s=a;return h?(o=(c?p.lastXZoom:p.lastYZoom)[e])&&(s=w.scale2(u,o,a)):(p.zoomTime=0,c?p.lastXZoom[e]=_.clone(a):p.lastYZoom[e]=_.clone(a)),n=s.applyFn(w.convertJSToNumber),[w.calculateCroppedJs2(n,i,r),n]})},B.prototype.drawCoordinates=function(t,e,i,n){var r="";e&&("x"===(r=this.overlay.getZoomDirection())?this.tooltips.hideCoordinates(this.el,"y"):"y"===r&&this.tooltips.hideCoordinates(this.el,"x"));var o,a,s,l=this.api.getProperty(B.PROP_SNAP)&&!e,h=!l&&this.overPoint?new b(this.overPoint.x,Math.abs(this.overPoint.y)):new b(t.overpoint.x,1-t.overpoint.y),u=e?0:t.layer.index,u=this.activeBounds[u].applyFn(w.toNumber),c=null,p=null;"y"!==r&&(a=(o=t.layer.XType)?new b(Number(w.convertJSToScalar(o,u.x)),Number(w.convertJSToScalar(o,u.z))):new b(u.x,u.z),s=l?i:(a.y-a.x)*h.x+a.x,c=this.getCoordinateInfo(t,e,s,i,"x")),"x"!==r&&(a=(o=t.layer.YType)?new b(Number(w.convertJSToScalar(o,u.y)),Number(w.convertJSToScalar(o,u.w))):new b(u.y,u.w),s=l?n:(a.x-a.y)*h.y+a.y,p=this.getCoordinateInfo(t,e,s,n,"y")),this.tooltips.drawCoordinates(this.canvas,h,this.renderedMargin,this.el,c,p)},B.prototype.drawLayers=function(a){var s=this,l=this.api.getProperty(B.PROP_LAYERS),h=_.reduce(l,function(t,e){return t[e[B.PROP_LAYER_ID]]=!0,t},{}),i=(_.each(l,function(t,e){var i,n=(t=a.Layers[e]?a.Layers[e]:t)[B.PROP_LAYER_ID],r=(_.isEmpty(n)&&(n=t[B.PROP_LAYER_ID]=B.getNewLayerId(h),h[n]=!0,s.api.setProperty(B.PROP_LAYERS+"."+e+"."+B.PROP_LAYER_ID,n,{silent:!0})),t[B.PROP_LAYER_NAME]),r=(_.isEmpty(r)&&s.api.setProperty(B.PROP_LAYERS+"."+e+"."+B.PROP_LAYER_NAME,"Layer "+(e+1)),_.find(s.layers,function(t){return t.getId()===n})),e=_.findIndex(l,function(t){return t._Id===n}),o=!1;r||(o=!0,r=new D(e,n,s.api,s.invalidate.bind(s),s.setIgnoreSettings.bind(s),s.el,s.updateWildcardLayers.bind(s)),s.layers.push(r)),r.onSettingsChange(t),0<e&&!r.getDataSource()&&o&&(i=e-1,t=[D.PROP_COLOR,D.PROP_XAXISID,D.PROP_YAXISID,D.PROP_TYPE,D.PROP_XAXIS,D.PROP_YAXIS,D.PROP_BARPERCENT,D.PROP_BARFIXED,D.PROP_BARWIDTHTYPE,D.PROP_FILL,D.PROP_FILLCOLOR,D.PROP_FILLOPACITY,D.PROP_BEARCOLOR,D.PROP_BULLCOLOR,D.PROP_NEUTRALCOLOR,D.PROP_WICKCOLOR,D.PROP_CANDLEPERCENT,D.PROP_CANDLEFIXED,D.PROP_CANDLEWIDTHTYPE,D.PROP_PALETTE],o=_.map(t,function(t){return s.api.getProperty("Layers."+i+"."+t)}),r.updateLayer(s.layers[i].getDataSource(),o,t))}),[]),n=(_.each(l,function(e){var t=s.layers[_.findIndex(s.layers,function(t){return t.getId()===e._Id})];t&&i.push(t)}),this.layers=i,this.legend.getLayers(this.layers),this.layers.filter(function(t){return"Line"===s.api.getProperty(t.indexProp(D.PROP_TYPE))}));this.setIgnoreSettings(!0),_.each(n,function(t){var e=s.api.getProperty(t.indexProp("Fill")),i=s.api.getProperty(t.indexProp("possibleLayers"));i&&i.length===n.length+1||(i=_.map(n,function(t){return"Layer "+(t.index+1)}),i=["No Fill","Origin"].concat(_.without(i,"Layer "+(t.index+1))),s.api.setProperty(t.indexProp("possibleLayers"),i),-1===i.indexOf(e)&&s.api.setProperty(t.indexProp("Fill"),"No Fill"))}),this.setIgnoreSettings(!1)},B.prototype.doActions=function(t,n,r){var o,e=this.api.getProperty(t.indexProp(D.PROP_ACTIONS));e.length&&(this.setIgnoreSettings(!0),o=[],e.forEach(function(t,e){var i=n.data[t.Current];"mousemove"===r&&"Hover"!==t.Trigger||"mousemove"!==r&&"Hover"===t.Trigger||o.push(X(X({},t),{Value:i,_PropertyIndex:e}))}),this.api.doActions(o,"Layers."+t.index+".Actions"),this.setIgnoreSettings(!1))},B.prototype.getLayerDataBounds=function(t){return S.fromVec2(this.xAxisDataBounds[this.layerXAxis[t]],this.yAxisDataBounds[this.layerYAxis[t]])},B.prototype.getLayerViewBounds=function(t){return S.fromVec2(this.xAxisViewBounds[this.layerXAxis[t]],this.yAxisViewBounds[this.layerYAxis[t]])},B.prototype.getCoordinateInfo=function(t,e,i,n,r){var o=t.layer.getAxisId(r.toUpperCase()),a="x"===r?"Xaxes.":"Yaxes.",e=e?this.api.getProperty(a+"0.Position"):this.api.getProperty(a+o+".Position"),a=i;return!_.isEqual(i,n)&&C.Tools.isKDBTemporal(n)&&(o=t.layer.index,a=w.convertToJsScalar(this.getLayerType(r,o),i,!0)),{position:e,val:a}},B.prototype.getLayerType=function(t,e){e=this.layers[e];return"y"===t?e.YType:e.XType},B.prototype.getLayerTypes=function(e,i){return this.layers.filter(function(t){return t.getAxisId(e)===i&&t.isEnabled()}).map(function(t){return"X"!==e&&t.YType||t.XType})},B.prototype.getSelectionViewstates=function(){var r=this;this.axis.x.forEach(function(t,e){var i=r.xAxisDataBounds[e]||new b(0,1),n=r.axis.getSelectionZoomBounds(i,"Xaxes",e,_.max(r.getLayerTypes("X",e)));r.xAxisZoom[e]=w.calculateCrop(n,i)}),this.axis.y.forEach(function(t,e){var i=r.yAxisDataBounds[e]||new b(0,1),n=r.axis.getSelectionZoomBounds(i,"Yaxes",e,_.max(r.getLayerTypes("Y",e)));r.yAxisZoom[e]=w.calculateCrop(n,i)})},B.prototype.initializeEventListeners=function(){var e,i=this;this.el.addEventListener("mousedown",function(t){t.target===i.el.getElementsByClassName("axis")[0]&&(i.panning=!0,e=i.pan.onAxisPan(t,i.el.getBoundingClientRect())[1],i.pan.onPointDown(i.pan.onAxisPan(t,i.el.getBoundingClientRect())[0],e))}),document.addEventListener("mouseup",function(){setTimeout(function(){i.panning=!1,document.body.style.cursor="default"},75)}),document.addEventListener("mousemove",function(t){i.panning&&(t=i.pan.onAxisPan(t,i.el.getBoundingClientRect())[0],i.pan.onPanning(t,e,i.xAxisZoom,i.yAxisZoom,i.activeXPan,i.activeYPan,i.el))})},B.prototype.invalidate=function(t){if(t<this.renderState){if((this.renderState=t)===M.Process&&this.expressTime<Date.now()-B.REST_MS&&_.every(this.layers,function(t){return t.RenderState===M.Process}))return this.expressTime=Date.now(),this.validate();window.requestAnimationFrame(this.validate.bind(this))}},B.prototype.onOverlayClick=function(){this.click=!0,this.invalidate(M.Tooltip)},B.prototype.setIgnoreSettings=function(t){this.ignoreSettingsChange=t},B.prototype.setRange=function(t,e,i,n,r){var o=r?new b(this.activeZoom.x,this.activeZoom.z):new b(this.activeZoom.y,this.activeZoom.w),n=n?n.applyFn(w.convertJSToNumber):o,o=w.calculateCroppedJs2(n,e,i);this.setIgnoreSettings(!0),r?this.axis.x[t].setRangeViewstate(o,"Xaxes",t):this.axis.y[t].setRangeViewstate(o,"Yaxes",t),this.setIgnoreSettings(!1)},B.prototype.updateLayerPossibleAxes=function(){var n=this,r=(this.setIgnoreSettings(!0),this.api.getProperty(B.PROP_XAXES)),o=this.api.getProperty(B.PROP_YAXES);_.each(this.layers,function(t,e){var i=n.api.getProperty("Layers."+e+".possibleXAxes"),e=n.api.getProperty("Layers."+e+".possibleYAxes");i.length!==r.length&&t.updateAxisId(r,"X"),e.length!==o.length&&t.updateAxisId(o,"Y")}),this.setIgnoreSettings(!1)},B.prototype.updateZoomValues=function(t,e,i,n){var r=this.axis.getSelectionZoomBounds(t,n?"Xaxes":"Yaxes",e,i);n?(this.selZoom&&(this.xAxisZoom[e]=w.calculateCrop(r,t)),this.onXZoom&&this.setRange(e,t,i,this.xAxisZoom[e],n)):(this.selZoom&&(this.yAxisZoom[e]=w.calculateCrop(r,t)),this.onYZoom&&this.setRange(e,t,i,this.yAxisZoom[e],n))},B.prototype.validate=function(){var o=this;if(!this.api.getProperty("Layers").length)return this.api.showErrorMessage({error:t("To get started, please add a layer from")+" <b> "+t("Properties-Layers")+" </b> ",type:"Warning"}),void this.legend.render();var e=this.layers.filter(function(t){return t.isEnabled()}),i=e.filter(function(t){return t.Config}),n=(this.layers.filter(function(t){return!t.isEnabled()}).length&&!i.length&&(this.renderState=M.Legend),_.some(e,function(t){return t.RenderState===M.Data})),e=e.map(function(t){return t.datasourceError}).filter(function(t){return!!t});if(n&&_.isEmpty(e))this.isLoading||this.api.showQueryStatus({error:"",type:"Loading"}),this.isLoading=!0;else{if(this.layers.every(function(t){return t.isEnabled()&&t.hasNoResults()}))return this.api.showQueryStatus({error:"",type:"NoResults"}),void(this.renderState=M.Valid);e.length&&e[0]?(this.api.showQueryStatus({error:t(e[0].error),type:"Error"}),this.renderState=M.Valid):this.api.hideQueryStatus(),this.isLoading=!1}this.calculateLayerAxisMaps(),this.renderState<=M.Process&&i.length&&(0<this.layers.length&&this.layers.some(function(t){return t.getDataSource()})&&this.api.hideErrorMessage(),n=this.layers.map(function(t){return t.getDataRangeX()}),e=this.layers.map(function(t){return t.getDataRangeY()}),O=this.api.getProperty("Xaxes"),R=this.api.getProperty("Yaxes"),this.xAxisDataBounds=this.createDataBounds(O,n,this.xAxisLayer,!0),this.yAxisDataBounds=this.createDataBounds(R,e,this.yAxisLayer,!1),this.activeXPan=O.map(function(t,e){return o.activeXPan[e]||new b(0,1)}),this.activeYPan=R.map(function(t,e){return o.activeYPan[e]||new b(0,1)}),n=this.layers.filter(function(t){return t.hasFixedWidth()||t.isCandlestick()}),(this.onXZoom||this.onYZoom||this.selZoom)&&!this.resetZoom||_.each(n,function(t){return t.onResize()}),(e=i.filter(function(t){return t.hasData()})).forEach(function(t){t.processData(o.gl,o.size,w.calculateCroppedJsBounds(o.activeZoom,o.getLayerDataBounds(t.index),o.getLayerType("x",t.index),o.getLayerType("y",t.index)))}),e.forEach(function(t){var e,i,n=t.getFillType(),r=-1!==n.indexOf("Layer");t.RenderState!==M.Process||!r&&"Origin"!==n||(i=e=null,r&&(i=Number(n.replace(/.*?(\d+)$/,"$1")||1)-1,e=o.layers[i].getFillToLayerData()),r={fill:n,cols:e,toBounds:null!==i?w.calculateCroppedJsBounds(o.activeZoom,o.getLayerDataBounds(i),o.getLayerType("x",i),o.getLayerType("y",i)):void 0,fromBounds:w.calculateCroppedJsBounds(o.activeZoom,o.getLayerDataBounds(t.index),o.getLayerType("x",t.index),o.getLayerType("y",t.index))},t.processLineFillData(o.gl,r))}),!i.filter(function(t){return t.RenderState>=M.Process}).length&&i.length||(this.renderState=M.Legend),_.some(i,function(t){return!1===t.hasData()})&&(this.renderState=M.Process)),this.renderState===M.Legend&&(this.legend.render(!1),this.axis.onResize(),this.renderState=M.Axis);var r,a=[],s=[];if(this.renderState===M.Axis&&(this.updateLayerPossibleAxes(),n=this.layers.map(function(t){if(!t.isEnabled()||!t.Config)return null;var e=t.index,i=t.getAxisId("X"),n=t.getAxisId("Y"),i=o.activeXPan[i],n=o.activeYPan[n],i=new S(i.x,n.x,i.y,n.y),n=t.getPaddedRange(o.getLayerDataBounds(e),o.size),t=o.getLayerType("x",e),e=o.getLayerType("y",e);return w.calculateCroppedJsBounds(i,n,t,e)}),e=!1,c=0,(this.lastXZoom.length||this.lastYZoom.length)&&(v=Date.now()-this.zoomTime,u=this.api.getProperty(B.PROP_DURATION),c=(0,St[this.api.getProperty(B.PROP_EASING)])(v/u),this.animateZoom=!!(e=v<u)),v=this.api.getProperty("Xaxes"),u=this.createViewBounds(n,e,c,!0,v),this.xAxisViewBounds=u.map(function(t){return t[0]}),a=u.map(function(t){return t[1]}),v=this.api.getProperty("Yaxes"),u=this.createViewBounds(n,e,c,!1,v),this.yAxisViewBounds=u.map(function(t){return t[0]}),s=u.map(function(t){return t[1]}),this.onXZoom=!1,this.onYZoom=!1,this.selZoom=!1,this.setIgnoreSettings(!0),_.values(this.axis.x).forEach(function(t,e){var i=o.getLayerTypes("X",e),e=o.xAxisViewBounds[e]||new b(0,1);t.updateBounds(e,i)}),_.values(this.axis.y).forEach(function(t,e){var i=o.getLayerTypes("Y",e),e=o.yAxisViewBounds[e]||new b(0,1);t.updateBounds(e,i)}),this.setIgnoreSettings(!1),_.first(i.map(function(t){return t.Config}).filter(function(t){return!!t}))&&(n=this.axis.render(this.size.x,this.size.y,this.api.getProperty("Xaxes"),this.api.getProperty("Yaxes")),_.isEqual(n,this.renderedMargin)&&this.size===this.renderedSize||(e=Math.max(this.size.x-n.x-n.z,0),c=Math.max(this.size.y-n.y-n.w,0),this.overlay.resize(n.x,n.y,e,c),this.canvas.style.left=n.x+"px",this.canvas.style.top=n.y+"px",this.canvas.width=e,this.canvas.height=c,this.renderedMargin=_.clone(n),this.renderedSize=this.size),v=a[0]||new b(0,1),this.crosshairSelected.updateSelected(v,this.animateZoom)),this.renderState=M.Uniforms),this.renderState===M.Uniforms&&_.every(i.filter(function(t){return t.hasData()}),function(t){return t.RenderState>=M.Uniforms})&&(w.isWebGLHWAcclEnabled||w.isIE11?this.gl.clearColor(0,0,0,0):"Light"===this.theme?this.gl.clearColor(.973,.973,.973,0):this.gl.clearColor(.157,.157,.157,0),(r=this.gl).clear(r.COLOR_BUFFER_BIT),r.viewport(0,0,r.canvas.width,r.canvas.height),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),_.filter(i,function(t){return t&&t.RenderState===M.Uniforms}).forEach(function(t){var e,i,n;t.hasData()&&(e=0,o.api.getProperty("Layers."+t.index+".ScaleOnZoom")&&(n=o.animateZoom?a:o.lastXZoom,i=o.animateZoom?s:o.lastYZoom,n=n[o.layerXAxis[t.index]]||new b(0,1),i=i[o.layerYAxis[t.index]]||new b(0,1),e=(n=S.fromVec2(n,i)).z-n.x+(n.w-n.y)),i="Line"===o.api.getProperty(t.indexProp("_Type")),n="No Fill"!==o.api.getProperty(t.indexProp("Fill")),i&&n&&t.render(r,o.getLayerViewBounds(t.index),e,!0),t.render(r,o.getLayerViewBounds(t.index),e,!1))}),this.renderState=this.panning||this.animateZoom?M.Axis:M.Tooltip),this.renderState===M.Tooltip){if(this.resetZoom=!1,this.activeBounds=this.layers.map(function(t){return o.getLayerViewBounds(t.index)}),!this.activeBounds.length)return;var l,h,u=this.api.getProperty(B.PROP_HOVER),e=this.api.getProperty(B.PROP_SELECT),c=void 0,e=(null!==this.overPoint||!u&&!e||(l=this.settingsSelected?e:this.settingsHovered?u:"")&&(h=l,(n=_.find(this.xAxisViewBounds,function(t,e){e=_.max(o.getLayerTypes("X",e));return h=w.convertJSToNumber(w.convertStringToJsScalar(l,e)),t=t.applyFn(w.convertJSToNumber),h>=t.x&&h<=t.y}))&&(v=n.applyFn(w.convertJSToNumber),c=new b((h-v.x)/(v.y-v.x),0))),this.api.getProperty(B.PROP_COORDS)),n=this.overlay.isDragging(),p=this.overPoint||c;if(!p||n&&!e)return this.renderState=M.Valid,void(u||(this.tooltips.hideTooltip(),this.tooltips.hideCoordinates(this.el),this.crosshairHover.hideCrosshair(""),this.hover=!1));var d=[],y=[],f=(i.forEach(function(e){var t=e.getClosestPointFromRelativeX(p.x,1+p.y,o.canvas.width,w.convertVec4ToScalar(o.getLayerViewBounds(e.index),o.getLayerType("x",e.index),o.getLayerType("y",e.index)));null!==t&&d.push(new ut(e,t[0],t[1],t[2],t[3])),o.api.getProperty("Overlay.ShowAllPoints")&&(t=e.getAllPointsFromRelativeX(),_.each(t,function(t){_.each(t,function(t){t&&y.push(new ut(e,t[0],t[1],t[2],t[3]))})}))}),null),m=null,g=null,P=p.x,x=1+p.y;if(_.each(d,function(t){var e=Number(t.overpoint.x),i=Number(t.overpoint.y);null===m?(m=Math.abs(P-e),g=Math.abs(x-i),f=t):(e=Math.abs(P-e))<m?(m=e,g=Math.abs(x-i),f=t):e===m&&g&&Math.abs(x-i)<g&&(g=Math.abs(x-i),m=e,f=t)}),f){var v=f.overpoint;if(1<v.x||v.x<0||1<v.y||v.y<0||isNaN(v.x)||isNaN(v.y))return void(this.renderState=M.Valid);c=y.length?y:d,u=this.tooltips.render(this.canvas,f,c,d),i=this.tooltips.returnPointInfo();if(i&&u){var O=this.api.getProperty(f.layer.indexProp(D.PROP_XAXIS)),R=f.yAxis,v=u[O];if(e&&this.drawCoordinates(f,n,v,u[R]),n)return this.crosshairHover.hideCrosshair(""),this.tooltips.hideTooltip(),void(this.renderState=M.Valid);this.hover||!this.click&&!this.settingsSelected?(this.doActions(f.layer,i,"mousemove"),c=!this.api.getProperty(B.PROP_SNAP)&&this.overPoint?new b(this.overPoint.x,1+this.overPoint.y):f.overpoint,this.crosshairHover.render(this.renderedMargin,c,"hover",this.options.dashboardViewModel.get(B.APP_THEME)),this.overPoint&&this.api.getPropertyMeta(B.PROP_HOVER).viewstateType&&(C.Tools.isKDBTemporal(v)&&(v=C.Tools.convertKDBTemporalToMoment(v).toDashString()),this.api.setProperty(B.PROP_HOVER,v))):(this.doActions(f.layer,i,"click"),this.crosshairSelected.render(this.renderedMargin,f.overpoint,"click",this.options.dashboardViewModel.get(B.APP_THEME)),this.click&&this.api.getPropertyMeta(B.PROP_SELECT).viewstateType&&(C.Tools.isKDBTemporal(v)&&(v=C.Tools.convertKDBTemporalToMoment(v).toDashString()),this.api.setProperty(B.PROP_SELECT,v)))}}else this.tooltips.hideTooltip();this.hover=!1,this.click=!1,this.settingsHovered=!1,this.settingsSelected=!1,this.renderState=M.Valid}this.renderState<M.Valid&&window.requestAnimationFrame(this.validate.bind(this))},B.getComponentDefinition=z.getComponentDefinition,B.PROP_COORDS="Overlay.ShowCoordinates",B.PROP_CROSSHAIRS="Overlay.ShowCrosshairs",B.PROP_DURATION="Basics.Duration",B.PROP_HOVER="Basics.Hover",B.PROP_SELECT="Basics.Selected",B.PROP_EASING="Basics.Easing",B.PROP_LAYERS="Layers",B.PROP_LAYER_ID="_Id",B.PROP_LAYER_NAME="Name",B.PROP_SNAP="Overlay.SnapToPoint",B.APP_THEME="DashboardTheme",B.PROP_XAXES="Xaxes",B.PROP_YAXES="Yaxes",B.REST_MS=500,B});