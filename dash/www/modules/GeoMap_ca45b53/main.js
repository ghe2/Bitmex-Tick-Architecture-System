define(["jquery","topojson","d3","Handlebars","QuickBase","backbone","css!./css/app.css"],function(R,E,n,h,p,d){"use strict";var o,e=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),i=(a.getComponentDefinition=function(t){var e={TriggerColumn:{title:"Trigger Column",type:"string",enumSource:"possibleTrack",watch:{possibleTrack:"root.possibleTrack"},default:"",propertyOrder:1},Trigger:{type:"string",enum:["Click","Hover"],default:"Click",title:"Trigger Action",propertyOrder:2}},e={id:46,componentName:"Geo Map",componentDescription:"This element displays Map.",appKey:"GeoMap",css:"GeoMap",listViewThumb:t.websiteUrl+"Images/geomap.png",ghostViewThumb:null,buildViewThumb:null,appArgs:{quickStart:[{path:"MapDetails.MapKey",message:"set Google Maps JavaScript API Key in 'Map Key' Property"}],json:{version:"4.7.1",possibleFloats:["default"],possiblePLatLong:["default"],possibleStrings:["default"],possibleDKeys:["default"],possibleDValues:["default"],possibleGKeys:["default"],possibleDString:["default"],possibleVString:["default"],possibleHFloats:["default"],possibleLFloats:["default"],possibleTrack:["default"],possibleShapes:["default"],possibleColors:["default"],possibleCircle:[],tooltips:"",all:["default"],vall:["default"],overlayall:["default"],overlayGeoJSONKeys:[""],Basics:{ComponentName:"GeoMap",Focus:"",Theme:"Dark"},MapDetails:{Type:"terrain",Zoom:8,CenterX:37.76,CenterY:-122.42,TrackChanges:!0,Bounds:"",CustomMarkers:"",MapKey:"",Style:""},OverLay:{ShowOverlay:!0,Data:"",DataDesc:"US Tourism Data",DataGeo:"USA",DataGeoId:"",DataType:"GeoJSON",DataKey:"",DataValue:"",GeoColumn:"states",Selected:"",ShowLegend:!0,LegendType:"percent",LegendColor:"blue",ColorDB:"",TooltipData:"",Bounds:"",GeoFilter:"",GeoSelected:"",SelectedObjectRouting:[],ImageSrc:"none",ImageNorth:0,ImageSouth:0,ImageEast:0,ImageWest:0,ImageOpacity:30},Voronoi:{Data:"",DataKey:"",DataDesc:"",Longitude:"",Latitude:"",AvgLongitude:"",AvgLatitude:"",LineColor:"#0061FF",DotColor:"#0061FF",ShowScale:!1,Scale:"",Opacity:.2,ScaleColor:"blue"},Points:{Data:"",Selected:"",Tracker:"",TrackedItem:"default",Title:"default",Latitude:"default",Longitude:"default",Shape:"default",ShapeColor:"#0061FF",ShapeCanRotation:!1,ShapeSize:10,ShapeHoverColor:"#0061FF",ShapeSelectedColor:"#0061FF",ShapeColorOpacity:100,ShapeHoverColorOpacity:100,ShapeSelectedColorOpacity:100,ClusterShape:"default",ClusterSize:"default",Cluster:!0,ShowTooltip:!0,TooltipData:"",Zoom:!0,ZoomBase:!1,Center:!0,PointsInView:!1,Actions:"",SelectedObjectRouting:[]},Bounds:[],Heatmap:{Data:"",Gradient:"default",Radius:20,Opacity:100,Show:!0},Lines:{Data:"",Selected:"",Color:"#0061FF",LabelColor:"#ffffff",LabelSize:10,LabelText:"",ShowTooltip:!0,ShowLabel:!0,Geodesic:!0},Circles:{Data:"",StrokeColor:"",StrokeWeight:"",StrokeOpacity:"",FillColor:"",FillOpacity:"",Radius:"",Latitude:"",Longitude:"",ShowTooltip:!1,Tooltip:""},Style:{advanced:""},Alignment:{paddingLeft:"0",paddingRight:"0",paddingTop:"0",paddingBottom:"0"},Format:{widgetTitle:"",titleFontSize:"16",titleHorizontal:"Center",titlePaddingLeft:0,titlePaddingRight:0,titlePaddingTop:0,titlePaddingBottom:0}},schema:{type:"object",title:"Properties",properties:{possible_screens:{type:"array",format:"table",items:{type:"object",properties:{title:{type:"string"},value:{type:"string"}}},options:{hidden:!0}},possible_dashboards:{type:"array",format:"table",items:{type:"object",properties:{title:{type:"string"},value:{type:"string"}}},options:{hidden:!0}},possible_viewstates:{type:"array",options:{hidden:!0}},possibleFloats:{type:"array",propertyOrder:1,format:"table",items:{type:"string"},default:["default"],options:{collapsed:!0,hidden:!0}},possibleStrings:{type:"array",propertyOrder:1,format:"table",items:{type:"string"},default:["default"],options:{collapsed:!0,hidden:!0}},possibleImageString:{type:"array",propertyOrder:1,format:"table",items:{type:"string"},default:["none"],options:{collapsed:!0,hidden:!0}},possibleDValues:{type:"array",propertyOrder:2,format:"table",items:{type:"string"},default:["default"],options:{collapsed:!0,hidden:!0}},possibleDString:{type:"array",propertyOrder:2,format:"table",items:{type:"string"},default:["default"],options:{collapsed:!0,hidden:!0}},possibleVString:{type:"array",propertyOrder:2,format:"table",items:{type:"string"},default:["default"],options:{collapsed:!0,hidden:!0}},possiblePLatLong:{type:"array",propertyOrder:2,format:"table",items:{type:"string"},default:["default"],options:{collapsed:!0,hidden:!0}},possibleHFloats:{type:"array",propertyOrder:1,format:"table",items:{type:"string"},default:["default"],options:{collapsed:!0,hidden:!0}},possibleLFloats:{type:"array",propertyOrder:1,format:"table",items:{type:"string"},default:["default"],options:{collapsed:!0,hidden:!0}},possibleTrack:{type:"array",propertyOrder:1,format:"table",items:{type:"string"},default:["default"],options:{collapsed:!0,hidden:!0}},possibleDKeys:{type:"array",propertyOrder:2,format:"table",items:{type:"string"},default:["default"],options:{collapsed:!0,hidden:!0}},possibleGKeys:{type:"array",propertyOrder:2,format:"table",items:{type:"string"},default:["default"],options:{collapsed:!0,hidden:!0}},possibleShapes:{type:"array",propertyOrder:2,format:"table",items:{type:"string"},default:["default"],options:{collapsed:!0,hidden:!0}},possibleColors:{type:"array",propertyOrder:2,format:"table",items:{type:"string"},default:["default"],options:{collapsed:!0,hidden:!0}},possibleCircle:{type:"array",propertyOrder:2,format:"table",items:{type:"string"},default:[],options:{collapsed:!0,hidden:!0}},all:{type:"array",propertyOrder:2,format:"table",items:{type:"string"},default:["default"],options:{collapsed:!0,hidden:!0}},vall:{type:"array",propertyOrder:3,format:"table",items:{type:"string"},default:["default"],options:{collapsed:!0,hidden:!0}},overlayall:{type:"array",propertyOrder:2,format:"table",items:{type:"string"},default:["default"],options:{collapsed:!0,hidden:!0}},overlayGeoJSONKeys:{type:"array",propertyOrder:2,format:"table",items:{type:"string"},default:["default"],options:{collapsed:!0,hidden:!0}},tooltips:{type:"string",propertyOrder:2,default:"",options:{collapsed:!0,hidden:!0}},Basics:{type:"object",propertyOrder:3,title:"Basics",properties:{Focus:{type:"viewstate",title:"Focus",default:""},Theme:{type:"string",title:"Theme",enum:["Light","Dark"]},ComponentName:{title:"Component",type:"string",default:"label",options:{hidden:!0}}}},MapDetails:{type:"object",propertyOrder:4,title:"Map",options:{collapsed:!0},properties:{Type:{type:"string",title:"Map Type",default:"terrain",enum:["terrain","satellite","roadmap","hybrid"]},Zoom:{type:"number",title:"Scale",default:8,options:{disableViewStateBinding:!0}},CenterX:{type:"number",title:"CenterX",default:0,minimum:-85,maximum:85},CenterY:{type:"number",title:"CenterY",default:0,minimum:-180,maximum:180},TrackChanges:{type:"boolean",title:"Track changes",format:"checkbox"},Bounds:{type:"viewstate",title:"Bounds",default:""},CustomMarkers:{type:"viewstate",title:"Custom point",default:""},MapKey:{type:"string",title:"Map Key",default:"",format:"string"},Style:{type:"json",title:"Style JSON",default:""}}},OverLay:{type:"object",propertyOrder:9,title:"Overlay",options:{collapsed:!0},properties:{layerProperties:{title:"Choose Layer",additionalProperties:!1,options:{keep_oneof_values:!0},oneOf:[{title:"Statistical",type:"object",properties:{Data:{type:"data",format:"string",propertyOrder:1,title:"Data Source",default:""},DataKey:{type:"string",title:"Data Key",propertyOrder:2,enumSource:"d_key",watch:{d_key:"root.overlayall"}},DataValue:{type:"string",title:"Data Value",propertyOrder:3,enumSource:"d_value",watch:{d_value:"root.overlayall"}},DataGeo:{title:"GeoJSON url",propertyOrder:4,type:"string"},GeoColumn:{type:"string",title:"GeoJSON Key",propertyOrder:5,default:"states",enumSource:"d_value",watch:{d_value:"root.overlayGeoJSONKeys"}},ShowLegend:{type:"boolean",title:"Show Legend",propertyOrder:6,format:"checkbox"},Selected:{type:"viewstate",title:"Selected Value",propertyOrder:13,default:""},SelectedBounds:{type:"viewstate",title:"Selected Bounds Value",propertyOrder:13,default:""},LayerOpacity:{title:"Layer Opacity",propertyOrder:21,default:30,minimum:0,maximum:100,type:"number",step:1,format:"range"}}}]},ShowOverlay:{type:"boolean",title:"Show Overlay",propertyOrder:1,format:"checkbox",options:{hidden:!0}},DataDesc:{type:"string",title:"Data Description",propertyOrder:5,enumSource:"d_string",watch:{d_string:"root.possibleDString"},options:{hidden:!0}},Data:{type:"data",format:"string",propertyOrder:2,title:"Data Source",default:"",options:{hidden:!0}},DataType:{type:"string",title:"Data Type",default:"",propertyOrder:52,enum:["GeoJSON","Voronoi"],options:{hidden:!0}},DataKey:{type:"string",title:"Data Key",propertyOrder:3,enumSource:"d_key",watch:{d_key:"root.overlayall"},options:{hidden:!0}},DataGeoId:{type:"string",title:"Geo Data Source",propertyOrder:6,enumSource:"g_key",watch:{g_key:"root.possibleGKeys"},options:{hidden:!0}},DataValue:{type:"string",title:"Data Value",propertyOrder:4,enumSource:"d_value",watch:{d_value:"root.overlayall"},options:{hidden:!0}},DataGeo:{title:"GeoJSON url",propertyOrder:5,type:"string",options:{hidden:!0}},GeoColumn:{type:"string",title:"GeoJSON Key",propertyOrder:6,default:"states",enumSource:"d_value",watch:{d_value:"root.overlayGeoJSONKeys"},options:{hidden:!0}},GeoFilter:{type:"string",title:"Geo Data Filter",propertyOrder:7,default:"",options:{hidden:!0}},ShowLegend:{type:"boolean",title:"Color Scale",propertyOrder:8,format:"checkbox",options:{hidden:!0}},LegendType:{type:"string",format:"data",title:"Legend Type",propertyOrder:9,default:"percent",enum:["percent","range"],options:{hidden:!0}},LegendColor:{type:"string",format:"data",title:"Legend Colour",propertyOrder:10,default:"blue",enum:["blue","red","green","purple"],options:{hidden:!0}},ColorDB:{type:"string",propertyOrder:11,title:"Overlay Colour (From DB)",enumSource:"possible_colors",watch:{possible_colors:"root.possibleColors"},options:{hidden:!0}},TooltipData:{type:"tooltipTemplate",title:"Custom tooltip",propertyOrder:12,default:""},Selected:{type:"viewstate",title:"Selected Value",propertyOrder:13,default:"",options:{hidden:!0}},GeoSelected:{type:"viewstate",title:"Geo Filter Selected Value",propertyOrder:14,default:"",options:{hidden:!0}},Bounds:{type:"viewstate",title:"Bounds Selected",propertyOrder:15,default:"",options:{hidden:!0}},ImageSrc:{type:"string",title:"Image Source",propertyOrder:16,default:"",options:{hidden:!0}},ImageNorth:{type:"number",propertyOrder:17,title:"Image North Bound",default:0,options:{hidden:!0}},ImageSouth:{type:"number",propertyOrder:18,title:"Image South Bound",default:0,options:{hidden:!0}},ImageEast:{type:"number",propertyOrder:19,title:"Image East Bound",default:0,options:{hidden:!0}},ImageWest:{type:"number",propertyOrder:20,title:"Image West Bound",default:0,options:{hidden:!0}},ImageOpacity:{title:"Image Opacity",propertyOrder:21,default:30,minimum:0,maximum:100,type:"number",step:1,format:"range",options:{hidden:!0}},SelectedObjectRouting:{propertyOrder:22,type:"array",format:"table",title:"Selected Point ViewState Routing",options:{collapsed:!0},items:{type:"object",title:"Routing",properties:{ColumnProperty:{title:"Column",type:"string",enumSource:"possible_selected_columns",watch:{possible_selected_columns:"root.overlayall"}},ViewstateProperty:{title:"Viewstate",type:"viewstate"}}}}}},Voronoi:{type:"object",propertyOrder:8,title:"Voronoi",options:{collapsed:!0,hidden:!0},properties:{Data:{type:"data",format:"string",propertyOrder:1,title:"Data Source",default:""},DataKey:{type:"string",title:"Data Key",propertyOrder:2,enumSource:"d_key",watch:{d_key:"root.vall"}},DataDesc:{type:"string",title:"Description",propertyOrder:3,enumSource:"d_value",watch:{d_value:"root.possibleDValues"}},Longitude:{type:"string",title:"Longitude",propertyOrder:4,enumSource:"d_value",watch:{d_value:"root.possibleDValues"}},Latitude:{type:"string",title:"Latitude",propertyOrder:5,enumSource:"d_value",watch:{d_value:"root.possibleDValues"}},AvgLongitude:{type:"string",title:"Average Longitude",propertyOrder:6,enumSource:"d_value",watch:{d_value:"root.possibleDValues"}},AvgLatitude:{type:"string",title:"Average Latitude",propertyOrder:7,enumSource:"d_value",watch:{d_value:"root.possibleDValues"}},LineColor:{type:"gradient",propertyOrder:8,title:"Line Colour",default:"#0061FF",options:{gradient:!1}},DotColor:{type:"gradient",propertyOrder:9,title:"Point Colour",default:"#0061FF",options:{gradient:!1,hidden:!0}},ShowScale:{type:"boolean",title:"Show Scale",propertyOrder:10,format:"checkbox"},Scale:{title:"Scale Metric",propertyOrder:11,type:"string",enumSource:"d_value",watch:{d_value:"root.possibleDValues"}},Opacity:{title:"Scale Opacity",propertyOrder:12,default:1,minimum:0,maximum:10,type:"number",step:1,format:"range"},ScaleColor:{type:"string",format:"data",title:"Legend Colour",propertyOrder:13,default:"blue",enum:["blue","red","green","purple"]}}},Points:{type:"object",propertyOrder:5,title:"Points",options:{collapsed:!0},properties:{Data:{type:"data",format:"string",title:"Data Source",propertyOrder:1,default:""},Selected:{type:"viewstate",title:"Selected Value",default:"",propertyOrder:3},Tracker:{type:"viewstate",title:"Tracker",default:"",propertyOrder:4},TrackedItem:{type:"string",propertyOrder:5,title:"TrackedItem",enumSource:"possible_track",watch:{possible_track:"root.possibleTrack"}},Title:{type:"string",propertyOrder:2,title:"Selected Attr",enumSource:"possible_strings",watch:{possible_strings:"root.possibleTrack"}},Latitude:{type:"string",propertyOrder:6,title:"Latitude Data",enumSource:"possible_floats",watch:{possible_floats:"root.possiblePLatLong"}},Longitude:{type:"string",propertyOrder:7,title:"Longitude Data",enumSource:"possible_floats",watch:{possible_floats:"root.possiblePLatLong"}},Shape:{type:"string",title:"Shape",propertyOrder:8,enum:["default","dot","pointer","run","walk","directional","arrow_back","arrow_down","arrow_forward","arrow_up","send","rowing","boat","car","airplane","dining","mountain","cloud","cloud2","sun","flash","flag","heart","star","home","warning","directionArrow","square","buildings","dollar","happy","device","iphone","train","truck","gym","cake","city","hot"]},ShapeDB:{type:"string",propertyOrder:9,title:"Shape (From DB)",enumSource:"possible_shapes",watch:{possible_shapes:"root.possibleShapes"}},ShapeColor:{type:"gradient",propertyOrder:10,title:"Shape Colour",default:"#0061FF",options:{gradient:!1}},ShapeColorDB:{type:"string",propertyOrder:11,title:"Shape Colour (From DB)",enumSource:"possible_colors",watch:{possible_colors:"root.possibleColors"}},ShapeCanRotation:{type:"boolean",propertyOrder:11,title:"Rotate Shape",format:"checkbox",default:!1},ShapeRotation:{type:"string",propertyOrder:12,title:"Shape Rotation degrees",enumSource:"possible_shapes",watch:{possible_shapes:"root.possibleTrack"}},ShapeSize:{title:"Shape Size",default:10,minimum:1,maximum:200,propertyOrder:12,type:"number",step:1,format:"range",options:{hidden:!0}},ShapeColorOpacity:{title:"Shape Opacity",default:0,minimum:0,maximum:100,propertyOrder:13,type:"number",step:1,format:"range"},ShapeSelectedColor:{type:"gradient",propertyOrder:14,title:"Shape Colour (Selected)",default:"#0061FF",options:{gradient:!1}},ShapeSelectedColorOpacity:{title:"Shape Opacity (Selected)",default:0,minimum:0,maximum:100,propertyOrder:15,type:"number",step:1,format:"range",options:{hidden:!0}},ShapeHoverColor:{type:"gradient",propertyOrder:16,title:"Shape Colour (Hovered)",default:"#0061FF",options:{gradient:!1,hidden:!0}},ShapeHoverColorOpacity:{title:"Shape Opacity (Hovered)",default:0,minimum:0,maximum:100,propertyOrder:17,type:"number",step:1,format:"range",options:{hidden:!0}},ClusterShape:{type:"string",propertyOrder:18,title:"Cluster Shape",enum:["default","house","airplane","star","square","person","heart","globe"],options:{hidden:!0}},ClusterSize:{title:"Cluster Size",propertyOrder:18,type:"string",enum:["default","10","20","30","40","50","60","70"]},Cluster:{type:"boolean",propertyOrder:20,title:"Cluster",format:"checkbox"},ShowTooltip:{type:"boolean",propertyOrder:21,title:"Show Tooltip",format:"checkbox"},TooltipData:{type:"tooltipTemplate",title:"Custom tooltip",propertyOrder:22,default:"",templateItems:{values:{type:"object",items:_.keyBy(["pointTitle","pointColor","pointIcon","pointLatitude","pointLongitude","pointID"])}}},Zoom:{type:"boolean",propertyOrder:23,title:"Zoom on Select",format:"checkbox"},ZoomBase:{type:"boolean",propertyOrder:24,title:"Single Zoom on Cluster",format:"checkbox"},Center:{type:"boolean",propertyOrder:25,title:"Center on Select",format:"checkbox"},Actions:{type:"actions",fields:{map:_.extend({Current:{title:"Trigger Source",type:"string",enum:["*"],default:"*",propertyOrder:10}},e),nav:e,query:e,url:e}},PointsInView:{type:"boolean",propertyOrder:30,title:"Points in View",format:"checkbox"},SelectedObjectRouting:{propertyOrder:31,type:"array",format:"table",title:"Selected Point ViewState Routing",options:{collapsed:!0,hidden:!0},items:{type:"object",title:"Routing",properties:{ColumnProperty:{title:"Column",type:"string",enumSource:"possible_selected_columns",watch:{possible_selected_columns:"root.possibleTrack"}},ViewstateProperty:{title:"Viewstate",type:"viewstate"}}}}}},Circles:{type:"object",propertyOrder:6,title:"Circles",options:{collapsed:!0},properties:{Data:{type:"data",format:"string",title:"Data Source",propertyOrder:1,default:""},Radius:{type:"string",propertyOrder:2,title:"Radius",enumSource:"possible_circle",watch:{possible_circle:"root.possibleCircle"}},Latitude:{type:"string",propertyOrder:3,title:"Latitude",enumSource:"possible_circle",watch:{possible_circle:"root.possibleCircle"}},Longitude:{type:"string",propertyOrder:4,title:"Longitude",enumSource:"possible_circle",watch:{possible_circle:"root.possibleCircle"}},StrokeColor:{type:"string",propertyOrder:5,title:"Circumference Color",enumSource:"possible_circle",watch:{possible_circle:"root.possibleCircle"}},StrokeOpacity:{type:"string",propertyOrder:6,title:"Circumference Opacity",enumSource:"possible_circle",watch:{possible_circle:"root.possibleCircle"}},StrokeWeight:{type:"string",propertyOrder:7,title:"Circumference Width",enumSource:"possible_circle",watch:{possible_circle:"root.possibleCircle"}},FillColor:{type:"string",propertyOrder:8,title:"Color",enumSource:"possible_circle",watch:{possible_circle:"root.possibleCircle"}},FillOpacity:{type:"string",propertyOrder:9,title:"Opacity",enumSource:"possible_circle",watch:{possible_circle:"root.possibleCircle"}},ShowTooltip:{type:"boolean",default:!1,propertyOrder:10,title:"Show Tooltip",format:"checkbox"},Tooltip:{type:"tooltipTemplate",title:"Custom tooltip",propertyOrder:11,default:""}}},Heatmap:{type:"object",propertyOrder:7,title:"Heatmap",options:{collapsed:!0},properties:{Data:{type:"data",format:"string",propertyOrder:1,title:"Data Source",default:""},Latitude:{type:"string",propertyOrder:2,title:"Latitude Data",enumSource:"possible_floats",watch:{possible_floats:"root.possibleHFloats"}},Longitude:{type:"string",propertyOrder:3,title:"Longitude Data",enumSource:"possible_floats",watch:{possible_floats:"root.possibleHFloats"}},Weight:{type:"string",propertyOrder:4,title:"Weight",enumSource:"possible_floats",watch:{possible_floats:"root.possibleHFloats"}},Opacity:{title:"Opacity",default:50,minimum:0,maximum:100,propertyOrder:5,type:"number",step:1,format:"range"},Gradient:{title:"Gradient",propertyOrder:6,default:"default",enum:["default","blue-red","red-blue"],type:"string"},Radius:{title:"Radius",default:20,minimum:1,maximum:50,propertyOrder:7,type:"number",step:1,format:"range"},Show:{type:"boolean",propertyOrder:8,title:"Show Heatmap",format:"checkbox"}}},Lines:{type:"object",propertyOrder:6,title:"Lines",options:{collapsed:!0},properties:{Data:{type:"data",format:"string",propertyOrder:1,title:"Data Source",default:""},Latitude:{type:"string",propertyOrder:2,title:"Latitude Data",enumSource:"possible_floats",watch:{possible_floats:"root.possibleLFloats"}},Longitude:{type:"string",propertyOrder:3,title:"Longitude Data",enumSource:"possible_floats",watch:{possible_floats:"root.possibleLFloats"}},Selected:{type:"viewstate",propertyOrder:4,title:"Selected Value",default:"",options:{hidden:!0}},Color:{type:"gradient",propertyOrder:5,title:"Colour",default:"#0061FF",options:{gradient:!1}},LabelColor:{type:"gradient",propertyOrder:6,title:"Label Color",default:"#ffffff",options:{gradient:!1}},LabelSize:{title:"Label Size",propertyOrder:7,default:0,minimum:4,maximum:14,type:"number",step:1,format:"range"},LabelText:{type:"tooltipTemplate",propertyOrder:8,title:"Tooltip"},ShowLabel:{type:"boolean",propertyOrder:9,title:"Show Label",format:"checkbox"},ShowTooltip:{type:"boolean",propertyOrder:10,title:"Show Tooltip",format:"checkbox"},Geodesic:{type:"boolean",propertyOrder:11,title:"Geodesic",format:"checkbox"}}},Bounds:{type:"array",format:"object",title:"Rectangle Bounds",propertyOrder:10,uniqueItems:!1,options:{collapsed:!0},items:{type:"object",title:"Bounds",properties:{North:{type:"number",default:38,propertyOrder:1},South:{type:"number",default:35,propertyOrder:3},East:{type:"number",default:-120,propertyOrder:4},West:{type:"number",default:-123,propertyOrder:5}}}},Style:{type:"object",propertyOrder:10,title:"Style",options:{collapsed:!0},properties:{advanced:{type:"css",title:"Advanced CSS",default:""}}},Alignment:{type:"object",propertyOrder:11,title:"Margins",options:{collapsed:!0},properties:{paddingLeft:{type:"number",title:"Padding Left",default:0,format:"number"},paddingRight:{type:"number",title:"Padding Right",default:0,format:"number"},paddingTop:{type:"number",title:"Padding Top",default:0,format:"number"},paddingBottom:{type:"number",title:"Padding Bottom",default:0,format:"number"}}},Format:{type:"object",propertyOrder:12,title:"Format",options:{collapsed:!0,hidden:!0},properties:{widgetTitle:{type:"string",propertyOrder:9,title:"Title"},titleFontSize:{type:"number",propertyOrder:11,title:"Title Font Size",format:"number"},titleHorizontal:{type:"string",propertyOrder:12,title:"Title Horizontal Align",enum:["Left","Center","Right"]},titlePaddingLeft:{type:"number",propertyOrder:13,title:"Title Padding Left",default:0,format:"number"},titlePaddingRight:{type:"number",propertyOrder:14,title:"Title Padding Right",default:0,format:"number"},titlePaddingTop:{type:"number",propertyOrder:15,title:"Title Padding Top",default:0,format:"number"},titlePaddingBottom:{type:"number",propertyOrder:16,title:"Title Padding Bottom",default:0,format:"number"}}}}}}};if(0<_.keys(t.settingsModel.attributes).length)for(var i=_.find(a.upgrades,{version:t.settingsModel.get("version")}),o=_.isNil(i)?1:a.upgrades.indexOf(i)+1;o<a.upgrades.length;o+=1){var r=a.upgrades[o];r.fn(t.settingsModel),t.settingsModel.set("version",r.version)}return e},a.upgrades=[{version:"4.1.0",fn:function(t){var e=t.get("MapDetails");e.MapKey=void 0===e.MapKey?"":e.MapKey,t.set("MapDetails",e)}},{version:"4.2.0",fn:function(t){var e=t.get("Points"),i=[],o=e.TargetDashboardScreen;(o&&o.dashboard&&"<none>"!==o.dashboard||o.value)&&i.push(_.extend({_Type:"nav"},o)),e.Actions=void 0===e.Actions?i:e.Actions,t.set("Points",_.omit(e,"TargetDashboardScreen","TargetDashboard","TargetScreen","SelectedObjectRouting","TargetDashboardId")),t.unset("Points.TargetDashboardScreen"),t.unset("Points.TargetDashboard"),t.unset("Points.TargetScreen"),t.unset("Points.SelectedObjectRouting"),t.unset("Points.TargetDashboardId")}},{version:"4.3.0",fn:function(t){var e=t.get("Circles"),i=t.get("possibleCircle");void 0===e&&(e={Data:"",StrokeColor:"",StrokeWeight:"",StrokeOpacity:"",FillColor:"",FillOpacity:"",Radius:"",Latitude:"",Longitude:"",ShowTooltip:!1,Tooltip:""}),t.set("possibleCircle",i=void 0===i?[]:i),t.set("Circles",e)}},{version:"4.4.0",fn:function(t){var e=t.get("MapDetails"),i=t.get("Lines"),o=t.get("Points");e.Style=void 0===e.Style?"":e.Style,i.Geodesic=void 0===i.Geodesic||i.Geodesic,o.ShapeCanRotation=void 0!==o.ShapeCanRotation&&o.ShapeCanRotation,o.ShapeRotation=void 0===o.ShapeRotation?0:o.ShapeRotation,t.set("MapDetails",e),t.set("Lines",i),t.set("Points",o)}},{version:"4.7.1",fn:function(t){t=t.get("Points");t.ShapeCanRotation=void 0!==t.ShapeCanRotation&&t.ShapeCanRotation}}],a);function a(){}s.app=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,o,r){return'<div class="GeoMap">\n    \n    <div class="title">\n    </div>\n\n    <div class="frame">\n      \x3c!--  <input id="pac-input" class="controls" type="text" placeholder="Search Box">--\x3e\n        <div  class="nicebox controls" style="display: none;">\n            <div class="legend">\n               \n                <div class="color-key"><span class="data-caret">&#x25c6;</span></div>\n                </div>\n        </div>\n       \n        <div class="googleMap">\n           \n        </div>\n    </div>\n</div>'},useData:!0});var r=s;function s(){}function l(t){this.extend(l,google.maps.OverlayView),this.tabs_=[],this.activeTab_=null,this.baseZIndex_=100,this.isOpen_=!1;t=t||{};null==t.backgroundColor&&(t.backgroundColor=this.BACKGROUND_COLOR_),null==t.borderColor&&(t.borderColor=this.BORDER_COLOR_),null==t.borderRadius&&(t.borderRadius=this.BORDER_RADIUS_),null==t.borderWidth&&(t.borderWidth=this.BORDER_WIDTH_),null==t.padding&&(t.padding=this.PADDING_),null==t.arrowPosition&&(t.arrowPosition=this.ARROW_POSITION_),null==t.disableAutoPan&&(t.disableAutoPan=!1),null==t.disableAnimation&&(t.disableAnimation=!1),null==t.minWidth&&(t.minWidth=this.MIN_WIDTH_),null==t.shadowStyle&&(t.shadowStyle=this.SHADOW_STYLE_),null==t.arrowSize&&(t.arrowSize=this.ARROW_SIZE_),null==t.arrowStyle&&(t.arrowStyle=this.ARROW_STYLE_),this.buildDom_(),this.setValues(t)}(window.InfoBubble=l).prototype.ARROW_SIZE_=15,l.prototype.ARROW_STYLE_=0,l.prototype.SHADOW_STYLE_=1,l.prototype.MIN_WIDTH_=50,l.prototype.ARROW_POSITION_=50,l.prototype.PADDING_=10,l.prototype.BORDER_WIDTH_=1,l.prototype.BORDER_COLOR_="#ccc",l.prototype.BORDER_RADIUS_=10,l.prototype.BACKGROUND_COLOR_="#fff",l.prototype.extend=function(t,e){return function(t){for(var e in t.prototype)this.prototype[e]=t.prototype[e];return this}.apply(t,[e])},l.prototype.buildDom_=function(){var t=this.bubble_=document.createElement("DIV");t.style.position="absolute",t.style.zIndex=this.baseZIndex_;(this.tabsContainer_=document.createElement("DIV")).style.position="relative";var e=this.close_=document.createElement("IMG"),i=(e.style.position="absolute",e.style.width=this.px(12),e.style.height=this.px(12),e.style.border=0,e.style.zIndex=this.baseZIndex_+1,e.style.cursor="pointer",e.src="//maps.gstatic.com/intl/en_us/mapfiles/iw_close.gif",this.clickEvent(),this.contentContainer_=document.createElement("DIV")),o=(i.style.overflowX="auto",i.style.overflowY="auto",i.style.cursor="default",i.style.clear="both",i.style.position="relative",this.content_=document.createElement("DIV")),o=(i.appendChild(o),this.arrow_=document.createElement("DIV")),r=(o.style.position="relative",this.arrowOuter_=document.createElement("DIV")),a=this.arrowInner_=document.createElement("DIV"),s=this.getArrowSize_(),s=(r.style.position=a.style.position="absolute",r.style.left=a.style.left="50%",r.style.height=a.style.height="0",r.style.width=a.style.width="0",r.style.marginLeft=this.px(-s),r.style.borderWidth=this.px(s),r.style.borderBottomWidth=0,this.bubbleShadow_=document.createElement("DIV")),s=(s.style.position="absolute",t.style.display=s.style.display="none",t.appendChild(this.tabsContainer_),t.appendChild(e),t.appendChild(i),o.appendChild(r),o.appendChild(a),t.appendChild(o),document.createElement("style")),e=(s.setAttribute("type","text/css"),this.animationName_="_ibani_"+Math.round(1e4*Math.random()),"."+this.animationName_+"{-webkit-animation-name:"+this.animationName_+";-webkit-animation-duration:0.5s;-webkit-animation-iteration-count:1;}@-webkit-keyframes "+this.animationName_+" {from {-webkit-transform: scale(0)}50% {-webkit-transform: scale(1.2)}90% {-webkit-transform: scale(0.95)}to {-webkit-transform: scale(1)}}");s.textContent=e,document.getElementsByTagName("head")[0].appendChild(s)},l.prototype.clickEvent=function(){var t=this;google.maps.event.addDomListener(this.close_,"click",function(){t.close(),google.maps.event.trigger(t,"closeclick")})},l.prototype.setBackgroundClassName=function(t){this.set("backgroundClassName",t)},l.prototype.backgroundClassName_changed=function(){this.content_.className=this.get("backgroundClassName")},l.prototype.setTabClassName=function(t){this.set("tabClassName",t)},l.prototype.tabClassName_changed=function(){this.updateTabStyles_()},l.prototype.getArrowStyle_=function(){return parseInt(this.get("arrowStyle"),10)||0},l.prototype.setArrowStyle=function(t){this.set("arrowStyle",t)},l.prototype.arrowStyle_changed=function(){this.arrowSize_changed()},l.prototype.getArrowSize_=function(){return parseInt(this.get("arrowSize"),10)||0},l.prototype.setArrowSize=function(t){this.set("arrowSize",t)},l.prototype.arrowSize_changed=function(){this.borderWidth_changed()},l.prototype.setArrowPosition=function(t){this.set("arrowPosition",t)},l.prototype.getArrowPosition_=function(){return parseInt(this.get("arrowPosition"),10)||0},l.prototype.arrowPosition_changed=function(){var t=this.getArrowPosition_();this.arrowOuter_.style.left=this.arrowInner_.style.left=t+"%",this.redraw_()},l.prototype.setZIndex=function(t){this.set("zIndex",t)},l.prototype.getZIndex=function(){return parseInt(this.get("zIndex"),10)||this.baseZIndex_},l.prototype.zIndex_changed=function(){var t=this.getZIndex();this.bubble_.style.zIndex=this.baseZIndex_=t,this.close_.style.zIndex=t+1},l.prototype.setShadowStyle=function(t){this.set("shadowStyle",t)},l.prototype.getShadowStyle_=function(){return parseInt(this.get("shadowStyle"),10)||0},l.prototype.shadowStyle_changed=function(){this.getShadowStyle_();this.bubbleShadow_.style.boxShadow=this.bubbleShadow_.style.webkitBoxShadow=this.bubbleShadow_.style.MozBoxShadow="40px 15px 10px rgba(33,33,33,0.3)",this.bubbleShadow_.style.backgroundColor="transparent",this.isOpen_&&(this.bubbleShadow_.style.display="",this.draw())},l.prototype.showCloseButton=function(){this.set("hideCloseButton",!1)},l.prototype.hideCloseButton=function(){this.set("hideCloseButton",!0)},l.prototype.hideCloseButton_changed=function(){this.close_.style.display=this.get("hideCloseButton")?"none":""},l.prototype.setBackgroundColor=function(t){t&&this.set("backgroundColor",t)},l.prototype.backgroundColor_changed=function(){var t=this.get("backgroundColor");this.contentContainer_.style.backgroundColor=t,this.arrowInner_.style.borderColor=t+" transparent transparent",this.updateTabStyles_()},l.prototype.setBorderColor=function(t){t&&this.set("borderColor",t)},l.prototype.borderColor_changed=function(){var t=this.get("borderColor"),e=this.contentContainer_,i=this.arrowOuter_;e.style.borderColor=t,i.style.borderColor=t+" transparent transparent",e.style.borderStyle=i.style.borderStyle=this.arrowInner_.style.borderStyle="solid",this.updateTabStyles_()},l.prototype.setBorderRadius=function(t){this.set("borderRadius",t)},l.prototype.getBorderRadius_=function(){return parseInt(this.get("borderRadius"),10)||0},l.prototype.borderRadius_changed=function(){var t=this.getBorderRadius_(),e=this.getBorderWidth_();this.contentContainer_.style.borderRadius=this.contentContainer_.style.MozBorderRadius=this.contentContainer_.style.webkitBorderRadius=this.bubbleShadow_.style.borderRadius=this.bubbleShadow_.style.MozBorderRadius=this.bubbleShadow_.style.webkitBorderRadius=this.px(t),this.tabsContainer_.style.paddingLeft=this.tabsContainer_.style.paddingRight=this.px(t+e),this.redraw_()},l.prototype.getBorderWidth_=function(){return parseInt(this.get("borderWidth"),10)||0},l.prototype.setBorderWidth=function(t){this.set("borderWidth",t)},l.prototype.borderWidth_changed=function(){var t=this.getBorderWidth_();this.contentContainer_.style.borderWidth=this.px(t),this.tabsContainer_.style.top=this.px(t),this.updateArrowStyle_(),this.updateTabStyles_(),this.borderRadius_changed(),this.redraw_()},l.prototype.updateArrowStyle_=function(){var t=this.getBorderWidth_(),e=this.getArrowSize_(),i=this.getArrowStyle_(),o=this.px(e),r=this.px(Math.max(0,e-t)),a=this.arrowOuter_,s=this.arrowInner_;this.arrow_.style.marginTop=this.px(-t),a.style.borderTopWidth=o,s.style.borderTopWidth=r,0==i||1==i?(a.style.borderLeftWidth=o,s.style.borderLeftWidth=r):a.style.borderLeftWidth=s.style.borderLeftWidth=0,0==i||2==i?(a.style.borderRightWidth=o,s.style.borderRightWidth=r):a.style.borderRightWidth=s.style.borderRightWidth=0,i<2?(a.style.marginLeft=this.px(-e),s.style.marginLeft=this.px(-(e-t))):a.style.marginLeft=s.style.marginLeft=0,a.style.display=0==t?"none":""},l.prototype.setPadding=function(t){this.set("padding",t)},l.prototype.getPadding_=function(){return parseInt(this.get("padding"),10)||0},l.prototype.padding_changed=function(){var t=this.getPadding_();this.contentContainer_.style.padding=this.px(t),this.updateTabStyles_(),this.redraw_()},l.prototype.px=function(t){return t&&t+"px"},l.prototype.addEvents_=function(){var t=["mousedown","mousemove","mouseover","mouseout","mouseup","mousewheel","DOMMouseScroll","touchstart","touchend","touchmove","dblclick","contextmenu","click"],e=this.bubble_;this.listeners_=[];for(var i,o=0;i=t[o];o++)this.listeners_.push(google.maps.event.addDomListener(e,i,function(t){t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation()}))},l.prototype.onAdd=function(){this.bubble_||this.buildDom_(),this.addEvents_();var t=this.getPanes();t&&(t.floatPane.appendChild(this.bubble_),t.floatShadow.appendChild(this.bubbleShadow_))},l.prototype.setBubbleOffset=function(t,e){this.bubbleOffsetX=parseInt(t),this.bubbleOffsetY=parseInt(e)},l.prototype.getBubbleOffset=function(){return{x:this.bubbleOffsetX||0,y:this.bubbleOffsetY||0}},l.prototype.draw=function(){var t,e,i,o,r,a,s=this.getProjection();s&&((o=this.get("position"))?(t=0,this.activeTab_&&(t=this.activeTab_.offsetHeight),a=this.getAnchorHeight_(),e=this.getArrowSize_(),i=this.getArrowPosition_(),i/=100,s=s.fromLatLngToDivPixel(o),o=this.contentContainer_.offsetWidth,r=this.bubble_.offsetHeight,o&&(r=s.y-(r+e)+this.getBubbleOffset().y,a&&(r-=a),a=s.x-o*i+this.getBubbleOffset().x,this.bubble_.style.top=this.px(r),this.bubble_.style.left=this.px(a),parseInt(this.get("shadowStyle"),10),this.bubbleShadow_.style.top=this.px(r+t-1),this.bubbleShadow_.style.left=this.px(a),this.bubbleShadow_.style.width=this.px(o),this.bubbleShadow_.style.height=this.px(this.contentContainer_.offsetHeight-e))):this.close())},l.prototype.onRemove=function(){this.bubble_&&this.bubble_.parentNode&&this.bubble_.parentNode.removeChild(this.bubble_),this.bubbleShadow_&&this.bubbleShadow_.parentNode&&this.bubbleShadow_.parentNode.removeChild(this.bubbleShadow_);for(var t,e=0;t=this.listeners_[e];e++)google.maps.event.removeListener(t)},l.prototype.isOpen=function(){return this.isOpen_},l.prototype.close=function(){this.bubble_&&(this.bubble_.style.display="none",this.bubble_.className=this.bubble_.className.replace(this.animationName_,"")),this.bubbleShadow_&&(this.bubbleShadow_.style.display="none",this.bubbleShadow_.className=this.bubbleShadow_.className.replace(this.animationName_,"")),this.isOpen_=!1},l.prototype.open=function(t,e){var i=this;window.setTimeout(function(){i.open_(t,e)},0)},l.prototype.open_=function(t,e){var i;this.updateContent_(),t&&this.setMap(t),e&&(this.set("anchor",e),this.bindTo("anchorPoint",e),this.bindTo("position",e)),this.bubble_.style.display=this.bubbleShadow_.style.display="",this.get("disableAnimation")||(this.bubble_.className+=" "+this.animationName_,this.bubbleShadow_.className+=" "+this.animationName_),this.redraw_(),this.isOpen_=!0,this.get("disableAutoPan")||(i=this,window.setTimeout(function(){i.panToView()},200))},l.prototype.setPosition=function(t){t&&this.set("position",t)},l.prototype.getPosition=function(){return this.get("position")},l.prototype.position_changed=function(){this.draw()},l.prototype.panToView=function(){var t,e,i,o,r,a,s=this.getProjection();s&&this.bubble_&&(o=this.getAnchorHeight_(),o=this.bubble_.offsetHeight+o,r=(t=this.get("map")).getDiv().offsetHeight,e=this.getPosition(),a=s.fromLatLngToContainerPixel(t.getCenter()),i=s.fromLatLngToContainerPixel(e),o=a.y-o,r=r-a.y,o<(a=0)&&(a=((o*=-1)+r)/2),i.y-=a,e=s.fromContainerPixelToLatLng(i),t.getCenter()!=e&&t.panTo(e))},l.prototype.htmlToDocumentFragment_=function(t){t=t.replace(/^\s*([\S\s]*)\b\s*$/,"$1");var e=document.createElement("DIV");if(e.innerHTML=t,1==e.childNodes.length)return e.removeChild(e.firstChild);for(var i=document.createDocumentFragment();e.firstChild;)i.appendChild(e.firstChild);return i},l.prototype.removeChildren_=function(t){if(t)for(var e;e=t.firstChild;)t.removeChild(e)},l.prototype.setContent=function(t){this.set("content",t)},l.prototype.getContent=function(){return this.get("content")},l.prototype.updateContent_=function(){if(this.content_){this.removeChildren_(this.content_);var t=this.getContent();if(t){"string"==typeof t&&(t=this.htmlToDocumentFragment_(t)),this.content_.appendChild(t);for(var e,i=this,o=this.content_.getElementsByTagName("IMG"),r=0;e=o[r];r++)google.maps.event.addDomListener(e,"load",function(){i.imageLoaded_()});google.maps.event.trigger(this,"domready")}this.redraw_()}},l.prototype.imageLoaded_=function(){var t=!this.get("disableAutoPan");this.redraw_(),!t||0!=this.tabs_.length&&0!=this.activeTab_.index||this.panToView()},l.prototype.updateTabStyles_=function(){if(this.tabs_&&this.tabs_.length){for(var t,e=0;t=this.tabs_[e];e++)this.setTabStyle_(t.tab);this.activeTab_.style.zIndex=this.baseZIndex_;var i=this.getBorderWidth_(),o=this.getPadding_()/2;this.activeTab_.style.borderBottomWidth=0,this.activeTab_.style.paddingBottom=this.px(o+i)}},l.prototype.setTabStyle_=function(t){var e,i=this.get("backgroundColor"),o=this.get("borderColor"),r=this.getBorderRadius_(),a=this.getBorderWidth_(),s=this.getPadding_(),n=this.px(-Math.max(s,r)),r=this.px(r),p=this.baseZIndex_,l=(t.index&&(p-=t.index),{cssFloat:"left",position:"relative",cursor:"pointer",backgroundColor:i,border:this.px(a)+" solid "+o,padding:this.px(s/2)+" "+this.px(s),marginRight:n,whiteSpace:"nowrap",borderRadiusTopLeft:r,MozBorderRadiusTopleft:r,webkitBorderTopLeftRadius:r,borderRadiusTopRight:r,MozBorderRadiusTopright:r,webkitBorderTopRightRadius:r,zIndex:p,display:"inline"});for(e in l)t.style[e]=l[e];i=this.get("tabClassName");null!=i&&(t.className+=" "+i)},l.prototype.addTabActions_=function(t){var e=this;t.listener_=google.maps.event.addDomListener(t,"click",function(){e.setTabActive_(this)})},l.prototype.setTabActive=function(t){t=this.tabs_[t-1];t&&this.setTabActive_(t.tab)},l.prototype.setTabActive_=function(t){if(!t)return this.setContent(""),void this.updateContent_();var e,i=this.getPadding_()/2,o=this.getBorderWidth_();this.activeTab_&&((e=this.activeTab_).style.zIndex=this.baseZIndex_-e.index,e.style.paddingBottom=this.px(i),e.style.borderBottomWidth=this.px(o)),t.style.zIndex=this.baseZIndex_,t.style.borderBottomWidth=0,t.style.marginBottomWidth="-10px",t.style.paddingBottom=this.px(i+o),this.setContent(this.tabs_[t.index].content),this.updateContent_(),this.activeTab_=t,this.redraw_()},l.prototype.setMaxWidth=function(t){this.set("maxWidth",t)},l.prototype.maxWidth_changed=function(){this.redraw_()},l.prototype.setMaxHeight=function(t){this.set("maxHeight",t)},l.prototype.maxHeight_changed=function(){this.redraw_()},l.prototype.setMinWidth=function(t){this.set("minWidth",t)},l.prototype.minWidth_changed=function(){this.redraw_()},l.prototype.setMinHeight=function(t){this.set("minHeight",t)},l.prototype.minHeight_changed=function(){this.redraw_()},l.prototype.addTab=function(t,e){var i=document.createElement("DIV");i.innerHTML=t,this.setTabStyle_(i),this.addTabActions_(i),this.tabsContainer_.appendChild(i),this.tabs_.push({label:t,content:e,tab:i}),i.index=this.tabs_.length-1,i.style.zIndex=this.baseZIndex_-i.index,this.activeTab_||this.setTabActive_(i),i.className=i.className+" "+this.animationName_+" infoBubble",this.redraw_()},l.prototype.updateTab=function(t,e,i){!this.tabs_.length||t<0||t>=this.tabs_.length||(t=this.tabs_[t],null!=e&&(t.tab.innerHTML=t.label=e),null!=i&&(t.content=i),this.activeTab_==t.tab&&(this.setContent(t.content),this.updateContent_()),this.redraw_())},l.prototype.removeTab=function(t){if(!(!this.tabs_.length||t<0||t>=this.tabs_.length)){var e=this.tabs_[t];e.tab.parentNode.removeChild(e.tab),google.maps.event.removeListener(e.tab.listener_),this.tabs_.splice(t,1);for(var i,o=0;i=this.tabs_[o];o++)i.tab.index=o;e.tab==this.activeTab_&&(this.tabs_[t]?this.activeTab_=this.tabs_[t].tab:this.tabs_[t-1]?this.activeTab_=this.tabs_[t-1].tab:this.activeTab_=void 0,this.setTabActive_(this.activeTab_)),this.redraw_()}},l.prototype.getElementSize_=function(t,e,i){var o=document.createElement("DIV"),t=(o.style.display="inline",o.style.position="absolute",o.style.visibility="hidden","string"==typeof t?o.innerHTML=t:o.appendChild(t.cloneNode(!0)),document.body.appendChild(o),new google.maps.Size(o.offsetWidth,o.offsetHeight));return e&&t.width>e&&(o.style.width=this.px(e),t=new google.maps.Size(o.offsetWidth,o.offsetHeight)),i&&t.height>i&&(o.style.height=this.px(i),t=new google.maps.Size(o.offsetWidth,o.offsetHeight)),document.body.removeChild(o),t},l.prototype.redraw_=function(){this.figureOutSize_(),this.positionCloseButton_(),this.draw()},l.prototype.figureOutSize_=function(){var t=this.get("map");if(t){var e=this.getPadding_(),i=(this.getBorderWidth_(),this.getBorderRadius_(),this.getArrowSize_()),t=t.getDiv(),o=2*i,r=t.offsetWidth-o,t=t.offsetHeight-o-this.getAnchorHeight_(),a=0,s=this.get("minWidth")||0,n=this.get("minHeight")||0,p=this.get("maxWidth")||0,l=this.get("maxHeight")||0,p=Math.min(r,p),l=Math.min(t,l),h=0;if(this.tabs_.length)for(var d,c=0;d=this.tabs_[c];c++){var u=this.getElementSize_(d.tab,p,l),y=this.getElementSize_(d.content,p,l);s<u.width&&(s=u.width),h+=u.width,n<u.height&&(n=u.height),u.height>a&&(a=u.height),s<y.width&&(s=y.width),n<y.height&&(n=y.height)}else{o=this.get("content");(o="string"==typeof o?this.htmlToDocumentFragment_(o):o)&&(s<(y=this.getElementSize_(o,p,l)).width&&(s=y.width),n<y.height&&(n=y.height))}p&&(s=Math.min(s,p)),l&&(n=Math.min(n,l)),(s=Math.max(s,h))==h&&(s+=2*e),i*=2,r<(s=Math.max(s,i))&&(s=r),t<n&&(n=t-a),this.tabsContainer_&&(this.tabHeight_=a,this.tabsContainer_.style.width=this.px(h)),this.contentContainer_.style.width=this.px(s),this.contentContainer_.style.height=this.px(n)}},l.prototype.getAnchorHeight_=function(){if(this.get("anchor")){var t=this.get("anchorPoint");if(t)return-1*t.y}return 0},l.prototype.anchorPoint_changed=function(){this.draw()},l.prototype.positionCloseButton_=function(){this.getBorderRadius_();var t=this.getBorderWidth_(),e=2,i=2,t=(this.tabs_.length&&this.tabHeight_&&(i+=this.tabHeight_),i+=t,e+=t,this.contentContainer_),e=$(t).width();t&&t.clientHeight<t.scrollHeight&&(e-=15),this.close_.style.left=this.px(e),this.close_.style.top=this.px(i)};var c,u={SVG_MAP:{arrow_back:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z",arrow_down:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z",arrow_forward:"M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z",arrow_up:"M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z",send:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z",directional:"M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71z",rowing:"M8.5 14.5L4 19l1.5 1.5L9 17h2l-2.5-2.5zM15 1c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 20.01L18 24l-2.99-3.01V19.5l-7.1-7.09c-.31.05-.61.07-.91.07v-2.16c1.66.03 3.61-.87 4.67-2.04l1.4-1.55c.19-.21.43-.38.69-.5.29-.14.62-.23.96-.23h.03C15.99 6.01 17 7.02 17 8.26v5.75c0 .84-.35 1.61-.92 2.16l-3.58-3.58v-2.27c-.63.52-1.43 1.02-2.29 1.39L16.5 18H18l3 3.01z",run:"M13.49 5.48c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-3.6 13.9l1-4.4 2.1 2v6h2v-7.5l-2.1-2 .6-3c1.3 1.5 3.3 2.5 5.5 2.5v-2c-1.9 0-3.5-1-4.3-2.4l-1-1.6c-.4-.6-1-1-1.7-1-.3 0-.5.1-.8.1l-5.2 2.2v4.7h2v-3.4l1.8-.7-1.6 8.1-4.9-1-.4 2 7 1.4z",walk:"M13.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM9.8 8.9L7 23h2.1l1.8-8 2.1 2v6h2v-7.5l-2.1-2 .6-3C14.8 12 16.8 13 19 13v-2c-1.9 0-3.5-1-4.3-2.4l-1-1.6c-.4-.6-1-1-1.7-1-.3 0-.5.1-.8.1L6 8.3V13h2V9.6l1.8-.7",boat:"M20 21c-1.39 0-2.78-.47-4-1.32-2.44 1.71-5.56 1.71-8 0C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 2.52 1.29 5.48 1.29 8 0 1.26.65 2.62.99 4 .99h2v-2h-2zM3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19zM6 6h12v3.97L12 8 6 9.97V6z",car:"M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.5 16c-.83 0-1.5-.67-1.5-1.5S5.67 13 6.5 13s1.5.67 1.5 1.5S7.33 16 6.5 16zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM5 11l1.5-4.5h11L19 11H5z",airplane:"M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z",dining:"M8.1 13.34l2.83-2.83L3.91 3.5c-1.56 1.56-1.56 4.09 0 5.66l4.19 4.18zm6.78-1.81c1.53.71 3.68.21 5.27-1.38 1.91-1.91 2.28-4.65.81-6.12-1.46-1.46-4.2-1.1-6.12.81-1.59 1.59-2.09 3.74-1.38 5.27L3.7 19.87l1.41 1.41L12 14.41l6.88 6.88 1.41-1.41L13.41 13l1.47-1.47z",pointer:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z",mountain:"M14 6l-3.75 5 2.85 3.8-1.6 1.2C9.81 13.75 7 10 7 10l-6 8h22L14 6z",cloud:"M19.36 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.64-4.96z",cloud2:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.61 5.64 5.36 8.04 2.35 8.36 0 10.9 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM19 18H6c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4h2c0-2.76-1.86-5.08-4.4-5.78C8.61 6.88 10.2 6 12 6c3.03 0 5.5 2.47 5.5 5.5v.5H19c1.65 0 3 1.35 3 3s-1.35 3-3 3z",sun:"M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.79 1.42-1.41zM4 10.5H1v2h3v-2zm9-9.95h-2V3.5h2V.55zm7.45 3.91l-1.41-1.41-1.79 1.79 1.41 1.41 1.79-1.79zm-3.21 13.7l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM20 10.5v2h3v-2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm-1 16.95h2V19.5h-2v2.95zm-7.45-3.91l1.41 1.41 1.79-1.8-1.41-1.41-1.79 1.8z",dot:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z",flash:"M7 2v11h3v9l7-12h-4l4-8z",flag:"M14.4 6L14 4H5v17h2v-7h5.6l.4 2h7V6z",heart:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",star:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z",home:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z",warning:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z",square:"M6 6h12v12H6z",directionArrow:"M16.01 11H4v2h12.01v3L20 12l-3.99-4z",buildings:"M12 7V3H2v18h20V7H12zM6 19H4v-2h2v2zm0-4H4v-2h2v2zm0-4H4V9h2v2zm0-4H4V5h2v2zm4 12H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V9h2v2zm0-4H8V5h2v2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8v10zm-2-8h-2v2h2v-2zm0 4h-2v2h2v-2z",dollar:"M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z",happy:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z",device:"M17 16l-4-4V8.82C14.16 8.4 15 7.3 15 6c0-1.66-1.34-3-3-3S9 4.34 9 6c0 1.3.84 2.4 2 2.82V12l-4 4H3v5h5v-3.05l4-4.2 4 4.2V21h5v-5h-4z",iphone:"M15.5 1h-8C6.12 1 5 2.12 5 3.5v17C5 21.88 6.12 23 7.5 23h8c1.38 0 2.5-1.12 2.5-2.5v-17C18 2.12 16.88 1 15.5 1zm-4 21c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm4.5-4H7V4h9v14z",train:"M12 2c-4.42 0-8 .5-8 4v9.5C4 17.43 5.57 19 7.5 19L6 20.5v.5h12v-.5L16.5 19c1.93 0 3.5-1.57 3.5-3.5V6c0-3.5-3.58-4-8-4zM7.5 17c-.83 0-1.5-.67-1.5-1.5S6.67 14 7.5 14s1.5.67 1.5 1.5S8.33 17 7.5 17zm3.5-6H6V6h5v5zm5.5 6c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm1.5-6h-5V6h5v5z",truck:"M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm13.5-9l1.96 2.5H17V9.5h2.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z,",gym:"M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2 7.71l1.43 1.43L2 10.57 3.43 12 7 8.43 15.57 17 12 20.57 13.43 22l1.43-1.43L16.29 22l2.14-2.14 1.43 1.43 1.43-1.43-1.43-1.43L22 16.29z",cake:"M12 6c1.11 0 2-.9 2-2 0-.38-.1-.73-.29-1.03L12 0l-1.71 2.97c-.19.3-.29.65-.29 1.03 0 1.1.9 2 2 2zm4.6 9.99l-1.07-1.07-1.08 1.07c-1.3 1.3-3.58 1.31-4.89 0l-1.07-1.07-1.09 1.07C6.75 16.64 5.88 17 4.96 17c-.73 0-1.4-.23-1.96-.61V21c0 .55.45 1 1 1h16c.55 0 1-.45 1-1v-4.61c-.56.38-1.23.61-1.96.61-.92 0-1.79-.36-2.44-1.01zM18 9h-5V7h-2v2H6c-1.66 0-3 1.34-3 3v1.54c0 1.08.88 1.96 1.96 1.96.52 0 1.02-.2 1.38-.57l2.14-2.13 2.13 2.13c.74.74 2.03.74 2.77 0l2.14-2.13 2.13 2.13c.37.37.86.57 1.38.57 1.08 0 1.96-.88 1.96-1.96V12C21 10.34 19.66 9 18 9z",city:"M15 11V5l-3-3-3 3v2H3v14h18V11h-6zm-8 8H5v-2h2v2zm0-4H5v-2h2v2zm0-4H5V9h2v2zm6 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V9h2v2zm0-4h-2V5h2v2zm6 12h-2v-2h2v2zm0-4h-2v-2h2v2z",hot:"M13.5.67s.74 2.65.74 4.8c0 2.06-1.35 3.73-3.41 3.73-2.07 0-3.63-1.67-3.63-3.73l.03-.36C5.21 7.51 4 10.62 4 14c0 4.42 3.58 8 8 8s8-3.58 8-8C20 8.61 17.41 3.8 13.5.67zM11.71 19c-1.78 0-3.22-1.4-3.22-3.14 0-1.62 1.05-2.76 2.81-3.12 1.77-.36 3.6-1.21 4.62-2.58.39 1.29.59 2.65.59 4.04 0 2.65-2.15 4.8-4.8 4.8z"}},y=(c=d.View,e(g,c),g.prototype.applyCircles=function(){var a=this,s=this.circlescollection;this.cleanCircles(),this.circlesPath=[],_.each(this.circlescollection.models,function(t,r){var e=parseFloat(t.get(a.api.getProperty("Circles.Latitude"))),i=parseFloat(t.get(a.api.getProperty("Circles.Longitude")));e&&i&&(a.circlesPath[r]=new google.maps.Circle({strokeColor:t.get(a.api.getProperty("Circles.StrokeColor")),strokeOpacity:t.get(a.api.getProperty("Circles.StrokeOpacity")),strokeWeight:t.get(a.api.getProperty("Circles.StrokeWeight")),fillColor:t.get(a.api.getProperty("Circles.FillColor")),fillOpacity:t.get(a.api.getProperty("Circles.FillOpacity")),map:a.map,center:{lat:e,lng:i},radius:parseFloat(t.get(a.api.getProperty("Circles.Radius")))}),a.circlesPath[r].id=t.id,a.circlesPath[r].infoWindowIndex=r,a.api.getProperty("Circles.ShowTooltip")&&(google.maps.event.addListener(a.circlesPath[r],"mouseover",function(e){var i,t=a.circlesPath[r].id,o=s.get(t);_.each(Object.keys(e),function(t){void 0!==e[t]&&void 0!==e[t].clientX&&(i=t,a.tooltip=a.api.setTooltip({data:o.attributes,text:a.api.getProperty("Circles.Tooltip"),anchorEl:a.el,position:{left:e[i].offsetX,top:e[i].offsetY-20}}))})}),google.maps.event.addListener(a.circlesPath[r],"mouseout",function(){a.tooltip&&(a.api.removeTooltip(),delete a.tooltip)})))})},g.prototype.columSpecToColumnData=function(t,e){var i=[];this.circlesModel=e,_.each(t.models,function(t){i.push(t.get("id"))}),this.api.setProperty("possibleCircle",i)},g.prototype.cleanCircles=function(){_.each(this.circlesPath,function(t){t.setMap(null)}),this.circlesPath=null},g.prototype.removeCircles=function(){this.cleanCircles()},g);function g(t){var e=c.call(this,t)||this;return e.options=t,e.$el=e.options.el,e.map=e.options.map,e.api=e.options.api,e.circlescollection=e.options.collection,e.circlesPath={},e}m=d.View,e(b,m),b.prototype.applyHeatmap=function(){var o=this,r=(this.cleanHeatmap(),[]);this.api.getProperty("Heatmap.Show")&&(_.each(this.heatmapcollection.models,function(t){var e=parseFloat(t.get(o.api.getProperty("Heatmap.Latitude"))),i=parseFloat(t.get(o.api.getProperty("Heatmap.Longitude"))),t=parseFloat(t.get(o.api.getProperty("Heatmap.Weight")));e&&i&&r.push({location:new google.maps.LatLng(e,i),weight:void 0===t?0:t})}),0<r.length&&_.defer(function(){o.heatmap=new google.maps.visualization.HeatmapLayer({data:r}),o.heatmap.setMap(o.map),o.heatmapOpacity(o.api.getProperty("Heatmap.Opacity")),o.heatmapRadius(o.api.getProperty("Heatmap.Radius")),o.heatmaps.push(o.heatmap),o.getGradient(o.api.getProperty("Heatmap.Gradient"))}))},b.prototype.cleanHeatmap=function(){if(this.heatmaps)for(var t=0;t<this.heatmaps.length;t++)this.heatmaps[t].setMap(null);this.heatmaps=[]},b.prototype.getGradient=function(t){"blue-red"===t?this.heatmap.set("gradient",["rgba(0, 255, 255, 0)","rgba(0, 255, 255, 1)","rgba(0, 191, 255, 1)","rgba(0, 127, 255, 1)","rgba(0, 63, 255, 1)","rgba(0, 0, 255, 1)","rgba(0, 0, 223, 1)","rgba(0, 0, 191, 1)","rgba(0, 0, 159, 1)","rgba(0, 0, 127, 1)","rgba(63, 0, 91, 1)","rgba(127, 0, 63, 1)","rgba(191, 0, 31, 1)","rgba(255, 0, 0, 1)"]):"red-blue"===t?this.heatmap.set("gradient",["rgba(255, 0, 0, 0)","rgba(191, 0, 31, 1)","rgba(127, 0, 63, 1)","rgba(63, 0, 91, 1)","rgba(0, 0, 127, 1)","rgba(0, 0, 159, 1)","rgba(0, 0, 191, 1)","rgba(0, 0, 223, 1)","rgba(0, 0, 255, 1)","rgba(0, 63, 255, 1)","rgba(0, 127, 255, 1)","rgba(0, 191, 255, 1)","rgba(0, 255, 255, 1)","rgba(0, 255, 255, 1)"]):this.heatmap.set("gradient",null)},b.prototype.heatmapRadius=function(t){this.heatmap.set("radius",t)},b.prototype.heatmapOpacity=function(t){this.heatmap.set("opacity",t/100)},b.prototype.columSpecToColumnData=function(t){var e=[];_.each(t.models,function(t){9===t.get("kdbType")&&e.push(t.get("id"))}),_.isEqual(e,this.api.getProperty("possibleHFloats"))||this.api.setProperty("possibleHFloats",e),this.applyHeatmap()},b.prototype.removeHeatmap=function(){this.cleanHeatmap()};var m,f=b;function b(t){var e=m.call(this,t)||this;return e.options=t,e.api=e.options.api,e.$el=e.options.el,e.map=e.options.map,e.heatmapcollection=e.options.collection,e.heatmaps=[],e}v=d.View,e(w,v),w.prototype.applyLine=function(){var i=this.api,o=[];_.each(this.linecollection.models,function(t){var e=parseFloat(t.get(i.getProperty("Lines.Latitude"))),t=parseFloat(t.get(i.getProperty("Lines.Longitude")));e&&t&&o.push({lat:e,lng:t})}),this.initLine(o)},w.prototype.initLine=function(t){var r=this,a=this.api;this.cleanLines(),t&&(this.linePath=new google.maps.Polyline({path:t,geodesic:a.getProperty("Lines.Geodesic"),strokeColor:a.getProperty("Lines.Color")}),this.label&&this.label.setMap(null),this.labelMarker&&this.labelMarker.setMap(null),this.linePath.setMap(this.map),a.getProperty("Lines.ShowLabel")&&0<t.length&&(this.labelMarker=new google.maps.Marker({position:this.getMidPoint(t),map:this.map,visible:!1})),a.getProperty("Lines.ShowTooltip")&&(google.maps.event.addListener(this.linePath,"mouseover",function(e){var i,o="";_.each(Object.keys(e),function(t){void 0!==e[t]&&void 0!==e[t].clientX&&(i=t,o=o+'<div><span style="color:#4d4d4d"><svg width="12" height="12"><span style="color:#4d4d4d">'+a.getProperty("Lines.LabelText")+"</span></div>",r.tooltip=a.setTooltip({text:o,anchorEl:r.el,position:{left:e[i].offsetX,top:e[i].offsetY-20}}))})}),google.maps.event.addListener(this.linePath,"mouseout",function(){r.tooltip&&(a.removeTooltip(),delete r.tooltip)})),google.maps.event.addListener(this.linePath,"clicked",function(){a.setProperty("selectedLine",a.getProperty("Lines.LabelText"))}))},w.prototype.cleanLines=function(){this.linePath&&(this.linePath.setMap(null),this.linePath=null)},w.prototype.columSpecToColumnData=function(t){var e=[];_.each(t.models,function(t){9!==t.get("kdbType")&&8!==t.get("kdbType")||e.push(t.get("id"))}),_.isEqual(e,this.api.getProperty("possibleLFloats"))||this.api.setProperty("possibleLFloats",e),this.applyLine()},w.prototype.getMidPoint=function(t){var e,i,o;return e=0<t.length?t.length%2==0?(i=t[t.length/2],o=t[t.length/2-1],{lat:(i.lat+o.lat)/2,lng:(i.lng+o.lng)/2}):t[t.length/2]:e},w.prototype.removeLine=function(){this.cleanLines()};var v,S=w;function w(t){var e=v.call(this,t)||this;return e.options=t,e.api=e.options.api,e.$el=e.options.el,e.map=e.options.map,e.linecollection=e.options.collection,e}!function(t){var p,i,o,r,a;function s(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function n(t){return t="string"!=typeof t?String(t):t}function l(e){this.map={},e instanceof l?e.forEach(function(t,e){this.append(e,t)},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function h(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function d(i){return new Promise(function(t,e){i.onload=function(){t(i.result)},i.onerror=function(){e(i.error)}})}function e(t){var e=new FileReader;return e.readAsArrayBuffer(t),d(e)}function c(){return this.bodyUsed=!1,this._initBody=function(t,e){if("string"==typeof(this._bodyInit=t))this._bodyText=t;else if(p&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t,this._options=e;else if(i&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(t){if(!o||!ArrayBuffer.prototype.isPrototypeOf(t))throw new Error("unsupported BodyInit type")}else this._bodyText=""},p?(this.blob=function(){var t=h(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(e)},this.text=function(){var t,e,i,o=h(this);if(o)return o;if(this._bodyBlob)return o=this._bodyBlob,t=this._options,e=new FileReader,t=t.headers.map["content-type"]?t.headers.map["content-type"].toString():"",i=/charset\=[0-9a-zA-Z\-\_]*;?/,t=o.type.match(i)||t.match(i),i=[o],t&&i.push(t[0].replace(/^charset\=/,"").replace(/;$/,"")),e.readAsText.apply(e,i),d(e);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var t=h(this);return t||Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(y)}),this.json=function(){return this.text().then(JSON.parse)},this}function u(t,e){var i,o=(e=e||{}).body;if(u.prototype.isPrototypeOf(t)){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new l(t.headers)),this.method=t.method,this.mode=t.mode,o||(o=t._bodyInit,t.bodyUsed=!0)}else this.url=t;if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new l(e.headers)),this.method=(t=e.method||this.method||"GET",i=t.toUpperCase(),-1<r.indexOf(i)?i:t),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(o,e)}function y(t){var i=new FormData;return t.trim().split("&").forEach(function(t){var e;t&&(e=(t=t.split("=")).shift().replace(/\+/g," "),t=t.join("=").replace(/\+/g," "),i.append(decodeURIComponent(e),decodeURIComponent(t)))}),i}function g(t,e){this._initBody(t,e=e||{}),this.type="default",this.status=e.status,this.ok=200<=this.status&&this.status<300,this.statusText=e.statusText,this.headers=e.headers instanceof l?e.headers:new l(e.headers),this.url=e.url||""}!t.__disableNativeFetch&&t.fetch||(l.prototype.append=function(t,e){t=s(t),e=n(e);var i=this.map[t];i||(this.map[t]=i=[]),i.push(e)},l.prototype.delete=function(t){delete this.map[s(t)]},l.prototype.get=function(t){t=this.map[s(t)];return t?t[0]:null},l.prototype.getAll=function(t){return this.map[s(t)]||[]},l.prototype.has=function(t){return this.map.hasOwnProperty(s(t))},l.prototype.set=function(t,e){this.map[s(t)]=[n(e)]},l.prototype.forEach=function(i,o){Object.getOwnPropertyNames(this.map).forEach(function(e){this.map[e].forEach(function(t){i.call(o,t,e,this)},this)},this)},p="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),i="FormData"in t,o="ArrayBuffer"in t,r=["DELETE","GET","HEAD","OPTIONS","POST","PUT"],u.prototype.clone=function(){return new u(this)},c.call(u.prototype),c.call(g.prototype),g.prototype.clone=function(){return new g(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new l(this.headers),url:this.url})},g.error=function(){var t=new g(null,{status:0,statusText:""});return t.type="error",t},a=[301,302,303,307,308],g.redirect=function(t,e){if(-1===a.indexOf(e))throw new RangeError("Invalid status code");return new g(null,{status:e,headers:{location:t}})},t.Headers=l,t.Request=u,t.Response=g,t.fetch=function(i,n){return new Promise(function(o,r){var t=u.prototype.isPrototypeOf(i)&&!n?i:new u(i,n),a=new XMLHttpRequest;var s=!1;function e(){if(4===a.readyState){var t=1223===a.status?204:a.status;if(t<100||599<t)return s?void 0:(s=!0,void r(new TypeError("Network request failed")));var i,t={status:t,statusText:a.statusText,headers:(t=a,i=new l,t.getAllResponseHeaders().trim().split("\n").forEach(function(t){var t=t.trim().split(":"),e=t.shift().trim(),t=t.join(":").trim();i.append(e,t)}),i),url:"responseURL"in a?a.responseURL:/^X-Request-URL:/m.test(a.getAllResponseHeaders())?a.getResponseHeader("X-Request-URL"):void 0},e="response"in a?a.response:a.responseText;s||(s=!0,o(new g(e,t)))}}a.onreadystatechange=e,a.onload=e,a.onerror=function(){s||(s=!0,r(new TypeError("Network request failed")))},a.open(t.method,t.url,!0);try{"include"===t.credentials&&("withCredentials"in a?a.withCredentials=!0:console&&console.warn&&console.warn("withCredentials is not supported, you can ignore this warning"))}catch(t){console&&console.warn&&console.warn("set withCredentials error:"+t)}"responseType"in a&&p&&(a.responseType="blob"),t.headers.forEach(function(t,e){a.setRequestHeader(e,t)}),a.send(void 0===t._bodyInit?null:t._bodyInit)})},t.fetch.polyfill=!0,"undefined"!=typeof module&&module.exports&&(module.exports=t.fetch))}("undefined"!=typeof self?self:this);P=d.View,e(O,P),O.prototype.applyGeoJsonData=function(t){var e,i,o=this,r=this.api.getProperty("OverLay"),a=r.layerProperties.GeoColumn,s=(void 0===t.objects&&(i=e=t),Object.keys(i.features[0].properties));_.defer(function(){o.api.setProperty("possibleGKeys",s)}),_.isEqual(this.geoJsonObject,i)||(this.overlay.setMap(null),this.geoJsonObject=i,this.overlayData=e),void 0!==a&&""!==a&&this.map.data.loadGeoJson(r.layerProperties.DataGeo,{idPropertyName:a})},O.prototype.getGeoJSON=function(){var e=this,o=this.api.getProperty("OverLay.layerProperties.GeoColumn"),t=this.api.getProperty("OverLay.layerProperties.DataGeo");t.indexOf("http")<0||fetch(t).then(function(t){return t.json()}).then(function(t){var i=[];t&&t.features&&t.features[0].properties&&_.each(t.features[0].properties,function(t,e){i.push(e)}),e.api.setProperty("overlayGeoJSONKeys",i),_.indexOf(i,o)<0&&e.api.setProperty("OverLay.layerProperties.GeoColumn",i[0]),e.applyGeoJsonData(t),e.overLaySetStyle(),e.overLayMouseEvents()}).catch(function(t){throw t})},O.prototype.applyOverlay=function(){var o=this,t=this.$el.height(),e=this.api.getProperty("OverLay.ShowOverlay");""!==this.options.overlaySrc&&(this.overlay.onAdd=function(){o.layer=n.select(o.layer.getPanes().overlayLayer).append("svg").attr("class","over").attr("height",_.isNil(t)?0:t)},this.overlay.draw=function(t){var e,i=o.api.getProperty("OverLay.layerProperties.GeoColumn");"updateLayer"!==t&&void 0!==o.data&&!_.isEqual(o.data,{})||(void 0!==i?o.dataModel&&(o.geoJsonObject?o.overLaySetStyle():(o.data={},o.getGeoJSON())):o.api.getProperty("OverLay.layerProperties")&&(t={north:o.api.getProperty("OverLay.layerProperties.ImageNorth"),south:o.api.getProperty("OverLay.layerProperties.ImageSouth"),east:o.api.getProperty("OverLay.layerProperties.ImageEast"),west:o.api.getProperty("OverLay.layerProperties.ImageWest")},i={opacity:o.api.getProperty("OverLay.layerProperties.ImageOpacity")/100},o.historicalOverlay&&o.historicalOverlay.setMap(null),e=o.api.getProperty("OverLay.layerProperties.ImageSrc"),o.historicalOverlay=new google.maps.GroundOverlay(e,t,i),o.historicalOverlay.setMap(o.map)))},this.overlay.onRemove=function(){},e&&this.loadgeoJson?(this.overlay.setMap(null),this.overlay.setMap(this.map),this.loadgeoJson=!1):e||this.overlay.setMap(null)),this.showLegend()},O.prototype.columSpecToColumnData=function(t,e){var i=this.api.getProperty("OverLay"),i=_.extend({},i),o=[],r=[],a=[],s=[],n=[];this.dataModel=e,_.each(t.models,function(t){6===t.get("kdbType")&&r.push(t.get("id")),5<=t.get("kdbType")&&t.get("kdbType")<=9&&o.push(t.get("id")),11===t.get("kdbType")&&a.push(t.get("id")),n.push(t.get("id")),s.push(t.get("id"))}),_.isEqual(r,this.api.getProperty("possibleDKeys"))&&_.isEqual(a,this.api.getProperty("possibleDString"))&&_.isEqual(o,this.api.getProperty("possibleDValues"))||(i.DataKey=_.includes(s,i.DataKey)?i.DataKey:s[0],i.DataValue=_.includes(o,i.DataValue)?i.DataValue:o[0],i.DataDesc=_.includes(a,i.DataKey)?i.DataKey:a[0],this.api.setProperty("possibleDKeys",r),this.api.setProperty("possibleDString",a),this.api.setProperty("possibleImageString",_.union(["none"],a)),this.api.setProperty("possibleDValues",o),this.api.setProperty("possibleColors",a),this.api.setProperty("all",n),this.api.setProperty("overlayall",s)),this.applyOverlay()},O.prototype.getColourScale=function(){return["rgb(219,79,53)","rgb(219,103,48)","rgb(219,126,42)","rgb(216,152,38)","rgb(212,176,34)","rgb(202,192,31)","rgb(182,194,30)","rgb(154,197,27)","rgb(128,195,26)","rgb(102,191,25)","rgb(75,187,23)","rgb(53,181,28)","rgb(29,173,33)","rgb(17,170,42)","rgb(16,167,57)","rgb(15,161,79)"]},O.prototype.getIndexBy=function(t,e){for(var i=0;i<t.length;i++)if(t[i].toString()===e.toString())return i;return-1},O.prototype.overLayMouseEvents=function(){function s(){p.tooltip&&(p.api.removeTooltip(),delete p.tooltip)}var n,p=this,l=this.api.getProperty("OverLay.layerProperties.GeoColumn"),h=this.api.getProperty("OverLay.layerProperties.DataKey"),d=this.api.getProperty("OverLay.layerProperties.DataValue"),c=this.api.getProperty("OverLay.TooltipData");this.map.data.addListener("mouseout",s.bind(this)),this.map.data.addListener("mouseover",function(t){p.lastOverId=t.feature.getId();for(var e=Object.keys(t),i=200,o=200,r="",a=0;a<e.length;a++)MouseEvent.prototype.isPrototypeOf(t[e[a]])&&(i=t[e[a]].offsetX,o=t[e[a]].offsetY);n=t.feature,_.each(p.datacollection.models,function(t){var e=n.getId()?n.getId():n.getProperty(l);t.get(h).toString()===e.toString()&&(r=t.attributes,p.overLayMouseEventsHeatmap(parseFloat(t.get(d))))}),p.tooltip=p.api.setTooltip({data:r,text:c,anchorEl:p.el,position:{left:i,top:o}}),"<div></div>"===p.tooltip.$el.html()&&s()}),this.map.data.addListener("click",function(t){var i,e=t.feature.getProperty(l),o=(p.api.setProperty("OverLay.layerProperties.Selected",e),p.api.getProperty("OverLay.layerProperties.SelectedBounds")&&(o=void 0,"MultiPolygon"===t.feature.getGeometry().getType()?o=t.feature.getGeometry().getArray()[0].getArray()[0].getArray():"Polygon"===t.feature.getGeometry().getType()&&(o=t.feature.getGeometry().getArray()[0].getArray()),o&&(t=(t=p.zoomLevelCalc(o)[1].toString().replace(/\(/g," ")).replace(/\)/g," "),p.api.setProperty("OverLay.layerProperties.SelectedBounds",t))),p.api.getProperty("OverLay.SelectedObjectRouting")),t=p.datacollection.pluck(h);void 0!==e&&(i=p.getIndexBy(t,e),void 0!==o&&_.each(o,function(t,e){0<=i&&p.datacollection.models[i]&&p.onRouteViewStateRouting("OverLay.SelectedObjectRouting",e,p.datacollection.models[i].get(t.ColumnProperty))}))})},O.prototype.overLayMouseEventsHeatmap=function(t){this.max&&this.min&&this.max!==1/0&&this.min!==1/0&&this.max-this.min!=0&&(t=(t-this.min)/(this.max-this.min),this.$el.find(".data-caret")[0].style.display="block",this.$el.find(".data-caret")[0].style.paddingLeft=280*t+"px")},O.prototype.overLaySetStyle=function(){var o,r=this,a="#ead6df",s=this.getColourScale(),n=void 0===this.api.getProperty("OverLay.layerProperties.LayerOpacity")?.3:this.api.getProperty("OverLay.layerProperties.LayerOpacity")/100,t=this.api.getProperty("OverLay.layerProperties.DataValue"),e=this.api.getProperty("OverLay.layerProperties.DataKey"),p=this.api.getProperty("OverLay.layerProperties.GeoColumn"),l=this.datacollection.pluck(e),h=this.datacollection.pluck(t);this.showLegend(),this.map.data.setStyle(function(t){var e,i,t=t.getProperty(p);return void 0!==t&&(o=r.getIndexBy(l,t),t=_.min(h.map(Number)),e=_.max(h.map(Number)),t=_.isNil(t)?0:parseFloat(t),e=_.isNil(e)?1:parseFloat(e),i=r.datacollection.models[o],a=o<0||(t===1/0||e===1/0)||_.isNil(i)?"#ead6df":(i=parseInt(h[o],10),i=Math.round(Math.min(16*(i-t)/(e-t),15)),s[i]),r.max=e,r.min=t),{fillColor:a,strokeColor:"#ffffff",strokeWeight:1,fillOpacity:n,opacity:1}})},O.prototype.onRouteViewStateRouting=function(t,e,i){this.api.setProperty(t+"."+e+".ViewstateProperty",i)},O.prototype.removeOverlay=function(){this.overlay&&this.overlay.setMap(null)},O.prototype.showLegend=function(){var t=this.$el.find(".nicebox")[0],e=this.api.getProperty("OverLay.layerProperties.ShowLegend")&&this.api.getProperty("OverLay.layerProperties").Data;t.style.display=e?"block":"none"},O.prototype.latRad=function(t){t=Math.sin(t*Math.PI/180),t=Math.log((1+t)/(1-t))/2;return Math.max(Math.min(t,Math.PI),-Math.PI)/2},O.prototype.zoom=function(t,e,i){return Math.floor(Math.log(t/e/i)/Math.LN2)},O.prototype.zoomLevelCalc=function(t){var e=256,i=256,o={height:this.$el.height(),width:this.$el.width()},r=new google.maps.LatLngBounds,t=(_.each(t,function(t){r.extend(new google.maps.LatLng(t.lat(),t.lng()))}),r.getNorthEast()),a=r.getSouthWest(),s=(this.latRad(t.lat())-this.latRad(a.lat()))/Math.PI,t=t.lng()-a.lng(),a=(t<0?360+t:t)/360,t=this.zoom(o.height,e,s),e=this.zoom(o.width,i,a);return[Math.min(t,e,21),r]};var P,C=O;function O(t){var e=P.call(this,t)||this;return e.loadgeoJson=!0,e.options=t,e.api=e.options.api,e.layer=e.options.layer,e.dataModel=e.options.dataModel,e.$el=e.options.el,e.map=e.options.map,e.websiteUrl=e.options.websiteUrl,e.datacollection=e.options.datacollection,e.overlay=new google.maps.OverlayView,e.loadgeoJson=!0,e}function L(t,e,i){this.extend(L,google.maps.OverlayView),this.map_=t,this.markers_=[],this.clusters_=[],this.sizes=[53,56,66,78,90],this.styles_=[],this.ready_=!1;var i=i||{},o=(this.gridSize_=i.gridSize||60,this.minClusterSize_=i.minimumClusterSize||2,this.maxZoom_=i.maxZoom||null,this.styles_=i.styles||[],this.imagePath_=i.imagePath||this.MARKER_CLUSTER_IMAGE_PATH_,this.imageExtension_=i.imageExtension||this.MARKER_CLUSTER_IMAGE_EXTENSION_,this.zoomOnClick_=!0,null!=i.zoomOnClick&&(this.zoomOnClick_=i.zoomOnClick),this.averageCenter_=!1,null!=i.averageCenter&&(this.averageCenter_=i.averageCenter),this.setupStyles_(),this.setMap(t),this.prevZoom_=this.map_.getZoom(),this);google.maps.event.addListener(this.map_,"zoom_changed",function(){var t=o.map_.getZoom();o.prevZoom_!=t&&(o.prevZoom_=t,o.resetViewport())}),google.maps.event.addListener(this.map_,"idle",function(){o.redraw()}),e&&e.length&&this.addMarkers(e,!1)}function M(t){this.markerClusterer_=t,this.map_=t.getMap(),this.gridSize_=t.getGridSize(),this.minClusterSize_=t.getMinClusterSize(),this.averageCenter_=t.isAverageCenter(),this.center_=null,this.markers_=[],this.bounds_=null,this.clusterIcon_=new T(this,t.getStyles(),t.getGridSize())}function T(t,e,i){t.getMarkerClusterer().extend(T,google.maps.OverlayView),this.styles_=e,this.padding_=i||0,this.cluster_=t,this.center_=null,this.map_=t.getMap(),this.div_=null,this.sums_=null,this.visible_=!1,this.setMap(this.map_)}L.prototype.MARKER_CLUSTER_IMAGE_PATH_="https://cdn.rawgit.com/googlemaps/js-marker-clusterer/gh-pages/images/m",L.prototype.MARKER_CLUSTER_IMAGE_EXTENSION_="png",L.prototype.extend=function(t,e){return function(t){for(var e in t.prototype)this.prototype[e]=t.prototype[e];return this}.apply(t,[e])},L.prototype.onAdd=function(){this.setReady_(!0)},L.prototype.draw=function(){},L.prototype.setupStyles_=function(){if(!this.styles_.length)for(var t,e=0;t=this.sizes[e];e++)this.styles_.push({url:this.imagePath_+(e+1)+"."+this.imageExtension_,height:t,width:t})},L.prototype.fitMapToMarkers=function(){for(var t,e=this.getMarkers(),i=new google.maps.LatLngBounds,o=0;t=e[o];o++)i.extend(t.getPosition());this.map_.fitBounds(i)},L.prototype.setStyles=function(t){this.styles_=t},L.prototype.getStyles=function(){return this.styles_},L.prototype.isZoomOnClick=function(){return this.zoomOnClick_},L.prototype.isAverageCenter=function(){return this.averageCenter_},L.prototype.getMarkers=function(){return this.markers_},L.prototype.getTotalMarkers=function(){return this.markers_.length},L.prototype.setMaxZoom=function(t){this.maxZoom_=t},L.prototype.getMaxZoom=function(){return this.maxZoom_},L.prototype.calculator_=function(t,e){for(var i=0,t=t.length,o=t;0!==o;)o=parseInt(o/10,10),i++;return{text:t,index:i=Math.min(i,e)}},L.prototype.setCalculator=function(t){this.calculator_=t},L.prototype.getCalculator=function(){return this.calculator_},L.prototype.addMarkers=function(t,e){for(var i,o=0;i=t[o];o++)this.pushMarkerTo_(i);e||this.redraw()},L.prototype.pushMarkerTo_=function(t){var e;t.isAdded=!1,t.draggable&&(e=this,google.maps.event.addListener(t,"dragend",function(){t.isAdded=!1,e.repaint()})),this.markers_.push(t)},L.prototype.addMarker=function(t,e){this.pushMarkerTo_(t),e||this.redraw()},L.prototype.removeMarker_=function(t){var e=-1;if(this.markers_.indexOf)e=this.markers_.indexOf(t);else for(var i,o=0;i=this.markers_[o];o++)if(i==t){e=o;break}return-1!=e&&(t.setMap(null),this.markers_.splice(e,1),!0)},L.prototype.removeMarker=function(t,e){t=this.removeMarker_(t);return!(e||!t)&&(this.resetViewport(),this.redraw(),!0)},L.prototype.removeMarkers=function(t,e){for(var i=!1,o=0;r=t[o];o++)var r=this.removeMarker_(r),i=i||r;if(!e&&i)return this.resetViewport(),this.redraw(),!0},L.prototype.setReady_=function(t){this.ready_||(this.ready_=t,this.createClusters_())},L.prototype.getTotalClusters=function(){return this.clusters_.length},L.prototype.getMap=function(){return this.map_},L.prototype.setMap=function(t){this.map_=t},L.prototype.getGridSize=function(){return this.gridSize_},L.prototype.setGridSize=function(t){this.gridSize_=t},L.prototype.getMinClusterSize=function(){return this.minClusterSize_},L.prototype.setMinClusterSize=function(t){this.minClusterSize_=t},L.prototype.getExtendedBounds=function(t){var e=this.getProjection(),i=new google.maps.LatLng(t.getNorthEast().lat(),t.getNorthEast().lng()),o=new google.maps.LatLng(t.getSouthWest().lat(),t.getSouthWest().lng()),i=e.fromLatLngToDivPixel(i),o=(i.x+=this.gridSize_,i.y-=this.gridSize_,e.fromLatLngToDivPixel(o)),i=(o.x-=this.gridSize_,o.y+=this.gridSize_,e.fromDivPixelToLatLng(i)),e=e.fromDivPixelToLatLng(o);return t.extend(i),t.extend(e),t},L.prototype.isMarkerInBounds_=function(t,e){return e.contains(t.getPosition())},L.prototype.clearMarkers=function(){this.resetViewport(!0),this.markers_=[]},L.prototype.resetViewport=function(t){for(var e,i=0;e=this.clusters_[i];i++)e.remove();for(var o,i=0;o=this.markers_[i];i++)o.isAdded=!1,t&&o.setMap(null);this.clusters_=[]},L.prototype.repaint=function(){var i=this.clusters_.slice();this.clusters_.length=0,this.resetViewport(),this.redraw(),window.setTimeout(function(){for(var t,e=0;t=i[e];e++)t.remove()},0)},L.prototype.redraw=function(){this.createClusters_()},L.prototype.distanceBetweenPoints_=function(t,e){if(!t||!e)return 0;var i=(e.lat()-t.lat())*Math.PI/180,o=(e.lng()-t.lng())*Math.PI/180,i=Math.sin(i/2)*Math.sin(i/2)+Math.cos(t.lat()*Math.PI/180)*Math.cos(e.lat()*Math.PI/180)*Math.sin(o/2)*Math.sin(o/2);return 6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))},L.prototype.addToClosestCluster_=function(t){for(var e,i=4e4,o=null,r=(t.getPosition(),0);e=this.clusters_[r];r++){var a=e.getCenter();!a||(a=this.distanceBetweenPoints_(a,t.getPosition()))<i&&(i=a,o=e)}o&&o.isMarkerInClusterBounds(t)?o.addMarker(t):((e=new M(this)).addMarker(t),this.clusters_.push(e))},L.prototype.createClusters_=function(){if(this.ready_)for(var t,e=new google.maps.LatLngBounds(this.map_.getBounds().getSouthWest(),this.map_.getBounds().getNorthEast()),i=this.getExtendedBounds(e),o=0;t=this.markers_[o];o++)!t.isAdded&&this.isMarkerInBounds_(t,i)&&this.addToClosestCluster_(t)},M.prototype.isMarkerAlreadyAdded=function(t){if(this.markers_.indexOf)return-1!=this.markers_.indexOf(t);for(var e,i=0;e=this.markers_[i];i++)if(e==t)return!0;return!1},M.prototype.addMarker=function(t){if(this.isMarkerAlreadyAdded(t))return!1;this.center_?this.averageCenter_&&(i=this.markers_.length+1,e=(this.center_.lat()*(i-1)+t.getPosition().lat())/i,i=(this.center_.lng()*(i-1)+t.getPosition().lng())/i,this.center_=new google.maps.LatLng(e,i),this.calculateBounds_()):(this.center_=t.getPosition(),this.calculateBounds_()),t.isAdded=!0,this.markers_.push(t);var e,i,o=this.markers_.length;if(o<this.minClusterSize_&&t.getMap()!=this.map_&&t.setMap(this.map_),o==this.minClusterSize_)for(var r=0;r<o;r++)this.markers_[r].setMap(null);return o>=this.minClusterSize_&&t.setMap(null),this.updateIcon(),!0},M.prototype.getMarkerClusterer=function(){return this.markerClusterer_},M.prototype.getBounds=function(){var t=new google.maps.LatLngBounds(this.center_,this.center_),e=this.getMarkers();if(void 0!==e)for(var i,o=0;i=e[o];o++)t.extend(i.getPosition());return t},M.prototype.remove=function(){this.clusterIcon_.remove(),this.markers_.length=0,delete this.markers_},M.prototype.getSize=function(){return this.markers_.length},M.prototype.getMarkers=function(){return this.markers_},M.prototype.getCenter=function(){return this.center_},M.prototype.calculateBounds_=function(){var t=new google.maps.LatLngBounds(this.center_,this.center_);this.bounds_=this.markerClusterer_.getExtendedBounds(t)},M.prototype.isMarkerInClusterBounds=function(t){return this.bounds_.contains(t.getPosition())},M.prototype.getMap=function(){return this.map_},M.prototype.updateIcon=function(){var t=this.map_.getZoom(),e=this.markerClusterer_.getMaxZoom();if(e&&e<t)for(var i,o=0;i=this.markers_[o];o++)i.setMap(this.map_);else this.markers_.length<this.minClusterSize_?this.clusterIcon_.hide():(e=this.markerClusterer_.getStyles().length,t=this.markerClusterer_.getCalculator()(this.markers_,e),this.clusterIcon_.setCenter(this.center_),this.clusterIcon_.setSums(t),this.clusterIcon_.show())},T.prototype.triggerClusterClick=function(){var t=this.cluster_.getMarkerClusterer();google.maps.event.trigger(t,"clusterclick",this.cluster_)},T.prototype.triggerClusterOver=function(){var t=this.cluster_.getMarkerClusterer();google.maps.event.trigger(t,"clusterOver",this.cluster_)},T.prototype.triggerClusterOut=function(){var t=this.cluster_.getMarkerClusterer();google.maps.event.trigger(t,"clusterOut",this.cluster_)},T.prototype.onAdd=function(){var t;this.div_=document.createElement("DIV"),this.visible_&&(t=this.getPosFromLatLng_(this.center_),this.div_.style.cssText=this.createCss(t),this.div_.innerHTML=this.sums_.text);this.getPanes().overlayMouseTarget.appendChild(this.div_);var e=this;google.maps.event.addDomListener(this.div_,"click",function(){e.triggerClusterClick()}),google.maps.event.addDomListener(this.div_,"mouseover",function(){e.triggerClusterOver()}),google.maps.event.addDomListener(this.div_,"mouseout",function(){e.triggerClusterOut()})},T.prototype.getPosFromLatLng_=function(t){t=this.getProjection().fromLatLngToDivPixel(t);return t.x-=parseInt(this.width_/2,10),t.y-=parseInt(this.height_/2,10),t},T.prototype.draw=function(){var t;this.visible_&&(t=this.getPosFromLatLng_(this.center_),this.div_.style.top=t.y+"px",this.div_.style.left=t.x+"px")},T.prototype.hide=function(){this.div_&&(this.div_.style.display="none"),this.visible_=!1},T.prototype.show=function(){var t;this.div_&&(t=this.getPosFromLatLng_(this.center_),this.div_.style.cssText=this.createCss(t),this.div_.style.display=""),this.visible_=!0},T.prototype.remove=function(){this.setMap(null)},T.prototype.onRemove=function(){this.div_&&this.div_.parentNode&&(this.hide(),this.div_.parentNode.removeChild(this.div_),this.div_=null)},T.prototype.setSums=function(t){this.sums_=t,this.text_=t.text,this.index_=t.index,this.div_&&(this.div_.innerHTML=t.text),this.useStyle()},T.prototype.useStyle=function(){var t=Math.max(0,this.sums_.index-1),t=Math.min(this.styles_.length-1,t),t=this.styles_[t];this.url_=t.url,this.height_=t.height,this.width_=t.width,this.textColor_=t.textColor,this.anchor_=t.anchor,this.textSize_=t.textSize,this.backgroundPosition_=t.backgroundPosition},T.prototype.setCenter=function(t){this.center_=t},T.prototype.createCss=function(t){var e=[],i=(e.push("background-image:url("+this.url_+");"),this.backgroundPosition_||"0 0"),i=(e.push("background-position:"+i+";"),"object"==typeof this.anchor_?("number"==typeof this.anchor_[0]&&0<this.anchor_[0]&&this.anchor_[0]<this.height_?e.push("height:"+(this.height_-this.anchor_[0])+"px; padding-top:"+this.anchor_[0]+"px;"):e.push("height:"+this.height_+"px; line-height:"+this.height_+"px;"),"number"==typeof this.anchor_[1]&&0<this.anchor_[1]&&this.anchor_[1]<this.width_?e.push("width:"+(this.width_-this.anchor_[1])+"px; padding-left:"+this.anchor_[1]+"px;"):e.push("width:"+this.width_+"px; text-align:center;")):e.push("height:"+this.height_+"px; line-height:"+this.height_+"px; width:"+this.width_+"px; text-align:center;"),this.textColor_||"black"),o=this.textSize_||11;return e.push("cursor:pointer; top:"+t.y+"px; left:"+t.x+"px; color:"+i+"; position:absolute; font-size:"+o+"px; font-family:Arial,sans-serif; font-weight:bold"),e.join("")},window.MarkerClusterer=L;k=d.View,e(D,k),D.prototype.addTrackedPoint=function(){var r,a=this,s=this.api.getProperty("Points.TrackedItem"),n=this.api.getProperty("Points.Shape"),p=this.api.getProperty("Points.Latitude"),l=this.api.getProperty("Points.Longitude");_.each(this.pointcollection.models,function(t,e){var i=void 0===t.get(s)?"":t.get(s).toString();if(0===e&&(r="default"===n?a.addNewMarker(t,t.id,i,t.get(p),t.get(l),null):(e=a.getMarkerImage(t),a.addNewMarker(t,t.id,i,t.get(p),t.get(l),e)))){a.map.setCenter(new google.maps.LatLng(t.get(p),t.get(l)));for(var o=0;o<a.markers.length;o++)a.markers[o].setMap(null);a.markers=[],a.markers.push(r)}})},D.prototype.getMarkerImage=function(t){var e=this.api.getProperty("Points.Shape"),i=this.api.getProperty("Points.Title"),o=this.api.getProperty("Points.ShapeColor"),r=this.api.getProperty("Points.ShapeDB"),a=this.api.getProperty("Points.ShapeColorDB"),s=this.api.getProperty("Points.ShapeSelectedColorOpacity"),n=this.api.getProperty("Points.ShapeCanRotation"),p=this.api.getProperty("Points.ShapeRotation"),l=this.api.getProperty("Points.ShapeSelectedColor"),e="use selected shape"===r?e:t.get(r),o="use selected color"===a?o:t.get(a),a=this.api.getProperty("Points.Selected"),h=0;return n&&(parseFloat(p)?h=parseFloat(p):parseFloat(t.get(p))&&(h=parseFloat(t.get(p)))),{path:void 0===u.SVG_MAP[e]?t.get(r):u.SVG_MAP[e],anchor:new google.maps.Point(18,18),size:new google.maps.Size(36,36),origin:new google.maps.Point(0,0),scaledSize:new google.maps.Size(25,25),fillColor:t.get(i)===a?l:o,strokeOpacity:0,fillOpacity:s,rotation:h}},D.prototype.addNewMarker=function(e,t,i,o,r,a){var s={},n=this.api.getProperty("Points.Actions"),p=this.api.getProperty("Points.ShapeColorOpacity"),l=this.api.getProperty("Points.Selected"),h=this.api.getProperty("Points"),a=a?new google.maps.Marker({map:this.map,draggable:!1,title:i,icon:a,opacity:p/100,position:{lat:o,lng:r}}):new google.maps.Marker({map:this.map,draggable:!1,title:i,position:{lat:o,lng:r}});return a.id=t,a.setAnimation(null),_.each(n,function(t){s[t.TriggerColumn]=e.get(t.TriggerColumn)}),a.viewState=s,i===l&&this.centerOnPoint(h,a),a},D.prototype.addPointsDefault=function(t){var e=this.api.getProperty("Points.Latitude"),i=this.api.getProperty("Points.Longitude"),o=this.api.getProperty("Points.Title"),e=t.get(e),i=t.get(i);e&&i&&(t=this.addNewMarker(t,t.id,o,e,i,null),this.markers.push(t),this.addEvents(t))},D.prototype.addPointCustomShape=function(t){var e=this.api.getProperty("Points.Latitude"),i=this.api.getProperty("Points.Longitude"),o=this.getMarkerImage(t),e=t.get(e),i=t.get(i),t=this.addNewMarker(t,t.id,"",e,i,o);this.markers.push(t),this.addEvents(t)},D.prototype.addEvents=function(t){this.addMarkerMouseInEvt(t),this.addMarkerMouseOutEvt(t),this.addMarkerClickEvt(t)},D.prototype.addPoints=function(){var e=this,t=this.pointcollection.models,i=_.map(this.markers,"id"),t=_.filter(t,function(t){return i.indexOf(t.id)<0}),o=this.api.getProperty("Points.Tracker"),r=""===o&&this.api.getProperty("Points.Cluster"),a=this.api.getProperty("Points.Shape");0<t.length&&!r?""!==o?this.addTrackedPoint():_.each(t,function(t){"default"===a?e.addPointsDefault(t):e.addPointCustomShape(t)}):r&&this.addMarkerClusters()},D.prototype.addMarkerClusters=function(){var i,o,r,a,s=this,t=this.api.getProperty("Points.ClusterSize"),e=this.api.getProperty("Points.ClusterShape");this.markerCluster&&(this.markerCluster.clearMarkers(),i=this.api.getProperty("Points.Latitude"),o=this.api.getProperty("Points.Longitude"),r=this.api.getProperty("Points.Title"),a=this.api.getProperty("Points.Shape"),this.markers=_.map(this.pointcollection.models,function(t){var e="default"!==a?s.getMarkerImage(t):null,t=s.addNewMarker(t,t.id,r,t.get(i),t.get(o),e);return s.addEvents(t),t})),this.markerCluster=new L(this.map,this.markers),"default"!==t&&(this.markerCluster.gridSize_=parseInt(t,10)),"default"!==e&&_.each(this.markerCluster.styles_,function(t){t.url="Images/blue"+e+".png"}),this.addMarkerClusterClickEvt()},D.prototype.addMarkerMouseOutEvt=function(t){var e=this;google.maps.event.addListener(t,"mouseout",function(){e.tooltip&&(e.api.removeTooltip(),delete e.tooltip)})},D.prototype.addMarkerClickEvt=function(a){var s=this,n=this.api.getProperty("Points.Actions");google.maps.event.addListener(a,"click",function(){var t=s.api.getProperty("Points.Zoom"),e=s.api.getProperty("Points.Selected"),i=s.api.getProperty("Points"),o={},r=_.filter(s.collection.models,function(t){return t.id===a.id});_.each(r,function(e){_.each(n,function(t){o[t.TriggerColumn]=e.get(t.TriggerColumn)})}),a.viewState=o,t&&(s.map.setZoom(s.map.zoom+1),s.map.panTo(a.getPosition())),""!==e&&s.api.setProperty("Points.Selected",s.title),i.Center&&(r=a.getPosition(),s.map.setCenter(r)),s.centerOnPoint(i,s),s.doAction("Click",a.viewState)})},D.prototype.addMarkerClusterClickEvt=function(){var p=this,l=this.api.getProperty("Points.TooltipData");google.maps.event.addListener(this.markerCluster,"clusterclick",function(t){if(21<=p.map.zoom){for(;!_.isEqual(p.infoBubble.tabs_,[]);)p.infoBubble.removeTab(0);_.each(t.getMarkers(),function(e){var t="<div>",i=p.pointcollection.models[e.id],o=void 0===l?p.api.getProperty("all"):l,r=h.compile(o),a="",s=p.api.getProperty("Points.TrackedItem");if(_.each(p.pointcollection.models,function(t){t.get("_rowIndex")===e.id&&(a=t.attributes)}),""!==a){var n={pointTitle:e.title,pointColor:_.get(e,"icon.fillColor")?_.get(e,"icon.fillColor"):"red",pointIcon:_.get(e,"icon.path")?_.get(e,"icon.path"):"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z",pointLatitude:e.position.lat(),pointLongitude:e.position.lng(),pointID:e.id},n=_.extend({},a,n),o=p.api.getTemplateViewStates(o);try{t='<div style="color:#000000">'+r(_.assignIn(n,o))+"</div>"}catch(t){}}t+="</div>",p.infoBubble.addTab(i.get(s),t)}),p.infoBubble.open(p.map,t.getMarkers()[0]),p.infoBubble.setPosition(t.getCenter()),p.infoBubble.clickEvent(),google.maps.event.addListener(p.infoBubble,"closeclick",function(){if(p.infoBubble.tabs_&&1<p.infoBubble.tabs_.length)for(var t=0;t<=p.infoBubble.tabs_.length;t+=1)p.infoBubble.removeTab(0)})}else p.markerCluster.maxZoom_=1,p.map.setCenter(t.getCenter()),p.map.fitBounds(t.getBounds())})},D.prototype.addMarkerMouseInEvt=function(a){var s=this,n=this.api.getProperty("Points.ShowTooltip"),p=this.api.getProperty("Points.TooltipData"),l=this.pointcollection.models;google.maps.event.addListener(a,"mouseover",function(t){var e=_.filter(l,function(t){return t.id===a.id});if(a.setOptions({opacity:1}),n){if(s.infoBubble||(s.infoBubble=s.options.app.infoBubble),s.infoBubble){if(s.infoBubble.tabs_&&1<s.infoBubble.tabs_.length)for(var i=0;i<=s.infoBubble.tabs_.length;i+=1)s.infoBubble.removeTab(0);var o=void 0===p?"":p,r=[];""!==o&&0<e.length&&(e=e[0],o=s.tooltipsConvert(o,e.attributes),r.push(e.attributes),e={pointTitle:a.title,pointColor:_.get(a,"icon.fillColor")?_.get(a,"icon.fillColor"):"red",pointIcon:_.get(a,"icon.path")?_.get(a,"icon.path"):"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z",pointLatitude:a.position.lat(),pointLongitude:a.position.lng(),pointID:a.id},t=s.app.getCanvasXY(t.latLng),s.tooltip=s.api.setTooltip({data:_.extend({},r[0],e),text:o,anchorEl:s.el,position:{left:t.x,top:t.y}}))}s.doAction("Hover",a.viewState)}})},D.prototype.updatePoints=function(){var o=this,e=_.map(this.markers,"id"),t=_.filter(this.pointcollection.models,function(t){return 0<=e.indexOf(t.id)}),r=this.api.getProperty("Points.Latitude"),a=this.api.getProperty("Points.Longitude"),s=this.api.getProperty("Points.Title"),n=this.api.getProperty("Points.Selected"),p="default"!==this.api.getProperty("Points.Shape"),l=this.api.getProperty("Points.Cluster");_.each(t,function(t){var e=t.get(r),i=t.get(a),e=new google.maps.LatLng(e,i);o.markers&&o.markers[t.id]&&(o.markers[t.id].setAnimation(null),o.markers[t.id].setPosition(e),p&&!l&&o.markers[t.id].setIcon(o.getMarkerImage(t)),t.get(s)===n&&o.centerOnPoint(t,o.markers[t.id]))}),l&&this.markerCluster&&this.markerCluster.repaint()},D.prototype.applyPoints=function(){this.cleanPoints(),this.addPoints(),this.updatePoints(),this.centerOnCollection(),this.infoBubble||(this.infoBubble=this.options.infoBubble)},D.prototype.doAction=function(e,o){var t=this.api.getProperty("Points.Actions"),r=[];_.each(t,function(i,t){i.Trigger===e&&("nav"===i._Type&&_.each(i.SelectDashboardScreen,function(t,e){i["SelectDashboardScreen."+e]=t}),r.push(_.extend({},i,{_PropertyIndex:t,Value:o[i.TriggerColumn]})))}),this.app.api.doActions(r,"Points.Actions")},D.prototype.hasDistinctMarkers=function(){for(var t,e,i=0,o=this.markers;i<o.length;i++){var r=o[i].getPosition(),a=r.lat(),r=r.lng();if(t&&e&&(1e-4<Math.abs(a-e[0])||1e-4<Math.abs(r-e[1])||1e-4<Math.abs(a-t[0])||1e-4<Math.abs(r-t[1])))return!0;e=t?(t=[Math.min(a,t[0]),Math.min(r,t[1])],[Math.max(a,e[0]),Math.max(r,e[1])]):(t=[a,r],[a,r])}return!1},D.prototype.centerOnCollection=function(){if(this.markers&&this.api.getProperty("Points.PointsInView")&&0!==this.markers.length){var t=new google.maps.LatLngBounds;if(this.hasDistinctMarkers()){for(var e=0;e<this.markers.length;e++)t.extend(this.markers[e].getPosition());this.map.fitBounds(t)}else{var i=this.markers[0].getPosition();this.map.setCenter({lat:i.lat(),lng:i.lng()}),this.map.setZoom(12),this.map.setCenter({lat:i.lat(),lng:i.lng()})}}},D.prototype.centerOnPoint=function(t,e){this.api.getProperty("Points.Center")&&(i=e.getPosition(),this.map.setCenter(i));var i=this.pointcollection.models[e.id];void 0!==e.icon&&i&&e.setIcon(this.getMarkerImage(i))},D.prototype.cleanPoints=function(){var e=_.map(this.pointcollection.models,"id");if(!this.api.getProperty("Points.Cluster")){for(var t=0;t<this.markers.length;t++)e.indexOf(this.markers[t].id)<0&&(this.markers[t].setMap(null),console.log("removed",this.markers[t].id));this.markers=_.filter(this.markers,function(t){return 0<=e.indexOf(t.id)})}},D.prototype.columSpecToColumnData=function(o){var r,a=this,s=[],n=[],p=[],l=[],h=[],d=[];_.defer(function(){var t,e,i;r=_.extend({},a.api.getProperty("Points")),_.each(o.models,function(t){s.push(t.get("id")),9!==t.get("kdbType")&&8!==t.get("kdbType")||n.push(t.get("id")),11===t.get("kdbType")&&(p.push(t.get("id")),l.push(t.get("id")),h.push(t.get("id")))}),l=$.merge(["use selected shape"],void 0===l?[]:l),d=$.merge(["use Rotation"],void 0===d?[]:d),h=$.merge(["use selected color"],void 0===h?[]:h),_.isEqual(n,a.api.getProperty("possibleFloats"))&&_.isEqual(p,a.api.getProperty("possibleStrings"))&&_.isEqual(s,a.api.getProperty("possibleTrack"))&&_.isEqual(h,a.api.getProperty("possibleColors"))&&_.isEqual(l,a.api.getProperty("possibleShapes"))||0<s.length&&(t=r.Longitude,e=r.Latitude,i=r.TrackedItem,0<=_.indexOf(n,"Long")?t="Long":n[1]&&(t=n[1]),0<=_.indexOf(n,"Lat")?e="Lat":n[0]&&(e=n[0]),0<=_.indexOf(s,"idx")?i="idx":s[0]&&(i=s[0]),r.Longitude=""===r.Longitude||void 0===r.Longitude||_.indexOf(n,r.Longitude)<0?t:r.Longitude,r.Latitude=""===r.Latitude||void 0===r.Latitude||_.indexOf(n,r.Latitude)<0?e:r.Latitude,r.ShapeDB=0<=_.indexOf(l,r.ShapeDB)?r.ShapeDB:l[0],r.ShapeColorDB=0<=_.indexOf(h,r.ShapeColorDB)?r.ShapeColorDB:h[0],r.Title=0<=_.indexOf(s,r.Title)?r.Title:s[0],r.TrackedItem=0<=_.indexOf(s,r.TrackedItem)?r.TrackedItem:i,a.api.setProperty("possiblePLatLong",n),a.api.setProperty("possibleString",p),a.api.setProperty("possibleShapes",l),a.api.setProperty("possibleColors",h),a.api.setProperty("possibleTrack",s),a.api.setProperty("all",s)),a.applyPoints()})},D.prototype.onRouteViewStateRouting=function(t,e,i){this.api.setProperty(t+"."+e+".ViewstateProperty",i)},D.prototype.toIsoDate=function(t){var e=t;return e=t&&t.i?p.Tools.convertKDBTemporalToMoment(t).toDashString():e},D.prototype.tooltipsConvert=function(t,e){var i=this,o="";return"object"==typeof t?_.each(t,function(t){void 0!==e[t]&&(o=o+"<div>"+t+" : "+i.tooltipsConvertType(e[t])+"</div>")}):o=t,o},D.prototype.tooltipsConvertType=function(t){t="object"==typeof t&&t.class?t.toDate():t;return t},D.prototype.updatePointsTracker=function(){var e=this,i=this.api.getProperty("Points.Tracker"),o=this.api.getProperty("Points.Latitude"),r=this.api.getProperty("Points.Longitude"),a=this.api.getProperty("Points.TrackedItem"),t=this.pointcollection.models;""!==i&&_.each(t,function(t){_.isEqual(e.toIsoDate(t.get(a)),i)&&(t=new google.maps.LatLng(t.get(o),t.get(r)),e.map.setCenter(t),e.markers[0].setPosition(t))})};var k,x=D;function D(t){var e=k.call(this,t)||this;return e.websiteUrl="",e.options=t,e.api=e.options.api,e.pointModel=e.options.model,e.$el=e.options.el,e.map=e.options.map,e.websiteUrl=e.options.websiteUrl,e.pointcollection=e.options.collection,e.viewModel=e.options.viewModel,e.markers=e.options.markers,e.infoBubble=e.options.infoBubble,e.api=e.options.api,e.app=e.options.app,e}B.compareKDBTimes=function(t,e){return t.i>e.i?1:t.i<e.i?-1:t.n>e.n?1:t.n<e.n?-1:0},B.expandNestedViewStates=function(t,e){var i=!1,o=Object.keys(t);if(i=1===o.length?(r=e.getPropertyMeta(o[0]))&&"viewstate"===r.type:i){var r=/^((?:\w+\.)*)(\d+)/.exec(o[0]);if(r)return i=r[1].slice(0,-1),o=e.getProperty(i),(r={})[i]=o,r}return t},B.focus2Array=function(t){var e=[],i=/"([^"]*)"/g,t=t.toString?t.toString():"",o=/^\[([^\]]*)]$/.exec(t);if(null!==o){if(/^(?:"[^"\\]*(?:\\[\S\s][^"\\]*)*")(?:,"[^"\\]*(?:\\[\S\s][^"\\]*)*")*/.test(o[1]))for(var r=void 0;null!==(r=i.exec(o[1]));)e.push(_.map(r[1].split(","),function(t){return t.replace(/&#44;/g,",")}))}else e.push(t.split(","));return _.filter(e,function(t){return 0<(""+t).length})},B.getConditionResult=function(t,e,i,o){var a={isMatch:function(t,e){var i,o=!1,r=t.split(/ +and +| +/);for(_.includes(r,"or")&&(r=_.without(r,"or"),o=!0),i=0;i<r.length;i++)0!==r[i].indexOf("-")&&r[i].indexOf("*")<0&&(r[i]="*"+r[i]+"*");return _[o?"some":"every"](r,function(t){return a.isSimpleMatch(t,e)})},isSimpleMatch:function(t,e){var i=!1,t=(0===t.indexOf("-")&&(t=t.replace("-",""),i=!0),new RegExp("^"+t.replace(/\*/g,".*")+"$").test(e));return i?!t:t}},r=!1,s=isNaN(parseFloat(t))?(""+t).toLowerCase():parseFloat(t),n=isNaN(parseFloat(e))?(""+e).toLowerCase():parseFloat(e);switch(i){case"contains":r=0<=s.toString().indexOf(n.toString());break;case"starts with":r=0===s.toString().indexOf(n.toString());break;case"ends with":r=-1!==s.toString().indexOf(n.toString(),s.toString().length-n.toString().length);break;case"==":r=s===n;break;case"<":r=s<n;break;case">":r=n<s;break;case"<=":r=s<=n;break;case">=":r=n<=s;break;case"!=":r=s!==n;break;case"search":r=a.isMatch(n,s);break;case"regexp":r=new RegExp(e.toString()).test(t.toString())}return r=o?!r:r},B.getHexSaturation=function(t,e){t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(!t)return"#ffffff";var i,o=t[1]?parseInt(t[1],16):0,r=t[2]?parseInt(t[2],16):0,a=t[3]?parseInt(t[3],16):0,t=Math.max(o,r,a),s=Math.min(o,r,a),n=t,p=t-s;if(t===s)i=0;else{switch(t){case o:i=(r-a)/p+(r<a?6:0);break;case r:i=(a-o)/p+2;break;case a:i=(o-r)/p+4}i/=6}s=.2+.8*e;var t=Math.floor(6*i),e=6*i-t,l=n*(1-s),h=n*(1-e*s),d=n*(1-(1-e)*s);switch(t%6){case 0:o=n,r=d,a=l;break;case 1:o=h,r=n,a=l;break;case 2:o=l,r=n,a=d;break;case 3:o=l,r=h,a=n;break;case 4:o=d,r=l,a=n;break;case 5:o=n,r=l,a=h}return o=parseInt(o.toString(),10),r=parseInt(r.toString(),10),a=parseInt(a.toString(),10),"#"+this.componentToHex(o)+this.componentToHex(r)+this.componentToHex(a)},B.getSaturatedArray=function(t){var p=this,t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(!t)return["#ffffff"];var l,h,e=t[1]?parseInt(t[1],16):0,i=t[2]?parseInt(t[2],16):0,o=t[3]?parseInt(t[3],16):0,t=Math.max(e,i,o),r=Math.min(e,i,o),d=t,a=t-r;if(t===r)l=0;else{switch(t){case e:l=(i-o)/a+(i<o?6:0);break;case i:l=(o-e)/a+2;break;case o:l=(e-i)/a+4}l/=6}var c=[];return _.each([.2,.28,.36,.44,.52,.6,.68,.76,.84,.92,.1],function(t){h=t;var e,i,o,t=Math.floor(6*l),r=6*l-t,a=d*(1-h),s=d*(1-r*h),n=d*(1-(1-r)*h);switch(t%6){case 0:e=d,i=n,o=a;break;case 1:e=s,i=d,o=a;break;case 2:e=a,i=d,o=n;break;case 3:e=a,i=s,o=d;break;case 4:e=n,i=a,o=d;break;case 5:e=d,i=a,o=s}e=parseInt(e,10),i=parseInt(i,10),o=parseInt(o,10),c.push("#"+p.componentToHex(e)+p.componentToHex(i)+p.componentToHex(o))}),c},B.componentToHex=function(t){t=t.toString(16);return 1===t.length?"0"+t:t},B.isDuration=function(t){return _.get(t,"_kdbType")&&0<=["1216","1217","1218","1219"].indexOf(t._kdbType)},B.getFormatter=function(o,r,a,s){return"Number"===o||"Formatted Number"===o||"Smart Number"===o||"Datetime"===o||"Currency"===o||"SmartCurrency"===o?function(t){var e,i=t;if(null==(t="Smart Number"!==o&&"Formatted Number"!==o||_.isNumber(t)?t:_.isNumber(parseFloat(t))?parseFloat(t):t))return"";if("Smart Number"===o)i=_.isNumber(t)?p.Tools.smartFormatNumber(t,r):_.escape(t);else{if("Datetime"===o)return e=t,moment.isMoment(t)||moment.isDuration(t)?(B.isDuration(t)?p.Tools.convertValueToMoment(t.valueOf()):t).format(s):p.Tools.isKDBTemporal(t)?p.Tools.convertKDBTemporalToMoment(t).format(s):("number"==typeof t&&(e=new Date(t)),p.Tools.convertDateStringValueToMoment(e.toString()).format(s));i="Formatted Number"===o&&t.toFixed?_.isNaN(t)?"":p.Tools.formatNumber(t,r):t.toFixed?t.toFixed(r):_.escape(i)}if(a&&0<=i.toString().indexOf(".")){for(;"0"===i[i.length-1];)i=i.slice(0,-1);"."===i[i.length-1]&&(i=i.slice(0,-1))}return i}:"Boolean"===o?function(t){return _.escape(t)}:function(t){return moment.isMoment(t)||moment.isDuration(t)?t.format(o,void 0):_.escape(t)}},B.pump=function(i){if(null==i)return i;if(!_.isObject(i))return i;var t=Object.getPrototypeOf(i);if(_.isObject(i)&&t!==Object.prototype&&t!==Array.prototype)return i;if(t===Array.prototype&&_.isArray(i))return i.map(B.pump);var o=/^(\d+)((?:\.\w+)+)$/;if(Object.keys(i).every(function(t){return o.test(t)}))return Object.keys(i).map(function(t){var e=o.exec(t);return _.isNil(e)?{index:0,tail:void 0,value:void 0}:{index:Number(e[1]),tail:e[2].substring(1),value:i[t]}}).reduce(function(t,e){var i={},o=void 0===e.index?0:e.index;return i[o]={},i[o][e.tail]=e.value,$.extend(!0,t,B.pump(i))},[]);var r={greedy:/^(\w+)((?:\.\w+)*)$/,nonGreedy:/^(\w+)((?:\.\w+)+)$/};return Object.keys(i).some(function(t){return r.nonGreedy.test(t)})?Object.keys(i).map(function(t){var e=r.greedy.exec(t);return{head:_.isNil(e)?null:e[1],tail:_.isNil(e)||""===e[2]?null:e[2].substring(1),value:i[t]}}).reduce(function(t,e){var i={},o=null!==e.tail,r=_.isNil(e.head)?0:e.head,a=_.isNil(e.tail)?0:e.tail;return o?(i[r]={},i[r][a]=e.value):i[r]=e.value,$.extend(!0,t,B.pump(i))},{}):_.mapValues(i,B.pump)},B.replaceViewStatesWithValue=function(t,e,i){return B.replaceViewStates(t,e,function(t,e,i,o){return o.value},i)},B.replaceViewStatesWithModel=function(t,e,o){return B.replaceViewStates(t,e,function(t,e,i){if(i instanceof d.Model&&i.get("_viewType"))return i;t=o.getProperty(t)[e];return _.isUndefined(i)?void 0:(t.get("value")!==i&&t.set("value",i),t)},o)},B.replaceViewStates=function(i,t,p,l){var h;return h=function(t,e){return function i(t,e,o){o=o?o+".":"";var r,a,s=l.getPropertyMeta(o+(e+="")),n=t&&t.has&&t.has("_dataSource")&&t.has("_dataType"),n=(_.isArray(t)||_.isObject(t))&&!n;return s&&"data"===s.type?t:s&&"viewstate"===s.type?(r=(a=(o+e).split(".")).pop(),a=a.join("."),p(a,void 0===r?"":r,t,s)):n?(o+=e,h=function(t,e){return i(t,e,o)},(_.isArray(t)?_.map:_.mapValues)(t,h)):t}(t,e,i||"")},(_.isArray(t)?_.map:_.mapValues)(t,h)};var I=B;function B(){}var z,A=[];function V(t){var e=z.call(this,t)||this;return e.markers=[],e.websiteUrl="",e.isPivot=!1,e.firstTime=!0,e.rectangle=[],e.heatmapprimaryKey="_rowIndex",e.options=t,V.viewModel=t.viewModel,e.api=t.api,e.$el.html(r.app()),e.$root=e.$el.find(">.GeoMap"),e.$frame=e.$el.find(".frame"),e.$title=e.$el.find(".title"),e.$map=e.$el.find(".googleMap"),e.hideErrorMessage=t.api.hideErrorMessage,e.showErrorMessage=t.api.showErrorMessage,e.websiteUrl=void 0===t.websiteUrl?window.location.href:t.websiteUrl,e.id=t.componentModel.cid,e}return z=d.View,e(V,z),V.prototype.initPointsCollection=function(){this.pointprimaryKey="_rowIndex",this.pointcollection=new d.Collection([],{model:d.Model.extend({idAttribute:this.pointprimaryKey})}),this.pointcolumnInfo=new d.Collection([],{model:d.Model.extend({idAttribute:"id"})}),this.pointcollection.id=this.pointprimaryKey,this.pointcolumnInfo.id="id",this.pointcolumnInfo.comparator="index",this.pointsSrc=this.api.getProperty("Points").Data},V.prototype.onSettingsChange=function(t){this.firstTime&&(this.firstTime=!1,this.applyTheme());t=I.expandNestedViewStates(t,this.api),t=I.replaceViewStatesWithValue("",t,this.api),t=I.pump(t);this.onSettingsChangeProcessed.call(this,t)},V.prototype.onSettingsChangeProcessed=function(t){var e,i,o,r,a,s=this;_.get(t,"MapDetails.MapKey")&&this.loadMapAPI(),"undefined"!=typeof google?this.updateGoogleAPIDependentSettings(t):(e=0,i=setInterval(function(){"undefined"!=typeof google&&(s.updateGoogleAPIDependentSettings(t),window.clearInterval(i)),5==++e&&window.clearInterval(i)},500)),_.isNil(_.get(t,"MapDetails.Style"))||this.applyTheme(),this.map&&(r=!_.isNil(_.get(t,"MapDetails.CenterX")),a=!_.isNil(_.get(t,"MapDetails.CenterY")),(r||a)&&(o=this.map.getCenter(),r=r?Number(this.api.getProperty("MapDetails.CenterX")):o.lat(),a=a?Number(this.api.getProperty("MapDetails.CenterY")):o.lng(),this.map.setCenter({lat:r,lng:a})))},V.prototype.updateGoogleAPIDependentSettings=function(t){var e=this;_.get(t,"Points.Data")?(this.pointsView||this.initPoints(),this.pointsSrc=this.api.getProperty("Points").Data,this.applyDataProperty(this.pointsSrc,"point")):_.get(t,"Points.Tracker")&&this.pointsView?this.pointsView.updatePointsTracker():_.get(t,"Points.PointsInView")&&this.pointsView?this.pointsView.centerOnCollection():_.get(t,"Points")&&this.pointsView&&this.pointsView.applyPoints(),!_.isNil(_.get(t,"MapDetails.Style"))&&this.pointsView&&this.setMapStyle(),_.get(t,"Circles.Data")&&this.pointsView&&(this.circlesSrc=this.api.getProperty("Circles").Data,this.applyDataProperty(this.circlesSrc,"circles")),_.get(t,"Circles.Latitude")&&this.pointsView&&this.circlesView.applyCircles(),_.get(t,"Circles.Latitude")&&this.pointsView&&this.circlesView.applyCircles(),_.get(t,"Heatmap.Data")&&(""===this.api.getProperty("Heatmap").Data&&this.heatmapView.cleanHeatmap(),this.heatmapSrc=this.api.getProperty("Heatmap").Data,this.applyDataProperty(this.heatmapSrc,"heatmap")),_.get(t,"Heatmap")&&this.heatmapView.applyHeatmap(),_.get(t,"OverLay.layerProperties.Data")&&(this.dataSrc=this.api.getProperty("OverLay.layerProperties").Data,""===this.dataSrc?(this.overlayView.$el.find(".over").remove(),this.overlayView.data.forEach(function(t){e.overlayView.data.remove(t)}),this.overlayView.overlay.setMap(null)):this.applyDataProperty(this.dataSrc,"overlay")),(_.get(t,"OverLay.layerProperties.DataGeo")||_.get(t,"OverLay.layerProperties.GeoColumn"))&&_.get(this.overlayView,"overlay.draw")&&this.overlayView.overlay.draw("updateLayer"),(_.get(t,"OverLay.layerProperties.DataKey")||_.get(t,"OverLay.layerProperties.DataValue")||_.get(t,"OverLay.layerProperties.LayerOpacity")||_.get(t,"OverLay.layerProperties.ShowLegend")||_.get(t,"OverLay.layerProperties.LegendType")||_.get(t,"OverLay.layerProperties.Selected"))&&_.get(this.overlayView,"overlay")&&this.overlayView.overLaySetStyle(),(_.get(t,"OverLay.layerProperties.Bounds")||_.get(t,"OverLay.layerProperties.ImageSr")||_.get(t,"OverLay.layerProperties.ImageNorth")||_.get(t,"OverLay.layerProperties.ImageSouth")||_.get(t,"OverLay.layerProperties.ImageEast")||_.get(t,"OverLay.layerProperties.ImageWest")||_.get(t,"OverLay.layerProperties.ImageOpacity")||_.get(t,"OverLay.SelectedObjectRoutingd"))&&_.get(this.overlayView,"overlay")&&this.overlayView.applyOverlay(),(_.get(t,"Lines.Latitude")||_.get(t,"Lines.Longitude")||_.get(t,"Lines.Selected")||_.get(t,"Lines.ShowTooltip")||_.get(t,"Lines.LabelColor")||_.get(t,"Lines.LabelSize")||_.get(t,"Lines.LabelText")||_.get(t,"Lines.ShowLabel")||_.get(t,"Lines.Geodesic"))&&this.lineView&&this.lineView.applyLine(),_.get(t,"Lines.Data")&&(this.linesSrc=this.api.getProperty("Lines").Data,this.applyDataProperty(this.linesSrc,"line")),_.get(t,"Bounds")&&this.applyBounds(),_.get(t,"MapDetails.Bounds")&&this.boundsChanged(),(_.get(t,"MapDetails.Type")||_.get(t,"Basics.Theme"))&&this.applyTheme()},V.prototype.applyDataProperty=function(t,e){var i;"line"===e&&(i=this.lnModel),"circle"===e&&(i=this.circlesModel),"point"===e&&(i=this.pointcollection),"heatmap"===e&&(i=this.heatmapModel),(i="overlay"===e?this.dataModel:i)&&(this.stopListening(i),this.api.unsubscribe(i)),i=t,"line"===e&&this.api.subscribe(i,this.onDataLn.bind(this)),"overlay"===e&&this.api.subscribe(i,this.onDataOl.bind(this)),"point"===e&&this.api.subscribe(i,this.onDataPt.bind(this)),"circles"===e&&this.api.subscribe(i,this.onDataCir.bind(this)),"heatmap"===e&&this.api.subscribe(i,this.onDataHm.bind(this))},V.prototype.onDataLn=function(t,e){this.onData(t,e,"line")},V.prototype.onDataOl=function(t,e){this.onData(t,e,"overlay")},V.prototype.onDataCir=function(t,e){this.onData(t,e,"circles")},V.prototype.onDataPt=function(t,e){this.onData(t,e,"point")},V.prototype.onDataHm=function(t,e){this.onData(t,e,"heatmap")},V.prototype.loadMapAPI=function(){var e,i=this,o=this.api.getProperty("MapDetails.MapKey");""!==o?(window.initMap=function(){_.each(A,function(t){t.initializeMaps()}),A=[]},(e=document.createElement("script")).src="https://maps.googleapis.com/maps/api/js?key="+o+"&v=weekly&libraries=visualization,geometry&callback=initMap",e.defer=!0,e.async=!0,e.id="gMaps",o=document.getElementsByTagName("script"),A.push(this),void 0===_.find(o,{id:"gMaps"})?document.head.appendChild(e):1===A.length&&(this.initializeMaps(),A=[]),this.api.hideQueryStatus()):_.defer(function(){i.api.showQueryStatus({message:t('Required: Set Google Maps JavaScript API Key in "Map Key" Property'),type:"Warning"})},500)},V.prototype.initializeMapEvents=function(){var e=this,t=this.api.getProperty("MapDetails");google.maps.event.trigger(this.map,"resize"),this.map.addListener("center_changed",function(){t.TrackChanges&&e.map.center&&(e.api.setProperty("MapDetails.CenterX",e.map.center.lat()),e.api.setProperty("MapDetails.CenterY",e.map.center.lng())),e.setBounds()}),this.map.addListener("zoom_changed",function(){t.TrackChanges&&e.api.setProperty("MapDetails.Zoom",e.map.zoom),e.setBounds()}),this.map.addListener("tilesloaded",function(){e.setBounds()}),this.map.addListener("maptypeid_changed",function(){t.TrackChanges&&e.api.setProperty("MapDetails.Type",e.map.mapTypeId)}),this.api.getProperty("MapDetails.CustomMarkers")&&this.addDropPoint(),google.maps.event.addListener(this.map,"rightclick",function(t){return e.addContextMenu(t.latLng),t.preventDefault(),t.stopPropogation(),!1})},V.prototype.initializeMaps=function(){var e=this,t=(this.boundsChanged=_.throttle(function(){var t;""!==e.api.getProperty("MapDetails.Bounds")&&4===(t="string"==typeof(t=e.api.getProperty("MapDetails.Bounds"))?t.split(","):t).length&&.1<Math.abs(parseFloat(t[2])-e.map.getBounds().getNorthEast().lat())&&e.map.fitBounds(new google.maps.LatLngBounds(new google.maps.LatLng(parseFloat(t[0]),parseFloat(t[1])),new google.maps.LatLng(parseFloat(t[2]),parseFloat(t[3]))))},1e3),this.setBounds=_.debounce(function(){var t=e.map.getBounds().toUrlValue().split(",");""!==e.api.getProperty("MapDetails.Bounds")&&e.api.setProperty("MapDetails.Bounds",t)},500),this.infoBubble=new l({content:"",arrowSize:0}),this.api.getProperty("MapDetails.Style").replace(/(['"])?([a-zA-Z0-9]+)(['"])?:/g,'"$2":')),i=this.api.getProperty("MapDetails.CenterX"),o=this.api.getProperty("MapDetails.CenterY"),r=this.api.getProperty("MapDetails.Type"),a=this.api.getProperty("MapDetails.Zoom"),s=n.select(this.$frame.find(".googleMap")[0]).node(),s=new google.maps.Map(s,{center:new google.maps.LatLng(i,o),mapTypeControlOptions:{mapTypeIds:["roadmap","satellite","hybrid","terrain","light_theme","dark_theme"]},mapTypeId:google.maps.MapTypeId[r.toUpperCase()]||"terrain",zoom:a});""!==t&&s.setOptions({styles:JSON.parse(t)}),this.rectangle=[],this.map=s,this.initPoints(),this.initCircles(),this.initHeatmap(),this.initOverlay(),this.initLine(),this.initializeMapEvents()},V.prototype.setMapStyle=function(){var i=this,e=this.api.getProperty("MapDetails.Style").replace(/(['"])?([a-zA-Z0-9]+)(['"])?:/g,'"$2":');try{this.api.hideQueryStatus();var o=""===e?[]:JSON.parse(e);this.map&&this.map.setOptions({styles:o})}catch(e){_.defer(function(){i.api.showQueryStatus({message:t("Map Style format: "+e),type:"Warning"})},500)}},V.prototype.initLine=function(){this.lineprimaryKey="_rowIndex",this.linecollection=new d.Collection([],{model:d.Model.extend({idAttribute:this.lineprimaryKey})}),this.linecolumnInfo=new d.Collection([],{model:d.Model.extend({idAttribute:"id"})}),this.linecollection.id=this.lineprimaryKey,this.linecolumnInfo.id="id",this.linecolumnInfo.comparator="index",this.linesSrc=this.api.getProperty("Lines").Data,this.initLineView()},V.prototype.initLineView=function(){this.lineView=new S({el:this.$el,api:this.api,map:this.map,collection:this.linecollection})},V.prototype.initOverlay=function(){this.dataprimaryKey="_rowIndex",this.datacollection=new d.Collection([],{model:d.Model.extend({idAttribute:this.dataprimaryKey})}),this.datacolumnInfo=new d.Collection([],{model:d.Model.extend({idAttribute:"id"})}),this.datacollection.id=this.dataprimaryKey,this.datacolumnInfo.id="id",this.datacolumnInfo.comparator="index",this.dataSrc=_.get(this.api.getProperty("OverLay"),"layerProperties.Data"),this.initOverlayView()},V.prototype.initOverlayView=function(){this.overlayView&&this.overlayView.removeOverlay(),this.overlayView=new C({el:this.$el,api:this.api,map:this.map,overlaySrc:this.dataSrc,dataModel:this.dataModel,websiteUrl:this.websiteUrl,datacollection:this.datacollection})},V.prototype.initHeatmap=function(){this.heatmapprimaryKey="_rowIndex",this.heatmapcollection=new d.Collection([],{model:d.Model.extend({idAttribute:this.heatmapprimaryKey})}),this.heatmapcolumnInfo=new d.Collection([],{model:d.Model.extend({idAttribute:"id"})}),this.heatmapcollection.id=this.heatmapprimaryKey,this.heatmapcolumnInfo.id="id",this.heatmapcolumnInfo.comparator="index",this.heatmapSrc=this.api.getProperty("Heatmap").Data,this.initHeatmapView()},V.prototype.initHeatmapView=function(){this.heatmapView=new f({el:this.$el,api:this.api,map:this.map,collection:this.heatmapcollection})},V.prototype.initCircles=function(){this.circlesprimaryKey="_rowIndex",this.circlescollection=new d.Collection([],{model:d.Model.extend({idAttribute:this.circlesprimaryKey})}),this.circlescolumnInfo=new d.Collection([],{model:d.Model.extend({idAttribute:"id"})}),this.circlescollection.id=this.circlesprimaryKey,this.circlescolumnInfo.id="id",this.circlescolumnInfo.comparator="index",this.circlesSrc=this.api.getProperty("Circles.Data"),this.initCirclesView()},V.prototype.initCirclesView=function(){this.circlesView=new y({api:this.api,collection:this.circlescollection,el:this.$el,map:this.map}),this.circlesView.applyCircles()},V.prototype.initPoints=function(){this.initPointsCollection(),this.initPointsView()},V.prototype.initPointsView=function(){this.pointsView=new x({el:this.$el,api:this.api,map:this.map,markers:this.markers,websiteUrl:this.websiteUrl,collection:this.pointcollection,infoBubble:this.infoBubble,app:this})},V.prototype.applyTheme=function(){var t=this.api.getProperty("Basics.Theme"),e=this.api.getProperty("MapDetails.Type"),i=this.api.getProperty("MapDetails.Style");this.map&&e&&(this.map.setMapTypeId(e),e="Light"===t?V.RETRO_THEME:V.STANDARD_THEME,""!==i&&i!==V.RETRO_THEME&&i!==V.STANDARD_THEME||(this.api.setProperty("MapDetails.Style",e),this.map.setOptions({styles:JSON.parse(e)})))},V.prototype.getCanvasXY=function(t){var e=Math.pow(2,this.map.getZoom()),i=new google.maps.LatLng(this.map.getBounds().getNorthEast().lat(),this.map.getBounds().getSouthWest().lng()),i=this.map.getProjection().fromLatLngToPoint(i),t=this.map.getProjection().fromLatLngToPoint(t);return new google.maps.Point(Math.floor((t.x-i.x)*e),Math.floor((t.y-i.y)*e))},V.prototype.onData=function(e,t,i){var o,r,a,s,n,p=!1,l=e.columns;"heatmap"===i?(a=this.heatmapcollection,n=this.heatmapcolumnInfo,s=this.heatmapSrc||""===this.heatmapSrc?this.api.getProperty("Heatmap").Data:this.heatmapSrc):"circles"===i?(a=this.circlescollection,n=this.circlescolumnInfo,s=this.circlesSrc||""===this.circlesSrc?this.api.getProperty("Circles").Data:this.circlesSrc):"point"===i?(a=this.pointcollection,n=this.pointcolumnInfo,s=this.pointsSrc||""===this.pointsSrc?this.api.getProperty("Points").Data:this.pointsSrc):"overlay"===i?(a=this.datacollection,n=this.datacolumnInfo,s=this.dataSrc||""===this.dataSrc?this.api.getProperty("OverLay.layerProperties").Data:this.dataSrc):"line"===i&&(a=this.linecollection,n=this.linecolumnInfo,s=this.linesSrc||""===this.linesSrc?this.api.getProperty("Lines").Data:this.linesSrc),void 0!==s&&""!==s&&(l.reset?n.reset(e.columns.reset):(n.remove(_.map(l.remove,function(t){return t[e.primaryKey]})),n.add(l.add),n.add(l.change,{merge:!0})),o=_.some(["add","remove","reset","change"],function(t){return void 0!==l[t]}),n.sort(),r=_.map(n.models,function(t){return t.get("id")}),(r=this.isPivot&&void 0===s.get("_breakdownCols")?r:s.get("_breakdownCols"))instanceof d.Model&&(r=r.get("value")),o&&("line"===i&&this.lineView&&this.lineView.columSpecToColumnData(n,a),"point"===i?this.pointsView&&this.pointsView.columSpecToColumnData(n,a):"overlay"===i?this.overlayView&&this.overlayView.columSpecToColumnData(n,a):"heatmap"===i?this.heatmapView&&this.heatmapView.columSpecToColumnData(n,a):"circles"===i&&this.circlesView&&this.circlesView.columSpecToColumnData(n,a)),p=(t.reset?a.reset(t.reset):(a.remove(_.map(t.remove,function(t){return t[e.primaryKey]})),a.add(t.add),a.add(t.change,{merge:!0})),!0),"line"===i?this.linecollection=a:"point"===i?this.pointcollection=a:"circles"===i?this.circlescollection=a:"heatmap"===i?this.heatmapcollection=a:"overlay"===i&&(this.datacollection=a),p&&("point"===i?this.pointsView.applyPoints():"circles"===i?this.circlesView.applyCircles():"heatmap"===i?this.heatmapView.applyHeatmap():"overlay"===i?this.overlayView.overlay.draw("updateLayer"):"line"===i&&this.lineView.applyLine()))},V.prototype.addContextMenu=function(t){var e=this,i=document.createElement("div");this.$el.find(".contextmenu").remove(),i.className="contextmenu",i.innerHTML='<div><img class="closecontextMenu" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuOWwzfk4AAAHQSURBVDhPfZM7S0NBEIVvEtCgGNDC0kIJ2NnGQhTERxC0MXaCWJlgOgtBktyb98NGopWNIIhE9B8o+BdEGzsVU4gvkPhISOK3ya7cxOjAYWbPnJm7O3dXa7ZEItFtGMYEWNN1fSccDmeJV8FwKBSyS9lvy+Vytmg0OoXoMhgMfuCrJlTg3vBnsVhsEG+VZXUTxZC+QCDQXNgK+UgkMilL6xaPx2dJfDYJ/8NzKpVy1opZ9IJrleTceUPX99lyWXHEJWawS+7FxB37/f52jcQciy8lROSlexf8nmxSZJARfAfcNr4itOAB3ikaRCWhOufhRjKZTCeCLeJ1eDvxArmfHYAKQ58RDQ5MpGpyL5pUq1ULayuYhyuYNQLsdqNlA1Ck+wojsng8HhtfT8njNOjE7jS6GGYSYUme2c7vmsa7gAOxmonSlfmIW+zADVH7hYKkYYxYnbnA+gnNOJyD+EjoJPKgX/zGHoRXkqwgOuXLXjjzwG5puIS/UBxND/Ft6i6MUfCqksQlFbfiuLE3yWSyr1YsTAyKxDKidyX6C+zwDu+SpQ1m4aGMIjinkXg45kJxeR7JnaTT6QGpb20IHZx3CO/DZ/GbFC7ixStses6a9g15deRblCQyrwAAAABJRU5ErkJggg==" /><a class="addPoint">Add Point</a><a class="centreMap">Centre Map</a></div>',$(this.map.getDiv()).append(i),this.setMenuXY(t),i.style.visibility="visible",this.$el.find(".addPoint").click(function(){e.api.setProperty("dropPoint",t),e.api.getProperty("MapDetails.CustomMarkers")&&(e.api.setProperty("MapDetails.CustomMarkers",t),e.addDropPoint()),e.$el.find(".contextmenu")&&e.$el.find(".contextmenu").remove()}),this.$el.find(".centreMap").click(function(){e.map.setCenter(t),e.$el.find(".contextmenu")&&e.$el.find(".contextmenu").remove()}),this.$el.find(".closecontextMenu").click(function(){e.$el.find(".contextmenu")&&e.$el.find(".contextmenu").remove()})},V.prototype.setMenuXY=function(t){var e=this.$el.width(),i=this.$el.height(),o=this.$el.find(".contextmenu").width(),r=this.$el.find(".contextmenu").height(),t=this.getCanvasXY(t),a=t.x,t=t.y;(e=_.isNil(e)?0:e)-a<(o=_.isNil(o)?0:o)&&(a-=o),(i=_.isNil(i)?0:i)-t<(r=_.isNil(r)?0:r)&&(t-=r),this.$el.find(".contextmenu").css("left",a),this.$el.find(".contextmenu").css("top",t)},V.prototype.addDropPoint=function(){var t,e,i=this.api.getProperty("MapDetails");i.CustomMarkers&&""!==(e="string"==typeof(e=i.CustomMarkers.get("value"))&&2===(t=e.replace(")","").replace("(","").split(",")).length?new google.maps.LatLng(parseFloat(t[0]),parseFloat(t[1])):e)&&(this.dropmarker&&this.dropmarker.setMap(null),i.CustomMarkers.set("_default",e),this.dropmarker=new google.maps.Marker({map:this.map,draggable:!1,title:"",position:e}),this.dropmarker.id="drop")},V.prototype.applyBounds=function(){var o=this,t=this.api.getProperty("Bounds");_.each(this.rectangle,function(t){t.setMap(null)}),_.each(t,function(t,i){_.isEmpty(t)||(t={north:parseFloat(o.api.getProperty("Bounds."+i+".North")),south:parseFloat(o.api.getProperty("Bounds."+i+".South")),east:parseFloat(o.api.getProperty("Bounds."+i+".East")),west:parseFloat(o.api.getProperty("Bounds."+i+".West"))},o.rectangle[i]?o.rectangle[i]=new google.maps.Rectangle({bounds:t,editable:!0,draggable:!0}):(t=new google.maps.Rectangle({bounds:t,editable:!0,draggable:!0}),o.rectangle.push(t)),o.rectangle[i].setMap(o.map),google.maps.event.clearInstanceListeners(o.rectangle[i]),o.rectangle[i].addListener("bounds_changed",function(){var t=o.rectangle[i],e=t.getBounds().getNorthEast(),t=t.getBounds().getSouthWest();o.api.setProperty("Bounds."+i+".North",e.lat()),o.api.setProperty("Bounds."+i+".South",t.lat()),o.api.setProperty("Bounds."+i+".East",e.lng()),o.api.setProperty("Bounds."+i+".Wesr",t.lng())}))})},V.getComponentDefinition=i.getComponentDefinition,V.STANDARD_THEME="[]",V.RETRO_THEME='[ { "elementType": "geometry", "stylers": [ { "color": "#ebe3cd" } ] }, { "elementType": "labels.text.fill", "stylers": [ { "color": "#523735" } ] }, { "elementType": "labels.text.stroke", "stylers": [ { "color": "#f5f1e6" } ] }, { "featureType": "administrative", "elementType": "geometry.stroke", "stylers": [ { "color": "#c9b2a6" } ] }, { "featureType": "administrative.land_parcel", "elementType": "geometry.stroke", "stylers": [ { "color": "#dcd2be" } ] },  { "featureType": "administrative.land_parcel", "elementType": "labels.text.fill",  "stylers": [ { "color": "#ae9e90" } ] }, { "featureType": "landscape.natural", "elementType": "geometry", "stylers": [ { "color": "#dfd2ae" } ] },  { "featureType": "poi", "elementType": "geometry", "stylers": [ { "color": "#dfd2ae" } ] },  { "featureType": "poi", "elementType": "labels.text.fill", "stylers": [ { "color": "#93817c" } ] },  { "featureType": "poi.park", "elementType": "geometry.fill", "stylers": [ { "color": "#a5b076" } ] }, { "featureType": "poi.park", "elementType": "labels.text.fill", "stylers": [ { "color": "#447530" } ] },  { "featureType": "road", "elementType": "geometry", "stylers": [ { "color": "#f5f1e6" } ] },  { "featureType": "road.arterial", "elementType": "geometry", "stylers": [ { "color": "#fdfcf8" } ] },  { "featureType": "road.highway", "elementType": "geometry", "stylers": [ { "color": "#f8c967" } ] },  { "featureType": "road.highway", "elementType": "geometry.stroke", "stylers": [ { "color": "#e9bc62" } ] },  { "featureType": "road.highway.controlled_access", "elementType": "geometry",  "stylers": [ { "color": "#e98d58" } ] }, { "featureType": "road.highway.controlled_access", "elementType": "geometry.stroke", "stylers": [ { "color": "#db8555" } ] },  { "featureType": "road.local", "elementType": "labels.text.fill", "stylers": [ { "color": "#806b63" } ] }, { "featureType": "transit.line", "elementType": "geometry", "stylers": [ { "color": "#dfd2ae" } ] },  { "featureType": "transit.line", "elementType": "labels.text.fill", "stylers": [ { "color": "#8f7d77" } ] }, { "featureType": "transit.line", "elementType": "labels.text.stroke", "stylers": [ { "color": "#ebe3cd" } ] }, { "featureType": "transit.station", "elementType": "geometry", "stylers": [ { "color": "#dfd2ae" } ] },  { "featureType": "water", "elementType": "geometry.fill", "stylers": [ { "color": "#b9d3c2" } ] }, { "featureType": "water", "elementType": "labels.text.fill", "stylers": [ { "color": "#92998d" } ] }]',V});