define(["backbone","Forms","Handlebars","QuickBase","log","css!./css/main.css"],function(s,l,n,a,W){"use strict";var o,e=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),r=(d.transformFn=function(i,e,t,o){"Basics.Data"===t?i.Basics.Data?i.Basics.Data.getMeta(function(e){var e=_.fromPairs(_.map(e.columns.collection.models,function(e){return[e.get("id"),e.toJSON()]})),t=_.keys(e),e=_.find(e,function(e){return 0===e.kdbType||11===e.kdbType});i.dropdownPossibleValues&&i.dropdownPossibleValues.sort()!==t.sort()&&(i.dropdownPossibleValues=t,i.Basics.DataSourceMapping.Value=t[0]||"",i.Basics.DataSourceMapping.Text=e&&e.id||t[0]||""),o(i)}):(i.dropdownPossibleValues=[],i.Basics.DataSourceMapping.Value="",i.Basics.DataSourceMapping.Text="",o(i)):o()},d.getDefinition=function(e){var t,i,o={id:16,componentName:"dropdown",componentDescription:"classic combobox",appKey:"BasicComponents",listViewThumb:e.websiteUrl+"Images/dropdown.png",ghostViewThumb:null,buildViewThumb:null,appArgs:{json:{version:"4.4.1",dropdownPossibleValues:[""],Basics:{Data:"",SelectedValue:"",ComponentName:"dropdown",DataSourceMapping:{Value:"",Text:""},Items:[],Width:100,Theme:"Dark",Label:"select:",LabelWidth:75,MultiSelect:!1,ShowSearch:!1,AdvancedSearch:!1,AcceptEmptyValues:!1,ForceSelectedValue:!1,FieldSummaryThreshold:5,TooltipSummaryThreshold:10,SelectAllValue:"",horizontal:"Center",vertical:"Middle",tooltip:""},Actions:[],Style:{advanced:""}},schema:{type:"object",title:"Properties",_transform:d.transformFn,properties:{dropdownPossibleValues:{type:"array",format:"table",items:{type:"string"},default:[""],options:{collapsed:!1,hidden:!0}},Basics:{type:"object",title:"Basics",options:{collapsed:!1},properties:{Data:{type:"data",title:"Data Source",default:"",propertyOrder:1},SelectedValue:{type:"viewstate",title:"Selected Value",default:"",propertyOrder:2},Label:{title:"Label",type:"string",default:"select:",propertyOrder:3},AcceptEmptyValues:{type:"boolean",title:"Accept Empty Values",default:!1,format:"checkbox",propertyOrder:5},ForceSelectedValue:{type:"boolean",title:"Force Selected Value",default:!1,format:"checkbox",propertyOrder:6},MultiSelect:{type:"boolean",title:"Multi-select",default:!1,format:"checkbox",propertyOrder:7},ShowRowCount:{type:"boolean",title:"Show row count",default:!1,format:"checkbox",propertyOrder:7,options:{hidden:!0}},ShowSearch:{type:"boolean",title:"Show Search",default:!1,format:"checkbox",propertyOrder:8},AdvancedSearch:{type:"boolean",title:"Advanced Search",default:!1,format:"checkbox",propertyOrder:8},Flex:{type:"boolean",title:"Fill available space",default:!1,format:"checkbox",propertyOrder:9,options:{hidden:!0}},horizontal:{type:"string",title:"Horizontal",enum:["Left","Center","Right"],propertyOrder:9},vertical:{type:"string",title:"Vertical",enum:["Top","Middle","Bottom"],propertyOrder:10},tooltip:{title:"Tooltip",type:"string",default:"",propertyOrder:11},Width:{title:"Width",type:"number",propertyOrder:12},EnableDropdownHeight:{type:"boolean",title:"Enable Dropdown Height",default:!1,format:"checkbox",propertyOrder:12,options:{hidden:!0}},DropdownHeight:{title:"Dropdown Height",type:"number",propertyOrder:12,options:{hidden:!0}},LabelWidth:{title:"Label Width",type:"number",default:100,propertyOrder:13},FieldSummaryThreshold:{title:"Field Summary Threshold",type:"number",propertyOrder:14},TooltipSummaryThreshold:{title:"Tooltip Summary Threshold",type:"number",propertyOrder:15},SelectAllValue:{title:"'Select All' Value",type:"string",propertyOrder:16},ComponentName:{title:"Component",type:"string",default:"dropdown",options:{hidden:!0}},Theme:{type:"string",title:"Theme",options:{hidden:!0},enum:["Light","Dark"]},DataSourceMapping:{type:"object",title:"Data Source Mapping",options:{collapsed:!0},properties:{Value:{type:"string",enumSource:"possibleValues",watch:{possibleValues:"root.dropdownPossibleValues"},default:""},Text:{type:"string",enumSource:"possibleValues",watch:{possibleValues:"root.dropdownPossibleValues"},default:""}},propertyOrder:17},Items:{type:"array",format:"table",title:"Items",uniqueItems:!0,options:{collapsed:!0},items:{type:"object",properties:{Value:{type:"string"},Text:{type:"string"},DropdownValue:{options:{hidden:!0}}}},propertyOrder:18}}},Actions:{type:"actions",options:{collapsed:!0},fields:{map:{Current:{title:"Source Column",type:"string",enumSource:"possibleColumns",watch:{possibleColumns:"root.dropdownPossibleValues"},default:"",propertyOrder:10}}}},Style:{type:"object",title:"Style",options:{collapsed:!0},properties:{advanced:{type:"css",title:"Advanced CSS",default:""}}}}}}};if(0<_.keys(e.settingsModel.attributes).length)for(i=d.upgrades.indexOf(_.find(d.upgrades,{version:e.settingsModel.get("version")}))+1;i<d.upgrades.length;i+=1)(t=d.upgrades[i]).fn(e.settingsModel),e.settingsModel.set("version",t.version);return o},d);function d(){}r.upgrades=[{version:"4.0.0p2",fn:function(e){var t=e.get("Basics"),i=void 0===(i=e.get("Style"))?{}:i;t.Flex=void 0!==t.Flex&&t.Flex,e.set("Basics",t),e.set("Style",i)}},{version:"4.0.2",fn:function(e){var t=e.get("Basics");t.ShowRowCount=void 0===t.ShowRowCount?t.MultiSelect:t.ShowRowCount,t.EnableDropdownHeight=!1,t.DropdownHeight=100,e.set("Basics",t)}},{version:"4.1.0s2",fn:function(e){e.unset("Basics.EnableDropdownHeight"),e.unset("Basics.DropdownHeight"),e.unset("Basics.Flex"),e.unset("Basics.ShowRowCount"),e.set("Basics.FieldSummaryThreshold",5),e.set("Basics.TooltipSummaryThreshold",10),e.set("Basics.SelectAllValue","")}},{version:"4.3.1",fn:function(e){var t=_.map(e.get("Basics.SelectedObjectRouting"),function(e){return{_Type:"map",Current:e.ColumnProperty,Target:e.ViewstateProperty}});e.set("Actions",t),e.unset("Basics.SelectedObjectRouting")}},{version:"4.4.1",fn:function(e){e.unset("Basics.UseDataSource")}},{version:"4.5.0",fn:function(e){e.get("Basics.AdvancedSearch")||e.set("Basics.AdvancedSearch",!1)}}];p.getDefinition=function(e){var t,i;if(0<_.keys(e.settingsModel.attributes).length)for(i=p.upgrades.indexOf(_.find(p.upgrades,{version:e.settingsModel.get("version")}))+1;i<p.upgrades.length;i+=1)(t=p.upgrades[i]).fn(e.settingsModel),e.settingsModel.set("version",t.version);return{id:34,componentName:"radio",componentDescription:"classic radio buttons",appKey:"BasicComponents",listViewThumb:"fa fa-check-circle",ghostViewThumb:null,buildViewThumb:null,appArgs:{json:{version:"4.3.1p2",dropdownPossibleValues:[],Basics:{Data:"",SelectedValue:"",ComponentName:"radio",DataSourceMapping:{},Items:[{Text:"item 1",Value:"value 1"},{Text:"item 2",Value:"value 2"},{Text:"item 3",Value:"value 3"}],Theme:"Dark",Label:"select:",LabelWidth:75,MultiSelect:!1,UseDataSource:!1,AcceptEmptyValues:!1,ForceSelectedValue:!1,ItemsLayout:"Horizontal",horizontal:"Center",vertical:"Middle"},Actions:[],Style:{advanced:"",labelTemplate:""}},schema:{type:"object",title:"Properties",properties:{dropdownPossibleValues:{type:"array",format:"table",items:{type:"string"},default:[""],options:{collapsed:!1,hidden:!0}},Basics:{type:"object",title:"Basics",options:{collapsed:!1},properties:{Data:{type:"data",title:"Data Source",default:"",propertyOrder:1},SelectedValue:{type:"viewstate",title:"Selected Value",default:"",propertyOrder:2},Label:{title:"Label",type:"string",default:"select:",propertyOrder:3},UseDataSource:{type:"boolean",title:"Use Data Source",default:!1,format:"checkbox",propertyOrder:4},AcceptEmptyValues:{type:"boolean",title:"Accept Empty Values",default:!1,format:"checkbox",propertyOrder:5},ForceSelectedValue:{type:"boolean",title:"Force Selected Value",default:!1,format:"checkbox",propertyOrder:6},MultiSelect:{type:"boolean",title:"Multi-select",default:!1,format:"checkbox",propertyOrder:7},ItemsLayout:{type:"string",title:"Items Layout",enum:["Horizontal","Vertical"],propertyOrder:8},horizontal:{type:"string",title:"Horizontal",enum:["Left","Center","Right"],propertyOrder:9},vertical:{type:"string",title:"Vertical",enum:["Top","Middle","Bottom"],propertyOrder:10},LabelWidth:{title:"Label Width",type:"number",default:100,propertyOrder:13},ComponentName:{title:"Component",type:"string",default:"radio",options:{hidden:!0}},Theme:{type:"string",title:"Theme",options:{hidden:!0},enum:["Light","Dark"]},DataSourceMapping:{type:"object",title:"Data Source Mapping",options:{collapsed:!0},properties:{Value:{type:"string",enumSource:"possibleValues",watch:{possibleValues:"root.dropdownPossibleValues"},default:""},Text:{type:"string",enumSource:"possibleValues",watch:{possibleValues:"root.dropdownPossibleValues"},default:""}},propertyOrder:13},Items:{type:"array",format:"table",title:"Items",uniqueItems:!0,options:{collapsed:!0},items:{type:"object",properties:{Value:{type:"string"},Text:{type:"string"},DropdownValue:{options:{hidden:!0}}}},propertyOrder:14}}},Actions:{type:"actions",options:{collapsed:!0},fields:{map:{Current:{title:"Source Column",type:"string",enumSource:"possibleColumns",watch:{possibleColumns:"root.dropdownPossibleValues"},default:"",propertyOrder:10}}}},Style:{type:"object",title:"Style",options:{collapsed:!0},properties:{advanced:{type:"css",title:"Advanced CSS",default:""},labelTemplate:{type:"handlebar",title:"Label Template",default:""}}}}}}}};var c=p;function p(){}c.upgrades=[{version:"4.3.1",fn:function(e){e.get("Actions")||e.set("Actions",[])}},{version:"4.3.1p2",fn:function(e){var t=_.map(e.get("Basics.SelectedObjectRouting"),function(e){return{_Type:"map",Current:e.ColumnProperty,Target:e.ViewstateProperty}});e.set("Actions",t.concat(e.get("Actions"))),e.unset("Basics.SelectedObjectRouting")}}];var h=a.Tools,F=(u.getComponentDefinition=function(e){var t,i={};switch(e.componentId){case 15:i={id:15,componentName:"date picker",componentDescription:"control for changing date",appKey:"BasicComponents",listViewThumb:e.websiteUrl+"Images/calendar.png",ghostViewThumb:null,buildViewThumb:null,appArgs:{json:{version:"4.3.1",Basics:{ComponentName:"datePicker",Data:"",Label:"pick date:",SelectedDate:"",Theme:"Dark",horizontal:"Center",vertical:"Middle",tooltip:"",width:100,labelWidth:75},Actions:[],Style:{advanced:""}},schema:{type:"object",title:"Properties",properties:{Basics:{type:"object",title:"Basics",properties:{Label:{title:"Label",type:"string",default:"pick date:"},Data:{title:"Data Source",type:"data",default:""},SelectedDate:{title:"Selected Date",type:"viewstate",default:""},Theme:{type:"string",title:"Theme",options:{hidden:!0},enum:["Light","Dark"]},DashboardTheme:{options:{hidden:!0}},ComponentName:{title:"Component",type:"string",default:"datePicker",options:{hidden:!0}},horizontal:{type:"string",title:"Horizontal",enum:["Left","Center","Right"]},vertical:{type:"string",title:"Vertical",enum:["Top","Middle","Bottom"]},tooltip:{title:"Tooltip",type:"string",default:""},width:{title:"Width",type:"number",default:100},labelWidth:{title:"Label Width",type:"number",default:100}}},Actions:{type:"actions"},Style:{type:"object",title:"Style",options:{collapsed:!0},properties:{advanced:{type:"css",title:"Advanced CSS",default:""}}}}}}};break;case 16:i=r.getDefinition(e);break;case 17:i={id:17,componentName:"label",componentDescription:"Basic labels, headers and paragraphs.",appKey:"BasicComponents",listViewThumb:e.websiteUrl+"Images/text-field.png",ghostViewThumb:null,buildViewThumb:null,appArgs:{json:{version:"4.2.0s3",Basics:{ComponentName:"label",HtmlText:"insert text here",Data:"",Template:"",Theme:"Dark",FontSize:"13",horizontal:"Center",vertical:"Middle",tooltip:"",AllowUnsafeContent:!1,version:"4.2.0s2"},Style:{advanced:""}},schema:{type:"object",title:"Properties",properties:{Basics:{type:"object",title:"Basics",options:{collapsed:!1},properties:{HtmlText:{type:"html",propertyOrder:4,title:"Formatted Text",default:"insert text here"},Data:{type:"data",propertyOrder:1,format:"string",title:"Data Source",default:""},Template:{type:"tooltipTemplate",propertyOrder:5,title:"Template Text",default:"",options:{showMenuLayout:!0}},FontSize:{title:"Font Size",propertyOrder:6,type:"number",default:"10",format:"number"},Theme:{type:"string",propertyOrder:7,title:"Theme",options:{hidden:!0},enum:["Light","Dark"]},ComponentName:{title:"Component",propertyOrder:8,type:"string",default:"label",options:{hidden:!0}},horizontal:{type:"string",propertyOrder:9,title:"Horizontal",enum:["Left","Center","Right"]},vertical:{type:"string",propertyOrder:10,title:"Vertical",enum:["Top","Middle","Bottom"]},tooltip:{title:"Tooltip",propertyOrder:11,type:"string",default:""},AllowUnsafeContent:{type:"boolean",title:"Allow Unsafe Templates",format:"checkbox",propertyOrder:12},version:{type:"string",propertyOrder:13,title:"version",options:{hidden:!0}}}},Style:{type:"object",title:"Style",options:{collapsed:!0},properties:{advanced:{type:"css",title:"Advanced CSS",default:""}}}}}}};break;case 24:i={id:24,componentName:"EXT Component",componentDescription:"This element displays web content.",appKey:"BasicComponents",listViewThumb:e.websiteUrl+"Images/webComponent.png",ghostViewThumb:null,buildViewThumb:null,appArgs:{json:{version:"4.0.0d2",ViewState:{Url:"https://bing.com"},Basics:{ComponentName:"webComponent"},Style:{advanced:""}},schema:{type:"object",title:"Properties",properties:{ViewState:{type:"object",title:"View State",options:{collapsed:!1},propertyOrder:200,properties:{Url:{type:"string",title:"Url",default:"https://bing.com"}}},Basics:{type:"object",title:"Basics",options:{hidden:!0},properties:{ComponentName:{type:"string",title:"hide me",default:"webComponent"}}},Style:{type:"object",title:"Style",options:{collapsed:!0},propertyOrder:210,properties:{advanced:{type:"css",title:"Advanced CSS",default:""}}}}}}};break;case 25:i={id:25,componentName:"button",componentDescription:"This element allows to link screens.",appKey:"BasicComponents",appArgs:{json:{version:"4.3.0p2",Actions:[],Basics:{ComponentName:"linkButton",Label:"click",Icon:"",FontSize:11,horizontal:"Center",vertical:"Middle",tooltip:"",fixedWidth:!1,width:100,isEnabled:!0},Style:{advanced:"",background:"",color:"",border:""}},schema:{type:"object",title:"Properties",properties:{possible_screens:{type:"array",format:"table",items:{type:"object",properties:{title:{type:"string"},value:{type:"string"}}},options:{hidden:!0}},possible_dashboards:{type:"array",format:"table",items:{type:"object",properties:{title:{type:"string"},value:{type:"string"}}},options:{hidden:!0}},possible_viewstates:{type:"array",format:"table",items:{type:"string"},options:{hidden:!0}},Actions:{type:"actions"},Basics:{type:"object",title:"Basics",properties:{ComponentName:{type:"string",title:"hide me",default:"linkButton",options:{hidden:!0}},Label:{type:"string",title:"Label",default:"click here",propertyOrder:1},FontSize:{type:"number",title:"Font Size",default:11,format:"number",propertyOrder:2},horizontal:{type:"string",title:"Horizontal",enum:["Left","Center","Right"],default:"Center",propertyOrder:3},vertical:{type:"string",title:"Vertical",enum:["Top","Middle","Bottom"],default:"Middle",propertyOrder:4},tooltip:{type:"string",title:"Tooltip",fotmat:"string",default:"",propertyOrder:5},fixedWidth:{type:"boolean",title:"Fixed Width",format:"checkbox",propertyOrder:6},width:{type:"number",title:"Width",default:100,format:"number",propertyOrder:7},Icon:{type:"icon",title:"Icon",propertyOrder:8},isEnabled:{type:"boolean",title:"Is Enabled",format:"checkbox",propertyOrder:11}}},Style:{type:"object",title:"Style",options:{collapsed:!0},properties:{advanced:{type:"css",title:"Advanced CSS",default:""},background:{type:"gradient",options:{noColor:!0,gradient:!1},title:"Button Background",default:""},color:{type:"gradient",options:{noColor:!0,gradient:!1},title:"Button Text",default:""},border:{type:"gradient",options:{noColor:!0,gradient:!1},title:"Button border",default:""}}}}}},listViewThumb:e.websiteUrl+"Images/button.png",ghostViewThumb:null,buildViewThumb:null};break;case 30:i={id:30,componentName:"button",componentDescription:"button",appKey:"BasicComponents",listViewThumb:e.websiteUrl+"Images/button.png",ghostViewThumb:null,buildViewThumb:null,appArgs:{json:{version:"3.1.0.4",Basics:{ComponentName:"button",Theme:"Dark"},Style:{advanced:""}},schema:{type:"object",title:"Properties",properties:{Basics:{type:"object",title:"Basics",options:{collapsed:!1},properties:{Theme:{type:"string",title:"Theme",options:{hidden:!0},enum:["Light","Dark"]},ComponentName:{title:"Component",type:"string",default:"button",options:{hidden:!0}}}},Style:{type:"object",title:"Style",options:{collapsed:!0},properties:{advanced:{type:"css",title:"Advanced CSS",default:""}}}}}}};break;case 31:i={id:31,componentName:"pdf button",componentDescription:"Save as pdf",appKey:"BasicComponents",listViewThumb:e.websiteUrl+"Images/pdfButton.png",ghostViewThumb:null,buildViewThumb:null,appArgs:{json:{Basics:{ComponentName:"pdfButton",Theme:"Dark"}},schema:{type:"object",title:"Properties",properties:{Basics:{type:"object",title:"Basics",options:{collapsed:!1},properties:{Theme:{type:"string",title:"Theme",options:{hidden:!0},enum:["Light","Dark"]},ComponentName:{title:"Component",type:"string",default:"pdfButton",options:{hidden:!0}}}}}}}};break;case 32:i={id:32,componentName:"server status",componentDescription:"Display Server Status",appKey:"BasicComponents",listViewThumb:e.websiteUrl+"Images/server-status.png",ghostViewThumb:null,buildViewThumb:null,appArgs:{json:{version:"4.5.0",possibleConnections:[],Basics:{ComponentName:"serverStatus",Theme:"Dark",Connection:"",PollingInterval:5,IsEnabled:!0},Style:{advanced:""}},schema:{type:"object",title:"Properties",properties:{possibleConnections:{type:"readOnlyArray",items:{type:"string"},default:[],options:{collapsed:!0,hidden:!0}},Basics:{type:"object",title:"Basics",options:{collapsed:!1},propertyOrder:200,properties:{Theme:{type:"string",title:"Theme",enum:["Light","Dark"],options:{hidden:!0}},DashboardTheme:{options:{hidden:!0}},ComponentName:{title:"Component",type:"string",default:"serverStatus",options:{hidden:!0}},Connection:{title:"Server Connection",type:"string",enumSource:"possibleValues",watch:{possibleValues:"root.possibleConnections"},default:"mnth"},PollingInterval:{title:"Polling Interval (sec)",minimum:1,maximum:60,type:"number",step:1,format:"range"},IsEnabled:{type:"boolean",title:"Is Enabled",format:"checkbox"}}},Style:{type:"object",title:"Style",options:{collapsed:!0},propertyOrder:210,properties:{advanced:{type:"css",title:"Advanced CSS",default:""}}}}}}};break;case 33:i={id:33,componentName:"textbox",componentDescription:"textbox component",appKey:"BasicComponents",listViewThumb:e.websiteUrl+"Images/textBox.png",ghostViewThumb:null,buildViewThumb:null,appArgs:{json:{version:"4.3.1",Basics:{ComponentName:"textBox",Theme:"Dark",Text:"",Type:"text",FontSize:16,horizontal:"Center",vertical:"Middle",fixedWidth:!1,width:100,fixedHeight:!1,height:100},Actions:[],Style:{advanced:""}},schema:{type:"object",title:"Properties",properties:{possibleColumns:{type:"array",format:"table",items:{type:"string"},default:["bid","ask"],options:{collapsed:!0,hidden:!0}},Basics:{type:"object",title:"Basics",options:{collapsed:!1},properties:{ComponentName:{title:"Component",type:"string",default:"textBox",options:{hidden:!0}},Theme:{type:"string",title:"Theme",options:{hidden:!0},enum:["Light","Dark"]},Text:{type:"string",title:"Text",propertyOrder:1},Type:{type:"string",title:"Input Type",enum:["text","search","multiline"],default:"text",propertyOrder:2},fixedWidth:{type:"boolean",title:"Fixed Width",format:"checkbox",propertyOrder:3},width:{type:"number",title:"Width",default:100,format:"number",propertyOrder:4},fixedHeight:{type:"boolean",title:"Fixed Height",format:"checkbox",propertyOrder:5},height:{type:"number",title:"Height",default:100,format:"number",propertyOrder:6},horizontal:{type:"string",title:"Horizontal",enum:["Left","Center","Right"],default:"Center",propertyOrder:7},vertical:{type:"string",title:"Vertical",enum:["Top","Middle","Bottom"],default:"Middle",propertyOrder:8},FontSize:{type:"number",title:"Font Size",default:16,minimum:1,format:"number",propertyOrder:9}}},Actions:{type:"actions"},Style:{type:"object",title:"Style",options:{collapsed:!0},properties:{advanced:{type:"css",title:"Advanced CSS",default:""}}}}}}};break;case 34:i=c.getDefinition(e);break;default:i={}}if(-1===[16,34].indexOf(e.componentId)&&0<_.keys(e.settingsModel.attributes).length)for(var o=u.upgrades.indexOf(_.find(u.upgrades,{version:e.settingsModel.get("version")}))+1;o<u.upgrades.length;o+=1)(t=u.upgrades[o]).fn(e.settingsModel,e.componentId,e),e.settingsModel.set("version",t.version);return i},u);function u(){}F.upgrades=[{version:"4.0.0p2",fn:function(e,t){32!==t&&24!==t||e.set("Style.advanced","")}},{version:"4.1.0s1",fn:function(e,t){25===t&&(e.set("Style.background",""),e.set("Style.color",""),e.set("Style.border",""))}},{version:"4.0.2d1",fn:function(e,t){17===t&&e.set("Basics.AllowUnsafeContent",!1)}},{version:"4.1.0s2",fn:function(e,t){25===t&&(e.set("Basics.useUrl",!1),e.set("Basics.urlString",""),e.set("Basics.isEnabled",!0))}},{version:"4.2.0s2",fn:function(e,t){17!==t||(t=e.get("Basics.HtmlText"))._dashboardsType||(t=(t=(t=t.toString()).replace(/\n/g,"<br/>")).replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;"),t=decodeURIComponent(t),e.set("Basics.HtmlText",t))}},{version:"4.2.0",fn:function(e,t,i){var o;25===t&&(o=[],t=e.get("ViewState.target_dashboard_screen"),_.each(e.get("ViewState.viewstates_mapping"),function(e){o.push(_.extend({_Type:"map"},e))}),(t&&t.dashboard&&"<none>"!==t.dashboard||t.value)&&("<this>"===t.dashboard&&(i=i.dashboardAppModel.get("documents").get(i.dashboardViewModel.get("selectedDocumentId")))&&(i=i.get("screens").get(t.screen))&&(t.screen=i.get("name")),o.push({_Type:"nav",SelectDashboardScreen:t})),e.get("Basics.useUrl")&&o.push({_Type:"url",Url:e.get("Basics.urlString"),Target:"_blank"}),e.set("Actions",o),e.unset("ViewState"),e.unset("Basics.urlString"),e.unset("Basics.useUrl"))}},{version:"4.2.0s3",fn:function(e,t){17===t&&e.get("Basics.Label")&&(e.set("Basics.HtmlText",e.get("Basics.Label")),e.unset("Basics.Label"))}},{version:"4.3.0p2",fn:function(e,t,o){var n;25===t&&(n=[],t=e.get("Actions"),_.each(t,function(e){var t,i;e._Type&&"nav"!==e._Type||e.SelectDashboardScreen?n.push(e):(t={_dashboardsType:e._dashboardsType},void 0!==e.dashboard?(i=o.dashboardAppModel.get("documents").get(o.dashboardViewModel.get("selectedDocumentId")),t.dashboard="<none>",t.screen="<none>",(i="<this>"!==e.dashboard?o.dashboardAppModel.get("documents").get(e.dashboard):i)&&(t.dashboard=e.dashboard,_.find(i.get("screenDetails"),{value:e.screen})&&(t.screen=e.screen))):"viewstate"===e._dashboardsType&&(t.value=e.value),n.push({_Type:"nav",SelectDashboardScreen:t}))}),n.length&&e.set("Actions",n))}},{version:"4.3.1",fn:function(e,t){15!==t&&33!==t||e.get("Actions")||e.set("Actions",[]),34===t&&((t=e.get("Style")).labelTemplate=void 0===t.labelTemplate?"":t.labelTemplate,e.get("Style",t))}},{version:"4.3.1",fn:function(e,t){33===t&&((t=e.get("Basics")).Type=void 0===t.Type?"text":t.Type,e.set("Basics",t),t.Type=t.Multiline?"multiline":t.Type,e.unset("Basics.Multiline"))}},{version:"4.5.0",fn:function(e,t){32===t&&e.unset("Basics.PollingIntervalSec")}}];i.button=n.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,n){var a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="basicComponents_btn">'+e.escapeExpression((a(i,"t")||t&&a(t,"t")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},"button text",{name:"t",hash:{},data:n,loc:{start:{line:1,column:33},end:{line:1,column:52}}}))+"</div>"},useData:!0}),i.datePicker=n.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,n){return'<div style="display: table; width: 100%; height: 100%;">\n    <div class="align-div" style="display: table-cell; width: 100%; height: 100%; text-align: center; vertical-align: middle;">\n        <div style="display: inline-block;">\n            <span class="datepicker-label"></span>\n            <div class="datepicker-container">\n                <span class="datepicker-input bbf-editor"></span>\n                <div class="datepicker-button"></div>\n            </div>\n        </div>\n    </div>\n</div>'},useData:!0}),i.dropdown=n.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,n){return'<div style="display: table; width: 100%; height: 100%;">\n    <div class="align-div" style="display: table-cell; width: 100%; height: 100%; text-align: center; vertical-align: middle;">\n        <div class="bbf-field">\n            <div class="bbf-editor">\n                <div class="dropdown-label"></div>\n                <div class="dropdown-container"></div>\n            </div>\n        </div>\n    </div>\n</div>'},useData:!0}),i.dropdownCustomStyle=n.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,n){var a,s=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,r="function",d=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"#"+d(typeof(a=null!=(a=e(i,"cid")||(null!=t?e(t,"cid"):t))?a:l)==r?a.call(s,{name:"cid",hash:{},data:n,loc:{start:{line:1,column:1},end:{line:1,column:8}}}):a)+" > ul {\n    height: "+d(typeof(a=null!=(a=e(i,"height")||(null!=t?e(t,"height"):t))?a:l)==r?a.call(s,{name:"height",hash:{},data:n,loc:{start:{line:2,column:12},end:{line:2,column:22}}}):a)+";\n}\n"},useData:!0}),i.dummy=n.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,n){return"error! please update componentMap in BasicComponents"},useData:!0}),i.label=n.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,n){return'<div style="display: table; width: 100%; height: 100%;">\n    <div class="text-align" style="display: table-cell; width: 100%; height: 100%; vertical-align: middle; text-align: center; overflow: hidden;">\n\t\t<div class="htmlContent"></div>\n    </div>\n</div>\n'},useData:!0}),i.linkButton=n.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,n){var a,s=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,r="function",d=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div style="display: table; width: 100%; height: 100%;">\n    <div class="align-div" style="display: table-cell; width: 100%; height: 100%; vertical-align: middle; text-align: center;">\n        <button class="button-root" style="font-size: '+d(typeof(a=null!=(a=e(i,"FontSize")||(null!=t?e(t,"FontSize"):t))?a:l)==r?a.call(s,{name:"FontSize",hash:{},data:n,loc:{start:{line:3,column:54},end:{line:3,column:66}}}):a)+'px">\n            '+d(typeof(a=null!=(a=e(i,"Label")||(null!=t?e(t,"Label"):t))?a:l)==r?a.call(s,{name:"Label",hash:{},data:n,loc:{start:{line:4,column:12},end:{line:4,column:21}}}):a)+"\n        </button>\n    </div>\n</div>\n"},useData:!0}),i.linkButtonCustomStyle=n.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,n){var a,s=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,r="function",d=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"#"+d(typeof(a=null!=(a=e(i,"cid")||(null!=t?e(t,"cid"):t))?a:l)==r?a.call(s,{name:"cid",hash:{},data:n,loc:{start:{line:1,column:1},end:{line:1,column:8}}}):a)+" {\n    background: "+d(typeof(a=null!=(a=e(i,"c0")||(null!=t?e(t,"c0"):t))?a:l)==r?a.call(s,{name:"c0",hash:{},data:n,loc:{start:{line:2,column:16},end:{line:2,column:22}}}):a)+";\n    background: -moz-linear-gradient(bottom,"+d(typeof(a=null!=(a=e(i,"c0")||(null!=t?e(t,"c0"):t))?a:l)==r?a.call(s,{name:"c0",hash:{},data:n,loc:{start:{line:3,column:44},end:{line:3,column:50}}}):a)+",50%,"+d(typeof(a=null!=(a=e(i,"c1")||(null!=t?e(t,"c1"):t))?a:l)==r?a.call(s,{name:"c1",hash:{},data:n,loc:{start:{line:3,column:55},end:{line:3,column:61}}}):a)+",80%,"+d(typeof(a=null!=(a=e(i,"c2")||(null!=t?e(t,"c2"):t))?a:l)==r?a.call(s,{name:"c2",hash:{},data:n,loc:{start:{line:3,column:66},end:{line:3,column:72}}}):a)+");\n    background: -webkit-linear-gradient(bottom,"+d(typeof(a=null!=(a=e(i,"c0")||(null!=t?e(t,"c0"):t))?a:l)==r?a.call(s,{name:"c0",hash:{},data:n,loc:{start:{line:4,column:47},end:{line:4,column:53}}}):a)+",50%,"+d(typeof(a=null!=(a=e(i,"c1")||(null!=t?e(t,"c1"):t))?a:l)==r?a.call(s,{name:"c1",hash:{},data:n,loc:{start:{line:4,column:58},end:{line:4,column:64}}}):a)+",80%,"+d(typeof(a=null!=(a=e(i,"c2")||(null!=t?e(t,"c2"):t))?a:l)==r?a.call(s,{name:"c2",hash:{},data:n,loc:{start:{line:4,column:69},end:{line:4,column:75}}}):a)+");\n    background: linear-gradient(to top,"+d(typeof(a=null!=(a=e(i,"c0")||(null!=t?e(t,"c0"):t))?a:l)==r?a.call(s,{name:"c0",hash:{},data:n,loc:{start:{line:5,column:39},end:{line:5,column:45}}}):a)+",50%,"+d(typeof(a=null!=(a=e(i,"c1")||(null!=t?e(t,"c1"):t))?a:l)==r?a.call(s,{name:"c1",hash:{},data:n,loc:{start:{line:5,column:50},end:{line:5,column:56}}}):a)+",80%,"+d(typeof(a=null!=(a=e(i,"c2")||(null!=t?e(t,"c2"):t))?a:l)==r?a.call(s,{name:"c2",hash:{},data:n,loc:{start:{line:5,column:61},end:{line:5,column:67}}}):a)+");\n}\n\n#"+d(typeof(a=null!=(a=e(i,"cid")||(null!=t?e(t,"cid"):t))?a:l)==r?a.call(s,{name:"cid",hash:{},data:n,loc:{start:{line:8,column:1},end:{line:8,column:8}}}):a)+".ui-state-hover {\n    background: "+d(typeof(a=null!=(a=e(i,"h0")||(null!=t?e(t,"h0"):t))?a:l)==r?a.call(s,{name:"h0",hash:{},data:n,loc:{start:{line:9,column:16},end:{line:9,column:22}}}):a)+";\n    background: -moz-linear-gradient(bottom,"+d(typeof(a=null!=(a=e(i,"h0")||(null!=t?e(t,"h0"):t))?a:l)==r?a.call(s,{name:"h0",hash:{},data:n,loc:{start:{line:10,column:44},end:{line:10,column:50}}}):a)+",50%,"+d(typeof(a=null!=(a=e(i,"h1")||(null!=t?e(t,"h1"):t))?a:l)==r?a.call(s,{name:"h1",hash:{},data:n,loc:{start:{line:10,column:55},end:{line:10,column:61}}}):a)+",80%,"+d(typeof(a=null!=(a=e(i,"h2")||(null!=t?e(t,"h2"):t))?a:l)==r?a.call(s,{name:"h2",hash:{},data:n,loc:{start:{line:10,column:66},end:{line:10,column:72}}}):a)+");\n    background: -webkit-linear-gradient(bottom,"+d(typeof(a=null!=(a=e(i,"h0")||(null!=t?e(t,"h0"):t))?a:l)==r?a.call(s,{name:"h0",hash:{},data:n,loc:{start:{line:11,column:47},end:{line:11,column:53}}}):a)+",50%,"+d(typeof(a=null!=(a=e(i,"h1")||(null!=t?e(t,"h1"):t))?a:l)==r?a.call(s,{name:"h1",hash:{},data:n,loc:{start:{line:11,column:58},end:{line:11,column:64}}}):a)+",80%,"+d(typeof(a=null!=(a=e(i,"h2")||(null!=t?e(t,"h2"):t))?a:l)==r?a.call(s,{name:"h2",hash:{},data:n,loc:{start:{line:11,column:69},end:{line:11,column:75}}}):a)+");\n    background: linear-gradient(to top,"+d(typeof(a=null!=(a=e(i,"h0")||(null!=t?e(t,"h0"):t))?a:l)==r?a.call(s,{name:"h0",hash:{},data:n,loc:{start:{line:12,column:39},end:{line:12,column:45}}}):a)+",50%,"+d(typeof(a=null!=(a=e(i,"h1")||(null!=t?e(t,"h1"):t))?a:l)==r?a.call(s,{name:"h1",hash:{},data:n,loc:{start:{line:12,column:50},end:{line:12,column:56}}}):a)+",80%,"+d(typeof(a=null!=(a=e(i,"h2")||(null!=t?e(t,"h2"):t))?a:l)==r?a.call(s,{name:"h2",hash:{},data:n,loc:{start:{line:12,column:61},end:{line:12,column:67}}}):a)+");\n}\n\n#"+d(typeof(a=null!=(a=e(i,"cid")||(null!=t?e(t,"cid"):t))?a:l)==r?a.call(s,{name:"cid",hash:{},data:n,loc:{start:{line:15,column:1},end:{line:15,column:8}}}):a)+".ui-state-hover.ui-state-active {\n    background: "+d(typeof(a=null!=(a=e(i,"a0")||(null!=t?e(t,"a0"):t))?a:l)==r?a.call(s,{name:"a0",hash:{},data:n,loc:{start:{line:16,column:16},end:{line:16,column:22}}}):a)+";\n    background: -moz-linear-gradient(bottom,"+d(typeof(a=null!=(a=e(i,"a0")||(null!=t?e(t,"a0"):t))?a:l)==r?a.call(s,{name:"a0",hash:{},data:n,loc:{start:{line:17,column:44},end:{line:17,column:50}}}):a)+",50%,"+d(typeof(a=null!=(a=e(i,"a1")||(null!=t?e(t,"a1"):t))?a:l)==r?a.call(s,{name:"a1",hash:{},data:n,loc:{start:{line:17,column:55},end:{line:17,column:61}}}):a)+",80%,"+d(typeof(a=null!=(a=e(i,"a2")||(null!=t?e(t,"a2"):t))?a:l)==r?a.call(s,{name:"a2",hash:{},data:n,loc:{start:{line:17,column:66},end:{line:17,column:72}}}):a)+");\n    background: -webkit-linear-gradient(bottom,"+d(typeof(a=null!=(a=e(i,"a0")||(null!=t?e(t,"a0"):t))?a:l)==r?a.call(s,{name:"a0",hash:{},data:n,loc:{start:{line:18,column:47},end:{line:18,column:53}}}):a)+",50%,"+d(typeof(a=null!=(a=e(i,"a1")||(null!=t?e(t,"a1"):t))?a:l)==r?a.call(s,{name:"a1",hash:{},data:n,loc:{start:{line:18,column:58},end:{line:18,column:64}}}):a)+",80%,"+d(typeof(a=null!=(a=e(i,"a2")||(null!=t?e(t,"a2"):t))?a:l)==r?a.call(s,{name:"a2",hash:{},data:n,loc:{start:{line:18,column:69},end:{line:18,column:75}}}):a)+");\n    background: linear-gradient(to top,"+d(typeof(a=null!=(a=e(i,"a0")||(null!=t?e(t,"a0"):t))?a:l)==r?a.call(s,{name:"a0",hash:{},data:n,loc:{start:{line:19,column:39},end:{line:19,column:45}}}):a)+",50%,"+d(typeof(a=null!=(a=e(i,"a1")||(null!=t?e(t,"a1"):t))?a:l)==r?a.call(s,{name:"a1",hash:{},data:n,loc:{start:{line:19,column:50},end:{line:19,column:56}}}):a)+",80%,"+d(typeof(a=null!=(a=e(i,"a2")||(null!=t?e(t,"a2"):t))?a:l)==r?a.call(s,{name:"a2",hash:{},data:n,loc:{start:{line:19,column:61},end:{line:19,column:67}}}):a)+");\n}"},useData:!0}),i.pdfButton=n.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,n){var a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="basicComponents_pdfBtn">'+e.escapeExpression((a(i,"t")||t&&a(t,"t")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},"button text",{name:"t",hash:{},data:n,loc:{start:{line:1,column:36},end:{line:1,column:55}}}))+"</div>"},useData:!0}),i.radio=n.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,n){return'<div style="display: table; width: 100%; height: 100%;">\n    <div class="align-div" style="display: table-cell; width: 100%; height: 100%; text-align: center; vertical-align: middle;">\n        <div style="display: inline-block;">\n            <span class="basicComponents_cmbLbl"></span>\n            <div class="radio_buttons"></div>\n        </div>\n    </div>\n</div>'},useData:!0}),i.serverStatus=n.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,n){return'<div class="pnlLineStatus">\n    Line Status: <span class="txtLineStatus"></span>\n</div>\n\n<span class="txtServerTime"></span>\n\n\n'},useData:!0}),i.tabs=n.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,n){return'<div class="tabs-div">\n    <ul>\n        <li><a href="#tabs-1">Nunc tincidunt</a></li>\n        <li><a href="#tabs-2">Proin dolor</a></li>\n        <li><a href="#tabs-3">Aenean lacinia</a></li>\n    </ul>\n    <div id="tabs-1">\n        <p>Proin elit arcu, rutrum commodo, vehicula tempus, commodo a, risus. Curabitur nec arcu. Donec sollicitudin mi sit amet mauris. Nam elementum quam ullamcorper ante. Etiam aliquet massa et lorem. Mauris dapibus lacus auctor risus. Aenean tempor ullamcorper leo. Vivamus sed magna quis ligula eleifend adipiscing. Duis orci. Aliquam sodales tortor vitae ipsum. Aliquam nulla. Duis aliquam molestie erat. Ut et mauris vel pede varius sollicitudin. Sed ut dolor nec orci tincidunt interdum. Phasellus ipsum. Nunc tristique tempus lectus.</p>\n    </div>\n    <div id="tabs-2">\n        <p>Morbi tincidunt, dui sit amet facilisis feugiat, odio metus gravida ante, ut pharetra massa metus id nunc. Duis scelerisque molestie turpis. Sed fringilla, massa eget luctus malesuada, metus eros molestie lectus, ut tempus eros massa ut dolor. Aenean aliquet fringilla sem. Suspendisse sed ligula in ligula suscipit aliquam. Praesent in eros vestibulum mi adipiscing adipiscing. Morbi facilisis. Curabitur ornare consequat nunc. Aenean vel metus. Ut posuere viverra nulla. Aliquam erat volutpat. Pellentesque convallis. Maecenas feugiat, tellus pellentesque pretium posuere, felis lorem euismod felis, eu ornare leo nisi vel felis. Mauris consectetur tortor et purus.</p>\n    </div>\n    <div id="tabs-3">\n        <p>Mauris eleifend est et turpis. Duis id erat. Suspendisse potenti. Aliquam vulputate, pede vel vehicula accumsan, mi neque rutrum erat, eu congue orci lorem eget lorem. Vestibulum non ante. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Fusce sodales. Quisque eu urna vel enim commodo pellentesque. Praesent eu risus hendrerit ligula tempus pretium. Curabitur lorem enim, pretium nec, feugiat nec, luctus a, lacus.</p>\n        <p>Duis cursus. Maecenas ligula eros, blandit nec, pharetra at, semper at, magna. Nullam ac lacus. Nulla facilisi. Praesent viverra justo vitae neque. Praesent blandit adipiscing velit. Suspendisse potenti. Donec mattis, pede vel pharetra blandit, magna ligula faucibus eros, id euismod lacus dolor eget odio. Nam scelerisque. Donec non libero sed nulla mattis commodo. Ut sagittis. Donec nisi lectus, feugiat porttitor, tempor ac, tempor vitae, pede. Aenean vehicula velit eu tellus interdum rutrum. Maecenas commodo. Pellentesque nec elit. Fusce in lacus. Vivamus a libero vitae lectus hendrerit hendrerit.</p>\n    </div>\n</div>'},useData:!0}),i.textBox=n.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,n){var a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="align-div" style="display: block; width: 100%; height: 100%; vertical-align: middle; text-align: center;">\n    <input type="'+e.escapeExpression("function"==typeof(i=null!=(i=a(i,"type")||(null!=t?a(t,"type"):t))?i:e.hooks.helperMissing)?i.call(null!=t?t:e.nullContext||{},{name:"type",hash:{},data:n,loc:{start:{line:2,column:17},end:{line:2,column:25}}}):i)+'" />\n    <textarea></textarea>\n</div>\n'},useData:!0}),i.webComponent=n.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,n){var a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="title">\n\n</div>\n<iframe src="'+e.escapeExpression("function"==typeof(i=null!=(i=a(i,"Url")||(null!=t?a(t,"Url"):t))?i:e.hooks.helperMissing)?i.call(null!=t?t:e.nullContext||{},{name:"Url",hash:{},data:n,loc:{start:{line:4,column:13},end:{line:4,column:20}}}):i)+'" />'},useData:!0});var m=i;function i(){}g=s.View,e(y,g),y.prototype.onData=function(e,t){var i=this,o=(e.primaryKey!==this.primaryKey&&(this.primaryKey=e.primaryKey,this.dateCollection=new s.Collection([],{model:s.Model.extend({idAttribute:this.primaryKey})})),t.reset?(e.columns.reset&&(this.columns=e.columns.reset),this.dateCollection.reset(t.reset)):(this.dateCollection.remove(_.map(t.remove,function(e){return e[i.primaryKey]})),this.dateCollection.add(t.add),this.dateCollection.add(t.change,{merge:!0})),this.columns&&this.columns[0]?this.columns[0].id:"");this.availableDates=this.dateCollection.map(function(e){e=e.get(o)||"";return h.isKDBTemporal(e)?h.convertKDBTemporalToMoment(e).toDashString():(i.api.showQueryStatus({error:'Invalid Date Type "'+(_.isFunction(e.toString)?e.toString():e)+'", please choose a Data Source that returns a column of date/time types',errorType:"Warning"}),null)})},y.prototype.onDataError=function(e){a.Log.Error("Datepicker data error ",e)},y.prototype.onDataSourceChanged=function(){var e=this.viewModel.get("Basics.Data");if(!e)return this.applyDataProperty(),void(this.availableDates=null);this.dataModel&&e.path===this.dataModel.path||this.applyDataProperty(e),this.debouncedRenderDatePicker()},y.prototype.render=function(){return this.$el.html(m.datePicker()),this.$alignDiv=this.$(".align-div"),this.$lbl=this.$(".datepicker-label"),this.$datePickerContainer=this.$(".datepicker-input"),this.$btnShowPopup=this.$(".datepicker-button"),this},y.prototype.onSettingsChange=function(e){var i=this;_.each(e,function(e,t){i.viewModel.set(t,e)}),this.hasInit||(this.hasInit=!0,this.afterInitialize())},y.prototype.remove=function(){return this.$datePickerContainer.off(),this.$btnShowPopup.off(),this.$btnShowPopup.data("uiButton")&&this.$btnShowPopup.button("destroy"),this.removeDatePicker(),s.View.prototype.remove.apply(this)},y.prototype.initializeEvents=function(){this.listenTo(this.viewModel,"change:Basics.Data",this.onDataSourceChanged.bind(this)),this.listenTo(this.viewModel,"change:Basics.width",this.setWidth.bind(this)),this.listenTo(this.viewModel,"change:Basics.labelWidth",this.updateLabelWidth.bind(this)),this.listenTo(this.viewModel,"change:Basics.Label",this.onLabelChange.bind(this)),this.listenTo(this.viewModel,"change:Basics.horizontal",this.onHorizontalAlignChanged.bind(this)),this.listenTo(this.viewModel,"change:Basics.vertical",this.onVerticalAlignChanged.bind(this)),this.listenTo(this.viewModel,"change:Basics.tooltip",this.onTooltipChanged.bind(this)),this.listenTo(this.viewModel,"change:Basics.SelectedDate",this.onSelectedDateChange.bind(this)),this.$datePickerContainer.add(this.$btnShowPopup).mouseenter(this.setFlagVisible.bind(this))},y.prototype.afterInitialize=function(){this.render(),this.initializeEvents(),this.onLabelChange(),this.onDataSourceChanged(),this.onVerticalAlignChanged(),this.onTooltipChanged(),this.updateLabelWidth(),this.setStyle(),this.onHorizontalAlignChanged(),this.renderDatePicker()},y.prototype.applyDataProperty=function(e){this.dataModel&&(this.stopListening(this.dataModel),this.api.unsubscribe(this.dataModel),this.availableDates=null),(this.dataModel=e)&&(this.dataModel&&this.dataModel.attributes?(this.api.subscribe(e,this.onData.bind(this)),this.initializeQueryStatusHandler(this.dataModel)):this.api.showQueryStatus({error:'Invalid Data Source: "'+e.path+'" selected',errorType:"Warning"}))},y.prototype.bindButton=function(){var e=this;this.$btnShowPopup.data("uiButton")||this.$btnShowPopup.button({icons:{primary:"fa fa-calendar"}}).click(function(){e.datePicker&&(e.visible?e.datePicker.hide():e.datePicker.show(),e.visible=!e.visible)})},y.prototype.convertDateToString=function(e){return _.isDate(e)?h.convertValueToMoment(e,"1214",!0).toDashString():e},y.prototype.executeActions=function(){this.api.doActions(this.viewModel.get("Actions"),"Actions")},y.prototype.initializeQueryStatusHandler=function(e){this.updateQueryStatus(),this.listenTo(e,"change:queryStatus",this.updateQueryStatus.bind(this))},y.prototype.onDimensionsChanged=function(){this.onTooltipChanged()},y.prototype.onHorizontalAlignChanged=function(){this.$alignDiv.css("text-align",this.viewModel.get("Basics.horizontal"))},y.prototype.onLabelChange=function(){this.$lbl.text(this.viewModel.get("Basics.Label"))},y.prototype.onSelectedDateChange=function(){var e=this.api.getPropertyMeta("Basics.SelectedDate");e?e.viewstateType!==this.selectedDateType?(this.onSelectedDateChangePostRender(),this.$btnShowPopup.removeClass("datePickerButtonError")):this.datePicker&&!_.isUndefined(e.value)&&(this.datePicker.setValue(e.value),(!_.has(a.Tools.Types.dashboardToKdb,e.viewstateType)||(e=h.convertUserInputToMoment(e.value,""))&&e._isValid)&&this.setError(null)):this.onSelectedDateChangePostRender(),this.executeActions()},y.prototype.onSelectedDateChangePostRender=function(){this.selectedChanged=!0,this.debouncedRenderDatePicker()},y.prototype.onVerticalAlignChanged=function(){this.$alignDiv.css("vertical-align",this.viewModel.get("Basics.vertical"))},y.prototype.onThemeChanged=function(){var e="Dark";this.options.dashboardViewModel.get("DashboardTheme")&&(e=this.options.dashboardViewModel.get("DashboardTheme")),this.$el.removeClass("Dark").removeClass("Light").addClass(e)},y.prototype.onTooltipChanged=function(){var e=this.viewModel.get("Basics.tooltip")||"";this.$datePickerContainer.add(this.$btnShowPopup).prop("title",e)},y.prototype.renderDatePicker=function(){var e,t,i,o,n,a=this;this.removeDatePicker(),this.$datePickerContainer.empty(),(e=this.api.getPropertyMeta("Basics.SelectedDate"))?null===e.viewstateType?null===e.viewstateType&&(e=null,e=this.currentPickerType):this.currentPickerType=e:e=this.currentPickerType,e&&e.viewstateType&&(i=(t=l.RTTI.getByName(e.viewstateType)).editor.type,o=t.editor.options,t.editor.validators,n=s.Form.editors[i],o=_.extend({},o,{beforeShowDay:function(e){return a.availableDates&&null!==a.availableDates[0]?[_.includes(a.availableDates,a.convertDateToString(e)),""]:[!0,""]},changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd",showAnim:"slideDown",showOn:"focus"}),this.datePicker=new n({id:_.uniqueId("date_"),schema:{options:o,validators:t.editor.validators}}).render(),o.bindButton?(this.bindButton(),this.$btnShowPopup.show()):this.$btnShowPopup.hide(),this.$el.attr("data-type",i),this.$datePickerContainer.append(this.datePicker.el),this.api.getPropertyMeta("Basics.SelectedDate")?(this.selectedDateType=this.api.getPropertyMeta("Basics.SelectedDate").viewstateType||this.selectedDateType,this.datePicker.setValue(this.api.getPropertyMeta("Basics.SelectedDate").value)):this.api.getPropertyMeta("Basics.SelectedDate")&&this.datePicker.setValue(this.api.getPropertyMeta("Basics.SelectedDate").defaultValue),null===this.previousPickerType&&(this.previousPickerType=this.currentPickerType.viewstateType),this.previousPickerType!==e.viewstateType&&this.setStyle(),this.previousPickerType=e.viewstateType,$.datepicker._gotoToday=function(e){var t=this._getInst($(e)[0]),i=this._get(t,"timepicker"),o=h.convertValueToMoment(null),o=h.convertMomentToDatePicker(o);this._base_gotoToday(e),this._setTime(t,o),this._setDate(t,o),i._onSelectHandler(),this._setDateDatepicker($(e)[0],o)},this.setWidth()),this.listenTo(this.datePicker,"change",function(){a.setError(null),a.api.setProperty("Basics.SelectedDate",a.datePicker.getValue()),a.datePicker&&a.datePicker.setValue(a.api.getPropertyMeta("Basics.SelectedDate").value)}),this.listenTo(this.datePicker,"close",function(){a.setError(null),a.api.setProperty("Basics.SelectedDate",a.datePicker.previousDate),a.datePicker&&a.datePicker.setValue(a.api.getPropertyMeta("Basics.SelectedDate").value)}),this.listenTo(this.datePicker,"invalid",function(){a.setError("Invalid date/time")})},y.prototype.removeDatePicker=function(){this.datePicker&&(this.stopListening(this.datePicker),this.datePicker.remove(),this.datePicker=null)},y.prototype.setError=function(e){e?(this.$el.addClass(this.errorClassName),this.$errorTooltip&&l.ErrorTooltip.clear(this.$errorTooltip),"date"===this.currentPickerType.viewstateType||"datetime"===this.currentPickerType.viewstateType?this.$errorTooltip=l.ErrorTooltip.show(e,this.$el.find(".ui-button-text")):this.$errorTooltip=l.ErrorTooltip.show(e,this.$el.find(".ui-state-default")),this.$btnShowPopup.addClass("datePickerButtonError"),this.$("#"+this.datePicker.id).addClass("datePickerInputBoxError")):(this.$el.removeClass(this.errorClassName),this.$btnShowPopup.removeClass("datePickerButtonError"),this.$("#"+this.datePicker.id).removeClass("datePickerInputBoxError"),l.ErrorTooltip.clear(this.$errorTooltip))},y.prototype.setFlagVisible=function(){this.visible=$("#ui-datepicker-div").is(":visible")},y.prototype.setStyle=function(){var e,t=this.api.getPropertyMeta("Basics.SelectedDate").viewstateType,i={"has-container":_.includes(["date","datetime","timestamp",null],t),"has-button":_.includes(["date","datetime",null],t),"datepicker-extended":"datetime"===t,"month-extended":"month"===t,"timespan-extended":"timespan"===t,"timestamp-extended":"timestamp"===t};for(e in i)this.$datePickerContainer.toggleClass(e,i[e])},y.prototype.setWidth=function(){_.isFunction(this.datePicker.setWidth)&&this.datePicker.setWidth(this.viewModel.get("Basics.width"))},y.prototype.updateLabelWidth=function(){var e=this.viewModel.get("Basics.labelWidth");e&&this.$lbl.css("width",e)},y.prototype.updateQueryStatus=function(e,t){t?"NoResults"!==t.type&&this.api.showQueryStatus(t):this.api.hideQueryStatus()};var g,j=y;function y(e){var t=g.call(this,_.extend(e,{tagName:"div",className:"basicComponents_datePicker"}))||this;return t.selectedChanged=!1,t.defaultType="date",t.errorClassName="error",t.hasInit=!1,t.selectedDateType=null,t.currentPickerType={viewstateType:null},t.previousPickerType=null,t.columns=[{id:"",index:0,kdbType:0}],t.primaryKey=null,t.api=e.options.api,t.visible=!1,t.availableDates=null,t.dateCollection=new s.Collection,t.viewModel=new s.DeepModel({SelectedDate:""}),t.debouncedRenderDatePicker=_.debounce(t.renderDatePicker.bind(t),100),t.currentPickerType.viewstateType=t.defaultType,t.options=e.options,t.listenTo(e.options.dashboardViewModel,"change:DashboardTheme",t.onThemeChanged.bind(t)),t.onThemeChanged(),t}b.escapeRegexCharacters=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\+\?\.\\\^\$\|]/g,"\\$&")},b.matchCustom=function(e,t){if(""===$.trim(e.term))return t;if(void 0===t.text)return null;var e=e.term||"",i=t.text||"";return b.isMatch(e.toLowerCase(),i.toLowerCase())?t:null},b.isMatch=function(e,t){var i,o=!1,n=e.split(/ +and +| +/);for(_.includes(n,"or")&&(n=_.without(n,"or"),o=!0),i=0;i<n.length;i++)0!==n[i].indexOf("-")&&n[i].indexOf("*")<0&&(n[i]="*"+n[i]+"*");var a=o||_.every(n,function(e){return 0===e.indexOf("-")});return _[o?"some":"every"](n,function(e){return b.isSimpleMatch(e,t,a)})},b.isSimpleMatch=function(e,t,i){var o=!1;if(i||0!==e.indexOf("-")||(e=e.replace("-",""),o=!0),""===t){if("null"===e||"*null*"===e)return!o}else if("-null"===e)return!0;i=new RegExp("^"+b.escapeRegexCharacters(e).replace(/\*/g,".*")+"$").test(t);return o?!i:i};var H=b;function b(){}var v,N={"Basics.AcceptEmptyValues":"AcceptEmptyValues","Basics.AdvancedSearch":"AdvancedSearch","Basics.Data":"Data","Basics.Flex":"Flex","Basics.ForceSelectedValue":"ForceSelectedValue","Basics.Items":"Items","Basics.Label":"Label","Basics.LabelWidth":"LabelWidth","Basics.DataSourceMapping.Text":"MappingText","Basics.DataSourceMapping.Value":"MappingValue","Basics.FieldSummaryThreshold":"FieldSummaryThreshold","Basics.MultiSelect":"MultiSelect","Basics.ShowRowCount":"ShowRowCount","Basics.SelectAllValue":"SelectAllValue","Basics.SelectedValue":"SelectedValue","Basics.SelectedObjectRouting":"SelectedObjectRouting","Basics.ShowSearch":"ShowSearch","Basics.TooltipSummaryThreshold":"TooltipSummaryThreshold","Basics.Width":"Width","Basics.EnableDropdownHeight":"EnableDropdownHeight","Basics.DropdownHeight":"DropdownHeight","Basics.horizontal":"HorizontalAlign","Basics.tooltip":"Tooltip","Basics.vertical":"VerticalAlign",dropdownPossibleValues:"dropdownPossibleValues"},R=["date","datetime","month","timestamp","minute","time","timespan","second"],U=["byte","short","int","long","float","double"],K=(v=s.View,e(f,v),f.prototype.onSettingsChange=function(e){var i=this;_.each(e,function(e,t){"Basics.SelectedValue"===t&&i.viewModel.set("SelectedValueCast",_.isArray(e)?e:i.castToDropdownValue(e)),i.viewModel.set(N[t]||t,e)}),this.hasInit||(this.hasInit=!0,this.afterInitialize())},f.prototype.onThemeChange=function(){var e=this.viewModel.get("Theme");this.options.dashboardViewModel.get("DashboardTheme")&&(e=this.options.dashboardViewModel.get("DashboardTheme")),this.$el.prop("class",""),this.$el.addClass(this.className),this.$el.addClass(e)},f.prototype.render=function(){return this.$el.html(m.dropdown()),this.$alignDiv=this.$(".align-div"),this},f.prototype.remove=function(){return this.removeCustomStyle(),this.dataModel&&(this.stopListening(this.dataModel),this.api.unsubscribe(this.dataModel)),s.View.prototype.remove.apply(this)},f.prototype.initializeEvents=function(){this.listenTo(this.viewModel,"change:Data",this.onDataSourceChanged.bind(this)),this.listenTo(this.viewModel,"change:HorizontalAlign",this.onHorizontalAlignChanged.bind(this)),this.listenTo(this.viewModel,"change:Label",this.onLabelChanged.bind(this)),this.listenTo(this.viewModel,"change:LabelWidth",this.updateLabelWidth.bind(this)),this.listenTo(this.viewModel,"change:SelectedValue",this.onSelectedValueChange.bind(this)),this.listenTo(this.viewModel,"change:Tooltip",this.updateTooltip.bind(this)),this.listenTo(this.viewModel,"change:VerticalAlign",this.onVerticalAlignChanged.bind(this)),this.listenTo(this.viewModel,"change:Width",this.updateWidth.bind(this)),this.listenTo(this.viewModel,"change:MultiSelect",this.onMultiselect.bind(this)),this.listenTo(this.viewModel,"change:ShowRowCount",this.toggleShowRowCount.bind(this)),this.listenTo(this.viewModel,"change:AcceptEmptyValues change:Items change:MappingText change:MappingValue change:MultiSelect change:ShowSearch change:AdvancedSearch change:FieldSummaryThreshold change:TooltipSummaryThreshold change:SelectAllValue change:ForceSelectedValue",this.debouncedRenderDropDown.bind(this))},f.prototype.initializeErrorHandler=function(e){var t=this;this.updateErrorMessage(),this.listenTo(e,"change:error",function(){t.updateErrorMessage()})},f.prototype.afterInitialize=function(){this.render(),this.initDropdown(),this.initLabel(),this.initializeEvents(),this.applyDataProperty(),this.onHorizontalAlignChanged(),this.onVerticalAlignChanged(),this.onLabelChanged(),this.onThemeChange(),this.debouncedRenderDropDown()},f.prototype.applyDataProperty=function(){var e=this.viewModel.get("Data");if(this.dataModel&&(this.stopListening(this.dataModel),this.api.unsubscribe(this.dataModel)),!e)return console.log("No datasource selected for Dropdown component"),void this.api.hideErrorMessage();this.dataModel=e,this.dataModel&&this.dataModel.attributes?(this.initializeErrorHandler(this.dataModel),this.api.subscribe(this.dataModel,this.onData.bind(this))):this.api.showErrorMessage({error:t('Invalid Data Source: "')+e.path+'" '+t("selected"),errorType:"Warning"})},f.prototype.castToDropdownValue=function(t){var e,i=this.api.getPropertyMeta("Basics.SelectedValue"),o="";return t&&t.class?(e=_.find(l.RTTI.infos,function(e){return e.num===parseInt(t.class.substr(2,2),10)}))&&(o=e.name):i&&i.viewstateType&&(o=i.viewstateType),t&&t.class&&_.includes(R,o)?(e=h.convertKDBTemporalToMoment(t),t=e.toDashString()):_.isArray(t)?t=t.join(","):_.isBoolean(t)||_.isNumber(t)||_.isObject(t)&&"function"==typeof t.toString?t=t.toString():_.isString(t)&&"timespan"===o&&-1<t.indexOf(".000Z")?t=t.replace(".000Z",".000000000Z"):_.isString(t)&&"datetime"===o&&null!==t.match(/[DTZ]/g)&&23<t.length&&(t=t.slice(0,23)+"Z"),t},f.prototype.dataSourceEnabled=function(){return this.viewModel.get("Data")instanceof s.Model},f.prototype.executeActions=function(){var i,t,o,e,n,a,s=this,l={},r=this.viewModel.get("Actions");r.length&&(i=this.viewModel.get("MultiSelect"),a=this.viewModel.get("SelectedValue"),n=this.viewModel.get("SelectAllValue"),a=i&&_.isArray(a)?a:[a],(e=!(!i||!a.length||n!==a[0]))||(o=this.dataSourceEnabled()?(t=this.viewModel.get("MappingValue"),a.map(function(e){return l[t]=e,s.collection.findWhere(l)})):a.map(function(e){return l.Value=e,_.find(s.currentValidDropDownItems,l)}),o=_.compact(o)),(i||0<o.length)&&(r=e?r.map(function(e){return _.defaults({Value:[n]},e)}):r.map(function(t){var e=o.map(function(e){return _.isFunction(e.get)?e.get(t.Current):e.Value}),e=i?e:e[0];return _.defaults({Value:e},t)}),this.api.doActions(r,"Actions")))},f.prototype.forceSelectedValue=function(){var e=this.viewModel.get("SelectedValue"),t=_.map(this.currentValidDropDownItems,"DropdownValue"),i=[];this.viewModel.get("ForceSelectedValue")&&(this.viewModel.get("MultiSelect")?(i=_.map(e,this.castToDropdownValue.bind(this)),this.api.setProperty("Basics.SelectedValue",_.intersection(t,i))):(i=this.castToDropdownValue(e),_.includes(t,i)||(this.currentValidDropDownItems[0]?this.api.setProperty("Basics.SelectedValue",this.currentValidDropDownItems[0].DropdownValue):this.api.setProperty("Basics.SelectedValue",""))))},f.prototype.initDropdown=function(){var i=this;this.$cmb=this.$(".basicComponents_cmb"),this.$dropdownContainer=this.$(".dropdown-container"),this.$cmb.on("select2:select select2:unselect",function(){var e,t=null;i.viewModel.get("MultiSelect")?((e=i.$cmb.select2("data")).length&&(t=_.map(e,function(e){return e.id})),i.viewModel.set("SelectedValue",t)):(t=i.dataSourceEnabled()?i.$cmb.val():(e=i.$cmb.select2("data")[0].text,(e=_.find(i.viewModel.get("Items"),{Text:e}))?e.Value:""),i.viewModel.set("SelectedValue",_.isUndefined(t)?null:t))})},f.prototype.initLabel=function(){this.$lbl=this.$(".dropdown-label")},f.prototype.onData=function(e,t){var i=this,o=e.columns;e.primaryKey!==this.primaryKey&&(this.primaryKey=e.primaryKey,this.collection.reset()),t.reset?this.collection.reset(t.reset):_.isArray(o.reset)&&_.isEmpty(o.reset)?this.collection.reset():(this.collection.remove(_.map(t.remove,function(e){return e[i.primaryKey]})),this.collection.add(t.add),this.collection.add(t.change,{merge:!0}))},f.prototype.onDataCollectionChanged=function(){var t=this,i={Text:this.viewModel.get("MappingText"),Value:this.viewModel.get("MappingValue")},e=this.collection.map(function(e){return{Value:e.get(i.Value),Text:e.get(i.Text),Data:e.cid,DropdownValue:t.castToDropdownValue(e.get(i.Value))}});this.$cmb.empty(),this.setSelectOptions(e),this.forceSelectedValue(),this.onSelectedValueChange(),this.updateWidth(),this.select&&this.select.$el.data("select2")&&this.select.$el.select2("close")},f.prototype.onDataSourceChanged=function(){this.applyDataProperty(),this.debouncedRenderDropDown()},f.prototype.onHorizontalAlignChanged=function(){this.$alignDiv.css("text-align",this.viewModel.get("HorizontalAlign"))},f.prototype.onLabelChanged=function(){this.$lbl.text(this.viewModel.get("Label"))},f.prototype.onMultiselect=function(){var e=this.$(".basicComponents_cmbCount");!this.viewModel.get("MultiSelect")&&this.viewModel.get("ShowRowCount")?this.api.setProperty("Basics.ShowRowCount",!1):"none"===e.css("display")&&this.toggleShowRowCount()},f.prototype.onSelectedValueChange=function(){var t=this,e=this.api.getPropertyMeta("Basics.SelectedValue"),i="",o=this.viewModel.get("SelectedValue"),n=[],a=0,s=0,l=(void 0!==o&&this.executeActions(),_.find(this.currentValidDropDownItems,function(e){return e.DropdownValue===o||e.DropdownValue===t.castToDropdownValue(o)})),e=(_.isObject(l)&&_.isBoolean(l.Value)&&(o=l.Value),e&&(i=e.viewstateType),l=o,_.includes(U,i)&&_.isNumber(o)?l=Number(o):"list"===i&&_.isString(o)&&(l=o.split(",")),e&&!_.isEqual(e.value,l)&&"dict"!==i&&(this.viewModel.set("SelectedValue",l,{silent:!0}),this.api.setProperty("Basics.SelectedValue",l)),_.map(this.currentValidDropDownItems,"DropdownValue"));this.viewModel.get("MultiSelect")?(this.dataSourceEnabled()?this.viewModel.get("Data")&&this.viewModel.get("Data").dataSet&&(a=this.viewModel.get("Data").dataSet.collection.length):a=(this.viewModel.get("Items")||[]).length,null!=l&&("dict"===i?l=n=_.chain(l).values().map(this.castToDropdownValue.bind(this)).value():n=_.isArray(l)?l:[this.castToDropdownValue(l)],s=Math.min(a,_.intersection(e,n).length)),this.$(".basicComponents_cmbCount").text(s+" / "+a),_.isEqual(l,this.$cmb.val())||this.$cmb.val(l).trigger("change")):(i=this.castToDropdownValue(l),e.length&&(_.includes(e,i)?this.$cmb.val(i):this.$cmb.val("")).trigger("change"),this.updateWidth())},f.prototype.onVerticalAlignChanged=function(){this.$alignDiv.css("vertical-align",this.viewModel.get("VerticalAlign"))},f.prototype.removeCustomStyle=function(){this.$styleEl&&(this.$styleEl.remove(),this.$styleEl=null)},f.prototype.renderDropDown=function(){var e,t=this,i=this.viewModel.get("ShowSearch"),o=this.api.getPropertyMeta("Basics.SelectedValue");this.$dropdownContainer.empty(),e=this.viewModel.get("MultiSelect")?s.Form.editors.MultiSelect:s.Form.editors.Select,this.select&&(this.select.off(),this.select.remove()),this.select=new e(_.extend({model:this.viewModel,schema:{dropdownId:this.dropdownId,enforceValue:this.viewModel.get("ForceSelectedValue"),onReadyCallback:this.options.onReadyCallback,inputItemLimit:this.viewModel.get("FieldSummaryThreshold"),options:_.map(this.currentValidDropDownItems,function(e){return{label:e.Text,val:e.DropdownValue||e.Value}})||[],matcher:this.viewModel.get("AdvancedSearch")?H.matchCustom:null,multiSelect:this.viewModel.get("MultiSelect"),selectAllValue:this.viewModel.get("SelectAllValue"),showSearch:i,tooltip:function(e){return t.viewModel.get("Tooltip")?t.viewModel.get("Tooltip"):e},tooltipItemLimit:this.viewModel.get("TooltipSummaryThreshold"),viewstateType:o?o.viewstateType:null,width:this.viewModel.get("Width")}},_.zipObject(["key"],["SelectedValueCast"]))),this.$dropdownContainer.width(this.viewModel.get("Width")),this.$dropdownContainer.append(this.select.el),this.select.on("change",function(){t.viewModel.set("SelectedValue",t.select.getValue()),t.updateTooltip()}),this.dataSourceEnabled()?(e={Text:this.viewModel.get("MappingText"),Value:this.viewModel.get("MappingValue")}).Value&&e.Text&&this.dataModel?(this.$cmb.empty(),this.onDataCollectionChanged()):(this.currentValidDropDownItems=[],this.$cmb.empty(),this.setSelectOptions(this.currentValidDropDownItems),this.forceSelectedValue()):(this.currentValidDropDownItems=[],this.$cmb.empty(),i=_.map(this.viewModel.get("Items"),function(e){return{Value:e.Value,Text:e.Text,DropdownValue:t.castToDropdownValue(e.Value)}}),this.setSelectOptions(i),this.forceSelectedValue(),this.onSelectedValueChange()),this.updateWidth(),this.onMultiselect(),this.updateLabelWidth(),this.updateTooltip()},f.prototype.setSelectOptions=function(e){var t=this.viewModel.get("AcceptEmptyValues");_.each(e,function(e){_.isArray(e.Value)&&(e.Value=e.Value.join(","))}),this.currentValidDropDownItems=t?e:_.filter(e,function(e){return null!==e.Value&&void 0!==e.Value&&""!==e.Value}),this.select&&this.select.setOptions(_.map(this.currentValidDropDownItems,function(e){return{label:e.Text,val:e.DropdownValue||e.Value}}))},f.prototype.toggleShowRowCount=function(){var e=this.$(".basicComponents_cmbCount"),t=this.$el.find(".select2.select2-container");this.viewModel.get("ShowRowCount")?(this.viewModel.get("MultiSelect")||this.api.setProperty("Basics.MultiSelect",!0),t.addClass("dropdown-count-enabled"),e.show()):(t.removeClass("dropdown-count-enabled"),e.hide())},f.prototype.updateErrorMessage=function(){this.dataModel&&this.dataModel.get("error")?this.api.showErrorMessage(this.dataModel.get("error")):this.api.hideErrorMessage()},f.prototype.updateLabelWidth=function(){var e=this.viewModel.get("LabelWidth"),e=Number(e);_.isNumber(e)&&!_.isNaN(e)&&this.$(".dropdown-label").css("width",e)},f.prototype.updateTooltip=function(){var e,t,i;this.viewModel.get("Tooltip")?(this.$el.find(".dropdown-container").prop("title",this.viewModel.get("Tooltip")),this.$el.find(".select2-selection__rendered").prop("title",this.viewModel.get("Tooltip"))):this.viewModel.get("MultiSelect")?(t=this.select.model.get("SelectedValue")===this.viewModel.get("SelectAllValue")?this.select.value:this.select.model.get("SelectedValue"),i=this.viewModel.get("TooltipSummaryThreshold"),t&&_.isArray(t)?e=t.slice(0,i||t.length).join(", "):t&&_.isString(t)&&(e=t),t.length>i&&0!==i&&(e+=" and "+(t.length-i)+" more"),this.$el.find(".dropdown-container").prop("title",e),this.$el.find(".select2-selection__rendered").prop("title",e)):(this.$el.find(".dropdown-container").prop("title",this.viewModel.get("SelectedValue")),this.$el.find(".select2-selection__rendered").prop("title",this.viewModel.get("SelectedValue")))},f.prototype.updateWidth=function(){var e=this.viewModel.get("Width");this.select&&this.select.setWidth(e)},f);function f(e){var t=v.call(this,_.extend(e,{tagName:"div",className:"basicComponents_dropdown"}))||this;return t.currentValidDropDownItems=[],t.handlebarFn=null,t.$styleEl=null,t.hasInit=!1,t.dropdownId="",t.dataModel=null,t.options=e.options,t.api=t.options.api,t.viewModel=new s.DeepModel,t.primaryKey="_rowIndex",t.collection=new s.Collection([],{model:s.Model.extend({idAttribute:t.primaryKey})}),t.debouncedOnDataCollectionChanged=_.debounce(t.onDataCollectionChanged.bind(t),100),t.debouncedRenderDropDown=_.debounce(t.renderDropDown.bind(t),100),t.listenTo(t.collection,"change add remove reset",t.debouncedOnDataCollectionChanged),t.dropdownId="dropdown-container-"+t.cid,t}w=s.View,e(S,w),S.prototype.onData=function(e,t){this.dataSet=t.items(),this.updateHTML()},S.prototype.onSettingsChange=function(e){var i=this;_.each(e,function(e,t){switch(t){case"Basics.Data":i.applyDataProperty(e),i.updateHTML();break;case"Basics.FontSize":i.$el.css("font-size",e+"px");break;case"Basics.horizontal":i.$textAlign.css("text-align",e);break;case"Basics.HtmlText":i.htmlText=e,i.updateHTML();break;case"Basics.Template":try{i.api.unsubscribeTemplateViewStates(i.templateSubscriptionKey),i.template=null,i.templateSubscriptionKey=null,e?(i.template=n.compile(e),i.templateSubscriptionKey=i.api.subscribeTemplateViewStates(e,function(e){i.viewStates=e,i.updateHTML()})):i.updateHTML()}catch(e){}break;case"Basics.theme":i.theme=e,i.onThemeChange();break;case"Basics.tooltip":i.$html.prop("title",e);break;case"Basics.vertical":i.$textAlign.css("vertical-align",e)}})},S.prototype.remove=function(){return this.dataModel&&this.api.unsubscribe(this.dataModel),s.View.prototype.remove.apply(this)},S.prototype.applyDataProperty=function(e){this.dataModel&&(_.isEqual(this.dataModel,{})||this.api.unsubscribe(this.dataModel),this.dataModel=null),e&&(this.dataModel=e,this.dataModel&&this.dataModel.attributes?(this.api.hideErrorMessage(),this.api.subscribe(this.dataModel,this.onData.bind(this))):this.api.showErrorMessage({error:t("Invalid Data Source")+': "'+this.dataModel.path+'" '+t("selected"),type:"Warning"}))},S.prototype.onThemeChange=function(){var e=this.theme;this.dashboardViewModel.get("DashboardTheme")&&(e=this.dashboardViewModel.get("DashboardTheme")),this.$el.prop("class",""),this.$el.addClass(this.className),this.$el.addClass(e)},S.prototype.parseTextToHtml=function(e){return e=(e=(e=""+e).replace(/\n/g,"<br/>")).replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")},S.prototype.stringify=function(e){return _.isArray(e)?JSON.stringify(e):_.isObject(e)?_.isFunction(e.toString)&&"[object Object]"!==e.toString()?e.toString():JSON.stringify(e):e},S.prototype.updateHTML=function(){this.dataModel?this.template?this.$html.html(this.template(_.extend(this.dataSet,this.viewStates))):this.$html.text(this.stringify(this.dataSet)):this.htmlText?this.$html.html(this.stringify(this.htmlText)):this.$html.html(this.parseTextToHtml(this.stringify(this.htmlText)))};var w,q=S;function S(e){var t=w.call(this,_.extend(e,{tagName:"div",className:"basicComponents_label"}))||this;return t.template=null,t.htmlText="",t.dataModel=null,t.theme="Dark",t.dataSet=[],t.api=e.options.api,t.templateSubscriptionKey=null,t.api=e.options.api,t.dashboardViewModel=e.options.dashboardViewModel,t.$el.html(m.label()),t.$el.css({height:"100%"}),t.$textAlign=t.$(".text-align"),t.$html=t.$el.find(".htmlContent"),t.onThemeChange(),t}M=s.View,e(T,M),T.prototype.onSettingsChange=function(e){var i=this;_.each(e,function(e,t){_.isObject(e)&&_.isEmpty(e)||i.viewModel.set(t,e)})},T.prototype.remove=function(){return this.removeCustomStyle(),this.$button.off(),this.$button.button("destroy"),s.View.prototype.remove.apply(this)},T.prototype.render=function(){return this.$el.html(m.linkButton(this.viewModel.get("Basics"))),this.$button=this.$el.find(".button-root"),this.$button.attr("id",this.buttonId),this.$button.button().click(this.onButtonClick.bind(this)),this.$alignDiv=this.$(".align-div"),this.onWidthChange(),this.onAlignHorizontalChanged(),this.onAlignVerticalChanged(),this},T.prototype.contrast=function(t,i){var e=[[1,3],[3,5],[5,7]].map(function(e){return+("0x"+t.substring(e[0],e[1]))}),o=127.5<e.reduce(function(e,t,i,o){return t+e/o.length},0);return"#"+(e=e.map(function(e){var t=o?e:255-e;return Math.floor(o?e-t*i:e+t*i)})).map(function(e){return("0"+e.toString(16)).slice(-2)}).join("")},T.prototype.initializeEvents=function(){this.listenTo(this.viewModel,"change:Basics.FontSize",this.onFontSizeChanged.bind(this)),this.listenTo(this.viewModel,"change:Basics.horizontal",this.onAlignHorizontalChanged.bind(this)),this.listenTo(this.viewModel,"change:Basics.Label",this.onLabelChanged.bind(this)),this.listenTo(this.viewModel,"change:Basics.Icon",this.onIconChanged.bind(this)),this.listenTo(this.viewModel,"change:Basics.tooltip",this.onTooltipChange.bind(this)),this.listenTo(this.viewModel,"change:Basics.vertical",this.onAlignVerticalChanged.bind(this)),this.listenTo(this.viewModel,"change:Basics.fixedWidth",this.onWidthChange.bind(this)),this.listenTo(this.viewModel,"change:Basics.width",this.onWidthChange.bind(this)),this.listenTo(this.viewModel,"change:Style.background",this.onBackgroundChange.bind(this)),this.listenTo(this.viewModel,"change:Style.color",this.onColorChange.bind(this)),this.listenTo(this.viewModel,"change:Style.border",this.onBorderChange.bind(this)),this.listenTo(this.viewModel,"change:Basics.isEnabled",this.toggleButton.bind(this))},T.prototype.createCustomStyle=function(){var e;this.$styleEl||((e=document.createElement("style")).type="text/css",document.head.appendChild(e),this.$styleEl=$(e))},T.prototype.onAlignHorizontalChanged=function(){this.$alignDiv.css("text-align",this.viewModel.get("Basics.horizontal"))},T.prototype.onAlignVerticalChanged=function(){this.$alignDiv.css("vertical-align",this.viewModel.get("Basics.vertical"))},T.prototype.onBackgroundChange=function(e,t){var i,o,n=this;t?(this.createCustomStyle(),t=this.getGradientColors(t),i=_.map(t,function(e){return n.contrast(e,.1)}),o=_.map(i,function(e){return n.contrast(e,.1)}),t=m.linkButtonCustomStyle({cid:this.buttonId,c0:t[0],c1:t[1],c2:t[2],h0:i[0],h1:i[1],h2:i[2],a0:o[0],a1:o[1],a2:o[2]}),this.$styleEl.text(t)):this.removeCustomStyle()},T.prototype.onBorderChange=function(e,t){this.$button.css({"border-color":t})},T.prototype.onButtonClick=function(){this.api.doActions(this.viewModel.get("Actions"),"Actions")},T.prototype.onColorChange=function(e,t){this.$button.css({color:t})},T.prototype.onFontSizeChanged=function(){this.$button.css("font-size",parseFloat(this.viewModel.get("Basics.FontSize")))},T.prototype.onIconChanged=function(){var e=this.viewModel.get("Basics.Icon");""!==e&&(0<=e.indexOf("mi-")?e="mi "+e:0<=e.indexOf("fa-")&&(e="fa "+e)),this.$button.button("option","icons",{primary:e||null})},T.prototype.onLabelChanged=function(){this.$button.button("option","label",this.viewModel.get("Basics.Label"))},T.prototype.onTooltipChange=function(){this.$button.prop("title",this.viewModel.get("Basics.tooltip"))},T.prototype.onWidthChange=function(){var e=this.viewModel.get("Basics.width"),t=this.viewModel.get("Basics.fixedWidth");e&&t?this.$button.width(e):this.$button.width("98%")},T.prototype.getGradientColors=function(t){return _.map([[1,3],[3,5],[5,7]],function(e){return+("0x"+t.substring(e[0],e[1]))}).reduce(function(t,e,i,o){return t[i]=o.map(function(e){return e*t[i]}),t},[.8354430379746836,.9620253164556962,1]).map(function(e){return e.reduce(function(e,t){t=Math.round(t).toString(16);return e+(1===t.length?"0":"")+t},"#")})},T.prototype.removeCustomStyle=function(){this.$styleEl&&(this.$styleEl.remove(),this.$styleEl=null)},T.prototype.toggleButton=function(){var e=this.viewModel.get("Basics.isEnabled")?"enable":"disable";this.$button.button(e)};var M,Q=T;function T(e){var t=M.call(this,_.extend(e,{className:"link-button"}))||this;return t.buttonId=null,t.$styleEl=null,t.buttonId=t.cid+"btn",t.api=e.options.api,t.dashboardAppModel=e.options.dashboardAppModel,t.dashboardViewModel=e.options.dashboardViewModel,t.viewModel=new s.DeepModel,t.render(),t.initializeEvents(),t}var D,Y={"Basics.AcceptEmptyValues":"AcceptEmptyValues","Basics.Data":"Data","Basics.ForceSelectedValue":"ForceSelectedValue","Basics.Items":"Items","Basics.Label":"Label","Basics.LabelWidth":"LabelWidth","Basics.DataSourceMapping.Text":"MappingText","Basics.DataSourceMapping.Value":"MappingValue","Basics.MultiSelect":"MultiSelect","Basics.SelectedValue":"SelectedValue","Basics.SelectedObjectRouting":"SelectedObjectRouting","Basics.UseDataSource":"UseDataSource","Basics.horizontal":"HorizontalAlign","Basics.vertical":"VerticalAlign","Basics.ItemsLayout":"ItemsLayout","Style.labelTemplate":"labelTemplate"},Z=["date","datetime","month","timestamp","minute","time","timespan","second"],G=["byte","short","int","long","float","double"],J=(D=s.View,e(C,D),C.prototype.onSettingsChange=function(e){var i=this;_.each(e,function(e,t){i.viewModel.set(Y[t]||t,e)}),this.hasInit||(this.hasInit=!0,this.afterInitialize())},C.prototype.onThemeChange=function(){var e=this.viewModel.get("Theme");this.options.dashboardViewModel.get("DashboardTheme")&&(e=this.options.dashboardViewModel.get("DashboardTheme")),this.$el.prop("class",""),this.$el.addClass(this.className),this.$el.addClass(e)},C.prototype.render=function(){return this.$el.html(m.radio()),this.$alignDiv=this.$(".align-div"),this},C.prototype.remove=function(){return this.dataModel&&(this.stopListening(this.dataModel),this.api.unsubscribe(this.dataModel)),this.unsubscribeTemplateViewStates(),s.View.prototype.remove.apply(this)},C.prototype.renderDropDown=function(){var e;this.viewModel.get("UseDataSource")?(e={Text:this.viewModel.get("MappingText"),Value:this.viewModel.get("MappingValue")}).Value&&e.Text&&this.dataModel?(this.$cmb.find("input").off(),this.$cmb.empty(),this.onDataCollectionChanged()):(this.currentValidDropDownItems=[],this.$cmb.find("input").off(),this.$cmb.empty(),this.appendItemsToDropdown(this.currentValidDropDownItems),this.forceSelectedValue(),this.updateLabelWidth()):(this.currentValidDropDownItems=[],this.$cmb.find("input").off(),this.$cmb.empty(),e=this.viewModel.get("Items"),this.appendItemsToDropdown(e),this.forceSelectedValue(),this.selectValueInDropdown(),this.updateLabelWidth()),this.onItemsLayoutChanged()},C.prototype.initializeEvents=function(){this.listenTo(this.viewModel,"change:Data change:UseDataSource",this.onDataSourceChanged.bind(this)),this.listenTo(this.viewModel,"change:HorizontalAlign",this.onHorizontalAlignChanged.bind(this)),this.listenTo(this.viewModel,"change:Label",this.onLabelChanged.bind(this)),this.listenTo(this.viewModel,"change:LabelWidth",this.updateLabelWidth.bind(this)),this.listenTo(this.viewModel,"change:SelectedValue",this.selectValueInDropdown.bind(this)),this.listenTo(this.viewModel,"change:VerticalAlign",this.onVerticalAlignChanged.bind(this)),this.listenTo(this.viewModel,"change:ItemsLayout",this.onItemsLayoutChanged.bind(this)),this.listenTo(this.viewModel,"change:ForceSelectedValue",this.forceSelectedValue.bind(this)),this.listenTo(this.viewModel,"change:AcceptEmptyValues change:Items change:MappingText change:MappingValue change:MultiSelect change:labelTemplate",this.debouncedRenderDropDown.bind(this))},C.prototype.initializeErrorHandler=function(e){this.updateErrorMessage(),this.listenTo(e,"change:error",this.updateErrorMessage.bind(this))},C.prototype.afterInitialize=function(){this.render(),this.initDropdown(),this.initLabel(),this.initializeEvents(),this.applyDataProperty(),this.onHorizontalAlignChanged(),this.onVerticalAlignChanged(),this.onLabelChanged(),this.onThemeChange(),this.debouncedRenderDropDown()},C.prototype.isSingleCheckBox=function(){return!this.viewModel.get("UseDataSource")&&1===this.viewModel.get("Items").length||this.viewModel.get("UseDataSource")&&1===this.collection.models.length},C.prototype.appendItemsToDropdown=function(e){var l=this,t=null,i=this.viewModel.get("AcceptEmptyValues"),r=this.viewModel.get("MultiSelect"),o=_.uniqueId("radio_"),d=_.uniqueId("radio_group_name_"),c=this.viewModel.get("labelTemplate"),p=$(document.createDocumentFragment());c&&""!==c&&(this.handlebarFn=n.compile(c)),_.each(e,function(e){_.isArray(e.Value)&&(e.Value=e.Value.join(","))}),this.currentValidDropDownItems=i?e:_.filter(e,function(e){return null!==e.Value&&void 0!==e.Value&&""!==e.Value}),0!==this.currentValidDropDownItems.length&&(!i||r||_.find(this.currentValidDropDownItems,function(e){return""===e.DropdownValue||null===e.Value||void 0===e.Value||""===e.Value}))||(e=document.createElement("input"),i=document.createElement("label"),t=document.createElement("div"),$(e).attr("type",r?"checkbox":"radio"),$(e).attr("id",o),$(e).attr("name",d),$(e).val(""),$(e).attr("data",null),$(i).attr("for",o),$(i).text("-"),t.appendChild(e),t.appendChild(i),p.append(t)),this.unsubscribeTemplateViewStates(),_.each(this.currentValidDropDownItems,function(t){var e=document.createElement("input"),i=null===t.Text||void 0===t.Text?"":t.Text,o=document.createElement("label"),n=document.createElement("div"),a=_.uniqueId("radio_");if($(e).attr("type",r?"checkbox":"radio"),$(e).attr("id",a),$(e).attr("name",d),$(o).attr("for",a),l.handlebarFn){var s="";try{l.subscriptionKeys.push(l.api.subscribeTemplateViewStates(c,function(e){s=l.handlebarFn(_.extend({},t,t.Row||{},e)),$(o).html(s)}))}catch(e){s=""}$(o).html(s)}else $(o).text(i);(null===t.DropdownValue||void 0===t.DropdownValue||t.Value&&!t.DropdownValue)&&(t.DropdownValue=t.Value),$(e).val(t.DropdownValue),$(e).attr("data",t.Data),n.appendChild(e),n.appendChild(o),p.append(n)}),this.$cmb.append(p),this.$cmb.find("input").on("change",function(){var e;l.viewModel.get("MultiSelect")?(e=_.map(l.$cmb.find("input:checked"),function(e){return $(e).val()}),l.isSingleCheckBox()&&(e=_.first(e))):e=l.$cmb.find("input:checked").val(),l.viewModel.set("SelectedValue",e)})},C.prototype.applyDataProperty=function(){var e=this.viewModel.get("Data");this.dataModel&&(this.stopListening(this.dataModel),this.api.unsubscribe(this.dataModel)),this.viewModel.get("UseDataSource")&&(e?(this.dataModel=e,this.dataModel&&this.dataModel.attributes?(this.initializeErrorHandler(this.dataModel),this.api.subscribe(this.dataModel,this.onData.bind(this))):this.api.showErrorMessage({error:t('Invalid Data Source: "')+e.path+'" '+t("selected"),errorType:"Warning"})):this.api.showErrorMessage({error:t("To populate this component, please define a")+" <b> "+t("Data Source")+"</b> "+t("from")+"<b>"+t("Properties")+"-"+t("Basics")+"</b>",type:"Warning"}))},C.prototype.castToDropdownValue=function(t){var e,i,o=this.api.getPropertyMeta("Basics.SelectedValue"),n="";if(t&&t.class?(i=_.find(l.RTTI.infos,function(e){return e.num===parseInt(t.class.substr(2,2),10)}))&&(n=i.name):o&&o.viewstateType&&(n=o.viewstateType),t&&t.class&&_.includes(Z,n))switch(e=h.convertKDBTemporalToMoment(t),n){case"date":t=e.format("YYYY-MM-DD");break;case"month":t=e.format("YYYY-MM");break;case"datetime":case"timestamp":case"minute":case"time":case"timespan":case"second":t=e.toISOStringNano()}else _.isArray(t)?t=t.join(","):(_.isBoolean(t)||_.isNumber(t)||_.isObject(t)&&_.isFunction(t.toString))&&(t=t.toString());return t},C.prototype.executeActions=function(){var i,t,o,e,n=this,a={},s=this.viewModel.get("Actions");s.length&&(i=this.viewModel.get("MultiSelect"),e=this.viewModel.get("SelectedValue"),e=i&&_.isArray(e)?e:[e],o=this.viewModel.get("UseDataSource")?(t=this.viewModel.get("MappingValue"),e.map(function(e){return a[t]=e,n.collection.findWhere(a)})):e.map(function(e){return a.Value=e,_.find(n.currentValidDropDownItems,a)}),o=_.compact(o),(i||0<o.length)&&(s=s.map(function(t){var e=o.map(function(e){return _.isFunction(e.get)?e.get(t.Current):e.Value}),e=i?e:e[0];return _.defaults({Value:e},t)}),this.api.doActions(s,"Actions")))},C.prototype.forceSelectedValue=function(){var e=this.viewModel.get("SelectedValue"),e=this.castToDropdownValue(e),t=_.map(this.currentValidDropDownItems,"DropdownValue");this.viewModel.get("ForceSelectedValue")&&!_.includes(t,e)&&(this.viewModel.get("MultiSelect")?this.api.setProperty("Basics.SelectedValue",t[0]):this.currentValidDropDownItems[0]?this.api.setProperty("Basics.SelectedValue",this.currentValidDropDownItems[0].DropdownValue):this.api.setProperty("Basics.SelectedValue",""))},C.prototype.initDropdown=function(){this.$cmb=this.$(".radio_buttons")},C.prototype.initLabel=function(){this.$lbl=this.$(".basicComponents_cmbLbl")},C.prototype.onData=function(e,t){var i,o=this,n=e.columns;e.primaryKey!==this.primaryKey&&(this.primaryKey=e.primaryKey,this.collection.reset()),n.reset&&(i=[""].concat(_.map(n.reset,function(e){return e.id})),!_.includes(i,this.viewModel.get("MappingValue"))&&n.reset.length&&this.api.setProperty("Basics.DataSourceMapping.Value",""),!_.includes(i,this.viewModel.get("MappingText"))&&n.reset.length&&this.api.setProperty("Basics.DataSourceMapping.Text",""),_.defer(function(){o.api.setProperty("dropdownPossibleValues",i)})),t.reset?this.collection.reset(t.reset):_.isArray(n.reset)&&_.isEmpty(n.reset)?this.collection.reset():(this.collection.remove(_.map(t.remove,function(e){return e[o.primaryKey]})),this.collection.add(t.add),this.collection.add(t.change,{merge:!0}))},C.prototype.onDataCollectionChanged=function(){var t=this,i={Text:this.viewModel.get("MappingText"),Value:this.viewModel.get("MappingValue")},e=this.collection.map(function(e){return{Value:e.get(i.Value),Text:e.get(i.Text),Data:e.cid,Row:e.attributes,DropdownValue:t.castToDropdownValue(e.get(i.Value))}});this.$cmb.find("input").off(),this.$cmb.empty(),this.appendItemsToDropdown(e),this.forceSelectedValue(),this.selectValueInDropdown()},C.prototype.onDataSourceChanged=function(){this.applyDataProperty(),this.debouncedRenderDropDown()},C.prototype.onHorizontalAlignChanged=function(){this.$alignDiv.css("text-align",this.viewModel.get("HorizontalAlign"))},C.prototype.onItemsLayoutChanged=function(){var e=this.viewModel.get("ItemsLayout");"Horizontal"===e?(this.$cmb.toggleClass("horizontal",!0),this.$cmb.toggleClass("vertical",!1)):"Vertical"===e&&(this.$cmb.toggleClass("horizontal",!1),this.$cmb.toggleClass("vertical",!0))},C.prototype.onLabelChanged=function(){this.$lbl.text(this.viewModel.get("Label"))},C.prototype.onVerticalAlignChanged=function(){this.$alignDiv.css("vertical-align",this.viewModel.get("VerticalAlign"))},C.prototype.selectValueInDropdown=function(){var e="",o=this.viewModel.get("SelectedValue"),t=this.api.getPropertyMeta("Basics.SelectedValue"),i=(void 0!==o&&this.executeActions(),_.find(this.currentValidDropDownItems,function(e){return e.DropdownValue===o}));_.isObject(i)&&_.isBoolean(i.Value)&&(o=i.Value),t&&(e=t.viewstateType),i=o,_.includes(G,e)?i=Number(o):"list"===e&&_.isString(o)?i=o.split(","):_.isBoolean(o)&&(i=o),e&&this.api.setProperty("Basics.SelectedValue",i),this.viewModel.get("MultiSelect")?o?(_.isArray(o)||(o=_.isString(o)?[o.split(",")]:[o]),this.isSingleCheckBox()&&(o=_.first(o)),this.$cmb.find("input").each(function(e,t){var t=$(t),i=t.val();i&&(_.includes(o,i)||_.isEqual(o.toString(),i.toString()))?t.prop("checked",!0):t.prop("checked",!1)})):this.viewModel.get("AcceptEmptyValues")?this.$cmb.find("input:not([name])").prop("checked",!0):this.$cmb.find("input").prop("checked",!1):(t=this.castToDropdownValue(o),(e=_.map(this.currentValidDropDownItems,"DropdownValue")).length&&(_.includes(e,t)?(this.$cmb.find('input[value="'+t+'"]').prop("checked",!0),this.$cmb.val(t).trigger("change")):(this.$cmb.find("input").prop("checked",!1),this.$cmb.val("").trigger("change"))))},C.prototype.unsubscribeTemplateViewStates=function(){var t=this;0<this.subscriptionKeys.length&&(_.each(this.subscriptionKeys,function(e){t.api.unsubscribeTemplateViewStates(e)}),this.subscriptionKeys=[])},C.prototype.updateErrorMessage=function(){this.dataModel&&this.dataModel.get("error")?this.api.showErrorMessage(this.dataModel.get("error")):this.api.hideErrorMessage()},C.prototype.updateLabelWidth=function(){this.viewModel.get("LabelWidth")&&this.$(".basicComponents_cmbLbl").css("width",this.viewModel.get("LabelWidth"))},C);function C(e){var t=D.call(this,_.extend(e,{tagName:"div",className:"basicComponents_radio"}))||this;return t.handlebarFn=null,t.hasInit=!1,t.subscriptionKeys=[],t.currentValidDropDownItems=[],t.options=e.options,t.api=t.options.api,t.dataModel=null,t.viewModel=new s.DeepModel,t.primaryKey="_rowIndex",t.collection=new s.Collection([],{model:s.Model.extend({idAttribute:t.primaryKey})}),t.debouncedOnDataCollectionChanged=_.debounce(t.onDataCollectionChanged.bind(t),100),t.debouncedRenderDropDown=_.debounce(t.renderDropDown.bind(t),100),t.listenTo(t.collection,"change add remove reset",t.debouncedOnDataCollectionChanged.bind(t)),t}var V,B="LOAD",x="UP",X="DOWN",k="DISCONNECTED",ee=(V=s.View,e(P,V),P.prototype.remove=function(){return this.model.set("IsEnabled",!1),s.View.prototype.remove.apply(this)},P.prototype.render=function(){return this.$el.html(m.serverStatus()),this},P.prototype.executeConnectionQuery=function(){var t=this,e=this.model.get("IsEnabled"),i=this.model.get("Connection");this.pollingTimer&&clearTimeout(this.pollingTimer),e&&i?(this.model.set("Status",B),this.options.DeltaClientLib.getQueryData("kdb",i,".z.p",null,function(e){e=e.rows[0],e=e[_.keys(e)[0]],e=h.convertKDBTemporalToMoment(e);t.model.set("Status",x),t.model.set("StatusDate",e),t.setPollingTimer()},function(e){t.model.set("Status",X),t.setPollingTimer()})):this.model.set("Status",k)},P.prototype.initConnections=function(){function e(e){var t=$.Deferred();return e&&(0===e.length?e.fetch({success:t.resolve,error:t.reject}):_.defer(t.resolve)),t.promise()}var t=this,i=this.options.dashboardAppModel.get("connections"),o=this.options.dashboardAppModel.get("connectionGroups");$.when(e(i),e(o)).then(function(){var e=_.concat(o.map("name"),i.map("name"));t.settingsModel.set("possibleConnections",e),t.connectionsLoaded=!0}).fail(function(){a.Log.Warn("ServerStatus could not fetch connection or connection groups")})},P.prototype.initEventHandlers=function(){var i=this;this.listenTo(this.model,"change:IsEnabled change:Connection",this.executeConnectionQuery.bind(this)),this.listenTo(this.model,"change:Status",_.bind(function(e){var e=e.previous("Status"),t=i.model.get("Status");e===x&&t===B||i.$txtLineStatus.text(t),i.onThemeChange()},this)),this.listenTo(this.model,"change:StatusDate",_.bind(function(){var e=i.model.get("StatusDate");i.$txtServerTime.text(e.format("HH:mm:ss"))},this))},P.prototype.initUiControls=function(){this.$txtLineStatus=this.$(".txtLineStatus"),this.$txtServerTime=this.$(".txtServerTime")},P.prototype.onSettingsModelChange=function(){this.onThemeChange(),this.setOnIsEnabled(),this.setServerConnection(),this.setPollingInterval()},P.prototype.onThemeChange=function(){var e=this.model.get("Status"),t=this.settingsModel.get("Basics").Theme;switch(this.options.dashboardViewModel.get("DashboardTheme")&&(t=this.options.dashboardViewModel.get("DashboardTheme")),this.$el.prop("class",""),this.$el.addClass(this.className),this.$el.addClass(t),e){case B:this.$el.addClass("LOADING");break;case x:this.$el.addClass("UP");break;case X:this.$el.addClass("DOWN");break;case k:this.$el.addClass("DISCONNECTED")}},P.prototype.setOnIsEnabled=function(){var e=this.settingsModel.get("Basics").IsEnabled;this.model.set("IsEnabled",e)},P.prototype.setPollingInterval=function(){var e=this.settingsModel.get("Basics").PollingInterval;this.model.set("PollingInterval",e)},P.prototype.setPollingTimer=function(){var e=this,t=this.model.get("PollingInterval");this.pollingTimer=setTimeout(function(){console.log("SERVER STATUS setPollingTimer, executing"),e.executeConnectionQuery()},1e3*t)},P.prototype.setServerConnection=function(){var e=this.settingsModel.get("Basics").Connection;this.model.set("Connection",e)},P);function P(e){var t=V.call(this,_.extend(e,{tagName:"div",className:"basicComponents_serverStatus"}))||this;return t.connectionsLoaded=!1,t.options=e.options,t.settingsModel=t.options.settingsModel,t.model=new s.Model,t.render(),t.initUiControls(),t.initEventHandlers(),t.onSettingsModelChange(),t.listenTo(t.settingsModel,"change",t.onSettingsModelChange.bind(t)),t.model.set("Status",k),t.initConnections(),t.onThemeChange(),t}var A,te={"Basics.fixedHeight":"fixedHeight","Basics.fixedWidth":"fixedWidth","Basics.FontSize":"fontsize","Basics.height":"height","Basics.horizontal":"horizontal","Basics.Type":"type","Basics.Text":"text","Basics.vertical":"vertical","Basics.width":"width"},ie=(A=s.View,e(I,A),I.prototype.afterInitialize=function(){this.initializeEvents(),this.onFontSizeChanged(),this.onHeightChanged(),this.onHorizontalChanged(),this.onTextChanged(),this.onVerticalChanged(),this.onWidthChanged(),this.onInputTypeChanged()},I.prototype.onSettingsChange=function(e){var i=this;_.each(e,function(e,t){i.viewModel.set(te[t]||t,e)}),this.hasInit||(this.hasInit=!0,this.afterInitialize())},I.prototype.onResize=function(){this.$input.outerWidth((this.$el.width()||0)-1),this.onWidthChanged()},I.prototype.onTextChanged=function(){var e=this.stringify(this.viewModel.get("text"));e!==this.$input.val()&&this.$input.val(e),e!==this.$textarea.val()&&this.$textarea.val(e)},I.prototype.onWidthChanged=function(){var e=this.viewModel.get("fixedWidth"),t=this.viewModel.get("width");t&&e?this.$inputs.width(t):this.$inputs.css("width","")},I.prototype.onVerticalChanged=function(){var e=this.viewModel.get("fixedHeight"),t=this.viewModel.get("height"),i=this.viewModel.get("vertical");e?("Top"===i?this.$alignDiv.css("top",0):"Middle"===i?this.$alignDiv.css("top",(this.$el.height()||0)/2-t/2):this.$alignDiv.css({top:"auto",bottom:0}),this.$alignDiv.css("position","absolute")):this.$alignDiv.css({top:"",bottom:""})},I.prototype.remove=function(){return this.$input.off(),s.View.prototype.remove.apply(this)},I.prototype.initializeEvents=function(){this.listenTo(this.viewModel,"change:fixedHeight",this.onHeightChanged.bind(this)),this.listenTo(this.viewModel,"change:fixedWidth",this.onWidthChanged.bind(this)),this.listenTo(this.viewModel,"change:fontsize",this.onFontSizeChanged.bind(this)),this.listenTo(this.viewModel,"change:height",this.onHeightChanged.bind(this)),this.listenTo(this.viewModel,"change:horizontal",this.onHorizontalChanged.bind(this)),this.listenTo(this.viewModel,"change:text",this.onTextChanged.bind(this)),this.listenTo(this.viewModel,"change:vertical",this.onVerticalChanged.bind(this)),this.listenTo(this.viewModel,"change:width",this.onWidthChanged.bind(this)),this.listenTo(this.viewModel,"change:type",this.onInputTypeChanged.bind(this))},I.prototype.executeActions=function(){this.api.doActions(this.viewModel.get("Actions"),"Actions")},I.prototype.onFocusOut=function(){this.executeActions()},I.prototype.onFontSizeChanged=function(){var e=this.viewModel.get("fontsize");this.$el.css("font-size",e+"px")},I.prototype.onHeightChanged=function(){var e=this.viewModel.get("fixedHeight"),t=this.viewModel.get("height");t&&e?this.$alignDiv.height(t):this.$alignDiv.height("100%"),this.onVerticalChanged()},I.prototype.onHorizontalChanged=function(){var e=this.viewModel.get("horizontal");this.$alignDiv.css("text-align",e)},I.prototype.onInput=function(e){this.api.setProperty("Basics.Text",$(e.target).val())},I.prototype.onKeyUp=function(e){13===e.keyCode&&"Enter"===e.key?(this.onInput(e),this.executeActions()):this.debouncedOnInput(e)},I.prototype.onInputTypeChanged=function(){var e=this.viewModel.get("type"),t="multiline"===e;this.$input.toggle(!t),this.$textarea.toggle(t),t||this.$input.attr("type",e)},I.prototype.stringify=function(e){return _.isObject(e)?_.isFunction(e.toString)&&"[object Object]"!==e.toString()?e.toString():JSON.stringify(e):e},I);function I(e){var t=A.call(this,_.extend(e,{className:"text-box"}))||this;return t.hasInit=!1,t.api=e.options.api,t.$el.html(m.textBox({type:"text"})),t.$alignDiv=t.$el.find(".align-div"),t.$input=t.$alignDiv.find("> input"),t.$textarea=t.$alignDiv.find("> textarea"),t.$inputs=t.$input.add(t.$textarea),t.$inputs.focusout(t.onFocusOut.bind(t)),t.$inputs.keyup(t.onKeyUp.bind(t)),t.$inputs.on("search",t.onInput.bind(t)),t.debouncedOnInput=_.debounce(t.onInput.bind(t),400),t.viewModel=new s.DeepModel,t}var O,oe=/[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/;function E(e){var t=O.call(this,_.extend(e,{className:"web-component"}))||this;return t.url="",t.api=e.options.api,t.render(),t}O=s.View,e(E,O),E.prototype.onResize=function(){var e=this.$title.outerHeight()||0,t=(this.$el.height()||0)-Number(e);this.$("iframe").css({height:t,top:e})},E.prototype.onSettingsChange=function(e){(e["ViewState.Url"]||"").match(oe)?(this.url=e["ViewState.Url"]||"",this.render()):this.api.showQueryStatus({type:"Error",error:"Invalid URL"})},E.prototype.render=function(){var e=this;return this.api.showQueryStatus({type:"Loading"}),this.$el.html(m.webComponent({Url:this.url})),this.$("iframe").on("load",function(){e.api.hideQueryStatus()}),this.$title=this.$(".title"),this.onResize(),this};var L,ne={label:q,datePicker:j,dropdown:K,webComponent:E,linkButton:Q,serverStatus:ee,textBox:ie,radio:J};function z(e){var t=L.call(this,e)||this,i=e.settingsModel.get("Basics").ComponentName,i=ne[i];return t.$view=new i({options:e}),t.$el.append(t.$view.$el),t}return L=s.View,e(z,L),z.prototype.onResize=function(){this.$view&&this.$view.onResize&&this.$view.onResize()},z.prototype.onSettingsChange=function(e){this.$view&&_.isFunction(this.$view.onSettingsChange)&&this.$view.onSettingsChange(e)},z.prototype.remove=function(){return this.$view&&this.$view.remove&&this.$view.remove(),s.View.prototype.remove.apply(this)},z.prototype.setTheme=function(){this.$view&&this.$view.onThemeChange&&this.$view.onThemeChange()},z.getComponentDefinition=F.getComponentDefinition,z});