define(["Handlebars","QuickBase","moment","xlsx","chartjs","backbone","css!./css/app.css"],function(e,c,s,Y,i,a){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),l=(o=a.DeepModel,n(p,o),p.prototype.initialize=function(){this.theme="Dark"},p.prototype.getChartType=function(){return this.chartType},p.prototype.setChartType=function(t){this.chartType=t},p.prototype.updateData=function(r){var e,t;r?(this.chartData={},void 0!==(t=this.get("DataSet.Radar"))&&(t=0===t.toString().indexOf("/")?t.substring(1):"^"+t.replace(/\*/g,"(.*)")+"$",e=new RegExp(t),t=r.getColumnNames().filter(function(t){return t.match(e)}),_.each(t,_.bind(function(a){_.each(this.get("DataSet.Layers"),_.bind(function(t){var e,o=this,i=t.Data;void 0!==i&&(i=0===i.toString().indexOf("/")?i.substring(1):"^"+i.replace(/\*/g,"(.*)")+"$",e=new RegExp(i),i=r.getColumnNames().filter(function(t){return t.match(e)}),this.labelData=r.getData().map(function(t){return t.get(r.getPropertyFromColumn(a))}),_.each(i,function(e){o.chartData[o.getDisplayName(e)]={data:r.getData().map(function(t){return t.get(e)}),color:t.Color||r.api.getProperty("DataSet.Layers.0.Color"),borderColor:t.BorderColor||r.api.getProperty("DataSet.Layers.0.BorderColor"),pointStyle:t.PointStyle,pointRadius:t.PointRadius||r.api.getProperty("DataSet.Layers.0.PointRadius"),colorOpacity:t.ColorOpacity||r.api.getProperty("DataSet.Layers.0.ColorOpacity"),usePallette:t.UseColor}})),this.updateVisuals()},this))},this))),this.updateVisuals()):this.initialize()},p.prototype.updateVisuals=function(){var t=this.computeDataSetProps(),e=this.computeConfigProps();this.dataset=_.map(t,function(t){return _.extend({},e,t)})},p.prototype.computeAngleLines=function(){var t=this.get("DataSet.RadarColorAngle"),e=this.get("DataSet.AngleLineOpacity");this.formattingProps.scale.angleLines={color:D.alpha(void 0===t?"#ffffff":t,void 0===e?50:e)}},p.prototype.computeConfigProps=function(){var s=this,t="Light"===this.theme?(p="#FFFFFF","#000000"):(p="#000000","#FFFFFF"),e=void 0===this.get("ticks.display")||this.get("ticks.display"),t=void 0===this.get("ticks.fontColor")?t:this.get("ticks.fontColor"),o=void 0===this.get("ticks.fontSize")?12:this.get("ticks.fontSize"),i=void 0!==this.get("ticks.showLabelBackdrop")&&this.get("ticks.showLabelBackdrop"),a=void 0===this.get("ticks.backdropPaddingX")?2:this.get("ticks.backdropPaddingX"),r=void 0===this.get("ticks.backdropPaddingY")?2:this.get("ticks.backdropPaddingY"),n=void 0!==this.get("ticks.beginAtZero")&&this.get("ticks.beginAtZero"),l=void 0===this.get("ticks.maxTicksLimit")?11:this.get("ticks.maxTicksLimit"),p=void 0===this.get("ticks.backdropColor")?p:this.get("ticks.backdropColor");return this.formattingProps||(this.formattingProps={legend:this.computeLegendProps(),scale:{ticks:{display:e,fontColor:t,fontSize:o,showLabelBackdrop:i,backdropColor:p,backdropPaddingX:a,backdropPaddingY:r,beginAtZero:n,maxTicksLimit:l,callback:function(t){var e=void 0===s.get("ticks.Format")?"General":s.get("ticks.Format"),o=void 0===s.get("ticks.Precision")?0:s.get("ticks.Precision"),i=void 0!==s.get("ticks.HideTrailingZeroes")&&s.get("ticks.HideTrailingZeroes"),a=void 0===s.get("ticks.DateFormat")?"YYYY-MM-DD":s.get("ticks.DateFormat"),r=void 0===s.get("ticks.Prefix")?"":s.get("ticks.Prefix"),n=void 0===s.get("ticks.Suffix")?"":s.get("ticks.Suffix"),e=D.getFormatter(e,o,i,a,a);return r+(t=void 0===(t=isNaN(t)?t:e(t))?"":t)+n}},pointLabels:{fontSize:o}}}),this.computeGridLines(),this.computeAngleLines(),this.formattingProps},p.prototype.computeGridLines=function(){var t=this.get("DataSet.RadarColor"),e=this.get("DataSet.GridLineOpacity");this.formattingProps.scale.gridLines={color:D.alpha(void 0===t?"#ffffff":t,void 0===e?50:e)}},p.prototype.setAngleLine=function(t,e,o){this.formattingProps&&this.formattingProps.scale&&this.formattingProps.scale.angleLines.color&&this.formattingProps.scale.angleLines.color[o]&&(this.formattingProps.scale.angleLines.color[o][t]=e)},p.prototype.setFormattingProps=function(t,e,o){this.formattingProps&&this.formattingProps.scale&&("pointLabels"===t?this.formattingProps.scale[t].fontSize=e:this.formattingProps.scale[o][t]=e,this.set(o+"."+t,e))},p.prototype.setGridLine=function(t,e,o){this.formattingProps&&this.formattingProps.scale&&this.formattingProps.scale.gridLines.color&&this.formattingProps.scale.gridLines.color[o]&&(this.formattingProps.scale.gridLines.color[o][t]=e)},p.prototype.setLegendProps=function(t,e){"Show"===t?this.formattingProps.legend.display=e:"LabelColor"===t?this.formattingProps.legend.labels.fontColor=e:"Position"===t&&(this.formattingProps.legend.position=e)},p.prototype.calcRange=function(t,e,o){return e+(Math.abs(e)+Math.abs(o))*(t/100)},p.prototype.computeDataSetProps=function(){var l=this;return _.map(this.chartData,function(t,e){var o=t.usePallette,i=t.color,a=t.colorOpacity,r=t.data,n=t.borderColor,s=t.pointStyle,t=t.pointRadius,a=l.getBackgroundColor(o,i,a);return{label:e,data:r,backgroundColor:_.isArray(a)?_.first(a):a,pointBackgroundColor:l.getBackgroundColor(o,i,90),pointBorderColor:l.getBackgroundColor(o,i,90),borderColor:n||l.getBackgroundColor(o,i,90),pointStyle:s,pointBorderWidth:t}})},p.prototype.computeLegendProps=function(){var t="Light"===this.theme?"#000000":"#FFFFFF",e=void 0===this.get("Legend.Show")||this.get("Legend.Show"),t=void 0===this.get("Legend.LabelColor")?t:this.get("Legend.LabelColor");return{display:!0,position:void 0===this.get("Legend.Position")?"top":this.get("Legend.Position"),labels:{usePointStyle:e,fontColor:t}}},p.prototype.getBackgroundColor=function(t,e,o){return t?this.getColorScheme(o):D.alpha(e,o)},p.prototype.getColorScheme=function(e){var o=[];if(_.each(_.map(this.get("ColorPallette.chartBarColors"),"type"),function(t){o.push(D.alpha(t,e))}),o.length<this.labelData.length){var t=_.extend([],o);if(0<t.length)for(var i=0;i<=this.labelData.length/t.length+1;i++)o=_.concat(o,t)}return o},p.prototype.getDisplayName=function(t){var e=t;return e=(t=_.fromPairs(_.map(this.get("DataSet.Layers"),function(t){return[t.Data,t.Display]}))[t])?t:e},p.prototype.getRandomColour=function(t){if(!this.colorCache[t]){for(var e="#",o=0;o<6;o++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];this.colorCache[t]=e}return this.colorCache[t]},p);function p(){var t=null!==o&&o.apply(this,arguments)||this;return t.colorCache={},t.columns=[],t.labels=[],t.chartData={},t.labelData=[],t.chartType="radar",t}d=a.Collection,n(u,d),u.prototype.modelId=function(t){return t};var d,j=u;function u(){var t=null!==d&&d.apply(this,arguments)||this;return t.model=l,t}h=a.DeepModel,n(g,h),g.prototype.initialize=function(){},g.prototype.toRadarON=function(){return _.chain(this.toJSON()).toPairs().reduce(function(t,e){return t[e[0].toLowerCase()]=e[1],t},{}).value()},g.Enabled=!1;var h,V=g;function g(){var t=null!==h&&h.apply(this,arguments)||this;return t.cache={},t}f.sourceKey=function(t){return t.getPath()},f.mergeChanges=function(e,o,t,i,a,r){return t&&(e=_.fromPairs(_.map(t,function(t){return[o(t),t]}))),i&&_.each(i,function(t){return _.extend(e[o(t)],t)}),a&&_.each(a,function(t){e[o(t)]=t}),r&&_.each(r,function(t){delete e[o(t)]}),e},f.prototype.setFocus=function(t){this.focus=t,this.updateChildren(),this.childDataSource&&this.childDataSource.setFocus(t)},f.prototype.isFocused=function(){return this.focus.length===this.depth&&(0===this.depth||this.source.id===this.focus[this.depth])},f.prototype.getColumnNames=function(){if(this.breakdownColumns&&this.breakdownColumns.length)return[f.BREAKDOWN_ID,this.breakdownColumns[0]].concat(_.difference(_.keys(this.meta),this.breakdownColumns));try{return _.map(this.meta,function(t){return[t.id,t.index]}).sort(function(t,e){return t[1]-e[1]}).map(function(t){return t[0]})}catch(t){return _.keys(this.meta)}},f.prototype.getColumnType=function(t){return this.childDataSource?this.childDataSource.getColumnType(t):t===f.BREAKDOWN_ID?this.meta[this.primaryKey].kdbType:this.meta[t]?this.meta[t].kdbType:11},f.prototype.getData=function(){return this.childDataSource?this.childDataSource.getData():this.source.dataSet&&this.source.dataSet.collection},f.prototype.getDepth=function(){return this.childDataSource?this.childDataSource.getDepth():this.depth},f.prototype.getKey=function(){return this.source.cid},f.prototype.getPrimaryKey=function(){return this.childDataSource?this.childDataSource.getPrimaryKey():this.primaryKey},f.prototype.getPropertyFromColumn=function(t){return t===f.BREAKDOWN_ID?this.getPrimaryKey():t},f.prototype.getPath=function(){return this.source.path},f.prototype.getSource=function(){return this.source},f.prototype.hasData=function(){return this.childDataSource?this.childDataSource.hasData():this.hasDataFlag},f.prototype.onData=function(t,e,o){t.primaryKey!==this.primaryKey&&(this.primaryKey=t.primaryKey),this.meta=f.mergeChanges(this.meta,function(t){return t.id},t.columns.reset,t.columns.change,t.columns.add,t.columns.remove),0!==this.depth||_.isEqual(t.breakdownColumns,this.breakdownColumns)||(this.breakdownColumns=t.breakdownColumns,this.removeChild()),e.reset&&0<e.reset.length&&this.removeChild(),o&&this.updateError(this,o),this.hasDataFlag=!0,this.updateChildren()&&this.listener.updateDataSource(this)},f.prototype.subscribe=function(){this.api.subscribe(this.source,this.onData.bind(this))},f.prototype.updateDataSource=function(){this.listener.updateDataSource(this)},f.prototype.updateError=function(t,e){this.listener.updateError(this,e)},f.prototype.unsubscribe=function(){this.childDataSource&&(this.childDataSource.unsubscribe(),delete this.childDataSource),this.api.unsubscribe(this.source)},f.prototype.removeChild=function(){this.childDataSource&&(this.childDataSource.unsubscribe(),delete this.childDataSource)},f.prototype.updateChildren=function(){var t;return!(this.breakdownColumns&&this.breakdownColumns.length&&this.depth<this.breakdownColumns.length-1)||(this.focus.length>this.depth?(this.childDataSource&&this.focus[this.depth]!==this.childDataSource.getSource().id&&this.removeChild(),this.childDataSource||(0!==this.depth&&(this.focus[this.depth-1],this.source.id),(t=this.source.dataSet&&this.source.dataSet.collection.get(this.focus[this.depth]))&&(this.childDataSource=new f(t,this,this.api,this.focus,this.depth+1,this.breakdownColumns),this.childDataSource.subscribe()))):(this.removeChild(),this.focus.length!==this.depth||!this.hasDataFlag||0!==this.depth&&this.focus[this.depth-1]!==this.source.id||this.listener.updateDataSource(this)),!1)},f.BREAKDOWN_ID="{breakdownId}";var H=f;function f(t,e,o,i,a,r){this.breakdownColumns=[],this.hasDataFlag=!1,this.focus=[],this.meta={},this.source=t,this.listener=e,this.api=o,this.depth=a||0,this.breakdownColumns=r,this.setFocus(i)}m=a.DeepModel,n(y,m),y.prototype.initialize=function(){},y.prototype.toRadarON=function(){return _.chain(this.toJSON()).toPairs().reduce(function(t,e){return t[e[0].toLowerCase()]=e[1],t},{}).value()},y.prototype.customTooltip=function(t,e,o){var i=e.get("Tooltip"),a={};this.tooltip&&(N.componentApi.removeTooltip(),delete this.tooltip),(a=e?this.getHandleBarParams(o,e,t):a)&&_.get(a,"dataSet")&&!_.isEmpty(_.get(a,"dataSet"))&&(this.tooltip=N.componentApi.setTooltip({data:a,text:i.advancedTooltip,anchorEl:o.context,position:{left:t.caretX||t._eventPosition.x,top:t.caretY||t._eventPosition.y}}))},y.prototype.getHandleBarParams=function(r,n,s){var t=n.get("Basics.Data").viewState,l={dataSet:[],title:s.title},p=0,t=(_.each(s.dataPoints,function(t,e){var t=n.labelData[t.index],o=n.dataset[e].label,i=s.dataPoints[e].yLabel,a=r.get("Tooltip.isStacked");l.dataSet.push({legend:t,color:s.labelColors[e].backgroundColor,layerKey:o,layerValue:a?i-p:i}),p=i}),_.filter(t.attributes,function(t){return t&&t.path}));return _.each(t,function(t){l[t.path]=t.get("value")}),_.extend(l,{})},y.prototype.unsubscribeTemplateViewStates=function(){this.subscriptionKey&&(N.componentApi.unsubscribeTemplateViewStates(this.subscriptionKey),this.subscriptionKey="")},y.Enabled=!1;var m,I=y;function y(){var t=null!==m&&m.apply(this,arguments)||this;return t.cache={},t.subscriptionKey="",t}b=a.DeepModel,n(S,b),S.extractScales=function(t){return{position:t.get("Position"),id:t.get("_Hidden._Label"),type:t.get("_Hidden._Type"),display:t.get("Display"),stacked:t.get("Stacked"),barPercentage:t.get("Bars.BarPercentage")/100,categoryPercentage:t.get("Bars.CategoryPercentage")/100,scaleLabel:{display:t.get("Title.Display"),labelString:t.get("Title.LabelString"),fontColor:D.alpha(t.get("Title.FontColor"),t.get("Title.FontOpacity")),fontFamily:t.get("Title.FontFamily"),fontSize:t.get("Title.FontSize"),fontStyle:t.get("Title.FontStyle")},gridLines:{offsetGridLines:t.get("GridLines.OffsetGridLines"),color:D.alpha(t.get("GridLines.GridLinesColor"),t.get("GridLines.GridLinesOpacity"))},ticks:{max:t.get("Range.Max"),min:t.get("Range.Min"),suggestedMax:t.get("Range.SuggestedMax"),suggestedMin:t.get("Range.SuggestedMin"),display:t.get("Labels.Display"),fontColor:D.alpha(t.get("Labels.FontColor"),t.get("Labels.FontOpacity")),fontFamily:t.get("Labels.FontFamily"),fontSize:t.get("Labels.FontSize"),fontStyle:t.get("Labels.FontStyle"),reverse:t.get("Labels.Reverse")}}},S.singular=function(t){return t.replace("e","i")},S.camelCase=function(t){return t.replace("X","x").replace("Y","y")},S.prototype.initialize=function(){this.listenTo(this,"change:Range.UseMinMax",function(t,e){e?t.trigger("cache",{model:t,load:["Range.SoftRange"],defaults:[!1]}):t.trigger("cache",{model:t,store:["Range.SoftRange"]})}),this.listenTo(this,"change:_Hidden._Type",function(t){t.get("Range.UseMinMax")||t.trigger("cache",{model:t,store:["Range.SuggestedMax","Range.SuggestedMin"]})}),this.listenTo(this,"change:Range.SoftRange",function(t,e){t.get("Range.UseMinMax")?e?(t.trigger("cache",{model:t,load:["Range.SuggestedMax","Range.SuggestedMin"],defaults:[0,0]}),t.trigger("cache",{model:t,store:["Range.Max","Range.Min"]})):(t.trigger("cache",{model:t,load:["Range.Max","Range.Min"],defaults:[0,0]}),t.trigger("cache",{model:t,store:["Range.SuggestedMax","Range.SuggestedMin"]})):(t.trigger("cache",{model:t,store:["Range.Max","Range.Min"]}),t.trigger("cache",{model:t,store:["Range.SuggestedMax","Range.SuggestedMin"]}))}),this.listenTo(this,"change:Title.Display",function(t){t.get("Title.Display")?t.trigger("cache",{model:t,load:["Title.LabelString","Title.FontColor","Title.FontOpacity","Title.FontFamily","Title.FontSize","Title.FontStyle"],defaults:["","#FFFFFF",100,"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",12,"normal"]}):t.trigger("cache",{model:t,store:["Title.LabelString","Title.FontColor","Title.FontOpacity","Title.FontFamily","Title.FontSize","Title.FontStyle"]})}),this.listenTo(this,"change:Labels.Display",function(t){t.get("Labels.Display")?t.trigger("cache",{model:t,load:["Labels.FontColor","Labels.FontOpacity","Labels.FontFamily","Labels.FontSize","Labels.FontStyle","Labels.Reverse"],defaults:["#FFFFFF",100,"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",12,"normal",!t.isNumerical()&&void 0]}):t.trigger("cache",{model:t,store:["Labels.FontColor","Labels.FontOpacity","Labels.FontFamily","Labels.FontSize","Labels.FontStyle","Labels.Reverse"]})}),this.listenTo(this,"change:Labels.Reverse",function(t,e){_.isUndefined(e)||_.isNull(e)||t.set("Labels._ReverseCache",e)})},S.prototype.isNumerical=function(){return _.includes(["linear","logarithmic"],this.get("_Hidden._Type"))};var b,C=S;function S(){var t=null!==b&&b.apply(this,arguments)||this;return t.cache={},t}var v;v=a.Collection,n(x,v),x.prototype.modelId=function(t){return t._Hidden._AxisId+t._Hidden._Type};function x(){var t=null!==v&&v.apply(this,arguments)||this;return t.model=C,t}F.cache=function(l,p,c,d){var t;_.isArray(c.load)&&(t=c.load.reduce(function(t,e,o){if(!l.cache)return t;var i,a,r,n,s=l.cache[e];return s&&_.isFunction(s.get)&&s.get("_viewType")&&(s=(i=s).get("value"),a=(r=(p+e).split(".")).pop(),r=r.join("."),n={},a&&(n[a]=i,d.setProperty(r,n,{bypass:!0}))),t[e]=s||c.defaults&&c.defaults[o],t},{}),l.set(t)),_.isArray(c.store)&&(t=c.store.reduce(function(t,e){var o=(p+e).split("."),i=o.pop();return i&&(t[e]=d.getProperty(o.join("."))[i]),t},{}),_.extend(l.cache,t),t=c.store.reduce(function(t,e){return t[e]=void 0,t},{}),l.set(t))},F.expandNestedViewStates=function(t,e){var o=!1,i=Object.keys(t);if(o=1===i.length?(a=e.getPropertyMeta(i[0]))&&"viewstate"===a.type:o){var a=/^((?:\w+\.)*)(\d+)/.exec(i[0]);if(a)return o=a[1].slice(0,-1),i=e.getProperty(o),(a={})[o]=i,a}return t},F.focus2Array=function(t){var e=[],o=/"([^"]*)"/g,t=t.toString?t.toString():"",i=/^\[([^\]]*)]$/.exec(t);if(null!==i){if(/^(?:"[^"\\]*(?:\\[\S\s][^"\\]*)*")(?:,"[^"\\]*(?:\\[\S\s][^"\\]*)*")*/.test(i[1]))for(var a=void 0;null!==(a=o.exec(i[1]));)e.push(_.map(a[1].split(","),function(t){return t.replace(/&#44;/g,",")}))}else e.push(t.split(","));return _.filter(e,function(t){return 0<(""+t).length})},F.getFormatter=function(a,o,i,r,n){return"Number"===a||"Formatted Number"===a||"Smart Number"===a||"Currency"===a||"SmartCurrency"===a?function(t){var e=t;if(null==t)return"";if(e="Smart Number"===a?_.isNumber(t)?M.smartFormatNumber(t,o):_.escape(t):"Formatted Number"===a&&t.toFixed?_.isNaN(t)?"":M.formatNumber(t,o):t.toFixed?t.toFixed(o):_.escape(e),i&&0<=e.toString().indexOf(".")){for(;"0"===e[e.length-1];)e=e.slice(0,-1);"."===e[e.length-1]&&(e=e.slice(0,-1))}return e}:"Date"===a||"Time"===a||"Datetime"===a?function(t){var e="Time"===a,o="Datetime"===a,i=M.convertKDBTemporalToMoment(t),t=_.isNull(t)||_.isUndefined(t)||_.isFunction(i.isValid)&&!i.isValid()?_.escape(t):e?i.formatNano(n,{trim:!1,trimNano:!1}):o?i.formatNano(r+" "+n,{trim:!1,trimNano:!1}):i.formatNano(r);return t}:"General"===a||"Boolean"===a?function(t){return _.escape(t)}:function(t){return s.isMoment(t)||s.isDuration(t)?t.format(a,void 0):_.escape(t)}},F.pump=function(o){if(null==o)return o;if(!_.isObject(o))return o;var t=Object.getPrototypeOf(o);if(_.isObject(o)&&t!==Object.prototype&&t!==Array.prototype)return o;if(t===Array.prototype&&_.isArray(o))return o.map(F.pump);var i=/^(\d+)((?:\.\w+)+)$/;if(Object.keys(o).every(function(t){return i.test(t)}))return Object.keys(o).map(function(t){var e=i.exec(t);return _.isNil(e)?{index:0,tail:void 0,value:void 0}:{index:Number(e[1]),tail:e[2].substring(1),value:o[t]}}).reduce(function(t,e){var o={};return o[e.index]={},o[e.index][e.tail]=e.value,$.extend(!0,t,F.pump(o))},[]);var a={greedy:/^(\w+)((?:\.\w+)*)$/,nonGreedy:/^(\w+)((?:\.\w+)+)$/};return Object.keys(o).some(function(t){return a.nonGreedy.test(t)})?Object.keys(o).map(function(t){var e=a.greedy.exec(t);return _.isNil(e)?{index:0,tail:void 0,value:void 0}:{head:e[1],tail:""!==e[2]?e[2].substring(1):null,value:o[t]}}).reduce(function(t,e){var o={},i=null!==e.tail,a=_.isNil(e.head)?0:e.head,r=_.isNil(e.tail)?0:e.tail;return i?(o[a]={},o[a][r]=e.value):o[a]=e.value,$.extend(!0,t,F.pump(o))},{}):_.mapValues(o,F.pump)},F.replaceViewStatesWithValue=function(t,e,o){return F.replaceViewStates(t,e,function(t,e,o,i){return i.value!==o&&console.warn("viewModel value has changed"),i.value},o)},F.replaceViewStatesWithModel=function(t,e,i){return F.replaceViewStates(t,e,function(t,e,o){if(o instanceof a.Model&&o.get("_viewType"))return o;t=i.getProperty(t)[e];return _.isUndefined(o)?void 0:(t.get("value")!==o&&(console.warn("viewModel value has changed"),t.set("value",o)),t)},i)},F.safeHandle=function(o){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{o.apply(this,t)}catch(t){console.error("oupsies..",t)}}},F.alpha=function(t,e){return new Color(t).alpha(e/100).rgbaString()},F.colorFactory=function(t,e,o){void 0===o&&(o=80);var i={};return i[t+"Color"]={type:"gradient",default:e=void 0===e?"#ff0000":e,options:{gradient:!1}},i[t+"Opacity"]={default:o,minimum:0,maximum:100,type:"number",step:1,format:"range"},i},F.backgroundFactory=function(t){return F.colorFactory(t+"Background")},F.borderFactory=function(t){var e={};return e[t+"BorderWidth"]={type:"number",format:"range",default:3.01,minimum:.01,maximum:10.01},$.extend(!0,{},F.colorFactory(t+"Border"),e)},F.radiusFactory=function(t){var e={};return e[t+"Radius"]={type:"number",format:"range",minimum:0,maximum:10},e},F.typeFactory=function(t){return{_Type:{type:"string",default:t,options:{hidden:!0}}}},F.replaceViewStates=function(o,t,l,p){var c;return c=function(t,e){return function o(t,e,i){i=i?i+".":"";var a,r,n=p.getPropertyMeta(i+(e+="")),s=t&&t.has&&t.has("_dataSource")&&t.has("_dataType"),s=(_.isArray(t)||_.isObject(t))&&!s;return n&&"data"===n.type?t:n&&"viewstate"===n.type?(a=(r=(i+e).split(".")).pop(),r=r.join("."),l(r,void 0===a?"":a,t,n)):s?(i+=e,c=function(t,e){return o(t,e,i)},(_.isArray(t)?_.map:_.mapValues)(t,c)):t}(t,e,o||"")},(_.isArray(t)?_.map:_.mapValues)(t,c)};var D=F;function F(){}k.factory=function(t,e){return{type:"array",propertyOrder:e,items:{type:"object",id:"arrItem",title:t,headerTemplate:C.singular(t)+" {{ i1 }}",oneOf:["category","linear","logarithmic","time"].map(k.axisTypeFactory)}}},k.axisPropertiesFactory=function(t){var e={_Hidden:{type:"object",options:{hidden:!0},properties:{_Index:{type:"number",options:{hidden:!0}},_Label:{type:"string",options:{hidden:!0}},_AxisId:{type:"string",options:{hidden:!0}},_Type:{type:"string",default:t,options:{hidden:!0}}}},Position:{type:"string",enum:["bottom","left","top","right"],default:"XAxis"===t?"bottom":"left"},Display:{type:"boolean",title:"Display",default:!0,propertyOrder:20,format:"checkbox"},Stacked:{type:"boolean",title:"Stacked",default:!1,propertyOrder:30,format:"checkbox"},Bars:{type:"object",options:{collapsed:!0},properties:{BarPercentage:{minimum:0,maximum:100,type:"number",format:"range"},CategoryPercentage:{minimum:0,maximum:100,type:"number",format:"range"}}},GridLines:{type:"object",options:{collapsed:!0},properties:{OffsetGridLines:{type:"boolean",format:"checkbox",default:!0}}},Title:{type:"object",options:{collapsed:!0},properties:$.extend(!0,{Display:{type:"boolean",format:"checkbox",default:!1},LabelString:{type:"string",default:null},FontFamily:{type:"string",default:null},FontSize:{type:"number",format:"number",default:null},FontStyle:{type:"string",enum:["normal","italic","oblique","initial","inherit"],default:null}},D.colorFactory("Font",void 0,void 0))},Labels:{type:"object",options:{collapsed:!0},properties:$.extend(!0,{Display:{type:"boolean",format:"checkbox",default:!0},Format:{type:"string",enum:["General","Number","Formatted Number","Smart Number","Date","Time","DateTime","Percentage","Boolean"],default:"General"},Precision:{type:"number",title:"Precision",format:"number",minimum:0,maximum:10,default:2},HideTrailingZeroes:{type:"boolean",title:"Hide Trailing Zeroes",format:"checkbox",default:!1},DateFormat:{title:"Date Format",type:"string",enum:M.Formats.Date,default:"YYYY-MM-DD"},TimeFormat:{title:"Time Format",type:"string",enum:M.Formats.Time,default:"HH:mm:ss"},FontFamily:{type:"string",default:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif"},FontSize:{type:"number",format:"number",default:12},FontStyle:{type:"string",enum:["normal","italic","oblique","initial","inherit"],default:"normal"},_ReverseCache:{type:"boolean",default:!1,options:{hidden:!0}}},D.colorFactory("Font","#FFFFFF",100),_.includes(["linear","logarithmic"],t)?{Reverse:{type:"boolean",format:"checkbox",default:!1}}:{})}};switch($.extend(!0,e.GridLines.properties,D.colorFactory("GridLines","#000",10)),t){case"linear":case"logarithmic":e.Range={type:"object",options:{collapsed:!0},properties:{UseMinMax:{type:"boolean",title:"Use Min/Max",format:"checkbox",default:!1},SoftRange:{type:"boolean",title:"Use Soft Range",format:"checkbox",default:void 0},SuggestedMax:{type:"number",format:"number",default:void 0},SuggestedMin:{type:"number",format:"number",default:void 0},Max:{type:"number",format:"number",default:void 0},Min:{type:"number",format:"number",default:void 0}}}}return e},k.axisTypeFactory=function(t){return{title:t,options:{linked_oneof_property:{property:"_Hidden._Type",value:t}},properties:k.axisPropertiesFactory(t)}};function k(){}$.extend(!0,{},{Data:{type:"data",title:"Data Source"},Name:{type:"string"},LegendLabelColor:{title:"Legend Color",type:"gradient",options:{gradient:!1,noColor:!1},default:"#ffffff"}},D.backgroundFactory(""),D.borderFactory(""));P.getComponentDefinition=function(t){var e,o,i={id:1,componentName:"Radar",componentDescription:"",version:"4.6.1",appArgs:{quickStart:[{path:"Basics.Data",message:"populate Data Source"}],json:{version:"4.6.1",Basics:{ChartType:"radar",Data:"",Focus:"",Selected:"",SelectedAttr:"",SelectedObjectRouting:[]},DataSet:{Radar:"",RadarColor:"#ffffff",RadarColorAngle:"#ffffff",GridLineOpacity:35,AngleLineOpacity:35,Layers:[{Data:"",Color:"#0061FF",BorderColor:"#ffffff",UseColor:!1,ColorOpacity:35,Display:"",PointStyle:"",PointRadius:2}]},Legend:{Show:!0,LabelColor:"#ffffff",Position:"top"},Padding:{Top:2,Bottom:2,Left:2,Right:2},Animations:{Enabled:!1},ticks:{display:!0,fontColor:"rgba(0, 0, 0, 0.75)",fontSize:12,showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPaddingX:2,backdropPaddingY:2,beginAtZero:!1,maxTicksLimit:11,Format:"General",Precision:0,HideTrailingZeroes:!1,DateFormat:"YYYY-MM-DD",Prefix:"",Suffix:""},Tooltip:{handlebarhelper:[],isStacked:!1,advancedTooltip:'<div>{{#each dataSet}}<table><tbody>{{#eq @index 0}} <tr><td colspan="3">{{legend}}</td> </tr> {{/eq}} <tr> <td><svg style="width:15px;height:15px"> <circle fill="{{color}}" width="2" stroke="white" r="6" cy="8" cx="8"></circle> </svg></td> <td> {{layerKey}}</td>  <td>{{layerValue}}</td>  </tr></tbody>  </table>  {{/each}}</div>'},ColorPallette:{chartBarColors:[{type:"#0061FF"},{type:"#F23A66"},{type:"#009BAB"},{type:"#7647CC"},{type:"#FFC300"},{type:"#9FA3A6"},{type:"#003A99"},{type:"#A90B31"},{type:"#005D67"},{type:"#452481"}],scheme:"default"},FileExport:{ShowScreenshot:!1,ShowExportCsvButton:!1,ShowExportExcelButton:!1,FileName:[]},possibleColumns:[""],possibleLabels:[""]},schema:{type:"object",title:"Properties",properties:{possibleLabels:{type:"array",propertyOrder:1,format:"table",items:{type:"string"},default:["sym"],options:{collapsed:!0,hidden:!0}},possibleColumns:{propertyOrder:2,type:"array",format:"table",items:{type:"string"},default:["sym"],options:{collapsed:!0,hidden:!0}},possibleRules:{type:"array",propertyOrder:1,format:"table",items:{type:"string"},default:[],options:{collapsed:!0,hidden:!0}},isPolar:{type:"string"},Basics:{type:"object",propertyOrder:3,title:"Basics",options:{collapsed:!1},properties:{ChartType:{type:"string",title:"Chart Type",default:"radar",enum:["radar","polarArea"]},Data:{type:"data",format:"string",title:"Data Source",default:""},Focus:{type:"viewstate",title:"Focus",default:""},Selected:{type:"viewstate",title:"Selected Value",default:""},SelectedAttr:{type:"string",title:"Selected Value Attribute",enumSource:"possible_labels",watch:{possible_labels:"root.possibleLabels"}},FixedColumn:{type:"string",title:"Column Def"},SelectedObjectRouting:{propertyOrder:1120,type:"array",format:"table",title:"Selected Row ViewState Routing",options:{hidden:!1,collapsed:!0},items:{type:"object",title:"Routing",properties:{ColumnProperty:{title:"Column",type:"string",enumSource:"poss_sel_cols",watch:{poss_sel_cols:"root.possibleColumns"}},ViewstateProperty:{title:"Viewstate",type:"viewstate"}}}}}},DataSet:{type:"object",propertyOrder:4,title:"Data",options:{collapsed:!0},properties:{Radar:{type:"customDropdown",default:"",propertyOrder:1,title:"Radar Columns",data:"possible_labels",watch:{possible_labels:"root.possibleLabels"}},RadarColor:{type:"gradient",options:{gradient:!1},default:"#ffffff",propertyOrder:2,title:"GridLine Colour"},RadarColorAngle:{type:"gradient",options:{gradient:!1},default:"#ffffff",propertyOrder:3,title:"AngleLine Colour"},GridLineOpacity:{title:"GridLine Opacity",propertyOrder:4,default:35,minimum:1,maximum:100,type:"number",step:1,format:"range"},AngleLineOpacity:{title:"AngleLine Opacity",default:35,propertyOrder:5,minimum:1,maximum:100,type:"number",step:1,format:"range",watch:{isPolarVal:"root.isPolar"},option:{hidden:"isPolarVal"}},Layers:{type:"array",propertyOrder:6,format:"object",title:"Layers",uniqueItems:!1,options:{collapsed:!0,reset:!0},items:{type:"object",title:"Layer",properties:{Data:{title:"Data",type:"customDropdown",data:"possible_columns",default:"",watch:{possible_columns:"root.possibleColumns"}},Color:{type:"gradient",options:{gradient:!1},title:"Color",default:"#0061FF"},BorderColor:{type:"gradient",options:{gradient:!1,noColor:!0},title:"Border Color",default:"#ffffff"},UseColor:{type:"boolean",title:"Use Colour Palette",default:!1,format:"checkbox"},ColorOpacity:{title:"Radar Color Opacity",default:35,minimum:1,maximum:100,type:"number",step:1,format:"range"},Display:{type:"string",title:"Display Name",data:"possibleColumns",default:""},PointStyle:{type:"string",title:"Point Style",data:"circle",default:"",enum:["circle","cross","crossRot","dash","line","rect","rectRounded","rectRot","star","triangle"]},PointRadius:{title:"Point Radius",default:2,minimum:1,maximum:10,type:"number",step:1,format:"range"}}}}}},Legend:{type:"object",title:"Legend",propertyOrder:5,options:{collapsed:!0},properties:{Show:{type:"boolean",title:"Show",default:!0,format:"checkbox"},LabelColor:{type:"gradient",options:{noColor:!0},default:"#ffffff"},Position:{type:"string",enum:["top","bottom","left","right"],default:"top"}}},Padding:{type:"object",title:"Chart Padding",propertyOrder:5,options:{collapsed:!0},properties:{Left:{type:"number",default:2},Right:{type:"number",default:2},Top:{type:"number",default:2},Bottom:{type:"number",default:2}}},ticks:{type:"object",title:"Ticks",propertyOrder:6,options:{collapsed:!0},properties:{display:{type:"boolean",title:"Label Display",default:!0,format:"checkbox",propertyOrder:1},fontColor:{title:"Label Font Color",type:"gradient",options:{noColor:!0},default:"#000000",propertyOrder:2},fontSize:{type:"number",title:"Label Font Size",default:12,propertyOrder:3},showLabelBackdrop:{type:"boolean",title:"Show Label Backdrop",default:!1,format:"checkbox",propertyOrder:4},backdropColor:{title:"Label Backdrop Color",type:"gradient",options:{noColor:!0},default:"#ffffff",propertyOrder:5},backdropPaddingX:{type:"number",title:"Label Backdrop Padding X",default:2,propertyOrder:6},backdropPaddingY:{type:"number",title:"Label Backdrop Padding Y",default:2,propertyOrder:7},maxTicksLimit:{type:"number",title:"Label Max Ticks Limit",default:11,propertyOrder:8},beginAtZero:{type:"boolean",title:"Label Begin At Zero",default:!1,format:"checkbox",propertyOrder:9},Format:{title:"Label Format",type:"string",enum:["General","Number","Smart Number","Formatted Number","Datetime"],default:"General",propertyOrder:10},Precision:{type:"number",title:"Label Decimal Places",format:"number",minimum:0,maximum:10,default:2,propertyOrder:11},HideTrailingZeroes:{type:"boolean",title:"Label Hide Trailing Zeroes",format:"checkbox",default:!1,propertyOrder:12},DateFormat:{type:"string",propertyOrder:13,title:"Label Date/Time format",enum:["YYYY-MM-DD","YYYY-MMM-DD","YYYY-MMMM-DD","YYYY-MM","YYYY-MMM","YYYY-MMMM","MMM DD","MMM Do","YYYY-MM-DD HH:mm:ss","YYYY-MM-DD hh:mm:ss","YYYY-MM-DD kk:mm:ss","hh:mm:ss","kk:mm:ss","hh:mm:ss.SS","hh:mm","kk:mm","mm:ss","mm:ss.SS"],default:"YYYY-MM-DD"},Prefix:{title:"Label Prefix",type:"string",propertyOrder:14,default:""},Suffix:{title:"Label Suffix",type:"string",propertyOrder:15,default:""},pointLabels:{type:"number",title:"Radar Labels Size",default:16}}},FileExport:{type:"object",propertyOrder:320,title:"File Export",options:{collapsed:!0},properties:{ShowExportCsvButton:{type:"boolean",title:"Show Export Csv Button",default:!1,format:"checkbox"},ShowExportExcelButton:{type:"boolean",title:"Show Export Excel Button",default:!1,format:"checkbox"},ShowScreenshot:{type:"boolean",title:"Show Screenshot Button",default:!1,format:"checkbox"},FileName:{type:"array",format:"table",title:"FileName",options:{hidden:!1,collapsed:!0},items:{type:"object",title:"Filename Part",options:{collapsed:!0},properties:{FileNamePart:{title:"FileName Part",type:"string"}}}}}},Animations:{type:"object",propertyOrder:300,options:{collapsed:!0},properties:{Enabled:{type:"boolean",format:"checkbox",default:!1},Easing:{type:"string",enum:["linear","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","easeOutSine","easeInOutSine","easeInExpo","easeOutExpo","easeInOutExpo","easeInCirc","easeOutCirc","easeInOutCirc","easeInElastic","easeOutElastic","easeInOutElastic","easeInBack","easeOutBack","easeInOutBack","easeInBounce","easeOutBounce","easeInOutBounce"],default:""},Duration:{type:"number",format:"number",default:0}}},Tooltip:{type:"object",propertyOrder:6,title:"Tooltip",options:{collapsed:!0},properties:{advancedTooltip:{type:"tooltipTemplate",title:"Custom tooltip",propertyOrder:1,data:["xaxis","yaxis","key","color"],templateItems:{dataSet:{type:"array",items:_.keyBy(["color","layerKey","layerValue","legend"])}},default:'<div>{{#each dataSet}}<table><tbody>{{#eq @index 0}} <tr><td colspan="3">{{legend}}</td> </tr> {{/eq}} <tr> <td><svg style="width:15px;height:15px"> <circle fill="{{color}}" width="2" stroke="white" r="6" cy="8" cx="8"></circle> </svg></td> <td> {{layerKey}}</td>  <td>{{layerValue}}</td>  </tr></tbody>  </table>  {{/each}}</div>'},isStacked:{title:"Stack Tooltip Data",type:"boolean",propertyOrder:2,default:!1,format:"checkbox"},handlebarhelper:{type:"array",propertyOrder:5,format:"object",title:"Tooltip Helper",options:{hidden:!1,collapsed:!1},items:{type:"object",title:"Helper",options:{collapsed:!0},properties:{Name:{title:"Name",type:"string",default:""},Regex:{title:"Regex",type:"string",default:""},Value:{title:"Value",type:"string",default:""}}}}}},ColorPallette:{type:"object",title:"Color Palette",propertyOrder:7,options:{collapsed:!0},properties:{chartBarColors:{type:"array",format:"table",title:"Colours",propertyOrder:1,options:{collapsed:!1},uniqueItems:!1,items:{type:"object",title:"Colour",properties:{type:{type:"gradient",options:{gradient:!1},title:"color",default:"#0061FF"}}}},scheme:{type:"string",title:"Colour Scheme",propertyOrder:2,enum:["default"],default:"default"}}}}}}};if(0<_.keys(t.settingsModel.attributes).length)for(o=P.upgrades.indexOf(_.find(P.upgrades,{version:t.settingsModel.get("version")}))+1;o<P.upgrades.length;o+=1)(e=P.upgrades[o]).fn(t.settingsModel),t.settingsModel.set("version",e.version);return i};var L=P;function P(){}L.upgrades=[{version:0,fn:function(){}},{version:"4.1.0s4c",fn:function(t){var e=t.get("DataSet.Layers"),o=t.get("Padding"),i=t.get("FileExport");void 0===i?(t.set("FileExport.ShowExportCsvButton",!1),t.set("FileExport.ShowExportExcelButton",!1),t.set("FileExport.ShowScreenshot",!1),t.set("FileExport.FileName",[])):t.set("FileExport",i),void 0===t.get("Tooltip.isStacked")&&t.set("Tooltip.isStacked",!1),_.each(e,function(t){t.BorderColor=void 0===t.BorderColor?"#ffffff":t.BorderColor}),void 0===o&&t.set("Padding",{Right:2,Bottom:2,Left:2,Top:2})}},{version:"4.2.0",fn:function(t){t=t.get("ticks");t.Format=void 0===t.Format?"General":t.Format,t.Precision=void 0===t.Precision?0:t.Precision,t.HideTrailingZeroes=void 0!==t.HideTrailingZeroes&&t.HideTrailingZeroes,t.DateFormat=void 0===t.DateFormat?"YYYY-MM-DD":t.DateFormat,t.Prefix=void 0===t.Prefix?"":t.Prefix,t.Suffix=void 0===t.Suffix?"":t.Suffix}},{version:"4.4.0S2",fn:function(t){t.set("Style",{advanced:"",cssClasses:""})}},{version:"4.6.1",fn:function(t){var e=t.get("Tooltip");'<div>{{title}}<br>{{#each dataSet}}<table><tr><td><svg style="width:15px;height:15px"> <circle fill="{{color}}" stroke- width="2" stroke= "white" r="6" cy="8" cx="8" ></circle></svg></td><td> {{legend}}</td><td>{{yaxis}}</td></tr></table>{{/each}}</div>'===e.advancedTooltip&&(e.advancedTooltip='<div>{{#each dataSet}}<table><tbody>{{#eq @index 0}} <tr><td colspan="3">{{legend}}</td> </tr> {{/eq}} <tr> <td><svg style="width:15px;height:15px"> <circle fill="{{color}}" width="2" stroke="white" r="6" cy="8" cx="8"></circle> </svg></td> <td> {{layerKey}}</td>  <td>{{layerValue}}</td>  </tr></tbody>  </table>  {{/each}}</div>'),t.set("Tooltip",e)}}];T.app=e.template({compiler:[8,">= 4.3.0"],main:function(t,e,o,i,a){return'<div class="chart-container">\n    <canvas class="chart"></canvas>\n    <div class="chartjs-tooltip" style="display:none"></div>\n</div>'},useData:!0}),T.fileExporter=e.template({compiler:[8,">= 4.3.0"],main:function(t,e,o,i,a){var r=null!=e?e:t.nullContext||{},n=t.hooks.helperMissing,s=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tools-panel">\n    <div class="pnlButtons">\n        <span class="lnksExport link-disabled">\n            <i class="fa fa-fw fa-download" title="'+s((t(o,"t")||e&&t(e,"t")||n).call(r,"Data",{name:"t",hash:{},data:a,loc:{start:{line:4,column:51},end:{line:4,column:63}}}))+'"></i>\n            <a class="lnkExcelExport" title="'+s((t(o,"t")||e&&t(e,"t")||n).call(r,"Download the current dataset in Excel format",{name:"t",hash:{},data:a,loc:{start:{line:5,column:45},end:{line:5,column:97}}}))+'">'+s((t(o,"t")||e&&t(e,"t")||n).call(r,"Excel",{name:"t",hash:{},data:a,loc:{start:{line:5,column:99},end:{line:5,column:112}}}))+'</a>\n            <a class="lnkCsvExport" title="'+s((t(o,"t")||e&&t(e,"t")||n).call(r,"Download the current dataset in CSV format",{name:"t",hash:{},data:a,loc:{start:{line:6,column:43},end:{line:6,column:93}}}))+'">'+s((t(o,"t")||e&&t(e,"t")||n).call(r,"CSV",{name:"t",hash:{},data:a,loc:{start:{line:6,column:95},end:{line:6,column:106}}}))+'</a>\n            <a class="lnkDownloadScreenshot" title="'+s((t(o,"t")||e&&t(e,"t")||n).call(r,"Download a PNG image of the chart",{name:"t",hash:{},data:a,loc:{start:{line:7,column:52},end:{line:7,column:93}}}))+'">'+s((t(o,"t")||e&&t(e,"t")||n).call(r,"PNG",{name:"t",hash:{},data:a,loc:{start:{line:7,column:95},end:{line:7,column:106}}}))+"</a>\n        </span>\n    </div>\n</div>"},useData:!0});var E=T;function T(){}w.getConfig=function(t){var o=this,e={".csv":"Csv",".xlsx":"Excel"}[t.fileFormat],i={configSets:{},dataSet:{},fileFormat:t.fileFormat,fileName:c.ExportTools.getExportFileName(t.fileName,"",e),workSheetTitle:t.workSheetTitle,metaData:[]},a=t.columnsConfig,r=a.dataSource;return i.fileName=c.ExportTools.getExportFileName(t.fileName,"",e),i.metaData=[],i.fileFormat=t.fileFormat,i.workSheetTitle=t.workSheetTitle,r&&(i.dataSet=r.getData().toJSON(),_.each(a.columnIds,function(t){var e=c.ExportTools.regExValidateColumnIDs(t,r.getColumnNames());0<e.length?e.forEach(function(t){i.metaData.push(o.getExportMetaData({colId:t,kdbType:r.getColumnType(t)}))}):console.log("Column with id: '"+t+"' not found")})),i},w.getExportMetaData=function(t){var e=[],o=t.kdbType,i="",a="String";return(3===o||o<1||19<o)&&(o=11,i="TO_STRING",a="String"),1===o?a="Boolean":1<o&&o<10&&(a="Number",o<8&&(i="#0")),e.colId=t.colId,e.colName=t.colId,e.dataType=a,e.dataKdbType=o,e.dataFormat=i,e.hideTrailingZeroes=!1,e.prefix="",e.suffix="",e};var z=w;function w(){}var O,M=c.Tools,G=(O=a.View,n(R,O),R.prototype.remove=function(){return this.$lnkCsvExport&&this.$lnkCsvExport.off(),this.$lnkExcelExport&&this.$lnkExcelExport.off(),this.$lnkDownloadScreenshot&&this.$lnkDownloadScreenshot.off(),this.stopListening(),a.View.prototype.remove.apply(this)},R.prototype.initializeEvents=function(){this.listenTo(this.model,"change",this.displayChoiceLinkButtons.bind(this)),this.$lnkCsvExport&&this.$lnkExcelExport&&this.$lnkDownloadScreenshot&&(this.$lnkCsvExport.click(_.bind(this.fileExport.bind(this),this,".csv")),this.$lnkExcelExport.click(_.bind(this.fileExport.bind(this),this,".xlsx")),this.$lnkDownloadScreenshot.click(_.bind(this.downloadImage.bind(this),this,".png")))},R.prototype.displayChoiceLinkButtons=function(){var t=this.model.get("FileExport");!t||_.keys(t).length<5||(t.ShowExportCsvButton||t.ShowExportExcelButton||t.ShowScreenshot?(this.$lnkCsvExport&&this.$lnkExcelExport&&this.$lnkDownloadScreenshot&&this.$lnksExport&&(this.$lnksExport.removeClass("link-disabled"),this.$lnkCsvExport.toggleClass("link-disabled",!t.ShowExportCsvButton),this.$lnkExcelExport.toggleClass("link-disabled",!t.ShowExportExcelButton),this.$lnkDownloadScreenshot.toggleClass("link-disabled",!t.ShowScreenshot)),this.$chartContainer.toggleClass("links-enabled",!this.$chartContainer.hasClass("links-enabled")),t.Enabled||this.model.set("FileExport.Enabled",!0)):(this.$lnksExport&&this.$lnksExport.addClass("link-disabled"),this.$chartContainer.removeClass("links-enabled"),t.Enabled&&this.model.set("FileExport.Enabled",!1)))},R.prototype.downloadImage=function(t){var o=("string"==typeof(o=c.ExportTools.getExportFileName(this.getExportConfig().fileName,"","Screenshot"))?o:"Screenshot")+t;this.generateImage(function(t,e){M.fileSave(o,t,e)})},R.prototype.fileExport=function(t){var e=c.ExportTools,t=z.getConfig(_.extend(this.getExportConfig(),{fileFormat:t}));e.openFileExportDialog(t)},R.prototype.generateImage=function(e){var t=this.getCanvas(),o=t.width,i=t.height,a=document.createElement("canvas"),r="Light"===this.getTheme()?"#F8F8F8":"#282828";t&&(a.width=o,a.height=i,(t=a.getContext("2d")).fillStyle=r,t.fillRect(0,0,o,i),t.drawImage(a,0,0),this.isIE?(r=a.toDataURL("image/png"),e(M.convertDataUrlToBlob(r),"image/png")):t.canvas.toBlob(function(t){e(t,"application/octet-stream")}))},R.prototype.getTheme=function(){return this.appView.dashboardViewModel.get("DashboardTheme")},R.prototype.renderLinks=function(){this.$lnksExport=this.$el.find(".lnksExport"),this.$lnkCsvExport=this.$el.find("a.lnkCsvExport"),this.$lnkExcelExport=this.$el.find("a.lnkExcelExport"),this.$lnkDownloadScreenshot=this.$el.find("a.lnkDownloadScreenshot")},R);function R(t){var e=O.call(this,t)||this;return e.api=t.api,e.getCanvas=t.getCanvas,e.appView=t.appView,e.getExportConfig=t.getExportConfig,e.isIE=!1,HTMLCanvasElement&&HTMLCanvasElement.prototype&&_.get(HTMLCanvasElement.prototype,"msToBlob")&&(e.isIE=!0),e.$chartContainer=e.appView.$el.find(".chart-container"),e.render(),e.renderLinks(),e.initializeEvents(),e}B=a.View,n(A,B),A.prototype.updateDataSource=function(o){var i=this;if(this.dataSources[o.getKey()]){var a=!1,e=this.layers.filter(function(t){t=t.get("Basics.Data");return t&&t.cid===o.getKey()}),r=c.HeuristicHelpers.getScalarColumns(o),n=c.HeuristicHelpers.getStringColumns(o),s=c.HeuristicHelpers.getListColumns(o),l=0===n.length?0===s.length?r:s:n,p=0===r.length?s:r,n=this.errors[o.getKey()];if(0===p.length&&(!n||"Loading"===_.get(n,"type")))return void this.api.showErrorMessage({error:t("Data Source provided is not valid for Radar Chart"),type:"Warning"});e.forEach(function(t,e){t.updateData(o),t.set("possibleColumns",o.getColumnNames()),t.set("possibleRules",o.getColumnNames()),t.set("possibleLabels",o.getColumnNames()),i.api.setProperty("possibleColumns",t.get("possibleColumns")),i.api.setProperty("possibleRules",t.get("possibleRules")),i.api.setProperty("possibleLabels",t.get("possibleLabels")),0!==e||t.get("DataSet.Layers.0.Data")||(t.set("DataSet.Layers.0.Data",p[0]),i.api.setProperty("DataSet.Layers.0.Data",p[0]),a=!0),0!==e||t.get("DataSet.Radar")||(t.set("DataSet.Radar",l[0]),i.api.setProperty("DataSet.Radar",l[0]),a=!0)}),a&&(this.api.setProperty("DataSet",{Radar:l[0],RadarColor:"#000000",RadarColorAngle:"#000000",GridLineOpacity:35,AngleLineOpacity:35,Layers:[{Data:p[0],Color:"#0061FF",BorderColor:"#ffffff",UseColor:!1,ColorOpacity:35,Display:"",PointStyle:"",PointRadius:2}]}),this.isReadyForThemeChange=!0,this.setThemeAccordingToDashboardSettings())}(this.animation&&this.animation.get("Enabled")?D.safeHandle(this.updateChart.bind(this)):D.safeHandle(this.initializeChart.bind(this))).call(this)},A.prototype.updateError=function(t,e){function o(t){return"Error"===t?3:"Loading"===t?2:"NoResults"===t?1:0}var i=this,t=t.getKey(),e=(e?this.errors[t]=e:delete this.errors[t],_.reduce(this.errors,function(t,e){e=e.type;return o(e)>o(t)?e:t},""));e&&("NoResults"!==e||Object.keys(this.dataSources).length===Object.keys(this.errors).length)?(t=_.map(this.errors,function(t,e){t=t.error,e=i.dataSources[e];return t?"["+e.getPath()+"]: "+t:null}).filter(function(t){return t}),this.api.showQueryStatus({error:t.join("\n"),type:e})):this.api.hideQueryStatus()},A.prototype.onSettingsChange=function(t){t=D.expandNestedViewStates(t,this.api),t=D.replaceViewStatesWithValue("",t,this.api),t=D.pump(t);this.onSettingsChangeProcessed.call(this,t)},A.prototype.resizeCanvas=function(t){t.get("FileExport.Enabled")?this.$el.find(".chart-container").toggleClass("tools-enabled",!this.$el.find(".chart-container").hasClass("tools-enabled")):this.$el.find(".chart-container").removeClass("tools-enabled"),D.safeHandle(this.updateChart.bind(this)).call(this)},A.prototype.onSettingsChangeProcessed=function(t){_.isObject(t.Animations)&&this.onSettingsAnimationsChanged.call(this,t.Animations),_.isObject(t.Basics)&&this.onSettingsBasicsChanged.call(this,t.Basics),_.isObject(t.Basics)&&t.Basics.Data&&this.onSettingsLayersChanged.call(this,t),_.isObject(t.Basics)&&t.Basics.ChartType&&this.onSettingsChartTypeChanged.call(this,t),_.isObject(t.DataSet)&&this.onSettingsOnData(t),_.isObject(t.ticks)&&this.onSettingFormattingChange(t,"ticks"),_.isObject(t.Legend)&&this.onSettingOnLegend(t),_.isObject(t.ColorPallette)&&this.onSettingColorPalletteChange(t),_.isObject(t.FileExport)&&this.onSettingsFileExportChanged.call(this,t.FileExport),_.isObject(t.Padding)&&this.initializeChart(),_.isObject(t.Tooltip)&&this.onSettingsTooltipChange(t)},A.prototype.onSettingsTooltipChange=function(t){var o=this.layers.models[0];o&&(_.each(t,function(t,e){o.set(e,t)}),_.get(this.layers,"models")&&this.layers.models[0].updateVisuals(),this.initializeChart())},A.prototype.onSettingsFileExportChanged=function(t){var o=this;this.fileExportModel&&(_.each(t,function(t,e){o.fileExportModel.set("FileExport."+e,t)}),4===_.keys(t).length&&void 0===this.fileExportModel.get("FileExport.Enabled")&&(t.ShowExportCsvButton||t.ShowExportExcelButton||t.ShowScreenshot?this.fileExportModel.set("FileExport.Enabled",!0):this.fileExportModel.set("FileExport.Enabled",!1)))},A.prototype.onSettingColorPalletteChange=function(t){var o=this.layers.models[0];o&&(_.each(t,function(t,e){o.set(e,t)}),_.get(this.layers,"models")&&this.layers.models[0].updateVisuals(),this.initializeChart())},A.prototype.onSettingsChartTypeChanged=function(t){var e=this.layers.models[0];e&&t.Basics&&t.Basics.ChartType&&e.setChartType(t.Basics.ChartType),this.initializeChart()},A.prototype.onSettingFormattingChange=function(t,o){var i=this.layers.models[0];i&&_.each(t[o],function(t,e){i.setFormattingProps(e,t,o)}),this.initializeChart()},A.prototype.onSettingOnLegend=function(t){var o=this.layers.models[0];o&&_.each(t.Legend,function(t,e){o.setLegendProps(e,t)}),this.initializeChart()},A.prototype.onSettingsLayersChanged=function(t){var o=this,i=(this.layers.set(t),t.Basics.Data),t=this.dataSources[i.cid];t?t.hasData()&&this.updateDataSource(t):(t=new H(i,this,this.api,this.focus),this.dataSources[i.cid]=t,this.listenTo(i,"change:queryStatus",function(t,e){o.updateError(o.dataSources[i.cid],e)}),t.subscribe())},A.prototype.onSettingsOnData=function(t){var o=this.layers.models[0];_.each(t.DataSet,function(t,e){!o||"Radar"!==e&&"RadarColor"!==e&&"RadarColorAngle"!==e&&"GridLineOpacity"!==e&&"AngleLineOpacity"!==e||o.set("DataSet."+e,t),o&&"Layers"===e&&o.set("DataSet.Layers",t)}),_.each(this.dataSources,_.bind(function(t){o.chartData={},void 0===o.get("Legend")&&o.set("Legend",this.api.getProperty("Legend")),void 0===o.get("Tooltip")&&o.set("Tooltip",this.api.getProperty("Tooltip")),o.updateData(t)},this)),this.initializeChart()},A.prototype.onSettingsAnimationsChanged=function(t){t.hasOwnProperty("Enabled")?(t.Enabled?D.cache(this.animation,"Animations.",{load:["Duration","Easing"],defaults:[0,"easeOutQuart"]},this.api):D.cache(this.animation,"Animations.",{store:["Duration","Easing"]},this.api),this.animation.set(t),_.defer(function(){this.api.setProperty("Animations",a.Model.prototype.toJSON.apply(this.animation))}.bind(this))):this.animation.set(t)},A.prototype.onSettingsBasicsChanged=function(t){var e=this;void 0!==t.Focus&&(this.focus=_.first(D.focus2Array(t.Focus))||[],_.each(this.dataSources,function(t){t.setFocus(e.focus)}))},A.prototype.initializeChart=function(){this.chart&&(this.chart.destroy(),delete this.chart);var t=this.prepareChart(),e=t.datasets,o=t.labels,t=t.options;if(e&&o&&t){e={type:this.layers.models[0].getChartType(),data:{datasets:e.sort(function(t,e){return t.index&&e.index?e.index-t.index:0}),labels:o},options:$.extend(t,this.layers.models[0].computeConfigProps())};window.layers=this.layers,window.dataSources=this.dataSources;try{this.chart=new i(this.ctx,e)}catch(t){console.log(t)}}},A.prototype.updateChart=function(){if(this.chart){var t=this.prepareChart(),e=t.datasets,o=t.labels,t=t.options;if(e&&o&&t){$.extend(!0,this.chart.options,t),e.forEach(function(e){var t,o=_.filter(this.chart.data.datasets,function(t){return e.label===t.label})[0];o?(t=e.data,$.extend(!0,o,e),o.data=t):this.chart.data.datasets.push(e)}.bind(this));for(var i=_.fromPairs(_.map(e,function(t){return[t.label,!0]})),a=0;a<this.chart.data.datasets.length;a++)i[this.chart.data.datasets[a].label]||(this.chart.data.datasets.splice(a,1),a--);this.chart.data.datasets.sort(function(t,e){return e.index-t.index}),this.chart.data.labels=o,this.chart.update()}}else D.safeHandle(this.initializeChart.bind(this)).call(this)},A.prototype.prepareChart=function(){if(!this.layers.length)return{};var t=_.flatten(_.map(this.layers.models,"dataset").filter(_.negate(_.isEmpty.bind(this)))),e=_.flatten(_.map(this.layers.models,"labelData").filter(_.negate(_.isEmpty.bind(this)))),o=this.layers.models[0],i=this.$el,a=this.tooltips,r=this.api.getProperty("Padding");return{datasets:t,labels:e,options:$.extend(!0,{},this.defaultOptions,{animation:this.animation.toRadarON(),layout:{padding:{right:r.Right,bottom:r.Bottom,left:r.Left,top:r.Top}},onClick:function(t){t&&t.length&&this.onClick(t[0]._index)}.bind(this),tooltips:{enabled:!1,mode:"index",custom:function(t){a.customTooltip(t,o,i)}}})}},A.prototype.onClick=function(t){var e,o=this.layers.models[0],i=o.get("Basics.Data"),a=this.dataSources[i.cid],r=a.getData().at(t);void 0!==r&&(i=a.getPropertyFromColumn(o.get("Basics.SelectedAttr")),t=r.get(i),this.api.setProperty("Basics.Selected",t,!0),i=a.getDepth(),t=_.clone(this.focus),e=a.getPropertyFromColumn(o.get("DataSet.Radar")),e=r.get(e),t[i]=e&&e.toString?e.toString():""+e,this.api.setProperty("Basics.Focus",t.join(","),!0),i=o.get("Basics.SelectedObjectRouting"),_.each(i,function(t,e){t=a.getPropertyFromColumn(t.ColumnProperty),t=r.get(t);this.api.setProperty("Basics.SelectedObjectRouting."+e+".ViewstateProperty",t,!0)}))},A.prototype.onLayerDataEvents=function(t){var e=t.get("Basics.Data"),e=e?this.dataSources[e.cid]:void 0;e&&t.updateData(e),t.set("_Hidden._PossibleColumns",e?e.getColumnNames():[])},A.prototype.onLayerVisualEvents=function(t){t.updateVisuals()},A.prototype.setTheme=function(t){var e,o=this,i="#fff",a="#fff",r="#fff",n="#fff",s="#fff",l="#fff",p=("Light"===t?(i="#FFFFFF",n="#000000",l=a="rgba(255, 255, 255, 0.75)",s=r="rgba(0, 0, 0, 0.75)"):"Dark"===t&&(i="#000000",n="#FFFFFF",s=r="rgba(255, 255, 255, 0.75)",l=a="rgba(0, 0, 0, 0.75)"),e=t.toLowerCase(),this.$el.removeClass("dark light"),this.$el.addClass(e),this.layers.models[0]);p&&(p.theme=t,_.each(["Legend.LabelColor","DataSet.RadarColor","DataSet.RadarColorAngle"],function(t){o.api.getProperty(t).toLowerCase()===i.toLowerCase()&&(p.set(t,n),o.api.setProperty(t,n))}),this.api.getProperty("ticks.fontColor").toLowerCase()===a.toLowerCase()&&(p.set("ticks.fontColor",s),this.api.setProperty("ticks.fontColor",s)),this.api.getProperty("ticks.backdropColor").toLowerCase()===r.toLowerCase()&&(p.set("ticks.backdropColor",l),this.api.setProperty("ticks.backdropColor",l)))},A.prototype.setThemeAccordingToDashboardSettings=function(){this.isReadyForThemeChange&&this.dashboardViewModel&&this.setTheme(this.dashboardViewModel.get("DashboardTheme"))},A.prototype.updatePossibleLayers=function(){this.layers.filter(function(t){return"Line"===t.get("_Hidden._Type")}).forEach(function(i){var t=i.collection.reduceRight(function(t,e,o){return[i===e?"nofill":"Layer "+(o+1)].concat(t)},["origin"]);i.set("_Hidden._PossibleLayers",t)}.bind(this))},A.getComponentDefinition=L.getComponentDefinition,A.DEBUG=!1;var B,N=A;function A(t){var o=B.call(this,t)||this,i=(o.focus=[],o.layers=new j,o.dataSources={},o.errors={},_.extend(o,_.pick(t,["api","dashboardViewModel"])),A.componentApi=t.api,o.onSettingsChange.bind(o));return o.onSettingsChange=function(t){var e=this.onSettingsChange!==(this.onSettingsChange=i);this.onSettingsChange(t),e&&(this.isReadyForThemeChange=!0,this.setThemeAccordingToDashboardSettings())}.bind(o),o.$el.html(E.app({})),o.ctx=o.el.querySelector("canvas").getContext("2d"),o.defaultOptions={maintainAspectRatio:!1,responsive:!0,animation:{duration:0}},o.listenTo(o.layers,"add",function(){this.setThemeAccordingToDashboardSettings()}),o.listenTo(o.layers,"reset",function(){this.setThemeAccordingToDashboardSettings()}),o.listenTo(o.layers,"remove",function(t){t.stopListening()}),o.listenTo(o.layers,"update",function(t,e){this.updatePossibleLayers();e=0<e.changes.added.length+e.changes.removed.length;D.safeHandle(!e&&this.animation&&this.animation.get("Enabled")?this.updateChart:this.initializeChart).call(this)}),o.animation=new V,o.listenTo(o.animation,"change",D.safeHandle(o.updateChart.bind(o))),o.tooltips=new I,o.fileExportModel=new a.DeepModel,o.fileExporterView=new G({model:o.fileExportModel,el:E.fileExporter({}),api:o.api,appView:o,getCanvas:function(){return o.ctx.canvas},getExportConfig:function(){var t=o.layers.at(0),e=(e=[t.get("DataSet.Radar")]).concat(_.map(t.get("DataSet.Layers"),"Data"));return{columnsConfig:{dataSource:o.dataSources[t.get("Basics.Data").cid],columnIds:e},fileName:o.fileExportModel.get("FileExport.FileName"),altFileName:"",workSheetTitle:"ChartJs"}}}),o.listenTo(o.fileExportModel,"change:FileExport.Enabled",o.resizeCanvas.bind(o)),o.$el.prepend(o.fileExporterView.$el),o}return N});