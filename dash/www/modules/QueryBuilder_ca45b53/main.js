define(["backbone","Forms","Accordion","BasicComponents","Datagrid","DataFilter","QuickBase","Handlebars","vis","moment","jqueryui","jstree","css!./css/app.css"],function(l,r,j,L,F,J,d,e,n,q,U,z){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=(s.getComponentDefinition=function(e){var t,n,i={id:19,componentName:"Graph",componentDescription:"Graph",appKey:"Graph",css:"graphs",ghostViewThumb:null,buildViewThumb:null,appArgs:{websiteUrl:(e=e||{websiteUrl:"",settingsModel:new l.Model}).websiteUrl,json:{version:"4.4.1",Basics:{Data:"",Connection:"html5evalcongroup",Direction:"Left-Right",DialogPlacement:"Pop-up",AutoSave:!1,ReadOnly:!1,ForceSelection:!1,Selected:"",JSON:"",qIPC:"",UseViewStates:!1,Theme:"Dark"},Bindings:[],Style:{advanced:"",LevelSeparation:220,NodeSpacing:150}},schema:{type:"object",title:"Properties",properties:{Basics:{type:"object",title:"Basics",options:{collapsed:!1},propertyOrder:202,properties:{Data:{title:"Data Source",type:"data",default:""},Connection:{type:"dataConnection",title:"Connection",default:"html5evalcongroup"},Direction:{type:"string",title:"Direction",default:"Left-Right",enum:["Left-Right","Right-Left","Up-Down","Down-Up"]},DialogPlacement:{type:"string",title:"Dialog Placement",default:"Pop-up",enum:["Left","Right","Pop-up"]},AutoSave:{type:"boolean",title:"Auto Save Dialogs",default:!1,format:"checkbox"},ReadOnly:{type:"boolean",title:"Read only",default:!1,format:"checkbox"},ForceSelection:{type:"boolean",title:"Force Selection",default:!1,format:"checkbox"},Selected:{type:"viewstate",title:"Selected Node",default:""},JSON:{type:"string",title:"Source",default:""},qIPC:{type:"string",title:"KDB",default:""},UseViewStates:{type:"boolean",default:!1,options:{hidden:!0}},Theme:{type:"string",title:"Theme",options:{hidden:!0},enum:["Dark","Light"]},DashboardTheme:{options:{hidden:!0}}}},Bindings:{type:"array",format:"table",title:"Bindings",uniqueItems:!0,options:{collapsed:!1},items:{type:"object",properties:{Key:{type:"string"},ViewState:{type:"viewstate"}}}},Style:{type:"object",title:"Style",options:{collapsed:!0},properties:{LevelSeparation:{type:"number",format:"number",title:"Level Separation",default:220},NodeSpacing:{type:"number",format:"number",title:"Node Spacing",default:150}}}}}}};if(0<_.keys(e.settingsModel.attributes).length)for(n=s.upgrades.indexOf(_.find(s.upgrades,{version:e.settingsModel.get("version")}))+1;n<s.upgrades.length;n+=1)(t=s.upgrades[n]).fn(e.settingsModel,e),e.settingsModel.set("version",t.version);return i},s.getSettingsModel=function(e){var t=s.getComponentDefinition(null).appArgs.json;return $.extend(!0,t,e),new l.DeepModel(t)},s);function s(){}o.upgrades=[{version:0,fn:_.noop.bind(this)},{version:"4.3.1",fn:function(e){e.get("Basics.ReadOnly")||e.set("Basics.ReadOnly",!1),e.get("Basics.Data")||e.set("Basics.Data","")}},{version:"4.5.0",fn:function(e){e.get("Basics.Direction")||e.set("Basics.Direction","Left-Right"),e.get("Style.LevelSeparation")||e.set("Style.LevelSeparation",220),e.get("Style.NodeSpacing")||e.set("Style.NodeSpacing",150),e.get("Basics.DialogPlacement")||e.set("Basics.DialogPlacement","Pop-up"),e.get("Basics.AutoSave")||e.set("Basics.AutoSave",!1),e.get("Basics.UseViewStates")||e.set("Basics.UseViewStates",!1)}},{version:"4.6.0",fn:function(e){e.get("Basics.ForceSelection")||e.set("Basics.ForceSelection",!1)}}];var c,u=d.QueryBuilder,p=(c=u.GraphNode,a(h,c),h.teaser2=function(e){return e.split("\n").map(function(e){return 26<e.length?e.substring(0,24)+"...":e}).join("\n")},h.valueDescription=function(e,t){function n(e){return _.isString(e)&&h.VSRx.exec(e)?"  "+e.substring(2,e.length-2):e||"null"}return(_.isNil(t)?"":" between ")+n(e)+(_.isNil(t)?"":" and "+n(t))},h.prototype.color=function(){switch(this.group){case"data":case"function":return"#97C2FB";case"stream":return"#fe79b8";case"filter":return"#FFED7C";case"groupBy":return"#F99F69";case"join":return"#98D26A";case"result":return"#A96FE8";case"update":return"#FF5B66"}},h.prototype.icon=function(){switch(this.group){case"data":case"stream":return"";case"filter":return"";case"groupBy":return"∑";case"join":return"";case"function":return"ƒ:";case"result":return"";case"update":return""}},h.prototype.teaser=function(){var e=this.description()||_.capitalize(this.group)+" "+this.id;return 26<e.length?e.substring(0,24)+"...":e},h);function h(){return null!==c&&c.apply(this,arguments)||this}a(m,f=p),m.prototype.description=function(){var e,t=this.data;return t&&t.name&&t.params?t.name+"("+t.params.map(function(e){return p.valueDescription(e.value)}).join(",")+")":t&&t.name&&t.partition?(e=t.partition,t.name+" partitioned by "+("long"===e.type?"year":e.type)+" "+e.operator+" "+e.parameters.map(function(e){return p.valueDescription(e.value)}).join(", ")):_.isEmpty(t)?_.capitalize(this.group)+" node":t};var f,g=m;function m(){var e=null!==f&&f.apply(this,arguments)||this;return e.getActiveBindingKeys=u.DataNode.getActiveBindingKeys,e}a(v,y=p),v.description=function(e){function n(e){return _.map(e.children,function(e){var t=e;return e.children?"("+n(e)+")":(t.propertyName||"")+("histogram"!==t.type&&t.operator?u.FilterNode.operatorMap[t.operator]:"")+p.valueDescription(t.value,t.value2)}).join(u.FilterNode.operatorMap[e.operator])}return n(e)},v.prototype.description=function(){var e=this.data,t=_.isEmpty(e.select)?"":_.map(e.select,function(e,t){return t===e?t:e+"→"+p.valueDescription(t)}).join(",");return e.where&&e.where.children&&e.where.children.length&&(t+=(t?"\n":"")+" where "+v.description(e.where)),(t=e.distinct?"distinct "+t:t)||"select all"},v.prototype.teaser=function(){return p.teaser2(this.description())};var y,H=v;function v(){var e=null!==y&&y.apply(this,arguments)||this;return e.getActiveBindingKeys=u.FilterNode.getActiveBindingKeys,e}a(w,K=p),w.prototype.description=function(){var e=this.data,t="group by "+_.map(e.groupBy,function(e,t){return t===(e=_.isString(e)?e:"round("+e.col+","+e.num+e.cast+")")?t:e+"→"+p.valueDescription(t)}).join(",");return _.isEmpty(e.agg)||(t+="\n select "+_.map(e.agg,function(e,t){return e[0]+"("+e.slice(1).join(",")+")"+(t!==e[1]&&2<=e.length?"→"+p.valueDescription(t):"")}).join(",")),t},w.prototype.teaser=function(){return p.teaser2(this.description())};var K,G=w;function w(){var e=null!==K&&K.apply(this,arguments)||this;return e.getActiveBindingKeys=u.GroupByNode.getActiveBindingKeys,e}a(Y,Q=p),Y.prototype.description=function(){var e="",t=this.data;if(!t)return _.capitalize(this.group);var n=t.left,i=t.right,a=t.swap;switch(t.fn){case"aj":e=(a?i:n).join(",");break;case"uj":case"upsert":e=(a?i:n).join(",")+(0<n.length&&0<i.length?" and ":"")+(a?n:i).join(",");break;default:e=(a?n:i).join(",")}return{ij:"Inner",lj:"Left",uj:"Union",aj:"Asof (aj)",upsert:"Upsert",pj:"Plus"}[t.fn]+" join"+(_.isEmpty(e)?"":" on "+e)};var Q,W=Y;function Y(e){e=Q.call(this,e)||this;return _.isEmpty(e.data)&&(e.data={fn:"lj",swap:!1,left:[],right:[]}),e}a(ee,X=p),ee.prototype.description=function(){return _.capitalize(this.group)};var X,Z=ee;function ee(){return null!==X&&X.apply(this,arguments)||this}a(b,te=p),b.prototype.description=function(){var e=this.data,t=_.map(e.update,function(e){return"set "+e.column+"="+(_.isArray(e.val)?e.val.map(function(e){return p.valueDescription(e)}):p.valueDescription(e.val))}).join(", ");return e.filter&&e.filter.children&&e.filter.children.length&&(t+="\n where "+H.description(e.filter)),t},b.prototype.teaser=function(){return p.teaser2(this.description())};var te,ne=b;function b(){var e=null!==te&&te.apply(this,arguments)||this;return e.getActiveBindingKeys=u.UpdateNode.getActiveBindingKeys,e}P.aggregateRow=e.template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){return'<div class="row">\n    <select class="fn"></select>\n    <select class="col1"></select>\n    <select class="col2"></select>\n    <div class="user-input"></div>\n    <div class="del" title="Delete Row"></div>\n</div>'},useData:!0}),P.aggregateView=e.template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){return'<div class="rows"></div>\n<div class="add-row">Add Aggregate</div>'},useData:!0}),P.app=e.template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="graph-container">\n    <div class="graph-content">\n        <div class="accordion">\n            <div class="side-dialog" style="display:none;">\n                <div class="side-dialog-menu">\n                    <span class="menu-item menu-icon"></span>\n                    <span class="menu-item description"></span>\n                    <span class="menu-item close-button"><i class="fa fa-times"></i></span>\n                </div>\n                <div class="side-dialog-content"></div>\n                <div class="side-dialog-buttons">\n                    <span class="save-button">Save</span>\n                </div>\n            </div>\n            <div class="builder">\n                <div class="helpful-tip" style="display:none;">\n                    <p><i class="fa fa-info-circle"></i><span></span></p>\n                </div>\n                <div class="graph"></div>\n            </div>\n        </div>\n    </div>\n    <ul class=\'custom-menu\'></ul>\n\n    <div class="nodeErrorMessage" style="display:none">\n        <div class="errors-title"><i class="fa fa-exclamation-triangle"></i><span>'+e.escapeExpression((o(n,"t")||t&&o(t,"t")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},"Error:",{name:"t",hash:{},data:a,loc:{start:{line:26,column:82},end:{line:26,column:96}}}))+'</span></div>\n        <span class="errors-text"></span>\n    </div>\n</div>'},useData:!0}),P.bindingSelect=e.template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="binding-wrap">\n    <i class="fa fa-fw watermark fa-eye binding-apply"></i>\n\n    <div class="binding-container" style="display:none">\n        <i class="fa fa-fw watermark fa-eye viewstate-icon"></i>\n        <input class="viewstate-display" type="text" tabindex="-1" value="'+e.escapeExpression("function"==typeof(n=null!=(n=o(n,"viewstateDisplay")||(null!=t?o(t,"viewstateDisplay"):t))?n:e.hooks.helperMissing)?n.call(null!=t?t:e.nullContext||{},{name:"viewstateDisplay",hash:{},data:a,loc:{start:{line:6,column:74},end:{line:6,column:94}}}):n)+'" readonly />\n        <i class="fa fa-fw watermark fa-eraser binding-clear-dialog"></i>\n        <div class="binding-dropdown">\n            <select class="binding-select"></select>\n        </div>\n    </div>\n</div>'},useData:!0}),P.dataDialog=e.template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){return'<div class=\'treeView\'>\n    <div class=\'search\'>\n        <i class=\'fa fa-search\'></i>\n        <input type=\'text\' class=\'searchBox\' />\n        <span class="clearSearch fa fa-times" style="display: none"></span>\n    </div>\n    <div class=\'tree\'></div>\n</div>\n<div class="paramsView">\n    <fieldset>\n        <legend class="paramTitle"></legend>\n        <div class="paramList"></div>\n    </fieldset>\n</div>\n<div class="data-error" style="display:none">\n    <i class="fa fa-exclamation-circle" aria-hidden="true"></i><span></span>\n</div>'},useData:!0}),P.dataParameter=e.template({1:function(e,t,n,i,a){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <input class="name-input col1" value="'+e.escapeExpression("function"==typeof(n=null!=(n=o(n,"name")||(null!=t?o(t,"name"):t))?n:e.hooks.helperMissing)?n.call(null!=t?t:e.nullContext||{},{name:"name",hash:{},data:a,loc:{start:{line:3,column:42},end:{line:3,column:50}}}):n)+'" />\n'},3:function(e,t,n,i,a){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <label class="col1">'+e.escapeExpression("function"==typeof(n=null!=(n=o(n,"name")||(null!=t?o(t,"name"):t))?n:e.hooks.helperMissing)?n.call(null!=t?t:e.nullContext||{},{name:"name",hash:{},data:a,loc:{start:{line:5,column:24},end:{line:5,column:32}}}):n)+"</label>\n"},5:function(e,t,n,i,a){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <div class="remove-item-btn col4" data-id="'+e.escapeExpression("function"==typeof(n=null!=(n=o(n,"id")||(null!=t?o(t,"id"):t))?n:e.hooks.helperMissing)?n.call(null!=t?t:e.nullContext||{},{name:"id",hash:{},data:a,loc:{start:{line:77,column:47},end:{line:77,column:53}}}):n)+'">\n        Remove Item\n    </div>\n'},compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var o,s=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,l=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="form-control viewstate-control">\n'+(null!=(o=c(n,"if").call(s,null!=t?c(t,"editable"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.program(3,a,0),data:a,loc:{start:{line:2,column:4},end:{line:6,column:11}}}))?o:"")+'\n    <div class="type-dropdown col2">\n        <select class="type-select">\n            <option>boolean</option>\n            <option>byte</option>\n            <option>char</option>\n            <option>date</option>\n            <option>datetime</option>\n            <option>dict</option>\n            <option>double</option>\n            <option>float</option>\n            <option>guid</option>\n            <option>int</option>\n            <option>list</option>\n            <option>long</option>\n            <option>minute</option>\n            <option>month</option>\n            <option>second</option>\n            <option>short</option>\n            <option>string</option>\n            <option>symbol</option>\n            <option>time</option>\n            <option>timespan</option>\n            <option>timestamp</option>\n        </select>\n    </div>\n\n    <div class="input-div col3">\n        \x3c!-- <input class="value-input" type="text" data-schemaformat="number" /> --\x3e\n        <span class="value-input bbf-editor"></span>\n\n        <i\n            class="fa fa-fw watermark fa-eye binding-apply binding-apply-dialog"\n        ></i>\n        <i class="fa fa-fw watermark fa-eye viewstate-apply"></i>\n\n        <div class="generate-value" title="'+l((c(n,"t")||t&&c(t,"t")||r).call(s,"Generate View State",{name:"t",hash:{},data:a,loc:{start:{line:43,column:43},end:{line:43,column:70}}}))+'">\n            <i class="fa fa-fw watermark fa-eye generate-viewstate-icon"></i>\n            <i class="fa fa-fw watermark fa-cog generate-viewstate-icon"></i>\n        </div>\n\n        <div class="binding-container">\n            <i class="fa fa-fw watermark fa-eraser binding-clear-dialog"></i>\n            <i\n                class="fa fa-fw watermark fa-eraser binding-clear"\n                title="'+l((c(n,"t")||t&&c(t,"t")||r).call(s,"Clear View State",{name:"t",hash:{},data:a,loc:{start:{line:52,column:23},end:{line:52,column:47}}}))+'"\n            ></i>\n            <div class="binding-dropdown">\n                <select class="binding-select">\n                    \x3c!--<option>binding1</option>\n\t\t\t\t\t<option>binding2</option>\n\t\t\t\t\t<option>binding3</option>--\x3e\n                </select>\n            </div>\n            <i\n                class="fa fa-fw watermark fa-eye binding-icon viewstate-icon"\n                title="'+l((c(n,"t")||t&&c(t,"t")||r).call(s,"Select View State",{name:"t",hash:{},data:a,loc:{start:{line:63,column:23},end:{line:63,column:48}}}))+'"\n            ></i>\n            <input\n                class="value-display data-parameter-editor"\n                type="text"\n                tabindex="-1"\n                readonly\n            />\n        </div>\n\n        <div class="node-container"></div>\n    </div>\n\n'+(null!=(o=c(n,"if").call(s,null!=t?c(t,"editable"):t,{name:"if",hash:{},fn:e.program(5,a,0),inverse:e.noop,data:a,loc:{start:{line:76,column:4},end:{line:80,column:11}}}))?o:"")+'</div>\n\n<div class="form-control viewstate-control button-row">\n    <div class="add-item-btn">\n        Add Item\n    </div>\n</div>\n\n<div class="list-items" style="margin-bottom: 22px; padding-left: 1em;"></div>\n'},useData:!0}),P.filterDialog=e.template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){return'<div class="select-table"></div>\n<div class="where-table"></div>'},useData:!0}),P.groupByDialog=e.template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){return'<div class="select-table"></div>\n<div class="agg-table"></div>'},useData:!0}),P.joinDialog=e.template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var o,s=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,l="function",c=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="join-dialog">\n    <div class="transformJoinType">\n        <span class="transformJoinTypeText">Join Type : </span>\n        <div class="joinDDL">\n            <select class="join-type-select"></select>\n        </div>\n    </div>\n    <div class="transformJoinTextDesc"></div>\n\n    <fieldset class="filterFieldset">\n        <legend>\n            <div class="transformSelection"></div>\n        </legend>\n\n        <div class="fieldSetDetails">\n            <div class="transformJoin">\n                <div class="transformJoinText">\n                    <span class="dbNameLeft col1">'+c(typeof(o=null!=(o=e(n,"a")||(null!=t?e(t,"a"):t))?o:r)==l?o.call(s,{name:"a",hash:{},data:a,loc:{start:{line:18,column:50},end:{line:18,column:55}}}):o)+'</span>\n                    <a class="swap" title="Swap Left and Right"><i class="fa fa-exchange"></i></a>\n                    <span class="dbNameRight col2">'+c(typeof(o=null!=(o=e(n,"b")||(null!=t?e(t,"b"):t))?o:r)==l?o.call(s,{name:"b",hash:{},data:a,loc:{start:{line:20,column:51},end:{line:20,column:56}}}):o)+"</span>\n                </div>\n                <div class=\"transformLeftDDL\"></div>\n                <div class=\"transformRightDDL\"></div>\n                <div class=\"transformJoinTables\">\n                    <div class=\"transformTable transformLeftTable col1\">\n                        <div class='searchRow'><input class='search' type='text' placeholder=\"search here...\" /><span\n                                class='closeIcon fa fa-times'></span></div>\n                        <div class='rows'></div>\n                    </div>\n                    <div class=\"transformTable transformRightTable col2\">\n                        <div class='searchRow'><input class='search' type='text' placeholder=\"search here...\" /><span\n                                class='closeIcon fa fa-times'></span></div>\n                        <div class='rows'></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </fieldset>\n</div>"},useData:!0}),P.joinRow=e.template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){return"<div class='row'>\n    <input type='checkbox' checked />\n    <label></label>\n</div>"},useData:!0}),P.menu=e.template({1:function(e,t,n,i,a){var o,s=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,l="function",c=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<li class="selectable" data-index = "'+c(typeof(o=null!=(o=e(n,"id")||(null!=t?e(t,"id"):t))?o:r)==l?o.call(s,{name:"id",hash:{},data:a,loc:{start:{line:2,column:37},end:{line:2,column:43}}}):o)+'"><i class="'+c(typeof(o=null!=(o=e(n,"icon")||(null!=t?e(t,"icon"):t))?o:r)==l?o.call(s,{name:"icon",hash:{},data:a,loc:{start:{line:2,column:55},end:{line:2,column:63}}}):o)+'"></i>'+c(typeof(o=null!=(o=e(n,"text")||(null!=t?e(t,"text"):t))?o:r)==l?o.call(s,{name:"text",hash:{},data:a,loc:{start:{line:2,column:69},end:{line:2,column:77}}}):o)+"</li>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){return null!=(n=(e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]})(n,"each").call(null!=t?t:e.nullContext||{},t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:1,column:0},end:{line:3,column:9}}}))?n:""},useData:!0}),P.partitionView=e.template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){return'<div class="operator-dropdown">\n    <select class="operator-select">\n        <option>equals</option>\n        <option>in</option>\n        <option>within</option>\n    </select>\n</div>\n<div class="data-parameter-container"></div>'},useData:!0}),P.selectRow=e.template({1:function(e,t,n,i,a){return' checked="checked" '},3:function(e,t,n,i,a){return"disabled"},5:function(e,t,n,i,a,o,s){var r,l=null!=t?t:e.nullContext||{},c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <table class="xbar">\n        <tr>\n            <td><label title="round down to multiple"><input type="checkbox" class="xcheckbox" '+(null!=(r=c(n,"if").call(l,null!=(r=null!=t?c(t,"xbar"):t)?c(r,"num"):r,{name:"if",hash:{},fn:e.program(6,a,0,o,s),inverse:e.noop,data:a,loc:{start:{line:11,column:95},end:{line:11,column:135}}}))?r:"")+' />round</label></td>\n            <td><input class="xnum" type="number" value="'+(null!=(r=c(n,"if").call(l,null!=(r=null!=t?c(t,"xbar"):t)?c(r,"num"):r,{name:"if",hash:{},fn:e.program(8,a,0,o,s),inverse:e.program(10,a,0,o,s),data:a,loc:{start:{line:12,column:57},end:{line:12,column:102}}}))?r:"")+'" min="1" /></td>\n            '+(null!=(r=c(n,"if").call(l,null!=t?c(t,"sub"):t,{name:"if",hash:{},fn:e.program(12,a,0,o,s),inverse:e.noop,data:a,loc:{start:{line:13,column:12},end:{line:20,column:24}}}))?r:"")+"\n        </tr>\n    </table>\n"},6:function(e,t,n,i,a){return'checked="checked"'},8:function(e,t,n,i,a){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return e.escapeExpression(e.lambda(null!=(e=null!=t?o(t,"xbar"):t)?o(e,"num"):e,t))},10:function(e,t,n,i,a){return"10"},12:function(e,t,n,i,a,o,s){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<td>\n                <select class="xcast">\n                    <option></option>\n'+(null!=(n=r(n,"each").call(null!=t?t:e.nullContext||{},null!=t?r(t,"sub"):t,{name:"each",hash:{},fn:e.program(13,a,0,o,s),inverse:e.noop,data:a,loc:{start:{line:16,column:20},end:{line:18,column:29}}}))?n:"")+"                </select>\n            </td>"},13:function(e,t,n,i,a,o,s){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"                    <option "+(null!=(n=(r(n,"eq")||t&&r(t,"eq")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},null!=(n=null!=s[1]?r(s[1],"xbar"):s[1])?r(n,"cast"):n,t,{name:"eq",hash:{},fn:e.program(14,a,0,o,s),inverse:e.noop,data:a,loc:{start:{line:17,column:28},end:{line:17,column:68}}}))?n:"")+">"+e.escapeExpression(e.lambda(t,t))+"</option>\n"},14:function(e,t,n,i,a){return"selected"},compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a,o,s){var r,l,c=null!=t?t:e.nullContext||{},d=e.hooks.helperMissing,u="function",p=e.escapeExpression,h=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<label>\n    <input type="checkbox" '+(null!=(r=h(n,"if").call(c,null!=t?h(t,"checked"):t,{name:"if",hash:{},fn:e.program(1,a,0,o,s),inverse:e.noop,data:a,loc:{start:{line:2,column:27},end:{line:2,column:68}}}))?r:"")+' class="checkbox"/>\n    <span>'+p(typeof(l=null!=(l=h(n,"nameIn")||(null!=t?h(t,"nameIn"):t))?l:d)==u?l.call(c,{name:"nameIn",hash:{},data:a,loc:{start:{line:3,column:10},end:{line:3,column:20}}}):l)+'</span>\n    <i>→</i>\n</label>\n<div class="user-input">\n    \x3c!-- <input class="nameout" value="'+p(typeof(l=null!=(l=h(n,"nameOut")||(null!=t?h(t,"nameOut"):t))?l:d)==u?l.call(c,{name:"nameOut",hash:{},data:a,loc:{start:{line:7,column:39},end:{line:7,column:50}}}):l)+'" '+(null!=(r=h(n,"unless").call(c,null!=t?h(t,"checked"):t,{name:"unless",hash:{},fn:e.program(3,a,0,o,s),inverse:e.noop,data:a,loc:{start:{line:7,column:52},end:{line:7,column:90}}}))?r:"")+" /> --\x3e\n"+(null!=(r=h(n,"if").call(c,null!=t?h(t,"canXbar"):t,{name:"if",hash:{},fn:e.program(5,a,0,o,s),inverse:e.noop,data:a,loc:{start:{line:8,column:4},end:{line:23,column:11}}}))?r:"")+"</div>"},useData:!0,useDepths:!0}),P.selectView=e.template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){return'<div class="searchRow"><input type="checkbox" /><input class="search" type="text" placeholder="search here..."/><span class="closeIcon fa fa-times"></span></div>\n<div class="rows"></div>'},useData:!0}),P.textInput=e.template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<input class="value-input" type="text" value="'+e.escapeExpression("function"==typeof(n=null!=(n=o(n,"value")||(null!=t?o(t,"value"):t))?n:e.hooks.helperMissing)?n.call(null!=t?t:e.nullContext||{},{name:"value",hash:{},data:a,loc:{start:{line:1,column:46},end:{line:1,column:55}}}):n)+'" />'},useData:!0}),P.transformTemplate=e.template({1:function(e,t,n,i,a){var o,s=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,l="function",c=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"    t"+c(typeof(o=null!=(o=e(n,"index")||(null!=t?e(t,"index"):t))?o:r)==l?o.call(s,{name:"index",hash:{},data:a,loc:{start:{line:2,column:5},end:{line:2,column:14}}}):o)+": ej [`k;(select k:"+c(typeof(o=null!=(o=e(n,"leftKey")||(null!=t?e(t,"leftKey"):t))?o:r)==l?o.call(s,{name:"leftKey",hash:{},data:a,loc:{start:{line:2,column:33},end:{line:2,column:44}}}):o)+", "+c(typeof(o=null!=(o=e(n,"selectParams")||(null!=t?e(t,"selectParams"):t))?o:r)==l?o.call(s,{name:"selectParams",hash:{},data:a,loc:{start:{line:2,column:46},end:{line:2,column:62}}}):o)+" from t"+c(typeof(o=null!=(o=e(n,"lefttable")||(null!=t?e(t,"lefttable"):t))?o:r)==l?o.call(s,{name:"lefttable",hash:{},data:a,loc:{start:{line:2,column:69},end:{line:2,column:82}}}):o)+");(select k:"+c(typeof(o=null!=(o=e(n,"rightKey")||(null!=t?e(t,"rightKey"):t))?o:r)==l?o.call(s,{name:"rightKey",hash:{},data:a,loc:{start:{line:2,column:94},end:{line:2,column:106}}}):o)+", "+c(typeof(o=null!=(o=e(n,"rightCols")||(null!=t?e(t,"rightCols"):t))?o:r)==l?o.call(s,{name:"rightCols",hash:{},data:a,loc:{start:{line:2,column:108},end:{line:2,column:121}}}):o)+" from t"+c(typeof(o=null!=(o=e(n,"righttable")||(null!=t?e(t,"righttable"):t))?o:r)==l?o.call(s,{name:"righttable",hash:{},data:a,loc:{start:{line:2,column:128},end:{line:2,column:142}}}):o)+")];\n\n"},3:function(e,t,n,i,a){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(n=(o(n,"eq")||t&&o(t,"eq")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},null!=t?o(t,"joinType"):t,"union",{name:"eq",hash:{},fn:e.program(4,a,0),inverse:e.program(6,a,0),data:a,loc:{start:{line:5,column:8},end:{line:21,column:15}}}))?n:""},4:function(e,t,n,i,a){var o,s=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,l="function",c=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"            t"+c(typeof(o=null!=(o=e(n,"index")||(null!=t?e(t,"index"):t))?o:r)==l?o.call(s,{name:"index",hash:{},data:a,loc:{start:{line:6,column:13},end:{line:6,column:22}}}):o)+":(select "+c(typeof(o=null!=(o=e(n,"selectParams")||(null!=t?e(t,"selectParams"):t))?o:r)==l?o.call(s,{name:"selectParams",hash:{},data:a,loc:{start:{line:6,column:31},end:{line:6,column:47}}}):o)+" from t"+c(typeof(o=null!=(o=e(n,"lefttable")||(null!=t?e(t,"lefttable"):t))?o:r)==l?o.call(s,{name:"lefttable",hash:{},data:a,loc:{start:{line:6,column:54},end:{line:6,column:67}}}):o)+") ,(select "+c(typeof(o=null!=(o=e(n,"rightCols")||(null!=t?e(t,"rightCols"):t))?o:r)==l?o.call(s,{name:"rightCols",hash:{},data:a,loc:{start:{line:6,column:78},end:{line:6,column:91}}}):o)+" from t"+c(typeof(o=null!=(o=e(n,"righttable")||(null!=t?e(t,"righttable"):t))?o:r)==l?o.call(s,{name:"righttable",hash:{},data:a,loc:{start:{line:6,column:98},end:{line:6,column:112}}}):o)+");\n"},6:function(e,t,n,i,a){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(n=(o(n,"eq")||t&&o(t,"eq")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},null!=t?o(t,"joinType"):t,"aj",{name:"eq",hash:{},fn:e.program(7,a,0),inverse:e.program(9,a,0),data:a,loc:{start:{line:8,column:12},end:{line:20,column:19}}}))?n:""},7:function(e,t,n,i,a){var o,s=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,l="function",c=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"                t"+c(typeof(o=null!=(o=e(n,"index")||(null!=t?e(t,"index"):t))?o:r)==l?o.call(s,{name:"index",hash:{},data:a,loc:{start:{line:9,column:17},end:{line:9,column:26}}}):o)+": aj [`k;(select k:"+c(typeof(o=null!=(o=e(n,"leftKey")||(null!=t?e(t,"leftKey"):t))?o:r)==l?o.call(s,{name:"leftKey",hash:{},data:a,loc:{start:{line:9,column:45},end:{line:9,column:56}}}):o)+", "+c(typeof(o=null!=(o=e(n,"selectParams")||(null!=t?e(t,"selectParams"):t))?o:r)==l?o.call(s,{name:"selectParams",hash:{},data:a,loc:{start:{line:9,column:58},end:{line:9,column:74}}}):o)+" from t"+c(typeof(o=null!=(o=e(n,"lefttable")||(null!=t?e(t,"lefttable"):t))?o:r)==l?o.call(s,{name:"lefttable",hash:{},data:a,loc:{start:{line:9,column:81},end:{line:9,column:94}}}):o)+");(select k:"+c(typeof(o=null!=(o=e(n,"rightKey")||(null!=t?e(t,"rightKey"):t))?o:r)==l?o.call(s,{name:"rightKey",hash:{},data:a,loc:{start:{line:9,column:106},end:{line:9,column:118}}}):o)+", "+c(typeof(o=null!=(o=e(n,"rightCols")||(null!=t?e(t,"rightCols"):t))?o:r)==l?o.call(s,{name:"rightCols",hash:{},data:a,loc:{start:{line:9,column:120},end:{line:9,column:133}}}):o)+" from t"+c(typeof(o=null!=(o=e(n,"righttable")||(null!=t?e(t,"righttable"):t))?o:r)==l?o.call(s,{name:"righttable",hash:{},data:a,loc:{start:{line:9,column:140},end:{line:9,column:154}}}):o)+")];\n"},9:function(e,t,n,i,a){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(n=(o(n,"eq")||t&&o(t,"eq")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},null!=t?o(t,"joinType"):t,"upj",{name:"eq",hash:{},fn:e.program(10,a,0),inverse:e.program(12,a,0),data:a,loc:{start:{line:11,column:16},end:{line:19,column:23}}}))?n:""},10:function(e,t,n,i,a){var o,s=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,l="function",c=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"                    t"+c(typeof(o=null!=(o=e(n,"index")||(null!=t?e(t,"index"):t))?o:r)==l?o.call(s,{name:"index",hash:{},data:a,loc:{start:{line:12,column:21},end:{line:12,column:30}}}):o)+": t"+c(typeof(o=null!=(o=e(n,"lefttable")||(null!=t?e(t,"lefttable"):t))?o:r)==l?o.call(s,{name:"lefttable",hash:{},data:a,loc:{start:{line:12,column:33},end:{line:12,column:46}}}):o)+" upsert (select "+c(typeof(o=null!=(o=e(n,"rightCols")||(null!=t?e(t,"rightCols"):t))?o:r)==l?o.call(s,{name:"rightCols",hash:{},data:a,loc:{start:{line:12,column:62},end:{line:12,column:75}}}):o)+" from t"+c(typeof(o=null!=(o=e(n,"righttable")||(null!=t?e(t,"righttable"):t))?o:r)==l?o.call(s,{name:"righttable",hash:{},data:a,loc:{start:{line:12,column:82},end:{line:12,column:96}}}):o)+");\n"},12:function(e,t,n,i,a){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(n=(o(n,"eq")||t&&o(t,"eq")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},null!=t?o(t,"joinType"):t,"pj",{name:"eq",hash:{},fn:e.program(13,a,0),inverse:e.program(15,a,0),data:a,loc:{start:{line:14,column:20},end:{line:18,column:27}}}))?n:""},13:function(e,t,n,i,a){var o,s,r=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,c="function",d=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"                        t"+d(typeof(s=null!=(s=e(n,"index")||(null!=t?e(t,"index"):t))?s:l)==c?s.call(r,{name:"index",hash:{},data:a,loc:{start:{line:15,column:25},end:{line:15,column:34}}}):s)+":(select "+d(typeof(s=null!=(s=e(n,"selectParams")||(null!=t?e(t,"selectParams"):t))?s:l)==c?s.call(r,{name:"selectParams",hash:{},data:a,loc:{start:{line:15,column:43},end:{line:15,column:59}}}):s)+" from t"+d(typeof(s=null!=(s=e(n,"lefttable")||(null!=t?e(t,"lefttable"):t))?s:l)==c?s.call(r,{name:"lefttable",hash:{},data:a,loc:{start:{line:15,column:66},end:{line:15,column:79}}}):s)+") pj "+(null!=(o=typeof(s=null!=(s=e(n,"plusJoin")||(null!=t?e(t,"plusJoin"):t))?s:l)==c?s.call(r,{name:"plusJoin",hash:{},data:a,loc:{start:{line:15,column:84},end:{line:15,column:98}}}):s)?o:"")+" xkey t"+d(typeof(s=null!=(s=e(n,"righttable")||(null!=t?e(t,"righttable"):t))?s:l)==c?s.call(r,{name:"righttable",hash:{},data:a,loc:{start:{line:15,column:105},end:{line:15,column:119}}}):s)+";\n"},15:function(e,t,n,i,a){var o,s=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,l="function",c=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"                        t"+c(typeof(o=null!=(o=e(n,"index")||(null!=t?e(t,"index"):t))?o:r)==l?o.call(s,{name:"index",hash:{},data:a,loc:{start:{line:17,column:25},end:{line:17,column:34}}}):o)+":(select k:"+c(typeof(o=null!=(o=e(n,"leftKey")||(null!=t?e(t,"leftKey"):t))?o:r)==l?o.call(s,{name:"leftKey",hash:{},data:a,loc:{start:{line:17,column:45},end:{line:17,column:56}}}):o)+", "+c(typeof(o=null!=(o=e(n,"selectParams")||(null!=t?e(t,"selectParams"):t))?o:r)==l?o.call(s,{name:"selectParams",hash:{},data:a,loc:{start:{line:17,column:58},end:{line:17,column:74}}}):o)+" from t"+c(typeof(o=null!=(o=e(n,"lefttable")||(null!=t?e(t,"lefttable"):t))?o:r)==l?o.call(s,{name:"lefttable",hash:{},data:a,loc:{start:{line:17,column:81},end:{line:17,column:94}}}):o)+" ) "+c(typeof(o=null!=(o=e(n,"joinType")||(null!=t?e(t,"joinType"):t))?o:r)==l?o.call(s,{name:"joinType",hash:{},data:a,loc:{start:{line:17,column:97},end:{line:17,column:109}}}):o)+" (`k xkey select k:"+c(typeof(o=null!=(o=e(n,"rightKey")||(null!=t?e(t,"rightKey"):t))?o:r)==l?o.call(s,{name:"rightKey",hash:{},data:a,loc:{start:{line:17,column:128},end:{line:17,column:140}}}):o)+", "+c(typeof(o=null!=(o=e(n,"rightCols")||(null!=t?e(t,"rightCols"):t))?o:r)==l?o.call(s,{name:"rightCols",hash:{},data:a,loc:{start:{line:17,column:142},end:{line:17,column:155}}}):o)+" from t"+c(typeof(o=null!=(o=e(n,"righttable")||(null!=t?e(t,"righttable"):t))?o:r)==l?o.call(s,{name:"righttable",hash:{},data:a,loc:{start:{line:17,column:162},end:{line:17,column:176}}}):o)+");\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(n=(o(n,"eq")||t&&o(t,"eq")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},null!=t?o(t,"joinType"):t,"ej",{name:"eq",hash:{},fn:e.program(1,a,0),inverse:e.program(3,a,0),data:a,loc:{start:{line:1,column:0},end:{line:22,column:7}}}))?n:""},useData:!0}),P.updateDialog=e.template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){return'\n\n<div class="update-table">\n    <div class="transformUpdateNewRow"> update field  </div>\n    <div class="transformUpdate">\n        <div class="updaterColumnsList"></div>\n    </div>\n</div>\n<div class="where-table"></div>'},useData:!0}),P.updateRow=e.template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var o,s=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,l="function",c=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="updaterRow" id ="updaterRow-'+c(typeof(o=null!=(o=e(n,"id")||(null!=t?e(t,"id"):t))?o:r)==l?o.call(s,{name:"id",hash:{},data:a,loc:{start:{line:1,column:40},end:{line:1,column:46}}}):o)+'" data-id="'+c(typeof(o=null!=(o=e(n,"id")||(null!=t?e(t,"id"):t))?o:r)==l?o.call(s,{name:"id",hash:{},data:a,loc:{start:{line:1,column:57},end:{line:1,column:63}}}):o)+'">\n    <div class="col1">\n        <input class="updaterCheckbox" type="checkbox" checked/>\n\n        <select class="updaterColumnDDL"> </select>\n    </div>\n    <div class="col2">\n        <span class="updateText" >set:</span>\n\n\n        <div class="updaterColumSelection">&nbsp;</div>\n        <div class="updaterTrash">&nbsp;</div>\n    </div>\n</div>'},useData:!0});var S=P;function P(){}e.registerHelper("type-cast",function(e){return e.toLowerCase()});ie=l.View,a(k,ie),k.prototype.addParam=function(e,t,n,i,a,o,s){var r=this,e=new l.Model({id:_.uniqueId("param_"),name:e,type:t,value:n,required:i,description:a,editable:!0,isViewState:s}),t=(this.listenTo(e,"change",function(){return r.updateValue()}),new k(e,this.dataModel,this.docViewModel,this.vsCallback,this.save,this.useViewStates,[]));this.listenTo(t,"paramRemoved",this.onParamRemoved.bind(this)),this.listenTo(t,"ValueChanged",function(){return r.updateValue()}),t.$el.appendTo(this.$listItems),this.parameters.push(t),o||this.updateValue()},k.prototype.initializeEvents=function(){var e=this;this.listenTo(this.model,"change:type",this.onTypeChanged.bind(this)),this.listenTo(this.model,"change:name",function(){e.updateValue()}),this.$viewStateApply.on("click",this.showViewStateDialog.bind(this)),this.$bindingApply.on("click",this.showBindingsDropdown.bind(this)),this.$viewStateDisplay.on("click",this.showViewStateDialog.bind(this)),this.$viewStateClear.on("click",this.onViewStateClear.bind(this)),this.$generateValue.on("click",this.generateViewState.bind(this)),this.$bindingClear.on("click",this.onBindingClear.bind(this)),this.$typeSelect.on("change",this.onTypeChange.bind(this)),this.$nameInput.on("change",this.onNameChange.bind(this))},k.prototype.applyControlState=function(){this.model.get("isViewState")?this.$form.addClass("is-bound"):this.$form.removeClass("is-bound")},k.prototype.disableListEditing=function(){this.$buttonRow.hide(),this.$listItems.hide()},k.prototype.enableListEditing=function(){"dict"===this.model.get("type")&&(this.$buttonRow.show(),this.$listItems.show())},k.prototype.getPath=function(){var e=this.dataModel.path;return e.substring(e.lastIndexOf("/")+1)+"/"+this.model.get("name")},k.prototype.getInputValue=function(){var e=this.valueInput.getValue()||"";return _.isString(e)?e.replace("&lt;","<").replace("&gt;",">"):e},k.prototype.generateViewState=function(){var n,i=this,a=this.docViewModel,o=(this.viewStateName=this.getPath(),this.viewStateName.split("/")||[]);return o.forEach(function(e,t){t===o.length-1?(a.has(e)||(n=new d.DocumentViewModel({_viewType:!0,_type:i.model.get("type").toLowerCase(),_default:i.model.get("value"),value:i.model.get("value")},null),a.set(e,n)),i.selectGeneratedViewState(i.viewStateName)):(a.has(e)||(t=new d.DocumentViewModel({},null),a.set(e,t)),a=a.getByPath(e))}),n},k.prototype.onAddItemClicked=function(){this.addParam("parameter0","symbol","",!1,"")},k.prototype.onNameChange=function(){var e=this.$nameInput.val();this.model.set({name:e})},k.prototype.onParamRemoved=function(e){this.parameters=_.without(this.parameters,e),this.updateValue()},k.prototype.onSelectViewState=function(e){var t=this.docViewModel.getByPath(e);t?t&&t.has("_type")&&(this.model.set("type",t.get("_type")),this.model.set("isViewState",!0),this.model.set("value","<%"+e+"%>"),this.$viewStateInput.val(e),this.$viewStateDisplay.val(e),this.applyControlState(),this.disableListEditing(),this.trigger("ValueChanged"),this.save()):this.onViewStateClear()},k.prototype.onTypeChange=function(){var e=this.$typeSelect.val();"dict"===e?this.model.set({value:{},type:e}):this.model.set({type:e}),this.save()},k.prototype.onTypeChanged=function(){var e,t,n=this,i=this.model.get("type");_.each(this.parameters,function(e){e.remove()}),this.parameters=[],this.$el.attr("data-type",i),this.$typeSelect.val(i).trigger("change"),"dict"===i?(this.enableListEditing(),this.removeValueInput(),this.$bindingApply.hide(),"string"==typeof(i=this.model.get("value")||this.originalValue)?(e=i.split(""),_.each(e,function(e){6===(t=e.split("")).length&&n.addParam(t[0],t[1],t[2],t[3],t[4],!1)})):"object"==typeof i&&_.each(i,function(t){try{n.addParam(t.name,t.type,t.value,!1,"",void 0,!!_.isString(t.value)&&0===t.value.indexOf("<%"))}catch(e){console.error("Param error ",t)}})):(this.disableListEditing(),this.renderInput()),this.trigger("ValueChanged")},k.prototype.onViewStateClear=function(){this.model.set("isViewState",!1),this.model.set("value",null),this.$viewStateInput.val(""),this.applyControlState(),this.$generateValue.removeClass("disabled"),this.enableListEditing(),this.trigger("ValueChanged"),this.save()},k.prototype.onBindingClear=function(){this.model.set("isViewState",!1),this.model.set("value",""),this.$viewStateInput.val(""),this.applyControlState(),this.$generateValue.removeClass("disabled"),this.$bindingApply.show(),this.$valueInput.show(),this.$typeSelect.prop("disabled",!1),this.enableListEditing(),this.trigger("ValueChanged"),this.save()},k.prototype.onValueInput=function(){this.model.set({value:this.getInputValue(),isViewState:!1}),this.trigger("ValueChanged"),this.save()},k.prototype.remove=function(){return _.each(this.parameters,function(e){e.remove()}),this.parameters=[],this.trigger("paramRemoved",this),l.View.prototype.remove.apply(this)},k.prototype.removeValueInput=function(){this.valueInput&&(this.stopListening(this.valueInput),this.valueInput.remove(),this.valueInput=null)},k.prototype.renderInput=function(){var e,t=this,n=(this.removeValueInput(),this.$valueInput.empty(),this.model.get("type"));n&&(n=r.RTTI.getByName(n),e=r.editors[n.editor.type],this.valueInput=new e({id:_.uniqueId("valueInput_"),key:"value",model:this.model,schema:{editorClass:"data-parameter-editor",options:n.editor.options,validators:n.editor.validators}}).render(),this.$valueInput.append(this.valueInput.el),this.model.get("isViewState")||this.model.get("value")===this.getInputValue()||this.onValueInput()),this.listenTo(this.valueInput,"change changeList",function(){var e=t.valueInput.validate();e?t.setError(e.message):(t.setError(null),t.onValueInput())})},k.prototype.selectGeneratedViewState=function(e){this.onSelectViewState(e),this.$generateValue.addClass("disabled")},k.prototype.setError=function(e){e&&this.valueInput?(this.valueInput.$el.addClass("error"),this.$errorTooltip&&r.ErrorTooltip.clear(this.$errorTooltip),this.$errorTooltip=r.ErrorTooltip.show(e,this.$valueInput)):(this.valueInput.$el.removeClass("error"),r.ErrorTooltip.clear(this.$errorTooltip))},k.prototype.showViewStateDialog=function(){var t=this;this.vsCallback({beforeClose:function(){},close:function(){},cancelCallback:function(){},path:this.$viewStateInput.val(),selectCallback:function(e){return t.onSelectViewState(e)}})},k.prototype.showBindingsDropdown=function(e,t){this.$valueInput.hide(),this.$bindingApply.hide(),this.model.set("isViewState",!0),this.applyControlState(),this.vsCallback(this,e,t)},k.prototype.updateValue=function(e){var t;"dict"===this.model.get("type")&&(t={},_.each(this.parameters,function(e){t[e.model.get("name")]={type:e.model.get("type"),IsKdbParam:!0,isViewState:e.model.get("isViewState"),name:e.model.get("name"),value:e.model.get("value")}}),this.model.set({value:t},{silent:e})),e||this.trigger("ValueChanged"),console.log("update value:",this.model.get("value"))};var ie,ae=k;function k(e,t,n,i,a,o,s){void 0===o&&(o=!1);var r=ie.call(this,{className:"data-parameter",model:e})||this;return r.parameters=[],r.viewStateName="",r.originalValue=r.model.get("value"),r.useViewStates=o,r.model.set({type:r.model.get("type").toLowerCase()},{silent:!0}),r.model=e,r.docViewModel=n,r.dataModel=t,r.vsCallback=i,r.save=a,r.$el.html(S.dataParameter(r.model.toJSON())),r.$form=r.$(".form-control"),r.$viewStateApply=r.$(".viewstate-apply"),r.$bindingApply=r.$(".binding-apply-dialog"),r.$bindingSelect=r.$(".binding-select"),r.$bindingDropdown=r.$(".binding-dropdown"),r.$viewStateClear=r.$(".binding-clear"),r.$bindingClear=r.$(".binding-clear-dialog"),r.$viewStateContainer=r.$(".binding-container"),r.$viewStateInput=r.$("input:not(.name-input)").attr("type","text"),r.$viewStateDisplay=r.$(".value-display"),r.$valueInput=r.$(".value-input"),r.$generateValue=r.$(".generate-value"),r.$typeSelect=r.$(".type-select"),r.$typeSelect.val(r.model.get("type")),r.$addItemBtn=r.$(".add-item-btn"),r.$listItems=r.$(".list-items"),r.$buttonRow=r.$(".button-row"),r.$nameInput=r.$(".name-input"),r.$removeItemBtn=r.$(".remove-item-btn"),r.$addItemBtn.button({icons:{primary:"fa fa-plus"},text:!1}).click(r.onAddItemClicked.bind(r)),0<r.$removeItemBtn.length&&r.$removeItemBtn.button({icons:{primary:"fa fa-minus"},text:!1}).click(r.remove.bind(r)),s.length&&r.$typeSelect.find("option").filter(function(e,t){return!_.includes(s,t.text)}).remove(),r.$typeSelect.select2({theme:"dashboards",width:"100%"}),r.$bindingSelect.select2({theme:"dashboards",width:"100%"}),r.useViewStates&&r.model.get("isViewState")&&r.model.get("value")?r.onSelectViewState(r.model.get("value").split("%")[1]):"dict"!==r.model.get("type")&&r.valueInput&&r.valueInput.setValue(r.model.get("value")),r.onTypeChanged(),_.defer(function(){r.initializeEvents()}),r}oe=l.View,a(D,oe),D.prototype.remove=function(){return this.$el.off(),l.View.prototype.remove.call(this)},D.prototype.addDataParameter=function(e,t){t=_.isEmpty(t)||t.type!==this.model.get("type")?_.reduce(this.model.attributes,function(e,t,n){return _.includes(["parameters","operator"],n)||(e[n]=t),e},{}):t,"long"===t.type&&_.isNil(t.value)&&(t.value=(new Date).getFullYear()),t=new ae(new l.Model(_.extend({},t)),this.dataModel,this.docViewModel,this.vsCallback,this.save,this.useViewStates,[]);this.parameters.push(t),e?(t.$el.find(".col1").text(e).show(),t.$el.find(".col3").addClass("has-label")):(t.$el.find(".col1").hide(),t.$el.find(".col3").removeClass("has-label")),this.$dataParams.append(t.$el)},D.prototype.clearDataParameters=function(){this.parameters=[],this.$dataParams.empty()},D.prototype.onOperatorChange=function(e){var t=this.parameters;switch(this.operator=e.target.value,this.clearDataParameters(),this.operator){case"in":this.model.set("type","list"),this.addDataParameter("",t&&t[0]);break;case"within":this.model.set("type",this.type),this.addDataParameter("Min:",t&&t[0]),this.addDataParameter("Max:",t&&t[1]);break;default:this.model.set("type",this.type),this.addDataParameter("",t&&t[0])}this.save()};var oe,se=D;function D(e,t,n,i,a,o){void 0===o&&(o=!1);var s=oe.call(this,{model:e})||this;return s.parameters=[],s.operator="",s.dataModel=t,s.docViewModel=n,s.vsCallback=i,s.save=a,s.useViewStates=o,s.type=e.get("type"),s.name=e.get("name"),s.operator=e.get("operator"),s.parameters=e.get("parameters"),s.$el.addClass("partition-view"),s.$el.html(S.partitionView({})),s.$dataParams=s.$el.find(".data-parameter-container"),s.$operatorSelect=s.$el.find(".operator-select"),s.$operatorSelect.select2({theme:"dashboards",width:"100%"}),s.$operatorSelect.on("change",s.onOperatorChange.bind(s)),s.$operatorSelect.val(s.operator||"equals").trigger("change"),s}re=l.View,a(x,re),x.prototype.createAccordion=function(e){this.$el.addClass("accordion"),this.accordion=new j.AccordionView({el:this.$el[0],sections:_.map(e,function(e){return{$el:e.$el,viewModel:new l.Model(_.extend({align:"left",order:0},_.omit(e,["$el"])))}})})},x.prototype.createDataFilter=function(e){var i=this,t=_.noop.bind(this),a=this.filterSettings,n=this.dfId;this.dataFilter=new J({viewModel:new d.DocumentViewModel({},{}),settingsModel:a,dashboardAppModel:this.host.dashboardAppModel,el:e,deltaClient:null,api:{getProperty:function(e){return a.get(e)},getPropertyMeta:function(e){return a.get(e)},setProperty:function(e,t){var n={};a.set(e,t),n[e]=t,i.dataFilter&&i.dataFilter.onSettingsChange(n),"Basics.kdbString"===e&&i.$sideDialog&&i.save()},renderViewStateDialog:this.host.renderViewStateDialog.bind(this),hideErrorMessage:t,showErrorMessage:t,showQueryStatus:t,hideQueryStatus:t,subscribe:function(e,t){e.subscribe(n,{key:n,onData:t,source:e})},unsubscribe:function(e){e.unsubscribe(n)},loadSetting:t,saveSetting:t}}),this.dataFilter.onSettingsChange(a.attributes)},x.prototype.initializeDataFilter=function(){this.dfId=_.uniqueId("popup-df"),this.filterSettings=new l.DeepModel(_.extend({},J.getComponentDefinition({settingsModel:new l.DeepModel}).appArgs.json))},x.prototype.initialSave=function(){_.isEmpty(this.node.data)&&this.save()},x.prototype.onResize=function(){this.accordion&&this.accordion.resize(),this.dataFilter&&this.dataFilter.onResize()},x.prototype.remove=function(){return this.$el.dialog&&this.$el.hasClass("ui-dialog-content")&&this.$el.dialog("destroy"),this.aggView&&this.aggView.remove(),this.selectView&&this.selectView.remove(),this.dataFilter&&(this.dataFilter.remove(),delete this.dataFilter),l.View.prototype.remove.call(this)},x.prototype.removeVSChars=function(e){return _.isString(e)?e.replace(p.VSRx,function(e){return e.substring(2,e.length-2)}):e},x.prototype.renderDialog=function(e,t,n,i,a,o,s){this.$sideDialog?this.renderSideDialog(i,n,s):this.renderPopupDialog(o,e,t,n,i,a)},x.prototype.renderFilter=function(e){var t=new d.DocumentDataModel({_dataType:"copy",_dataSource:"kdb",_maxRows:2e3,_subscriptionType:"static",_pageSize:2e3,_serverPaging:!1},null,"",null);t.apply(),this.filterSettings.set({"Basics.data":t,"Basics.UseViewStates":this.host.api.getProperty("Basics.UseViewStates"),Bindings:this.host.api.getProperty("Bindings")}),this.createDataFilter(e),t.onExecuteSuccess({class:"203",columns:_.keys(this.parent.meta),meta:this.parent.meta,rows:[]},!0)},x.prototype.renderFromParentMeta=function(e,t){t=t||this.parent;t&&!t.meta?this.host.updateMeta(t,e.bind(this)):t&&e(t.meta)},x.prototype.renderPopupDialog=function(e,n,i,a,o,s){var r=this;this.$el.dialog({dialogClass:e,height:n,width:i,modal:!0,autoOpen:!0,title:this.node.teaser(),buttons:[{text:t(this.node.id?"Apply":"Create"),click:function(){a(),r.$el.dialog("close")},icons:{primary:"fa fa-save"}},{text:t("Cancel"),click:function(){r.$el.dialog("close")},icons:{primary:"fa fa-times"}}],open:function(){$('<i class="dialog-icon">'+r.node.icon()+"</i>").insertBefore(r.$el.parent().find(".ui-dialog-title")),o()},close:function(){return r.host.onCloseDialog()},resize:s})},x.prototype.renderSideDialog=function(e,t,n){var i;n&&((i=document.createElement("div")).className=n,i.append(this.$el[0])),this.host.renderSideDialog(n?$(i):this.$el,this.node,t,e)},x.prototype.save=function(){this.$sideDialog&&this.host.api.getProperty("Basics.AutoSave")&&this.saveClickHandler()},x.prototype.saveClickHandler=function(){},x.prototype.setNode=function(e){this.node=e||this.node},x.PROP_QUERYMODEL="Basics.queryModel";var re,e=x;function x(e,t,n,i,a){var o=re.call(this)||this;return o.host=e,o.node=t,o.parent=n&&0<n.length?n[0]:void 0,o.parents=n,o.callback=i,o.$sideDialog=a,o}a(O,le=e),O.prototype.onResize=function(){this.accordion.sections[1].viewModel.get("isExpanded")&&this.setAccordionWeights(!0),le.prototype.onResize.call(this)},O.prototype.saveClickHandler=function(){_.debounce(this.saveClick.bind(this),300)()},O.prototype.createJsTreeJSON=function(e,t,n){return this.getJsTreeJSON(e,t,{selected:e===this.selectedDatasource},[],n)},O.prototype.getAccordionWeights=function(e){var t=1,n=1,i=this.$el.find(".form-control").height()||1,a=this.$el.height()||1;return(e&&_.every(this.selectedParams,function(e){return"dict"!==e.type})||!_.isEmpty(this.selectedPartition))&&(e=45/a,i=i/a,t=1-(n=(this.selectedParams.length||(this.selectedPartition instanceof se?this.selectedPartition.model.get("parameters")?this.selectedPartition.model.get("parameters").length:1:this.selectedPartition.parameters?this.selectedPartition.parameters.length:1))*i+e)),[t,n]},O.prototype.getJsTreeJSON=function(e,t,n,i,a){return{id:e,text:t,state:n,children:i,type:a}},O.prototype.hideError=function(){this.$el.find(".data-error").hide()},O.prototype.initParameters=function(e){var t,n=e&&"analytic"===e.type&&0===e.children.length,i=e&&"partition"===e.type,e=e&&"streaming"===e.type;n?(t=this.updateSourceObject(this.analytics,"parameters",this.selectedParams,function(e,t){return _.isEqual(e.parameters.map(function(e){return e.name}),t.map(function(e){return e.name}))}.bind(this)),this.loadSelectedParameters(t)):i?(t=this.updateSourceObject(this.partitions,"partition",this.selectedPartition,function(e,t){return e.name===t.name}.bind(this)),this.loadSelectedPartition(t)):e?(t=this.updateSourceObject(this.streams,"parameters",this.selectedParams,function(e,t){return _.isEqual(e.parameters.map(function(e){return e.name}),t.map(function(e){return e.name}))}.bind(this)),this.loadSelectedParameters(t)):(this.selectedParams=[],this.selectedPartition={}),this.toggleParamsView(i||(n||e)&&0<this.selectedParams.length)},O.prototype.jstreeSearch=function(e){this.$tree.jstree("show_all"),this.$tree.jstree().search(e)},O.prototype.loadSelectedParameters=function(n){var i=this;this.setParamHTML("","Parameters"),this.selectedParams=[],this.selectedPartition={},_.each(n.parameters,function(e){var t=new ae(new l.Model(_.extend({},e)),i.host.docDataModel,i.host.docViewModel,i.vsCallback.bind(i),i.save.bind(i),i.host.api.getProperty("Basics.UseViewStates"),"streaming"===n.type?["symbol","list"]:[]);i.showBindingsDropdown(e,t),i.$el.find(".paramList").append(t.$el),i.selectedParams.push(t.model.attributes)}),this.save()},O.prototype.loadSelectedPartition=function(e){e=new se(new l.Model(_.extend({},e.partition)),this.host.docDataModel,this.host.docViewModel,this.vsCallback.bind(this),this.save.bind(this),this.host.api.getProperty("Basics.UseViewStates"));this.setParamHTML(e.el,"Partition ("+("long"===e.model.get("type")?"year":e.model.get("type"))+")"),this.showBindingsDropdown(this.selectedPartition,e),this.selectedPartition=e,this.selectedParams=[]},O.prototype.renderSources=function(e,t,n){function i(e,t){return e[t.name]=t,e}var a=_.reduce(n,i,{}),o=_.reduce(t,i,{}),t=(this.analytics=_.union(this.analytics,t),this.partitions=_.filter(n,function(e){return"partition"===e.type}),_.extend(e,a,o));this.renderTree(t)},O.prototype.renderTree=function(e){var c=this,d=[];_.each(e,function(e,t){var a,n,o,s,r,l,i;e.type?(a=e.type,n=t,o=_.filter(n.split("."),function(e){return""!==e}),s=1===o.length&&n==="."+o[0],r=1<o.length||s?".":"",l=d,_.each(o,function(e,t){var n=r+e,i=_.find(l,function(e){return e.id===n});l=i?i.children:(i={id:n,text:(t!==o.length-1||s?".":"")+e,state:{selected:n===c.selectedDatasource},children:[],type:t===o.length-1?a:"namespace"},l.push(i),i.children),r=n+"."})):(i=d.push(c.createJsTreeJSON(t,t,e instanceof Array?"namespace":e.streaming?"streaming":"analytic")),e instanceof Array&&_.each(e,function(e){d[i-1].children.push(c.createJsTreeJSON(e.name,e.name,e.streaming?"streaming":"analytic"))}))}),this.$tree.jstree({core:{data:this.sortTreeData(d),multiple:!1},conditionalselect:function(e){return 0===e.children.length},types:{table:{icon:"fa fa-table"},partition:{icon:"fa fa-table"},analytic:{icon:"fa fa-line-chart"},namespace:{icon:"fa fa-folder"},streaming:{icon:this.host.isLite?"fa fa-table streaming-icon":"fa fa-line-chart streaming-icon"}},search:{show_only_matches:!0,show_only_matches_children:!0},plugins:["conditionalselect","types","search","wholerow"]}),this.$tree.on("select_node.jstree",function(e,t){c.selectedDatasource=t.node.id,c.showScrollBars(!1),c.initParameters(t.node),c.save()}),this.$tree.on("deselect_node.jstree",function(){c.selectedDatasource="",c.initParameters(),c.save()}),this.$tree.on("search.jstree",function(e,t){0===t.nodes.length&&c.$tree.jstree("hide_all")}),this.$tree.one("ready.jstree",function(){var e;_.isString(c.selectedDatasource)&&(e=c.selectedDatasource.replace(/\./g,"\\."),(e=c.$tree.find("#"+e)[0])&&(c.$tree[0].scrollTop=e.offsetTop-c.$tree[0].offsetTop,c.initParameters(c.$tree.jstree().get_selected(!0)[0])))})},O.prototype.renderWithQStructures=function(i){var a=this;this.host.runAnalytic(".queryBuilder.getTables",null,1e3,function(e){a.hideError();var t,n=e.rows.map(function(e){return e.partition?(e.type="partition",e.partition={type:"year"===e.partition?"long":e.partition,name:e.name}):e.streaming?(e.type="streaming",e.parameters=[{name:"x",type:"Symbol"}],a.streams.push(e)):e.type="table",e});a.host.isLite?a.host.runAnalytic(t=".queryBuilder.getFunctions",null,1e3,function(e){e=_.map(a.parent?_.filter(e.rows,function(e){return 0<e.parameters.rows.length}):e.rows,function(e){return e.parameters=a.parent?e.parameters.rows.slice(1):e.parameters.rows,e.type="analytic",e});a.renderSources({},e,n)},function(){console.log("Failed to execute "+t),a.renderTree(i)}):a.renderSources(i,[],n)},function(){console.log("Failed to execute .queryBuilder.getTables"),a.showError(a.host.isLite?'Please run "\\l querybuilder.q" to load query builder on this connection':"No data sources loaded; query builder may not be properly configured on this connection"),a.renderTree({})})},O.prototype.runTreeQuery=function(){var i=this;this.host.isLite?this.renderWithQStructures({}):d.DeltaClientLib.getDeltaAnalytics(function(e){i.analytics=_.map(i.parent?_.filter(e,function(e){return 0<e.parameters.length}):e,function(e){return e.parameters=i.parent?e.parameters.slice(1):e.parameters,e});e=_.reduce(i.analytics,function(t,e){var n={name:e.name,streaming:e.streaming};return e.streaming&&i.streams.push(e),0<e.groups.length?_.each(e.groups,function(e){t[e]||(t[e]=[]),t[e].push(n)}):t[e.name]=n,t},{});i.renderWithQStructures(e)})},O.prototype.saveClick=function(){var e,t=this;0<this.selectedParams.length?this.node.data={name:this.selectedDatasource,params:this.selectedParams}:_.isEmpty(this.selectedPartition)?this.node.data=this.selectedDatasource:(e={name:this.selectedPartition.name,operator:this.selectedPartition.operator,type:this.selectedPartition.type,parameters:this.selectedPartition.parameters.map(function(e){return e.model.attributes})},this.node.data={name:this.selectedDatasource,partition:e}),_.isEmpty(this.selectedDatasource)||(_.some(this.streams,function(e){return e.name===t.selectedDatasource})?this.node.group="stream":_.some(this.analytics,function(e){return e.name===t.selectedDatasource})?this.node.group="function":this.node.group="data"),this.host.refreshSideDialogHeader(this.node),this.callback&&this.callback(this.node)},O.prototype.setAccordionWeights=function(e){var n=this,e=this.getAccordionWeights(e);_.each(e,function(e,t){return n.accordion.sections[t].viewModel.set("weight",e)})},O.prototype.setParamHTML=function(e,t){this.$el.find(".paramList").html(e),this.$el.find(".paramTitle").html(t)},O.prototype.setParamValue=function(e,t,n){e.$bindingSelect.val(t).trigger("change"),e.model.set({value:_.isEmpty(n)?t:n}),this.save()},O.prototype.showAllDropdowns=function(a,e){var o=this;_.each(e,function(t,e){var n,i="";"string"==typeof a.value?(n=a.value.split(""),i=(n=_.find(_.map(n,function(e){return e.split("")}),function(e){return e[0]===t.model.get("name")}))&&n[2]?n[2]:""):a.value?i=a.value[t.model.get("name")]:a.parameters&&(i=a.parameters[e].value),o.showBindingsDropdown(i,t)})},O.prototype.showBindingsDropdown=function(e,t){var n=e.value||e;0===this.host.api.getProperty("Bindings").length?this.host.api.getProperty("Basics.UseViewStates")?(t.$el.find(".binding-dropdown").hide(),t.$el.find(".binding-clear-dialog").hide()):t.$el.find(".binding-container").hide():t instanceof ae&&_.isString(n)&&p.VSRx.test(n)?t.showBindingsDropdown(void 0,n):0<t.parameters.length&&this.showAllDropdowns(e,t.parameters)},O.prototype.showError=function(e){var t=this.$el.find(".data-error");t.find("span").text(e),t.show()},O.prototype.showScrollBars=function(e){this.$paramsView.find(".paramList").toggleClass("hide-scrollbar",!e)},O.prototype.sortTreeData=function(e){function t(e,t){return e.children.length&&!t.children.length?-1:t.children.length&&!e.children.length?1:e.type===t.type?e.id.localeCompare(t.id):"analytic"===e.type||"analytic"!==t.type&&"streaming"===e.type?-1:1}function n(e){return _.each(e,function(e){e.children.length&&n(e.children)}),e.sort(t)}return n(e)},O.prototype.toggleParamsView=function(e){this.accordion.sections[1].viewModel.set("isExpanded",e),this.setAccordionWeights(e),this.debouncedShowScrollBars(!0)},O.prototype.updateSourceObject=function(e,t,n,i){var a,e=_.find(e,{name:this.selectedDatasource});(a={name:this.selectedDatasource})[t]=n;return e?i(e,n)&&(n=n instanceof se?n.model.attributes:n,e=_.extend(e,((i={name:this.selectedDatasource})[t]=n,i))):e=a,e},O.prototype.vsCallback=function(t,e,n){var i,a=this;this.host.api.getProperty("Basics.UseViewStates")?this.host.renderViewStateDialog(t):(i=t.model.get("type"),t.$bindingSelect.empty().trigger("change"),i=this.host.getAllMatchingBindings(i),_.each(i,function(e){e=new Option(e.Key);t.$bindingSelect.append(e).trigger("change")}),t.$bindingSelect.on("select2:select",_.bind(function(e){t.model.set({value:"<%"+e.params.data.text+"%>"}),a.save()},t)),_.isUndefined(n)?0<i.length&&this.setParamValue(t,i[0].Key,"<%"+i[0].Key+"%>"):this.setParamValue(t,this.removeVSChars(n),n))};var le,C=O;function O(e,t,n,i,a){var o=le.call(this,e,t,n?[n]:void 0,i,a)||this,e=(o.streams=[],o.selectedDatasource="",o.selectedParams=[],o.partitions=[],o.$el.html(S.dataDialog({})),o.$paramsView=o.$el.find(".paramsView"),o.$treeView=o.$el.find(".treeView"),o.$tree=o.$el.find(".tree"),o.$search=o.$el.find(".searchBox"),o.$clearSearch=o.$el.find(".clearSearch"),null!==t.data&&(o.selectedDatasource=o.node.data.name||o.node.data||"",o.selectedParams=o.node.data.params||[],o.selectedPartition=o.node.data.partition||{}),o.debouncedShowScrollBars=_.debounce(o.showScrollBars.bind(o),300),o.host.api.getProperty("Basics.UseViewStates")?" qb-use-viewstates":0<o.host.api.getProperty("Bindings").length?" qb-use-bindings":" qb-no-bindings"),s=(o.renderDialog(450,700,o.saveClick.bind(o),function(){var e=o.getAccordionWeights(0<o.selectedParams.length);o.createAccordion([{$el:o.$treeView,heading:"Data sources",hideHeader:!0,isExpanded:!0,isResizeable:!0,weight:e[0]},{$el:o.$paramsView,heading:"Parameters",hideHeader:!0,isExpanded:0<o.selectedParams.length,weight:e[1]}]),o.runTreeQuery(),setTimeout(function(){o.$tree.children().length||o.showError("No data sources loaded; check that the connection's process is running")},1e3)}.bind(o),function(){o.accordion&&o.accordion.resize()},"qb-data-dialog"+e,"qb-data-dialog"+e),_.debounce(o.jstreeSearch.bind(o),250));return o.$search.keyup(function(e){e=e.target.value;o.$clearSearch.toggle(""!==e),s(e)}),o.$clearSearch.click(function(){o.$search.val("").trigger("keyup")}),o.initialSave(),o}ce=l.View,a(E,ce),E.prototype.disable=function(e){this.$input.prop("disabled",e)},E.prototype.remove=function(){return this.$el.off(),l.View.prototype.remove.call(this)};var ce,N,de=E;function E(e,t){e=ce.call(this,{el:e})||this;return e.$el.addClass("text-input"),e.$el.html(S.textInput({value:t})),e.$input=e.$el.find(".value-input"),e}var ue=function(e,t,n){this.cast=e,this.checkbox=t,this.num=n},pe=(R.prototype.check=function(e){var t;this.checkbox.checked=e,this.nameOut.disable(!e),this.xbar&&(t=this.xbar.checkbox.checked,this.xbar.cast&&(this.xbar.cast.disabled=!e||!t),this.xbar.checkbox.disabled=!e,this.xbar.num.disabled=!e||!t),this.userInput.style.display=e?"block":"none"},R.prototype.isChecked=function(){return!!this.checkbox.checked},R.prototype.nameOutVal=function(){var e=this.nameOut.el;return $(e).hasClass("useBinding")?"<%"+$(e).find(".binding-select").val()+"%>":$(e).hasClass("useViewState")?"<%"+$(e).find(".viewstate-display").val()+"%>":$(e).find("input[type=text]").val()},R.prototype.value=function(){var e;return this.xbar&&this.xbar.checkbox.checked?{col:this.col,cast:(null==(e=this.xbar.cast)?void 0:e.value)||"",num:this.xbar.num.value}:this.col},R.prototype.onChecked=function(){this.check(this.isChecked()),this.changeCallback()},R.prototype.onXBarChecked=function(){var e;this.xbar&&(e=this.xbar.checkbox.checked,this.xbar.num.disabled=!e,this.xbar.cast&&(this.xbar.cast.disabled=!e)),this.changeCallback()},R.SUBTYPES=((N={})[d.ipc.TypeNum.Timestamp]=R.DATETIME_SUBTYPES=["year","month","date","minute","second","mm","dd","hh","uu","ss"],N[d.ipc.TypeNum.Date]=["year","month","mm","dd"],N[d.ipc.TypeNum.DateTime]=R.DATETIME_SUBTYPES,N[d.ipc.TypeNum.Timespan]=R.DATETIME_SUBTYPES,N[d.ipc.TypeNum.Time]=["minute","second","hh","uu","ss"],N),R);function R(e,t,n,i,a,o,s){this.el=document.createElement("div"),this.el.className="row",this.el.setAttribute("data-id",e),this.col=e,this.changeCallback=i,this.el.innerHTML=S.selectRow({checked:n,nameIn:e,nameOut:t,canXbar:a,xbar:s||{},sub:R.SUBTYPES[o]}),this.userInput=this.el.querySelector(".user-input"),this.nameOut=new de(document.createElement("div"),t),this.userInput.prepend(this.nameOut.el),this.checkbox=this.el.querySelector(".checkbox"),a&&(this.xbar=new ue(this.el.querySelector(".xcast"),this.el.querySelector(".xcheckbox"),this.el.querySelector(".xnum")),this.xbar.checkbox.addEventListener("change",this.onXBarChecked.bind(this))),this.check(this.isChecked()),this.checkbox.addEventListener("change",this.onChecked.bind(this)),this.nameOut.el.addEventListener("change",this.changeCallback)}he=l.View,a(V,he),V.isScalar=function(e){var t=d.ipc.TypeNum;return t.Byte<=e&&e<=t.Char||t.Timestamp<=e&&e<=t.Time},V.prototype.getValue=function(){var i=this,a={};return this.$el.find(".row").each(function(e,t){var n=i.rows.find(function(e){return e.el===t});n&&n.isChecked()&&(a[n.nameOutVal()]=n.value())}),_.every(_.keys(this.meta),function(e){return a[e]===e})?{}:a},V.prototype.remove=function(){return this.$el.off(),this.$search.off(),this.$checkAll.off(),this.$closeIcon.off(),l.View.prototype.remove.call(this)},V.prototype.updateCheckAll=function(){this.$checkAll.prop("checked",_.every(this.rows,function(e){return e.isChecked()}))};var he,fe=V;function V(e,i,t,n,a){var o=he.call(this,{el:e})||this,e=(o.rows=[],o.$el.addClass("select-view"),o.$el.html(S.selectView({})),_.values(t).map(function(e){return _.isString(e)?e:e.col})),s=(o.columns=_.union(e,_.keys(i)),o.meta=i,o.save=n,_.clone(t)),r=(s&&!_.isEmpty(s)||(e=a?_.take(o.columns,1):o.columns,s=_.zipObject(e,e)),Object.keys(s).map(function(e){return{key:e,value:s[e]}}));return o.columns.forEach(function(t){var e=_.find(r,function(e){return t===(_.isString(e.value)?e.value:e.value.col)}),n=e&&!_.isString(e.value)?e.value:void 0;o.rows.push(new pe(t,(null==e?void 0:e.key)||t,!!e,function(){o.updateCheckAll(),o.save()},!!a&&V.isScalar(i[t]),i[t],n))}),o.$search=o.$el.find(".search"),o.$checkAll=o.$el.find(".searchRow > input[type='checkbox']"),o.$closeIcon=o.$el.find(".closeIcon"),o.$closeIcon.css("display","none"),o.$search.on("keyup",function(){var t=o.$search[0].value.toLowerCase();_.each(o.$el.find(".rows").children(),function(e){$(e).toggle(($(e).attr("data-id")||"").toLowerCase().includes(t))}),o.$closeIcon.css("display",t?"":"none")}),o.$checkAll.on("change",function(){var t=o.$checkAll[0].checked;o.rows.forEach(function(e){return e.check(t)}),o.save()}),o.$closeIcon.on("click",function(){o.$search.val(""),o.$closeIcon.css("display","none"),o.$search.trigger("keyup")}),o.$el.find(".rows").append(o.rows.map(function(e){return e.el})).sortable({stop:function(){return o.save()}}).disableSelection(),o.updateCheckAll(),o}a(T,ge=e),T.prototype.saveClickHandler=function(){this.node.data={select:this.selectView?this.selectView.getValue():{},where:JSON.parse(this.filterSettings.get(T.PROP_QUERYMODEL)||"{}"),distinct:this.$el.find(".selectDistinct input").is(":checked")},this.host.refreshSideDialogHeader(this.node),this.callback&&this.callback(this.node)};var ge,me=T;function T(e,t,n,i,a){var o=ge.call(this,e,t,[n],i,a)||this,s=(o.$el.html(S.filterDialog({})),o.$el.find(".select-table")),r=o.$el.find(".where-table");o.initializeDataFilter(),t.data&&t.data.where&&o.filterSettings.set(T.PROP_QUERYMODEL,JSON.stringify(t.data.where,null,2));return o.renderDialog(550,550,o.saveClickHandler.bind(o),function(){o.createAccordion([{$el:s,heading:"Select - Columns",hideHeader:!1,isExpanded:!1,isResizeable:!0,weight:1},{$el:r,heading:"Where - Rows",hideHeader:!1,isExpanded:!0,weight:1}]);o.$el.find(".section:nth-child(1) > .heading").append('<div class="selectDistinct"><label><input type="checkbox"/><span>distinct</span></label></div>'),o.$el.find(".selectDistinct input").prop("checked",o.node.data.distinct),o.$el.find(".selectDistinct").on("click",function(e){e.stopPropagation(),o.save()}),o.renderFromParentMeta(function(t){var e=o.node.data||{};_.isEmpty(e.select)||(e.select=_.pickBy(e.select,function(e){return _.includes(_.keys(t),e)})),o.selectView=new fe(s[0],t,e.select,function(){return o.save()}),o.renderFilter(r)})}.bind(o),o.onResize.bind(o),"filter-dialog","filter-dialog"),o.initialSave(),o}ye=l.View,a(B,ye),B.prototype.getValue=function(){var n=_.map(this.$el.find(".row > .user-input"),function(e){return $(e).hasClass("useBinding")?"<%"+$(e).find(".binding-select").val()+"%>":$(e).hasClass("useViewState")?"<%"+$(e).find(".viewstate-display").val()+"%>":$(e).find("input[type=text]").val()}),i=_.map(this.$el.find(".row > .fn"),function(e){return $(e).val()}),a=_.map(this.$el.find(".row > .col1"),function(e){return $(e).val()}),o=_.map(this.$el.find(".row > .col2"),function(e){return $(e).val()}),s={};return _.each(n,function(e,t){e&&(e=-1!==B.FN2.indexOf(i[t]),s[n[t]]=e?[i[t],a[t],o[t]]:[i[t],a[t]])}),s},B.prototype.remove=function(){return this.$el.off(),l.View.prototype.remove.call(this)},B.FNS=["avg","cor","count","cov","dev","first","last","max","med","min","prd","scov","sdev","sum","svar","var","wavg","wsum"],B.FN2=["cor","cov","scor","scov","wavg","wsum"];var ye,ve=B;function B(e,t,n,i){function a(e,t){function n(){var e=""+a.val(),e=-1!==B.FN2.indexOf(e);s.next(".select2-container").css("display",e?"inline-block":"none"),e?(a.select2({width:"10%",theme:"dashboards"}),o.select2({width:"20%",theme:"dashboards"})):(a.select2({width:"20%",theme:"dashboards"}),o.select2({width:"30%",theme:"dashboards"}))}var e={fn:e&&e[0]||"sum",src:e&&e[1]||t,aux:e&&e[2]||null},i=$(S.aggregateRow(e)),a=i.find(".fn"),o=i.find(".col1"),s=i.find(".col2"),r=i.find(".user-input"),r=new de(r[0],t),l=(i.append(r.$el),i.find("input[type=text]"));return a.select2({data:u,multiple:!1,theme:"dashboards",width:"20%"}),o.select2({data:d,multiple:!1,theme:"dashboards",width:"30%"}),s.select2({data:d,multiple:!1,theme:"dashboards",width:"20%"}),a.val(e.fn).trigger("change"),o.val(e.src).trigger("change"),e.aux?s.val(e.aux).trigger("change"):s.next(".select2-container").hide(),n(),a.on("select2:select",function(){n(),c.save()}),o.on("select2:select",function(e){l.val(e.target.value),c.save()}),l.change(function(){c.save()}),i.find(".del").button({icons:{primary:"ui-icon-trash"}}).click(function(){i.remove(),c.save()}),i}var c=ye.call(this,{el:e})||this,d=(c.$el.addClass("agg-view"),c.$el.html(S.aggregateView({})),c.$el.find(".add-row").button({icons:{primary:"fa fa-plus"}}),c.save=i,_.map(t,function(e,t){return{text:t,id:t}})),u=_.map(B.FNS,function(e){return{text:e,id:e}});return c.$el.find(".rows").append(_.map(n,a)).sortable().disableSelection(),c.$el.find(".add-row").on("click",function(){var e=_.first(_.keys(t))||"";c.$el.find(".rows").append(a(["sum",e],e)),c.save()}),c}a(Se,we=e),Se.prototype.saveClickHandler=function(){this.node.data={groupBy:this.selectView?this.selectView.getValue():{},agg:this.aggView?this.aggView.getValue():{}},this.host.refreshSideDialogHeader(this.node),this.callback&&this.callback(this.node)};var we,be=Se;function Se(e,t,n,i,a){var o=we.call(this,e,t,[n],i,a)||this,s=(o.$el.html(S.groupByDialog({})),o.$el.find(".select-table")),r=o.$el.find(".agg-table");return o.renderDialog(480,400,o.saveClickHandler.bind(o),function(){o.createAccordion([{$el:s,heading:"Group By",hideHeader:!1,isExpanded:!0,isResizeable:!0,weight:1},{$el:r,heading:"Aggregate",hideHeader:!1,isExpanded:!0,weight:1}]),o.renderFromParentMeta(function(t){var e=o.node.data||{};_.isEmpty(e.groupBy)||(e.groupBy=_.pickBy(e.groupBy,function(e){return _.isString(e)?_.includes(_.keys(t),e):_.includes(_.keys(t),e.col)})),_.isEmpty(e.agg)||(e.agg=_.pickBy(e.agg,function(e){return _.every(e.slice(1),function(e){return _.includes(_.keys(t),e)})})),o.selectView=new fe(s[0],t,e.groupBy,o.save.bind(o),!0),o.aggView=new ve(r[0],t,e.agg,o.save.bind(o)),o.save()})}.bind(o),o.onResize.bind(o),"graph-container groupBy-dialog","groupBy-dialog"),o.initialSave(),o}a(I,Pe=e),I.prototype.saveClickHandler=function(){var e=_.map(this.$leftTable.find(".rows label"),function(e){return e.textContent}),t=_.map(this.$rightTable.find(".rows label"),function(e){return e.textContent}),n=_.map(this.$leftTable.find(".rows input"),function(e){return e.checked}),i=_.map(this.$rightTable.find(".rows input"),function(e){return e.checked});this.node.data={fn:this.fn,swap:this.swap,left:e.filter(function(e,t){return n[t]}),right:t.filter(function(e,t){return i[t]})},this.host.refreshSideDialogHeader(this.node),this.callback&&this.callback(this.node)},I.prototype.renderDatagrid=function(s){var r=this,l=this.node.data?"left"===s?this.node.data.left:this.node.data.right:[],c=new d.DocumentDataModel({_subscriptionKey:"_rowIndex",_dataType:"copy",_maxRows:this.MAXROWS},null,"",null);c.apply(),this.renderFromParentMeta(function(e){function t(e){var t=$(S.joinRow({})),n=t.find("input"),i=t.find("label");t.attr("data-id",e.Columns),i.append(e.Columns),-1<l.indexOf(e.Columns)?(n.prop("checked",!0),t.attr("checked","true")):(n.prop("checked",!1),t.attr("checked",null)),t.click(function(){n.prop("disabled")||(n.prop("checked")?(n.prop("checked",!1),t.attr("checked",null)):(n.prop("checked",!0),t.attr("checked","true")),r.save())}),n.change(function(){r.checked?t.attr("checked","true"):t.attr("checked",null),r.save()}),n.click(function(e){return e.stopPropagation(),!0}),$(function(){$(o).find(".rows").sortable().disableSelection()}),a.find(".rows").append(t)}var a,o,e={class:"203",columns:["Columns"],meta:{Columns:11},rows:_.map(_.keys(e),function(e){return{Columns:e}})},n=(c.onExecuteSuccess(e,!0),"left"===s?(a=r.$leftTable,o=".transformLeftTable",r.leftRows=e.rows.map(function(e){return e.Columns})):(a=r.$rightTable,o=".transformRightTable",r.rightRows=e.rows.map(function(e){return e.Columns})),a.find(".search")),i=a.find(".closeIcon");i.css("display","none"),n.keyup(function(){var t=this.value.toLowerCase();_.each($(this).parent().parent().find(".row"),function(e){$(e).toggle(($(e).attr("data-id")||"").toLowerCase().includes(t))}),i.css("display",t?"":"none")}),i.click(function(){n.val(""),i.css("display","none"),n.trigger("keyup")}),_.each(_.filter(e.rows,function(e){return-1<l.indexOf(e.Columns)}).sort(function(e,t){return l.indexOf(e.Columns)-l.indexOf(t.Columns)}),t),_.each(_.filter(e.rows,function(e){return-1===l.indexOf(e.Columns)}),t),r.updateChecks()},this.parents["left"===s?0:1])},I.prototype.updateChecks=function(){var e=_.find(this.joinTypes,{JoinType:this.fn}),e=(this.$el.find(".transformJoinTextDesc").html(e.Message),["aj","uj","upsert"]),t=["lj","ij","uj","upsert","pj"],n=-1===(this.swap?t:e).indexOf(this.fn),n=(this.$leftTable.toggleClass("disableRows",n),this.updateTableRows(this.$leftTable,this.$rightTable,n),-1===(this.swap?e:t).indexOf(this.fn));this.$rightTable.toggleClass("disableRows",n),this.updateTableRows(this.$rightTable,this.$leftTable,n)},I.prototype.updateTableRows=function(e,t,n){var i;n?_.each(e.find(".row"),function(e){$(e).find("input[type=checkbox]").prop("checked",null),$(e).find("input, label").prop("disabled",!0)}):(i=_.fromPairs(_.map(t.find(".row"),function(e){return[$(e).attr("data-id"),!0]})),_.each(e.find(".row"),function(e){var t=$(e).attr("data-id")||"";$(e).find("input, label").prop("disabled",!i[t])}))};var Pe,$e=I;function I(e,t,n,i,a){var o=Pe.call(this,e,t,n,i,a)||this;o.fn="lj",o.swap=!1,o.leftRows=[],o.rightRows=[],o.MAXROWS=100,o.joinTypes=[{Join:"Left",JoinType:"lj",Message:"Result is left table with any matching keys from the right table joined to it"},{Join:"Inner",JoinType:"ij",Message:"Result has one combined record for each row in the left table that matches a row in the right table"},{Join:"Union",JoinType:"uj",Message:"Matching records from right table will update left table . Unmatched records from both tables are inserted into result"},{Join:"Asof (aj)",JoinType:"aj",Message:"Result is a table with records from the left-join of the tables. In the join, the first n - 1 checked columns of the left table are matched for equality. The last checked column is matched with less than or equals (most recent time)"},{Join:"Upsert",JoinType:"upsert",Message:"Matching records from right table will update left table. Unmatched records from both tables are inserted into result. Note: columns of left and right table must be aligned to perform upsert."},{Join:"Plus ",JoinType:"pj",Message:"Result is the arithmeic sum of matching records, commn columns are left inchanged and new columns are zero. Note: common columns must be an arithmetic type to be joined"}],o.$el.html(S.joinDialog({a:n[0].teaser(),b:n[1].teaser()})),o.$joinTypeSelect=o.$el.find(".join-type-select"),o.$joinDiv=o.$el.find(".transformJoin"),o.$joinDDL=o.$el.find(".joinDDL"),o.$leftTable=o.$el.find(".transformLeftTable"),o.$rightTable=o.$el.find(".transformRightTable"),o.$leftName=o.$el.find(".dbNameLeft"),o.$rightName=o.$el.find(".dbNameRight"),null!==o.node.data&&(o.fn=o.node.data.fn,_.isUndefined(o.node.data.swap)||(o.swap=o.node.data.swap)),o.$joinDiv.toggleClass("swpd",o.swap);return o.renderDialog(567,550,o.saveClickHandler.bind(o),function(){o.$joinTypeSelect.select2({data:_.map(o.joinTypes,function(e){return{text:e.Join,id:e.JoinType}}),theme:"dashboards",width:"100%"}),o.$joinTypeSelect.on("select2:select",function(e){o.fn=e.params.data.id,o.updateChecks(),o.save()});var e=_.find(o.joinTypes,{JoinType:o.fn});o.$joinTypeSelect.val(e.JoinType).trigger("change"),o.$el.find(".swap").button().click(function(){o.swap=!o.swap,o.$joinDiv.toggleClass("swpd",o.swap),o.updateChecks(),o.save()}),o.renderDatagrid("left"),o.renderDatagrid("right"),o.updateChecks()}.bind(o),_.noop.bind(o),"dlgFilterPopup"),o}a(M,ke=e),M.prototype.getUpdateJSON=function(){var i=this,a=[];return _.each(this.$el.find(".updaterRow"),function(e){var t,n=$(e);n.find(".updaterCheckbox").is(":checked")&&(t=$(e).find(".updaterColumnDDL").val()||"undefined",e=$(e).find(".updaterValue"),void 0!==t&&void 0!==e&&(e=i.parent.meta[t.toString()],void 0!==(n=n.attr("data-id"))&&(n=i.forms[n.toString()],a.push({column:t.toString(),propertyType:-e||10,val:n.model.get("value")}))))}),a},M.prototype.renderUpdate=function(){var t=this;this.$el.find(".transformUpdateNewRow").button({icons:{primary:"ui-icon-plus"}}).click(function(){t.addRow(null)}),this.$el.find(".updaterColumnsList").html(""),this.node.data&&this.node.data.update&&_.each(this.node.data.update,function(e){t.addRow(e)})},M.prototype.saveClickHandler=function(){this.node.data={filter:JSON.parse(this.filterSettings.get(M.PROP_QUERYMODEL)||"[]"),update:this.getUpdateJSON()},this.host.refreshSideDialogHeader(this.node),this.callback&&this.callback(this.node)},M.prototype.getBindings=function(e){e=e.model.get("type")||11;return this.host.getAllMatchingBindings(e).map(function(e){return e.Key})},M.prototype.addRow=function(e){var n=this,t=(this.$el.find(".updaterColumnsList").append(S.updateRow({id:this.rowCount})),this.$el.find("#updaterRow-"+this.rowCount)),i=t.find(".updaterColumnDDL"),a=_.map(this.parent.meta,function(e,t){return{text:t,id:t}}),o=t.find(".updaterCheckbox");i.select2({data:a,multiple:!1,theme:"dashboards",width:"100%"}),i.attr("data-id",this.rowCount),t.find(".updaterValue").bind("keypress",function(e){var t=e.keyCode||0,e=e.which||t;if(!(48<=e&&e<=57))return console.log("error format"),!1}),o.on("change",function(e){n.save()}),i.on("select2:select",function(e){var t=i.attr("data-id"),e=e.params.data.text;void 0!==t&&(t=n.$el.find("#updaterRow-"+t),n.updateValueEditor(t,{column:e,val:null,propertyType:n.parent.meta[e]})),n.save()}),t.find(".updaterTrash").button({icons:{primary:"ui-icon-trash"}}).click(function(e){_.get(e,"target.parentElement.parentElement.parentElement")&&(_.get(e,"target.parentElement.parentElement.parentElement").remove(),n.save())}),t.find(".updaterTrash").attr("data-id",this.rowCount),e&&(i.val(e.column).trigger("change"),t.find(".updaterValue").val(e.val)),this.updateValueEditor(t,e),this.rowCount+=1,e||this.save()},M.prototype.updateValueEditor=function(e,t){var n,i=Math.abs(_.get(t,"propertyType")),i=(_.get(t,"column"),isNaN(i)&&(i=_.first(_.values(this.parent.meta)),_.first(_.keys(this.parent.meta))),r.RTTI.getByQTypeNum(i=10!==i&&i||11)),a=i.editor,i=i.name,o=e.attr("data-id"),s=this.onFormValueChanged.bind(this);o&&(n=new r.editors[a.type]({model:new l.DeepModel,schema:a,key:"value",id:"rowInput_"+o}).render(),_.get(t,"column")&&n.$el.attr("data-name",t.column),"Text"===a.type||"Number"===a.type?(n.$el.attr("type","search"),n.$el.on("input",_.debounce($.proxy(s,this,n,null),500))):n.on("change changeList",$.proxy(s,this,n,null)),_.get(t,"val")?n.model.set("value",t.val):n.model.set("value",n.getValue()),this.forms[o.toString()]=n,a=null,(0<this.host.api.getProperty("Bindings").length||this.host.api.getProperty("Basics.UseViewStates"))&&((a=$(S.bindingSelect({}))).find(".binding-apply").click(this.showBindingsDropdown.bind(this,null,n,a,null)),a.find(".binding-clear-dialog").click(this.onBindingsClear.bind(this,n,a)),n.model.set("type",i),t&&_.isString(t.val)&&t.val.match(g.VSRx)&&this.showBindingsDropdown(null,n,a,this.removeVSChars(t.val)),this.host.api.getProperty("Basics.UseViewStates")?(a.find(".binding-dropdown").hide(),a.find(".viewstate-display").click(this.showBindingsDropdown.bind(this,null,n,a,null))):(a.find(".viewstate-icon").hide(),a.find(".viewstate-display").hide(),a.find(".binding-select").on("select2:select",$.proxy(s,this,n,a)))),o=a?(n.$el.is("div, select")?this.wrapInDiv(n.$el,"value-wrap"):n.$el).add(a):n.$el,e.find(".updaterColumSelection").html(o))},M.prototype.onBindingsClear=function(e,t){e.model.set("value",this.previousValue),this.toggleBindings(!0,e,t),this.save()},M.prototype.onFormValueChanged=function(e,t,n){e.model.set({value:!t||"true"!==t.attr("use-bindings")&&"true"!==t.attr("use-viewstates")?n?_.isNil(n.value)?n.target.value:n.getValue():"":"<%"+(t.find(".binding-select").val()||t.find(".viewstate-display").val())+"%>"}),this.save()},M.prototype.onSelectViewState=function(e,t,n){t.find(".viewstate-display").val(n),this.toggleBindings(!1,e,t),this.setPreviousValue(e),this.onFormValueChanged(e,t,null),this.save()},M.prototype.setPreviousValue=function(e){var t=e.model.get("value"),e=e.model.get("type");this.previousValue=_.isString(t)&&p.VSRx.exec(t)?"boolean"!==e&&"":t},M.prototype.showBindingsDropdown=function(e,t,n,i){this.host.api.getProperty("Basics.UseViewStates")?_.isNil(i)?this.host.renderViewStateDialog({path:this.removeVSChars((t.model||t.value.model).get("value")),selectCallback:this.onSelectViewState.bind(this,t,n)}):this.onSelectViewState(t,n,i):(this.toggleBindings(!1,t,n),this.setPreviousValue(t),t=this.getBindings(t),(n=n.find(".binding-select")).select2({data:t,multiple:!1,theme:"dashboards",width:"100%",language:{noResults:function(){return"No matching bindings"}}}),n.val(i||t[0]||""),n.trigger("change"),n.trigger("select2:select"))},M.prototype.toggleBindings=function(e,t,n){(t.$el.parent().hasClass("value-wrap")?t.$el.parent():t.$el).toggle(e),t.$el.toggle(e),n.find(".binding-apply").toggle(e),n.find(".binding-container").toggle(!e),this.host.api.getProperty("Basics.UseViewStates")?(n.find(".viewstate-icon").toggle(!e),n.find(".viewstate-display").toggle(!e),n.attr("use-viewstates",String(!e))):n.attr("use-bindings",String(!e))},M.prototype.wrapInDiv=function(e,t){var n=$(document.createElement("div"));return t&&n.addClass(t),n.append(e),n};var ke,_e,De=M;function M(e,t,n,i,a){var o=ke.call(this,e,t,[n],i,a)||this,s=(o.forms={},o.rowCount=0,o.$el.html(S.updateDialog({})),o.$el.find(".update-table")),r=o.$el.find(".where-table");o.initializeDataFilter(),t.data&&t.data.filter&&o.filterSettings.set(M.PROP_QUERYMODEL,JSON.stringify(t.data.filter,null,2));return o.renderDialog(550,550,o.saveClickHandler.bind(o),function(){o.createAccordion([{$el:s,heading:"Update",hideHeader:!1,isExpanded:!0,isResizeable:!0,weight:1},{$el:r,heading:"Where",hideHeader:!1,isExpanded:!0,weight:1}]),o.renderFromParentMeta(function(t){var e=o.node.data||{};_.isEmpty(e.update)||(e.update=_.filter(e.update,function(e){return _.includes(_.keys(t),e.column)})||[]),o.renderUpdate(),o.renderFilter(r)})}.bind(o),o.onResize.bind(o),"update-dialog","update-dialog"),o.initialSave(),o}function A(e){var t=_e.call(this,e)||this;return t.renderViewStateDialog=_.noop.bind(t),t.docViewModel=null,t.selectedNode=null,t.sideDialog=!1,t.connection="",t.isSaving=!1,t.nodes={},t.edges={},t.edgesR={},t.errorNodeId="",t.activeBindingKeys=[],t.network=void 0,t.dialogNode=null,t.dialog=null,t.dialogPlacement="",t.api=e.api,t.dashboardAppModel=e.dashboardAppModel,t.server=e.DeltaClientLib,t.dialogPlacement=t.api.getProperty(A.PROP_DIALOGPLACEMENT),t.isLite=e.dashboardAppModel.get("isLite"),t.$el.html(S.app({})),t.$el.addClass("graph-app"),t.$error=t.$el.find(".nodeErrorMessage"),t.$builder=t.$el.find(".builder"),t.$graph=t.$el.find(".graph"),t.$sideDialog=t.$el.find(".side-dialog"),t.accordion=new j.AccordionView({el:t.$el.find(".accordion")[0],sections:t.generateAccordionSections(t.dialogPlacement)}),t.accordion.setDirection("Horizontal"),t.$el.bind("contextmenu",function(e){e.preventDefault()}),t.listenTo(t.accordion,"sectionResized",t.resizeSideDialog.bind(t)),t}return _e=d.QueryBuilder.App,a(A,_e),A.createNode=function(e){switch(e.group){case"data":case"function":case"stream":return new g(e);case"filter":return new H(e);case"groupBy":return new G(e);case"join":return new W(e);case"update":return new ne(e);case"result":return new Z(e);default:throw"Invalid node "+e}},A.prototype.closeSideDialog=function(){this.onCloseDialog(),this.toggleSideDialog(!1),this.redrawGraph(),this.api.getProperty(A.PROP_AUTOSAVE)||this.$sideDialog.find(".save-button").off("click"),this.$sideDialog.find(".close-button").off("click"),this.toggleHelpfulTip()},A.prototype.getAllMatchingBindings=function(t){var e=this.api.getProperty(A.PROP_BINDINGS);return _.filter(e,function(e){return e.ViewState&&e.ViewState.get("_type")===t})},A.prototype.getNodeData=function(e,t,n,i){this.runAnalytic(".queryBuilder.processGraph",[{type:"symbol",value:e},{type:"string",value:this.api.getProperty(A.PROP_qIPC)}],t,n,i)},A.prototype.onCloseDialog=function(){this.dialog&&(this.dialog.remove(),delete this.dialog),this.dialogNode=null},A.prototype.onResize=function(){this.accordion.resize(),this.accordion.updateLayout(!1),this.resizeSideDialog(),this.renderGraph()},A.prototype.onSettingsChange=function(e){var n,i=this,a=!1,o=!1;if(0<Object.keys(e).filter(function(e){return-1!==[A.PROP_CONN,A.PROP_JSON].indexOf(e)}).length&&(void 0!==e[A.PROP_CONN]&&(this.connection=e[A.PROP_CONN]),void 0!==e[A.PROP_JSON])){var t=e[A.PROP_JSON];try{var s=JSON.parse(t);this.edges=s.edges,this.edgesR=A.calculateReverseEdges(this.edges),this.nodes={},_.each(this.topoSortedNodes(s.nodes,this.edgesR),function(e){i.nodes[e.id]=A.createNode(e)}),this.activeBindingKeys=_.reduce(this.nodes,function(e,t){return e.concat(d.QueryBuilder.App.groupToClass[t.group].getActiveBindingKeys(t.data))},[]),this.toggleHelpfulTip()}catch(e){d.Log.Warn("Invalid JSON - Default Graph"),this.edges={},this.edgesR={},this.activeBindingKeys=[];var t=new Z({id:"result",group:"result"}),s=new g({id:"data0",group:"data"});this.nodes={result:t,data0:s},this.addEdge(s.id,t.id),this.addNodeBefore(t,s)}a=!0}_.find(_.keys(e),function(e){return 0===e.indexOf(A.PROP_DIRECTION)||0===e.indexOf(A.PROP_LEVELSEPARATION)||0===e.indexOf(A.PROP_NODESPACING)})&&(a=!0),_.find(_.keys(e),function(e){return e===A.PROP_BINDINGS})?(t=this.api.getProperty(A.PROP_BINDINGS),u.GraphNode.bindings={},_.each(t,function(e,t){u.GraphNode.bindings[e.Key]=i.api.getProperty(A.PROP_BINDINGS+"."+t+".ViewState"),a=a||-1!==i.activeBindingKeys.indexOf(e.Key)})):0<(s=_.keys(e).filter(function(e){return/Bindings\.[0-9]+\.ViewState/.test(e)})).length&&(n=this.api.getProperty(A.PROP_BINDINGS),_.each(s,function(e){var t=n[e.split(".")[1]].Key;u.GraphNode.bindings[t]=i.api.getProperty(e),o=!0})),_.find(_.keys(e),function(e){return e===A.PROP_DIALOGPLACEMENT||e===A.PROP_AUTOSAVE})&&((t=this.api.getProperty(A.PROP_DIALOGPLACEMENT))!==this.dialogPlacement&&"Pop-up"!==(this.dialogPlacement=t)&&"dialog"!==("Left"===t?i.accordion.sections[0]:i.accordion.sections[1]).viewModel.get("heading")&&(_.each(this.accordion.sections,function(e){return i.accordion.removeSection(e.viewModel.get("sectionId"))}),s=this.generateAccordionSections(t),_.each(s,function(e){return i.accordion.addSection(e,!0)})),this.sideDialog&&this.closeSideDialog(),this.toggleHelpfulTip()),!_.find(_.keys(e),function(e){return e===A.PROP_FORCESELECT})||!this.api.getProperty(A.PROP_FORCESELECT)||this.selectedNode&&"result"!==this.selectedNode.id||this.selectNode(_.first(this.edgesR.result)),a?(this.update(!0),this.renderGraph()):o&&(this.update(!0),this.renderLabels()),_.find(_.keys(e),function(e){return e===A.PROP_DATA})&&this.api.subscribe(e[A.PROP_DATA],function(e,t,n){n&&i.network?(n=/(Database exception: )?nd([^:]+):(.*)$/.exec(n.error),i.$error.find(".errors-text").html(n?n[3]:""),i.errorNodeId=n?n[2]:"",i.positionErrorNode()):(i.$error.hide(),i.errorNodeId="")})},A.prototype.refreshSideDialogHeader=function(e){var t,n;this.$sideDialog&&(t=this.$sideDialog.find(".side-dialog-menu > .description"),n=this.$sideDialog.find(".side-dialog-menu > .menu-icon"),t.html(e.teaser()),n.html(e.icon()))},A.prototype.remove=function(){return this.network&&(this.network.destroy(),delete this.network),p.viewModel&&delete p.viewModel,this},A.prototype.renderSideDialog=function(e,t,n,i){var a=this,o=this.sideDialog,t=(this.dialogNode=t,this.dialogNode.data||n(),this.toggleSideDialog(!0),this.refreshSideDialogHeader(t),this.$sideDialog.find(".side-dialog-content")),e=(t.find(".select2-hidden-accessible").select2("close"),t.empty(),t.append(e),this.$sideDialog.find(".save-button")),s=this.api.getProperty(A.PROP_AUTOSAVE);this.toggleSaveButton(t,e,s),s||e.off("click").button().click(function(){n()}),this.$sideDialog.find(".close-button").off("click").button().click(function(){a.closeSideDialog()}),i(),o||this.redrawGraph()},A.prototype.runAnalytic=function(e,t,n,i,a){this.server.runAnalytic(e,this.connection,t,i,function(e){a(e)},n)},A.prototype.setViewModel=function(e,t,n){this.docViewModel=e,this.docDataModel=t,this.renderViewStateDialog=n,d.QueryBuilder.GraphNode.viewModel=p.viewModel=e},A.prototype.updateMeta=function(n,i){var a=this;this.getNodeData(n.id,10,function(e){if(a.nodes[n.id].meta=e.meta,"update"!==n.group)for(var t=a.edges[n.id][0];"result"!==t;)delete(n=a.nodes[t]).meta,t=a.edges[n.id][0];a.update(),i&&i(e.meta)},function(e){return d.Log.Error(e)})},A.prototype.addEdge=function(e,t){var n=this.edges[e];void 0!==n?n.push(t):this.edges[e]=[t],void 0!==(n=this.edgesR[t])?n.push(e):this.edgesR[t]=[e]},A.prototype.addNodeBefore=function(e,t){this.nodes[t.id]||(t.id=this.getNewNodeId(t.group),this.addEdge(t.id,e.id)),this.nodes[t.id]=t,this.update(),this.selectNode(t.id),this.updateMeta(t)},A.prototype.count=function(e){e=this.edges[e];return void 0===e?0:e.length},A.prototype.countR=function(e){e=this.edgesR[e];return void 0===e?0:e.length},A.prototype.deleteNode=function(t){var n=this,e=_.first(this.edgesR[t]),i=_.first(this.edges[t]);this.selectedNode=this.nodes[e||i||"result"],this.api.setProperty(A.PROP_SELECTED,this.selectedNode.id),this.sideDialog&&this.doCommand(this.selectedNode.group),_.each(this.edges[t],function(e){return n.removeEdge(t,e)}),_.each(this.edgesR[t],function(e){return n.removeEdge(e,t)}),delete this.nodes[t],void 0!==e&&void 0!==i&&this.addEdge(e,i),this.update(),this.updateMeta(this.selectedNode)},A.prototype.doCommand=function(e){var t,n,i,a=this,o=this.selectedNode;switch(o&&"result"!==o.id||(t=_.first(this.edgesR.result),o=t?this.nodes[t]:this.nodes.result),"Pop-up"!==this.api.getProperty(A.PROP_DIALOGPLACEMENT)&&(n=this.$sideDialog),e){case"+data":this.dialog=new C(this,new g({group:"data"}),void 0,function(e){return a.addNodeBefore(o,e)},n);break;case"data":case"stream":this.dialog=new C(this,o,void 0,function(e){return a.updateNode(e)},n);break;case"+filter":this.dialog=new me(this,new H({group:"filter"}),o,function(e){return a.insertNodeAfter(o,e)},n);break;case"filter":this.dialog=new me(this,o,this.nodes[this.getParentNodeId(o)],function(e){return a.updateNode(e)},n);break;case"function":this.dialog=new C(this,o,this.nodes[this.getParentNodeId(o)],function(e){return a.updateNode(e)},n);break;case"+function":this.dialog=new C(this,new g({group:"function"}),o,function(e){return a.insertNodeAfter(o,e)},n);break;case"function+":this.dialog=new C(this,new g({group:"function"}),void 0,function(e){return a.addNodeBefore(o,e)},n);break;case"groupBy":this.dialog=new be(this,o,this.nodes[this.getParentNodeId(o)],function(e){return a.updateNode(e)},n);break;case"+groupBy":this.dialog=new be(this,new G({group:"groupBy"}),o,function(e){return a.insertNodeAfter(o,e)},n);break;case"join":2===this.countR(o.id)&&(i=_.keys(this.topoSortedNodes(this.nodes,this.edgesR)),this.dialog=new $e(this,o,this.edgesR[o.id].sort(function(e,t){return i.indexOf(e)-i.indexOf(t)}).map(function(e){return a.nodes[e]}),function(e){return a.updateNode(e)},n));break;case"+join":this.insertNodeAfter(o,new W({group:"join"}));break;case"+update":this.dialog=new De(this,new ne({group:"update"}),o,function(e){return a.insertNodeAfter(o,e)},n);break;case"update":this.dialog=new De(this,o,this.nodes[this.getParentNodeId(o)],function(){return a.update()},n);break;case"delete":this.deleteNode(o.id);break;case"result":break;default:throw"Command Error"}},A.prototype.decodeHTML=function(e){return e.replace(/&lt;%/g,"<%").replace(/%&gt;/g,"%>")},A.prototype.expandSideDialog=function(e){var t=_.find(this.accordion.sections,function(e){return"dialog"===e.viewModel.get("heading")});t&&t.viewModel.set("isExpanded",e)},A.prototype.generateAccordionSections=function(e){var t=[{$el:this.$sideDialog,viewModel:new l.Model({align:"left",heading:"dialog",hideHeader:!0,order:0,isExpanded:!1,isResizeable:!0,weight:.4,sectionId:_.uniqueId("section_")})},{$el:this.$builder,viewModel:new l.Model({align:"left",heading:"graph",hideHeader:!0,order:0,isExpanded:!0,weight:.6,isResizeable:!0,sectionId:_.uniqueId("section_")})}];return"Left"===e?t:_.reverse(t)},A.prototype.getDirection=function(){var e="LR";switch(this.api.getProperty(A.PROP_DIRECTION)){case"Up-Down":e="UD";break;case"Down-Up":e="DU";break;case"Right-Left":e="RL"}return e},A.prototype.getNewNodeId=function(e){for(var t=0;void 0!==this.nodes[e+t];)t++;return e+t},A.prototype.getParentNodeId=function(e){return _.first(this.edgesR[e.id])},A.prototype.insertNodeAfter=function(e,t){var n;this.nodes[t.id]||(t.id=this.getNewNodeId(t.group),n=this.edges[e.id][0],this.removeEdge(e.id,n),this.addEdge(e.id,t.id),this.addEdge(t.id,n)),this.nodes[t.id]=t,this.update(),this.selectNode(t.id),this.updateMeta(t)},A.prototype.listenToNetwork=function(){var t=this;this.network&&(this.network.on("selectNode",function(e){return t.setSelectedNode(_.first(e.nodes)),!0}),this.network.on("deselectNode",function(e){return t.selectNode(t.api.getProperty(A.PROP_FORCESELECT)&&!e.nodes.length?_.first(e.previousSelection.nodes):""),!0}),this.network.off("oncontext"),this.network.on("oncontext",function(e){t.api.getProperty(A.PROP_READONLY)||t.showContextMenu(e)}),this.network.on("click",this.onClick.bind(this)),this.network.on("doubleClick",function(e){t.api.getProperty(A.PROP_READONLY)||t.onDoubleClick(e)}),this.network.on("hoverNode",function(){t.$graph.css("cursor","pointer")}),this.network.on("blurNode",function(){t.$graph.css("cursor","default")}))},A.prototype.mapDataAttributes=function(){return{edges:new n.DataSet(_.reduce(_.pickBy(this.edges,function(e){return!_.includes(e,"result")}),function(e,t,n){return e.concat(t.map(function(e){return _.extend({},{arrows:{to:!0},id:n+"->"+e,labelHighlightBold:!1,shadow:!1,width:1},{from:n,to:e})}))},[])),nodes:new n.DataSet(_.map(_.filter(this.nodes,function(e,t){return"result"!==t}),function(e){return{id:(e=e).id,chosen:{node:function(e,t,n){n&&(e.borderColor="#00AEFF",e.borderWidth=2)}},font:{multi:"html",align:"left",face:"FontAwesome,Arial",size:13,bold:"Arial",ital:"Segoe UI"},title:e.description()||void 0,label:e.icon()+" "+e.teaser(),color:e.color(),labelHighlightBold:!1,shape:"box",shapeProperties:{borderRadius:3}}}))}},A.prototype.onClick=function(e){$(".custom-menu").hide(),this.sideDialog&&this.onDoubleClick(e)},A.prototype.onDoubleClick=function(e){var t;this.network&&void 0!==(e=this.network.getNodeAt(e.pointer.DOM))&&0!==e&&(t=this.nodes[e],this.selectedNode!==t&&this.selectNode(e),this.doCommand(t.group))},A.prototype.positionErrorNode=function(){var e,t,n;this.network&&this.errorNodeId&&(t=this.network.getPositions([this.errorNodeId]),_.isEmpty(t)||(this.$error.show(),e=this.network.getScale(),0<(n=(t=this.network.canvasToDOM({x:t[this.errorNodeId].x,y:t[this.errorNodeId].y})).x-this.$error[0].clientWidth/2)?this.$error.css({left:n+this.$sideDialog[0].clientWidth+"px",top:t.y+this.$error[0].clientHeight/4+"px",width:200*e+"px",height:40*e+"px",fontSize:14*e+"px"}):this.$error.hide()))},A.prototype.redrawGraph=function(){this.network&&(this.network.setSize(this.$graph.width()+"px",this.$graph.height()+"px"),this.network.redraw()),this.onResize()},A.prototype.removeEdge=function(e,t){var n=this.edges[e];void 0!==n&&n.splice(n.indexOf(t),1),void 0!==(n=this.edgesR[t])&&n.splice(n.indexOf(e),1)},A.prototype.renderGraph=function(){var e=this,t=(this.network&&(this.network.destroy(),delete this.network),{interaction:{dragNodes:!0,dragView:!0,hover:!0,multiselect:!0,selectConnectedEdges:!0},layout:{hierarchical:{blockShifting:!0,direction:this.getDirection(),edgeMinimization:!0,enabled:!0,levelSeparation:this.api.getProperty(A.PROP_LEVELSEPARATION),nodeSpacing:this.api.getProperty(A.PROP_NODESPACING),parentCentralization:!0,sortMethod:"directed",treeSpacing:20},improvedLayout:!0},physics:!1});t.layout.hierarchical.treeSpacing=50;try{this.network=new n.Network(this.$graph[0],this.mapDataAttributes(),t),this.network.on("afterDrawing",function(){e.positionErrorNode()}),this.api.getProperty("Basics.Selected")&&this.nodes[this.api.getProperty("Basics.Selected")]?this.selectNode(this.api.getProperty("Basics.Selected")):this.selectNode(""),this.dialog&&this.dialogNode&&this.dialog.setNode(this.nodes[this.dialogNode.id]),this.listenToNetwork()}catch(e){d.Log.Error("Render Graph Error",e)}},A.prototype.renderLabels=function(){var t=this;this.network&&_.each(this.nodes,function(e){t.network.body.data.nodes.update({id:e.id,title:e.description()||void 0,label:e.icon()+" "+e.teaser()})})},A.prototype.resizeSideDialog=function(){this.dialog&&this.dialog.onResize&&this.dialog.onResize()},A.prototype.selectNode=function(e){(e=void 0===e?"":e)&&"result"!==e&&this.network&&this.network.selectNodes([e]),this.setSelectedNode(e)},A.prototype.setSelectedNode=function(e){this.selectedNode=this.nodes[e=void 0===e?"":e]||null,this.api.setProperty(A.PROP_SELECTED,e),this.updateQIPC()},A.prototype.showContextMenu=function(e){var t,n,i,a,o,s=this;this.network&&(o=this.network.getNodeAt(e.pointer.DOM)||"result",t=this.$el.find(".custom-menu"),n=[],"result"!==(i=(a=this.nodes[o]).group)&&("join"!==i||1<this.edgesR[o].length)&&n.push({id:i,text:"Edit "+_.capitalize(a.group),icon:"fa fa-edit contextIcon"}),("result"===i&&0===this.countR(o)||"join"===i&&this.countR(o)<2)&&(n.push({id:"+data",text:"Add Data Source",icon:"fa fa-plus contextIcon"}),n.push({id:"function+",text:"Add Function Source",icon:"fa fa-plus contextIcon"})),"result"===i&&0===this.countR(o)||(n.push({id:"+filter",text:"Add Filter",icon:"fa fa-plus contextIcon"}),n.push({id:"+update",text:"Add Update",icon:"fa fa-plus contextIcon"}),n.push({id:"+groupBy",text:"Add Group By",icon:"fa fa-plus contextIcon"}),n.push({id:"+join",text:"Add Join",icon:"fa fa-plus contextIcon"}),n.push({id:"+function",text:"Add Function",icon:"fa fa-plus contextIcon"})),("join"===i?1===this.countR(o)&&1===this.count(o):"data"!==i&&"function"!==i&&"stream"!==i||0!==this.countR(o)?"result"!==i:"join"===(a=this.nodes[this.edges[o][0]]).group&&2<=this.countR(a.id))&&n.push({id:"delete",text:"Delete",icon:"fa fa-times contextIcon"}),this.selectNode(o),t.html(S.menu(n)),i=e.pointer.DOM.x,(a=e.pointer.DOM.y)+t.height()>this.$graph.height()&&(a-=t.height()),i+t.width()>this.$graph.width()&&(i-=t.width()),o=this.$graph.closest(".section").position(),t.finish().toggle(10).css({left:o.left+Math.max(i,0)+"px",top:o.top+Math.max(a,0)+"px"}),t.find("li").click(function(e){e=$(e.currentTarget).attr("data-index");s.doCommand(e),$(".custom-menu").hide(100)}))},A.prototype.toggleHelpfulTip=function(){var e,t=_.first(_.keys(this.nodes).filter(function(e){return _.includes(e,"data")}).sort())||"data0",n=2===_.keys(this.nodes).length,i=_.isEmpty(this.nodes[t].data);n&&i&&!this.sideDialog&&"Pop-up"!==this.api.getProperty(A.PROP_DIALOGPLACEMENT)&&(e=this.nodes[t])&&(this.selectedNode!==e&&this.selectNode(t),this.doCommand(e.group)),this.$el.find(".helpful-tip").toggle(n&&"Pop-up"!==this.api.getProperty(A.PROP_DIALOGPLACEMENT)).find("span").text(i?"Select a data source to begin building a query":"Right-click on a node for more options")},A.prototype.toggleSaveButton=function(e,t,n){t.toggle(!n),e.toggleClass("auto-save",n)},A.prototype.toggleSideDialog=function(e){this.sideDialog=e,this.$sideDialog.toggle(e),this.expandSideDialog(e)},A.prototype.topoSortedNodes=function(n,i){function t(e){a.push(e),e=_.sortBy(i[e],o),_.each(e,function(e){-1===a.indexOf(e)&&t(e)})}var a=[],o=function(e){var t=[];return i[e]?_.each(i[e],function(e){e=o(e);t.push(e)}):t.push(e),t.sort()[0]};return t("result"),_.reduce(a,function(e,t){return e[t]=n[t],e},{})},A.prototype.update=function(e){this.isSaving=!e||this.isSaving,this.updateJSON(),e&&!this.isSaving&&this.sideDialog&&this.closeSideDialog(),this.isSaving=!!e&&this.isSaving,this.updateQIPC()},A.prototype.updateJSON=function(){var e={nodes:this.topoSortedNodes(this.nodes,this.edgesR),edges:_.fromPairs(_.map(this.edges,function(e,t){return[t,_.sortBy(e)]}))},t=this.api.getProperty(A.PROP_JSON);if(t)try{var n=JSON.parse(t);_.each(e.nodes,function(e,t){n.nodes[t]&&n.nodes[t].subscription&&(e.subscription=n.nodes[t].subscription)})}catch(e){}this.api.setProperty(A.PROP_JSON,this.decodeHTML(JSON.stringify(e)))},A.prototype.updateNode=function(e){this.update(),this.updateMeta(e)},A.prototype.updateQIPC=function(){var e=A.graphToIPC(this.nodes,this.edges,this.api.getProperty(A.PROP_SELECTED));this.api.setProperty(A.PROP_qIPC,e)},A.getComponentDefinition=o.getComponentDefinition,A.getSettingsModel=o.getSettingsModel,A.PROP_DATA="Basics.Data",A.PROP_CONN="Basics.Connection",A.PROP_DIRECTION="Basics.Direction",A.PROP_DIALOGPLACEMENT="Basics.DialogPlacement",A.PROP_AUTOSAVE="Basics.AutoSave",A.PROP_READONLY="Basics.ReadOnly",A.PROP_FORCESELECT="Basics.ForceSelection",A.PROP_SELECTED="Basics.Selected",A.PROP_JSON="Basics.JSON",A.PROP_qIPC="Basics.qIPC",A.PROP_BINDINGS="Bindings",A.PROP_LEVELSEPARATION="Style.LevelSeparation",A.PROP_NODESPACING="Style.NodeSpacing",A});