define(["backbone","echarts","./lib/ecStat-custom.min","Handlebars","QuickBase","moment","xlsx","css!./css/app.css"],function(o,H,X,i,d,l,E){"use strict";var a,e=this&&this.__extends||(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=(n.app=i.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,a,r){return'<div class="scatterplot-container">\n    <div class="notifications-panel hidden"></div>\n    <div class="tools-panel"></div>\n    <div class="chart-legends-container"></div>\n    <div class="chart-area"></div>\n    \x3c!-- Only used to store current last tooltip html --\x3e\n    <div class="tooltip" style="display: none"></div>\n</div>'},useData:!0}),n.legend=i.template({1:function(t,e,i,a,r){var o=null!=e?e:t.nullContext||{},n=t.hooks.helperMissing,s="function",l=t.escapeExpression,p=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <li>\n            <section class="chart-legend-icon">\n'+(null!=(t=p(i,"if").call(o,null!=e?p(e,"noSvg"):e,{name:"if",hash:{},fn:t.program(2,r,0),inverse:t.program(4,r,0),data:r,loc:{start:{line:5,column:16},end:{line:9,column:23}}}))?t:"")+'            </section>\n            <section class="chart-legend-text" style="color:'+l(typeof(t=null!=(t=p(i,"fontColor")||(null!=e?p(e,"fontColor"):e))?t:n)==s?t.call(o,{name:"fontColor",hash:{},data:r,loc:{start:{line:11,column:60},end:{line:11,column:73}}}):t)+";font-size:"+l(typeof(t=null!=(t=p(i,"fontSize")||(null!=e?p(e,"fontSize"):e))?t:n)==s?t.call(o,{name:"fontSize",hash:{},data:r,loc:{start:{line:11,column:84},end:{line:11,column:96}}}):t)+'">\n                '+l(typeof(t=null!=(t=p(i,"legendName")||(null!=e?p(e,"legendName"):e))?t:n)==s?t.call(o,{name:"legendName",hash:{},data:r,loc:{start:{line:12,column:16},end:{line:12,column:30}}}):t)+"\n            </section>\n        </li>\n"},2:function(t,e,i,a,r){var o,n=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",p=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                    <i class="fa '+p(typeof(o=null!=(o=t(i,"icon")||(null!=e?t(e,"icon"):e))?o:s)==l?o.call(n,{name:"icon",hash:{},data:r,loc:{start:{line:6,column:33},end:{line:6,column:41}}}):o)+'" style="color:'+p(typeof(o=null!=(o=t(i,"iconColor")||(null!=e?t(e,"iconColor"):e))?o:s)==l?o.call(n,{name:"iconColor",hash:{},data:r,loc:{start:{line:6,column:56},end:{line:6,column:69}}}):o)+'"></i>\n'},4:function(t,e,i,a,r){var o=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"                    "+(null!=(o="function"==typeof(i=null!=(i=o(i,"icon")||(null!=e?o(e,"icon"):e))?i:t.hooks.helperMissing)?i.call(null!=e?e:t.nullContext||{},{name:"icon",hash:{},data:r,loc:{start:{line:8,column:20},end:{line:8,column:30}}}):i)?o:"")+"\n"},compiler:[8,">= 4.3.0"],main:function(t,e,i,a,r){return'<ul class="chart-legends">\n'+(null!=(i=(t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]})(i,"each").call(null!=e?e:t.nullContext||{},e,{name:"each",hash:{},fn:t.program(1,r,0),inverse:t.noop,data:r,loc:{start:{line:2,column:4},end:{line:15,column:13}}}))?i:"")+"</ul>"},useData:!0}),n.tooltip=i.template({1:function(t,e,i,a,r){var o=null!=e?e:t.nullContext||{},n=t.hooks.helperMissing,s="function",l=t.escapeExpression,p=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"            <tr>\n                <td> \n"+(null!=(t=p(i,"if").call(o,null!=e?p(e,"noSvg"):e,{name:"if",hash:{},fn:t.program(2,r,0),inverse:t.program(4,r,0),data:r,loc:{start:{line:13,column:20},end:{line:17,column:27}}}))?t:"")+"                <td>\n                    "+l(typeof(t=null!=(t=p(i,"chartName")||(null!=e?p(e,"chartName"):e))?t:n)==s?t.call(o,{name:"chartName",hash:{},data:r,loc:{start:{line:19,column:20},end:{line:19,column:33}}}):t)+': \n                </td>\n                </td>\n                <td style="padding-right: 10px; text-align: left;">\n                        '+l(typeof(t=null!=(t=p(i,"layerDataFormatted")||(null!=e?p(e,"layerDataFormatted"):e))?t:n)==s?t.call(o,{name:"layerDataFormatted",hash:{},data:r,loc:{start:{line:23,column:24},end:{line:23,column:46}}}):t)+"\n                </td>\n            </tr>\n"},2:function(t,e,i,a,r){var o,n=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",p=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                        <i class ="fa '+p(typeof(o=null!=(o=t(i,"iconFa")||(null!=e?t(e,"iconFa"):e))?o:s)==l?o.call(n,{name:"iconFa",hash:{},data:r,loc:{start:{line:14,column:38},end:{line:14,column:48}}}):o)+'" style="color:'+p(typeof(o=null!=(o=t(i,"plotColor")||(null!=e?t(e,"plotColor"):e))?o:s)==l?o.call(n,{name:"plotColor",hash:{},data:r,loc:{start:{line:14,column:63},end:{line:14,column:76}}}):o)+'"></i>\n'},4:function(t,e,i,a,r){var o=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"                        "+(null!=(o="function"==typeof(i=null!=(i=o(i,"svg")||(null!=e?o(e,"svg"):e))?i:t.hooks.helperMissing)?i.call(null!=e?e:t.nullContext||{},{name:"svg",hash:{},data:r,loc:{start:{line:16,column:24},end:{line:16,column:33}}}):i)?o:"")+"\n"},compiler:[8,">= 4.3.0"],main:function(t,e,i,a,r){var o,n=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",p=t.escapeExpression,h=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<table class="scatter-tooltip" style="'+p(typeof(o=null!=(o=h(i,"fontSize")||(null!=e?h(e,"fontSize"):e))?o:s)==l?o.call(n,{name:"fontSize",hash:{},data:r,loc:{start:{line:1,column:38},end:{line:1,column:50}}}):o)+'">\n    <thead>\n        <tr style="padding-right: 10px;">\n            <th> '+p(typeof(o=null!=(o=h(i,"xLabel")||(null!=e?h(e,"xLabel"):e))?o:s)==l?o.call(n,{name:"xLabel",hash:{},data:r,loc:{start:{line:4,column:17},end:{line:4,column:27}}}):o)+' </th>\n            <th> </th>\n        </tr>\n    </thead>\n    \x3c!-- TODO add scroll event to enable context scrolling --\x3e\n    <tbody style="display:block;overflow:hidden;'+p(typeof(o=null!=(o=h(i,"maxHeight")||(null!=e?h(e,"maxHeight"):e))?o:s)==l?o.call(n,{name:"maxHeight",hash:{},data:r,loc:{start:{line:9,column:48},end:{line:9,column:61}}}):o)+'">\n'+(null!=(p=h(i,"each").call(n,null!=e?h(e,"points"):e,{name:"each",hash:{},fn:t.program(1,r,0),inverse:t.noop,data:r,loc:{start:{line:10,column:8},end:{line:26,column:17}}}))?p:"")+"    </tbody> \n</table>"},useData:!0}),n);function n(){}"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),a=1;a<arguments.length;a++){var r=arguments[a];if(null!=r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(i[o]=r[o])}return i},writable:!0,configurable:!0});u.setApiProperty=function(t,e,i,a){a?i.api.setProperty(t,e):(i.api.setProperty(t,e,{silent:!0}),i.onSettingsChange(((a={})[t]=e,a)))},u.renderSVGIcon=function(t,e){var i=u.hex2RGB(t.plotColor),e=e?e+"px":"12px",a='<svg height="'+e+'" width="'+e+'" viewbox="0 0 15 15" style="margin-right:5px">',r=i?"rgba("+i[0]+","+i[1]+","+i[2]+",0.8)":"rgba(79,106,166, 0.8)",o=r,n="80",s=t.legendIconCustom||"none";switch(s){case"circle":a=a+'<circle cx="7.5" cy="7.5" r="5" stroke="'+o+'" stroke-width="'+Math.min(1,1)+'" fill="'+r+'" />';break;case"diamond":a=a+'<path fill="'+r+'" stroke="'+o+'" stroke-width="'+Math.min(1,1)+'"  stroke-linecap="butt" stroke-linejoin="miter" opacity="'+n+'" d="M 0 7.5 L 7 3.5 L 14 7.5 L 7 11.5 Z" ></path>';break;case"rect":case"rectangle":a=a+'<rect style="fill:'+r+";stroke:"+o+";stroke-width:"+Math.min(1,1)+";stroke-linecap:butt stroke-linejoin:miter;opacity:"+n+'" x="0" y="3.5"  width="14" height="7.5" />';break;case"square":a=a+'<rect style="fill:'+r+";stroke:"+o+";stroke-width:"+Math.min(1,1)+";stroke-linecap:butt stroke-linejoin:miter;opacity:"+n+'" x="3.5" y="3.5"  width="7.5" height="7.5" />';break;case"roundRect":a=a+'<rect style="fill:'+r+";stroke:"+o+";stroke-width:"+Math.min(1,1)+";stroke-linecap:butt stroke-linejoin:miter;opacity:"+n+'" x="0" y="3.5" rx="2" ry="2" width="14" height="7.5" >';break;case"triangle":a=a+'<path fill="'+r+'" stroke="'+o+'" stroke-width="'+Math.min(1,1)+'"  stroke-linecap="butt" stroke-linejoin="miter" opacity="'+n+'" d="M 0 13 L 6 2 L 13 13 L 0 13 Z" ></path>';break;case"none":break;default:0===s.indexOf("path://")&&(s=s.replace("path://",'<path d="')+'"></path>',a=a.replace('viewbox="0 0 15 15"',"")),a+=s}return"none"===s?a="":a+="</svg>",a},u.compareKDBTimes=function(t,e){return t.i>e.i?1:t.i<e.i?-1:t.n>e.n?1:t.n<e.n?-1:0},u.convertPropertyIfMoment=function(t){t=I.convertISODatetimeToKDBLikeObject(t);return I.isKDBTemporal(t)?I.convertKDBTemporalToMoment(t):t},u.calculateDataMinMax=function(t){for(var e=u.sortArrayAcs(t);null===e.slice(-1)[0];)e.pop();return[_.isNaN(Number(e[0]))?null:e[0],_.isNaN(Number(e.slice(-1)[0]))?null:e.slice(-1)[0]]},u.calculateMinMaxOffset=function(t){var t=Math.abs(Number(t[1])-Number(t[0])),t=String(t).split("."),e=t[0].length-2;return 1<t.length&&"0"===t[0]?(t=Number("0."+t[1]),t=1-Math.floor(Math.log(t)/Math.log(10)+1),1/Math.pow(10,t)):Math.pow(10,e)},u.expandNestedViewStates=function(t,i){var e,a=/([a-zA-Z]+)\.[0-9]+\./,r=Object.keys(t),o=[];return(o=_.every(r,function(t){var e=i.getPropertyMeta(r[0]);return e&&"viewstate"==e.type})?_.uniq(_.filter(_.map(r,function(t){t=a.exec(t);return t?t[1]:null}))):o).length?(e={},_.each(o,function(t){return e[t]=i.getProperty(t)}),e):t},u.focus2Array=function(t){var e,i=[],a=/"([^"]*)"/g,t=t.toString?t.toString():"",r=/^\[([^\]]*)]$/.exec(t);if(null!=r){if(/^(?:"[^"\\]*(?:\\[\S\s][^"\\]*)*")(?:,"[^"\\]*(?:\\[\S\s][^"\\]*)*")*/.test(r[1]))for(;null!==(e=a.exec(r[1]));)i.push(_.map(e[1].split(","),function(t){return t.replace(/&#44;/g,",")}))}else i.push(t.split(","));return _.filter(i,function(t){return 0<(""+t).length})},u.hex2RGB=function(t){t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null},u.RGB2hex=function(t){return"#"+((1<<24)+(t[0]<<16)+(t[1]<<8)+t[2]).toString(16).slice(1)},u.clamp=function(t,e,i){return i<t?i:t<e?e:t},u.interpolateColor=function(t,e,i,a){for(var i=(i-e)/(t.length-1),a=this.clamp((a-e)/i,0,t.length-1),e=t[Math.floor(a)].type,i=t[Math.ceil(a)].type,r=this.hex2RGB(e),o=this.hex2RGB(i),n=a-Math.floor(a),s=r.slice(),l=0;l<3;l++)s[l]=Math.round(s[l]+n*(o[l]-r[l]));return this.RGB2hex(s)},u.getColumnKeysFromAxisString=function(e,t){e=0==e.indexOf("/")?e.substring(1):"^"+e.replace(/\*/g,"(.*)")+"$";try{var i=new RegExp(e);return t.getColumnNames().filter(function(t){return t.match(i)})}catch(t){return console.warn("Invalid regular expression: "+e+" : Nothing to repeat"),[]}},u.getFormatter=function(a,r,o,n){return"Number"===a||"Formatted Number"===a||"Smart Number"===a||"Datetime"===a||"Currency"===a||"SmartCurrency"===a?function(t){var e,i=t;if(null==(t="Smart Number"!==a&&"Formatted Number"!==a||_.isNumber(t)?t:_.isNumber(parseFloat(t))?parseFloat(t):t))return"";if("Smart Number"===a)i=_.isNumber(t)?I.smartFormatNumber(t,r):_.escape(t);else{if("Datetime"===a)return e=t,l.isMoment(t)||l.isDuration(t)?t.format(n):I.isKDBTemporal(t)?I.convertKDBTemporalToMoment(t).format(n):("number"==typeof t&&(e=new Date(t)),I.convertDateStringValueToMoment(e.toString()).format(n));i="Formatted Number"===a&&t.toFixed?I.formatNumber(t,r):t.toFixed?t.toFixed(r):_.escape(i)}if(o&&0<=i.toString().indexOf(".")){for(;"0"===i[i.length-1];)i=i.slice(0,-1);"."===i[i.length-1]&&(i=i.slice(0,-1))}return i}:"General"===a?function(t){return l.isMoment(t)||l.isDuration(t)?t.format():_.escape(t)}:"Boolean"===a?function(t){return _.escape(t)}:void 0},u.convertTempralToEchart=function(t,e){var i=u.TEMPORALFORMATMAP[e],a=I.convertKDBTemporalToMoment({i:t,n:0,class:"12"+e});return 14===e||13===e?t:(12!==e&&15!==e&&a.add(1970,"y").add(1,"M").add(1,"d"),t=a.format(i),new Date(t).valueOf())},u.decimalRoundToFirstDigit=function(t){var e=Number(t),i=String(t).split(".");return 1<i.length&&(i=Number("0."+i[1]),i=1-Math.floor(Math.log(i)/Math.log(10)+1),e=Number(parseFloat(String(t)).toFixed(i))),e},u.filterTooltipArraySeries=function(t){var e=[],i={};return _.each(t,function(t){i[t.seriesId]=i[t.seriesId]||[],-1===i[t.seriesId].indexOf(t.dataIndex)&&(i[t.seriesId].push(t.dataIndex),e.push(t))}),e},u.getLinearRegresionLineCoords=function(e,i,t){var a=u.linearRegression(e,i),r=void 0!==t.XAxis.min?t.XAxis.min:t.XAxis[0],o=void 0!==t.XAxis.max?t.XAxis.max:t.XAxis[1],n=void 0!==t.YAxis.min?t.YAxis.min:t.YAxis[0],t=void 0!==t.YAxis.max?t.YAxis.max:t.YAxis[1],s=0===a.slope,l=[r,a.slope*r+a.intercept],p=[o,a.slope*o+a.intercept],h="";try{h=u.linearRegressionFormulaStr(r,o,a.slope,a.intercept,!1)}catch(t){d.Log.Warn("Scatter: can not generate formula, check axis data type matching data ",e,i)}r={startXY:l,endXY:p,formula:h};if(s)console.log("! Median Line slope is 0, reverting back to x min/max");else{o=[(n-a.intercept)/a.slope,n],h=[(t-a.intercept)/a.slope,t];try{r.formula=u.linearRegressionFormulaStr(n,t,a.slope,a.intercept,!0)}catch(t){d.Log.Warn("Scatter: can not generate formula, check axis data type matching data ",e,i)}(l[1]<n||t<l[1])&&(r.startXY=o),t<p[1]&&(r.endXY=h)}return r},u.isDecimal=function(t){return-1!==String(t).indexOf(".")},u.linearRegression=function(t,e){for(var i={},a=e.length,r=0,o=0,n=0,s=0,l=0,p=0;p<e.length;p++)r+=t[p],o+=e[p],n+=t[p]*e[p],s+=t[p]*t[p],l+=e[p]*e[p];return i.slope=(a*n-r*o)/(a*s-r*r),i.intercept=(o-i.slope*r)/a,i.r2=Math.pow((a*n-r*o)/Math.sqrt((a*s-r*r)*(a*l-o*o)),2),i},u.pump=function(i){if(null!=i){if(!_.isObject(i))return i;var t=Object.getPrototypeOf(i);if(_.isObject(i)&&t!==Object.prototype&&t!==Array.prototype)return i;if(t===Array.prototype)return i.map(u.pump);var a=/^(\d+)((?:\.\w+)+)$/;if(Object.keys(i).every(function(t){return a.test(t)}))return Object.keys(i).map(function(t){var e=a.exec(t);return{index:Number(e[1]),tail:e[2].substring(1),value:i[t]}}).reduce(function(t,e){var i={};return i[e.index]={},i[e.index][e.tail]=e.value,$.extend(!0,t,u.pump(i))},[]);var r={greedy:/^(\w+)((?:\.\w+)*)$/,nonGreedy:/^(\w+)((?:\.\w+)+)$/};return Object.keys(i).some(function(t){return r.nonGreedy.test(t)})?Object.keys(i).map(function(t){var e=r.greedy.exec(t);return{head:e[1],tail:""!==e[2]?e[2].substring(1):null,value:i[t]}}).reduce(function(t,e){var i={};return null!==e.tail?(i[e.head]={},i[e.head][e.tail]=e.value):i[e.head]=e.value,$.extend(!0,t,u.pump(i))},{}):_.mapValues(i,u.pump)}},u.linearRegressionFormulaStr=function(t,e,i,a,r){t=u.isDecimal(t)?u.decimalRoundToFirstDigit(t):t,e=u.isDecimal(e)?u.decimalRoundToFirstDigit(e):e,i=u.isDecimal(i)?u.decimalRoundToFirstDigit(i):i,a=u.isDecimal(a)?u.decimalRoundToFirstDigit(a):a;return r?"[x = ("+t+" - ("+a+")) / "+i+", y = "+t+"]\n[x = ("+e+" - ("+a+")) / "+i+", y = "+e+"]":"[x = "+t+", y = (("+i+" * "+t+") + ("+a+")]\n[x = "+e+", y = (("+i+" * "+e+") + ("+a+")]"},u.replaceViewStates=function(i,t,s,l){var p=function(t,e){return function i(t,e,a){a=a?a+".":"";e+="";var r=l.getPropertyMeta(a+e);{var o,n;return r&&"data"===r.type?t:r&&"viewstate"===r.type?(n=(a+e).split("."),o=n.pop(),n=n.join("."),s(n,o,t,r)):!_.isArray(t)&&!_.isObject(t)||t.has&&t.has("_dataSource")&&t.has("_dataType")?t:(a+=e,p=function(t,e){return i(t,e,a)},(h=_.isArray(t)?_.map:_.mapValues)(t,p))}}(t,e,i||"")},h=_.isArray(t)?_.map:_.mapValues;return h(t,p)},u.replaceViewStatesWithValue=function(t,e,i){return u.replaceViewStates(t,e,function(t,e,i,a){return a.value!==i&&console.warn("viewModel value has changed"),a.value},i)},u.replaceViewStatesWithModel=function(t,e,r){return u.replaceViewStates(t,e,function(t,e,i,a){if(i instanceof o.Model&&i.get("_viewType"))return i;t=r.getProperty(t)[e];return _.isUndefined(i)?void 0:(t.get("value")!==i&&(console.warn("viewModel value has changed"),t.set("value",i)),t)},r)},u.alpha=function(t,e){var i=this.hex2RGB(t);return i?"rgba("+i[0]+","+i[1]+","+i[2]+","+e/100+")":new Color(t).alpha(e/100).rgbaString()},u.colorFactory=function(t,e,i){void 0===e&&(e="#4f6aa6"),void 0===i&&(i=80);var a={};return a[t+"Color"]={title:t.replace("Point","").replace("Hover","Hover ").replace("Border","Border ").replace("Background","Background ")+"Color",type:"gradient",default:e,options:{gradient:!1}},a[t+"Opacity"]={title:t.replace("Point","").replace("Hover","Hover ").replace("Border","Border ").replace("Background","Background ")+"Opacity",default:i,minimum:0,maximum:100,type:"number",step:1,format:"range"},a},u.backgroundFactory=function(t){return u.colorFactory(t+"Background")},u.borderFactory=function(t){var e={};return e[t+"BorderWidth"]={title:t.replace("Point","").replace("Hover","Hover ")+" Border Width",type:"number",format:"range",default:2.01,minimum:.01,maximum:10.01},$.extend(!0,{},u.colorFactory(t+"Border"),e)},u.radiusFactory=function(t){var e={};return e[t+"Radius"]={title:t.replace("Point","").replace("Hover","Hover ").replace("Hit","Hit ")+"Radius",type:"number",format:"range",default:0,minimum:0,maximum:10},e},u.sortArrayAcs=function(t){return _.clone(t).sort(function(t,e){return Number(null===t)-Number(null===e)||+(e<t)||-(t<e)})},u.typeFactory=function(t){return{_Type:{type:"string",default:t,options:{hidden:!0}}}},u.TEMPORALFORMATMAP={12:"YYYY-MM-DD HH:mm:ss.SSSSSSSSS",13:"YYYY-MM",14:"YYYY-MM-DD",15:"YYYY-MM-DD HH:mm:ss.SSS",16:"YYYY-MM-DD HH:mm:ss.SSSSSSSSS",17:"YYYY-MM-DD HH:mm",18:"YYYY-MM-DD HH:mm:ss",19:"YYYY-MM-DD HH:mm:ss.SSS"},u.hash=function(t){var e=Date.now().valueOf()+t.toString();if(Array.prototype.reduce)return e.split("").reduce(function(t,e){return(t=(t<<5)-t+e.charCodeAt(0))&t},0)+"";var i=0;if(0===e.length)return i+"";for(var a=0;a<e.length;a++){i=(i<<5)-i+e.charCodeAt(a);i&=i}return i+""};var y=u;function u(){}s=o.DeepModel,e(h,s),h.prototype.onAxisLabelPropChanged=function(t,e){var i=this,a=t.changed;_.each(_.keys(a),function(t){a.Labels&&0===a.Labels.Interval&&(i.axisForceResetChart=!0)}),this.trigger("updateChartAxis"),this.axisForceResetChart=!1},h.prototype.onAxisPropChanged=function(t,e){this.trigger("updateChartAxis")},h.prototype.getLabel=function(){return this.get("_Hidden._Label")},h.prototype.getType=function(){return this.get("_Hidden._Type")},h.prototype.isNumerical=function(){return _.includes(["linear","logarithmic"],this.get("_Hidden._Type"))},h.singular=function(t){return t.replace("e","i")},h.plural=function(t){return t.replace("i","e")},h.camelCase=function(t){return t.replace("X","x").replace("Y","y")};var s,p=h;function h(t,e,i,a){var r=s.call(this,t)||this,t=(r.axisForceResetChart=!1,r.api=e,r.key=i,r.appView=a,["change:_Hidden._Type change:DisplayAxis change:Position change:Title change:Range.RuleMin change:Range.RuleMax change:SplitLine"].join(""));return r.listenTo(r,t,r.onAxisPropChanged),r.listenTo(r,"change:Labels",r.onAxisLabelPropChanged),r.listenTo(r,"change:Range.UseMinMax",function(t,e){var i=t.changed,a=t.key,i=i.Range;1===_.keys(i).length?(i=i.UseMinMax,a=h.plural(a)+"."+t.collection.findIndex(t)+".Range.UseDataRange",r.api.setProperty(a,i),i===t.get("Range.UseDataRange")&&r.onAxisPropChanged(t,e)):r.onAxisPropChanged(t,e)}),r.listenTo(r,"change:Range.UseDataRange",function(t,e){var i=t.changed;t.key,i.Range;r.onAxisPropChanged(t,e)}),r}c=o.Collection,e(m,c),m.prototype.modelId=function(t){return t._Hidden._AxisId+t._Hidden._Type};var c,B=m;function m(){var t=null!==c&&c.apply(this,arguments)||this;return t.model=p,t}var j=["Chart1","Chart2","Chart3","Chart4"],V=(g.setDefaultAxisColumns=function(o,n){var s=n[0],l=1<n.length?_.clone(n).splice(1):[s];_.each(j,function(t,e){var i="Charts."+t+".XAxisData",t="Charts."+t+".YAxisData",a=_.get(o,i),r=_.get(o,t),e=l[e]||l[l.length-1];a&&_.includes(n,a)||_.set(o,i,s),r&&_.includes(n,r)||_.set(o,t,e)})},g.quartetAddAxis=function(a,t,e,i){var r,o=e.replace("root.","").split("."),n=o[0];1===o.length&&(o="XAxes"===n?"_PossibleXAxes":"_PossibleYAxes",e=a[e],r=[],_.each(e,function(t,e){var i=n.replace("e","i")+" "+(e+1),t=t._Hidden._AxisId;r.push(i),_.set(a,n+"["+e+"]_Hidden._Index",e),_.set(a,n+"["+e+"]_Hidden._Label",i),t||_.set(a,n+"["+e+"]_Hidden._AxisId",_.uniqueId("axis_"))}),_.set(a,"Charts._Hidden."+o,r)),i(a,t)},g.data=function(i,a,t,r){var o="matrix"===i.Basics.ChartType,n=i.MatrixCols;"root"===t||"Basics.Data"===t||"Basics.ChartType"===t?("root"!==t&&"Basics.ChartType"!==t||(a=g.chartType(i,a,t,r)),i.Basics.Data?i.Basics.Data.getMeta(function(t){var t=_.fromPairs(_.map(t.columns.collection.models,function(t){return[t.get("id"),t.toJSON()]})),e=_.keys(t);i.possibleKeys=e,o?n.length&&_.each(n,function(t){_.includes(e,t.MatrixColId)||(t.MatrixColId="")}):g.setDefaultAxisColumns(i,e),r(i,a)}):(i.possibleKeys=[],r(i,a))):"XAxes"===t||"YAxes"===t?g.quartetAddAxis(i,a,t,r):r()},g.chartType=function(t,e,i,a){return"matrix"===t.Basics.ChartType?(e.properties.Legend.options.hidden=!0,e.properties.XAxes.options.hidden=!0,e.properties.YAxes.options.hidden=!0,e.properties.Charts.options.hidden=!0,e.properties.MatrixCols.options.hidden=!1,e.properties.Style.properties.AxisPadding.options.hidden=!1,e.properties.MatrixXAxes.options.hidden=!1,e.properties.MatrixYAxes.options.hidden=!1):(e.properties.MatrixCols.options.hidden=!0,e.properties.Style.properties.AxisPadding.options.hidden=!0,e.properties.MatrixXAxes.options.hidden=!0,e.properties.MatrixYAxes.options.hidden=!0,e.properties.Legend.options.hidden=!1,e.properties.XAxes.options.hidden=!1,e.properties.YAxes.options.hidden=!1,e.properties.Charts.options.hidden=!1),e},g.matrixColumns=function(t,e,i,a){"root.MatrixCols"===i?(_.each(t,function(t,e){t._Hidden._ColId||(t._Hidden._ColId=_.uniqueId("col_")),t._Hidden._Index=e}),a(t,e)):a()},g);function g(){}var f=["YYYY-MM-DD","YYYY-MMM-DD","YYYY-MMMM-DD","YYYY-MM","YYYY-MMM","YYYY-MMMM","MMM DD","MMM Do","YYYY-MM-DD HH:mm:ss","YYYY-MM-DD hh:mm:ss","YYYY-MM-DD kk:mm:ss","hh:mm:ss","HH:mm:ss","kk:mm:ss","hh:mm:ss.SS","hh:mm","HH:mm","kk:mm","mm:ss","mm:ss.SS"],z=["Verdana","fontawesome","Arial","Helvetica","Times","Courier"],G={Chart1:{PlotColor:"#DB5F5B"},Chart2:{PlotColor:"#5a6d7b"},Chart3:{PlotColor:"#86BEC4"},Chart4:{PlotColor:"#EA9F85"}},K=["linear","category","logarithmic","time"],x="XAxis 1",C="YAxis 1",U='\n<table class="scatter-tooltip" style="{{fontSize}}">\n  <thead>\n    <tr style="padding-right: 10px;">\n      <th>\n        {{xLabel}}\n      </th>\n      <th></th>\n    </tr>\n  </thead>\n  {{#each points}}\n    <tr>\n      <td>\n        {{#if noSvg}}\n            <i class="fa {{iconFa}}" style="color:{{plotColor}}"></i>\n        {{else}}\n            <svg width="12" height="12">\n                <rect width="12" height="12" style="fill: {{plotColor}}"></rect>\n            </svg>\n        {{/if}}\n      </td>\n      <td>\n        {{chartName}}\n        :\n      </td>\n      <td style="padding-right: 10px; text-align: left;">\n        {{layerData}}\n      </td>\n    </tr>\n  {{/each}}\n</table>\n',b=(S.getComponentDefinition=function(t){var e,i,a={id:13,componentName:"Scatter",componentDescription:"Scatter Plot Matrix and Anscombe's quartet",appKey:"Scatter",ghostViewThumb:null,buildViewThumb:null,appArgs:{quickStart:[{path:"Basics.Data"}],json:{version:"4.6.0",Basics:{Data:"",ChartType:"matrix",LargeDataThreshold:500},Overlay:{Display:!1,TooltipAxisPointerType:"dashed",FillOpacity:80,FontSize:12,FixedPosition:!1,Snap:!0,UseCustomTooltip:!1,CustomTooltip:U},Charts:A.Charts,MatrixCols:[{MatrixColId:"",ColumnTitle:"",Precision:2,HideTrailingZeroes:!1,DateFormat:"YYYY-MM-DD",Prefix:"",Suffix:"",_Hidden:{_ColId:"col_00001",_Index:0}}],MatrixXAxes:S.axisCommonOptions("XAxis",!0),MatrixYAxes:S.axisCommonOptions("YAxis",!0),XAxes:A.XAxes,YAxes:A.YAxes,Legend:A.Legend,Style:{AxisPadding:5,MatrixBrushTool:void 0,advanced:""},possibleKeys:[""],possibleXAxes:[x],possibleYAxes:[C]},schema:{type:"object",title:"Properties",_transform:V.data,properties:{possibleKeys:{type:"readOnlyArray",propertyOrder:1,format:"table",items:{type:"string"},default:["sym"],options:{collapsed:!0,hidden:!0}},possibleXAxes:{type:"readOnlyArray",propertyOrder:1,format:"table",items:{type:"string"},default:[x],options:{collapsed:!0,hidden:!0}},possibleYAxes:{type:"readOnlyArray",propertyOrder:1,format:"table",items:{type:"string"},default:[C],options:{collapsed:!0,hidden:!0}},Basics:{propertyOrder:2,type:"object",title:"Basics",options:{collapsed:!1},properties:{Data:{propertyOrder:1,type:"data",title:"Data Source"},ChartType:{propertyOrder:10,type:"string",title:"Chart Type",default:"matrix",enum:["quartet","matrix"]},LargeDataThreshold:{type:"number",propertyOrder:20,title:"Large Data Threshold",format:"number",default:500}}},Overlay:{propertyOrder:2,type:"object",title:"Overlay",options:{collapsed:!0},properties:{Display:{propertyOrder:1,type:"boolean",title:"Display",format:"checkbox",default:!1},TooltipAxisPointerType:{propertyOrder:10,type:"string",title:"Type",default:"cross",enum:["solid","dashed","dotted"]},Snap:{propertyOrder:11,type:"boolean",title:"Snap To Label Point",format:"checkbox",default:!0},FillOpacity:{propertyOrder:12,type:"number",title:"Tooltip Opacity",format:"range",minimum:0,maximum:100,default:80},FontSize:{propertyOrder:25,type:"number",format:"number",title:"Tooltip Font Size",default:12},FixedPosition:{type:"boolean",propertyOrder:200,format:"checkbox",title:"Fixed Position",default:!1},UseCustomTooltip:{type:"boolean",propertyOrder:319,format:"checkbox",title:"Use Custom Tooltip",default:!1},CustomTooltip:{propertyOrder:666,type:"tooltipTemplate",disableTree:!0,title:"Custom tooltip",data:["series","values"],default:U}}},MatrixCols:{type:"array",propertyOrder:5,title:"Data columns",format:"object",uniqueItems:!1,options:{collapsed:!0,hidden:!1,reset:!0},items:{headerTemplate:"Col {{i1}}",type:"object",properties:{MatrixColId:{propertyOrder:1,title:"Column Name",type:"customDropdown",data:"possible_columns",default:"",watch:{possible_columns:"root.possibleKeys"}},ColumnTitle:{propertyOrder:2,type:"string",title:"Column Axis Name",default:""},Precision:{type:"number",propertyOrder:10,title:"Decimal Places",format:"number",minimum:0,maximum:10,default:2},HideTrailingZeroes:{propertyOrder:15,type:"boolean",title:"Hide Trailing Zeroes",format:"checkbox",default:!1},DateFormat:{propertyOrder:20,type:"string",title:"Date/Time format",enum:f,default:"YYYY-MM-DD"},Prefix:{type:"string",propertyOrder:21,default:""},Suffix:{type:"string",propertyOrder:22,default:""},_Hidden:{type:"object",options:{hidden:!0},properties:{_ColId:{type:"string",options:{hidden:!0}},_Index:{type:"number",options:{hidden:!0}}}}}},_transform:V.matrixColumns},Charts:{propertyOrder:5,type:"object",title:"Charts",id:"chartsObj",options:{hidden:!0},properties:_.extend(!0,{},S.chartFactory(),{_Hidden:{type:"object",options:{hidden:!0},properties:{_PossibleXAxes:{type:"array",items:{type:"string"},options:{hidden:!0}},_PossibleYAxes:{type:"array",items:{type:"string"},options:{hidden:!0}}}}})},MatrixXAxes:S.matrixAxesFactory("XAxes",8),MatrixYAxes:S.matrixAxesFactory("YAxes",9),XAxes:S.axesFactory("XAxes",10),YAxes:S.axesFactory("YAxes",11),Legend:{propertyOrder:15,type:"object",title:"Legend",options:{collapsed:!0,hidden:!0},properties:{Display:{propertyOrder:1,type:"boolean",title:"Display",format:"checkbox",default:void 0},ItemGap:{propertyOrder:5,type:"number",title:"Legend Gap",default:void 0},LegendPosition:{type:"string",title:"Legend Position",default:"top",enum:["top","bottom","left","right"]},SelectedMode:{propertyOrder:20,type:"string",title:"Legend Selection Mode",default:void 0,enum:["single","multiple","disabled"]},UseHtml:{propertyOrder:30,type:"boolean",title:"Use Html Legends",format:"checkbox",default:void 0,options:{hidden:!0}}}},Style:{propertyOrder:100,type:"object",title:"Style",options:{collapsed:!0},properties:{AxisPadding:{propertyOrder:10,type:"number",title:"Matrix Axis Padding",minimum:0,maximum:100,default:5,options:{hidden:!1}},MatrixBrushTool:{propertyOrder:30,type:"boolean",title:"Matrix Enable Brush Tools",format:"checkbox",default:void 0,options:{hidden:!0}},advanced:{type:"css",title:"Advanced CSS",propertyOrder:2,default:""}}}}}}};if(0<_.keys(t.settingsModel.attributes).length)for(i=S.upgrades.indexOf(_.find(S.upgrades,{version:t.settingsModel.get("version")}))+1;i<S.upgrades.length;i+=1)(e=S.upgrades[i]).fn(t.settingsModel),t.settingsModel.set("version",e.version);return a},S.chartsOptions=function(t){return{XAxisID:x,XAxisData:"",YAxisID:C,YAxisData:"",DisplayChart:!0,Legend:{LegendName:"",Icon:"",IconFa:"fa-circle",LegendColor:""},Radius:{FixedRadius:!0,FixedSize:10,RadiusData:"",RadiusScaling:1},PlotStyles:{PlotColor:G[t].PlotColor,PlotShape:"circle"},MarkLine:{DisplayLine:!0,Animation:!1,ForceSpan:!1,LineType:"solid",LineWidth:1,LineColor:"",FormulaPosition:"end",ShowLineFormula:!1,ShowLineTooltip:!0,MarkLineFontSize:12},Crosshair:{Format:"General",Precision:2,HideTrailingZeroes:!1,Interval:0,DateFormat:"YYYY-MM-DD"}}},S.axisCommonOptions=function(t,e){var i={Labels:{LabelFont:"Verdana",LabelFontSize:12,LabelFontStyle:"normal",LabelRotate:e?30:0,LabelColor:"",LabelSize:2},SplitLine:{LineStyle:"solid",LineColor:"",LineOpacity:10},Title:{AxisTitleSize:12,NameColor:"",TitleOffset:20}},t={Position:"XAxis"===t?"bottom":"left",DisplayAxis:!0,Labels:{Format:"General",DisplayLabel:!0,Precision:2,HideTrailingZeroes:!1,Interval:0,DateFormat:"YYYY-MM-DD",Prefix:"",Suffix:""},Range:{UseMinMax:!1,UseDataRange:!1,RuleMin:0,RuleMax:10},Title:{AxisTitleSize:12,NameColor:"",Name:"",TitleOffset:20},_Hidden:{_AxisId:_.uniqueId("axis_"),_Index:0,_Label:"XAxis"===t?x:C,_Type:"linear"}};return e||_.extend(i,t),i},S.axesFactory=function(i,t){var a={items:{headerTemplate:p.singular(i)+" {{ i1 }}",id:"arrItem",title:i,type:"object",oneOf:[]},options:{hidden:!0},propertyOrder:t,type:"array"},r="XAxes"===i?["bottom","top"]:["left","right"];return _.each(K,function(t){var e={_Hidden:{type:"object",options:{hidden:!0},properties:{_AxisId:{type:"string",options:{hidden:!0},default:""},_Index:{type:"number",options:{hidden:!0},default:0},_Label:{type:"string",options:{hidden:!0}},_Type:{type:"string",options:{hidden:!0},default:t}}}},t={title:t,options:{collapsed:!0,linked_oneof_property:{property:"_Hidden._Type",value:t}},properties:_.extend(!0,{DisplayAxis:{propertyOrder:1,type:"boolean",title:"Display",format:"checkbox",default:!0},Position:{propertyOrder:2,type:"string",default:r[0],enum:r}},S.rangeFactory(),S.labelFactory(p.singular(i)),S.titleFactory(p.singular(i)),S.splitLineFactory(),e)};a.items.oneOf.push(t)}),a},S.matrixAxesFactory=function(t,e){return{type:"object",propertyOrder:e,title:t,options:{collapsed:!0,hidden:!1},properties:_.extend(!0,S.labelFactory(p.singular(t),!0),S.splitLineFactory(),S.titleFactory())}},S.rangeFactory=function(){return{Range:{type:"object",propertyOrder:4,title:"Range",options:{collapsed:!0},properties:{UseMinMax:{propertyOrder:1,type:"boolean",title:"Use Min/Max",format:"checkbox",default:!1},UseDataRange:{propertyOrder:2,type:"boolean",title:"Use Data Range",format:"checkbox",default:!1},RuleMin:{propertyOrder:3,type:"number",title:"Rule Min",format:"number",default:0,options:{hidden:!1}},RuleMax:{propertyOrder:4,type:"number",title:"Rule Max",format:"number",default:10,options:{hidden:!1}}}}}},S.labelFactory=function(t,e){return{Labels:{propertyOrder:5,type:"object",title:"Labels",options:{collapsed:!0},properties:_.extend({},{LabelFont:{propertyOrder:15,type:"string",title:"Label Font",enum:z,default:"Verdana"},LabelFontSize:{propertyOrder:16,type:"number",title:"Label Size",default:12},LabelFontStyle:{propertyOrder:20,type:"string",title:"Font Style",default:"normal",enum:["normal","bold","oblique","italic"]},LabelRotate:{type:"number",propertyOrder:21,title:"Label Rotation",format:"number",minimum:0,maximum:360,default:0},LabelColor:{propertyOrder:22,type:"gradient",title:"Font Colour",options:{noColor:!0},default:""},LabelSize:{type:"number",propertyOrder:30,title:"Label "+("XAxis"===t?"Height":"Width"),format:"number",minimum:2,maximum:100,default:2,options:{hidden:!0}}},e?{}:{Format:{propertyOrder:2,type:"string",title:"Format",default:"General",enum:["General","Number","Smart Number","Formatted Number","Datetime"]},DisplayLabel:{propertyOrder:1,type:"boolean",title:"Display",format:"checkbox",default:!0},Precision:{type:"number",propertyOrder:3,title:"Decimal Places",format:"number",minimum:0,maximum:10,default:2},HideTrailingZeroes:{propertyOrder:4,type:"boolean",title:"Hide Trailing Zeroes",format:"checkbox",default:!1},Interval:{type:"number",propertyOrder:9,title:"Label Display Interval",format:"number",default:0,options:{hidden:!0}},DateFormat:{propertyOrder:10,type:"string",title:"Date/Time format",enum:f,default:"YYYY-MM-DD"},Prefix:{type:"string",propertyOrder:11,default:""},Suffix:{type:"string",propertyOrder:12,default:""}})}}},S.titleFactory=function(t){var e={Title:{propertyOrder:5,type:"object",title:"Title",options:{collapsed:!0},properties:{AxisTitleSize:{propertyOrder:5,type:"number",title:"Axis Title Size",default:12},NameColor:{propertyOrder:10,type:"gradient",title:"Name Colour",options:{noColor:!0},default:""},TitleOffset:{propertyOrder:20,title:"Axis Name Offset",default:20,type:"number"}}}};return t&&(e.Title.properties.Name={propertyOrder:1,type:"string",title:"Axis Name",default:" "}),e},S.splitLineFactory=function(){return{SplitLine:{propertyOrder:20,type:"object",title:"Gridlines",options:{collapsed:!0},properties:{LineStyle:{propertyOrder:1,type:"string",title:"Line Style",default:"solid",enum:["solid","dashed","dotted"]},LineColor:{propertyOrder:2,type:"gradient",title:"Line Colour",options:{noColor:!0},default:""},LineOpacity:{propertyOrder:3,type:"number",title:"Line Opacity",format:"range",minimum:0,maximum:100,default:10}}}}},S.chartFactory=function(){for(var t={},e=1;e<5;e+=1){var i="Chart"+e,a={XAxisID:{propertyOrder:1,default:"",title:"X Axis ID",type:"string",enumSource:"possible_axis",watch:{possible_axis:"chartsObj._Hidden._PossibleXAxes"}},XAxisData:{propertyOrder:2,title:"X Axis Data",type:"customDropdown",data:"possible_columns",watch:{possible_columns:"root.possibleKeys"}},YAxisID:{propertyOrder:3,title:"Y Axis ID",type:"string",enumSource:"possible_axis",watch:{possible_axis:"chartsObj._Hidden._PossibleYAxes"}},YAxisData:{propertyOrder:4,default:"",title:"Y Axis Data",type:"customDropdown",data:"possible_columns",watch:{possible_columns:"root.possibleKeys"}},DisplayChart:{propertyOrder:5,type:"boolean",title:"Display",format:"checkbox",default:!0},Legend:{propertyOrder:14,type:"object",title:"Legend",options:{collapsed:!0},properties:{LegendName:{propertyOrder:1,type:"string",title:"Legend Name",default:""},Icon:{propertyOrder:5,type:"string",title:"Icon Custom",default:""},IconFa:{title:"Icon ",propertyOrder:10,type:"icon",default:"fa-circle",iconTypes:"fa"},LegendColor:{propertyOrder:20,type:"gradient",title:"Legend Text Colour",options:{noColor:!0},default:""}}},Radius:{propertyOrder:15,type:"object",title:"Radius",options:{collapsed:!0},properties:{FixedRadius:{propertyOrder:1,type:"boolean",title:"Fixed Radius",format:"checkbox",default:!0},FixedSize:{propertyOrder:2,type:"number",title:"Fixed Size",default:12},RadiusData:{propertyOrder:3,default:"",title:"Radius Data",type:"customDropdown",data:"possible_columns",watch:{possible_columns:"root.possibleKeys"}},RadiusScaling:{propertyOrder:4,type:"number",title:"Radius Scaling",default:1}}},PlotStyles:{propertyOrder:16,type:"object",title:"Plot Styles",options:{collapsed:!0},properties:{PlotColor:{type:"gradient",title:"Plot Colour",options:{noColor:!1},default:G[i].PlotColor},PlotShape:{propertyOrder:6,type:"string",title:"Plot Shape",default:"circle",enum:["circle","rect","roundRect","triangle","diamond","pin","arrow","none"]}}},MarkLine:{propertyOrder:16,type:"object",title:"Mark Line",options:{collapsed:!0},properties:{DisplayLine:{propertyOrder:1,type:"boolean",title:"Display",format:"checkbox",default:!0},Animation:{propertyOrder:4,type:"boolean",title:"Animation",format:"checkbox",default:!1},ForceSpan:{propertyOrder:5,type:"boolean",title:"Force Line Grid Span",format:"checkbox",default:!1},LineType:{propertyOrder:6,type:"string",title:"Line Style",default:"solid",enum:["solid","dashed","dotted"]},LineWidth:{propertyOrder:7,type:"number",title:"Line Width",default:1},LineColor:{propertyOrder:8,type:"gradient",title:"Line Colour",options:{noColor:!0},default:""},FormulaPosition:{propertyOrder:9,type:"string",title:"Formula Position",default:"end",enum:["start","middle","end"]},ShowLineFormula:{propertyOrder:10,type:"boolean",title:"Show Line Formula",format:"checkbox",default:!1},ShowLineTooltip:{propertyOrder:12,type:"boolean",title:"Show Line Tooltip",format:"checkbox",default:!0},MarkLineFontSize:{propertyOrder:15,type:"number",title:"Formula/Tooltip Font Size",default:12}}},Crosshair:{propertyOrder:16,type:"object",title:"Crosshair",options:{collapsed:!0},properties:{Format:{propertyOrder:2,type:"string",title:"Format",default:"General",enum:["General","Number","Smart Number","Formatted Number","Datetime"]},Precision:{type:"number",propertyOrder:3,title:"Decimal Places",format:"number",minimum:0,maximum:10,default:2},HideTrailingZeroes:{propertyOrder:4,type:"boolean",title:"Hide Trailing Zeroes",format:"checkbox",default:!1},Interval:{type:"number",propertyOrder:9,title:"Label Display Interval",format:"number",default:0},DateFormat:{propertyOrder:10,type:"string",title:"Date/Time format",enum:f,default:"YYYY-MM-DD"}}}};t[i]={type:"object",propertyOrder:3,title:"Chart "+e,options:{collapsed:!0},properties:_.extend(!0,{},a)}}return t},S.defaults=function(){return S.getComponentDefinition({settingsModel:new o.Model}).appArgs.json},S);function S(){}var A={XAxes:[b.axisCommonOptions("XAxis")],YAxes:[b.axisCommonOptions("YAxis")],Charts:{Chart1:b.chartsOptions("Chart1"),Chart2:b.chartsOptions("Chart2"),Chart3:b.chartsOptions("Chart3"),Chart4:b.chartsOptions("Chart4"),_Hidden:{_PossibleXAxes:[x],_PossibleYAxes:[C]}},Legend:{Display:!0,ItemGap:10,LegendPosition:"top",SelectedMode:"multiple",UseHtml:!1}},D=(b.upgrades=[{version:"4.6.0",fn:function(e){var i={Legend:A.Legend,XAxes:A.XAxes,YAxes:A.YAxes,Charts:A.Charts};_.each(_.keys(i),function(t){void 0===e.get(t)&&e.set(t,i[t])})}}],M.THEMECOLORSCHEME={dark:{font:"#fff",inverse:"#000"},light:{font:"#000",inverse:"#fff"}},M.DEFAULTSETTINGS={fontFamilyLegend:"Verdana",fontFamilyLabel:"Verdana",tooltipOpacity:80,pointsColor:"#3d50ff"},M.ICON_LOCATION=require.toUrl("QuickBase").replace("/main","")+"/images/black/",M.ICON_LOCATION_LIGHT=require.toUrl("QuickBase").replace("/main","")+"/images/white/",M);function M(){}v=o.DeepModel,e(O,v),O.prototype.onColumnPropChanged=function(t,e){t.changed;this.trigger("updateMatrixChart",!0)};var v,W=O;function O(t){t=v.call(this,t)||this;return t.listenTo(t,"change",t.onColumnPropChanged),t}T=o.Collection,e(L,T),L.prototype.modelId=function(t){return t._Hidden._ColId};var T,q=L;function L(){var t=null!==T&&T.apply(this,arguments)||this;return t.model=W,t}Z=o.DeepModel,e(Y,Z),Y.prototype.calculateAxisMinMax=function(n,s){var l={XAxis:{},YAxis:{}};return _.each(Y.AXISKEYS,function(t){var e,i,a,r,o=s[t].axisModel;null!==o&&(e=o.get("Range.UseMinMax"),i=o.get("Range.UseDataRange"),r=y.calculateMinMaxOffset(n[t]),a=Number(n[t][0])-r,r=Number(n[t][1])+r,e&&!i?(a=o.get("Range.RuleMin"),r=o.get("Range.RuleMax")):e&&i&&(a=n[t][0],r=n[t][1]),l[t]={min:a,max:r})}),l},Y.prototype.onChartsDataChanged=function(t,e){var i=this;_.each(t.get("Charts"),function(t,e){i.chartData[e]&&(i.chartData[e].dataColsSet=!!t.XAxisData&&!!t.YAxisData)}),this.updateChartData()},Y.prototype.onAxisPropChanged=function(){this.updateChartData()},Y.prototype.onChartsPropChanged=function(t,e){this.updateChartData()},Y.prototype.onChartsLegendChanged=function(t,e){var i=this,t=t.changed.Charts;_.each(t,function(t,e){t=t.Legend&&void 0!==t.Legend.LegendName?t.Legend.LegendName:null;null!==t&&(i.chartData[e].name=t)}),this.updateChartData()},Y.prototype.onChartsRadiusChanged=function(t,e){this.updateChartData()},Y.prototype.onChartsHiddenChanged=function(t,e){var i=this;_.each(Y.CHARTKEYS,function(t){var e=i.get("Charts."+t);i.chartData[t].hidden=!e.DisplayChart}),this.forceResetChart=!0,this.updateChartData()},Y.prototype.getAxisDataOptions=function(t,e){return null!==this.chartAxis[t][e].data?{data:this.chartAxis[t][e].data}:{}},Y.prototype.getAxisMiscOptions=function(t){var e={};return"category"===t.getType()&&(e.boundaryGap=!1),e},Y.prototype.prepareAxisOptions=function(){var d=this;_.each(this.chartData,function(p,h){p.dataComplete&&_.each(Y.AXISKEYS,function(t,e){var i,a,r,o,n,s=d.chartAxis[h][t].axisModel,l=d.chartAxis[h][Y.REVERSEAXISKEYS[t]].axisModel;null!==s&&(i={},e=d.generateAxisNestedOptions(p,s,t,e),a=d.getMinMaxOptions(h,t,s),r=d.getAxisDataOptions(h,t),l=d.getAxisTitleOptions(s,l),o=d.getAxisMiscOptions(s),n={gridId:p.id,id:p.id,show:!p.hidden,type:Y.AXISTYPESMAP[s.getType()],position:s.get("Position")},s.get("Labels.Interval")&&(n.interval=s.get("Labels.Interval")),i=_.extend({},n,l,a,r,o),d.chartAxis[h][t].options=_.extend({},i,e))})})},Y.prototype.generateAxisFormatter=function(t){return y.getFormatter(t.get("Labels.Format"),t.get("Labels.Precision"),t.get("Labels.HideTrailingZeroes"),t.get("Labels.DateFormat"))},Y.prototype.getAxisDataRangeMinMax=function(t,e){var i={},t=this.chartData[t].dataMinMax[e];return i=t.length&&_.isNumber(t[0])&&_.isNumber(t[1])?{min:t[0],max:t[1]}:i},Y.prototype.generateAxisNestedOptions=function(i,a,t,e){var r=this,o=i.dataTypes[t],n=i.rawData[e],s=e=D.THEMECOLORSCHEME[this.theme].font,l=a.get("Labels.DisplayLabel")&&a.get("DisplayAxis"),e=a.get("Labels.LabelColor")?a.get("Labels.LabelColor"):e,s=(a.get("SplitLine.LineColor")&&(s=a.get("SplitLine.LineColor")),{splitLine:{show:!0,lineStyle:{opacity:a.get("SplitLine.LineOpacity")/100,color:s,type:a.get("SplitLine.LineStyle")}}}),l={show:l,color:e,rotate:a.get("Labels.LabelRotate"),formatter:function(t,e){return r.getLabelFormatter(i,a,t,n[e],o)},fontFamily:a.get("Labels.LabelFont"),fontSize:a.get("Labels.LabelFontSize"),fontStyle:a.get("Labels.LabelFontStyle")};return this.chartAxis[i.key][t].labelSize=a.get("Labels.LabelSize"),_.extend({},{axisLine:{show:a.get("DisplayAxis"),lineStyle:{color:e},onZero:!1},axisTick:{show:a.get("DisplayAxis"),lineStyle:{color:e}},axisLabel:l},s)},Y.prototype.getAxisTitleOptions=function(t,e){var i={},a=D.THEMECOLORSCHEME[this.theme].font,r=t.get("Position"),o=t.get("Title.TitleOffset"),o={left:[0,0,o,0],right:[0,0,o,0],top:[0,0,o,0],bottom:[o,0,0,0]},n=t.get("Title.Name");return n&&(a=t.get("Title.NameColor")?t.get("Title.NameColor"):a,i={name:n,nameLocation:"middle",nameRotate:{left:90,right:270,top:0,bottom:0}[r],nameTextStyle:{padding:o[r],color:a,fontSize:t.get("Title.AxisTitleSize")}}),i},Y.prototype.getChartData=function(t){var t=this.chartData[t].data,e=[];return t.length&&t[0].length===t[1].length&&t[2]?e=_.zipWith(t[0],t[1],t[2],function(t,e,i){t=[t,e];return void 0!==i&&_.isNumber(i)&&t.push(i=i<0?0:i),t}):console.log("x and y Axis data has different length"),e},Y.prototype.getMarkLine=function(t){var e,i,a,r,o,n,s={};return this.chartData[t].dataComplete&&(e=this.chartData[t].markLine,i=this.get("Charts."+t+".MarkLine.MarkLineFontSize"),a=this.get("Charts."+t+".MarkLine.ShowLineFormula"),r=this.get("Charts."+t+".MarkLine.ShowLineTooltip"),o=this.get("Charts."+t+".MarkLine.FormulaPosition")||"middle",n=this.chartData[t].markLine.formula,s={animation:this.get("Charts."+t+".MarkLine.Animation"),label:{show:a,formatter:n||"",position:o,textStyle:{align:{start:"left",middle:"center",end:"right"}[o],fontSize:i}},lineStyle:{type:this.get("Charts."+t+".MarkLine.LineType"),color:this.get("Charts."+t+".MarkLine.LineColor"),width:this.get("Charts."+t+".MarkLine.LineWidth")},tooltip:{show:r,formatter:n?n.replace("\n","</br>"):"",textStyle:{fontSize:i}},data:[[{coord:e.startXY,symbol:"none"},{coord:e.endXY,symbol:"none"}]]}),s},Y.prototype.getMinMaxOptions=function(t,e,i){var a={},r=this.chartAxis[t][e].scales.min,o=this.chartAxis[t][e].scales.max;return i.get("Range.UseMinMax")?i.get("Range.UseDataRange")&&this.dataSource?a=this.getAxisDataRangeMinMax(t,e):(a.min=i.get("Range.RuleMin"),a.max=i.get("Range.RuleMax")):null!==r&&null!==o&&(a.min=r,a.max=o),a},Y.prototype.getPlotStyles=function(t){var e={},t=this.get("Charts."+t+".PlotStyles.PlotColor");return e=t?{color:t}:e},Y.prototype.getDataAccessor=function(t){var e=this.dataSource,a=e.getPropertyFromColumn(t.toString()),r=e.getColumnType(a);return 12<=r&&r<=19?function(t){var e,t=_.cloneDeep(t.get(a)),i=_.isNaN(Number(t.i))?null:Number(t.i);return 13===r&&((e=l.tz("2000-01-01","UTC")).add(t.i,"month"),i=e.valueOf()),i}:7==r?function(t){return null!=t.get(a)?Number(t.get(a)):null}:function(t){return t.get(a)}},Y.prototype.getLabelFormatter=function(t,e,i,a,r){var o=i,n=e.getType(),t=this.axisFromatters[t.key][e.key],s=e.get("Labels.Prefix"),e=e.get("Labels.Suffix");return"linear"!==n||isNaN(i)?"category"===n?isNaN(Number(i))?l.isMoment(a)&&(o=t(a)):o=t(Number(i)):"time"===n&&(o=t(y.convertTempralToEchart(i,r)),console.log("label",o)):o=t(i),s+o+e},Y.prototype.updateAxisModelsRefs=function(){var o=this;this.XAxes.length&&this.YAxes.length?(this.axisModelsSet=!0,_.each(this.chartAxis,function(a,r){_.each(Y.AXISKEYS,function(t){var e=o.get("Charts."+r+"."+t+"ID"),i=o[p.plural(t)].find(function(t){return t.getLabel()===e});a[t].axisModel=i||null})}),this.updateChartData()):this.axisModelsSet=!1},Y.prototype.removeOverflowData=function(t,e){},Y.prototype.updateRadiusData=function(t,e){var i,a,r;t.data.length&&(i=this.dataSource,e=this.get("Charts."+e+".Radius.RadiusData"),a=e?this.getDataAccessor(e):null,e=i.getColumnType(e),r=[],null!==a&&4<=e&&e<=9&&(r=i.getData().map(function(t){return a(t)})),t.data[2]=r)},Y.prototype.areChartsValid=function(){return _.every(this.chartData,function(t){return t.dataColsSet})},Y.prototype.resolveValidColunNames=function(t,e){t=this.get("Charts."+t+"."+e+"Data"),e=y.getColumnKeysFromAxisString(t,this.dataSource),t=[];return _.isArray(e)&&(t=t.concat(e)),_.uniq(t)},Y.prototype.updateChartData=function(t){var m=this,g=this.dataSource,o="";this.isReadyForChartRender=this.settingsOptionsReady&&this.axisModelsSet,this.areChartsValid()&&!this.appView.propertiesChanging&&void 0!==g&&this.isReadyForChartRender&&(void 0!==t&&(this.forceResetChart=t),_.each(this.chartData,function(h,d){var t,a,u={XAxis:[],YAxis:[]},r={XAxis:{},YAxis:{}},e=!1,i=!1,c=m.chartAxis[d];_.each(Y.AXISKEYS,function(t,e){var i,a,r,o,n,s,l,p=c[t].axisModel;p&&(m.axisFromatters[d][t]=m.generateAxisFormatter(p),i=m.resolveValidColunNames(d,t)[0],p=p.getType(),a=g.getColumnType(i),o=[],l=[],s=[],null!==(r=i?m.getDataAccessor(i):null)&&(l=g.getData().map(function(t){return r(t)}),s=!(12<=a&&a<=19)||"time"===p?l:_.map(l,function(t){return t.toString()}),"category"===p&&(n=_.uniq(s),s=_.map(s,function(e){return n.findIndex(function(t){return t===e})}),m.chartAxis[d][t].data=n),o=y.calculateDataMinMax(s)),h.data[e]=s,h.rawData[e]=l,u[t]=o,h.dataTypes[t]=a)}),(h.dataMinMax=u).XAxis.length&&u.YAxis.length&&-1===_.concat(u.XAxis,u.YAxis).indexOf(null)?(r=m.calculateAxisMinMax(u,m.chartAxis[d]),t=h.data,a=y.getLinearRegresionLineCoords(t[0],t[1],m.get("Charts."+d+".MarkLine.ForceSpan")?r:u),_.each(Y.AXISKEYS,function(t,e){var i=c[t].axisModel,e=y.sortArrayAcs([a.startXY[e],a.endXY[e]]),e={min:e[0],max:e[1]};null===i||i.get("Range.UseDataRange")||(e.min<r[t].min&&(r[t].min=e.min),e.max>r[t].max&&(r[t].max=e.max))}),h.markLine.startXY=a.startXY,h.markLine.endXY=a.endXY,h.markLine.formula=a.formula,m.chartAxis[d].XAxis.scales=e?{min:null,max:null}:r.XAxis,m.chartAxis[d].YAxis.scales=i?{min:null,max:null}:r.YAxis):(m.chartAxis[d].XAxis.scales={min:null,max:null},m.chartAxis[d].YAxis.scales={min:null,max:null},h.markLine={startXY:[],endXY:[]},h.markLine.startXY=[],h.markLine.endXY=[],o="Can't calculate median line and min/max, invalid data set."),m.removeOverflowData(r,h),m.updateRadiusData(h,d),h.dataComplete=!!m.get("Charts."+d+".XAxisData")&&!!m.get("Charts."+d+".YAxisData")}),o&&console.info(o,this.chartData),this.prepareAxisOptions(),this.skipChartUpdate||(this.trigger("chartNameChanged",this.forceResetChart),this.forceResetChart=!1))},Y.prototype.getAxisFormatters=function(){return this.axisFromatters},Y.prototype.getChartDataObj=function(t){t=_.findKey(this.chartData,{name:t})||t;return this.chartData[t]},Y.prototype.getChartLegendNames=function(){return _.mapValues(this.chartData,function(t){return t.name})},Y.prototype.getChartLegendIconOptions=function(t,e){var i=this.get("Charts."+t+".Legend.IconFa"),a=D.THEMECOLORSCHEME[this.theme].font,r=this.getTooltipSvgStyles(t),r=e?y.renderSVGIcon(r,12):r.legendIconCustom,o=("arrow"===r&&(r=""),"dark"===this.theme?D.ICON_LOCATION_LIGHT:D.ICON_LOCATION),n="image://"+window.location.origin+window.location.pathname,s=r||i;return{iconPath:s=!i||r||e?s:n+o+(i=-1!==i.indexOf("fa-")?i.substring(3):i)+".png",iconColor:this.get("Charts."+t+".PlotStyles.PlotColor")||a,fontColor:this.get("Charts."+t+".Legend.LegendColor")||a,fontSize:"12px"}},Y.prototype.getTooltipSvgStyles=function(t){t=_.findKey(this.chartData,{name:t})||t;return{legendIconCustom:this.get("Charts."+t+".Legend.Icon"),legendIcon:this.get("Charts."+t+".Legend.IconFa"),plotColor:this.get("Charts."+t+".PlotStyles.PlotColor")}},Y.prototype.getVisbileCharts=function(){return _.filter(this.chartData,function(t){return!t.hidden&&t.dataComplete})},Y.prototype.setTheme=function(t){this.theme=t,this.updateChartData()},Y.prototype.updateDataSource=function(t){t?(this.dataSource=t,this.updateChartData()):console.log("updateData() call without datasource property")},Y.prototype.getAxisOptions=function(e){return _.map(this.chartAxis,function(t){if(t[e]&&t[e].options)return t[e].options})},Y.prototype.getGridOptions=function(){var a=[],t={top:2,bottom:-2,left:0,right:0}[this.get("Legend.LegendPosition")],e={top:0,bottom:0,left:4,right:-4}[this.get("Legend.LegendPosition")],e=this.BASEGRIDPROPS.left+e,t=this.BASEGRIDPROPS.top+t,i=this.BASEGRIDPROPS.left,r=this.BASEGRIDPROPS.top,o=this.BASEGRIDPROPS.width,n=this.BASEGRIDPROPS.height,s=this.BASEGRIDPROPS.gap,l=this.BASEGRIDPROPS.span,p=[{left:e+"%",top:t+s+"%",width:o+"%",height:n+"%"},{left:i+e+s+o+"%",top:t+s+"%",width:o+"%",height:n+"%"},{left:e+"%",top:t+r+n+s+"%",width:o+"%",height:n+"%"},{left:i+e+s+o+"%",top:r+t+n+s+"%",width:o+"%",height:n+"%"}],h=this.getVisbileCharts(),d=[[{left:e+"%",top:t+"%",width:l+"%",height:l+"%"}],[{left:e+"%",top:t+"%",width:l+"%",height:n+"%"},{left:e+"%",top:r+t+s+n+"%",width:l+"%",height:n+"%"}],[{left:e+"%",top:t+"%",width:l+"%",height:n+"%"},{left:e+"%",top:t+r+s+n+"%",width:o+"%",height:n+"%"},{left:e+i+s+o+"%",top:t+r+s+n+"%",width:o+"%",height:n+"%"}],p][h.length-1];return _.each(h,function(t,e){var i={};(i=d[e]).id=t.id,a.push(i)}),a},Y.prototype.getSeriesOptions=function(){var p=this,h=[],d=[];return this.api.hideErrorMessage(),_.each(this.chartData,function(t,e){var i,a,r={},o=p.get("Charts."+e+".MarkLine.DisplayLine"),n=p.get("Charts."+e+".Radius.FixedRadius"),s=p.get("Charts."+e+".Radius.FixedSize"),l=p.get("Charts."+e+".Radius.RadiusScaling"),s=0<s?s:0;t.dataComplete&&!t.hidden&&(i=t.name||e,-1!==_.indexOf(d,i)&&p.api.showErrorMessage({error:"Chart Legend must be unique "+i,type:"Error"}),d.push(i),a=p.getChartData(e),r={name:i,hoverAnimation:!1,type:"scatter",xAxisId:t.id,yAxisId:t.id,id:t.key,data:a,markLine:o?p.getMarkLine(e):{},itemStyle:p.getPlotStyles(e),symbol:p.get("Charts."+e+".PlotStyles.PlotShape")},a.length>p.appView.largeDataThreshold&&(_.extend(r,{large:!0,largeThreshold:1,progressive:a.length,progressiveThreshold:10}),p.appView.showNotification("Large data threshold is reached",5e3)),(n||t.data[2].length)&&(r=_.extend({},r,{symbolSize:n?s:function(t){return t[2]*l}})),h.push(r))}),h},Y.CHARTKEYS=["Chart1","Chart2","Chart3","Chart4"],Y.AXISKEYS=["XAxis","YAxis"],Y.REVERSEAXISKEYS={XAxis:"YAxis",YAxis:"XAxis"},Y.AXISKEYSDATA=["XAxisData","YAxisData"],Y.MULTAXISKEYS=["XAxes","YAxes"],Y.AXISTYPESMAP={linear:"value",logarithmic:"log",category:"category",time:"time"},Y.GRIDIDS=["gr1","gr2","gr3","gr4"];var Z,F=Y;function Y(t,e,i,a){var r=Z.call(this)||this,t=(r.settingsOptionsReady=!1,r.isReadyForChartRender=!1,r.axisModelsSet=!1,r.skipChartUpdate=!1,r.BASEGRIDPROPS={width:38,height:36,span:84,left:7,top:7,gap:1},r.theme="dark",r.forceResetChart=!1,r.chartData={Chart1:{key:"Chart1",name:"",dataTypes:{XAxis:null,YAxis:null},dataColsSet:!1,data:[],rawData:[],gridIx:0,dataComplete:!1,hidden:!1,dataMinMax:{XAxis:[],YAxis:[]},markLine:{startXY:[],endXY:[],formula:""},id:"gr1"},Chart2:{key:"Chart2",name:"",dataTypes:{XAxis:null,YAxis:null},dataColsSet:!1,data:[],rawData:[],gridIx:1,dataComplete:!1,hidden:!1,dataMinMax:{XAxis:[],YAxis:[]},markLine:{startXY:[],endXY:[],formula:""},id:"gr2"},Chart3:{key:"Chart3",name:"",dataTypes:{XAxis:null,YAxis:null},dataColsSet:!1,data:[],rawData:[],gridIx:2,dataComplete:!1,hidden:!1,dataMinMax:{XAxis:[],YAxis:[]},markLine:{startXY:[],endXY:[],formula:""},id:"gr3"},Chart4:{key:"Chart4",name:"",dataTypes:{XAxis:null,YAxis:null},dataColsSet:!1,data:[],rawData:[],gridIx:3,dataComplete:!1,hidden:!1,dataMinMax:{XAxis:[],YAxis:[]},markLine:{startXY:[],endXY:[],formula:""},id:"gr4"}},r.chartAxis={Chart1:{XAxis:{axisModel:null,options:{},scales:{min:null,max:null},data:null,labelSize:2},YAxis:{axisModel:null,options:{},scales:{min:null,max:null},data:null,labelSize:2}},Chart2:{XAxis:{axisModel:null,options:{},scales:{min:null,max:null},data:null,labelSize:2},YAxis:{axisModel:null,options:{},scales:{min:null,max:null},data:null,labelSize:2}},Chart3:{XAxis:{axisModel:null,options:{},scales:{min:null,max:null},data:null,labelSize:2},YAxis:{axisModel:null,options:{},scales:{min:null,max:null},data:null,labelSize:2}},Chart4:{XAxis:{axisModel:null,options:{},scales:{min:null,max:null},data:null,labelSize:2},YAxis:{axisModel:null,options:{},scales:{min:null,max:null},data:null,labelSize:2}}},r.axisFromatters={Chart1:{XAxis:null,YAxis:null},Chart2:{XAxis:null,YAxis:null},Chart3:{XAxis:null,YAxis:null},Chart4:{XAxis:null,YAxis:null}},r.api=t,r.XAxes=e,r.YAxes=i,r.appView=a,_.map(Y.CHARTKEYS,function(t){return"change:Charts."+t+".XAxisData change:Charts."+t+".YAxisData "}).join("")),e=_.map(Y.CHARTKEYS,function(t){return"change:Charts."+t+".XAxisID change:Charts."+t+".YAxisID "}).join(""),i=_.map(Y.MULTAXISKEYS,function(t){return"change:Charts._Hidden._Possible"+t+" "}).join(""),a=_.map(Y.CHARTKEYS,function(t){return"change:Charts."+t+".Radius "}).join(""),o=_.map(Y.CHARTKEYS,function(t){return"change:Charts."+t+".MarkLine "}).join(""),n=_.map(Y.CHARTKEYS,function(t){return"change:Charts."+t+".PlotStyles "}).join(""),s=_.map(Y.CHARTKEYS,function(t){return"change:Charts."+t+".Legend "}).join("");return r.listenTo(r,i,r.updateAxisModelsRefs),r.listenTo(r,e,r.updateAxisModelsRefs),r.listenTo(r.XAxes,"updateChartAxis",r.onAxisPropChanged),r.listenTo(r.YAxes,"updateChartAxis",r.onAxisPropChanged),r.listenTo(r,t,r.onChartsDataChanged),r.listenTo(r,a,r.onChartsRadiusChanged),r.listenTo(r,o,_.bind(function(t,e){r.forceResetChart=!0,r.onChartsPropChanged()},r)),r.listenTo(r,n,r.onChartsPropChanged),r.listenTo(r,s,r.onChartsLegendChanged),r.listenTo(r,_.map(Y.CHARTKEYS,function(t){return"change:Charts."+t+".DisplayChart "}).join(""),r.onChartsHiddenChanged),r}J=o.DeepModel,e(P,J),P.prototype.convertValueForFormater=function(t,e,i){e=this.getChartDataObj(e).dataTypes[i],i=t;return i=12<=e&&e<=19?y.convertTempralToEchart(t,e):i},P.prototype.labelFormatter=function(t){if(!t.seriesData.length)return t.value;var e=t.seriesData[0],i=_.find(F.CHARTKEYS,function(t){return-1!==e.seriesId.indexOf(t)}),t=t.value,a=["XAxis","YAxis"][_.indexOf(e.value,t)];return this.getChartAxisFormatters()[i][a=void 0===a?"YAxis":a](this.convertValueForFormater(t,e.seriesName,a))},P.prototype.pushToTemplate=function(t){var e;this.get("Overlay.UseCustomTooltip")?(e=i.compile(this.get("Overlay.CustomTooltip")),this.$tooltipArea.innerHTML=e(t)):this.$tooltipArea.innerHTML=_.unescape(r.tooltip(t))},P.prototype.onOverlayChanged=function(t,e){this.updateOverlay()},P.prototype.setTheme=function(t){this.theme=t,this.updateOverlay()},P.prototype.tooltipFormatter=function(e,t,i){var a,r,o,n,s,l=this,p=this.getChartAxisFormatters(),h=this.$appEl.outerHeight()-60,d=this.get("Overlay.FontSize"),u={fontSize:"font-size:"+d+"px",maxHeight:"max-height:"+h+"px;",xLabel:"",points:[]},h="";return _.isArray(e)&&e.length?(r=(e=y.filterTooltipArraySeries(e))[0].axisValueLabel,u.xLabel=r,_.each(e,function(e,t){var i=e.dataIndex,a=_.find(F.CHARTKEYS,function(t){return-1!==e.seriesId.indexOf(t)}),i=l.dataSource.getData().at(i),r=l.convertValueForFormater(e.value[1],e.seriesName,"YAxis"),o=l.getChartStyles(e.seriesName),n=y.renderSVGIcon(o,d),a={plotColor:o.plotColor,layerData:e.value[1],layerDataFormatted:p[a].YAxis(r),chartName:e.seriesName,svg:n,noSvg:!n.length,iconFa:o.legendIcon};i&&(a.cols=i.toJSON()),a.svg=y.renderSVGIcon(o,d),u.points[t]=a}),this.pushToTemplate(u),h=this.$tooltipArea.innerHTML):_.isObject(e)?(r=e.dataIndex,a=_.find(F.CHARTKEYS,function(t){return-1!==e.seriesId.indexOf(t)}),r=this.dataSource.getData().at(r),n=this.convertValueForFormater(e.value[1],e.seriesName,"YAxis"),o=this.getChartStyles(e.seriesName),s=y.renderSVGIcon(o,d),n={plotColor:o.plotColor,layerData:e.value[1],layerDataFormatted:p[a].YAxis(n),chartName:e.seriesName,svg:s,noSvg:!s.length,iconFa:o.legendIcon},r&&(n.cols=r.toJSON()),e.name?u.xLabel=e.name:(s=this.convertValueForFormater(e.value[0],e.seriesName,"XAxis"),u.xLabel=p[a].XAxis(s)),u.points=[n],this.pushToTemplate(u),h=this.$tooltipArea.innerHTML):console.info("Unable to generate tooltip, no series data. Check you chart setting"),h},P.prototype.updateOverlay=function(){this.trigger("updateChart")},P.prototype.getAxisPointerOptions=function(){var t={show:!0,snap:this.get("Overlay.Snap"),lineStyle:{type:this.get("Overlay.TooltipAxisPointerType")},label:{show:!0,formatter:_.bind(this.labelFormatter,this),backgroundColor:"rgba(0,0,0,"+this.get("Overlay.FillOpacity")/100+")",textStyle:{color:D.THEMECOLORSCHEME.dark.font}}},e=this.getVisbileCharts(),i=[];return 2===e.length&&(i=[{xAxisId:[e[0].id,e[1].id]}]),(i=3===e.length?[{xAxisId:[e[0].id,e[1].id,e[2].id]},{yAxisId:[e[1].id,e[2].id]}]:i).length?t.link=i:t.link=[{yAxisId:["gr1","gr2"]},{xAxisId:["gr1","gr3"]},{xAxisId:["gr2","gr4"]},{yAxisId:["gr3","gr4"]}],t},P.prototype.getTooltipOptions=function(){var t=this.get("Overlay.FixedPosition"),e="rgba(0,0,0,"+this.get("Overlay.FillOpacity")/100+")",e={show:this.get("Overlay.Display"),backgroundColor:e,formatter:_.bind(this.tooltipFormatter,this),borderColor:"transparent",confine:!0,axisPointer:{crossStyle:{animation:!1}}};return t&&_.extend(e,{position:function(t,e,i,a,r){var o={};return o[["left","right"][+(t[0]<r.viewSize[0]/2)]]=60,o[["top","bottom"][+(t[1]<r.viewSize[1]/2)]]=20,o}}),e},P.prototype.updateDataSource=function(t){t?this.dataSource=t:console.log("updateData() call without datasource property")};var J,Q=P;function P(t,e,i,a,r,o,n){var s=J.call(this)||this;return s.theme="dark",s.skipChartUpdate=!1,s.dataSource=t,s.api=e,s.$appEl=i,s.$tooltipArea=_.first(i.find(".tooltip")),s.getChartAxisFormatters=a,s.getChartDataObj=r,s.getChartStyles=o,s.getVisbileCharts=n,s.listenTo(s,"change:Overlay ",s.onOverlayChanged),s}k.prototype.onData=function(t,e,i){this.meta=this.mergeChanges(this.meta,t.columns.reset,t.columns.change,t.columns.add,t.columns.remove),0!=this.depth||_.isEqual(t.breakdownColumns,this.breakdownColumns)||(this.breakdownColumns=t.breakdownColumns,this.removeChild()),e.reset&&0<e.reset.length&&this.removeChild(),i&&this.updateError(this,i),this.hasDataFlag=!0,this.updateDatasetColumns(),this.updateChildren()&&this.listener.updateDataSource(this)},k.prototype.getColumnNames=function(){if(this.breakdownColumns&&this.breakdownColumns.length)return[k.BREAKDOWN_ID,this.breakdownColumns[0]].concat(_.difference(_.keys(this.meta),this.breakdownColumns));try{return _.map(this.meta,function(t){return[t.id,t.index]}).sort(function(t,e){return t[1]-e[1]}).map(function(t){return t[0]})}catch(t){return _.keys(this.meta)}},k.prototype.getDataByRowIx=function(t){return this.getData()},k.prototype.updateDatasetColumns=function(){var e=this;_.each(this.getColumnNames(),function(t){e.dataSetColumns[t]=e.getData().pluck(t)})},k.prototype.getDataSetColumns=function(){return this.dataSetColumns},k.prototype.getColumnType=function(t){return this.childDataSource?this.childDataSource.getColumnType(t):t===k.BREAKDOWN_ID?this.meta[this.primaryKey].kdbType:this.meta[t]?this.meta[t].kdbType:11},k.prototype.getData=function(){return this.childDataSource?this.childDataSource.getData():this.source.dataSet&&this.source.dataSet.collection},k.prototype.getKey=function(){return this.source.cid},k.prototype.getPath=function(){return this.source.path},k.prototype.getPrimaryKey=function(){return this.childDataSource?this.childDataSource.getPrimaryKey():this.primaryKey},k.prototype.getPropertyFromColumn=function(t){return t===k.BREAKDOWN_ID?this.getPrimaryKey():t},k.prototype.getSource=function(){return this.source},k.prototype.hasData=function(){return this.childDataSource?this.childDataSource.hasData():this.hasDataFlag},k.prototype.mergeChanges=function(e,t,i,a,r){return t&&(e=_.fromPairs(_.map(t,function(t){return[t.id,t]}))),i&&_.each(i,function(t){return _.extend(e[t.id],t)}),a&&_.each(a,function(t){e[t.id]=t}),r&&_.each(r,function(t){delete e[t.id]}),e},k.prototype.removeChild=function(){this.childDataSource&&(this.childDataSource.unsubscribe(),delete this.childDataSource)},k.sourceKey=function(t){return t.getPath()},k.prototype.subscribe=function(){this.api.subscribe(this.source,this.onData.bind(this))},k.prototype.unsubscribe=function(){this.childDataSource&&(this.childDataSource.unsubscribe(),delete this.childDataSource),this.api.unsubscribe(this.source)},k.prototype.updateSourceSubscribe=function(t){this.unsubscribe(),this.source=t,this.subscribe()},k.prototype.updateDataSource=function(){this.listener.updateDataSource(this)},k.prototype.updateChildren=function(){var t;return!(this.breakdownColumns&&this.breakdownColumns.length&&this.depth<this.breakdownColumns.length-1)||(this.focus.length>this.depth?(this.childDataSource&&this.focus[this.depth]!==this.childDataSource.getSource().id&&this.removeChild(),this.childDataSource||(0!==this.depth&&(this.focus[this.depth-1],this.source.id),(t=this.source.dataSet&&this.source.dataSet.collection.get(this.focus[this.depth]))?(this.childDataSource=new k(t,this,this.api,this.focus,this.depth+1,this.breakdownColumns),this.childDataSource.subscribe()):nt.DEBUG&&console.debug("[DEBUG][DATASOURCE] -> onData missing focus",this.focus[this.depth],arguments))):(this.removeChild(),this.focus.length!==this.depth||!this.hasDataFlag||0!==this.depth&&this.focus[this.depth-1]!=this.source.id||this.listener.updateDataSource(this)),!1)},k.prototype.updateError=function(t,e){this.listener.updateError(this,e)},k.BREAKDOWN_ID="{breakdownId}";var tt=k;function k(t,e,i,a,r,o){this.breakdownColumns=[],this.focus=[],this.hasDataFlag=!1,this.meta={},this.primaryKey="",this.dataSetColumns={},this.source=t,this.listener=e,this.api=i,this.depth=r||0,this.breakdownColumns=o||this.breakdownColumns}et=o.DeepModel,e(R,et),R.prototype.updateLegend=function(t){var i=this;this.appView.isMatrix||(this.legendOptions={show:this.get("Legend.Display"),itemGap:this.get("Legend.ItemGap"),selectedMode:"disabled"!==this.get("Legend.SelectedMode")&&this.get("Legend.SelectedMode"),position:this.get("Legend.LegendPosition"),data:[]},_.each(this.chartModel.getChartLegendNames(),function(t,e){e=i.chartModel.getChartLegendIconOptions(e),e={noSvg:-1===e.iconPath.indexOf("svg"),icon:e.iconPath,iconColor:e.iconColor,fontColor:e.fontColor,legendName:t};i.legendOptions.data.push(e)}),this.trigger("updateChart",t))},R.prototype.useHtml=function(){return this.get("Legend.UseHtml")},R.prototype.getLegendOptions=function(){return this.legendOptions},R.prototype.getChartLegendOptions=function(){var i=this,a={show:this.get("Legend.Display"),itemGap:this.get("Legend.ItemGap"),itemWidth:14,itemHeight:14,selectedMode:"disabled"!==this.get("Legend.SelectedMode")&&this.get("Legend.SelectedMode"),textStyle:{fontFamily:D.DEFAULTSETTINGS.fontFamilyLegend},data:[]},t={top:{},bottom:{top:"92%"},left:{top:"1%",left:"1%",orient:"vertical"},right:{top:"1%",right:"1%",orient:"vertical"}}[this.get("Legend.LegendPosition")];return _.extend(a,t),_.each(this.chartModel.getChartLegendNames(),function(t,e){e=i.chartModel.getChartLegendIconOptions(e,i.useHtml()),t={name:t,icon:e.iconPath,textStyle:{color:e.fontColor}};a.data.push(t)}),a};var et,it=R;function R(t,e){var i=et.call(this)||this;return i.legendOptions={},i.chartModel=t,i.appView=e,i.listenTo(i,"change:Legend",i.updateLegend),i.listenTo(i.chartModel,"chartNameChanged",i.updateLegend),i}at=o.DeepModel,e(w,at),w.prototype.generateAxisFormatter=function(t,e){var i="General",t=this.chartColumns[t];return 4<e&&e<10?i="Number":11<e&&e<20&&(i="Datetime"),y.getFormatter(i,t.Precision,t.HideTrailingZeroes,t.DateFormat)},w.prototype.pushToTemplate=function(t){this.appView.tooltip=this.api.setTooltip({data:t,text:this.crosshairModel.get("Overlay.UseCustomTooltip")?this.crosshairModel.get("Overlay.CustomTooltip"):r.tooltip(t),anchorEl:this.appView.$el[0]}).updateCSS({backgroundColor:"rgba(0,0,0,"+this.crosshairModel.get("Overlay.FillOpacity")/100+")",fontSize:this.crosshairModel.get("Overlay.FontSize")+"px"})},w.prototype.convertValueForFormater=function(t,e){var i=t;return i=12<=e&&e<=19?y.convertTempralToEchart(t,e):i},w.prototype.extractColsMetadataFromSeriesId=function(t,e,i,a){var r=t.seriesId,i=i?0:1,o=0===r.indexOf("grH")?3:2,r=r.substr(o).split("-").reverse(),o=-1===_.indexOf(t.value,e)||a?i:_.indexOf(t.value,e);return this.chartData.metaData[Number(r[o])]},w.prototype.generateAxisNestedOptions=function(t,e,i,a,r){var o=this,t=this.axisKeyMap[t],n=this.chartData.metaData[a].colId,s=this.chartData.data[a],l=a=D.THEMECOLORSCHEME[this.theme].font,a=this.get(t+".Labels.LabelColor")?this.get(t+".Labels.LabelColor"):a,i=(this.get(t+".SplitLine.LineColor")&&(l=this.get(t+".SplitLine.LineColor")),{splitLine:{show:!i,lineStyle:{opacity:this.get(t+".SplitLine.LineOpacity")/100,color:l,type:this.get(t+".SplitLine.LineStyle")}}}),p=this.chartColumns[n],h=this.generateAxisFormatter(n,r),l=this.get(t+".Labels.Interval"),n={show:e,color:a,rotate:this.get(t+".Labels.LabelRotate"),fontFamily:this.get(t+".Labels.LabelFont"),fontSize:this.get(t+".Labels.LabelFontSize"),fontStyle:this.get(t+".Labels.LabelFontStyle")};return l&&(n.interval=l),e&&(n.formatter=function(t,e){return o.getAxisLabelFormatter(t,s[e],r,p,h)}),_.extend({},{axisLine:{show:e,lineStyle:{color:a},onZero:!1},axisTick:{alignWithLabel:!1,interval:l||"auto",show:e,inside:!0,lineStyle:{color:a}},axisLabel:n},i)},w.prototype.generateAxisTitleOptions=function(t,e,i){var a="XAxis"===t,i=this.chartData.metaData[a?i:e].colId,e=this.axisKeyMap[t],t=_.isObject(this.chartColumns[i])&&this.chartColumns[i].ColumnTitle?this.chartColumns[i].ColumnTitle:i,i=this.get(e+".Title.NameColor"),r=this.get(e+".Title.TitleOffset"),t={name:t,nameRotate:a?0:90,nameLocation:"middle",nameTextStyle:{padding:a?[r,0,0,0]:[0,0,r,0],fontSize:this.get(e+".Title.AxisTitleSize")}};return i&&(t.nameTextStyle.color=i),t},w.prototype.generateAxisOptions=function(t,e,i,a,r,o,n){var s=!1,l="XAxis"===t?"bottom":"left",p="XAxis"===t?i:e,h=this.chartData.metaData[p].kdbType,d=12<=h&&h<=19?"time":"value",u="gr"+(n?"H":"")+e+"-"+i,a=(s=a?"XAxis"===t?e===o-1&&!n:0===i&&!n:s)&&(e===o-1||0===i),o=y.calculateMinMaxOffset(this.chartData.minMax[p]),h=this.generateAxisNestedOptions(t,s,r,p,h),p={min:Number(this.chartData.minMax[p][0])-o,max:Number(this.chartData.minMax[p][1])+o},o={id:u,gridId:u,splitNumber:4,position:l,type:n?"value":d,scale:!n||"XAxis"===t,axisPointer:{show:!n,lineStyle:{opacity:r?0:1},label:{show:a},triggerTooltip:!r}};r||(o.boundaryGap=[p.min,p.max],_.extend(o,p));return s&&(u=this.generateAxisTitleOptions(t,e,i),_.extend(o,u)),_.extend(o,h)},w.prototype.generateChartOptions=function(t,e,i){for(var a,r=i||0,o=!!i,n=this.chartData.metaData.length,s=0;s<n;s+=1){for(var l=!0,p=0;p<n;p+=1){var h=o?p:s,d=o?s:p,u=o?"yAxisId":"xAxisId",c="gr"+d+"-"+h,m=s===p;l&&(this.chartData.linksOptions[r]=((a={})[u]=[],a),l=!1),this.chartData.linksOptions[r][u].push(c),n<=n-s+p&&(s!==p||!o)||(t.grid.push(this.generateGridOptions(d,h,n)),t.xAxis.push(this.generateAxisOptions("XAxis",d,h,o,m,n)),t.yAxis.push(this.generateAxisOptions("YAxis",d,h,o,m,n)),t.series.push(this.generateSeriesOptions(d,h,m)),e&&m&&(e.grid.push(this.generateGridOptions(d,h,n,!0)),e.xAxis.push(this.generateAxisOptions("XAxis",d,h,o,m,n,!0)),e.yAxis.push(this.generateAxisOptions("YAxis",d,h,o,m,n,!0)),e.series.push(this.generateSeriesOptions(d,h,m,!0))))}r++}return r},w.prototype.generateGridOptions=function(t,e,i,a){var a="gr"+(a?"H":"")+t+"-"+e,r=this.get("Style.AxisPadding"),o=100-r,n=(o-r-1.5)/i-1.5,o=(o-r-10-3)/i-3;return{id:a,left:r/2+r+e*(1.5+n)+"%",top:10+t*(3+o)+"%",width:n+"%",height:o+"%"}},w.prototype.generateSeriesOptions=function(t,e,i,a){var r,o=this.chartData.id+(a?"H":"")+t+"-"+e,n=this.getChartData(e,t);if(n.length)return a&&(r=this.chartData.data[e],n=X.histogram(r).customData),r={name:this.chartData.name+(a?"H":"")+t+"-"+e,type:a?"custom":"scatter",xAxisId:o,yAxisId:o,id:o,symbolSize:5,itemStyle:{color:D.DEFAULTSETTINGS.pointsColor,opacity:i&&!a?0:1},data:n},a&&_.extend(r,{renderItem:function(t,e){var i=e.value(2),a=e.coord([e.value(0),i]),i=e.size([e.value(1)-e.value(0),i]);return{type:"rect",shape:{x:a[0],y:a[1],width:.99*i[0],height:i[1]},style:e.style()}},dimensions:["x0","x1","sampleNum"],encode:{x:[0,1],y:2,tooltip:[0,1,2]}}),n.length>this.appView.largeDataThreshold&&!a&&(this.isLargeData=!0,_.extend(r,{large:!0,largeThreshold:1,progressive:n.length,progressiveThreshold:10}),this.appView.notificationTimeout||this.appView.showNotification("Large data threshold is reached",5e3)),r},w.prototype.getAxisLabelFormatter=function(t,e,i,a,r){var o=a.Prefix,a=a.Suffix;return o+r(this.convertValueForFormater(t,i))+a},w.prototype.getChartData=function(t,e){var i=this.chartData.data,a=[];if(!i.length)return[];for(var r=0;r<i[0].length;r++){var o=[i[t][r],i[e][r]];a.push(o)}return a},w.prototype.getPointerLabelFormatter=function(t){if(!t.seriesData.length)return t.value;var e=t.seriesData[0],i="custom"===e.componentSubType,t=t.value,e=this.extractColsMetadataFromSeriesId(e,t,!1,i),i=this.convertValueForFormater(t,e.kdbType);return this.generateAxisFormatter(e.colId,e.kdbType)(i)},w.prototype.getDataAccessor=function(t){var e=this.dataSource,a=e.getPropertyFromColumn(t.toString()),r=e.getColumnType(a);return 12<=r&&r<=19?function(t){var e,t=_.cloneDeep(t.get(a)),i=_.isNaN(Number(t.i))?null:Number(t.i);return 13===r&&((e=l.tz("2000-01-01","UTC")).add(t.i,"month"),i=e.valueOf()),i}:7==r?function(t){return null!=t.get(a)?Number(t.get(a)):null}:function(t){return t.get(a)}},w.prototype.getTooltipFormatter=function(t,e,i){var l=this,a=(this.dataDefFormattersMap,this.$appEl.outerHeight()-60),p=this.crosshairModel.get("Overlay.FontSize"),h={fontSize:"font-size:"+p+"px",maxHeight:"max-height:"+a+"px;",xLabel:"",points:[]};if(_.isArray(t)&&t.length){a=(t=y.filterTooltipArraySeries(t))[0].axisValueLabel;h.xLabel=a,_.each(t,function(t,e){var i,a,r,o,n=t.dataIndex,s=l.extractColsMetadataFromSeriesId(t);s?(o=s.kdbType,n=l.dataSource.getData().at(n),i=l.convertValueForFormater(t.value[1],o),a=l.getTooltipLegendStyles(),r=y.renderSVGIcon(a,p),s=l.generateAxisFormatter(s.colId,o),o={plotColor:a.plotColor,layerData:t.value[1],layerDataFormatted:s(i),chartName:t.seriesName,svg:r,noSvg:!r.length,iconFa:a.legendIcon},n&&(o.cols=n.toJSON()),o.svg=y.renderSVGIcon(a,p),h.points[e]=o):console.log("Tooltip metaData undefined for id: ",t.seriesId)})}else{if(!_.isObject(t))return console.info("Unable to generate tooltip, no series data. Check you chart setting"),"";var a=t.dataIndex,r=this.extractColsMetadataFromSeriesId(t);if(!r)return void console.log("Tooltip metaData undefined for id: ",t.seriesId);var o=r.kdbType,a=this.dataSource.getData().at(a),n=this.convertValueForFormater(t.value[1],o),s=this.getTooltipLegendStyles(),d=y.renderSVGIcon(s,p),r=this.generateAxisFormatter(r.colId,o),o={plotColor:s.plotColor,layerData:t.value[1],layerDataFormatted:r(n),chartName:t.seriesName,svg:d,noSvg:!d.length,iconFa:s.legendIcon};a&&(o.cols=a.toJSON()),t.name?h.xLabel=t.name:(n=(r=this.extractColsMetadataFromSeriesId(t,t.value[0])).kdbType,d=this.convertValueForFormater(t.value[0],n),s=this.generateAxisFormatter(r.colId,n),h.xLabel=s(d)),h.points=[o],this.pushToTemplate(h)}this.pushToTemplate(h)},w.prototype.getTooltipLegendStyles=function(){return{legendIconCustom:"",legendIcon:"fa-circle",plotColor:D.DEFAULTSETTINGS.pointsColor}},w.prototype.setBrushOptions=function(t){!this.isLargeData&&this.get("Style.MatrixBrushTool")&&(t.brush={brushLink:"all",inBrush:{opacity:1}},t.toolbox={feature:{brush:{title:{rect:"Rectangle selection",polygon:"Polygon selection",lineX:"Horizontal selection",lineY:"Vertical selection",keep:"Keep previous select...",clear:"Clear selection"}}}})},w.prototype.updateColumnsModelsRefs=function(){var i,t,a=this;this.settingsOptionsReady&&this.dataSource&&(this.matrixColsModelsSet=!0,i=[],this.columns=[],this.chartColumns={},this.matrixCols.forEach(function(t){var e=t.get("MatrixColId"),e=y.getColumnKeysFromAxisString(e,a.dataSource);_.isArray(e)&&e.length&&i.push({cid:t.cid,cols:e})}),t=_.sortBy(i,function(t){return t.cols.length}),_.each(t,function(t){var i=t.cid;_.each(t.cols,function(t){var e;-1===a.columns.indexOf(t)&&(e=a.matrixCols.get(i),e=_.pickBy(e.toJSON(),function(t,e){if(!_.includes(["_Hidden","MatrixColId"],e))return{k:t}}),a.columns.push(t),a.chartColumns[t]=e)})}),this.updateChartData())},w.prototype.getAxisPointerOptions=function(){var t={show:!0,snap:this.crosshairModel.get("Overlay.Snap"),lineStyle:{type:this.crosshairModel.get("Overlay.TooltipAxisPointerType")},label:{show:!0,formatter:_.bind(this.getPointerLabelFormatter,this),textStyle:{color:D.THEMECOLORSCHEME[this.theme].inverse}}},e=this.chartData.linksOptions;return e.length&&(t.link=e),t},w.prototype.getTooltipOptions=function(){return{show:this.crosshairModel.get("Overlay.Display"),confine:!0,formatter:_.bind(this.getTooltipFormatter,this)}},w.prototype.updateChartData=function(){var r,t,o=this,n=this.dataSource,e={backgroundColor:"transparent",grid:[],xAxis:[],yAxis:[],series:[],tooltip:this.getTooltipOptions()},i={backgroundColor:"transparent",grid:[],xAxis:[],yAxis:[],series:[],tooltip:this.getTooltipOptions()};this.isReadyForChartRender=this.settingsOptionsReady&&this.matrixColsModelsSet,!this.appView.propertiesChanging&&void 0!==n&&this.isReadyForChartRender&&(this.isLargeData=!1,r=0,_.each(["metaData","data","minMax","linksOptions"],function(t){o.chartData[t]=[]}),_.each(this.columns,function(t){var e=n.getColumnType(t),i=-1!==o.VALIDKDBTYPES.indexOf(e),a=t?o.getDataAccessor(t):null;a&&i?(i=n.getData().map(function(t){return a(t)}),o.chartData.metaData[r]={kdbType:e,colId:t},o.chartData.data[r]=i,o.chartData.minMax[r]=y.calculateDataMinMax(i),r+=1):console.info("!Invalid datatype or column name, properties will be ignored: ",{columnKdbType:e,columnName:t})}),this.chartData.metaData.length&&this.chartData.data.length&&(t=this.generateChartOptions(e),this.generateChartOptions(e,i,t),e.axisPointer=this.getAxisPointerOptions(),this.setBrushOptions(e)),this.chartOptions=e,this.chartHistOptions=i,this.trigger("updateChart",!0))},w.prototype.onColumnPropChanged=function(t){!this.settingsOptionsReady&&this.matrixColsModelsSet&&(this.matrixColsModelsSet=!1),t?this.updateColumnsModelsRefs():this.updateChartData()},w.prototype.getChartOptions=function(t){return t?this.chartHistOptions:this.chartOptions},w.prototype.setTheme=function(t){this.theme=t,this.onColumnPropChanged(!1)},w.prototype.updateDataSource=function(t){t?(this.dataSource=t,this.onColumnPropChanged(!0)):console.log("updateData() call without datasource property")};var at,rt=w;function w(t,e,i,a,r){var o=at.call(this)||this;return o.settingsOptionsReady=!1,o.isReadyForChartRender=!1,o.columnsCollectionChanged=!1,o.matrixColsModelsSet=!1,o.theme="dark",o.isLargeData=!1,o.chartOptions={},o.chartHistOptions={},o.chartData={key:"gr",name:"Chart-",id:"gr",data:[],metaData:[],minMax:[],linksOptions:[]},o.axisKeyMap={XAxis:"MatrixXAxes",YAxis:"MatrixYAxes"},o.chartColumns={},o.columns=[],o.dataDefFormattersMap={5:y.getFormatter("Number",0,!1,""),6:y.getFormatter("Number",0,!1,""),7:y.getFormatter("Number",0,!1,""),8:y.getFormatter("Number",0,!0,""),9:y.getFormatter("Number",0,!0,""),12:y.getFormatter("Datetime",0,!1,"YYYY-MM-DD hh:mm:ss"),13:y.getFormatter("Datetime",0,!1,"YYYY-MM"),14:y.getFormatter("Datetime",0,!1,"YYYY-MM-DD"),15:y.getFormatter("Datetime",0,!1,"YYYY-MM-DD hh:mm:ss"),16:y.getFormatter("Datetime",0,!1,"HH:mm:ss.SS"),17:y.getFormatter("Datetime",0,!1,"mm:ss"),18:y.getFormatter("Datetime",0,!1,"HH:mm:ss"),19:y.getFormatter("Datetime",0,!1,"HH:mm:ss.SS")},o.VALIDKDBTYPES=[5,6,7,8,9,12,13,14,15,16,17,18,19],o.api=t,o.matrixCols=e,o.crosshairModel=i,o.appView=a,o.$appEl=r,o.$tooltipArea=_.first(r.find(".tooltip")),o.listenTo(o,"change:Style",o.updateChartData),o.listenTo(o,"change:MatrixXAxes change:MatrixYAxes",o.updateChartData),o.listenTo(i,"updateChart",o.updateChartData),o.listenTo(e,"updateMatrixChart",o.onColumnPropChanged),o}var ot,I=d.Tools,nt=(ot=o.View,e(N,ot),N.prototype.initAxis=function(){var t=this,e=new B;return this.listenTo(e,"update",function(){t.chartModel.updateAxisModelsRefs(),t.updateChart()}),e},N.prototype.intiMatrixColumns=function(){var t=this,e=new q;return this.listenTo(e,"update",function(){t.matrixModel.onColumnPropChanged(!0)}),e},N.prototype.onSettingsChange=function(t){N.DEBUG&&console.debug("%c[DEBUG][ECHARTS] -> onSettingsChange ","color: green;",arguments);var e=!!this.isPendingFirstOnSettingsChange,i=(this.isPendingFirstOnSettingsChange&&(this.isPendingFirstOnSettingsChange=!1),y.expandNestedViewStates(t,this.api)),i=y.replaceViewStatesWithValue("",i,this.api),i=y.pump(i);this.onSettingsChangeProcessed.call(this,i,t),e&&(this.isReadyForThemeChange=!0,this.isPendingFirstOnSettingsChange=!1,this.setThemeAccordingToDashboardSettings())},N.prototype.onSettingsChangeProcessed=function(e,t){var i=this,a=!1;1<_.keys(e).length&&(this.matrixModel.settingsOptionsReady=!1,this.chartModel.settingsOptionsReady=!1),e.hasOwnProperty("Basics")&&e.Basics.Data&&this.onSettingsDataChanged.call(this,e.Basics.Data),e.hasOwnProperty("Basics")&&e.Basics.ChartType&&(a=!0,this.onSettingsChartTypeChanged.call(this,e.Basics.ChartType)),_.isObject(e.MatrixCols)&&this.onSettingsMatrixColsChanged.call(this,e.MatrixCols),_.isObject(e.Style)&&this.onSettingsMatrixStylesChanged.call(this,e.Style),["MatrixXAxes","MatrixYAxes"].forEach(function(t){_.isObject(e[t])&&i.onSettingsMatrixAxisChanged.call(i,t,e[t])}),_.isObject(e.Charts)&&this.onSettingsChartChanged.call(this,e.Charts),["XAxes","YAxes"].forEach(function(t){_.isArray(e[t])&&i.onAxisSettingsChanged.call(i,t,e[t])}),_.isObject(e.Legend)&&this.onLegendSettingsChanged.call(this,e.Legend),_.isObject(e.Overlay)&&this.onOverlaySettingsChanged.call(this,e.Overlay),e.hasOwnProperty("Basics")&&e.Basics.LargeDataThreshold&&this.onSettingsLargeDataThresholdChanged.call(this,e.Basics.LargeDataThreshold),this.matrixModel.settingsOptionsReady&&this.chartModel.settingsOptionsReady||!(a||1<_.keys(e).length)||(this[a=this.isMatrix?"matrixModel":"chartModel"].settingsOptionsReady=!0,this.isMatrix&&!this.matrixModel.matrixColsModelsSet?this.matrixModel.onColumnPropChanged(!0):this[a].updateChartData(!0))},N.prototype.setThemeAccordingToDashboardSettings=function(){this.isReadyForThemeChange&&this.setTheme(this.dashboardViewModel.get("DashboardTheme"))},N.prototype.onSettingsChartTypeChanged=function(t){var e=this;this.isMatrix="matrix"===t,this.destroyChart(),_.defer(function(){e.dataSource&&e.dataSource.hasData()&&e.updateDataSource(e.dataSource)})},N.prototype.onSettingsDataChanged=function(t){var i=this;N.DEBUG&&console.debug("[DEBUG][ECHARTS] -> onSettingsLayersChanged ",arguments);void 0!==this.dataSource&&this.dataSource.getKey()!==t.cid&&this.dataSource.updateSourceSubscribe(t),this.dataSource?this.dataSource.hasData()&&this.updateDataSource(this.dataSource):(this.dataSource=new tt(t,this,this.api),this.dataSource.subscribe()),this.listenTo(t,"change:queryStatus",function(t,e){i.updateError(i.dataSource,e)})},N.prototype.onSettingsChartChanged=function(t){this.chartModel.set({Charts:t})},N.prototype.onSettingsLargeDataThresholdChanged=function(t){this.largeDataThreshold=t,this.isMatrix?this.matrixModel.updateChartData():this.chartModel.updateChartData(!0)},N.prototype.onSettingsMatrixAxisChanged=function(t,e){this.matrixModel.set(t,e)},N.prototype.onSettingsMatrixColsChanged=function(t){var i=this.matrixCols,a=[];_.each(t,function(e){var t=i.find(function(t){return t.get("_Hidden._ColId")===e._Hidden._ColId});(t=t||new W({})).set(e),a.push(t)}),i.set(a)},N.prototype.onSettingsMatrixStylesChanged=function(t){this.matrixModel.set("Style",t)},N.prototype.onAxisSettingsChanged=function(i,t){var a=this,r="XAxes"===i?this.xAxes:this.yAxes,e=_.map(r.map("_Hidden"),"_AxisId"),o=[];e.some(_.negate(Boolean))&&console.warn('all existing axes should have an "_AxisId" attribute set'),_.each(t,function(e){var t=r.find(function(t){return t.get("_Hidden._AxisId")===e._Hidden._AxisId});(t=t||new p({},a.api,p.singular(i),a)).set(e),o.push(t)}),r.set(o)},N.prototype.onLegendSettingsChanged=function(t){t.LegendPosition&&this.chartModel.set({"Legend.LegendPosition":t.LegendPosition}),this.legendModel.set({Legend:t})},N.prototype.onOverlaySettingsChanged=function(t){this.crosshairModel.set({Overlay:t})},N.prototype.updateDataSource=function(e){if(this.isMatrix){var i=d.HeuristicHelpers.getScalarColumns(e),a=this.errors[e.getKey()];if(this.matrixModel.updateDataSource(e),0===i.length&&(!a||"Loading"===_.get(a,"type")))return void this.api.showErrorMessage({error:t("Data Source provided is not valid for Scatter Plot"),type:"Warning"});this.options.settingsModel.trigger("transform",i[0],"MatrixCols.0.MatrixColId")}else this.chartModel.updateDataSource(e);this.crosshairModel.updateDataSource(e)},N.prototype.intitializeChart=function(t){var e,r=this;this.isPendingFirstOnSettingsChange||void 0!==this.dataSource&&!this.dataSource.hasData()||(e=this.$echart.get(0),this.destroyChart(),this.chart=H.init(e),this.chartResize(),_.each(t,function(t){r.chart.setOption(t)}),this.chart.off("showTip",null),this.chart.on("showTip",function(t){var e,i,a;r.tooltip&&_.isNumber(t.x)&&_.isNumber(t.y)&&(e={},r.crosshairModel.get("Overlay.FixedPosition")?(i=r.$el.width()||0,a=r.$el.height()||0,e[["left","right"][+(t.x<i/2)]]=60,e[["top","bottom"][+(t.y<a/2)]]=20):(e.left=t.x+20,e.top=t.y+20),r.tooltip.updatePosition(e))}),this.chart.off("globalout",null),this.chart.on("globalout",function(){r.tooltip&&(r.api.removeTooltip(),delete r.tooltip)}))},N.prototype.destroyChart=function(){var t=this.$echart.get(0);this.chart&&(this.chart.clear(),this.chart.dispose(t),delete this.chart)},N.prototype.prepareChart=function(){var t={};return this.isMatrix?[t=this.matrixModel.getChartOptions(),this.matrixModel.getChartOptions(!0)]:(t={backgroundColor:"transparent",tooltip:this.crosshairModel.getTooltipOptions(),axisPointer:this.crosshairModel.getAxisPointerOptions(),grid:this.chartModel.getGridOptions(),xAxis:this.chartModel.getAxisOptions("XAxis"),yAxis:this.chartModel.getAxisOptions("YAxis"),series:this.chartModel.getSeriesOptions()},this.legendModel.useHtml()||_.extend(t,{legend:this.legendModel.getChartLegendOptions()}),[t])},N.prototype.updateChartWrapper=function(t){this.isMatrix||this.updateChart(t)},N.prototype.updateChart=function(t){var e=this,i=this.isMatrix?"matrixModel":"chartModel";this.isReadyForThemeChange&&this[i].isReadyForChartRender&&!this.propertiesChanging&&(this.updateLegends(),((i=this.prepareChart())[0].grid&&i[0].grid.length||t)&&(N.DEBUG&&console.log("%c[DEBUG][ECHARTS] -> grid options: ","color: green;",i),!this.chart||t?this.intitializeChart(i):(this.chartResize(),_.each(i,function(t){e.chart.setOption(t)}))))},N.prototype.updateLegends=function(){var t=this.legendModel.getLegendOptions();this.$legends.html(),this.$legends.removeClass("top bottom left right hidden"),this.legendModel.useHtml()?(this.$legends.html(r.legend(t.data)),this.$legends.addClass(t.position)):this.$legends.addClass("hidden")},N.prototype.remove=function(){return clearTimeout(this.notificationTimeout),this.destroyChart(),o.View.prototype.remove.apply(this)},N.prototype.chartResize=function(){var t,e;this.chart&&(t=this.$el.innerWidth(),e=this.$el.innerHeight(),this.chart.resize({width:t,height:e}))},N.prototype.onResizeStop=function(){var t=this;_.debounce(function(){t.chartResize()},200)()},N.prototype.setTheme=function(t){t=t?t.toLowerCase():"dark";this.isReadyForThemeChange=!1,this.chartModel.setTheme(t),this.matrixModel.setTheme(t),this.crosshairModel.setTheme(t),this.isReadyForThemeChange=!0,this.updateChart()},N.prototype.showNotification=function(t,e){var i=this;e&&!this.notificationTimeout&&(this.notificationTimeout=setTimeout(function(){i.$notifications.hasClass("hidden")||i.stopNotification()},e)),this.$notifications.toggleClass("hidden",!1),this.$notifications.text(t)},N.prototype.stopNotification=function(){this.notificationTimeout&&(clearTimeout(this.notificationTimeout),this.notificationTimeout=null),this.$notifications.toggleClass("hidden",!0)},N.prototype.updateError=function(t,e){function i(t){return"Error"===t?3:"Loading"===t?2:"NoResults"===t?1:0}var a=this,t=t.getKey(),e=(e?this.errors[t]=e:this.errors[t]?delete this.errors[t]:this.errors={},_.reduce(this.errors,function(t,e){e=e.type;return i(e)>i(t)?e:t},""));e&&("NoResults"!=e||_.keys(this.dataSource).length===_.keys(this.errors).length)?(t=_.map(this.errors,function(t,e){var t=t.error,i=a.dataSource;return t?"["+i.getPath()+"]: "+t:null}).filter(function(t){return t}),this.api.showQueryStatus({error:t.join("\n"),type:e})):this.api.hideQueryStatus()},N.getComponentDefinition=b.getComponentDefinition,N.DEBUG=!1,N);function N(t){var e=ot.call(this,t)||this;return e.largeDataThreshold=100,e.isPendingFirstOnSettingsChange=!0,e.isReadyForThemeChange=!1,e.errors={},e.isMatrix=!0,e.propertiesChanging=!1,e.isMatrix="matrix"===t.settingsModel.get("Basics.ChartType"),e.api=t.api,e.options=t,e.dashboardViewModel=t.dashboardViewModel,e.$el.html(r.app({})),e.$el.addClass("scatter-plot"),e.$echart=e.$el.find(".chart-area"),e.$legends=e.$el.find(".chart-legends-container"),e.$notifications=e.$el.find(".notifications-panel"),e.xAxes=e.initAxis(),e.yAxes=e.initAxis(),e.matrixCols=e.intiMatrixColumns(),e.chartModel=new F(e.api,e.xAxes,e.yAxes,e),e.legendModel=new it(e.chartModel,e),e.crosshairModel=new Q(e.dataSource,e.api,e.$el,_.bind(e.chartModel.getAxisFormatters,e.chartModel),_.bind(e.chartModel.getChartDataObj,e.chartModel),_.bind(e.chartModel.getTooltipSvgStyles,e.chartModel),_.bind(e.chartModel.getVisbileCharts,e.chartModel)),e.matrixModel=new rt(e.api,e.matrixCols,e.crosshairModel,e,e.$el),e.listenTo(e.chartModel,"updateChart",e.updateChart),e.listenTo(e.matrixModel,"updateChart",e.updateChart),e.listenTo(e.crosshairModel,"updateChart",e.updateChartWrapper),e.listenTo(e.legendModel,"updateChart",e.updateChartWrapper),e}return nt});