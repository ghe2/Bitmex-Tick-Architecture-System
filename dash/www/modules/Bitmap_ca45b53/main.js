define(["backbone","Handlebars","QuickBase","css!./css/app.css"],function(e,i,a){"use strict";var s,n,r=this&&this.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),o=(p.getComponentDefinition=function(t){var e={id:1998,componentName:"Bitmap",componentDescription:"Bitmap",appKey:"Bitmap",css:"bitmap",listViewThumb:null,ghostViewThumb:null,buildViewThumb:null,appArgs:{websiteUrl:t.websiteUrl,json:{version:"4.0.0d2",Basics:{Data:"",Width:0,Height:0,Theme:"Dark"},Style:{advanced:""}},schema:{type:"object",title:"Properties",properties:{Basics:{type:"object",title:"Settings",options:{collapsed:!1},propertyOrder:200,properties:{Data:{type:"data",title:"Data Source",default:""},Width:{type:"viewstate",title:"Width",default:"0"},Height:{type:"viewstate",title:"Height",default:"0"},Theme:{type:"string",title:"Theme",options:{hidden:!0},enum:["Dark","Light"]},DashboardTheme:{options:{hidden:!0}}}},Style:{type:"object",title:"Style",options:{collapsed:!0},propertyOrder:210,properties:{advanced:{type:"css",title:"Advanced CSS",default:""}}}}}}};if(0<_.keys(t.settingsModel.attributes).length)for(var i=_.find(p.upgrades,{version:t.settingsModel.get("version")}),a=void 0===i?1:p.upgrades.indexOf(i)+1;a<p.upgrades.length;a+=1){var s=p.upgrades[a];s.fn(t.settingsModel),t.settingsModel.set("version",s.version)}return e},p.upgrades=[{version:0,fn:function(t){}}],p);function p(){}function h(t){var e=n.call(this,t)||this;return e.data=[],e.hasInit=!1,e.uniqueId=_.uniqueId("bitmap_"),e.api=t.api,e.$el.html("<canvas></canvas>"),e.canvasEl=e.$el.find("canvas")[0],e.$el.addClass("bitmap-app"),e}return n=e.View,r(h,n),h.prototype.onResizeStop=function(){var t=this.$el.width(),e=this.$el.height();this.api.setProperty("Basics.Width",t),this.api.setProperty("Basics.Height",e)},h.prototype.onSettingsChange=function(t){this.hasInit||(this.hasInit=!0,this.onResizeStop()),t.hasOwnProperty(h.PROP_DATA)&&this.applyDataProperty(t[h.PROP_DATA])},h.prototype.onData=function(t,e,i){if(i)this.api.showQueryStatus(i);else{this.api.hideQueryStatus();var i=e.cols.width.getValue(0),a=e.cols.height.getValue(0),e=e.cols.data.getValue(0);if(i&&a){this.canvasEl.width=i,this.canvasEl.height=a;e=new ImageData(new Uint8ClampedArray(e.dataView.buffer,e.offset,i*a*4),i,a),i=this.canvasEl.getContext("2d");if(!i)throw new Error("Bitmap: error getting context");i.putImageData(e,0,0)}}},h.prototype.applyDataProperty=function(e){var i,a=this;this.dataSrc&&(this.api.unsubscribe(this.dataSrc),this.dataSrc=void 0),e?(this.dataSrc=e,this.dataSrc&&this.dataSrc.attributes?((i=function(t,e){e?a.api.showQueryStatus(e):a.api.hideQueryStatus()})(this.dataSrc,this.dataSrc.get("queryStatus")),this.listenTo(this.dataSrc,"change:queryStatus",i),this.api.subscribe(this.dataSrc,this.onData.bind(this),!0)):this.api.showErrorMessage({error:t('Invalid Data Source: "')+e.path+'" '+t("selected"),type:"Warning"})):this.api.showErrorMessage({error:t("To populate this component, please define a")+" <b> "+t("Data Source")+"</b> "+t("from")+"<b> "+t("Properties")+"-"+t("Basics")+"</b>",type:"Warning"})},h.getComponentDefinition=o.getComponentDefinition,h.PROP_DATA="Basics.Data",h});