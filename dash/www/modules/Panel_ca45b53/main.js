define(["backbone","Handlebars","QuickBase","css!./css/main.css"],function(e,t,d){o.app=t.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,o,n){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="configure-widgets">\n    <a class="show-configure-menu ui-widget ui-state-active">\n        <i class="fa fa-cog"></i> <i class="fa fa-caret-down"></i>\n    </a>\n    <ul class="configure-widgets-menu ui-widget ui-widget-content"></ul>\n</div>\n<div class="worksheet">\n    <div class="grid-stack"><div class="grid-stack-overlay"></div></div>\n    <div class="worksheet-highlight-item"></div>\n    <div class="row-highlight-item"></div>\n    <div class="highlight-viewport">\n        <div class="highlight-layer">\n            <div class="highlight-item">\n\n            </div>\n        </div>\n    </div>\n    <div class="no-widgets-info">\n        <div class="loading">'+t.escapeExpression((s(i,"t")||e&&s(e,"t")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},"start dragging widgets from the panel on your left",{name:"t",hash:{},data:n,loc:{start:{line:19,column:29},end:{line:19,column:87}}}))+'</div>\n\n        <div class="dragComponentsHelp">\n            <i class="fa fa-chevron-right"></i>\n            <i class="fa fa-chevron-right"></i>\n            <i class="fa fa-chevron-right"></i>\n        </div>\n    </div>\n</div>'},useData:!0}),o.configureWidgetsMenu=t.template({1:function(t,e,i,o,n){var s,a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,d="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li data-widgetid="'+h(typeof(s=null!=(s=t(i,"id")||(null!=e?t(e,"id"):e))?s:r)==d?s.call(a,{name:"id",hash:{},data:n,loc:{start:{line:3,column:23},end:{line:3,column:29}}}):s)+'"><i class="fa fa-plus-circle"></i> '+h(typeof(s=null!=(s=t(i,"name")||(null!=e?t(e,"name"):e))?s:r)==d?s.call(a,{name:"name",hash:{},data:n,loc:{start:{line:3,column:65},end:{line:3,column:73}}}):s)+"</li>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,i,o,n){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<li class="ui-widget-header">Available Widgets</li>\n'+(null!=(i=s(i,"each").call(null!=e?e:t.nullContext||{},null!=e?s(e,"widgets"):e,{name:"each",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:2,column:0},end:{line:4,column:9}}}))?i:"")+'<li>-</li>\n<li data-actionid="reset">Reset Layout</li>'},useData:!0});var i=o;function o(){}function n(){this.styleMap={},this.styleMapUsage={}}var s,a,r={getComponentDefinition:function(t){var e,i,o={id:50,componentName:"panel",componentDescription:"group multiple components together with a panel",appKey:"Panel",disable_array_reorder:!0,appArgs:{json:{version:"4.4.0",Basics:{ComponentName:"panel",RelativeHeight:!0,Advanced:!1,UserLayout:!1,Floatable:!0,ColCount:36,RowHeight:25,RowCount:24},Style:{advanced:""}},schema:{type:"object",title:"Properties",_transform:function(t,e,i,o){_.set(e,"properties.Basics.properties.RowCount.options.hidden",!_.get(t,"Basics.RelativeHeight")),_.set(e,"properties.Basics.properties.RowHeight.options.hidden",!!_.get(t,"Basics.RelativeHeight")),o(void 0,e)},properties:{Basics:{type:"object",title:"Basics",options:{disable_array_reorder:!0},properties:{ComponentName:{type:"string",title:"hide me",options:{hidden:!0}},RelativeHeight:{type:"boolean",title:"Fill Height",default:!0,format:"checkbox"},Advanced:{type:"boolean",title:"Advanced Layout",default:!1,format:"checkbox"},UserLayout:{type:"boolean",title:"User Layout",default:!1,format:"checkbox"},Floatable:{type:"boolean",title:"Floatable",default:!0,format:"checkbox"},ColCount:{title:"Column Count",type:"number",minimum:1,default:36},RowHeight:{title:"Row Height",type:"number",default:25,options:{hidden:!0}},RowCount:{title:"Row Count",type:"number",minimum:1,default:24}}},Style:{type:"object",title:"Style",options:{collapsed:!0},properties:{advanced:{type:"css",title:"Advanced CSS",default:""}}}}}}};if(0<_.keys(t.settingsModel.attributes).length)for(i=r.upgrades.indexOf(_.find(r.upgrades,{version:t.settingsModel.get("version")}))+1;i<r.upgrades.length;i+=1)(e=r.upgrades[i]).fn(t.settingsModel,t),t.settingsModel.set("version",e.version);return o},upgrades:[{version:"4.0.0d15",fn:function(t,e){t.set("Basics.RelativeHeight",!1),t.set("Basics.Advanced",!1),t.set("Style.advanced","")}},{version:"4.0.1",fn:function(t,e){t.set("Basics.UserLayout",!1)}},{version:"4.4.0",fn:function(t,e){t.set("Basics.ColCount",12),t.set("Basics.Floatable",!1),t.set("Basics.RowHeight",t.get("Basics.RelativeHeight")?void 0:25),t.set("Basics.RowCount",void 0)}}]},h=(Object.assign(n.prototype,{add:function(t){this.styleMapUsage[t]=this.styleMapUsage[t]||0,0===this.styleMapUsage[t]&&(this.styleMap[t]=this._createStyle(t)),this.styleMapUsage[t]++},_createStyle:function(t){var e,i,o,n=[],s=100/t,a=".grid-stack.grid-stack-"+t+">.grid-stack-item";for(n.push(a+"{min-width:"+ +s.toFixed(5)+"%}"),i=1;i<=t;i++)e=+(s*i).toFixed(5),n.push(a+"[data-gs-width='"+i+"']{width:"+e+"%}"),n.push(a+"[data-gs-x='"+i+"']{left:"+e+"%}");return(o=document.createElement("style")).setAttribute("type","text/css"),o.innerHTML=n.join(""),document.head.appendChild(o),o},remove:function(t){var e;this.styleMapUsage[t]--,0===this.styleMapUsage[t]&&(e=this.styleMap[t])&&(e.parentNode.removeChild(e),this.styleMap[t]=null)}}),t=document.createElement("canvas"),s={canvas:!!(M=t.getContext("2d")),imageData:!!M.getImageData,dataURL:!!t.toDataURL,btoa:!!window.btoa},a="image/octet-stream",{saveAsImage:y,saveAsPNG:function(t,e,i){return y(t,e,i,"png")},saveAsJPEG:function(t,e,i){return y(t,e,i,"jpeg")},saveAsGIF:function(t,e,i){return y(t,e,i,"gif")},saveAsBMP:function(t,e,i){return y(t,e,i,"bmp")},convertToImage:b,convertToPNG:function(t,e,i){return b(t,e,i,"png")},convertToJPEG:function(t,e,i){return b(t,e,i,"jpeg")},convertToGIF:function(t,e,i){return b(t,e,i,"gif")},convertToBMP:function(t,e,i){return b(t,e,i,"bmp")}});function l(t,e,i){var o=t.width,n=t.height,s=(null==e&&(e=o),null==i&&(i=n),document.createElement("canvas")),a=s.getContext("2d");return s.width=e,s.height=i,a.drawImage(t,0,0,o,n,0,0,e,i),s}function g(t,e,i,o){return(t=l(t,i,o)).toDataURL(e)}function c(t){document.location.href=t}function u(t){var e=document.createElement("img");return e.src=t,e}function p(t){return"image/"+(t=t.toLowerCase().replace(/jpg/i,"jpeg")).match(/png|jpeg|bmp|gif/)[0]}function f(t){if(!window.btoa)throw"btoa undefined";var e="";if("string"==typeof t)e=t;else for(var i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return btoa(e)}function m(t){var e=t.width,i=t.height;return t.getContext("2d").getImageData(0,0,e,i)}function v(t,e){return"data:"+e+";base64,"+t}function w(t){var e=t.width,i=t.height,o=[66,77,255&(o=54+(n=e*i*3)),o>>8&255,o>>16&255,o>>24&255,0,0,0,0,54,0,0,0],n=[40,0,0,0,255&e,e>>8&255,e>>16&255,e>>24&255,255&i,i>>8&255,i>>16&255,i>>24&255,1,0,24,0,0,0,0,0,255&n,n>>8&255,n>>16&255,n>>24&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=(4-3*e%4)%4,a=t.data,r="",d=e<<2,h=i,l=String.fromCharCode;do{for(var g=d*(h-1),c="",u=0;u<e;u++){var p=u<<2;c+=l(a[g+p+2])+l(a[g+p+1])+l(a[g+p])}for(var m=0;m<s;m++)c+=String.fromCharCode(0)}while(r+=c,--h);return f(o.concat(n))+f(r)}function y(t,e,i,o){var n;s.canvas&&s.dataURL&&("string"==typeof t&&(t=document.getElementById(t)),o=p(o=null==o?"png":o),/bmp/.test(o)?(n=m(l(t,e,i)),c(v(w(n),a))):c(g(t,o,e,i).replace(o,a)))}function b(t,e,i,o){var n;if(s.canvas&&s.dataURL)return"string"==typeof t&&(t=document.getElementById(t)),o=p(o=null==o?"png":o),/bmp/.test(o)?(n=m(l(t,e,i)),u(v(w(n),"image/bmp"))):u(g(t,o,e,i))}!function(Y,K,j){"use strict";var a,e,s,r,d,i,t,m,X={};function h(t,e,i){var o,n=t.runtimeStyle&&t.runtimeStyle[e],s=t.style;return!/^-?[0-9]+\.?[0-9]*(?:px)?$/i.test(i)&&/^-?\d/.test(i)&&(o=s.left,n&&(t.runtimeStyle.left=t.currentStyle.left),s.left="fontSize"===e?"1em":i||0,i=s.pixelLeft+"px",s.left=o,n&&(t.runtimeStyle.left=n)),/^(thin|medium|thick)$/i.test(i)?i:Math.round(parseFloat(i))+"px"}function l(t){return parseInt(t,10)}function g(t,e,i,o,n,s){var a,r,d,e=X.Util.getCSS(e,t,n);return 1===e.length&&(n=e[0],(e=[])[0]=n,e[1]=n),-1!==e[0].toString().indexOf("%")?(a=parseFloat(e[0])/100,r=i.width*a,"backgroundSize"!==t&&(r-=(s||o).width*a)):"backgroundSize"===t?"auto"===e[0]?r=o.width:/contain|cover/.test(e[0])?(r=(n=X.Util.resizeBounds(o.width,o.height,i.width,i.height,e[0])).width,d=n.height):r=parseInt(e[0],10):r=parseInt(e[0],10),"auto"===e[1]?d=r/o.width*o.height:-1!==e[1].toString().indexOf("%")?(a=parseFloat(e[1])/100,d=i.height*a,"backgroundSize"!==t&&(d-=(s||o).height*a)):d=parseInt(e[1],10),[r,d]}function c(t){return function(e){try{t.addColorStop(e.stop,e.color)}catch(t){i.log(["failed to add color stop: ",t,"; tried to add: ",e])}}}X.Util={},X.Util.log=function(t){X.logging&&Y.console&&Y.console.log&&Y.console.log(t)},X.Util.trimText=(e=String.prototype.trim,function(t){return e?e.apply(t):((t||"")+"").replace(/^\s+|\s+$/g,"")}),X.Util.asFloat=function(t){return parseFloat(t)},s=/((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g,r=/(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g,X.Util.parseTextShadows=function(t){if(!t||"none"===t)return[];for(var e=t.match(s),i=[],o=0;e&&o<e.length;o++){var n=e[o].match(r);i.push({color:n[0],offsetX:n[1]?n[1].replace("px",""):0,offsetY:n[2]?n[2].replace("px",""):0,blur:n[3]?n[3].replace("px",""):0})}return i},X.Util.parseBackgroundImage=function(t){function e(){i&&((o='"'===o.substr(0,1)?o.substr(1,o.length-2):o)&&h.push(o),"-"===i.substr(0,1)&&0<(s=i.indexOf("-",1)+1)&&(n=i.substr(0,s),i=i.substr(s)),l.push({prefix:n,method:i.toLowerCase(),value:a,args:h})),h=[],i=n=o=a=""}var i,o,n,s,a,r,d,h,l=[],g=0,c=0;e();for(var u=0,p=t.length;u<p;u++)if(r=t[u],!(0===g&&-1<" \r\n\t".indexOf(r))){switch(r){case'"':d?d===r&&(d=null):d=r;break;case"(":if(d)break;if(0===g){g=1,a+=r;continue}c++;break;case")":if(d)break;if(1===g){if(0===c){g=0,a+=r,e();continue}c--}break;case",":if(d)break;if(0===g){e();continue}if(1!==g||0!==c||i.match(/^url$/i))break;h.push(o),o="",a+=r;continue}a+=r,0===g?i+=r:o+=r}return e(),l},X.Util.Bounds=function(t){var e,i={};return t.getBoundingClientRect&&(e=t.getBoundingClientRect(),i.top=e.top,i.bottom=e.bottom||e.top+e.height,i.left=e.left,i.width=t.offsetWidth,i.height=t.offsetHeight),i},X.Util.OffsetBounds=function(t){var e=t.offsetParent?X.Util.OffsetBounds(t.offsetParent):{top:0,left:0};return{top:t.offsetTop+e.top,bottom:t.offsetTop+t.offsetHeight+e.top,left:t.offsetLeft+e.left,width:t.offsetWidth,height:t.offsetHeight}},X.Util.getCSS=function(t,e,i){var o=(a=void 0!==t?K.defaultView.getComputedStyle(t,null):a)[e];if(/^background(Size|Position)$/.test(e)){var n=o,s=e;if(n=(n=(n||"").split(","))[i||0]||n[0]||"auto",n=X.Util.trimText(n).split(" "),"backgroundSize"!==s||n[0]&&!n[0].match(/cover|contain|auto/)){if(n[0]=-1===n[0].indexOf("%")?h(t,s+"X",n[0]):n[0],n[1]===j){if("backgroundSize"===s)return n[1]="auto",n;n[1]=n[0]}n[1]=-1===n[1].indexOf("%")?h(t,s+"Y",n[1]):n[1]}return n}return/border(Top|Bottom)(Left|Right)Radius/.test(e)?((i=o.split(" ")).length<=1&&(i[1]=i[0]),i.map(l)):o},X.Util.resizeBounds=function(t,e,i,o,n){var s,a,t=t/e;return n&&"auto"!==n?i/o<t^"contain"===n?s=(a=o)*t:a=(s=i)/t:(s=i,a=o),{width:s,height:a}},X.Util.BackgroundPosition=function(t,e,i,o,n){t=g("backgroundPosition",t,e,i,o,n);return{left:t[0],top:t[1]}},X.Util.BackgroundSize=function(t,e,i,o){t=g("backgroundSize",t,e,i,o);return{width:t[0],height:t[1]}},X.Util.Extend=function(t,e){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},X.Util.Children=function(t){var e;try{e=t.nodeName&&"IFRAME"===t.nodeName.toUpperCase()?t.contentDocument||t.contentWindow.document:function(t){var e=[];if(null!==t){var i=e,o=t,n=i.length,s=0;if("number"==typeof o.length)for(var a=o.length;s<a;s++)i[n++]=o[s];else for(;o[s]!==j;)i[n++]=o[s++];i.length=n}return e}(t.childNodes)}catch(t){X.Util.log("html2canvas.Util.Children failed with exception: "+t.message),e=[]}return e},X.Util.isTransparent=function(t){return"transparent"===t||"rgba(0, 0, 0, 0)"===t},X.Util.Font=(d={},function(t,e,i){if(d[t+"-"+e]!==j)return d[t+"-"+e];var o,n=i.createElement("div"),s=i.createElement("img"),a=i.createElement("span"),r="Hidden Text";return n.style.visibility="hidden",n.style.fontFamily=t,n.style.fontSize=e,n.style.margin=0,n.style.padding=0,i.body.appendChild(n),s.src="data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACwAAAAAAQABAAACAkQBADs=",s.width=1,s.height=1,s.style.margin=0,s.style.padding=0,s.style.verticalAlign="baseline",a.style.fontFamily=t,a.style.fontSize=e,a.style.margin=0,a.style.padding=0,a.appendChild(i.createTextNode(r)),n.appendChild(a),n.appendChild(s),o=s.offsetTop-a.offsetTop+1,n.removeChild(a),n.appendChild(i.createTextNode(r)),n.style.lineHeight="normal",s.style.verticalAlign="super",a=s.offsetTop-n.offsetTop+1,d[t+"-"+e]=r={baseline:o,lineWidth:1,middle:a},i.body.removeChild(n),r}),i=X.Util,t={},X.Generate=t,m=[/^(-webkit-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-gradient)\((linear|radial),\s((?:\d{1,3}%?)\s(?:\d{1,3}%?),\s(?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)\-]+)\)$/,/^(-moz-linear-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-moz-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s?([a-z\-]*)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/],t.parseGradient=function(t,e){for(var i,o,n,s,a,r,d,h,l,g,c,u=m.length,p=0;p<u&&!(o=t.match(m[p]));p+=1);if(o)switch(o[1]){case"-webkit-linear-gradient":case"-o-linear-gradient":if(i={type:"linear",x0:null,y0:null,x1:null,y1:null,colorStops:[]},s=o[2].match(/\w+/g))for(a=s.length,p=0;p<a;p+=1)switch(s[p]){case"top":i.y0=0,i.y1=e.height;break;case"right":i.x0=e.width,i.x1=0;break;case"bottom":i.y0=e.height,i.y1=0;break;case"left":i.x0=0,i.x1=e.width}if(null===i.x0&&null===i.x1&&(i.x0=i.x1=e.width/2),null===i.y0&&null===i.y1&&(i.y0=i.y1=e.height/2),s=o[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g))for(a=s.length,r=1/Math.max(a-1,1),p=0;p<a;p+=1)(d=s[p].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/))[2]?(n=parseFloat(d[2]),"%"===d[3]?n/=100:n/=e.width):n=p*r,i.colorStops.push({color:d[1],stop:n});break;case"-webkit-gradient":if(i={type:"radial"===o[2]?"circle":o[2],x0:0,y0:0,x1:0,y1:0,colorStops:[]},(s=o[3].match(/(\d{1,3})%?\s(\d{1,3})%?,\s(\d{1,3})%?\s(\d{1,3})%?/))&&(i.x0=s[1]*e.width/100,i.y0=s[2]*e.height/100,i.x1=s[3]*e.width/100,i.y1=s[4]*e.height/100),s=o[4].match(/((?:from|to|color-stop)\((?:[0-9\.]+,\s)?(?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)\))+/g))for(a=s.length,p=0;p<a;p+=1)d=s[p].match(/(from|to|color-stop)\(([0-9\.]+)?(?:,\s)?((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\)/),n=parseFloat(d[2]),"from"===d[1]&&(n=0),"to"===d[1]&&(n=1),i.colorStops.push({color:d[3],stop:n});break;case"-moz-linear-gradient":if(i={type:"linear",x0:0,y0:0,x1:0,y1:0,colorStops:[]},(s=o[2].match(/(\d{1,3})%?\s(\d{1,3})%?/))&&(i.x0=s[1]*e.width/100,i.y0=s[2]*e.height/100,i.x1=e.width-i.x0,i.y1=e.height-i.y0),s=o[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}%)?)+/g))for(a=s.length,r=1/Math.max(a-1,1),p=0;p<a;p+=1)(d=s[p].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%)?/))[2]?(n=parseFloat(d[2]),d[3]&&(n/=100)):n=p*r,i.colorStops.push({color:d[1],stop:n});break;case"-webkit-radial-gradient":case"-moz-radial-gradient":case"-o-radial-gradient":if(i={type:"circle",x0:0,y0:0,x1:e.width,y1:e.height,cx:0,cy:0,rx:0,ry:0,colorStops:[]},(s=o[2].match(/(\d{1,3})%?\s(\d{1,3})%?/))&&(i.cx=s[1]*e.width/100,i.cy=s[2]*e.height/100),s=o[3].match(/\w+/),d=o[4].match(/[a-z\-]*/),s&&d)switch(d[0]){case"farthest-corner":case"cover":case"":h=Math.sqrt(Math.pow(i.cx,2)+Math.pow(i.cy,2)),l=Math.sqrt(Math.pow(i.cx,2)+Math.pow(i.y1-i.cy,2)),g=Math.sqrt(Math.pow(i.x1-i.cx,2)+Math.pow(i.y1-i.cy,2)),c=Math.sqrt(Math.pow(i.x1-i.cx,2)+Math.pow(i.cy,2)),i.rx=i.ry=Math.max(h,l,g,c);break;case"closest-corner":h=Math.sqrt(Math.pow(i.cx,2)+Math.pow(i.cy,2)),l=Math.sqrt(Math.pow(i.cx,2)+Math.pow(i.y1-i.cy,2)),g=Math.sqrt(Math.pow(i.x1-i.cx,2)+Math.pow(i.y1-i.cy,2)),c=Math.sqrt(Math.pow(i.x1-i.cx,2)+Math.pow(i.cy,2)),i.rx=i.ry=Math.min(h,l,g,c);break;case"farthest-side":"circle"===s[0]?i.rx=i.ry=Math.max(i.cx,i.cy,i.x1-i.cx,i.y1-i.cy):(i.type=s[0],i.rx=Math.max(i.cx,i.x1-i.cx),i.ry=Math.max(i.cy,i.y1-i.cy));break;case"closest-side":case"contain":"circle"===s[0]?i.rx=i.ry=Math.min(i.cx,i.cy,i.x1-i.cx,i.y1-i.cy):(i.type=s[0],i.rx=Math.min(i.cx,i.x1-i.cx),i.ry=Math.min(i.cy,i.y1-i.cy))}if(s=o[5].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g))for(a=s.length,r=1/Math.max(a-1,1),p=0;p<a;p+=1)(d=s[p].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/))[2]?(n=parseFloat(d[2]),"%"===d[3]?n/=100:n/=e.width):n=p*r,i.colorStops.push({color:d[1],stop:n})}return i},t.Gradient=function(t,e){if(0!==e.width&&0!==e.height){var i,o,n=K.createElement("canvas"),s=n.getContext("2d");if(n.width=e.width,n.height=e.height,i=X.Generate.parseGradient(t,e))switch(i.type){case"linear":o=s.createLinearGradient(i.x0,i.y0,i.x1,i.y1),i.colorStops.forEach(c(o)),s.fillStyle=o,s.fillRect(0,0,e.width,e.height);break;case"circle":o=s.createRadialGradient(i.cx,i.cy,0,i.cx,i.cy,i.rx),i.colorStops.forEach(c(o)),s.fillStyle=o,s.fillRect(0,0,e.width,e.height);break;case"ellipse":var a=K.createElement("canvas"),r=a.getContext("2d"),d=Math.max(i.rx,i.ry),h=2*d;a.width=a.height=h,o=r.createRadialGradient(i.rx,i.ry,0,i.rx,i.ry,d),i.colorStops.forEach(c(o)),r.fillStyle=o,r.fillRect(0,0,h,h),s.fillStyle=i.colorStops[i.colorStops.length-1].color,s.fillRect(0,0,n.width,n.height),s.drawImage(a,i.cx-i.rx,i.cy-i.ry,2*i.rx,2*i.ry)}return n}},t.ListAlpha=function(t){for(var e="";e=String.fromCharCode(64+t%26)+e,26<26*(t/=26););return e},t.ListRoman=function(t){var e,i=["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"],o=[1e3,900,500,400,100,90,50,40,10,9,5,4,1],n="",s=i.length;if(t<=0||4e3<=t)return t;for(e=0;e<s;e+=1)for(;o[e]<=t;)t-=o[e],n+=i[e];return n},X.Parse=function(e,u){Y.scroll(0,0);var t=u.elements===j?K.body:u.elements[0],c=t.ownerDocument,_=X.Util,d=_.Support(u,c),b=new RegExp("("+u.ignoreElements+")"),n=c.body,N=_.getCSS,C="___html2canvas___pseudoelement",i=c.createElement("style");function p(t,e){t=parseInt(N(t,e),10);return isNaN(t)?0:t}function k(t,e,i,o,n,s){"transparent"!==s&&(t.setVariable("fillStyle",s),t.fillRect(e,i,o,n),0)}function I(t,e,i){if(0<t.length)return e+i.toUpperCase()}function m(t,e,i,o){null!==t&&0<_.trimText(t).length&&(o.fillText(t,e,i),0)}function f(t,e,i,o){var n=N(e,"fontWeight"),s=N(e,"fontFamily"),a=N(e,"fontSize"),r=_.parseTextShadows(N(e,"textShadow"));switch(parseInt(n,10)){case 401:n="bold";break;case 400:n="normal"}if(t.setVariable("fillStyle",o),t.setVariable("font",[N(e,"fontStyle"),N(e,"fontVariant"),n,a,s].join(" ")),t.setVariable("textAlign","left"),r.length&&(t.setVariable("shadowColor",r[0].color),t.setVariable("shadowOffsetX",r[0].offsetX),t.setVariable("shadowOffsetY",r[0].offsetY),t.setVariable("shadowBlur",r[0].blur)),"none"!==i)return _.Font(s,a,c)}function D(t,e,i,o,n){var s,a,r;return d.rangeBounds&&!n?("none"===i&&0===_.trimText(e).length||(i=e,s=t.node,a=t.textOffset,(r=c.createRange()).setStart(s,a),r.setEnd(s,a+i.length),s=r.getBoundingClientRect()),t.textOffset+=e.length):t.node&&"string"==typeof t.node.nodeValue&&(a=o?t.node.splitText(e.length):null,i=t.node,r=n,o=i.parentNode,e=c.createElement("wrapper"),n=i.cloneNode(!0),e.appendChild(i.cloneNode(!0)),o.replaceChild(e,i),i=r?_.OffsetBounds(e):_.Bounds(e),o.replaceChild(n,e),s=i,t.node=a),s}function s(t,e,a){var r,d,h=a.ctx,l=N(t,"color"),g=N(t,"textDecoration"),i=N(t,"textAlign"),c={node:e,textOffset:0};0<_.trimText(e.nodeValue).length&&(e.nodeValue=function(t,e){switch(e){case"lowercase":return t.toLowerCase();case"capitalize":return t.replace(/(^|\s|:|-|\(|\))([a-z])/g,I);case"uppercase":return t.toUpperCase();default:return t}}(e.nodeValue,N(t,"textTransform")),i=i.replace(["-webkit-auto"],["auto"]),d=!u.letterRendering&&/^(left|right|justify|auto)$/.test(i)&&/^(normal|none|0px)$/.test(N(t,"letterSpacing"))?e.nodeValue.split(/(\b| )/):e.nodeValue.split(""),r=f(h,t,g,l),u.chinese&&d.forEach(function(t,e){/.*[\u4E00-\u9FA5].*$/.test(t)&&((t=t.split("")).unshift(e,1),d.splice.apply(d,t))}),d.forEach(function(t,e){e=D(c,t,g,e<d.length-1,a.transform.matrix);if(e){m(t,e.left,e.bottom,h);var i=h,o=e,n=r,s=l;switch(g){case"underline":k(i,o.left,Math.round(o.top+n.baseline+n.lineWidth),o.width,1,s);break;case"overline":k(i,o.left,Math.round(o.top),o.width,1,s);break;case"line-through":k(i,o.left,Math.ceil(o.top+n.middle+n.lineWidth),o.width,1,s)}}}))}function U(t,e){var i,o=function(t){var e=-1,i=1,o=t.parentNode.childNodes;if(t.parentNode){for(;o[++e]!==t;)1===o[e].nodeType&&i++;return i}return-1}(t);switch(e){case"decimal":i=o;break;case"decimal-leading-zero":i=1===o.toString().length?o="0"+o.toString():o.toString();break;case"upper-roman":i=X.Generate.ListRoman(o);break;case"lower-roman":i=X.Generate.ListRoman(o).toLowerCase();break;case"lower-alpha":i=X.Generate.ListAlpha(o).toLowerCase();break;case"upper-alpha":i=X.Generate.ListAlpha(o)}return i+". "}function P(t,e,i){var o,n,s,a,e=e.ctx,r=N(t,"listStyleType");/^(decimal|decimal-leading-zero|upper-alpha|upper-latin|upper-roman|lower-alpha|lower-greek|lower-latin|lower-roman)$/i.test(r)&&(r=U(t,r),o=t,n=r,(a=c.createElement("boundelement")).style.display="inline",s=o.style.listStyleType,o.style.listStyleType="none",a.appendChild(c.createTextNode(n)),o.insertBefore(a,o.firstChild),n=_.Bounds(a),o.removeChild(a),o.style.listStyleType=s,a=n,f(e,t,"none",N(t,"color")),"inside"===N(t,"listStylePosition")&&(e.setVariable("textAlign","left"),m(r,i.left,a.bottom,e)))}function M(t){t=e[t];return!(!t||!0!==t.succeeded)&&t.img}function x(t,e){var i=Math.max(t.left,e.left),o=Math.max(t.top,e.top);return{left:i,top:o,width:Math.min(t.left+t.width,e.left+e.width)-i,height:Math.min(t.top+t.height,e.top+e.height)-o}}function E(t,e,i,o,n){var s=p(e,"paddingLeft"),a=p(e,"paddingTop"),r=p(e,"paddingRight"),e=p(e,"paddingBottom");h(t,i,0,0,i.width,i.height,o.left+s+n[3].width,o.top+a+n[0].width,o.width-(n[1].width+n[3].width+s+r),o.height-(n[0].width+n[2].width+a+e))}i.innerHTML="."+C+'-before:before { content: "" !important; display: none !important; }.'+C+'-after:after { content: "" !important; display: none !important; }',n.appendChild(i),e=e||{};a=(Math.sqrt(2)-1)/3*4;var a,$=function(t,e,i,o){var n=i*a,s=o*a,i=t+i,o=e+o;return{topLeft:l({x:t,y:o},{x:t,y:o-s},{x:i-n,y:e},{x:i,y:e}),topRight:l({x:t,y:e},{x:t+n,y:e},{x:i,y:o-s},{x:i,y:o}),bottomRight:l({x:i,y:e},{x:i,y:e+s},{x:t+n,y:o},{x:t,y:o}),bottomLeft:l({x:i,y:o},{x:i-n,y:o},{x:t,y:e+s},{x:t,y:e})}};function l(s,a,r,d){function h(t,e,i){return{x:t.x+(e.x-t.x)*i,y:t.y+(e.y-t.y)*i}}return{start:s,startControl:a,endControl:r,end:d,subdivide:function(t){var e=h(s,a,t),i=h(a,r,t),o=h(r,d,t),n=h(e,i,t),i=h(i,o,t),t=h(n,i,t);return[l(s,e,n,t),l(t,i,o,d)]},curveTo:function(t){t.push(["bezierCurve",a.x,a.y,r.x,r.y,d.x,d.y])},curveToReversed:function(t){t.push(["bezierCurve",r.x,r.y,a.x,a.y,s.x,s.y])}}}function A(t,e,i,o,n,s,a){0<e[0]||0<e[1]?(t.push(["line",o[0].start.x,o[0].start.y]),o[0].curveTo(t),o[1].curveTo(t)):t.push(["line",s,a]),(0<i[0]||0<i[1])&&t.push(["line",n[0].start.x,n[0].start.y])}function O(t,e,i,o,n,s,a){var r=[];return 0<e[0]||0<e[1]?(r.push(["line",o[1].start.x,o[1].start.y]),o[1].curveTo(r)):r.push(["line",t.c1[0],t.c1[1]]),0<i[0]||0<i[1]?(r.push(["line",s[0].start.x,s[0].start.y]),s[0].curveTo(r),r.push(["line",a[0].end.x,a[0].end.y]),a[0].curveToReversed(r)):(r.push(["line",t.c2[0],t.c2[1]]),r.push(["line",t.c3[0],t.c3[1]])),0<e[0]||0<e[1]?(r.push(["line",n[1].end.x,n[1].end.y]),n[1].curveToReversed(r)):r.push(["line",t.c4[0],t.c4[1]]),r}function z(t,e,i){for(var o,n,s,a,r,d,h,l,g,c,u,p,m,f,v,w,y,_,b,C,k,M,x,E=e.left,S=e.top,H=e.width,W=e.height,R=(x=t,["TopLeft","TopRight","BottomRight","BottomLeft"].map(function(t){return N(x,"border"+t+"Radius")})),T=(h=R,l=i,g=(d=e).left,c=d.top,u=d.width,d=d.height,p=h[0][0],m=h[0][1],f=h[1][0],v=h[1][1],w=h[2][0],y=h[2][1],_=h[3][0],h=h[3][1],b=u-f,C=d-y,k=u-w,M=d-h,{topLeftOuter:$(g,c,p,m).topLeft.subdivide(.5),topLeftInner:$(g+l[3].width,c+l[0].width,Math.max(0,p-l[3].width),Math.max(0,m-l[0].width)).topLeft.subdivide(.5),topRightOuter:$(g+b,c,f,v).topRight.subdivide(.5),topRightInner:$(g+Math.min(b,u+l[3].width),c+l[0].width,b>u+l[3].width?0:f-l[3].width,v-l[0].width).topRight.subdivide(.5),bottomRightOuter:$(g+k,c+C,w,y).bottomRight.subdivide(.5),bottomRightInner:$(g+Math.min(k,u+l[3].width),c+Math.min(C,d+l[0].width),Math.max(0,w-l[1].width),Math.max(0,y-l[2].width)).bottomRight.subdivide(.5),bottomLeftOuter:$(g,c+M,_,h).bottomLeft.subdivide(.5),bottomLeftInner:$(g+l[3].width,c+M,Math.max(0,_-l[3].width),Math.max(0,h-l[2].width)).bottomLeft.subdivide(.5)}),I={clip:function(t,e,i,o,n){var s=[];switch(N(t,"backgroundClip")){case"content-box":case"padding-box":A(s,o[0],o[1],e.topLeftInner,e.topRightInner,n.left+i[3].width,n.top+i[0].width),A(s,o[1],o[2],e.topRightInner,e.bottomRightInner,n.left+n.width-i[1].width,n.top+i[0].width),A(s,o[2],o[3],e.bottomRightInner,e.bottomLeftInner,n.left+n.width-i[1].width,n.top+n.height-i[2].width),A(s,o[3],o[0],e.bottomLeftInner,e.topLeftInner,n.left+i[3].width,n.top+n.height-i[2].width);break;default:A(s,o[0],o[1],e.topLeftOuter,e.topRightOuter,n.left,n.top),A(s,o[1],o[2],e.topRightOuter,e.bottomRightOuter,n.left+n.width,n.top),A(s,o[2],o[3],e.bottomRightOuter,e.bottomLeftOuter,n.left+n.width,n.top+n.height),A(s,o[3],o[0],e.bottomLeftOuter,e.topLeftOuter,n.left,n.top+n.height)}return s}(t,T,i,R,e),borders:[]},D=0;D<4;D++)if(0<i[D].width){switch(o=E,n=S,s=H,a=W-i[2].width,D){case 0:a=i[0].width,r=O({c1:[o,n],c2:[o+s,n],c3:[o+s-i[1].width,n+a],c4:[o+i[3].width,n+a]},R[0],R[1],T.topLeftOuter,T.topLeftInner,T.topRightOuter,T.topRightInner);break;case 1:r=O({c1:[(o=E+H-i[1].width)+(s=i[1].width),n],c2:[o+s,n+a+i[2].width],c3:[o,n+a],c4:[o,n+i[0].width]},R[1],R[2],T.topRightOuter,T.topRightInner,T.bottomRightOuter,T.bottomRightInner);break;case 2:r=O({c1:[o+s,(n=n+W-i[2].width)+(a=i[2].width)],c2:[o,n+a],c3:[o+i[3].width,n],c4:[o+s-i[3].width,n]},R[2],R[3],T.bottomRightOuter,T.bottomRightInner,T.bottomLeftOuter,T.bottomLeftInner);break;case 3:s=i[3].width,r=O({c1:[o,n+a+i[2].width],c2:[o,n],c3:[o+s,n+i[0].width],c4:[o+s,n+a]},R[3],R[0],T.bottomLeftOuter,T.bottomLeftInner,T.topLeftOuter,T.topLeftInner)}I.borders.push({args:r,color:i[D].color})}return I}function S(t,e){var i=t.drawShape();e.forEach(function(t,e){i[0===e?"moveTo":t[0]+"To"].apply(null,t.slice(1))})}function H(e,t,i){var o=c.createElement("valuewrap");["lineHeight","textAlign","fontFamily","color","fontSize","paddingLeft","paddingTop","width","height","border","borderLeftWidth","borderTopWidth"].forEach(function(t){try{o.style[t]=N(e,t)}catch(t){_.log("html2canvas: Parse: Exception caught in renderFormValue: "+t.message)}}),o.style.borderColor="black",o.style.borderStyle="solid",o.style.display="block",o.style.position="absolute",!/^(submit|reset|button|text|password)$/.test(e.type)&&"SELECT"!==e.nodeName||(o.style.lineHeight=N(e,"height")),o.style.top=t.top+"px",o.style.left=t.left+"px",t=(t="SELECT"===e.nodeName?(e.options[e.selectedIndex]||0).text:e.value)||e.placeholder,t=c.createTextNode(t),o.appendChild(t),n.appendChild(o),s(e,t,i),n.removeChild(o)}function h(t){t.drawImage.apply(t,Array.prototype.slice.call(arguments,1)),0}function W(t,e){var i,o=Y.getComputedStyle(t,e);if(o&&o.content&&"none"!==o.content&&"-moz-alt-content"!==o.content&&"none"!==o.display)return t=o.content+"",e=t.substr(0,1),e="url"===(t=e===t.substr(t.length-1)&&e.match(/'|"/)?t.substr(1,t.length-2):t).substr(0,3),i=K.createElement(e?"img":"span"),i.className=C+"-before "+C+"-after",Object.keys(o).filter(L).forEach(function(e){try{i.style[e]=o[e]}catch(t){_.log(["Tried to assign readonly property ",e,"Error:",t])}}),e?i.src=_.parseBackgroundImage(t)[0].args[0]:i.innerHTML=t,i}function L(t){return isNaN(Y.parseInt(t,10))}function g(t,e,i,o){var n=Math.round(o.left+i.left),o=Math.round(o.top+i.top);t.createPattern(e),t.translate(n,o),t.fill(),t.translate(-n,-o)}function r(t,e,i,o,n,s,a,r){var d=[];d.push(["line",Math.round(n),Math.round(s)]),d.push(["line",Math.round(n+a),Math.round(s)]),d.push(["line",Math.round(n+a),Math.round(r+s)]),d.push(["line",Math.round(n),Math.round(r+s)]),S(t,d),t.save(),t.clip(),g(t,e,i,o),t.restore()}function G(t,e,i,o,n){var s=_.BackgroundSize(t,e,o,n),a=_.BackgroundPosition(t,e,o,n,s),t=N(t,"backgroundRepeat").split(",").map(_.trimText);switch(o=function(t,e){if(t.width===e.width&&t.height===e.height)return t;var i=c.createElement("canvas");return i.width=e.width,i.height=e.height,h(i.getContext("2d"),t,0,0,t.width,t.height,0,0,e.width,e.height),i}(o,s),t=t[n]||t[0]){case"repeat-x":r(i,o,a,e,e.left,e.top+a.top,99999,o.height);break;case"repeat-y":r(i,o,a,e,e.left+a.left,e.top,o.width,99999);break;case"no-repeat":r(i,o,a,e,e.left+a.left,e.top+a.top,o.width,o.height);break;default:g(i,o,a,{top:e.top,left:e.left,width:o.width,height:o.height})}}function B(t){return t.replace("px","")}var o,v,w,V=/(matrix)\((.+)\)/;function F(t,e,i,o){g=e?i.width:Math.max(Math.max(c.body.scrollWidth,c.documentElement.scrollWidth),Math.max(c.body.offsetWidth,c.documentElement.offsetWidth),Math.max(c.body.clientWidth,c.documentElement.clientWidth)),a=e?i.height:Math.max(Math.max(c.body.scrollHeight,c.documentElement.scrollHeight),Math.max(c.body.offsetHeight,c.documentElement.offsetHeight),Math.max(c.body.clientHeight,c.documentElement.clientHeight));var n,s,a,r,d,h,l,g={storage:s=[],width:g,height:a,clip:function(){s.push({type:"function",name:"clip",arguments:arguments})},translate:function(){s.push({type:"function",name:"translate",arguments:arguments})},fill:function(){s.push({type:"function",name:"fill",arguments:arguments})},save:function(){s.push({type:"function",name:"save",arguments:arguments})},restore:function(){s.push({type:"function",name:"restore",arguments:arguments})},fillRect:function(){s.push({type:"function",name:"fillRect",arguments:arguments})},createPattern:function(){s.push({type:"function",name:"createPattern",arguments:arguments})},drawShape:function(){var t=[];return s.push({type:"function",name:"drawShape",arguments:t}),{moveTo:function(){t.push({name:"moveTo",arguments:arguments})},lineTo:function(){t.push({name:"lineTo",arguments:arguments})},arcTo:function(){t.push({name:"arcTo",arguments:arguments})},bezierCurveTo:function(){t.push({name:"bezierCurveTo",arguments:arguments})},quadraticCurveTo:function(){t.push({name:"quadraticCurveTo",arguments:arguments})}}},drawImage:function(){s.push({type:"function",name:"drawImage",arguments:arguments})},fillText:function(){s.push({type:"function",name:"fillText",arguments:arguments})},setVariable:function(t,e){return s.push({type:"variable",name:t,arguments:e}),e}},g={ctx:g,opacity:(a=e,g.setVariable("globalAlpha",N(t,"opacity")*(a?a.opacity:1))),cssPosition:N(t,"position"),borders:(n=t,["Top","Right","Bottom","Left"].map(function(t){return{width:p(n,"border"+t+"Width"),color:N(n,"border"+t+"Color")}})),transform:o,clip:e&&e.clip?_.Extend({},e.clip):null};return a=t,o=e,d="static"!==(e=g).cssPosition,h=d?N(a,"zIndex"):"auto",l=N(a,"opacity"),a="none"!==N(a,"cssFloat"),e.zIndex=r={zindex:h,children:[]},r.isPositioned=d,r.isFloated=a,r.opacity=l,r.ownStacking="auto"!==h||l<1,o&&o.zIndex.children.push(e),!0===u.useOverflow&&!0===/(hidden|scroll|auto)/.test(N(t,"overflow"))&&!1===/(BODY)/i.test(t.nodeName)&&(g.clip=g.clip?x(g.clip,i):i),g}function y(t,e,i,o){r=N(a=t,"transform")||N(a,"-webkit-transform")||N(a,"-moz-transform")||N(a,"-ms-transform")||N(a,"-o-transform");var n,s,a,r={origin:(N(a,"transform-origin")||N(a,"-webkit-transform-origin")||N(a,"-moz-transform-origin")||N(a,"-ms-transform-origin")||N(a,"-o-transform-origin")||"0px 0px").split(" ").map(B).map(_.asFloat),matrix:s=r&&"none"!==r&&(a=r.match(V))&&"matrix"===a[1]?a[2].split(",").map(_.trimText).map(_.asFloat):s},d=(a=t,a=(s=r).matrix?_.OffsetBounds(a):_.Bounds(a),s.origin[0]+=a.left,s.origin[1]+=a.top,a),h=F(t,e,d,r),l=h.borders,g=h.ctx,c=(s=d,a=h.clip,s={left:s.left+l[3].width,top:s.top+l[0].width,width:s.width-(l[1].width+l[3].width),height:s.height-(l[0].width+l[2].width)},s=a?x(s,a):s),e=z(t,d,l),r=b.test(t.nodeName)?"#efefef":N(t,"backgroundColor");if(S(g,e.clip),g.save(),g.clip(),0<c.height&&0<c.width&&!o){k(g,d.left,d.top,d.width,d.height,r);for(var u,p=t,m=c,f=g,v=N(p,"backgroundImage"),w=_.parseBackgroundImage(v),y=w.length;y--;)(v=w[y]).args&&0!==v.args.length&&((u=M("url"===v.method?v.args[0]:v.value))?G(p,m,f,u,y):_.log("html2canvas: Error loading background:",v))}else o&&(h.backgroundColor=r);switch(g.restore(),e.borders.forEach(function(t){var e,i;e=g,i=t.args,"transparent"!==(t=t.color)&&(e.setVariable("fillStyle",t),S(e,i),e.fill(),0)}),i||(a=h,o=W(s=t,":before"),r=W(s,":after"),(o||r)&&(o&&(s.className+=" "+C+"-before",s.parentNode.insertBefore(o,s),R(o,a,!0),s.parentNode.removeChild(o),s.className=s.className.replace(C+"-before","").trim()),r&&(s.className+=" "+C+"-after",s.appendChild(r),R(r,a,!0),s.removeChild(r),s.className=s.className.replace(C+"-after","").trim()))),t.nodeName){case"IMG":(n=M(t.getAttribute("src")))?E(g,t,n,d,l):_.log("html2canvas: Error loading <img>:"+t.getAttribute("src"));break;case"INPUT":/^(text|url|email|submit|button|reset)$/.test(t.type)&&0<(t.value||t.placeholder||"").length&&H(t,d,h);break;case"TEXTAREA":0<(t.value||t.placeholder||"").length&&H(t,d,h);break;case"SELECT":0<(t.options||t.placeholder||"").length&&H(t,d,h);break;case"LI":P(t,h,c);break;case"CANVAS":E(g,t,t,d,l)}return h}function R(t,e,i){var o;"none"===N(o=t,"display")||"hidden"===N(o,"visibility")||o.hasAttribute("data-html2canvas-ignore")||(e=y(t,e,i,!1)||e,b.test(t.nodeName)||T(t,e,i))}function T(e,i,o){_.Children(e).forEach(function(t){t.nodeType===t.ELEMENT_NODE?R(t,i,o):t.nodeType===t.TEXT_NODE&&s(e,t,i)})}return o=N(K.documentElement,"backgroundColor"),v=_.isTransparent(o)&&t===K.body,w=y(t,null,!1,v),T(t,w),v&&(o=w.backgroundColor),n.removeChild(i),{backgroundColor:o,stack:w}},X.Preload=function(a){var o,n,t,e,r={numLoaded:0,numFailed:0,numTotal:0,cleanupDone:!1},s=X.Util,d=0,i=a.elements[0]||K.body,h=i.ownerDocument,l=i.getElementsByTagName("img"),g=l.length,c=h.createElement("a"),u=(new Image).crossOrigin!==j;function p(){s.log("html2canvas: start: images: "+r.numLoaded+" / "+r.numTotal+" (failed: "+r.numFailed+")"),!r.firstRun&&r.numLoaded>=r.numTotal&&(s.log("Finished loading images: # "+r.numTotal+" (failed: "+r.numFailed+")"),"function"==typeof a.complete&&a.complete(r))}function m(t,e,i){var o,n,s=a.proxy;c.href=t,t=c.href,o="html2canvas_"+d++,i.callbackname=o,-1<s.indexOf("?")?s+="&":s+="?",s+="url="+encodeURIComponent(t)+"&callback="+o,n=h.createElement("script"),Y[o]=function(t){"error:"===t.substring(0,6)?(i.succeeded=!1,r.numLoaded++,r.numFailed++,p()):(y(e,i),e.src=t),Y[o]=j;try{delete Y[o]}catch(t){}n.parentNode.removeChild(n),n=null,delete i.script,delete i.callbackname},n.setAttribute("type","text/javascript"),n.setAttribute("src",s),i.script=n,Y.document.body.appendChild(n)}function f(t,e){var e=Y.getComputedStyle(t,e),i=e.content;"url"===i.substr(0,3)&&n.loadImage(X.Util.parseBackgroundImage(i)[0].args[0]),w(e.backgroundImage,t)}function v(t){return t&&t.method&&t.args&&0<t.args.length}function w(t,i){var o;X.Util.parseBackgroundImage(t).filter(v).forEach(function(t){var e;"url"===t.method?n.loadImage(t.args[0]):t.method.match(/\-?gradient$/)&&(o===j&&(o=X.Util.Bounds(i)),t=t.value,e=o,(e=X.Generate.Gradient(t,e))!==j&&(r[t]={img:e,succeeded:!0},r.numTotal++,r.numLoaded++,p()))})}function y(e,i){e.onload=function(){i.timer!==j&&Y.clearTimeout(i.timer),r.numLoaded++,i.succeeded=!0,e.onerror=e.onload=null,p()},e.onerror=function(){var t;if("anonymous"===e.crossOrigin&&(Y.clearTimeout(i.timer),a.proxy))return t=e.src,e=new Image,(i.img=e).src=t,void m(e.src,e,i);r.numLoaded++,r.numFailed++,i.succeeded=!1,e.onerror=e.onload=null,p()}}for(c.href=Y.location.href,o=c.protocol+c.host,n={loadImage:function(t){var e,i;t&&r[t]===j&&(e=new Image,t.match(/data:image\/.*;base64,/i)?(e.src=t.replace(/url\(['"]{0,}|['"]{0,}\)$/gi,""),i=r[t]={img:e},r.numTotal++,y(e,i)):(c.href=t,c.href=c.href,c.protocol+c.host===o||!0===a.allowTaint?(i=r[t]={img:e},r.numTotal++,y(e,i),e.src=t):u&&!a.allowTaint&&a.useCORS?(e.crossOrigin="anonymous",i=r[t]={img:e},r.numTotal++,y(e,i),e.src=t):a.proxy&&(i=r[t]={img:e},r.numTotal++,m(t,e,i))))},cleanupDOM:function(t){var e,i;if(!r.cleanupDone){for(i in t&&"string"==typeof t?s.log("html2canvas: Cleanup because: "+t):s.log("html2canvas: Cleanup after timeout: "+a.timeout+" ms."),r)if(r.hasOwnProperty(i)&&"object"==typeof(e=r[i])&&e.callbackname&&e.succeeded===j){Y[e.callbackname]=j;try{delete Y[e.callbackname]}catch(t){}e.script&&e.script.parentNode&&(e.script.setAttribute("src","about:blank"),e.script.parentNode.removeChild(e.script)),r.numLoaded++,r.numFailed++,s.log("html2canvas: Cleaned up failed img: '"+i+"' Steps: "+r.numLoaded+" / "+r.numTotal)}Y.stop!==j?Y.stop():K.execCommand!==j&&K.execCommand("Stop",!1),K.close!==j&&K.close(),r.cleanupDone=!0,t&&"string"==typeof t||p()}},renderingDone:function(){e&&Y.clearTimeout(e)}},0<a.timeout&&(e=Y.setTimeout(n.cleanupDOM,a.timeout)),s.log("html2canvas: Preload starts: finding background-images"),r.firstRun=!0,!function t(e){var i=!1;try{s.Children(e).forEach(t)}catch(t){}try{i=e.nodeType}catch(t){i=!1,s.log("html2canvas: failed to access some element's nodeType - Exception: "+t.message)}if(1===i||i===j){f(i=e,":before"),f(i,":after");try{w(s.getCSS(e,"backgroundImage"),e)}catch(t){s.log("html2canvas: failed to get background-image - Exception: "+t.message)}w(e)}}(i),s.log("html2canvas: Preload: Finding images"),t=0;t<g;t+=1)n.loadImage(l[t].getAttribute("src"));return r.firstRun=!1,s.log("html2canvas: Preload: Done."),r.numTotal===r.numLoaded&&p(),n},X.Renderer=function(t,i){return function(t){var e;if("string"==typeof i.renderer&&X.Renderer[t]!==j)e=X.Renderer[t](i);else{if("function"!=typeof t)throw new Error("Unknown renderer");e=t(i)}if("function"!=typeof e)throw new Error("Invalid renderer defined");return e}(i.renderer)(t,i,K,function(t){var e,r=[];return function e(t,i,o){var n="auto"===i.zIndex.zindex?0:Number(i.zIndex.zindex),s=t,a=i.zIndex.isPositioned,r=i.zIndex.isFloated,d={node:i},h=o;i.zIndex.ownStacking?(s=d.context={"!":[{node:i,children:[]}]},h=j):(a||r)&&(h=d.children=[]),0===n&&o?o.push(d):(t[n]||(t[n]=[]),t[n].push(d)),i.zIndex.children.forEach(function(t){e(s,t,h)})}(e={},t),function s(a){Object.keys(a).sort().forEach(function(t){var e=[],i=[],o=[],n=[];a[t].forEach(function(t){(t.node.zIndex.isPositioned||t.node.zIndex.opacity<1?o:t.node.zIndex.isFloated?i:e).push(t)}),function e(t){t.forEach(function(t){n.push(t),t.children&&e(t.children)})}(e.concat(i,o)),n.forEach(function(t){t.context?s(t.context):r.push(t.node)})})}(e),r}(t.stack),X)},X.Util.Support=function(t,o){return{rangeBounds:(n=!1,o.createRange&&(e=o.createRange()).getBoundingClientRect&&((i=o.createElement("boundtest")).style.height="123px",i.style.display="block",o.body.appendChild(i),e.selectNode(i),123===e.getBoundingClientRect().height&&(n=!0),o.body.removeChild(i)),n),svgRendering:t.svgRendering&&function(){var t=new Image,e=o.createElement("canvas"),i=e.getContext!==j&&e.getContext("2d");if(!1===i)return!1;e.width=e.height=10,t.src=["data:image/svg+xml,","<svg xmlns='http://www.w3.org/2000/svg' width='10' height='10'>","<foreignObject width='10' height='10'>","<div xmlns='http://www.w3.org/1999/xhtml' style='width:10;height:10;'>","sup","</div>","</foreignObject>","</svg>"].join("");try{i.drawImage(t,0,0),e.toDataURL()}catch(t){return!1}return X.Util.log("html2canvas: Parse: SVG powered rendering available"),!0}()};var e,i,n},Y.html2canvas=function(t,e){var i,o={logging:!1,elements:t=t.length?t:[t],background:"#fff",proxy:null,timeout:0,useCORS:!1,allowTaint:!1,svgRendering:!1,ignoreElements:"IFRAME|OBJECT|PARAM",useOverflow:!0,letterRendering:!1,chinese:!1,width:null,height:null,taintTest:!0,renderer:"Canvas"},o=X.Util.Extend(e,o);return X.logging=o.logging,o.complete=function(t){"function"==typeof o.onpreloaded&&!1===o.onpreloaded(t)||(i=X.Parse(t,o),"function"==typeof o.onparsed&&!1===o.onparsed(i)||(i=X.Renderer(i,o),"function"==typeof o.onrendered&&o.onrendered(i)))},Y.setTimeout(function(){X.Preload(o)},0),{render:function(t,e){return X.Renderer(t,X.Util.Extend(e,o))},parse:function(t,e){return X.Parse(t,X.Util.Extend(e,o))},preload:function(t){return X.Preload(X.Util.Extend(t,o))},log:X.Util.log}},Y.html2canvas.log=X.Util.log,Y.html2canvas.Renderer={Canvas:j},X.Renderer.Canvas=function(n){n=n||{};var s=K,a=[],r=K.createElement("canvas"),d=r.getContext("2d"),h=X.Util,l=n.canvas||s.createElement("canvas");function g(t,e){switch(e.type){case"variable":t[e.name]=e.arguments;break;case"function":switch(e.name){case"createPattern":if(0<e.arguments[0].width&&0<e.arguments[0].height)try{t.fillStyle=t.createPattern(e.arguments[0],"repeat")}catch(t){h.log("html2canvas: Renderer: Error creating pattern",t.message)}break;case"drawShape":i=t,o=e.arguments,i.beginPath(),o.forEach(function(t){i[t.name].apply(i,t.arguments)}),i.closePath();break;case"drawImage":0<e.arguments[8]&&0<e.arguments[7]&&(!n.taintTest||n.taintTest&&function(t){if(-1===a.indexOf(t.arguments[0].src)){d.drawImage(t.arguments[0],0,0);try{d.getImageData(0,0,1,1)}catch(t){return r=s.createElement("canvas"),d=r.getContext("2d"),0}a.push(t.arguments[0].src)}return 1}(e))&&t.drawImage.apply(t,e.arguments);break;default:t[e.name].apply(t,e.arguments)}}var i,o}return function(t,e,i,o,n){var s,a=l.getContext("2d"),r=t.stack;return l.width=l.style.width=e.width||r.ctx.width,l.height=l.style.height=e.height||r.ctx.height,s=a.fillStyle,a.fillStyle=h.isTransparent(r.backgroundColor)&&e.background!==j?e.background:t.backgroundColor,a.fillRect(0,0,l.width,l.height),a.fillStyle=s,o.forEach(function(t){a.textBaseline="bottom",a.save(),t.transform.matrix&&(a.translate(t.transform.origin[0],t.transform.origin[1]),a.transform.apply(a,t.transform.matrix),a.translate(-t.transform.origin[0],-t.transform.origin[1])),t.clip&&(a.beginPath(),a.rect(t.clip.left,t.clip.top,t.clip.width,t.clip.height),a.clip()),t.ctx.storage&&t.ctx.storage.forEach(function(t){g(a,t)}),a.restore()}),h.log("html2canvas: Renderer: Canvas renderer done - returning canvas obj"),1===e.elements.length&&"object"==typeof e.elements[0]&&"BODY"!==e.elements[0].nodeName?(r=n.Util.Bounds(e.elements[0]),(t=i.createElement("canvas")).width=Math.ceil(r.width),t.height=Math.ceil(r.height),(a=t.getContext("2d")).drawImage(l,r.left,r.top,r.width,r.height,0,0,r.width,r.height),l=null,t):l}}}(window,document);var C,k,M,x,E,S,H,W,R,T,I,D={initializeBasePanel:function(){this.MAP_MODEL_2_DOCUMENT_MODEL_KEY=_.zipObject([this.KEY_ROW_COUNT,this.KEY_ROW_HEIGHT],["rowCount","rowHeight"]),this.api={setProperty:function(t,e){this.documentModel.set(this.MAP_MODEL_2_DOCUMENT_MODEL_KEY[t],e)}.bind(this)};var t={};this.listenTo(this.documentModel,"change:colCount",this.onChange_BasePanel_colCount),this.listenTo(this.documentModel,"change:floatable",this.onChange_BasePanel_floatable),this.listenTo(this.documentModel,"change:relativeHeight",this.onChange_BasePanel_relativeHeight),this.listenTo(this.documentModel,"change:rowHeight",this.onChange_BasePanel_rowHeight),this.listenTo(this.documentModel,"change:rowCount",this.onChange_BasePanel_rowCount),this.listenTo(this.documentModel,"change:worksheetPadding",this.onChange_BasePanel_worksheetPadding),this.setupChangeSet_colCount(t),this.setupChangeSet_floatable(t),this.setupChangeSet_relativeHeight(t),this.setupChangeSet_rowCount(t),this.setupChangeSet_rowHeight(t),this.onSettingsChange(t)},onChange_BasePanel_colCount:function(){this.model.set("colCount",this.documentModel.get("colCount")),this.onSettingsChange(this.setupChangeSet_colCount())},onChange_BasePanel_floatable:function(){this.model.set("floatable",this.documentModel.get("floatable")),this.onSettingsChange(this.setupChangeSet_floatable())},onChange_BasePanel_relativeHeight:function(){this.model.set("relativeHeight",this.documentModel.get("relativeHeight")),this.onSettingsChange(this.setupChangeSet_relativeHeight())},onChange_BasePanel_rowCount:function(){this.model.set("rowCount",this.documentModel.get("rowCount")),this.onSettingsChange(this.setupChangeSet_rowCount())},onChange_BasePanel_rowHeight:function(){this.model.set("rowHeight",this.documentModel.get("rowHeight")),this.onSettingsChange(this.setupChangeSet_rowHeight())},onChange_BasePanel_worksheetPadding:function(){this.set_gridstackMargin(),this.applyGridStackMargin(),this.onResize(!0)},regenerateThumb:function(){var n=this;this.widgets.length<=0?n.model.set("thumb",null):html2canvas(this.$gridstack,{onrendered:function(t){var e=$(t).attr("height"),i=$(t).attr("width"),o=e/i;200<=i&&o<=1?e=(i=200)*o:100<=e&&(i=(e=100)/o),n.model.set("thumb",h.convertToPNG(t,i,e).src)}})},set_gridstackMargin:function(){this.gridstackMargin=this.documentModel.get("worksheetPadding"),_.isNumber(this.gridstackMargin)||(this.gridstackMargin=10)},setChangeSetKey:function(t,e,i){return t[e]=this.documentModel.get(i),t},setDocumentModelProperty:function(t,e){this.documentModel.set(t,e),this.updatePropertyInspectorForBasePanel()},setupChangeSet_colCount:function(t){return this.setChangeSetKey(t||{},this.KEY_COLUMN_COUNT,"colCount")},setupChangeSet_floatable:function(t){return this.setChangeSetKey(t||{},this.KEY_FLOATABLE,"floatable")},setupChangeSet_relativeHeight:function(t){return this.setChangeSetKey(t||{},this.KEY_RELATIVE_HEIGHT,"relativeHeight")},setupChangeSet_rowCount:function(t){return this.setChangeSetKey(t||{},this.KEY_ROW_COUNT,"rowCount")},setupChangeSet_rowHeight:function(t){return this.setChangeSetKey(t||{},this.KEY_ROW_HEIGHT,"rowHeight")},updatePropertyInspectorForBasePanel:function(){this.documentModel.trigger("basePanelLayoutChanged")}};function N(t){this.grid=t}function A(t){I.GridStackDragDropPlugin.call(this,t)}C=jQuery,k=_,M=window,x=function(t,e){console.warn("gridstack.js: Option `"+t+"` is deprecated as of v0.2.5 and has been replaced with `"+e+"`. It will be **completely** removed in v1.0.")},(E={isIntercepted:function(t,e){return!(t.x+t.width<=e.x||e.x+e.width<=t.x||t.y+t.height<=e.y||e.y+e.height<=t.y)},sort:function(t,e,i){return i=i||k.chain(t).map(function(t){return t.x+t.width}).max().value(),e=-1!=e?1:-1,k.sortBy(t,[function(t){return e*(t.x+t.y*i)}])},createStylesheet:function(t){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.setAttribute("data-gs-style-id",t),e.styleSheet?e.styleSheet.cssText="":e.appendChild(document.createTextNode("")),document.getElementsByTagName("head")[0].appendChild(e),e.sheet},removeStylesheet:function(t){C("STYLE[data-gs-style-id="+t+"]").remove()},insertCSSRule:function(t,e,i,o){"function"==typeof t.insertRule?t.insertRule(e+"{"+i+"}",o):"function"==typeof t.addRule&&t.addRule(e,i,o)},toBool:function(t){return"boolean"==typeof t?t:"string"==typeof t?!(""===(t=t.toLowerCase())||"no"==t||"false"==t||"0"==t):Boolean(t)},_collisionNodeCheck:function(t){return t!=this.node&&E.isIntercepted(t,this.nn)},_didCollide:function(t){return E.isIntercepted({x:this.n.x,y:this.newY,width:this.n.width,height:this.n.height},t)},_isAddNodeIntercepted:function(t){return E.isIntercepted({x:this.x,y:this.y,width:this.node.width,height:this.node.height},t)},parseHeight:function(t){var e="px";if(t&&k.isString(t)){var i=t.match(/^(-[0-9]+\.[0-9]+|[0-9]*\.[0-9]+|-[0-9]+|[0-9]+)(px|em|rem|vh|vw)?$/);if(!i)throw new Error("Invalid height");e=i[2]||"px",t=parseFloat(i[1])}return{height:t,unit:e}},removePositioningStyles:function(t){t=t[0].style;t.position&&t.removeProperty("position"),t.left&&t.removeProperty("left"),t.top&&t.removeProperty("top"),t.width&&t.removeProperty("width"),t.height&&t.removeProperty("height")},getScrollParent:function(t){t=null==t?null:t.scrollHeight>t.clientHeight?t:E.getScrollParent(t.parentNode);return t},updateScrollPosition:function(t,e,i){var o,n,s,a,r=t.getBoundingClientRect(),d=window.innerHeight||document.documentElement.clientHeight;(r.top<0||r.bottom>d)&&(o=r.bottom-d,n=r.top,null!=(s=E.getScrollParent(t))&&(a=s.scrollTop,r.top<0&&i<0?t.offsetHeight>d?s.scrollTop+=i:s.scrollTop+=Math.abs(n)>Math.abs(i)?i:n:0<i&&(t.offsetHeight>d?s.scrollTop+=i:s.scrollTop+=i<o?i:o),e.position.top+=s.scrollTop-a))}}).is_intercepted=(t=function(t,e,i){function o(){return console.warn("gridstack.js: Function `"+e+"` is deprecated as of v0.2.5 and has been replaced with `"+i+"`. It will be **completely** removed in v1.0."),t.apply(this,arguments)}return o.prototype=t.prototype,o})(E.isIntercepted,"is_intercepted","isIntercepted"),E.create_stylesheet=t(E.createStylesheet,"create_stylesheet","createStylesheet"),E.remove_stylesheet=t(E.removeStylesheet,"remove_stylesheet","removeStylesheet"),E.insert_css_rule=t(E.insertCSSRule,"insert_css_rule","insertCSSRule"),N.registeredPlugins=[],N.registerPlugin=function(t){N.registeredPlugins.push(t)},N.prototype.resizable=function(t,e){return this},N.prototype.draggable=function(t,e){return this},N.prototype.droppable=function(t,e){return this},N.prototype.isDroppable=function(t){return!1},N.prototype.on=function(t,e,i){return this},S=0,(H=function(t,e,i,o,n){this.width=t,this.float=i||!1,this.height=o||0,this.nodes=n||[],this.onchange=e||function(){},this._updateCounter=0,this._float=this.float,this._addedNodes=[],this._removedNodes=[]}).prototype.batchUpdate=function(){this._updateCounter=1,this.float=!0},H.prototype.commit=function(){0!==this._updateCounter&&(this._updateCounter=0,this.float=this._float,this._packNodes(),this._notify())},H.prototype.getNodeDataByDOMEl=function(e){return k.find(this.nodes,function(t){return e.get(0)===t.el.get(0)})},H.prototype._fixCollisions=function(t){this._sortNodes(-1);var e=t,i=Boolean(k.find(this.nodes,function(t){return t.locked}));for(this.float||i||(e={x:0,y:t.y,width:this.width,height:t.height});;){var o=k.find(this.nodes,k.bind(E._collisionNodeCheck,{node:t,nn:e}));if(void 0===o)return;this.moveNode(o,o.x,t.y+t.height,o.width,o.height,!0)}},H.prototype.isAreaEmpty=function(t,e,i,o){var n={x:t||0,y:e||0,width:i||1,height:o||1},t=k.find(this.nodes,k.bind(function(t){return E.isIntercepted(t,n)},this));return null==t},H.prototype._sortNodes=function(t){this.nodes=E.sort(this.nodes,t,this.width)},H.prototype._packNodes=function(){this._sortNodes(),this.float?k.each(this.nodes,k.bind(function(t,e){if(!t._updating&&void 0!==t._origY&&t.y!=t._origY)for(var i=t.y;i>=t._origY;)k.chain(this.nodes).take(e).find(k.bind(E._didCollide,{n:t,newY:i})).value()||(t._dirty=!0,t.y=i),--i},this)):k.each(this.nodes,k.bind(function(t,e){if(!t.locked)for(;0<t.y;){var i=t.y-1,o=0===e;if(!(o=0<e?void 0===k.chain(this.nodes).take(e).find(k.bind(E._didCollide,{n:t,newY:i})).value():o))break;t._dirty=t.y!=i,t.y=i}},this))},H.prototype._prepareNode=function(t,e){return(t=k.defaults(t||{},{width:1,height:1,x:0,y:0})).x=parseInt(""+t.x),t.y=parseInt(""+t.y),t.width=parseInt(""+t.width),t.height=parseInt(""+t.height),t.autoPosition=t.autoPosition||!1,t.noResize=t.noResize||!1,t.noMove=t.noMove||!1,t.width>this.width?t.width=this.width:t.width<1&&(t.width=1),t.height<1&&(t.height=1),t.x<0&&(t.x=0),t.x+t.width>this.width&&(e?t.width=this.width-t.x:t.x=this.width-t.width),t.y<0&&(t.y=0),t},H.prototype._notify=function(){var t,e=Array.prototype.slice.call(arguments,0);e[0]=void 0===e[0]?[]:[e[0]],e[1]=void 0===e[1]||e[1],this._updateCounter||(t=e[0].concat(this.getDirtyNodes()),this.onchange(t,e[1]))},H.prototype.cleanNodes=function(){this._updateCounter||k.each(this.nodes,function(t){t._dirty=!1})},H.prototype.getDirtyNodes=function(){return k.filter(this.nodes,function(t){return t._dirty})},H.prototype.addNode=function(t,e){if(void 0!==(t=this._prepareNode(t)).maxWidth&&(t.width=Math.min(t.width,t.maxWidth)),void 0!==t.maxHeight&&(t.height=Math.min(t.height,t.maxHeight)),void 0!==t.minWidth&&(t.width=Math.max(t.width,t.minWidth)),void 0!==t.minHeight&&(t.height=Math.max(t.height,t.minHeight)),t._id=++S,t._dirty=!0,t.autoPosition){this._sortNodes();for(var i=0;;++i){var o=i%this.width,n=Math.floor(i/this.width);if(!(o+t.width>this.width)&&!k.find(this.nodes,k.bind(E._isAddNodeIntercepted,{x:o,y:n,node:t}))){t.x=o,t.y=n;break}}}return this.nodes.push(t),void 0!==e&&e&&this._addedNodes.push(k.clone(t)),this._fixCollisions(t),this._packNodes(),this._notify(),t},H.prototype.removeNode=function(t,e){e=void 0===e||e,this._removedNodes.push(k.clone(t)),t._id=null,this.nodes=k.without(this.nodes,t),this._packNodes(),this._notify(t,e)},H.prototype.canMoveNode=function(e,t,i,o,n){if(!this.isNodeChangedPosition(e,t,i,o,n))return!1;var s,a=Boolean(k.find(this.nodes,function(t){return t.locked}));if(!this.height&&!a)return!0;var r=new H(this.width,null,this.float,0,k.map(this.nodes,function(t){return t==e?s=C.extend({},t):C.extend({},t)}));if(void 0===s)return!0;r.moveNode(s,t,i,o,n);t=!0;return a&&(t&=!Boolean(k.find(r.nodes,function(t){return t!=s&&Boolean(t.locked)&&Boolean(t._dirty)}))),this.height&&(t&=r.getGridHeight()<=this.height),t},H.prototype.canBePlacedWithRespectToHeight=function(t){if(!this.height)return!0;var e=new H(this.width,null,this.float,0,k.map(this.nodes,function(t){return C.extend({},t)}));return e.addNode(t),e.getGridHeight()<=this.height},H.prototype.isNodeChangedPosition=function(t,e,i,o,n){return"number"!=typeof e&&(e=t.x),"number"!=typeof i&&(i=t.y),"number"!=typeof o&&(o=t.width),"number"!=typeof n&&(n=t.height),void 0!==t.maxWidth&&(o=Math.min(o,t.maxWidth)),void 0!==t.maxHeight&&(n=Math.min(n,t.maxHeight)),void 0!==t.minWidth&&(o=Math.max(o,t.minWidth)),void 0!==t.minHeight&&(n=Math.max(n,t.minHeight)),t.x!=e||t.y!=i||t.width!=o||t.height!=n},H.prototype.moveNode=function(t,e,i,o,n,s){if(!this.isNodeChangedPosition(t,e,i,o,n))return t;if("number"!=typeof e&&(e=t.x),"number"!=typeof i&&(i=t.y),"number"!=typeof o&&(o=t.width),"number"!=typeof n&&(n=t.height),void 0!==t.maxWidth&&(o=Math.min(o,t.maxWidth)),void 0!==t.maxHeight&&(n=Math.min(n,t.maxHeight)),void 0!==t.minWidth&&(o=Math.max(o,t.minWidth)),void 0!==t.minHeight&&(n=Math.max(n,t.minHeight)),t.x==e&&t.y==i&&t.width==o&&t.height==n)return t;var a=t.width!=o;return t._dirty=!0,t.x=e,t.y=i,t.width=o,t.height=n,t.lastTriedX=e,t.lastTriedY=i,t.lastTriedWidth=o,t.lastTriedHeight=n,t=this._prepareNode(t,a),this._fixCollisions(t),s||(this._packNodes(),this._notify()),t},H.prototype.getGridHeight=function(){return k.reduce(this.nodes,function(t,e){return Math.max(t,e.y+e.height)},0)},H.prototype.beginUpdate=function(t){k.each(this.nodes,function(t){t._origY=t.y}),t._updating=!0},H.prototype.endUpdate=function(){k.each(this.nodes,function(t){t._origY=t.y});var t=k.find(this.nodes,function(t){return t._updating});t&&(t._updating=!1)},(W=function(t,e){var i,o,n,s,a,r,d=this,t=(e=e||{},this.container=C(t),void 0!==e.handle_class&&(e.handleClass=e.handle_class,x("handle_class","handleClass")),void 0!==e.item_class&&(e.itemClass=e.item_class,x("item_class","itemClass")),void 0!==e.placeholder_class&&(e.placeholderClass=e.placeholder_class,x("placeholder_class","placeholderClass")),void 0!==e.placeholder_text&&(e.placeholderText=e.placeholder_text,x("placeholder_text","placeholderText")),void 0!==e.cell_height&&(e.cellHeight=e.cell_height,x("cell_height","cellHeight")),void 0!==e.vertical_margin&&(e.verticalMargin=e.vertical_margin,x("vertical_margin","verticalMargin")),void 0!==e.min_width&&(e.minWidth=e.min_width,x("min_width","minWidth")),void 0!==e.static_grid&&(e.staticGrid=e.static_grid,x("static_grid","staticGrid")),void 0!==e.is_nested&&(e.isNested=e.is_nested,x("is_nested","isNested")),void 0!==e.always_show_resize_handle&&(e.alwaysShowResizeHandle=e.always_show_resize_handle,x("always_show_resize_handle","alwaysShowResizeHandle")),e.itemClass=e.itemClass||"grid-stack-item",0<this.container.closest("."+e.itemClass).length);this.opts=k.defaults(e||{},{width:parseInt(this.container.attr("data-gs-width"))||12,height:parseInt(this.container.attr("data-gs-height"))||0,itemClass:"grid-stack-item",placeholderClass:"grid-stack-placeholder",placeholderText:"",handle:".grid-stack-item-content",handleClass:null,cellHeight:60,verticalMargin:20,auto:!0,minWidth:768,float:!1,staticGrid:!1,_class:"grid-stack-instance-"+(1e4*Math.random()).toFixed(0),animate:Boolean(this.container.attr("data-gs-animate"))||!1,alwaysShowResizeHandle:e.alwaysShowResizeHandle||!1,resizable:k.defaults(e.resizable||{},{autoHide:!e.alwaysShowResizeHandle,handles:"se"}),draggable:k.defaults(e.draggable||{},{handle:(e.handleClass?"."+e.handleClass:e.handle||"")||".grid-stack-item-content",scroll:!1,appendTo:"body"}),disableDrag:e.disableDrag||!1,disableResize:e.disableResize||!1,rtl:"auto",removable:!1,removableOptions:k.defaults(e.removableOptions||{},{accept:"."+e.itemClass}),removeTimeout:2e3,verticalMarginUnit:"px",cellHeightUnit:"px",disableOneColumnMode:e.disableOneColumnMode||!1,oneColumnModeClass:e.oneColumnModeClass||"grid-stack-one-column-mode",ddPlugin:null}),!1===this.opts.ddPlugin?this.opts.ddPlugin=N:null===this.opts.ddPlugin&&(this.opts.ddPlugin=k.first(N.registeredPlugins)||N),this.dd=new this.opts.ddPlugin(this),"auto"===this.opts.rtl&&(this.opts.rtl="rtl"===this.container.css("direction")),this.opts.rtl&&this.container.addClass("grid-stack-rtl"),this.opts.isNested=t,(o="auto"===this.opts.cellHeight)?d.cellHeight(d.cellWidth(),!0):this.cellHeight(this.opts.cellHeight,!0),this.verticalMargin(this.opts.verticalMargin,!0),this.container.addClass(this.opts._class),this._setStaticClass(),t&&this.container.addClass("grid-stack-nested"),this._initStyles(),this.grid=new H(this.opts.width,function(t,e){e=void 0===e||e;var i=0;k.each(this.nodes,function(t){i=Math.max(i,t.y+t.height)}),k.each(t,function(t){e&&null===t._id?t.el&&t.el.remove():t.el.attr("data-gs-x",t.x).attr("data-gs-y",t.y).attr("data-gs-width",t.width).attr("data-gs-height",t.height)}),d._updateStyles(i+10)},this.opts.float,this.opts.height),this.opts.auto&&(n=[],(s=this).container.children("."+this.opts.itemClass+":not(."+this.opts.placeholderClass+")").each(function(t,e){e=C(e),n.push({el:e,i:parseInt(e.attr("data-gs-x"))+parseInt(e.attr("data-gs-y"))*s.opts.width})}),k.chain(n).sortBy(function(t){return t.i}).each(function(t){d._prepareElement(t.el)}).value()),this.setAnimation(this.opts.animate),this.placeholder=C('<div class="'+this.opts.placeholderClass+" "+this.opts.itemClass+'"><div class="placeholder-content">'+this.opts.placeholderText+"</div></div>").hide(),this._updateContainerHeight(),this._updateHeightsOnResize=k.throttle(function(){d.cellHeight(d.cellWidth(),!1)},100),this.onResizeHandler=function(){o&&d._updateHeightsOnResize(),d._isOneColumnMode()&&!d.opts.disableOneColumnMode?i||(d.container.addClass(d.opts.oneColumnModeClass),i=!0,d.grid._sortNodes(),k.each(d.grid.nodes,function(t){d.container.append(t.el),d.opts.staticGrid||(d.dd.draggable(t.el,"disable"),d.dd.resizable(t.el,"disable"),t.el.trigger("resize"))})):i&&(d.container.removeClass(d.opts.oneColumnModeClass),i=!1,d.opts.staticGrid||k.each(d.grid.nodes,function(t){t.noMove||d.opts.disableDrag||d.dd.draggable(t.el,"enable"),t.noResize||d.opts.disableResize||d.dd.resizable(t.el,"enable"),t.el.trigger("resize")}))},C(window).resize(this.onResizeHandler),this.onResizeHandler(),d.opts.staticGrid||"string"!=typeof d.opts.removable||(e=C(d.opts.removable),this.dd.isDroppable(e)||this.dd.droppable(e,d.opts.removableOptions),this.dd.on(e,"dropover",function(t,e){e=C(e.draggable);e.data("_gridstack_node")._grid===d&&(e.data("inTrashZone",!0),d._setupRemovingTimeout(e))}).on(e,"dropout",function(t,e){e=C(e.draggable);e.data("_gridstack_node")._grid===d&&(e.data("inTrashZone",!1),d._clearRemovingTimeout(e))})),!d.opts.staticGrid&&d.opts.acceptWidgets&&(a=null,r=function(t,e){var i=a,o=i.data("_gridstack_node"),t=d.getCellFromPixel({left:t.pageX,top:t.pageY},!0),n=Math.max(0,t.x),t=Math.max(0,t.y);o._added||(o._added=!0,o.el=i,o.autoPosition=!0,o.x=n,o.y=t,d.grid.cleanNodes(),d.grid.beginUpdate(o),d.grid.addNode(o),d.container.append(d.placeholder),d.placeholder.attr("data-gs-x",o.x).attr("data-gs-y",o.y).attr("data-gs-width",o.width).attr("data-gs-height",o.height).show(),o.el=d.placeholder,o._beforeDragX=o.x,o._beforeDragY=o.y,d._updateContainerHeight()),d.grid.canMoveNode(o,n,t)&&(d.grid.moveNode(o,n,t),d._updateContainerHeight())},this.dd.droppable(d.container,{accept:function(t){var e=(t=C(t)).data("_gridstack_node");return(!e||e._grid!==d)&&t.is(!0===d.opts.acceptWidgets?".grid-stack-item":d.opts.acceptWidgets)}}).on(d.container,"dropover",function(t,e){d.container.offset();var e=C(e.draggable),i=d.cellWidth(),o=d.cellHeight(),n=e.data("_gridstack_node"),i=n?n.width:Math.ceil(e.outerWidth()/i),o=n?n.height:Math.ceil(e.outerHeight()/o),i=(a=e,d.grid._prepareNode({width:i,height:o,_added:!1,_temporary:!0}));e.data("_gridstack_node",i),e.data("_gridstack_node_orig",n),e.on("drag",r)}).on(d.container,"dropout",function(t,e){var i,e=C(e.draggable);e.data("_gridstack_node")&&(e.unbind("drag",r),(i=e.data("_gridstack_node")).el=null,d.grid.removeNode(i),d.placeholder.detach(),d._updateContainerHeight(),e.data("_gridstack_node",e.data("_gridstack_node_orig")))}).on(d.container,"drop",function(t,e){d.placeholder.detach();var i=C(e.draggable).data("_gridstack_node"),o=(i._grid=d,C(e.draggable).clone(!1)),n=(o.data("_gridstack_node",i),C(e.draggable).data("_gridstack_node_orig"));void 0!==n&&void 0!==n._grid&&n._grid._triggerRemoveEvent(),C(e.helper).remove(),i.el=o,d.placeholder.hide(),E.removePositioningStyles(o),o.find("div.ui-resizable-handle").remove(),o.attr("data-gs-x",i.x).attr("data-gs-y",i.y).attr("data-gs-width",i.width).attr("data-gs-height",i.height).addClass(d.opts.itemClass).enableSelection().removeData("draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled").unbind("drag",r),d.container.append(o),d._prepareElementsByNode(o,i),d._updateContainerHeight(),d.grid._addedNodes.push(i),d._triggerAddEvent(),d._triggerChangeEvent(),d.grid.endUpdate(),C(e.draggable).unbind("drag",r),C(e.draggable).removeData("_gridstack_node"),C(e.draggable).removeData("_gridstack_node_orig")}))}).prototype._triggerChangeEvent=function(t){var e=this.grid.getDirtyNodes(),i=!1,o=[];e&&e.length&&(o.push(e),i=!0),!i&&!0!==t||this.container.trigger("change",o)},W.prototype._triggerAddEvent=function(){this.grid._addedNodes&&0<this.grid._addedNodes.length&&(this.container.trigger("added",[k.map(this.grid._addedNodes,k.clone)]),this.grid._addedNodes=[])},W.prototype._triggerRemoveEvent=function(){this.grid._removedNodes&&0<this.grid._removedNodes.length&&(this.container.trigger("removed",[k.map(this.grid._removedNodes,k.clone)]),this.grid._removedNodes=[])},W.prototype._initStyles=function(){this._stylesId&&E.removeStylesheet(this._stylesId),this._stylesId="gridstack-style-"+(1e5*Math.random()).toFixed(),this._styles=E.createStylesheet(this._stylesId),null!==this._styles&&(this._styles._max=0)},W.prototype._updateStyles=function(t){if(null!==this._styles&&void 0!==this._styles){var e,i="."+this.opts._class+" ."+this.opts.itemClass,o=this;if(void 0===t&&(t=this._styles._max),this._initStyles(),this._updateContainerHeight(),this.opts.cellHeight&&!(0!==this._styles._max&&t<=this._styles._max)&&(e=this.opts.verticalMargin&&this.opts.cellHeightUnit!==this.opts.verticalMarginUnit?function(t,e){return t&&e?"calc("+(o.opts.cellHeight*t+o.opts.cellHeightUnit)+" + "+(o.opts.verticalMargin*e+o.opts.verticalMarginUnit)+")":o.opts.cellHeight*t+o.opts.verticalMargin*e+o.opts.cellHeightUnit}:function(t,e){return o.opts.cellHeight*t+o.opts.verticalMargin*e+o.opts.cellHeightUnit},0===this._styles._max&&E.insertCSSRule(this._styles,i,"min-height: "+e(1,0)+";",0),t>this._styles._max)){for(var n=this._styles._max;n<t;++n)E.insertCSSRule(this._styles,i+'[data-gs-height="'+(n+1)+'"]',"height: "+e(n+1,n)+";",n),E.insertCSSRule(this._styles,i+'[data-gs-min-height="'+(n+1)+'"]',"min-height: "+e(n+1,n)+";",n),E.insertCSSRule(this._styles,i+'[data-gs-max-height="'+(n+1)+'"]',"max-height: "+e(n+1,n)+";",n),E.insertCSSRule(this._styles,i+'[data-gs-y="'+n+'"]',"top: "+e(n,n)+";",n);this._styles._max=t}}},W.prototype._updateContainerHeight=function(){var t,e;this.grid._updateCounter||(t=this.grid.getGridHeight(),0<(e=parseInt(this.container.css("min-height")))&&(t<(e=(e+this.opts.verticalMargin)/(this.cellHeight()+this.opts.verticalMargin))&&(t=e)),this.container.attr("data-gs-current-height",t),this.opts.cellHeight&&(this.opts.verticalMargin?this.opts.cellHeightUnit===this.opts.verticalMarginUnit?this.container.css("height",t*(this.opts.cellHeight+this.opts.verticalMargin)-this.opts.verticalMargin+this.opts.cellHeightUnit):this.container.css("height","calc("+(t*this.opts.cellHeight+this.opts.cellHeightUnit)+" + "+(t*(this.opts.verticalMargin-1)+this.opts.verticalMarginUnit)+")"):this.container.css("height",t*this.opts.cellHeight+this.opts.cellHeightUnit)))},W.prototype._isOneColumnMode=function(){return(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<=this.opts.minWidth},W.prototype._setupRemovingTimeout=function(t){var e=C(t).data("_gridstack_node");!e._removeTimeout&&this.opts.removable&&(e._removeTimeout=setTimeout(function(){t.addClass("grid-stack-item-removing"),e._isAboutToRemove=!0},this.opts.removeTimeout))},W.prototype._clearRemovingTimeout=function(t){var e=C(t).data("_gridstack_node");e._removeTimeout&&(clearTimeout(e._removeTimeout),e._removeTimeout=null,t.removeClass("grid-stack-item-removing"),e._isAboutToRemove=!1)},W.prototype._prepareElementsByNode=function(r,d){function t(t,e){var i,o,n=Math.round(e.position.left/h),s=Math.floor((e.position.top+l/2)/l);if("drag"!=t.type&&(i=Math.round(e.size.width/h),o=Math.round(e.size.height/l)),"drag"==t.type){var a=e.position.top-d._prevYPix;d._prevYPix=e.position.top,E.updateScrollPosition(r[0],e,a),r.data("inTrashZone")||n<0||n>=g.grid.width||s<0||!g.grid.float&&s>g.grid.getGridHeight()?d._temporaryRemoved||(!0===g.opts.removable&&g._setupRemovingTimeout(r),n=d._beforeDragX,s=d._beforeDragY,g.placeholder.detach(),g.placeholder.hide(),g.grid.removeNode(d),g._updateContainerHeight(),d._temporaryRemoved=!0):(g._clearRemovingTimeout(r),d._temporaryRemoved&&(g.grid.addNode(d),g.placeholder.attr("data-gs-x",n).attr("data-gs-y",s).attr("data-gs-width",i).attr("data-gs-height",o).show(),g.container.append(g.placeholder),d.el=g.placeholder,d._temporaryRemoved=!1))}else if("resize"==t.type&&n<0)return;e=void 0!==i?i:d.lastTriedWidth,a=void 0!==o?o:d.lastTriedHeight,!g.grid.canMoveNode(d,n,s,i,o)||d.lastTriedX===n&&d.lastTriedY===s&&d.lastTriedWidth===e&&d.lastTriedHeight===a||(d.lastTriedX=n,d.lastTriedY=s,d.lastTriedWidth=i,d.lastTriedHeight=o,g.grid.moveNode(d,n,s,i,o),g._updateContainerHeight())}function e(t,e){g.container.append(g.placeholder);var i=C(this),o=(g.grid.cleanNodes(),g.grid.beginUpdate(d),h=g.cellWidth(),Math.ceil(i.outerHeight()/i.attr("data-gs-height")));l=g.container.height()/parseInt(g.container.attr("data-gs-current-height")),g.placeholder.attr("data-gs-x",i.attr("data-gs-x")).attr("data-gs-y",i.attr("data-gs-y")).attr("data-gs-width",i.attr("data-gs-width")).attr("data-gs-height",i.attr("data-gs-height")).show(),d.el=g.placeholder,d._beforeDragX=d.x,d._beforeDragY=d.y,d._prevYPix=e.position.top,g.dd.resizable(r,"option","minWidth",h*(d.minWidth||1)),g.dd.resizable(r,"option","minHeight",o*(d.minHeight||1)),"resizestart"==t.type&&i.find(".grid-stack-item").trigger("resizestart")}function i(t,e){var i,o=C(this);o.data("_gridstack_node")&&(i=!1,g.placeholder.detach(),d.el=o,g.placeholder.hide(),d._isAboutToRemove?(i=!0,r.data("_gridstack_node")._grid._triggerRemoveEvent(),r.removeData("_gridstack_node"),r.remove()):(g._clearRemovingTimeout(r),d._temporaryRemoved?(E.removePositioningStyles(o),o.attr("data-gs-x",d._beforeDragX).attr("data-gs-y",d._beforeDragY).attr("data-gs-width",d.width).attr("data-gs-height",d.height),d.x=d._beforeDragX,d.y=d._beforeDragY,d._temporaryRemoved=!1,g.grid.addNode(d)):(E.removePositioningStyles(o),o.attr("data-gs-x",d.x).attr("data-gs-y",d.y).attr("data-gs-width",d.width).attr("data-gs-height",d.height))),g._updateContainerHeight(),g._triggerChangeEvent(i),g.grid.endUpdate(),(i=o.find(".grid-stack")).length&&"resizestop"==t.type&&(i.each(function(t,e){e=C(e).data("gridstack");e&&e.onResizeHandler&&e.onResizeHandler()}),o.find(".grid-stack-item").trigger("resizestop"),o.find(".grid-stack-item").trigger("gsresizestop")),"resizestop"==t.type&&g.container.trigger("gsresizestop",o))}var h,l,g=this;this.dd.draggable(r,{start:e,stop:i,drag:t}).resizable(r,{start:e,stop:i,resize:t}),(d.noMove||this._isOneColumnMode()&&!g.opts.disableOneColumnMode||this.opts.disableDrag||this.opts.staticGrid)&&this.dd.draggable(r,"disable"),(d.noResize||this._isOneColumnMode()&&!g.opts.disableOneColumnMode||this.opts.disableResize||this.opts.staticGrid)&&this.dd.resizable(r,"disable"),r.attr("data-gs-locked",d.locked?"yes":null)},W.prototype._prepareElement=function(t,e){e=void 0!==e&&e;(t=C(t)).addClass(this.opts.itemClass);e=this.grid.addNode({x:parseInt(t.attr("data-gs-x"),10),y:parseInt(t.attr("data-gs-y"),10),width:t.attr("data-gs-width"),height:t.attr("data-gs-height"),maxWidth:t.attr("data-gs-max-width"),minWidth:t.attr("data-gs-min-width"),maxHeight:t.attr("data-gs-max-height"),minHeight:t.attr("data-gs-min-height"),autoPosition:E.toBool(t.attr("data-gs-auto-position")),noResize:E.toBool(t.attr("data-gs-no-resize")),noMove:E.toBool(t.attr("data-gs-no-move")),locked:E.toBool(t.attr("data-gs-locked")),resizeHandles:t.attr("data-gs-resize-handles"),el:t,id:t.attr("data-gs-id"),_grid:this},e);t.data("_gridstack_node",e),this._prepareElementsByNode(t,e)},W.prototype.setAnimation=function(t){t?this.container.addClass("grid-stack-animate"):this.container.removeClass("grid-stack-animate")},W.prototype.addWidget=function(t,e,i,o,n,s,a,r,d,h,l){return t=C(t),void 0!==e&&t.attr("data-gs-x",e),void 0!==i&&t.attr("data-gs-y",i),void 0!==o&&t.attr("data-gs-width",o),void 0!==n&&t.attr("data-gs-height",n),void 0!==s&&t.attr("data-gs-auto-position",s?"yes":null),void 0!==a&&t.attr("data-gs-min-width",a),void 0!==r&&t.attr("data-gs-max-width",r),void 0!==d&&t.attr("data-gs-min-height",d),void 0!==h&&t.attr("data-gs-max-height",h),void 0!==l&&t.attr("data-gs-id",l),this.container.append(t),this._prepareElement(t,!0),this._triggerAddEvent(),this._updateContainerHeight(),this._triggerChangeEvent(!0),t},W.prototype.makeWidget=function(t){return t=C(t),this._prepareElement(t,!0),this._triggerAddEvent(),this._updateContainerHeight(),this._triggerChangeEvent(!0),t},W.prototype.willItFit=function(t,e,i,o,n){return this.grid.canBePlacedWithRespectToHeight({x:t,y:e,width:i,height:o,autoPosition:n})},W.prototype.removeWidget=function(t,e){e=void 0===e||e;var i=(i=(t=C(t)).data("_gridstack_node"))||this.grid.getNodeDataByDOMEl(t);this.grid.removeNode(i,e),t.removeData("_gridstack_node"),this._updateContainerHeight(),e&&t.remove(),this._triggerChangeEvent(!0),this._triggerRemoveEvent()},W.prototype.removeAll=function(e){k.each(this.grid.nodes,k.bind(function(t){this.removeWidget(t.el,e)},this)),this.grid.nodes=[],this._updateContainerHeight()},W.prototype.destroy=function(t){C(window).off("resize",this.onResizeHandler),this.disable(),void 0===t||t?this.container.remove():(this.removeAll(!1),this.container.removeData("gridstack")),E.removeStylesheet(this._stylesId),this.grid&&(this.grid=null)},W.prototype.resizable=function(t,o){var n=this;return(t=C(t)).each(function(t,e){var i=(e=C(e)).data("_gridstack_node");null!=i&&(i.noResize=!o,i.noResize||n._isOneColumnMode()&&!n.opts.disableOneColumnMode?n.dd.resizable(e,"disable"):n.dd.resizable(e,"enable"))}),this},W.prototype.movable=function(t,o){var n=this;return(t=C(t)).each(function(t,e){var i=(e=C(e)).data("_gridstack_node");null!=i&&(i.noMove=!o,i.noMove||n._isOneColumnMode()&&!n.opts.disableOneColumnMode?(n.dd.draggable(e,"disable"),e.removeClass("ui-draggable-handle")):(n.dd.draggable(e,"enable"),e.addClass("ui-draggable-handle")))}),this},W.prototype.enableMove=function(t,e){this.movable(this.container.children("."+this.opts.itemClass),t),e&&(this.opts.disableDrag=!t)},W.prototype.enableResize=function(t,e){this.resizable(this.container.children("."+this.opts.itemClass),t),e&&(this.opts.disableResize=!t)},W.prototype.disable=function(){this.movable(this.container.children("."+this.opts.itemClass),!1),this.resizable(this.container.children("."+this.opts.itemClass),!1),this.container.trigger("disable")},W.prototype.enable=function(){this.movable(this.container.children("."+this.opts.itemClass),!0),this.resizable(this.container.children("."+this.opts.itemClass),!0),this.container.trigger("enable")},W.prototype.locked=function(t,o){return(t=C(t)).each(function(t,e){var i=(e=C(e)).data("_gridstack_node");null!=i&&(i.locked=o||!1,e.attr("data-gs-locked",i.locked?"yes":null))}),this},W.prototype.maxHeight=function(t,o){return(t=C(t)).each(function(t,e){var i=(e=C(e)).data("_gridstack_node");null==i||isNaN(o)||(i.maxHeight=o||!1,e.attr("data-gs-max-height",o))}),this},W.prototype.minHeight=function(t,o){return(t=C(t)).each(function(t,e){var i=(e=C(e)).data("_gridstack_node");null==i||isNaN(o)||(i.minHeight=o||!1,e.attr("data-gs-min-height",o))}),this},W.prototype.maxWidth=function(t,o){return(t=C(t)).each(function(t,e){var i=(e=C(e)).data("_gridstack_node");null==i||isNaN(o)||(i.maxWidth=o||!1,e.attr("data-gs-max-width",o))}),this},W.prototype.minWidth=function(t,o){return(t=C(t)).each(function(t,e){var i=(e=C(e)).data("_gridstack_node");null==i||isNaN(o)||(i.minWidth=o||!1,e.attr("data-gs-min-width",o))}),this},W.prototype._updateElement=function(t,e){var i,o=(t=C(t).first()).data("_gridstack_node");null!=o&&((i=this).grid.cleanNodes(),i.grid.beginUpdate(o),e.call(this,t,o),i._updateContainerHeight(),i._triggerChangeEvent(),i.grid.endUpdate())},W.prototype.resize=function(t,i,o){this._updateElement(t,function(t,e){i=null!=i?i:e.width,o=null!=o?o:e.height,this.grid.moveNode(e,e.x,e.y,i,o)})},W.prototype.move=function(t,i,o){this._updateElement(t,function(t,e){i=null!=i?i:e.x,o=null!=o?o:e.y,this.grid.moveNode(e,i,o,e.width,e.height)})},W.prototype.update=function(t,i,o,n,s){this._updateElement(t,function(t,e){i=null!=i?i:e.x,o=null!=o?o:e.y,n=null!=n?n:e.width,s=null!=s?s:e.height,this.grid.moveNode(e,i,o,n,s)})},W.prototype.verticalMargin=function(t,e){if(void 0===t)return this.opts.verticalMargin;t=E.parseHeight(t);this.opts.verticalMarginUnit===t.unit&&this.opts.height===t.height||(this.opts.verticalMarginUnit=t.unit,this.opts.verticalMargin=t.height,e||this._updateStyles())},W.prototype.cellHeight=function(t,e){if(void 0===t){if(this.opts.cellHeight)return this.opts.cellHeight;var i=this.container.children("."+this.opts.itemClass).first();return Math.ceil(i.outerHeight()/i.attr("data-gs-height"))}i=E.parseHeight(t);this.opts.cellHeightUnit===i.unit&&this.opts.cellHeight===i.height||(this.opts.cellHeightUnit=i.unit,this.opts.cellHeight=i.height,e||this._updateStyles())},W.prototype.cellWidth=function(){return Math.round(this.container.outerWidth()/this.opts.width)},W.prototype.getCellFromPixel=function(t,e){var e=void 0!==e&&e?this.container.offset():this.container.position(),i=t.left-e.left,t=t.top-e.top,e=Math.floor(this.container.width()/this.opts.width),o=Math.floor(this.container.height()/parseInt(this.container.attr("data-gs-current-height")));return{x:Math.floor(i/e),y:Math.floor(t/o)}},W.prototype.batchUpdate=function(){this.grid.batchUpdate()},W.prototype.commit=function(){this.grid.commit(),this._updateContainerHeight()},W.prototype.isAreaEmpty=function(t,e,i,o){return this.grid.isAreaEmpty(t,e,i,o)},W.prototype.setStatic=function(t){this.opts.staticGrid=!0===t,this.enableMove(!t),this.enableResize(!t),this._setStaticClass()},W.prototype._setStaticClass=function(){var t="grid-stack-static";!0===this.opts.staticGrid?this.container.addClass(t):this.container.removeClass(t)},W.prototype._updateNodeWidths=function(t,e){this.grid._sortNodes(),this.grid.batchUpdate();for(var i,o=0;o<this.grid.nodes.length;o++)i=this.grid.nodes[o],this.update(i.el,Math.round(i.x*e/t),void 0,Math.round(i.width*e/t),void 0);this.grid.commit()},W.prototype.setGridWidth=function(t,e){this.container.removeClass("grid-stack-"+this.opts.width),!0!==e&&this._updateNodeWidths(this.opts.width,t),this.opts.width=t,this.grid.width=t,this.container.addClass("grid-stack-"+t)},H.prototype.batch_update=t(H.prototype.batchUpdate),H.prototype._fix_collisions=t(H.prototype._fixCollisions,"_fix_collisions","_fixCollisions"),H.prototype.is_area_empty=t(H.prototype.isAreaEmpty,"is_area_empty","isAreaEmpty"),H.prototype._sort_nodes=t(H.prototype._sortNodes,"_sort_nodes","_sortNodes"),H.prototype._pack_nodes=t(H.prototype._packNodes,"_pack_nodes","_packNodes"),H.prototype._prepare_node=t(H.prototype._prepareNode,"_prepare_node","_prepareNode"),H.prototype.clean_nodes=t(H.prototype.cleanNodes,"clean_nodes","cleanNodes"),H.prototype.get_dirty_nodes=t(H.prototype.getDirtyNodes,"get_dirty_nodes","getDirtyNodes"),H.prototype.add_node=t(H.prototype.addNode,"add_node","addNode, "),H.prototype.remove_node=t(H.prototype.removeNode,"remove_node","removeNode"),H.prototype.can_move_node=t(H.prototype.canMoveNode,"can_move_node","canMoveNode"),H.prototype.move_node=t(H.prototype.moveNode,"move_node","moveNode"),H.prototype.get_grid_height=t(H.prototype.getGridHeight,"get_grid_height","getGridHeight"),H.prototype.begin_update=t(H.prototype.beginUpdate,"begin_update","beginUpdate"),H.prototype.end_update=t(H.prototype.endUpdate,"end_update","endUpdate"),H.prototype.can_be_placed_with_respect_to_height=t(H.prototype.canBePlacedWithRespectToHeight,"can_be_placed_with_respect_to_height","canBePlacedWithRespectToHeight"),W.prototype._trigger_change_event=t(W.prototype._triggerChangeEvent,"_trigger_change_event","_triggerChangeEvent"),W.prototype._init_styles=t(W.prototype._initStyles,"_init_styles","_initStyles"),W.prototype._update_styles=t(W.prototype._updateStyles,"_update_styles","_updateStyles"),W.prototype._update_container_height=t(W.prototype._updateContainerHeight,"_update_container_height","_updateContainerHeight"),W.prototype._is_one_column_mode=t(W.prototype._isOneColumnMode,"_is_one_column_mode","_isOneColumnMode"),W.prototype._prepare_element=t(W.prototype._prepareElement,"_prepare_element","_prepareElement"),W.prototype.set_animation=t(W.prototype.setAnimation,"set_animation","setAnimation"),W.prototype.add_widget=t(W.prototype.addWidget,"add_widget","addWidget"),W.prototype.make_widget=t(W.prototype.makeWidget,"make_widget","makeWidget"),W.prototype.will_it_fit=t(W.prototype.willItFit,"will_it_fit","willItFit"),W.prototype.remove_widget=t(W.prototype.removeWidget,"remove_widget","removeWidget"),W.prototype.remove_all=t(W.prototype.removeAll,"remove_all","removeAll"),W.prototype.min_height=t(W.prototype.minHeight,"min_height","minHeight"),W.prototype.min_width=t(W.prototype.minWidth,"min_width","minWidth"),W.prototype._update_element=t(W.prototype._updateElement,"_update_element","_updateElement"),W.prototype.cell_height=t(W.prototype.cellHeight,"cell_height","cellHeight"),W.prototype.cell_width=t(W.prototype.cellWidth,"cell_width","cellWidth"),W.prototype.get_cell_from_pixel=t(W.prototype.getCellFromPixel,"get_cell_from_pixel","getCellFromPixel"),W.prototype.batch_update=t(W.prototype.batchUpdate,"batch_update","batchUpdate"),W.prototype.is_area_empty=t(W.prototype.isAreaEmpty,"is_area_empty","isAreaEmpty"),W.prototype.set_static=t(W.prototype.setStatic,"set_static","setStatic"),W.prototype._set_static_class=t(W.prototype._setStaticClass,"_set_static_class","_setStaticClass"),M.GridStackUI=W,M.GridStackUI.Utils=E,M.GridStackUI.Engine=H,M.GridStackUI.GridStackDragDropPlugin=N,C.fn.gridstack=function(e){return this.each(function(){var t=C(this);t.data("gridstack")||t.data("gridstack",new W(this,e))})},M.GridStackUI,R=jQuery,T=_,I=GridStackUI,window,I.GridStackDragDropPlugin.registerPlugin(A),((A.prototype=Object.create(I.GridStackDragDropPlugin.prototype)).constructor=A).prototype.resizable=function(t,e){var i,o;return t=R(t),"disable"===e||"enable"===e?t.resizable(e):"option"===e?(o=arguments[2],i=arguments[3],t.resizable(e,o,i)):(o=t.data("gs-resize-handles")?t.data("gs-resize-handles"):this.grid.opts.resizable.handles,t.resizable(T.extend({},this.grid.opts.resizable,{handles:o},{start:e.start||function(){},stop:e.stop||function(){},resize:e.resize||function(){}}))),this},A.prototype.draggable=function(t,e){return t=R(t),"disable"===e||"enable"===e?t.draggable(e):t.draggable(T.extend({},this.grid.opts.draggable,{containment:this.grid.opts.isNested?this.grid.container.parent():null,distance:7,start:e.start||function(){},stop:e.stop||function(){},drag:e.drag||function(){}})),this},A.prototype.droppable=function(t,e){return(t=R(t)).droppable(e),this},A.prototype.isDroppable=function(t,e){return t=R(t),Boolean(t.data("droppable"))},A.prototype.on=function(t,e,i){return R(t).on(e,i),this},GridStackUI.prototype._updateStyles=function(t){if(null!==this._styles&&void 0!==this._styles){var e,i="."+this.opts._class+" > ."+this.opts.itemClass,o=this;if(void 0===t&&(t=this._styles._max,this._initStyles(),this._updateContainerHeight()),this.opts.cellHeight){if(!(0!==this._styles._max&&t<=this._styles._max)&&(e=this.opts.verticalMargin&&this.opts.cellHeightUnit!==this.opts.verticalMarginUnit?function(t,e){return t&&e?"calc("+(o.opts.cellHeight*t+o.opts.cellHeightUnit)+" + "+(o.opts.verticalMargin*e+o.opts.verticalMarginUnit)+")":o.opts.cellHeight*t+o.opts.verticalMargin*e+o.opts.cellHeightUnit}:function(t,e){return o.opts.cellHeight*t+o.opts.verticalMargin*e+o.opts.cellHeightUnit},0===this._styles._max&&GridStackUI.Utils.insertCSSRule(this._styles,i,"min-height: "+e(1,0)+";",0),t>this._styles._max)){for(var n=this._styles._max;n<t;++n)GridStackUI.Utils.insertCSSRule(this._styles,i+'[data-gs-height="'+(n+1)+'"]',"height: "+e(n+1,n)+";",n),GridStackUI.Utils.insertCSSRule(this._styles,i+'[data-gs-min-height="'+(n+1)+'"]',"min-height: "+e(n+1,n)+";",n),GridStackUI.Utils.insertCSSRule(this._styles,i+'[data-gs-max-height="'+(n+1)+'"]',"max-height: "+e(n+1,n)+";",n),GridStackUI.Utils.insertCSSRule(this._styles,i+'[data-gs-y="'+n+'"]',"top: "+e(n,n)+";",n);this._styles._max=t}}else this._styles._max=t}},GridStackUI.Utils.getScrollParent=_.wrap(GridStackUI.Utils.getScrollParent,function(t,e){return e&&e.parentNode&&e.parentNode.className&&0<=e.parentNode.className.indexOf("fillHeightMode")?null:t(e)});var O=d.ComponentDropView.extend({KEY_RELATIVE_HEIGHT:"Basics.RelativeHeight",KEY_FLOATABLE:"Basics.Floatable",KEY_ADVANCED:"Basics.Advanced",KEY_USER_LAYOUT:"Basics.UserLayout",KEY_COLUMN_COUNT:"Basics.ColCount",KEY_ROW_COUNT:"Basics.RowCount",KEY_ROW_HEIGHT:"Basics.RowHeight",CSS_REPLACING:"replacing",$gridstack:null,$highlightItem:null,$highlightLayer:null,$noWidgetsInfo:null,$rowHighlightItem:null,$worksheet:null,$worksheetHighlightItem:null,api:null,columnCount:void 0,columnWidth:null,currentActionWidget:null,dashboardAppModel:null,dashboardViewModel:null,DEFAULT_ROW_COUNT_IN_FILL_HEIGHT_MODE:24,DEFAULT_ROW_HEIGHT_IN_NON_FILL_HEIGHT_MODE:25,DEFAULT_WIDGET_ROW_SPAN:12,dropdownValues:null,gridstack:null,gridstackMargin:0,ignoreWidgetSelect:null,isBasePanel:!1,selected:null,settingsModel:null,rowDrop:null,rowDropNo:null,usedRowHeight:null,widgetClass:"ui-widget",widgetEdge:12,widgets:null,constructor:function(t){e.View.prototype.constructor.apply(this,arguments)},events:null,initialize:function(t){this.options=t,this.api=t.api,this.isBasePanel=t.isBasePanel||!1,this.dashboardAppModel=t.dashboardAppModel,this.dashboardViewModel=t.dashboardViewModel,this.documentModel=t.documentModel,this.dataModel=t.dataModel,this.DeltaClientLib=t.DeltaClientLib,this.documentViewModel=t.viewModel,this.model=this.model||t.componentModel,this.model instanceof d.Component&&(this.model.panelView=this),this.quickView=t.quickView,this.settingsModel=t.settingsModel,this.websiteUrl=t.websiteUrl,this.userWidgets=new d.WidgetCollection([],{},this.model),this.viewModel=new e.DeepModel,this.widgets=[],this.throttledUpdateHighlightItem=_.throttle(this.updateHighlightItem,41),this.debouncedRenderConfigureWidgetsMenu=_.debounce(this.renderConfigureWidgetsMenu,100),this.render(),this.isBasePanel&&(_.extend(this,D),this.initializeBasePanel(),this.triggerDragEvent=this.triggerDragEvent.bind(this),$(window).on("dragover",this.triggerDragEvent),this.onPanelDragEvent_throttled=_.throttle(this.onPanelDragEvent,200),this.listenTo(this.dashboardViewModel,"onPanelDragEvent",this.onPanelDragEvent_throttled))},initializeEvents:function(){d.ComponentDropView.prototype.initializeEvents.apply(this,arguments),this.listenTo(this.viewModel,"change:"+this.KEY_RELATIVE_HEIGHT,this.onChange_RelativeHeight),this.listenTo(this.viewModel,"change:"+this.KEY_FLOATABLE,this.onChange_Floatable),this.listenTo(this.viewModel,"change:"+this.KEY_COLUMN_COUNT,this.onChange_ColumnCount),this.listenTo(this.viewModel,"change:"+this.KEY_ROW_COUNT,this.onChange_RowCount),this.listenTo(this.viewModel,"change:"+this.KEY_ROW_HEIGHT,this.onChange_RowHeight),this.listenTo(this.viewModel,"change:"+this.KEY_ADVANCED,this.onPropAdvanced),this.$worksheet.on("click",$.proxy(this.onWorksheetClick,this)),this.$showConfigureWidgetsMenu.on("click",$.proxy(this.onShowConfigureWidgetsMenu,this)),this.$configureWidgetsMenu.on("click",$.proxy(this.onConfigureWidgetsMenuClick,this)),this.listenTo(this.userWidgets,"add remove reset",this.debouncedRenderConfigureWidgetsMenu),this.listenTo(this.userWidgets,"reset",this.onUserLayoutReset),this.$worksheet.on("dragenter",this.getSafeDragNDropHandler(this.onWorksheetDragEnter)),this.$worksheet.on("dragover",this.getSafeDragNDropHandler(this.onWorksheetDragOver)),this.$worksheet.on("dragleave",this.getSafeDragNDropHandler(this.onWorksheetDragLeave)),this.$worksheet.on("drop",this.getSafeDragNDropHandler(this.onWorksheetDrop)),this.listenTo(this.dashboardViewModel,"change:selectedWidget",this.changeOverlayVisibilty),this.listenTo(this.dashboardViewModel,"change:buildMode",this.changeOverlayVisibilty)},initializeEvents_widgetCollection:function(){this.listenTo(this.widgetsCollection,"remove",function(t,e,i){t=_.find(this.widgets,{model:t});this.selected&&this.selected===t&&this.deselectCurrentWidget(),this.removeWidget(t)}),this.listenTo(this.widgetsCollection,"add",function(t,e){this.ignoreGridstackEvents=!0,this.addWidget(t,!1,null),this.ignoreGridstackEvents=!1})},initializePost:function(){var t;this.hasInitPost||(this.hasInitPost=!0,this.initializeEvents(),this.isBasePanel&&this.set_gridstackMargin(),this.modifyFillHeightModeCssClass(),this.set_columnCount(),this.recalculateColumnWidth(),this.isUserEditMode()?(this.populateUserWidgetsCollection(),this.widgetsCollection=this.userWidgets,this.dashboardViewModel.set("userConfigurable",!0)):this.widgetsCollection=this.model.get("widgets"),this.initializeEvents_widgetCollection(),this.upgradeGridsterLayout(),(t=this.getMaxRowCount())>(this.viewModel.get(this.KEY_ROW_COUNT)||0)&&(this.viewModel.get(this.KEY_RELATIVE_HEIGHT)?this.api.setProperty(this.KEY_ROW_COUNT,t):this.viewModel.set(this.KEY_ROW_COUNT,t,{silent:!0})),this.set_rowCount(),this.recalculateUsedRowHeight(),this.viewModel.get(this.KEY_ADVANCED)||this.initGridStack(),this.populatePanelWithWidgets(),this.switchBuildMode(this.dashboardViewModel.get("buildMode")),this.changeOverlayVisibilty(),this.isInitialized=!0)},addWidget:function(t){return this.$noWidgetsInfo.hide(),d.ComponentDropView.prototype.addWidget.apply(this,arguments)},addNewWidget:function(t,e,i,o,n,s,a){var r;return n||(n=new d.Widget({},{},this.widgetsCollection),r={},_.isNumber(t)&&(r.row=t),_.isNumber(e)&&(r.column=e),_.isNumber(i)&&(r.rowSpan=i),_.isNumber(o)&&(r.colSpan=o),_.isEmpty(r)||(t=n.get("layout"),_.extend(t.attributes,r),_.extend(t._previousAttributes,r))),s&&!a&&this.addComponentToWidget(n,s,!1),this.isUserEditMode()?this.widgetsCollection.add(n):this.widgetsCollection.commandAdd(n,a?"Paste":null),_.findLast(this.widgets,{widgetId:n.id})},addWidgetEvents:function(t){var e,i=this;if(!(t instanceof $))throw"Wrong parameter.";_.each(t,function(t){(e=$(t)).on("click",$.proxy(i.onWidgetClick,i)),e.on("dragenter",i.getSafeDragNDropHandler(i.onComponentDragEnter)),e.on("dragleave",i.getSafeDragNDropHandler(i.onComponentDragLeave)),e.on("dragover",i.getSafeDragNDropHandler(i.onComponentDragOver)),e.on("drop",i.getSafeDragNDropHandler(i.onComponentDrop)),e.on("mousedown",$.proxy(i.onWidgetMouseDown,i))})},applyGridStackMargin:function(){var t={margin:this.gridstackMargin};this.$gridstack.css(t),this.$rowHighlightItem.css(t),this.$worksheetHighlightItem.css("margin-left",this.gridstackMargin),this.recalculateUsedRowHeight()},changeLayout:function(t){var e=this,i=this.dashboardAppModel.get("copiedWidgetSize")||[300,200];if(this.viewModel.get(this.KEY_ADVANCED)){t.get("layout").set({row:this.getMaxRowCount(),column:0,rowSpan:1,colSpan:this.columnCount});var o=t.get("component").get("options").get("Style"),n=o.advanced||"";_.every([".advanced-item","width","height"],function(t){return n.indexOf(t)<0})&&(o.advanced=(n?n+"\n\n":"")+'.advanced-item[data-widgetid="'+t.get("id")+'"] { width: '+Math.min(i[0],this.columnCount*this.columnWidth)+"px; height: "+i[1]+"px; }\n\n")}else if(this.viewModel.get(this.KEY_RELATIVE_HEIGHT)){for(var s,a,r,i=this.dashboardAppModel.get("copiedWidgetSize")||[300,200],d=Math.max(1,Math.min(this.columnCount,Math.round(i[0]/this.columnWidth))),h=Math.max(1,Math.min(this.rowCount,Math.round(i[1]/this.usedRowHeight))),l=!1,g=0,c=0,u=_.map(Array(this.rowCount),function(){return _.fill(Array(e.columnCount),1)}),p=(this.widgetsCollection.each(function(t){for(var e,t=t.get("layout"),i=t.get("row"),o=t.get("column"),n=i+t.get("rowSpan"),s=o+t.get("colSpan");i<n;i++)for(e=o;e<s;e++)u[i][e]=0}),function(t,e){for(var i,o,n=1,s=0,a=e;u[t][a]&&a<e+d&&a<this.columnCount;a++,s++);if(c<=s){for(g=c<s?0:g,c=s,o=_.range(e,a),i=t+1;i<t+h&&i<this.rowCount;i++){if(!_.every(o,function(t){return u[i][t]}))break;n++}if(g<n)return[t,e,g=n,s]}}.bind(this)),m=0;!l&&m<this.rowCount;m++)for(s=0;!l&&s<this.columnCount;s++)u[m][s]&&(a=p(m,s))&&(l=(r=a)[2]===h&&r[3]===d);if(!r)return!1;t.get("layout").set({row:r[0],column:r[1],rowSpan:r[2],colSpan:r[3]})}else t.get("layout").set({row:this.getMaxRowCount(),column:0,rowSpan:Math.max(1,Math.round(i[1]/this.usedRowHeight)),colSpan:Math.max(1,Math.min(this.columnCount,Math.round(i[0]/this.columnWidth)))});return!0},changeOverlayVisibilty:function(){var t;!!this.dashboardViewModel.get("buildMode")?null==(t=this.dashboardViewModel.get("selectedWidget"))?this.isBasePanel?this.$gridOverlay.show():this.$gridOverlay.hide():t.get("id")===this.options.widgetId?this.$gridOverlay.show():this.$gridOverlay.hide():this.$gridOverlay.hide()},clearPanel_initGridstack:function(){this.clearWidgets(),this.removeGridstack(),this.viewModel.get(this.KEY_ADVANCED)||this.initGridStack()},clearWidgets:function(){_.includes(this.model.get("widgets").map("id"),this.dashboardViewModel.get("selectedWidgetId"))&&this.deselectCurrentWidget(),0<this.widgets.length&&(_.each(this.widgets,function(t){t.view&&_.isFunction(t.view.remove)&&t.view.remove()}),this.widgets=[],this.gridstack?(this.ignoreGridstackEvents=!0,this.gridstack.removeAll(),this.ignoreGridstackEvents=!1):this.$gridstack&&this.$gridstack.children(":not(.grid-stack-overlay)").remove())},createUserWidget:function(t,e){var i=new d.Widget({id:t.id});return e=e||t.get("layout").attributes,i.get("layout").set(e),i.set("component",t.get("component")),i},deselectCurrentWidget:function(){this.dashboardViewModel.set("selectedWidget",null),this.dashboardViewModel.set("selectedWidgetView",null,{silent:!0})},disableWidgetSelect:function(){this.ignoreWidgetSelect=!0;var t=this.currentActionWidget&&this.currentActionWidget.$widget?this.currentActionWidget.$widget.find(".errorPanel"):null;t&&t.css("pointer-events","none")},enableWidgetSelect:function(){this.userCan("select")&&(this.ignoreWidgetSelect=!1);var t=this.currentActionWidget&&this.currentActionWidget.$widget?this.currentActionWidget.$widget.find(".errorPanel"):null;t&&t.css("pointer-events","")},findWidgetItem:function(t){return _.find(this.widgets,{widgetId:t})},isUserEditMode:function(){return this.viewModel.get(this.KEY_USER_LAYOUT)&&this.quickView},generateUserLayout:function(t){var e={};return t.each(function(t){e[t.id]=t.get("layout").attributes}),e},getMaxRowCount:function(){var t=this.widgetsCollection.models;return _.max(t.map(function(t){t=t.get("layout");return t.get("row")+t.get("rowSpan")}))||0},getNewWidgetLayout:function(t){var t=t.get("layout"),e=t.get("row"),i=t.get("column"),o=t.get("rowSpan"),t=t.get("colSpan");(_.isNaN(e)||_.isNaN(i))&&(i=null),o&&t||(this.DEFAULT_WIDGET_ROW_SPAN,Math.ceil(this.columnCount/2))},highlightItemToBeReplaced:function(t){t.hasClass(this.CSS_REPLACING)||_.includes(["Accordion","FlexPanel","Panel","Tabs"],t.data("componentid"))||t.addClass(this.CSS_REPLACING)},initGridStack:function(){O.gsStyleManager.add(this.columnCount),this.applyGridStackMargin(),this.setupMinHeight(),this.modifyFillHeightModeCssClass(),this.gridstack=this.$gridstack.gridstack({animate:!1,cellHeight:this.usedRowHeight,height:this.viewModel.get(this.KEY_RELATIVE_HEIGHT)?this.rowCount:0,float:this.viewModel.get(this.KEY_FLOATABLE),width:this.columnCount,verticalMargin:0,resizable:{autoHide:!1,handles:"ne,nw,se,sw,s,e,w"}}).data("gridstack"),this.setupGetGridHeight(),this.$gridstack.addClass("grid-stack-"+this.columnCount),this.updateOverlaySize(),this.$gridstack.data("dragdata",{}),this.$gridstack.on("resizestart",$.proxy(this.onWidgetResizeStart,this)),this.$gridstack.on("resize",$.proxy(this.onWidgetResize,this)),this.$gridstack.on("resizestop",$.proxy(this.onWidgetResizeStop,this)),this.$gridstack.on("gsresizestop",$.proxy(this.onWidgetGSResizeStop,this)),this.$gridstack.on("dragstart",$.proxy(this.onWidgetDraggingStart,this)),this.$gridstack.on("dragstop",$.proxy(this.onWidgetDraggingStop,this)),this.$gridstack.on("change",$.proxy(this.onGridstackChange,this)),this.$gridstack.on("dragenter",this.getSafeDragNDropHandler(this.onGridstackDragEnter)),this.$gridstack.on("dragleave",this.getSafeDragNDropHandler(this.onGridstackDragLeave)),this.$gridstack.on("dragover",this.getSafeDragNDropHandler(this.onGridstackDragOver)),this.$gridstack.on("drop",this.getSafeDragNDropHandler(this.onGridstackDrop)),this.dashboardViewModel.get("buildMode")||this.switchBuildMode(this.dashboardViewModel.get("buildMode"))},initSortable:function(){var n=this;this.$gridstack.sortable({stop:function(){var t=$(this).children();_.each(t,function(e,t){var i=_.find(n.widgets,function(t){return t.$widget[0]===e}),o=$(e);i&&(i.model.get("layout").set("row",t*n.DEFAULT_WIDGET_ROW_SPAN),i.model.get("layout").set("rowSpan",n.DEFAULT_WIDGET_ROW_SPAN)),o.attr("data-gs-y",t*n.DEFAULT_WIDGET_ROW_SPAN),o.attr("data-gs-height",n.DEFAULT_WIDGET_ROW_SPAN)})}}),this.$gridstack.disableSelection()},modifyFillHeightModeCssClass:function(){this.$gridstack.removeClass("fillHeightMode"),this.viewModel.get(this.KEY_RELATIVE_HEIGHT)&&this.$gridstack.addClass("fillHeightMode")},onChange_ColumnCount:function(){this.$gridstack.removeClass("grid-stack-"+this.columnCount),O.gsStyleManager.remove(this.columnCount),this.set_columnCount(),this.recalculateColumnWidth(),O.gsStyleManager.add(this.columnCount),this.$gridstack.addClass("grid-stack-"+this.columnCount),this.gridstack&&this.gridstack.setGridWidth(this.columnCount,!0),this.updateOverlaySize()},onChange_Floatable:function(){this.gridstack&&(this.gridstack.grid.float=this.gridstack.grid._float=this.viewModel.get(this.KEY_FLOATABLE),this.gridstack.batchUpdate(),this.gridstack.commit())},onChange_RelativeHeight:function(){this.viewModel.get(this.KEY_RELATIVE_HEIGHT)?this.$worksheetHighlightItem.hide():this.$worksheetHighlightItem.show(),this.isBasePanel&&this.updatePropertyInspectorForBasePanel(),this.modifyFillHeightModeCssClass(),this.recalculateUsedRowHeight(),this.setupGetGridHeight(),this.setupMinHeight(),this.onResize(!0)},onChange_RowCount:function(){this.set_rowCount(),this.setupGetGridHeight(),this.recalculateUsedRowHeight(),this.updateOverlaySize(),!this.viewModel.get(this.KEY_ADVANCED)&&this.viewModel.get(this.KEY_RELATIVE_HEIGHT)&&this.onResize(!0)},onChange_RowHeight:function(){this.viewModel.get(this.KEY_ADVANCED)||(this.recalculateUsedRowHeight(),this.viewModel.get(this.KEY_RELATIVE_HEIGHT)||(this.gridstack.cellHeight(this.usedRowHeight),this.updateOverlaySize(),this.onResize(!0)))},onComponentDragOver:function(t){var e,i,o,n;return this.triggerDragEvent(t),!!this.userCan("addNew")&&(n=$(t.target).closest(".grid-stack-item"),this.viewModel.get(this.KEY_RELATIVE_HEIGHT)?this.highlightItemToBeReplaced(n):(i=n.offset(),e=t.originalEvent.pageY-i.top,t=t.originalEvent.pageX-i.left,i=n.outerHeight(),e<=this.widgetEdge?(this.rowDropNo=_.parseInt(n.attr("data-gs-y")),o=0===this.rowDropNo?0:n.position().top-this.widgetEdge/2+1,this.onComponentDragOver_moveHighlightItem(n,o,t)):i-e<=this.widgetEdge?(o=n.position().top+i-this.widgetEdge+this.widgetEdge/2-1,this.rowDropNo=_.parseInt(n.attr("data-gs-y"))+_.parseInt(n.attr("data-gs-height")),this.onComponentDragOver_moveHighlightItem(n,o,t)):(this.rowDrop&&(this.rowDrop=!1,this.$rowHighlightItem.hide()),this.highlightItemToBeReplaced(n))),!1)},onComponentDragOver_moveHighlightItem:function(t,e,i){this.rowDrop=!0,t.removeClass(this.CSS_REPLACING);t=_.parseInt(t.attr("data-gs-x"))*this.columnWidth,t=this.gridstackMargin+t+Math.max(0,Math.floor(i/this.columnWidth)*this.columnWidth),i=Math.min(Math.round(this.recommendedWidth/this.columnWidth)*this.columnWidth,this.columnCount*this.columnWidth-t+this.gridstackMargin);this.colDrop=Math.round((t-this.gridstackMargin)/this.columnWidth),this.colSpanDrop=Math.round(i/this.columnWidth),this.rowSpanDrop=Math.round(this.recommendedHeight/this.usedRowHeight),this.$rowHighlightItem.css({top:e,"margin-left":t,width:i,display:"block"})},onComponentDragEnter:function(t){this.triggerDragEvent(t),this.setVisibility_overlayOnly(!0)},onComponentDragLeave:function(t){this.triggerDragEvent(t),$(t.target).closest(".grid-stack-item").removeClass(this.CSS_REPLACING),this.rowDrop&&(this.rowDrop=!1,this.$rowHighlightItem.hide()),this.isDropping||this.setVisibility_overlayOnly(!1)},onComponentDrop:function(t){var e,i,o,n=null;return void 0!==t.originalEvent.dataTransfer&&(e=t.originalEvent.dataTransfer.getData("text"),i=this.dashboardAppModel.get("components").get(e),this.userCan("addNew")&&(i?(this.rowDrop?(this.rowDrop=!1,n=this.rowDropNo,this.$rowHighlightItem.hide()):(i=$(t.currentTarget).attr("data-widgetid"),o=this.findWidgetItem(i),this.dashboardViewModel.set("selectedWidget",null)),this.onComponentDragLeave(t),o?this.addComponentToWidget(o.model,e,!0):this.addNewWidget(n,this.colDrop,this.rowSpanDrop,this.colSpanDrop,null,e,!1)):(this.$highlightItem.hide(),this.rowDrop=!1,this.$rowHighlightItem.hide())),!1)},onComponentDropWrap:function(t,e,i,o,n){t=t.originalEvent.dataTransfer.getData("text");this.dashboardAppModel.get("components").has(t)&&this.addNewWidget(e,i,o,n,null,t,!1)},onConfigureWidgetsMenuClick:function(t){var e=$(t.target).data("actionid"),t=$(t.target).data("widgetid");t?(t=this.model.get("widgets").get(t))&&(t=this.createUserWidget(t),this.userWidgets.add(t)):e&&"reset"===e&&this.userWidgets.reset(),this.$configureWidgets.removeClass("showing-menu")},onGridstackChange:function(t){t.currentTarget===t.target&&this.updateWidgetsLayout()},onGridstackDragEnter:function(t){this.setDraggedWidgetRecommendedSize(),this.triggerDragEvent(t),this.setVisibility_overlayOnly(!0)},onGridstackDragLeave:function(t){this.triggerDragEvent(t),this.isDropping&&(this.isDropping=!1,this.dashboardAppModel.get("smartDrop")&&this.$highlightItem.hide(),this.rowDrop=!1,this.$rowHighlightItem.hide()),this.setVisibility_overlayOnly(!1)},onGridstackDragOver:function(t,e){return this.triggerDragEvent(t),this.prevX=t.originalEvent.layerX,this.prevY=t.originalEvent.layerY,this.isDropping?this.dashboardAppModel.get("smartDrop")&&this.throttledUpdateHighlightItem(this.prevX,this.prevY):(this.isDropping=!0,this.dashboardAppModel.get("smartDrop")&&this.updateHighlightLayer(t),this.dashboardAppModel.get("smartDrop")&&(this.throttledUpdateHighlightItem(this.prevX,this.prevY),this.$highlightItem.show())),this.rowDrop&&(this.rowDrop=!1,this.$rowHighlightItem.hide()),this.setVisibility_overlayOnly(!0),!1},onGridstackDrop:function(t){var e,i,o,n;return this.deselectCurrentWidget(),i=parseInt(this.$highlightItem.css("left"),10),e=parseInt(this.$highlightItem.css("top"),10),n=parseInt(this.$highlightItem.css("width"),10),o=parseInt(this.$highlightItem.css("height"),10),this.onGridstackDragLeave(),e=Math.round(e/this.gridstack.cellHeight()),i=Math.round(i/this.columnWidth),o=Math.round(o/this.gridstack.cellHeight()),n=Math.round(n/this.columnWidth),this.onComponentDropWrap(t,e,i,o,n),!1},onMaterialChange:function(){this.documentViewModel.trigger("materialChange")},onPanelDragEvent:function(t){t&&this.dashboardViewModel.get("buildMode")&&(t=$(t.target),_.includes(["Accordion","FlexPanel","Panel","Tabs"],t.closest(".grid-stack-item").data("componentid"))?this.$gridOverlay.hide():(t=t.closest(".worksheet")).length?t.get(0)===this.$worksheet.get(0)?this.$gridOverlay.show():this.$gridOverlay.hide():this.changeOverlayVisibilty())},onPropAdvanced:function(){this.clearPanel_initGridstack(),this.populatePanelWithWidgets()},onRemoveWidget:function(t){this.isUserEditMode()?this.widgetsCollection.remove(t):this.widgetsCollection.commandRemove(t)},onResize:function(t){!this.viewModel.get(this.KEY_ADVANCED)&&this.gridstack?(this.viewModel.get(this.KEY_RELATIVE_HEIGHT)&&(t=!0,this.setupMinHeight()),t&&(this.gridstack.setAnimation(!1),this.gridstack.batchUpdate(),this.recalculateUsedRowHeight(),this.recalculateColumnWidth(),this.gridstack.cellHeight(this.usedRowHeight),this.updateOverlaySize(),this.gridstack.commit(),this.onResizeWidgets(),this.gridstack.container.outerHeight(),this.gridstack.setAnimation(!0))):this.onResizeWidgets()},onResizeWidgets:function(){_.each(this.widgets,function(t){t.view&&(_.isFunction(t.view.onResize)&&t.view.onResize(!0),_.isFunction(t.view.onResizeStop)&&t.view.onResizeStop(!0))})},onSettingsChange:function(t){var i=this;_.each(t,function(t,e){i.viewModel.set(e,t)}),this.initializePost()},onShowConfigureWidgetsMenu:function(){this.$configureWidgets.toggleClass("showing-menu"),this.$configureWidgets.hasClass("showing-menu")&&this.$configureWidgetsMenu.position({of:this.$showConfigureWidgetsMenu,my:"right top",at:"right bottom"})},onUserLayoutReset:function(){this.api.saveSetting("layout",""),this.populateUserWidgetsCollection(),this.clearPanel_initGridstack(),this.populatePanelWithWidgets()},onWidgetDraggingStart:function(t,e){e&&e.helper&&e.helper.parent().get(0)===this.$gridstack.get(0)&&(this.setVisibility_overlay_outline(!0),this.disableWidgetSelect())},onWidgetDraggingStop:function(t,e){e&&e.helper&&e.helper.parent().get(0)===this.$gridstack.get(0)&&(this.setVisibility_overlay_outline(!1),this.enableWidgetSelect())},onWidgetMouseDown:function(t){t=$(t.currentTarget).attr("data-widgetid");t&&(this.currentActionWidget=this.findWidgetItem(t))},onWidgetGSResizeStop:function(t,e){this.gridstack.setAnimation(!1);var i=$(e).attr("data-gs-width")*this.gridstack.cellWidth(),e=$(e).attr("data-gs-height")*this.gridstack.cellHeight();this.currentActionWidget&&this.currentActionWidget.view&&this.currentActionWidget.view.onResize&&(this.currentActionWidget.view.onResize(),this.currentActionWidget.view.onResizeStop&&this.currentActionWidget.view.onResizeStop(i,e),this.currentActionWidget=null),this.gridstack.setAnimation(!0)},onWidgetResize:function(t,e){},onWidgetResizeStart:function(t,e){e&&e.element&&e.element.parent().get(0)===this.$gridstack.get(0)&&(this.gridstack.setAnimation(!1),this.setVisibility_overlay_outline(!0),this.disableWidgetSelect(),this.currentActionWidget&&this.currentActionWidget.view&&this.currentActionWidget.view.onResize&&(this.currentActionWidget.view.onResizeStart&&this.currentActionWidget.view.onResizeStart(),this.currentActionWidget.view.onResize()))},onWidgetResizeStop:function(t,e){e&&e.element&&e.element.parent().get(0)===this.$gridstack.get(0)&&(this.gridstack.setAnimation(!0),this.setVisibility_overlay_outline(!1),this.dashboardViewModel.get("buildMode")&&this.enableWidgetSelect())},onWorksheetClick:function(t){this.isBasePanel&&this.dashboardViewModel.get("buildMode")&&this.deselectCurrentWidget()},onWorksheetDragEnter:function(t){this.setDraggedWidgetRecommendedSize(),this.triggerDragEvent(t),this.setVisibility_overlayOnly(!0)},onWorksheetDragLeave:function(t){this.triggerDragEvent(t),this.isDraggingOverWorksheet&&(this.isDraggingOverWorksheet=!1,this.$worksheetHighlightItem.removeClass("now-over")),this.rowDrop=!1,this.$rowHighlightItem.hide(),this.isDropping||this.setVisibility_overlayOnly(!1)},onWorksheetDragOver:function(t){return this.triggerDragEvent(t),this.userCan("addNew")&&(this.viewModel.get(this.KEY_RELATIVE_HEIGHT)?this.isDraggingOverWorksheet||(this.isDraggingOverWorksheet=!0,this.$worksheetHighlightItem.css({"margin-left":this.gridstackMargin,display:"none"}).addClass("now-over")):(this.isDraggingOverWorksheet=!0,t=t.originalEvent.layerX,e=this.gridstackMargin,i=this.usedRowHeight,o=this.columnWidth*this.columnCount,e+=t=Math.max(0,Math.floor((t-e)/this.columnWidth)*this.columnWidth),i=Math.round(this.recommendedHeight/this.usedRowHeight)*this.usedRowHeight,o=Math.min(Math.round(this.recommendedWidth/this.columnWidth)*this.columnWidth,this.columnWidth*this.columnCount-t),this.$worksheetHighlightItem.css({"margin-left":e,display:"block",width:o,height:i}).addClass("now-over")),this.rowDrop&&(this.rowDrop=!1,this.$rowHighlightItem.hide())),!1;var e,i,o},onWorksheetDrop:function(t){if(this.deselectCurrentWidget(),this.isDraggingOverWorksheet){if(this.isDraggingOverWorksheet=!1,this.$worksheetHighlightItem.removeClass("now-over"),this.$worksheetHighlightItem.hide(),this.gridstack&&this.viewModel.get(this.KEY_RELATIVE_HEIGHT))return!1;var e=this.getMaxRowCount(),i=_.parseInt(this.$worksheetHighlightItem.css("margin-left"))-this.gridstackMargin,i=Math.round(i/this.columnWidth),o=_.parseInt(this.$worksheetHighlightItem.css("height")),o=Math.round(o/this.usedRowHeight)||this.DEFAULT_WIDGET_ROW_SPAN,n=_.parseInt(this.$worksheetHighlightItem.css("width")),n=Math.round(n/this.columnWidth)||Math.ceil(this.columnCount/2);this.onComponentDropWrap(t,e,i,o,n)}return!1},pasteWidget:function(t){var e,i=t.clone(),t=i.get("component").get("definitionId"),o=this.dashboardViewModel.get("selectedWidgetView");if(o)switch(o.model instanceof d.Popup?"Popup":o.model.get("key")){case"Accordion":o.app.pasteWidget(i);break;case"Tabs":var n=i.get("component");n.set("id",i.get("id")),o.app.componentModel.get("components").add(n),i.get("component").setParent(o.app.componentModel.get("components"));break;case"Popup":o.pasteWidget(i);break;case"FlexPanel":o.app.pasteWidget(i);break;case"Panel":e=o.app;break;default:for(var s,a=o.model;!s&&(a=a.parent);)s=a.panelView;e=s||this}else e=this;e&&(e.changeLayout(i)?(e.addNewWidget(null,null,null,null,i,t,!0),i.setParent(e.widgetsCollection)):d.ErrorDialog.ShowError("No space available!"))},populatePanelWithWidgets:function(){var t=this.widgetsCollection.sortBy(function(t){t=t.get("layout");return 1e3*t.get("row")+t.get("column")});this.gridstack&&this.gridstack.batchUpdate(),this.ignoreGridstackEvents=!0,_.each(t,function(t){this.addWidget(t,!0,null)}.bind(this)),this.ignoreGridstackEvents=!1,this.gridstack&&(this.gridstack.commit(),_.defer(function(){this.gridstack&&this.gridstack.setAnimation(!0)}))},populateUserWidgetsCollection:function(){var i=this,e=this.api.loadSetting("layout");try{e=JSON.parse(e)}catch(t){e=null}e=e?_.pick(e,i.model.get("widgets").map(function(t){return t.id})):this.generateUserLayout(this.model.get("widgets")),_.isEmpty(e)?this.debouncedRenderConfigureWidgetsMenu():_.each(e,function(t,e){var e=i.model.get("widgets").get(e);e&&(e=i.createUserWidget(e,{row:t.row,column:t.column,rowSpan:t.rowSpan,colSpan:t.colSpan}),i.userWidgets.add(e))})},recalculateUsedRowHeight:function(){this.viewModel.get(this.KEY_ADVANCED)?this.usedRowHeight=null:this.viewModel.get(this.KEY_RELATIVE_HEIGHT)?this.usedRowHeight=(this.$worksheet.height()-2*this.gridstackMargin)/this.rowCount:this.usedRowHeight=this.viewModel.get(this.KEY_ROW_HEIGHT)},recalculateColumnWidth:function(){this.columnWidth=(this.$worksheet.width()-2*this.gridstackMargin)/this.columnCount},recreateGridStackPanel:function(){this.$gridstack=$(document.createElement("div")),this.$gridstack.addClass("grid-stack"),this.$gridOverlay=$(document.createElement("div")).addClass("grid-stack-overlay").appendTo(this.$gridstack).hide(),this.changeOverlayVisibilty(),this.$gridstack.prependTo(this.$worksheet)},remove:function(){this.stopListening(),this.$worksheet.off(),this.$showConfigureWidgetsMenu.off(),this.$configureWidgetsMenu.off(),this.$gridstack.off(),this.clearWidgets(),this.removeGridstack(!0),this.isBasePanel&&(this.onPanelDragEvent_throttled.cancel(),$(window).off("dragover",this.triggerDragEvent)),e.View.prototype.remove.apply(this)},removeGridstack:function(t){this.gridstack&&(this.gridstack.destroy(),this.gridstack=null,this.$gridstack.remove(),O.gsStyleManager.remove(this.columnCount),t||this.recreateGridStackPanel())},removeWidget:function(t){t&&(_.pull(this.widgets,t),this.userCan("addNew")&&this.widgets.length<=0&&this.$noWidgetsInfo.show(),t.$widget.css({border:"none",background:"none","box-shadow":"none","pointer-events":"none"}),t.view&&t.view.remove&&t.view.remove(),t.$widget.off(),this.gridstack?(this.ignoreGridstackEvents=!0,this.gridstack.removeWidget(t.$widget),this.ignoreGridstackEvents=!1):t.$widget.remove())},render:function(){return this.$el.addClass("panel"),this.$el.html(i.app()),this.$worksheet=this.$el.find("> .worksheet"),this.$gridstack=this.$worksheet.find("> .grid-stack"),this.$worksheetHighlightItem=this.$worksheet.find("> .worksheet-highlight-item"),this.$rowHighlightItem=this.$worksheet.find("> .row-highlight-item"),this.$gridOverlay=this.$gridstack.find("> .grid-stack-overlay").hide(),this.$highlightLayer=this.$worksheet.find("> .highlight-viewport > .highlight-layer"),this.$highlightItem=this.$highlightLayer.find("> .highlight-item"),this.$configureWidgets=this.$el.find("> .configure-widgets"),this.$configureWidgetsMenu=this.$configureWidgets.find("> .configure-widgets-menu"),this.$showConfigureWidgetsMenu=this.$configureWidgets.find("> .show-configure-menu"),this.$noWidgetsInfo=this.$worksheet.find("> .no-widgets-info"),this.$configureWidgetsMenu.menu({items:"> :not(.ui-widget-header)"}),this},renderComponent:function(t,e){var e=this.createComponentView(t,e);this.trackWidgetModelChanges(t.model),e=$("<div/>",{class:"grid-stack-item-content"}).append(e.$el),t.$widget.append(e)},renderConfigureWidgetsMenu:function(){var t,e=this;this.isUserEditMode()&&(t=this.model.get("widgets").reject(function(t){return e.userWidgets.has(t)}),this.$configureWidgets.toggleClass("widgets-available",!_.isEmpty(t)),this.$configureWidgetsMenu.html(i.configureWidgetsMenu({widgets:_.map(t,function(t){return{id:t.id,name:t.get("component").get("options").get("format.widgetTitle")||t.get("component").get("key")}})})),this.$configureWidgetsMenu.menu("refresh"))},renderWidget:function(t){var t=t.get("layout"),e=t.get("row"),i=t.get("column"),o=t.get("rowSpan"),t=t.get("colSpan");return(_.isNaN(e)||_.isNaN(i))&&(i=e=null),o&&t||(o=this.DEFAULT_WIDGET_ROW_SPAN,t=Math.ceil(this.columnCount/2)),this.viewModel.get(this.KEY_ADVANCED)?($widget=$('<div class="advanced-item">'),void 0!==i&&$widget.attr("data-gs-x",i),void 0!==e&&$widget.attr("data-gs-y",e),void 0!==t&&$widget.attr("data-gs-width",t),void 0!==o&&$widget.attr("data-gs-height",o),this.$gridstack.append($widget),this.quickView||this.initSortable()):$widget=this.gridstack.addWidget("<div/>",i,e,t,o,null==i||null==e),$widget},set_columnCount:function(){this.columnCount=this.viewModel.get(this.KEY_COLUMN_COUNT)},set_rowCount:function(){this.rowCount=this.viewModel.get(this.KEY_ROW_COUNT)},setDraggedWidgetRecommendedSize:function(){var t=this.dashboardAppModel.get("draggedComponentId"),t=this.dashboardAppModel.get("components").get(t),t=_.get(t,"attributes.size",[300,200]);this.recommendedWidth=t[0],this.recommendedHeight=t[1]},setupGetGridHeight:function(){var t=this,e=this.viewModel.get(this.KEY_RELATIVE_HEIGHT);this.gridstack&&(e?(this.gridstack.grid.getGridHeight=function(){return t.rowCount},this.gridstack.grid.height=this.rowCount):(this.gridstack.grid.getGridHeight=GridStackUI.Engine.prototype.getGridHeight,this.gridstack.grid.height=0))},setupMinHeight:function(){},setVisibility_overlayOnly:function(t){!this.dashboardViewModel.get("buildMode")||(t?this.$gridOverlay.show():this.$gridOverlay.hide())},setVisibility_overlay_outline:function(t){this.$gridstack.removeClass("outlinedLocal"),t?(this.$gridstack.addClass("outlinedLocal"),this.$gridOverlay.show()):this.changeOverlayVisibilty()},stopTrackingWidgetChanges:function(t){t=t.model;this.stopListening(t.get("layout"),"change"),this.stopListening(t.get("component").get("options"),"change")},switchOffBuildMode:function(t){this.gridstack&&this.gridstack.disable(),this.$el.removeClass("user-configurable"),this.disableWidgetSelect(),this.$gridstack.find("> div").addClass("build-off"),this.viewModel.get("Basics.Advanced")&&this.$gridstack.sortable("instance")&&this.$gridstack.sortable("destroy"),this.isUserEditMode()&&t&&(t=this.generateUserLayout(this.widgetsCollection),_.isEqual(t,this.api.loadSetting("layout"))||(this.api.saveSetting("layout",JSON.stringify(t)),this.dashboardViewModel.trigger("widgets-configured")),this.$configureWidgets.removeClass("showing-menu"))},switchOnBuildMode:function(t){var e=this;this.userCan("layout")&&(this.gridstack&&this.gridstack.enable(),this.$el.addClass("user-configurable")),this.userCan("select")&&this.enableWidgetSelect(),this.viewModel.get("Basics.Advanced")&&this.initSortable(),this.userCan("configure")&&setTimeout(function(){e.$gridstack.find("> div").removeClass("build-off")},100)},trackWidgetModelChanges:function(n){this.listenTo(n.get("layout"),"change",function(t){this.gridstack&&this.gridstack.setAnimation(!1);var e=_.find(this.widgets,{widgetId:n.id}),i=e.$widget,o=t.attributes;this.ignoreGridstackEvents=!0,this.gridstack&&this.gridstack.update(i,o.column,o.row,o.colSpan,o.rowSpan),this.ignoreGridstackEvents=!1,(t.hasChanged("colSpan")||t.hasChanged("rowSpan"))&&_.hasIn(e,"view.app.onResize")&&e.view.app.onResize(),_.defer(function(){this.gridstack&&this.gridstack.setAnimation(!0)}.bind(this))})},triggerDragEvent:function(t){this.dashboardViewModel.trigger("onPanelDragEvent",t)},updateHighlightItem:function(i,o){var t=this.$gridstack,e=t.width(),n=t.height(),t=t.find("> .grid-stack-item"),s=[],a=[],r=[],d=[];s.push(0),r.push(0),a.push(e),d.push(n),_.each(t,function(t){var t=$(t),e=t.position();e.right=e.left+t.width(),e.bottom=e.top+t.height(),e.top<o?r.push(e.top):e.top>o&&d.push(e.top),e.bottom<o?r.push(e.bottom):e.bottom>o&&d.push(e.bottom)}),r=_.max(r),d=_.min(d),_.each(t,function(t){var t=$(t),e=t.position();e.right=e.left+t.width(),e.bottom=e.top+t.height(),(e.bottom>d&&e.top<d||e.top<r&&e.bottom>r||e.top>r&&e.bottom<d||e.top<r&&e.bottom>d||e.top===r&&e.bottom===d)&&(e.left<i?s.push(e.left):e.left>i&&a.push(e.left),e.right<i?s.push(e.right):e.right>i&&a.push(e.right))}),s=_.max(s),a=_.min(a),s=Math.max(0,Math.floor(i/this.columnWidth)*this.columnWidth),a=Math.min(a,s+Math.max(1,Math.round(this.recommendedWidth/this.columnWidth))*this.columnWidth),this.viewModel.get(this.KEY_FLOATABLE)&&(r=Math.floor(o/this.usedRowHeight)*this.usedRowHeight),d=Math.min(d,r+Math.max(1,Math.round(this.recommendedHeight/this.usedRowHeight))*this.usedRowHeight),this.$highlightItem.css({left:s,width:a-s,top:r,height:d-r})},updateHighlightLayer:function(){var t={top:0,left:0},e=this.$gridstack.position();t.top+=this.gridstackMargin,t.left+=e.left+this.gridstackMargin,t.top+=parseInt(this.$gridstack.parent().css("margin-top")),t.left+=parseInt(this.$gridstack.parent().css("margin-left")),this.$highlightLayer.css({"margin-top":t.top,"margin-left":t.left,width:this.$gridstack.width(),height:this.$gridstack.height()})},updateOverlaySize:function(){this.$gridOverlay.css({"background-size":100/this.columnCount+"% "+this.usedRowHeight+"px"})},updateWidgetsLayout:function(e){this.ignoreGridstackEvents||this.isUserEditMode()?_.each(this.widgets,function(t){t.model.get("layout").set({row:parseInt(t.$widget.attr("data-gs-y"),10),column:parseInt(t.$widget.attr("data-gs-x"),10),rowSpan:parseInt(t.$widget.attr("data-gs-height"),10),colSpan:parseInt(t.$widget.attr("data-gs-width"),10)},{silent:e||!1})}):this.widgetsCollection.commandSet(_.map(this.widgets,function(t){return{id:t.model.id,layout:{row:parseInt(t.$widget.attr("data-gs-y"),10),column:parseInt(t.$widget.attr("data-gs-x"),10),rowSpan:parseInt(t.$widget.attr("data-gs-height"),10),colSpan:parseInt(t.$widget.attr("data-gs-width"),10)}}}),{silent:e||!1})},upgradeGridsterLayout:function(){var t=this.widgetsCollection.map(function(t){return t.get("layout")});this.viewModel.get(this.KEY_FLOATABLE)||_.some(t,function(t){return 0===t.get("row")||0===t.get("column")})||_.each(t,function(t){t.set("row",t.get("row")-1),t.set("column",t.get("column")-1)})},userCan:function(t){var e=!1;return e=this.dashboardViewModel.get("buildMode")&&(!this.quickView||this.isUserEditMode()&&!_.includes(["addNew","select"],t))?!0:e}},{getComponentDefinition:r.getComponentDefinition,gsStyleManager:new n});return O});