define(["backbone","Handlebars","jqueryui","QuickBase","moment","css!./css/chart-default.css","css!./css/chart-light-diff.css","css!./css/chart-dark-diff.css","css!./css/jquery-ui-1.10.4-supplement.css"],function(Backbone,Handlebars,jqueryui,QuickBase,moment){"use strict";var __extends=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),a,ComponentDefinition=(m.getComponentDefinition=function(e){var t,i;if(0<_.keys(e.settingsModel.attributes).length)for(i=m.upgrades.indexOf(_.find(m.upgrades,{version:e.settingsModel.get("version")}))+1;i<m.upgrades.length;i+=1)(t=m.upgrades[i]).fn(e.settingsModel),e.settingsModel.set("version",t.version);return{id:4,componentName:"financial chart",componentDescription:"This element displays financial charts.",appKey:"AdvancedChartsApp",ghostViewThumb:null,buildViewThumb:null,appArgs:{json:{version:"4.6.2",Basics:{data:"",stockDisplayType:"CandleStick",decimalPlaces:4,viewFrom:"",viewTo:"",crosshair:"none",showInfoBorder:!1,showDisclaimer:!1,showVolume:!1,annotations:"",indicators:""},ViewState:{Focus:null},Toolbar:{showChartToolbar:!0,showDrawMenu:!0,showIndicators:!0},Style:{advanced:"",chartDisplayAreaHorizontalGridLinesColor:null,chartDisplayAreaVerticalGridLinesColor:null,crosshairColor:null,chartDisplayAreaBackground:null,chartDisplayAreaAlternativeBackground:null,chartBorderColor:null,axisTextMajor:null,axisTextMinor:null,selectedBackground:null,selectedForeground:null,chartDisplayAreaCandleStickUpFill:null,chartDisplayAreaCandleStickDownFill:null}},schema:{type:"object",title:"Properties",properties:{Basics:{type:"object",title:"Basics",options:{collapsed:!1},properties:{data:{propertyOrder:1001,type:"data",title:"Data Source"},decimalPlaces:{propertyOrder:1004,type:"number",title:"Decimal Places"},viewFrom:{propertyOrder:1005,type:"string",title:"Display From",default:""},viewTo:{propertyOrder:1006,type:"string",title:"Display To",default:""},stockDisplayType:{propertyOrder:1007,type:"string",title:"Chart Type",enum:["LineOpen","LineHigh","LineLow","LineClose","CandleStick","OHLCBar","Kagi","HeikinAshi","Mountain"],options:{enum_titles:["Open","High","Low","Close","Candlestick","Bar","Kagi","Heikin Ashi","Mountain"]},default:"CandleStick"},crosshair:{propertyOrder:1009,type:"string",title:"Crosshair",enum:["none","price","freeflow"],options:{enum_titles:["None","Snap to Price","Free Flow"]},default:"none"},showInfoBorder:{propertyOrder:1010,type:"boolean",format:"checkbox",title:"Show Info Box",default:!1},showDisclaimer:{propertyOrder:1011,type:"boolean",format:"checkbox",title:"Show Disclaimer",default:!1},showVolume:{propertyOrder:1012,type:"boolean",format:"checkbox",title:"Show Volume",default:!1},annotations:{propertyOrder:1013,type:"string",format:"checkbox",title:"Annotations",default:""},indicators:{propertyOrder:1014,type:"string",format:"checkbox",title:"Indicators",default:""}}},ViewState:{type:"object",title:"View State",options:{collapsed:!0,hidden:!0},properties:{Focus:{type:"string",title:"Stock Symbol",default:""}}},Toolbar:{type:"object",title:"Toolbar",options:{collapsed:!0},properties:{showChartToolbar:{type:"boolean",format:"checkbox",title:"Show Toolbar",default:!0},showDrawMenu:{type:"boolean",format:"checkbox",title:"Show Draw Menu",default:!0},showIndicators:{type:"boolean",format:"checkbox",title:"Show Indicators Menu",default:!0}}},Style:{type:"object",title:"Style",options:{collapsed:!0},properties:{advanced:{type:"css",title:"Advanced CSS",default:""},chartDisplayAreaHorizontalGridLinesColor:{propertyOrder:1,type:"gradient",title:"Horizontal Grid Lines",default:null},chartDisplayAreaVerticalGridLinesColor:{propertyOrder:2,type:"gradient",title:"Vertical Grid Lines",default:null},crosshairColor:{propertyOrder:3,type:"gradient",title:"Crosshair",default:null},chartDisplayAreaBackground:{propertyOrder:4,type:"gradient",title:"Background",default:null},chartDisplayAreaAlternativeBackground:{propertyOrder:5,type:"gradient",title:"Alternative Background",default:null},chartBorderColor:{propertyOrder:6,type:"gradient",title:"Chart Border",default:null},axisTextMajor:{propertyOrder:7,type:"gradient",title:"Text Major",default:null},axisTextMinor:{propertyOrder:8,type:"gradient",title:"Text Minor",default:null},selectedBackground:{propertyOrder:9,type:"gradient",title:"Selected Background",default:null},selectedForeground:{propertyOrder:10,type:"gradient",title:"Selected Foreground",default:null},chartDisplayAreaCandleStickUpFill:{propertyOrder:11,type:"gradient",title:"Candlestick Up",default:null},chartDisplayAreaCandleStickDownFill:{propertyOrder:12,type:"gradient",title:"Candlestick Down",default:null}}}}}}}},m.upgrades=[{version:"4.0.0d2",fn:function(e){e.set("Style.advanced","")}},{version:"4.0.1t7",fn:function(e){e.set("Basics.data",""),e.set("Basics.bucketSize","OneMinute"),e.set("Basics.decimalPlaces",4),e.set("Basics.viewFrom",null),e.set("Basics.viewTo",null),delete e.attributes.ViewState,delete e.attributes.old_options,delete e.attributes.Basics.sym,e.set("Basics.showVolume",!1),delete e.attributes.Toolbar.isStockPickerEnabled}},{version:"4.6.0",fn:function(e){e.get("Basics.displayText")&&e.unset("Basics.displayText"),e.get("Basics.viewFrom")||e.set("Basics.viewFrom",""),e.get("Basics.viewTo")||e.set("Basics.viewTo",""),e.get("Basics.bucketSize")&&e.unset("Basics.bucketSize"),e.get("Basics.showViewMenu")&&e.unset("Basics.showViewMenu")}},{version:"4.6.1",fn:function(e){e.get("Basics.annotations")||e.set("Basics.annotations","")}},{version:"4.6.2",fn:function(e){e.get("Basics.indicators")||e.set("Basics.indicators","")}}],m);function m(){}var dateFormat=(w=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,x=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,y=/[^-+\dA-Z]/g,function(e,t,i){var a=dateFormat;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(e)||/\d/.test(e)||(t=e,e=void 0),e=e?new Date(e):new Date,isNaN(e))throw SyntaxError("invalid date");"UTC:"==(t=String(a.masks[t]||t||a.masks.default)).slice(0,4)&&(t=t.slice(4),i=!0);var n=i?e.getUTCDate():e.getDate(),o=i?e.getUTCDay():e.getDay(),s=i?e.getUTCMonth():e.getMonth(),r=i?e.getUTCFullYear():e.getFullYear(),l=i?e.getUTCHours():e.getHours(),d=i?e.getUTCMinutes():e.getMinutes(),c=i?e.getUTCSeconds():e.getSeconds(),h=i?e.getUTCMilliseconds():e.getMilliseconds(),p=i?0:e.getTimezoneOffset(),u={d:n,dd:z(n),ddd:a.i18n.dayNames[o],dddd:a.i18n.dayNames[o+7],m:s+1,mm:z(s+1),mmm:a.i18n.monthNames[s],mmmm:a.i18n.monthNames[s+12],yy:String(r).slice(2),yyyy:r,h:l%12||12,hh:z(l%12||12),H:l,HH:z(l),M:d,MM:z(d),s:c,ss:z(c),l:z(h,3),L:z(99<h?Math.round(h/10):h),t:l<12?"a":"p",tt:l<12?"am":"pm",T:l<12?"A":"P",TT:l<12?"AM":"PM",Z:i?"UTC":(String(e).match(x)||[""]).pop().replace(y,""),o:(0<p?"-":"+")+z(100*Math.floor(Math.abs(p)/60)+Math.abs(p)%60,4),S:["th","st","nd","rd"][3<n%10?0:(n%100-n%10!=10)*n%10]};return t.replace(w,function(e){return e in u?u[e]:e.slice(1,e.length-1)})}),w,x,y;function z(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e}dateFormat.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(e,t){return dateFormat(this,e,t)};var StockDataProvider=(U.prototype.getDeltaGranularity=function(e){var t=null;switch(e){case"OneMinute":t="1min";break;case"TwoMinute":t="2min";break;case"ThreeMinute":t="3min";break;case"FiveMinute":t="5min";break;case"FifteenMinute":t="15min";break;case"ThirtyMinute":t="30min";break;case"SixtyMinute":t="1hour";break;case"FourHour":t="4hour";break;case"OneDay":t="daily";break;case"OneWeek":t="weekly";break;case"OneMonth":t="monthly"}return t},U.prototype.formatEodDataSource=function(e,i){return _.map(e.reset,function(e){var t=QuickBase.Tools.convertKDBTemporalToMoment(e.Time);return{Symbol:i,Date:new Date(t.year(),t.month(),t.day()-1,t.hours(),t.minutes(),t.seconds()),Open:e.Open,High:e.High,Low:e.Low,Close:e.Close,Volume:e.Volume}})},U.prototype.getStock=function(e,t,i,a){this.firstExtrdaDataDownloaded=!1,a&&(this.stockData={},this.stockData.keys=[]),this.historyLoaded=!1,this.noDataLimit=5,this.isOngoingCall?(this.callToIgnore=this.callCounter,this.ignoreCallback=!0):this.isOngoingCall=!0,this.callCounter+=1;for(var n=[],o=_.find(this.model.get("viewOptions"),{value:t}).timeframes,s=0;s<o.length&&(n.push(o[s].value),o[s].value!==i);s+=1);},U.prototype.getStockCallback=function(e,t,i,a,n,o,s,r){var l,d,c,h=this,e=this.formatEodDataSource(e,t.id);if(e&&0<e.length){var p;for(p=this.refreshPeriods(this.model.get("granularity"),e),_.each(p,function(e){e.loaded=!0}),a=p[p.length-1].period,l={symbol:t.id,displaySymbol:t.symbol,eodData:e,decimals:t.decimalPlaces,granularity:i,periods:p},this.stockData[l.symbol]||this.stockData.keys.push(l.symbol),this.stockData[l.symbol]=l,d=0;d<l.periods.length&&l.periods[d].loaded;d+=1)this.lastLoadedPeriodIndex=d;for(t=0<(e=(e=_.find(l.periods,{period:a}))||_.last(l.periods)).firstIndex?l.eodData.slice(e.firstIndex):l.eodData.slice(),$(this).trigger("stockPartDownloaded",{type:"stockPartDownloaded",stock:{symbol:l.symbol,displaySymbol:l.displaySymbol,eodData:t},granularity:l.granularity,period:e.period,decimals:l.decimals,lastDate:e.lastDate,firstDate:e.firstDate,isLastDataPointOpen:!1}),$(this).trigger("perioddownloaded",{type:"perioddownloaded",period:a,symbol:l.symbol,displaySymbol:l.displaySymbol,eodData:t,reloadIndicators:!r}),c=p.length-1,this.firstExtrdaDataDownloaded||(this.firstExtrdaDataDownloaded=!0,$(this).trigger("firstextradatadownloaded",{type:"firstextradatadownloaded",dontMoveIntoPast:!0})),d=this.lastLoadedPeriodIndex;d<l.periods.length;d+=1)l.periods[d].loaded&&d!==c||$(this).trigger("perioddownloaded",{type:"perioddownloaded",period:l.periods[d].period,symbol:l.symbol,displaySymbol:this.stockData[l.symbol].displaySymbol,eodData:this.stockData[l.symbol].eodData.slice(l.periods[d].period.firstIndex),reloadIndicators:c<=d});this.historyLoaded=!0,_.each(p,function(e){$(h).trigger("periodenabled",{type:"periodenabled",period:e.period})}),this.onDataLoaded(),o&&o()}else this.onDataLoaded(),console.log("StockDataProvider no data returned"),o&&o("noData")},U.prototype.onDataLoaded=function(){var e=this.loadingQ.pop();e?(e(),this.onDataLoaded()):this.loadingData=!1},U.prototype.isPeriodLoaded=function(t){var e=!1,i=this.stockData.keys[0];return e=this.stockData[i]?0<(i=_.filter(this.stockData[i].periods,function(e){return e.period===t})).length&&i[0].loaded:e},U.prototype.refreshPeriods=function(e,t){var i,a=[],n=t.length-1;return _.each(this.fixPeriods(this.model.get("granularity"),t.length),function(e){i||(a.push({period:e.Name,firstDate:t[e.StartIndex].Date,firstIndex:e.StartIndex,lastDate:t[n].Date,lastIndex:n,loaded:!1}),n=0<e.StartIndex-1?e.StartIndex-1:0,e.StartIndex<=0&&(i=!0))}),a},U.prototype.fixPeriods=function(e,t){var i,e=_.find(this.model.get("viewOptions"),{value:e}),a=[],n=moment.duration(e.momentValue,e.momentKey).asMilliseconds();return _.each(e.timeframes,function(e){i=moment.duration(e.momentValue,e.momentKey).asMilliseconds(),i=parseInt((i/n).toString(),10),a.push({Name:e.value,StartIndex:t<i?0:t-i})}),a[a.length-1].StartIndex=0,a},U.prototype.getLoadedBaseIndex=function(){var e=0,t=_.filter(this.stockData[this.stockData.keys[0]].periods,function(e){return!e.loaded});return e=0<t.length?_.first(t).lastIndex:e},U.prototype.getPeriodInfo=function(e){var t=this.stockData.keys[0];return _.first(_.filter(this.stockData[t].periods,{period:e}))},U.prototype.getNextPeriod=function(){var e,t=this.lastLoadedPeriodIndex+1,i=this.stockData.keys[0];return t<this.stockData[i].periods.length&&(this.lastLoadedPeriodIndex=t,(t=this.stockData[i].periods[t]).loaded=!0,e=this.stockData[i].eodData.slice(t.firstIndex,t.lastIndex+1)),e},U.prototype.onDataSourceData=function(e,t){this.loadingData=!0,this.firstExtrdaDataDownloaded=!1,this.stockData={},this.stockData.keys=[];var i={id:"XXX",symbol:"XXX",decimalPlaces:this.model.get("originalDecimalPlaces")};this.model.set({stockPickerSymbol:i,stockSymbol:"XXX"},{silent:!0}),this.getStockCallback(e,i,"OneMinute","ThreeDays",!0,t,!1,!0),this.onDataLoaded()},U);function U(e){this.loadingQ=[],this.callCounter=1,this.previousPeriod=[],this.model=e.model}var Vector=(k0.prototype.add=function(e,t){return new k0(this.x+e,this.y+t)},k0.prototype.divide=function(e){this.x/=e,this.y/=e},k0.prototype.fromPoints=function(e,t,i,a){this.x=i-e,this.y=a-t},k0.prototype.findPerpendicular=function(e){var t=new k0(-this.y,this.x);return t.normalize(),e&&t.multiply(e),t},k0.prototype.intersection=function(e,t,i,a){var n=t.x-e.x,t=t.y-e.y,o=a.x-i.x,a=a.y-i.y,s=n*a-t*o;if(0==s)return null;var r=e.x-i.x,i=e.y-i.y,o=(i*o-r*a)/s,a=(i*n-r*t)/s;return 0==o&&0==a||o<0||1<o||a<0||1<a?null:new k0(e.x+o*n,e.y+o*t)},k0.prototype.multiply=function(e){this.x*=e,this.y*=e},k0.prototype.negate=function(){return new k0(-this.x,-this.y)},k0.prototype.normalize=function(){var e=Math.max(Math.abs(this.x),Math.abs(this.y));this.divide(e),this.divide(this.magnitude(this.x,this.y))},k0.prototype.subsctract=function(e,t){return new k0(this.x-e,this.y-t)},k0);function k0(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.x=0,this.y=0,this.magnitude=function(e,t){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2))},this.x=e,this.y=t}var Helpers=(N0.getGUID=function(){function e(){return Math.floor(65536*Math.random()).toString(16)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},N0.filteredMin=function(e,t,i){var a,n,o=_.find(e,function(e){return a=e.get(t),e=(e=e&&_.isNumber(a)&&!_.isNaN(a)&&_.isFinite(a))&&i&&a<=0?!1:e});if(o)return o=n=o.get(t),_.each(e,function(e){a=e.get(t),e=e&&_.isNumber(a)&&!_.isNaN(a)&&_.isFinite(a)?a:o,(e=i&&e<=0?o:e)<n&&(n=e)}),n},N0.filteredMax=function(e,t,i){var a,n,o=_.find(e,function(e){return a=e.get(t),e=(e=e&&_.isNumber(a)&&!_.isNaN(a)&&_.isFinite(a))&&i&&a<=0?!1:e});if(o)return o=n=o.get(t),_.each(e,function(e){a=e.get(t),e=e&&_.isNumber(a)&&!_.isNaN(a)&&_.isFinite(a)?a:o,n<(e=i&&e<=0?o:e)&&(n=e)}),n},N0.getDateTag=function(e,t){var i,a,n,o,s=e.getFullYear(),r=e.getMonth(),l=e.getDate(),d=e.getHours(),c=e.getMinutes(),e=e.getSeconds(),h=t?(h=t.getFullYear(),i=t.getMonth(),a=t.getDate(),n=t.getHours(),o=t.getMinutes(),t=t.getSeconds(),s!==h?s%10==0?"10year":s%5==0?"5year":"1year":r!==i?(r+1)%3==0?"3month":"1month":l!==a?l%15==0?"15day":"1day":d!==n?d%6==0?"6h":d%3==0?"3h":"1h":c!==o?c%15==0?"15min":c%5==0?"5min":"1min":e!==t?"1sec":"1tick"):s%10==0?"10year":s%5==0?"5year":"1year";return h},N0.hexToRgb=function(e){var t,i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return 0===e.indexOf("rgb")?(t=(t=(t=e.split("("))[1].split(")"))[0].split(","),t={r:parseInt(t[0],10),g:parseInt(t[1],10),b:parseInt(t[2],10)}):i?t={r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:(i=e.match(/\d+/g))&&(t=[null].concat(t)),t},N0.getNextDate=function(e,t){var i;switch(t){case"Tick":i=new Date(e.getTime()+1);break;case"OneMinute":i=new Date(e.getTime()+6e4);break;case"TwoMinute":i=new Date(e.getTime()+12e4);break;case"ThreeMinute":i=new Date(e.getTime()+18e4);break;case"FiveMinute":i=new Date(e.getTime()+3e5);break;case"FifteenMinute":i=new Date(e.getTime()+9e5);break;case"ThirtyMinute":i=new Date(e.getTime()+18e5);break;case"SixtyMinute":i=new Date(e.getTime()+36e5);break;case"FourHour":i=new Date(e.getTime()+144e5);break;case"OneDay":(i=new Date(e)).setDate(e.getDate()+1);break;case"OneWeek":(i=new Date(e)).setDate(e.getDate()+7);break;case"OneMonth":i=new Date(e),i=new Date(i.setMonth(e.getMonth()+1));break;default:throw"granulatiry not suported"}return i},N0);function N0(){}var T=(Db.AnnotationContextMenu=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,a,n){return'<div class="charting context-menu ui-widget ui-widget-content ui-corner-all">\n    <ul id="menu">\n        <li><a href="#">edit</a></li>\n        <li><a href="#">copy</a></li>\n        <li><a href="#">delete</a></li>\n    </ul>\n</div>'},useData:!0}),Db.AnnotationEditForm=Handlebars.template({1:function(e,t,i,a,n){var o=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,r="function",l=e.escapeExpression,d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]},l="                        <label>"+l(typeof(c=null!=(c=d(i,"title")||(null!=t?d(t,"title"):t))?c:s)==r?c.call(o,{name:"title",hash:{},data:n,loc:{start:{line:12,column:31},end:{line:12,column:40}}}):c)+' <input type="checkbox" name="'+l(typeof(c=null!=(c=d(i,"name")||(null!=t?d(t,"name"):t))?c:s)==r?c.call(o,{name:"name",hash:{},data:n,loc:{start:{line:12,column:70},end:{line:12,column:78}}}):c)+'"',c=null!=(c=d(i,"selected")||(null!=t?d(t,"selected"):t))?c:s,s={name:"selected",hash:{},fn:e.program(2,n,0),inverse:e.noop,data:n,loc:{start:{line:12,column:79},end:{line:12,column:113}}},n=typeof c==r?c.call(o,s):c;return null!=(n=d(i,"selected")?n:e.hooks.blockHelperMissing.call(t,n,s))&&(l+=n),l+"></label><br />\n"},2:function(e,t,i,a,n){return" checked"},compiler:[8,">= 4.3.0"],main:function(e,t,i,a,n){var o=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,r="function",l=e.escapeExpression,d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]},c='<div style="white-space: nowrap;" class="annotationEditForm">\n    <div class="options">\n        <table style="width: 100%;">\n            <tr>\n                <td>\n                    Options:\n                </td>\n                <td style="width: 7px;"></td>\n                <td style="float: right;">\n                    <div class="options-checkboxes">\n',h=null!=(h=d(i,"Options")||(null!=t?d(t,"Options"):t))?h:s,p={name:"Options",hash:{},fn:e.program(1,n,0),inverse:e.noop,data:n,loc:{start:{line:11,column:24},end:{line:13,column:36}}},u=typeof h==r?h.call(o,p):h;return null!=(u=d(i,"Options")?u:e.hooks.blockHelperMissing.call(t,u,p))&&(c+=u),c+'                    </div>\n                </td>\n            </tr>\n        </table>\n    </div>\n        \n    <div class="line">\n        <table style="width: 100%;">\n            <tr>\n                <td>\n                    Line Thickness:\n                </td>\n                <td style="width: 7px;"></td>\n                <td style="float: right;">\n                    <input class="line-thickness" name="value" style="max-width: 75px; text-align: right;" />\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    Line Color:\n                </td>\n                <td style="width: 7px;"></td>\n                <td style="float: right;">\n                    <input name="line-color"\n                           style="width: 0; display: none;"\n                           class="strokeColor colorPicker evo-cp0"\n                           data-property-name="line-color"\n                        />\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    Line Opacity:\n                </td>\n                <td style="width: 7px;"></td>\n                <td>\n                    <div class="line-opacity-slider" style="margin-top: 3px;"></div>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    Line Type:\n                </td>\n                <td style="width: 7px;"></td>\n                <td style="float: right;">\n                    <select class="line-type">\n                        <option value="line">Line</option>\n                        <option value="dashes">Dashes</option>\n                        <option value="dots">Dots</option>\n                    </select>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    Extend:\n                </td>\n                <td style="width: 7px;"></td>\n                <td style="float: right;">\n                    <div class="extend-line">\n                        <label><input type="checkbox" value="future"> '+l(typeof(h=null!=(h=d(i,"ExtendFutureLabel")||(null!=t?d(t,"ExtendFutureLabel"):t))?h:s)==r?h.call(o,{name:"ExtendFutureLabel",hash:{},data:n,loc:{start:{line:73,column:70},end:{line:73,column:91}}}):h)+'</label>\n                        <label><input type="checkbox" value="past"> '+l(typeof(h=null!=(h=d(i,"ExtendPastLabel")||(null!=t?d(t,"ExtendPastLabel"):t))?h:s)==r?h.call(o,{name:"ExtendPastLabel",hash:{},data:n,loc:{start:{line:74,column:68},end:{line:74,column:87}}}):h)+'</label>\n                    </div>\n                </td>\n            </tr>\n        </table>\n    </div>\n\n    <div class="text">\n        <table style="width: 100%;">\n            <tr>\n                <td>\n                    Text:\n                </td>\n                <td style="width: 7px;"></td>\n                <td>\n                    <textarea class="note-text" rows="4" cols="25" style="resize: none;" />\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    Text Size:\n                </td>\n                <td style="width: 7px;"></td>\n                <td style="float: right;">\n                    <input class="text-size" name="value" style="max-width: 75px; text-align: right;" />\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    Text Margin:\n                </td>\n                <td style="width: 7px;"></td>\n                <td style="float: right;">\n                    <input class="text-margin" name="value" style="max-width: 75px; text-align: right;" />\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    Text Color:\n                </td>\n                <td style="width: 7px;"></td>\n                <td style="float: right;">\n                    <input name="text-color"\n                           style="width: 0; display: none;"\n                           class="strokeColor colorPicker evo-cp0"\n                           data-property-name="text-color"\n                        />\n                </td>\n            </tr>\n        </table>\n    </div>\n\n    <div class="shape">\n        <table style="width: 100%;">\n            <tr style="height: 25px;">\n                <td>\n                    Fill Color:\n                </td>\n                <td style="width: 7px;"></td>\n                <td style="float: right;">\n                    <input name="fill-color"\n                           style="width: 0; display: none;"\n                           class="strokeColor colorPicker evo-cp0"\n                           data-property-name="fill-color"\n                        />\n                </td>\n            </tr>\n            <tr style="height: 25px;">\n                <td>\n                    Fill Opacity:\n                </td>\n                <td style="width: 7px;"></td>\n                <td>\n                    <div class="fill-opacity-slider" style="margin-top: 3px;"></div>\n                </td>\n            </tr>\n            <tr style="height: 25px;">\n                <td>\n                    Border Thickness:\n                </td>\n                <td style="width: 7px;"></td>\n                <td style="float: right;">\n                    <input class="border-thickness" name="value" style="max-width: 75px; text-align: right;" />\n                </td>\n            </tr>\n            <tr style="height: 25px;">\n                <td>\n                    Border Color:\n                </td>\n                <td style="width: 7px;"></td>\n                <td style="float: right;">\n                    <input name="border-color"\n                           style="width: 0; display: none;"\n                           class="strokeColor colorPicker evo-cp0"\n                           data-property-name="border-color"\n                        />\n                </td>\n            </tr>\n            <tr style="height: 25px;">\n                <td>\n                    Border Opacity:\n                </td>\n                <td style="width: 7px;"></td>\n                <td>\n                    <div class="border-opacity-slider" style="margin-top: 3px;"></div>\n                </td>\n            </tr>\n        </table>\n    </div>\n\n    <div class="advanced">\n        <table style="width: 100%;">\n            <tr>\n                <td>\n                    Line Thickness:\n                </td>\n                <td style="width: 7px;"></td>\n                <td style="float: right;">\n                    <input class="line-thickness" name="value" style="max-width: 75px; text-align: right;" />\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    Line Color:\n                </td>\n                <td style="width: 7px;"></td>\n                <td style="float: right;">\n                    <input name="line-color"\n                           style="width: 0; display: none;"\n                           class="strokeColor colorPicker evo-cp0"\n                           data-property-name="line-color"\n                        />\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    Line Opacity:\n                </td>\n                <td style="width: 7px;"></td>\n                <td>\n                    <div class="line-opacity-slider" style="margin-top: 3px;"></div>\n                </td>\n            </tr>\n        </table>\n    </div>\n    \n    <div style="margin-top: 13px;">\n        <input type="button" name="remove" value="remove" style="float: left;" />\n        <input type="button" name="ok" value="OK" style="float: right;"/>\n    </div>\n    <div style="clear: both;"></div>\n</div>'},useData:!0}),Db.Chart=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,a,n){return'\n<div class="MainChartAreaDiv" style="position: absolute;"></div>\n<div class="IndicatorsChartAreaDiv" style="position: absolute;"></div>\n<div class="VolumeChartAreaDiv" style="position: absolute;"></div>\n\n<div class="InfoAreaDiv" style="position: absolute; padding-top: 2px;">\n    <span class="info-value" id="dateInfo" style="margin-right: 13px;"></span>\n    <span class="info-label" style="margin-right: 7px;">O:</span><span id="openInfo" class="info-value"></span>\n    <span class="info-label" style="margin-left: 7px; margin-right: 7px;">H:</span><span id="highInfo" class="info-value"></span>\n    <span class="info-label" style="margin-left: 7px; margin-right: 7px;">L:</span><span id="lowInfo" class="info-value"></span>\n    <span class="info-label" style="margin-left: 7px; margin-right: 7px;">C:</span><span id="closeInfo" class="info-value"></span>\n</div>\n\n<div class="RangeSelectorDiv" style="position: absolute; z-index: 100;"></div>\n\n<div class="IndicatorsToolbarDiv" style="position: absolute;"></div>\n\n<div class="InfoBorderDiv" style="position: absolute; left: 42px; top: 27px; width: 0; height: 0; z-index: 1001;"></div>\n\n<div class="resize-indicator-interaction" style="display: none; position: absolute; background-color: transparent; z-index: 1000;"></div>\n\n'},useData:!0}),Db.ChartArea=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,a,n){return'<div class="Background" style="position: absolute;"></div>\n\n<canvas class="VerticalGrid" style="position: absolute; left: 0; top: 0; width: 0; height: 0;" />\n<canvas class="HorizontalGrid" style="position: absolute; left: 0; top: 0; width: 0; height: 0;" />\n\n<div class="DisplayText"></div>\n\n<div class="DisplayAreaDiv" style="position: absolute;"></div>\n<canvas class="CrosshairCanvas" style="position: absolute; left: 0; top: 0; width: 0; height: 0;" />\n<div class="LeftAxisDiv" style="position: absolute;"></div>\n<div class="RightAxisDiv" style="position: absolute; overflow: visible;"></div>\n<div class="BottomAxisDiv" style="position: absolute; z-index: 1000;"></div>\n<canvas class="DrawingCanvas" style="position: absolute; left: 0; top: 0; width: 0; height: 0;" />\n<canvas class="ZoomingCanvas" style="position: absolute; left: 0; top: 0; width: 0; height: 0;" />\n\n<div class="InteractionLayer" style="position: absolute; background-color: transparent;">\n</div>\n\n<div class="SeriesBarDiv" style="position: absolute;"></div>'},useData:!0}),Db.ChartToolbar=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,a,n){return'<div style="position: relative;">\n    \n    <div class="ui-widget-header buttons-div">\n        <div class="toolbar-left" style="display: inline-block;">\n            <div class="stock-picker-div" style="width: 175px; display: inline-block; margin-right: 7px; float: left; margin-top: 3px;" data-overflow-index="2">\n\n            </div>\n\t\t\t\n            <button class="zoom toolbar-btn" type="button" data-overflow-index="4">Click to focus/zoom in on any area</button>\n\n            <button class="save toolbar-btn" type="button" data-overflow-index="1">Save chart image</button>\n\n            <button class="draw toolbar-btn" type="button" data-overflow-index="7">Draw</button>\n\n            <button class="indicators toolbar-btn" type="button" data-overflow-index="6">Indicators</button>\n\n            <button class="options toolbar-btn" type="button" data-overflow-index="3">Options</button>\n            \n            <button class="overflow-btn toolbar-btn" type="button">More</button>\n        </div>\n\n    </div>\n\n    <div class="indicators-menu chart-menu ui-widget-content ui-corner-all">\n        <div class="chart-menu-section">\n            <div class="scroll-pane">\n                <ul class="chartTypeMenu">\n                </ul>\n            </div>\n        </div>\n    </div>\n    \n    <div class="options-menu chart-menu ui-widget-content ui-corner-all">\n        <div class="chart-menu-section">\n            <div class="chart-menu-column-header chart-menu-column-header-with-padding">Chart Type</div>\n            <ul class="chartTypeMenu">\n                <li><a href="#LineOpen">Open</a></li>\n                <li><a href="#LineHigh">High</a></li>\n                <li><a href="#LineLow">Low</a></li>\n                <li><a href="#LineClose">Close</a></li>\n                <li><a href="#CandleStick">Candlestick</a></li>\n                <li><a href="#OHLCBar">Bar</a></li>\n                <li class="notMobile"><a href="#Kagi">Kagi</a></li>\n                <li class="notMobile"><a href="#HeikinAshi">Heikin Ashi</a></li>\n                <li><a href="#Mountain">Mountain</a></li>\n            </ul>\n        </div>\n\n        <div class="chart-menu-section">\n            <div class="chart-menu-column-header">More</div>\n            \n            <div class="notMobile">\n                <span class="chart-menu-text chart-menu-section-header">Crosshair</span>\n\n                <div class="crosshair-types">\n                    <a href="#none">None</a>\n                    <a href="#price">Price</a>\n                    <a href="#cursor">Cursor</a>\n                </div>\n            </div>\n\n            <div class="notMobile">\n                <span class="chart-menu-text chart-menu-section-header">Price Info</span>\n\n                <div class="border-types">\n                    <a href="#off">Off</a>\n                    <a href="#on">On</a>\n                    <a href="#cursor">On Pause</a>\n                </div>\n            </div>\n\n            \x3c!-- <a class="settings-link notCompact" href="#settings">Settings</a> --\x3e\n            \n            <div class="themes">\n                <span class="chart-menu-text chart-menu-section-header">Themes</span>\n                <div class="themes-list">\n                </div>\n            </div>\n\n        </div>\n    </div>\n    \n    <div class="draw-menu chart-menu ui-widget-content ui-corner-all">\n        \n        <div class="chart-menu-section">\n            <div class="chart-menu-column-header chart-menu-column-header-with-padding">Basic</div>\n            <ul class="annotations">\n                <li><a href="#trend-line">Trend Line</a></li>\n                <li><a href="#horizontal-line">Horizontal Line</a></li>\n                <li><a href="#vertical-line">Vertical Line</a></li>\n                <li><a href="#level">Target Line</a></li>\n            </ul>\n        </div>\n\n        <div class="chart-menu-section">\n            <div class="chart-menu-column-header chart-menu-column-header-with-padding">Shapes and Text</div>\n            <ul class="annotations">\n                <li><a href="#ellipse">Ellipse</a></li>\n                <li><a href="#rectangle">Rectangle</a></li>\n                <li><a href="#rotation-rectangle">Rotation Rectangle</a></li>\n                <li><a href="#text-note">Text Note</a></li>\n            </ul>\n        </div>\n\n        <div class="chart-menu-section">\n            <div class="chart-menu-column-header chart-menu-column-header-with-padding">Advanced</div>\n            <ul class="annotations">\n                <li><a href="#fibonacci-retracements">Fibonacci Retracements</a></li>\n                <li><a href="#fibonacci-time-zones">Fibonacci Time Zones</a></li>\n                <li><a href="#fibonacci-fan">Fibonacci Fan</a></li>\n                <li><a href="#fibonacci-arcs">Fibonacci Arcs</a></li>\n                <li><a href="#dinapoli">DiNapoli Levels</a></li>\n                <li><a href="#gann-box">Gann Box</a></li>\n                <li><a href="#gann-fan">Gann Fan</a></li>\n                <li><a href="#andrews-pitchfork">Andrews Pitchfork</a></li>\n            </ul>\n        </div>\n\n        <div class="chart-menu-section">\n            <div class="chart-menu-column-header">Shape properties</div>\n            <div>\n                <table style="width: 220px;">\n                    <tr style="height: 30px;">\n                        <td class="chart-menu-text">Stroke Thickness</td>\n                        <td>\n                            <div class="line-thickness" style="width: 100px;">\n                                <a href="#" class="lt1">x1</a>\n                                <a href="#" class="lt2">x2</a>\n                                <a href="#" class="lt3">x3</a>\n                            </div>\n                        </td>\n                    </tr>\n                    <tr style="height: 30px;">\n                        <td class="chart-menu-text">Stroke Color</td>\n                        <td style="vertical-align: middle; padding-left: 25px;">\n                            <input style="width: 0; display: none;" class="strokeColor colorPicker evo-cp0" />\n                        </td>\n                    </tr>\n                    <tr style="height: 30px;">\n                        <td class="chart-menu-text">Fill Color</td>\n                        <td style="vertical-align: middle; padding-left: 25px;">\n                            <input style="width: 0; display: none;" class="fillColor colorPicker evo-cp0" />\n                        </td>\n                    </tr>\n                </table>\n            </div>\n        </div>\n        \n        <div class="buttons-panel">\n            <button class="undo-button" type="button" >Undo</button>\n            <button class="redo-button" type="button" >Redo</button>\n            <button class="clear-button" type="button" >Remove All</button>    \n        </div>\n        \n    </div>\n    \n    <div class="overflow-menu chart-menu ui-widget-content ui-corner-all"></div>\n    \n</div>'},useData:!0}),Db.DisplayArea=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,a,n){return'<canvas class="MainCanvas" style="position: absolute; left: 0; top: 0;" />\n<canvas class="LiveElementsCanvas" style="position: absolute; top: 0;" />\n<canvas class="AnnotationsCanvas" style="position: absolute; left: 0; top: 0;" />\n'},useData:!0}),Db.HorizontalAxis=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,a,n){return'\n<div class="TextsDiv" style="position: absolute; top: 0; left: 0; overflow: hidden;"></div>\n<div class="borderDiv" style="height: 100%; width: 1px; border-left: 1px solid #9eafb6; border-right: 1px solid #9eafb6; background-color: #010b12;"></div>\n<canvas class="MainCanvas" style="position: absolute; top: 0; left: 0;" />'},useData:!0}),Db.IndicatorForm=Handlebars.template({1:function(e,t,i,a,n){var o=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,r="function",l=e.escapeExpression,d=e.hooks.blockHelperMissing,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]},l="        <tr>\n            <td>\n                "+l(typeof(h=null!=(h=c(i,"Name")||(null!=t?c(t,"Name"):t))?h:s)==r?h.call(o,{name:"Name",hash:{},data:n,loc:{start:{line:6,column:16},end:{line:6,column:24}}}):h)+'\n            </td>\n            <td style="vertical-align: middle;">\n                <input name="number"\n                        value="'+l(typeof(h=null!=(h=c(i,"Value")||(null!=t?c(t,"Value"):t))?h:s)==r?h.call(o,{name:"Value",hash:{},data:n,loc:{start:{line:10,column:31},end:{line:10,column:40}}}):h)+'"\n                        data-parameter-order-index="'+l(typeof(h=null!=(h=c(i,"OrderIndex")||(null!=t?c(t,"OrderIndex"):t))?h:s)==r?h.call(o,{name:"OrderIndex",hash:{},data:n,loc:{start:{line:11,column:52},end:{line:11,column:66}}}):h)+'"\n                        ',h=null!=(h=c(i,"MinSet")||(null!=t?c(t,"MinSet"):t))?h:s,p={name:"MinSet",hash:{},fn:e.program(2,n,0),inverse:e.noop,data:n,loc:{start:{line:12,column:24},end:{line:12,column:65}}},u=typeof h==r?h.call(o,p):h;return null!=(u=c(i,"MinSet")?u:d.call(t,u,p))&&(l+=u),l+="\n                        ",h=null!=(h=c(i,"StepSet")||(null!=t?c(t,"StepSet"):t))?h:s,p={name:"StepSet",hash:{},fn:e.program(4,n,0),inverse:e.noop,data:n,loc:{start:{line:13,column:24},end:{line:13,column:69}}},u=typeof h==r?h.call(o,p):h,null!=(u=c(i,"StepSet")?u:d.call(t,u,p))&&(l+=u),l+" />\n            </td>\n        </tr>\n"},2:function(e,t,i,a,n){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return' data-min="'+e.escapeExpression("function"==typeof(i=null!=(i=o(i,"Min")||(null!=t?o(t,"Min"):t))?i:e.hooks.helperMissing)?i.call(null!=t?t:e.nullContext||{},{name:"Min",hash:{},data:n,loc:{start:{line:12,column:46},end:{line:12,column:53}}}):i)+'"'},4:function(e,t,i,a,n){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return' data-step="'+e.escapeExpression("function"==typeof(i=null!=(i=o(i,"Step")||(null!=t?o(t,"Step"):t))?i:e.hooks.helperMissing)?i.call(null!=t?t:e.nullContext||{},{name:"Step",hash:{},data:n,loc:{start:{line:13,column:48},end:{line:13,column:56}}}):i)+'"'},6:function(e,t,i,a,n){var o=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,r="function",l=e.escapeExpression,d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]},l="        <tr>\n            <td>\n                "+l(typeof(c=null!=(c=d(i,"Name")||(null!=t?d(t,"Name"):t))?c:s)==r?c.call(o,{name:"Name",hash:{},data:n,loc:{start:{line:20,column:16},end:{line:20,column:24}}}):c)+'\n            </td>\n            <td>\n                <select class="ui-widget" data-parameter-order-index="'+l(typeof(c=null!=(c=d(i,"OrderIndex")||(null!=t?d(t,"OrderIndex"):t))?c:s)==r?c.call(o,{name:"OrderIndex",hash:{},data:n,loc:{start:{line:23,column:70},end:{line:23,column:84}}}):c)+'">\n',c=null!=(c=d(i,"Options")||(null!=t?d(t,"Options"):t))?c:s,s={name:"Options",hash:{},fn:e.program(7,n,0),inverse:e.noop,data:n,loc:{start:{line:24,column:20},end:{line:26,column:32}}},n=typeof c==r?c.call(o,s):c;return null!=(n=d(i,"Options")?n:e.hooks.blockHelperMissing.call(t,n,s))&&(l+=n),l+"                </select>\n            </td>\n        </tr>\n"},7:function(e,t,i,a,n){var o=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,r="function",l=e.escapeExpression,d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]},c='                    <option value="'+l(typeof(h=null!=(h=d(i,"Value")||(null!=t?d(t,"Value"):t))?h:s)==r?h.call(o,{name:"Value",hash:{},data:n,loc:{start:{line:25,column:35},end:{line:25,column:44}}}):h)+'"',h=null!=(h=d(i,"Selected")||(null!=t?d(t,"Selected"):t))?h:s,p={name:"Selected",hash:{},fn:e.program(8,n,0),inverse:e.noop,data:n,loc:{start:{line:25,column:45},end:{line:25,column:80}}},u=typeof h==r?h.call(o,p):h;return null!=(u=d(i,"Selected")?u:e.hooks.blockHelperMissing.call(t,u,p))&&(c+=u),c+">"+l(typeof(h=null!=(h=d(i,"Name")||(null!=t?d(t,"Name"):t))?h:s)==r?h.call(o,{name:"Name",hash:{},data:n,loc:{start:{line:25,column:81},end:{line:25,column:89}}}):h)+"</option>\n"},8:function(e,t,i,a,n){return" selected"},10:function(e,t,i,a,n,o,s){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]},l="",d=null!=(d=r(i,"nonConfigurable")||(null!=t?r(t,"nonConfigurable"):t))?d:e.hooks.helperMissing,o={name:"nonConfigurable",hash:{},fn:e.noop,inverse:e.program(11,n,0,o,s),data:n,loc:{start:{line:32,column:8},end:{line:89,column:28}}},s="function"==typeof d?d.call(null!=t?t:e.nullContext||{},o):d;return null!=(s=r(i,"nonConfigurable")?s:e.hooks.blockHelperMissing.call(t,s,o))&&(l+=s),l},11:function(e,t,i,a,n,o,s){var r=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,d="function",c=e.hooks.blockHelperMissing,h=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]},p="        <tr>\n            <td>\n                "+e.escapeExpression(typeof(u=null!=(u=h(i,"discreteName")||(null!=t?h(t,"discreteName"):t))?u:l)==d?u.call(r,{name:"discreteName",hash:{},data:n,loc:{start:{line:35,column:16},end:{line:35,column:32}}}):u)+'\n            </td>\n            <td style="text-align: right; float: right;">\n                \n',u=null!=(u=h(i,"color")||(null!=t?h(t,"color"):t))?u:l,m={name:"color",hash:{},fn:e.program(12,n,0,o,s),inverse:e.noop,data:n,loc:{start:{line:39,column:12},end:{line:49,column:30}}},g=typeof u==d?u.call(r,m):u;return null!=(g=h(i,"color")?g:c.call(t,g,m))&&(p+=g),p+="\n                    \n",u=null!=(u=h(i,"profitColor")||(null!=t?h(t,"profitColor"):t))?u:l,m={name:"profitColor",hash:{},fn:e.program(14,n,0,o,s),inverse:e.noop,data:n,loc:{start:{line:52,column:16},end:{line:61,column:36}}},g=typeof u==d?u.call(r,m):u,null!=(g=h(i,"profitColor")?g:c.call(t,g,m))&&(p+=g),p+="\n",u=null!=(u=h(i,"lossColor")||(null!=t?h(t,"lossColor"):t))?u:l,m={name:"lossColor",hash:{},fn:e.program(16,n,0,o,s),inverse:e.noop,data:n,loc:{start:{line:63,column:16},end:{line:72,column:34}}},g=typeof u==d?u.call(r,m):u,null!=(g=h(i,"lossColor")?g:c.call(t,g,m))&&(p+=g),p+="                \n            </td>\n        </tr>\n        \n",u=null!=(u=h(i,"lineThickness")||(null!=t?h(t,"lineThickness"):t))?u:l,m={name:"lineThickness",hash:{},fn:e.program(18,n,0,o,s),inverse:e.noop,data:n,loc:{start:{line:77,column:8},end:{line:87,column:26}}},g=typeof u==d?u.call(r,m):u,null!=(g=h(i,"lineThickness")?g:c.call(t,g,m))&&(p+=g),p+"\n"},12:function(e,t,i,a,n,o,s){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                \x3c!--<div style="margin: 3px;">--\x3e\n                    <input name="color"\n                            style="width: 0; display: none;"\n                            class="strokeColor colorPicker evo-cp0"\n                            data-indicator-discrete-id="'+e.escapeExpression(e.lambda(null!=s[1]?r(s[1],"discreteIndicatorID"):s[1],t))+'"\n                            data-color-type="lineColor"\n                        />\n                    \x3c!--</div>--\x3e\n\n'},14:function(e,t,i,a,n,o,s){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                \x3c!--<div style="margin: 3px;">--\x3e\n                <input name="color"\n                        style="width: 0; display: none;"\n                        class="strokeColor colorPicker evo-cp0"\n                        data-indicator-discrete-id="'+e.escapeExpression(e.lambda(null!=s[1]?r(s[1],"discreteIndicatorID"):s[1],t))+'"\n                        data-color-type="profitColor"\n                    />\n                    \x3c!--</div>--\x3e\n'},16:function(e,t,i,a,n,o,s){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                \x3c!--<div style="margin: 3px;">--\x3e\n                <input name="color"\n                        style="width: 0; display: none;"\n                        class="strokeColor colorPicker evo-cp0"\n                        data-indicator-discrete-id="'+e.escapeExpression(e.lambda(null!=s[1]?r(s[1],"discreteIndicatorID"):s[1],t))+'"\n                        data-color-type="lossColor"\n                    />\n                    \x3c!--</div>--\x3e\n'},18:function(e,t,i,a,n,o,s){var r=e.lambda,l=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <tr>\n            <td>\n                Thickness:\n            </td>\n            <td style="text-align: right; vertical-align: middle;">\n                <input name="thickness" value="'+l(r(null!=s[1]?e(s[1],"lineThickness"):s[1],t))+'"\n                        data-indicator-discrete-id="'+l(r(null!=s[1]?e(s[1],"discreteIndicatorID"):s[1],t))+'"/>\n            </td>\n        </tr>\n'},compiler:[8,">= 4.3.0"],main:function(e,t,i,a,n,o,s){var r=e.lambda,l=e.hooks.blockHelperMissing,d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]},r='<div class="charting IndicatorForm" style="width: auto;">\n    <table>\n'+(null!=(h=l.call(t,r(null!=(h=null!=t?d(t,"parameters"):t)?d(h,"number"):h,t),{name:"parameters.number",hash:{},fn:e.program(1,n,0,o,s),inverse:e.noop,data:n,loc:{start:{line:3,column:8},end:{line:16,column:30}}}))?h:"")+(null!=(h=l.call(t,r(null!=(h=null!=t?d(t,"parameters"):t)?d(h,"list"):h,t),{name:"parameters.list",hash:{},fn:e.program(6,n,0,o,s),inverse:e.noop,data:n,loc:{start:{line:17,column:8},end:{line:30,column:28}}}))?h:""),c=null!=(c=d(i,"discreteIndicators")||(null!=t?d(t,"discreteIndicators"):t))?c:e.hooks.helperMissing,o={name:"discreteIndicators",hash:{},fn:e.program(10,n,0,o,s),inverse:e.noop,data:n,loc:{start:{line:31,column:8},end:{line:90,column:31}}},h="function"==typeof c?c.call(null!=t?t:e.nullContext||{},o):c;return null!=(h=d(i,"discreteIndicators")?h:l.call(t,h,o))&&(r+=h),r+"    </table>\n</div>"},useData:!0,useDepths:!0}),Db.IndicatorsToolbar=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,a,n){return'<ul class="IndicatorsToolbar" style="position: relative; margin: 0; padding: 0; border: none; list-style-type: none; width: 100%;">\n\n</ul>'},useData:!0}),Db.InfoBorder=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,a,n){return'<div class="RootDiv InfoBorder">\n    \n    <table>\n        <tr>\n            <td>Open:</td>\n            <td style="width: 7px;"></td>\n            <td style="text-align: right;"><div class="OpenPrice"></div></td>\n        </tr>\n        <tr>\n            <td>High:</td>\n            <td style="width: 7px;"></td>\n            <td style="text-align: right;"><div class="HighPrice"></div></td>\n        </tr>\n        <tr>\n            <td>Low:</td>\n            <td style="width: 7px;"></td>\n            <td style="text-align: right;"><div class="LowPrice"></div></td>\n        </tr>\n        <tr>\n            <td>Last:</td>\n            <td style="width: 7px;"></td>\n            <td style="text-align: right;"><div class="LastPrice"></div></td>\n        </tr>\n    </table>\n    \n    <div style="width: 100%;" class="IndicatorsDiv">\n        \n    </div>\n\n    <table>\n        <tr>\n            <td>Date (Bar Start):</td>\n            <td style="width: 7px;"></td>\n            <td style="text-align: right;"><div class="DateValue"></div></td>\n        </tr>\n    </table>\n\n</div>'},useData:!0}),Db.LevelDialog=Handlebars.template({1:function(e,t,i,a,n){var o,s=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,l="function",d=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <div class="levels-group">\n        <span class="gray-label">entry / point of control </span>\n        <span class="white-label">\n            '+d(typeof(o=null!=(o=e(i,"currentEntry")||(null!=t?e(t,"currentEntry"):t))?o:r)==l?o.call(s,{name:"currentEntry",hash:{},data:n,loc:{start:{line:18,column:12},end:{line:18,column:28}}}):o)+'\n        </span>\n        <a class="remove-list-entry" data-levelid="'+d(typeof(o=null!=(o=e(i,"currentEntryid")||(null!=t?e(t,"currentEntryid"):t))?o:r)==l?o.call(s,{name:"currentEntryid",hash:{},data:n,loc:{start:{line:20,column:51},end:{line:20,column:69}}}):o)+'" data-type="entry">\n            <span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span>\n        </a>\n    </div>\n'},3:function(e,t,i,a,n){var o=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,r="function",l=e.escapeExpression,d=e.hooks.blockHelperMissing,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]},l='    <div class="levels-group">\n        <div style="position: relative;">\n            <span class="gray-label">take profit / resistance </span>\n            <span class="white-label">\n                '+l(typeof(h=null!=(h=c(i,"profit0")||(null!=t?c(t,"profit0"):t))?h:s)==r?h.call(o,{name:"profit0",hash:{},data:n,loc:{start:{line:31,column:16},end:{line:31,column:27}}}):h)+'\n            </span>\n            <a class="remove-list-entry" data-levelid="'+l(typeof(h=null!=(h=c(i,"profit0id")||(null!=t?c(t,"profit0id"):t))?h:s)==r?h.call(o,{name:"profit0id",hash:{},data:n,loc:{start:{line:33,column:55},end:{line:33,column:68}}}):h)+'" data-type="profit">\n                <span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span>\n            </a>\n        </div>\n',h=null!=(h=c(i,"profit1")||(null!=t?c(t,"profit1"):t))?h:s,p={name:"profit1",hash:{},fn:e.program(4,n,0),inverse:e.noop,data:n,loc:{start:{line:37,column:8},end:{line:47,column:20}}},u=typeof h==r?h.call(o,p):h;return null!=(u=c(i,"profit1")?u:d.call(t,u,p))&&(l+=u),h=null!=(h=c(i,"profit2")||(null!=t?c(t,"profit2"):t))?h:s,p={name:"profit2",hash:{},fn:e.program(6,n,0),inverse:e.noop,data:n,loc:{start:{line:48,column:8},end:{line:58,column:20}}},u=typeof h==r?h.call(o,p):h,null!=(u=c(i,"profit2")?u:d.call(t,u,p))&&(l+=u),h=null!=(h=c(i,"profit3")||(null!=t?c(t,"profit3"):t))?h:s,p={name:"profit3",hash:{},fn:e.program(8,n,0),inverse:e.noop,data:n,loc:{start:{line:59,column:8},end:{line:69,column:20}}},u=typeof h==r?h.call(o,p):h,null!=(u=c(i,"profit3")?u:d.call(t,u,p))&&(l+=u),l+"    </div>\n"},4:function(e,t,i,a,n){var o,s=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,l="function",d=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <div style="position: relative; margin: 2px 0;">\n            <span class="gray-label">take profit / resistance </span>\n            <span class="white-label">\n                '+d(typeof(o=null!=(o=e(i,"profit1")||(null!=t?e(t,"profit1"):t))?o:r)==l?o.call(s,{name:"profit1",hash:{},data:n,loc:{start:{line:41,column:16},end:{line:41,column:27}}}):o)+'\n            </span>\n            <a class="remove-list-entry" data-levelid="'+d(typeof(o=null!=(o=e(i,"profit1id")||(null!=t?e(t,"profit1id"):t))?o:r)==l?o.call(s,{name:"profit1id",hash:{},data:n,loc:{start:{line:43,column:55},end:{line:43,column:68}}}):o)+'" data-type="profit">\n                <span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span>\n            </a>\n        </div>\n'},6:function(e,t,i,a,n){var o,s=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,l="function",d=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <div style="position: relative; margin: 2px 0;">\n            <span class="gray-label">take profit / resistance </span>\n            <span class="white-label">\n                '+d(typeof(o=null!=(o=e(i,"profit2")||(null!=t?e(t,"profit2"):t))?o:r)==l?o.call(s,{name:"profit2",hash:{},data:n,loc:{start:{line:52,column:16},end:{line:52,column:27}}}):o)+'\n            </span>\n            <a class="remove-list-entry" data-levelid="'+d(typeof(o=null!=(o=e(i,"profit2id")||(null!=t?e(t,"profit2id"):t))?o:r)==l?o.call(s,{name:"profit2id",hash:{},data:n,loc:{start:{line:54,column:55},end:{line:54,column:68}}}):o)+'" data-type="profit">\n                <span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span>\n            </a>\n        </div>\n'},8:function(e,t,i,a,n){var o,s=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,l="function",d=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <div style="position: relative; margin: 2px 0;">\n            <span class="gray-label">take profit / resistance </span>\n            <span class="white-label">\n                '+d(typeof(o=null!=(o=e(i,"profit3")||(null!=t?e(t,"profit3"):t))?o:r)==l?o.call(s,{name:"profit3",hash:{},data:n,loc:{start:{line:63,column:16},end:{line:63,column:27}}}):o)+'\n            </span>\n            <a class="remove-list-entry" data-levelid="'+d(typeof(o=null!=(o=e(i,"profit3id")||(null!=t?e(t,"profit3id"):t))?o:r)==l?o.call(s,{name:"profit3id",hash:{},data:n,loc:{start:{line:65,column:55},end:{line:65,column:68}}}):o)+'" data-type="profit">\n                <span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span>\n            </a>\n        </div>\n'},10:function(e,t,i,a,n){var o=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,r="function",l=e.escapeExpression,d=e.hooks.blockHelperMissing,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]},l='    <div class="levels-group">\n        <div style="position: relative;">\n            <span class="gray-label">stop loss / support </span>\n            <span class="white-label">\n                '+l(typeof(h=null!=(h=c(i,"stop0")||(null!=t?c(t,"stop0"):t))?h:s)==r?h.call(o,{name:"stop0",hash:{},data:n,loc:{start:{line:78,column:16},end:{line:78,column:25}}}):h)+'\n            </span>\n            <a class="remove-list-entry" data-levelid="'+l(typeof(h=null!=(h=c(i,"stop0id")||(null!=t?c(t,"stop0id"):t))?h:s)==r?h.call(o,{name:"stop0id",hash:{},data:n,loc:{start:{line:80,column:55},end:{line:80,column:66}}}):h)+'" data-type="stop">\n                <span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span>\n            </a>\n        </div>\n',h=null!=(h=c(i,"stop1")||(null!=t?c(t,"stop1"):t))?h:s,p={name:"stop1",hash:{},fn:e.program(11,n,0),inverse:e.noop,data:n,loc:{start:{line:84,column:8},end:{line:94,column:18}}},u=typeof h==r?h.call(o,p):h;return null!=(u=c(i,"stop1")?u:d.call(t,u,p))&&(l+=u),h=null!=(h=c(i,"stop2")||(null!=t?c(t,"stop2"):t))?h:s,p={name:"stop2",hash:{},fn:e.program(13,n,0),inverse:e.noop,data:n,loc:{start:{line:95,column:8},end:{line:105,column:18}}},u=typeof h==r?h.call(o,p):h,null!=(u=c(i,"stop2")?u:d.call(t,u,p))&&(l+=u),h=null!=(h=c(i,"stop3")||(null!=t?c(t,"stop3"):t))?h:s,p={name:"stop3",hash:{},fn:e.program(15,n,0),inverse:e.noop,data:n,loc:{start:{line:106,column:8},end:{line:116,column:18}}},u=typeof h==r?h.call(o,p):h,null!=(u=c(i,"stop3")?u:d.call(t,u,p))&&(l+=u),l+"    </div>\n"},11:function(e,t,i,a,n){var o,s=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,l="function",d=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <div style="position: relative; margin: 2px 0;">\n            <span class="gray-label">stop loss / support </span>\n            <span class="white-label">\n                '+d(typeof(o=null!=(o=e(i,"stop1")||(null!=t?e(t,"stop1"):t))?o:r)==l?o.call(s,{name:"stop1",hash:{},data:n,loc:{start:{line:88,column:16},end:{line:88,column:25}}}):o)+'\n            </span>\n            <a class="remove-list-entry" data-levelid="'+d(typeof(o=null!=(o=e(i,"stop1id")||(null!=t?e(t,"stop1id"):t))?o:r)==l?o.call(s,{name:"stop1id",hash:{},data:n,loc:{start:{line:90,column:55},end:{line:90,column:66}}}):o)+'" data-type="stop">\n                <span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span>\n            </a>\n        </div>\n'},13:function(e,t,i,a,n){var o,s=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,l="function",d=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <div style="position: relative; margin: 2px 0;">\n            <span class="gray-label">stop loss / support </span>\n            <span class="white-label">\n                '+d(typeof(o=null!=(o=e(i,"stop2")||(null!=t?e(t,"stop2"):t))?o:r)==l?o.call(s,{name:"stop2",hash:{},data:n,loc:{start:{line:99,column:16},end:{line:99,column:25}}}):o)+'\n            </span>\n            <a class="remove-list-entry" data-levelid="'+d(typeof(o=null!=(o=e(i,"stop2id")||(null!=t?e(t,"stop2id"):t))?o:r)==l?o.call(s,{name:"stop2id",hash:{},data:n,loc:{start:{line:101,column:55},end:{line:101,column:66}}}):o)+'" data-type="stop">\n                <span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span>\n            </a>\n        </div>\n'},15:function(e,t,i,a,n){var o,s=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,l="function",d=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <div style="position: relative; margin: 2px 0;">\n            <span class="gray-label">stop loss / support </span>\n            <span class="white-label">\n                '+d(typeof(o=null!=(o=e(i,"stop3")||(null!=t?e(t,"stop3"):t))?o:r)==l?o.call(s,{name:"stop3",hash:{},data:n,loc:{start:{line:110,column:16},end:{line:110,column:25}}}):o)+'\n            </span>\n            <a class="remove-list-entry" data-levelid="'+d(typeof(o=null!=(o=e(i,"stop3id")||(null!=t?e(t,"stop3id"):t))?o:r)==l?o.call(s,{name:"stop3id",hash:{},data:n,loc:{start:{line:112,column:55},end:{line:112,column:66}}}):o)+'" data-type="stop">\n                <span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span>\n            </a>\n        </div>\n'},compiler:[8,">= 4.3.0"],main:function(e,t,i,a,n){var o=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,r="function",l=e.hooks.blockHelperMissing,d=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]},h='<div class="charting IndicatorForm level-dialog">\n\n    <table style="margin: 7px auto;">\n        <tr>\n            <td style="padding-right: 7px; font-size: 14px; vertical-align: middle; text-align: center; width: 50%;">\n                Target:\n            </td>\n            <td>\n                <input class="level-input" style="max-width: 80px; text-align: right;">\n            </td>\n        </tr>\n    </table>\n\n',p=null!=(p=c(i,"currentEntry")||(null!=t?c(t,"currentEntry"):t))?p:s,u={name:"currentEntry",hash:{},fn:e.program(1,n,0),inverse:e.noop,data:n,loc:{start:{line:14,column:4},end:{line:24,column:21}}},m=typeof p==r?p.call(o,u):p;return null!=(m=c(i,"currentEntry")?m:l.call(t,m,u))&&(h+=m),h+="\n",p=null!=(p=c(i,"profit0")||(null!=t?c(t,"profit0"):t))?p:s,u={name:"profit0",hash:{},fn:e.program(3,n,0),inverse:e.noop,data:n,loc:{start:{line:26,column:4},end:{line:71,column:16}}},m=typeof p==r?p.call(o,u):p,null!=(m=c(i,"profit0")?m:l.call(t,m,u))&&(h+=m),h+="\n",p=null!=(p=c(i,"stop0")||(null!=t?c(t,"stop0"):t))?p:s,u={name:"stop0",hash:{},fn:e.program(10,n,0),inverse:e.noop,data:n,loc:{start:{line:73,column:4},end:{line:118,column:14}}},m=typeof p==r?p.call(o,u):p,null!=(m=c(i,"stop0")?m:l.call(t,m,u))&&(h+=m),h+'\n\n    <div class="level-radios">\n\n        <input type="radio" id="'+d(typeof(p=null!=(p=c(i,"r1")||(null!=t?c(t,"r1"):t))?p:s)==r?p.call(o,{name:"r1",hash:{},data:n,loc:{start:{line:123,column:32},end:{line:123,column:38}}}):p)+'" name="level" value="entry" />\n        <label for="'+d(typeof(p=null!=(p=c(i,"r1")||(null!=t?c(t,"r1"):t))?p:s)==r?p.call(o,{name:"r1",hash:{},data:n,loc:{start:{line:124,column:20},end:{line:124,column:26}}}):p)+'" style="margin: 7px;">entry / point of control</label>\n\n        <input type="radio" id="'+d(typeof(p=null!=(p=c(i,"r2")||(null!=t?c(t,"r2"):t))?p:s)==r?p.call(o,{name:"r2",hash:{},data:n,loc:{start:{line:126,column:32},end:{line:126,column:38}}}):p)+'" name="level" value="profit" />\n        <label for="'+d(typeof(p=null!=(p=c(i,"r2")||(null!=t?c(t,"r2"):t))?p:s)==r?p.call(o,{name:"r2",hash:{},data:n,loc:{start:{line:127,column:20},end:{line:127,column:26}}}):p)+'" style="margin: 7px;">take profit / resistance</label>\n\n        <input type="radio" id="'+d(typeof(p=null!=(p=c(i,"r3")||(null!=t?c(t,"r3"):t))?p:s)==r?p.call(o,{name:"r3",hash:{},data:n,loc:{start:{line:129,column:32},end:{line:129,column:38}}}):p)+'" name="level" value="stop" />\n        <label for="'+d(typeof(p=null!=(p=c(i,"r3")||(null!=t?c(t,"r3"):t))?p:s)==r?p.call(o,{name:"r3",hash:{},data:n,loc:{start:{line:130,column:20},end:{line:130,column:26}}}):p)+'" style="margin: 7px;">stop loss / support</label>\n\n    </div>\n\n</div>\n'},useData:!0}),Db.SaveDialog=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,a,n){return'<div style="width: 100%; text-align: center; height: 100%; position: relative; overflow: hidden;">\n    \n    <div class="img-loading" style="font-size: 1.2em; position: absolute; top: 0; text-align: center; width: 100%; height: 100%; display: none;">\n        <div style="position: absolute; text-align: center; left: 0; right: 0; top: 50%;">\n            Loading\n        </div>\n    </div>\n    \n    <div class="save-header" style="font-size: 1.2em;">\n        <div style="text-align: left; padding-bottom: 5px;">\n            <span style="margin: 5px 1% 1% 0; white-space: nowrap;">\n                Width:\n                <select class="chart-width-select">\n                    <option value="360">360px</option>\n                    <option value="460">460px</option>\n                    <option value="520">520px</option>\n                    <option value="620">620px</option>\n                    <option value="780">780px</option>\n                    <option value="900">900px</option>\n                    <option value="1024" selected="selected">1024px</option>\n                    <option value="1280">1280px</option>\n                    <option value="1600">1600px</option>\n                </select>\n            </span>\n        \n            <span class="chart-theme-section" style="margin: 5px 1% 1% 0; white-space: nowrap;">\n                Theme:\n                <select class="chart-theme-select"></select>\n            </span>\n            \n            <a class="download-button" download="chart.png" style="margin: 5px 1% 1% 0; display: none;">Download</a>\n        </div>\n    \n        <div class="download-instructions" style="height: 25px;">\n            To save chart, right-click on image and \'Save Image As...\'\n        </div>\n    </div>\n\n    <div class="img-wrapper" style="position: absolute; left: 0; right: 0; top: 25px; bottom: 0; display: block; overflow: auto;">\n        <img class="chart-image" style="display: block;" />\n    </div>\n</div>\n'},useData:!0}),Db.SeriesForm=Handlebars.template({1:function(e,t,i,a,n){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]},s="",r=null!=(r=o(i,"displaySeries")||(null!=t?o(t,"displaySeries"):t))?r:e.hooks.helperMissing,n={name:"displaySeries",hash:{},fn:e.program(2,n,0),inverse:e.noop,data:n,loc:{start:{line:4,column:4},end:{line:32,column:22}}},r="function"==typeof r?r.call(null!=t?t:e.nullContext||{},n):r;return null!=(r=o(i,"displaySeries")?r:e.hooks.blockHelperMissing.call(t,r,n))&&(s+=r),s},2:function(e,t,i,a,n){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]},s="",r=null!=(r=o(i,"attributes")||(null!=t?o(t,"attributes"):t))?r:e.hooks.helperMissing,n={name:"attributes",hash:{},fn:e.program(3,n,0),inverse:e.noop,data:n,loc:{start:{line:5,column:8},end:{line:31,column:19}}},r="function"==typeof r?r.call(null!=t?t:e.nullContext||{},n):r;return null!=(r=o(i,"attributes")?r:e.hooks.blockHelperMissing.call(t,r,n))&&(s+=r),s},3:function(e,t,i,a,n){var o,s=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,l="function",d=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <tr>\n            <td>\n                Color:\n            </td>\n            <td>\n        <div style="float: right; margin: 3px;">\n            <input name="color"\n                   style="width: 0; display: none;"\n                   class="strokeColor colorPicker evo-cp0"\n                   data-indicator-discrete-id="ugh"\n                   data-init-color="'+d(typeof(o=null!=(o=e(i,"displayColor")||(null!=t?e(t,"displayColor"):t))?o:r)==l?o.call(s,{name:"displayColor",hash:{},data:n,loc:{start:{line:16,column:36},end:{line:16,column:52}}}):o)+'"\n                />\n        </div>\n                \n            </td>\n        </tr>\n        <tr>\n            <td>\n                Thickness:\n            </td>\n            <td style="text-align: right;">\n                <input name="thickness" value="'+d(typeof(o=null!=(o=e(i,"lineThickness")||(null!=t?e(t,"lineThickness"):t))?o:r)==l?o.call(s,{name:"lineThickness",hash:{},data:n,loc:{start:{line:27,column:47},end:{line:27,column:64}}}):o)+'"\n                       data-indicator-discrete-id="'+d(typeof(o=null!=(o=e(i,"discreteIndicatorID")||(null!=t?e(t,"discreteIndicatorID"):t))?o:r)==l?o.call(s,{name:"discreteIndicatorID",hash:{},data:n,loc:{start:{line:28,column:51},end:{line:28,column:74}}}):o)+'"/>\n            </td>\n        </tr>\n'},compiler:[8,">= 4.3.0"],main:function(e,t,i,a,n){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]},s='<div class="charting SeriesForm" style="width: auto;">\n    <table>\n',r=null!=(r=o(i,"series")||(null!=t?o(t,"series"):t))?r:e.hooks.helperMissing,n={name:"series",hash:{},fn:e.program(1,n,0),inverse:e.noop,data:n,loc:{start:{line:3,column:4},end:{line:33,column:15}}},r="function"==typeof r?r.call(null!=t?t:e.nullContext||{},n):r;return null!=(r=o(i,"series")?r:e.hooks.blockHelperMissing.call(t,r,n))&&(s+=r),s+"        </table>\n</div>"},useData:!0}),Db.SeriesToolbar=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,a,n){return'<div class="RootDiv SeriesToolbar" style="position: relative; width: 100%; height: 100%;">\n    \n</div>'},useData:!0}),Db.SettingsContextMenu=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,a,n){return'<div class="charting context-menu ui-widget ui-widget-content ui-corner-all">\n    <ul id="menu-left" class="context-menu-column">\n\n        <li class="notCompact not-indicator-menu-item settings-btn"><a href="#">settings</a></li>\n        <li class="paste-btn" style="display: none;"><a href="#paste">paste</a></li>\n        <li class="remove-all-btn" style="display: none;"><a href="#delete">remove all</a></li>\n        <li class="remove-indicator-button remove-indicator-btn" style="display: none;"><a href="#">remove indicator</a></li>\n    </ul>\n</div>'},useData:!0}),Db.TimeSlider=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,a,n){return'\n<div>\n    <div class="topScroll" style="position: absolute; left: 0; top: 0;">\n    </div>\n\n    <div class="bottomScroll" style="position: absolute; left: 0; bottom: 0;">\n    </div>\n\n    <div class="centerBox"></div>\n    <div class="leftBox"></div>\n    <div class="rightBox"></div>\n\n    <div class="datesBox" style="position: absolute; left: 0; top: 0; overflow: hidden; background-color: transparent;"></div>\n\n    <button class="LeftArrow" type="button" style="position: absolute; left: 1px; bottom: -1px; z-index: 13;"></button>\n\n    <button class="RightArrow" type="button" style="position: absolute; right: 16px; bottom: -1px; z-index: 13;"></button>\n</div>'},useData:!0}),Db.VerticalAxis=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,a,n){return'<div class="TextsDiv VerticalTextsDiv" style="position: absolute; top: 0; left: 0;"></div>\n<canvas class="vertical-axis-canvas" style="position: absolute; top: 0; left: -3px;" />'},useData:!0}),Db.VisualSettings=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,a,n){return'<div class="visual-settings">\n    \n    <table>\n        <tr>\n            <td>Theme</td>\n            <td style="width: 40px;"></td>\n            <td>Data Points</td>\n        </tr>\n        <tr>\n            <td style="vertical-align: top;">\n                <table style="width: 100%;" class="settings-section">\n                    <tr>\n                        <td style="font-weight: bold; padding-top: 0em;">Chart Background:</td>\n                        <td></td>\n                    </tr>\n                    <tr>\n                        <td>Main Color</td>\n                        <td style="float: right;">\n                            <input name="color"\n                                   style="width: 0; display: none;"\n                                   class="strokeColor colorPicker evo-cp0"\n                                   data-property-name="chartDisplayAreaBackground"\n                                />\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>Alternative Color</td>\n                        <td style="float: right;">\n                            <input name="color"\n                                   style="width: 0; display: none;"\n                                   class="strokeColor colorPicker evo-cp0"\n                                   data-property-name="chartDisplayAreaAlternativeBackground"\n                                />\n                        </td>\n                    </tr>\n                </table>\n            </td>\n            <td></td>\n            <td style="vertical-align: top;">\n                <table style="width: 100%;" class="settings-section">\n                    <tr>\n                        <td style="font-weight: bold; padding-top: 0em;">Line:</td>\n                        <td></td>\n                    </tr>\n                    <tr>\n                        <td>Up</td>\n                        <td style="float: right;">\n                            <input name="color"\n                                   style="width: 0; display: none;"\n                                   class="strokeColor colorPicker evo-cp0"\n                                   data-property-name="chartDisplayAreaLineUpColor"\n                                />\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>Down</td>\n                        <td style="float: right;">\n                            <input name="color"\n                                   style="width: 0; display: none;"\n                                   class="strokeColor colorPicker evo-cp0"\n                                   data-property-name="chartDisplayAreaLineDownColor"\n                                />\n                        </td>\n                    </tr>\n                </table>\n            </td>\n            <td></td>\n        </tr>\n        <tr>\n            <td style="vertical-align: top;">\n                <table style="width: 100%;" class="settings-section">\n                    <tr>\n                        <td style="font-weight: bold; padding-top: 0em;">Grid Lines:</td>\n                        <td></td>\n                    </tr>\n                    <tr>\n                        <td>Visibility</td>\n                        <td style="float: right;">\n                            <select class="grid-lines-visibility">\n                                <option value="both" selected="selected">Both</option>\n                                <option value="horizontal">Horizontal</option>\n                                <option value="vertical">Vertical</option>\n                                <option value="none">None</option>\n                            </select>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>Color</td>\n                        <td style="float: right;">\n                            <input name="color"\n                                   style="width: 0; display: none;"\n                                   class="strokeColor colorPicker evo-cp0"\n                                   data-property-name="grid-lines-color"\n                                />\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>Line Type</td>\n                        <td style="float: right;">\n                            <select class="grid-line-type">\n                                <option value="line">Line</option>\n                                <option value="dashes">Dashes</option>\n                                <option value="dots">Dots</option>\n                            </select>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>Opacity</td>\n                        <td>\n                            <div class="grid-lines-opacity-slider" style="margin-top: 3px;"></div>\n                        </td>\n                    </tr>\n                </table>\n            </td>\n            <td></td>\n            <td style="vertical-align: top;">\n                <table style="width: 100%;" class="settings-section">\n                    <tr>\n                        <td style="font-weight: bold; padding-top: 0em;">Candle Stick:</td>\n                        <td></td>\n                    </tr>\n                    <tr>\n                        <td>Up Border</td>\n                        <td style="float: right;">\n                            <input name="color"\n                                   style="width: 0; display: none;"\n                                   class="strokeColor colorPicker evo-cp0"\n                                   data-property-name="chartDisplayAreaCandleStickUpStroke"\n                                />\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>\n                            Up Fill \n                            <input name="candle-stick-up-hollow" type="checkbox"/>\n                        </td>\n                        <td style="float: right;">\n                            <input name="color"\n                                   style="width: 0; display: none;"\n                                   class="strokeColor colorPicker evo-cp0"\n                                   data-property-name="chartDisplayAreaCandleStickUpFill"\n                                />\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>Down Border</td>\n                        <td style="float: right;">\n                            <input name="color"\n                                   style="width: 0; display: none;"\n                                   class="strokeColor colorPicker evo-cp0"\n                                   data-property-name="chartDisplayAreaCandleStickDownStroke"\n                                />\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>Down Fill</td>\n                        <td style="float: right;">\n                            <input name="color"\n                                   style="width: 0; display: none;"\n                                   class="strokeColor colorPicker evo-cp0"\n                                   data-property-name="chartDisplayAreaCandleStickDownFill"\n                                />\n                        </td>\n                    </tr>\n                </table>\n            </td>\n            <td></td>\n        </tr>\n        <tr>\n            <td style="vertical-align: top;">\n                <table style="width: 100%;" class="settings-section">\n                    <tr>\n                        <td style="font-weight: bold; padding-top: 0em;">Axis Labels:</td>\n                        <td></td>\n                    </tr>\n                    <tr>\n                        <td>Minor Color</td>\n                        <td style="float: right;">\n                            <input name="color"\n                                   style="width: 0; display: none;"\n                                   class="strokeColor colorPicker evo-cp0"\n                                   data-property-name="axisTextMinor"\n                                />\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>Major Color</td>\n                        <td style="float: right;">\n                            <input name="color"\n                                   style="width: 0; display: none;"\n                                   class="strokeColor colorPicker evo-cp0"\n                                   data-property-name="axisTextMajor"\n                                />\n                        </td>\n                    </tr>\n                </table>\n            </td>\n            <td></td>\n            <td style="vertical-align: top;">\n                <table style="width: 100%;" class="settings-section">\n                    <tr>\n                        <td style="font-weight: bold; padding-top: 0em;">Bars:</td>\n                        <td></td>\n                    </tr>\n                    <tr>\n                        <td>Up</td>\n                        <td style="float: right;">\n                            <input name="color"\n                                   style="width: 0; display: none;"\n                                   class="strokeColor colorPicker evo-cp0"\n                                   data-property-name="chartDisplayAreaBarUpColor"\n                                />\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>Down</td>\n                        <td style="float: right;">\n                            <input name="color"\n                                   style="width: 0; display: none;"\n                                   class="strokeColor colorPicker evo-cp0"\n                                   data-property-name="chartDisplayAreaBarDownColor"\n                                />\n                        </td>\n                    </tr>\n                </table>\n            </td>\n            <td></td>\n        </tr>\n        <tr>\n            <td style="vertical-align: top;">\n                <table style="width: 100%;" class="settings-section">\n                    <tr>\n                        <td style="font-weight: bold; padding-top: 0em;">Axis Highlight:</td>\n                        <td></td>\n                    </tr>\n                    <tr>\n                        <td>Background</td>\n                        <td style="float: right;">\n                            <input name="color"\n                                   style="width: 0; display: none;"\n                                   class="strokeColor colorPicker evo-cp0"\n                                   data-property-name="selectedBackground"\n                                />\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>Text</td>\n                        <td style="float: right;">\n                            <input name="color"\n                                   style="width: 0; display: none;"\n                                   class="strokeColor colorPicker evo-cp0"\n                                   data-property-name="selectedForeground"\n                                />\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>Crosshair</td>\n                        <td style="float: right;">\n                            <input name="color"\n                                   style="width: 0; display: none;"\n                                   class="strokeColor colorPicker evo-cp0"\n                                   data-property-name="crosshairColor"\n                                />\n                        </td>\n                    </tr>\n                </table>\n            </td>\n            <td></td>\n            <td style="vertical-align: top;">\n                <table style="width: 100%;" class="settings-section">\n                    <tr>\n                        <td style="font-weight: bold; padding-top: 0em;">Kagi:</td>\n                        <td></td>\n                    </tr>\n                    <tr>\n                        <td>Up</td>\n                        <td style="float: right;">\n                            <input name="color"\n                                   style="width: 0; display: none;"\n                                   class="strokeColor colorPicker evo-cp0"\n                                   data-property-name="chartDisplayAreaKagiUpColor"\n                                />\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>Down</td>\n                        <td style="float: right;">\n                            <input name="color"\n                                   style="width: 0; display: none;"\n                                   class="strokeColor colorPicker evo-cp0"\n                                   data-property-name="chartDisplayAreaKagiDownColor"\n                                />\n                        </td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n        <tr>\n            <td class="axis-font-size-section "style="vertical-align: top;">\n                <table style="width: 100%;" class="settings-section">\n                    <tr>\n                        <td style="font-weight: bold; padding-top: 0em;">Axis Font Size:</td>\n                        <td style="width: 50px;"></td>\n                    </tr>\n                    <tr>\n                        <td>Horizontal</td>\n                        <td>\n                            <div class="axis-font-size-horizontal-slider" style="margin-top: 3px;"></div>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>Vertical</td>\n                        <td>\n                            <div class="axis-font-size-vertical-slider" style="margin-top: 3px;"></div>\n                        </td>\n                    </tr>\n                </table>\n            </td>\n            <td></td>\n            <td class="chart-dimensions-section" style="vertical-align: top;">\n                <table style="width: 100%;" class="settings-section">\n                    <tr>\n                        <td style="font-weight: bold; padding-top: 0em;">Chart Dimensions:</td>\n                        <td></td>\n                    </tr>\n                    <tr>\n                        <td>Type</td>\n                        <td style="float: right;">\n                            <select class="chart-dimensions-type">\n                                <option value="fit" selected="selected">Fit to Window</option>\n                                <option value="set-width">Set width</option>\n                                <option value="custom">Custom</option>\n                            </select>\n                        </td>\n                    </tr>\n                    <tr class="chart-dimensions-set-width-row">\n                        <td>Width</td>\n                        <td style="float: right;">\n                            <select class="chart-width-select">\n                                <option value="360">360px</option>\n                                <option value="460">460px</option>\n                                <option value="520">520px</option>\n                                <option value="620">620px</option>\n                                <option value="780">780px</option>\n                                <option value="900">900px</option>\n                                <option value="1024">1024px</option>\n                                <option value="1280">1280px</option>\n                                <option value="1600">1600px</option>\n                            </select>\n                        </td>\n                    </tr>\n                    <tr class="chart-dimensions-custom-row">\n                        <td>Width</td>\n                        <td style="float: right;">\n                            <input name="custom-width" style="width: 50px;"/>\n                        </td>\n                    </tr>\n                    <tr class="chart-dimensions-custom-row">\n                        <td>Height</td>\n                        <td style="float: right;">\n                            <input name="custom-height" style="width: 50px;"/>\n                        </td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n    </table>\n    \n    <div>\n        <input type="button" name="default" value="DEFAULT"/>\n        <input type="button" name="ok" value="OK" style="float: right;"/>\n    </div>\n\n</div>'},useData:!0}),Db.app=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,a,n){return'<div class="charting ChartRoot" style="height: 100%; width: 100%; position: relative;">\n    <div class="ChartToolbar toolbar" style="position: absolute; left: 0; top: 0; width: 100%; z-index: 3;"></div>\n    <div class="ChartDiv" style="position: absolute; left: 0; top: 0; right: 0; z-index: 1; overflow: hidden;"></div>\n    <div class="disclaimer">Disclaimer: Mid price chart data is indicative only.</div>\n\n    <div class="no-data" style="display: table; width: 100%; height: 100%; opacity: 0.9;">\n        <div style="display: table-cell; width: 100%; height: 100%; vertical-align: middle; text-align: center;">\n            <span class="no-data-text">\n                There is no data available for the selected instrument. Please contact technical support for further information.\n            </span>\n        </div>\n    </div>\n\n</div>\n'},useData:!0}),Db.indicatorListItem=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,a,n){var o,s=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,l="function",d=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<li>\n    <label>\n        <span class='indicatorListName'>"+d(typeof(o=null!=(o=e(i,"IndicatorName")||(null!=t?e(t,"IndicatorName"):t))?o:r)==l?o.call(s,{name:"IndicatorName",hash:{},data:n,loc:{start:{line:3,column:40},end:{line:3,column:57}}}):o)+"</span>\n        <input type='checkbox' name='customIndicator' value='"+d(typeof(o=null!=(o=e(i,"IndicatorCode")||(null!=t?e(t,"IndicatorCode"):t))?o:r)==l?o.call(s,{name:"IndicatorCode",hash:{},data:n,loc:{start:{line:4,column:61},end:{line:4,column:78}}}):o)+"' "+d(typeof(o=null!=(o=e(i,"listItemChecked")||(null!=t?e(t,"listItemChecked"):t))?o:r)==l?o.call(s,{name:"listItemChecked",hash:{},data:n,loc:{start:{line:4,column:80},end:{line:4,column:99}}}):o)+" />\n        <span class='indicatorCheckbox'></span>\n    </label>\n</li>"},useData:!0}),Db);function Db(){}var AnnotationEditForm=(x5=Backbone.View,__extends(y5,x5),y5.prototype.applyTemplate=function(){var e=this;switch($(this.el).html(T.AnnotationEditForm({ExtendFutureLabel:"vertical-line"===this.annotation.drawTool.tool?"Down":"Future",ExtendPastLabel:"vertical-line"===this.annotation.drawTool.tool?"Up":"Past",Options:this.annotation.drawTool.options})),this.$options=this.$el.find(".options"),this.$options.hide(),this.annotation.drawTool.tool){case"trend-line":case"horizontal-line":case"vertical-line":this.$el.find(".shape").detach(),this.$el.find(".text").detach(),this.$el.find(".advanced").detach(),this.arrangeLine();break;case"ellipse":case"rectangle":case"rotation-rectangle":this.$el.find(".line").detach(),this.$el.find(".text").detach(),this.$el.find(".advanced").detach(),this.arrangeShape();break;case"text-note":this.$el.find(".line").detach(),this.$el.find(".advanced").detach(),this.arrangeText(),this.arrangeShape();break;case"gann-box":case"fibonacci-fan":case"andrews-pitchfork":case"fibonacci-time-zones":case"fibonacci-arcs":case"dinapoli":this.$el.find(".line").detach(),this.$el.find(".shape").detach(),this.$el.find(".text").detach(),this.arrangeLine();break;case"fibonacci-retracements":case"gann-fan":this.$el.find(".line").detach(),this.$el.find(".shape").detach(),this.$el.find(".text").detach(),this.arrangeLine(),this.arrangeOptions();break;default:throw"annotation not supported"}this.$el.find('input[name="ok"]').button().on("click",function(){$(e).trigger("close")}),this.$el.find('input[name="remove"]').button().on("click",function(){$(e).trigger("close"),$(e).trigger("remove")}),this.$el.find(".ui-spinner").addClass("text-box")},y5.prototype.arrangeLine=function(){var i,a=this,e=(this.lineThickness=this.$el.find(".line-thickness").spinner({max:5,min:1,spin:function(e,t){a.annotation.drawTool.lineThickness=t.value,$(a).trigger("change")}}),this.lineThickness.spinner("value",this.annotation.drawTool.lineThickness),this.lineColorPicker=this.$el.find("input[name=line-color]"),$(this.lineColorPicker).colorpicker({displayIndicator:!1,color:this.annotation.drawTool.lineColorDef}),$(this.lineColorPicker).on("change.color",function(e,t){a.annotation.drawTool.lineColorDef=t,i=Helpers.hexToRgb(t),a.annotation.drawTool.lineColor="rgba("+i.r+","+i.g+","+i.b+","+a.annotation.drawTool.lineOpacity/100+")",$(a).trigger("change")}),this.linesOpacitySlider=this.$el.find(".line-opacity-slider"),$(this.linesOpacitySlider).slider({min:1,max:100,step:1,value:this.annotation.drawTool.lineOpacity,slide:function(e,t){a.annotation.drawTool.lineOpacity=t.value,i=Helpers.hexToRgb(a.annotation.drawTool.lineColorDef),a.annotation.drawTool.lineColor="rgba("+i.r+","+i.g+","+i.b+","+a.annotation.drawTool.lineOpacity/100+")",$(a).trigger("change")}}),this.annotation.drawTool.lineType?this.annotation.drawTool.lineType[1]:0);this.lineTypeSelect=this.$el.find(".line-type"),0===e?this.lineTypeSelect.find('option[value="line"]').prop("selected","selected"):3===e?this.lineTypeSelect.find('option[value="dots"]').prop("selected","selected"):5===e&&this.lineTypeSelect.find('option[value="dashes"]').prop("selected","selected"),$(this.lineTypeSelect).on("change",function(){switch(a.lineTypeSelect.prop("value")){case"line":a.annotation.drawTool.lineType=null;break;case"dashes":a.annotation.drawTool.lineType=[5,5];break;case"dots":a.annotation.drawTool.lineType=[2,3]}$(a).trigger("change")}),this.lineExtend=this.$el.find(".extend-line"),this.lineExtendFuture=this.lineExtend.find("input[value=future]"),this.lineExtendPast=this.lineExtend.find("input[value=past]"),this.annotation.extendFuture&&this.lineExtendFuture.prop("checked",!0),this.annotation.extendPast&&this.lineExtendPast.prop("checked",!0),this.lineExtendFuture.change(function(){a.annotation.extendFuture=!a.annotation.extendFuture,$(a).trigger("change")}),this.lineExtendPast.change(function(){a.annotation.extendPast=!a.annotation.extendPast,$(a).trigger("change")})},y5.prototype.arrangeOptions=function(){var t=this;this.$options.show(),_.each(this.annotation.drawTool.options,function(e){t.$options.find("input[name="+e.name+"]").change(function(){e.selected=!e.selected,$(t).trigger("change")})})},y5.prototype.arrangeShape=function(){var i,a=this;this.borderThickness=this.$el.find(".border-thickness").spinner({max:5,min:1,spin:function(e,t){a.annotation.drawTool.lineThickness=t.value,$(a).trigger("change")}}),this.borderThickness.spinner("value",this.annotation.drawTool.lineThickness),this.borderColorPicker=this.$el.find("input[name=border-color]"),$(this.borderColorPicker).colorpicker({displayIndicator:!1,color:this.annotation.drawTool.lineColorDef}),$(this.borderColorPicker).on("change.color",function(e,t){a.annotation.drawTool.lineColorDef=t,i=Helpers.hexToRgb(t),a.annotation.drawTool.lineColor="rgba("+i.r+","+i.g+","+i.b+","+a.annotation.drawTool.lineOpacity/100+")",$(a).trigger("change")}),this.borderOpacitySlider=this.$el.find(".border-opacity-slider"),$(this.borderOpacitySlider).slider({min:1,max:100,step:1,value:this.annotation.drawTool.lineOpacity,slide:function(e,t){a.annotation.drawTool.lineOpacity=t.value,i=Helpers.hexToRgb(a.annotation.drawTool.lineColorDef),a.annotation.drawTool.lineColor="rgba("+i.r+","+i.g+","+i.b+","+a.annotation.drawTool.lineOpacity/100+")",$(a).trigger("change")}}),this.fillColorPicker=this.$el.find("input[name=fill-color]"),$(this.fillColorPicker).colorpicker({displayIndicator:!1,color:this.annotation.drawTool.fillColorDef}),$(this.fillColorPicker).on("change.color",function(e,t){a.annotation.drawTool.fillColorDef=t,i=Helpers.hexToRgb(t),a.annotation.drawTool.fillColor="rgba("+i.r+","+i.g+","+i.b+","+a.annotation.drawTool.fillOpacity/100+")",$(a).trigger("change")}),this.fillOpacitySlider=this.$el.find(".fill-opacity-slider"),$(this.fillOpacitySlider).slider({min:1,max:100,step:1,value:this.annotation.drawTool.fillOpacity,slide:function(e,t){a.annotation.drawTool.fillOpacity=t.value,i=Helpers.hexToRgb(a.annotation.drawTool.fillColorDef),a.annotation.drawTool.fillColor="rgba("+i.r+","+i.g+","+i.b+","+a.annotation.drawTool.fillOpacity/100+")",$(a).trigger("change")}})},y5.prototype.arrangeText=function(){var i=this;this.textMargin=this.$el.find(".text-margin").spinner({max:50,min:0,spin:function(e,t){i.annotation.drawTool.textMargin=t.value,$(i).trigger("change")}}),this.textMargin.spinner("value",this.annotation.drawTool.textMargin),this.textSize=this.$el.find(".text-size").spinner({max:50,min:0,spin:function(e,t){i.annotation.drawTool.textSize=t.value,$(i).trigger("change")}}),this.textSize.spinner("value",this.annotation.drawTool.textSize),this.textColor=this.$el.find("input[name=text-color]"),$(this.textColor).colorpicker({displayIndicator:!1,color:this.annotation.drawTool.textColor}),$(this.textColor).on("change.color",function(e,t){i.annotation.drawTool.textColor=t,$(i).trigger("change")}),this.text=this.$el.find(".note-text"),$(this.text).val(this.annotation.text),$(this.text).on("change",function(e){i.annotation.text=$(e.target).prop("value"),$(i).trigger("change")})},y5.prototype.initialize2=function(e){var t=this;this.options=e,this.annotation=e.annotation,this.colorPickers=[],this.applyTemplate(),this.originalDrawTool=$.extend(!0,{},this.annotation.drawTool),this.$el.on("dialogclose",function(e){e.originalEvent&&$(e.originalEvent.target).closest(".ui-dialog-titlebar-close").length&&(t.annotation.drawTool=t.originalDrawTool,$(t).trigger("change"))})},y5),x5;function y5(e){var t=x5.call(this)||this;return t.colorPickers=[],t.initialize2(e),t}var AnnotationContextMenu=(jg=Backbone.View,__extends(kg,jg),kg.prototype.show=function(e){var a,o=this,t=this.model.get("currentTheme"),i=this.model.get("supportedThemes"),n=this.$el.find(".context-menu");_.each(i,function(e){n.removeClass(e)}),n.addClass(t),this.$el.appendTo($("body")),this.contextMenu.css({left:e.pageX+"px",top:e.pageY+"px"}),$(this.$el.find("#menu")).menu({select:function(e,t){e.stopPropagation();t=t.item;if("delete"===t.text())$(o).trigger("delete");else if("edit"===t.text()){if(o.annotationsManager.openDialog)return o.annotationsManager.openDialog.$el.parent().toggleClass("flash",!1),void _.defer(function(){o.annotationsManager.openDialog.$el.parent().toggleClass("flash",!0)});var i=new AnnotationEditForm({annotation:o.annotation});(o.annotationsManager.openDialog=i).$el.dialog({dialogClass:"charting "+o.model.get("currentTheme"),title:"Edit",resizable:!1,width:"auto",open:function(e){$(e.target).css("overflow","visible"),a=$(e.target).parent(),o.model.changeThemeClassForElementWhenThemeChanges(a)},close:function(){o.annotationsManager.openDialog=null,i.$el.dialog("destroy"),o.annotationsManager.updateAnnotationsStorage()}}),$(i).on("change",function(){$(o).trigger("change")}),$(i).on("remove",function(){$(o).trigger("delete")}),$(i).on("close",function(){$(i.$el).dialog("close")})}else"copy"===t.text()&&$(o).trigger("copy",{type:"copy",item:$.extend({},o.annotation)});e.preventDefault(),o.$el.detach()}}),$(document).on("mouseup",function(e){var t=parseFloat(o.contextMenu.css("left")),i=t+o.contextMenu.width(),a=parseFloat(o.contextMenu.css("top")),n=a+o.contextMenu.height();(e.pageX<t||e.pageX>i||e.pageY<a||e.pageY>n)&&o.$el.detach()})},kg),jg;function kg(e){var t=jg.call(this,e)||this;return t.options=e,t.annotation=e.annotation,t.annotationsManager=e.annotationsManager,t.$el.html(T.AnnotationContextMenu()),t.contextMenu=t.$el.find(".context-menu"),t}var AnnotationsManager=(Eg.prototype.addAnnotation=function(e,t){var i,a,n=this,o=(void 0===t&&(t=!1),$(this.displayArea.$mainCanvas[0]).offset()),s=(e.drawStartPoint.selectedIndex-this.displayArea.displayFromIndex)*this.displayArea.xRatio,r=e.drawStartPoint.x-(s+o.left);return e.drawStartPoint.xAddOn=r/this.displayArea.xRatio,s=(e.drawEndPoint.selectedIndex-this.displayArea.displayFromIndex)*this.displayArea.xRatio,r=e.drawEndPoint.x-(s+o.left),e.drawEndPoint.xAddOn=r/this.displayArea.xRatio,i=e.drawStartPoint.selectedItem.get("quoteDate"),a=Helpers.getNextDate(i,this.model.get("granularity")),i=i.getTime(),a=a.getTime(),e.drawStartTime=i+(a-i)*e.drawStartPoint.xAddOn,i=e.drawEndPoint.selectedItem.get("quoteDate"),a=Helpers.getNextDate(i,this.model.get("granularity")),i=i.getTime(),a=a.getTime(),e.drawEndTime=i+(a-i)*e.drawEndPoint.xAddOn,"text-note"===e.drawTool.tool&&_.each(e.notePoints,function(e){s=(e.selectedIndex-n.displayArea.displayFromIndex)*n.displayArea.xRatio,r=e.x-(s+o.left),e.xAddOn=r/n.displayArea.xRatio,i=e.selectedItem.get("quoteDate"),a=Helpers.getNextDate(i,n.model.get("granularity")),i=i.getTime(),a=a.getTime(),e.drawTime=i+(a-i)*e.xAddOn}),this.allAnnotations.push(e),this.filteredAnnotations.push(e),t||this.updateAnnotationsStorage(),e},Eg.prototype.addLevel=function(e,t){var i,a,n,o,s=this,r={};if(r.value=e,r.type=t,this.onLevelAdded(r)){switch(r.type){case"entry":n=this.model.get("levelColorHexEntry"),a="rgba("+(o=Helpers.hexToRgb(n)).r+","+o.g+","+o.b+",1)";break;case"profit":n=this.model.get("levelColorHexProfit"),a="rgba("+(o=Helpers.hexToRgb(n)).r+","+o.g+","+o.b+",1)";break;case"stop":n=this.model.get("levelColorHexStop"),a="rgba("+(o=Helpers.hexToRgb(n)).r+","+o.g+","+o.b+",1)"}for(var t={tool:"horizontal-line",lineThickness:1,lineColor:a,lineColorDef:n,lineOpacity:100,fillColor:a,fillColorDef:n,fillOpacity:100,textMargin:7,textSize:12},l={x:this.displayArea.allSeries[0].get("elements")[this.displayArea.displayFromIndex].bounds.right,y:this.displayArea.getValuePosition(e),selectedItem:this.displayArea.allSeries[0].get("elements")[this.displayArea.displayFromIndex],selectedIndex:this.displayArea.displayFromIndex,selectedPrice:e},d=void 0,c=this.displayArea.allSeries[0].get("elements").length-1;0<=c&&!(d=this.displayArea.allSeries[0].get("elements")[c]).bounds;--c);i={x:d.bounds.left,y:this.displayArea.getValuePosition(e),selectedItem:d,selectedIndex:this.displayArea.displayToIndex,selectedPrice:e},r.annotation=t={extendFuture:!0,extendPast:!0,drawTool:t,drawStartPoint:l,drawEndPoint:i,maxPrice:e,minPrice:e,extendedChildren:[],extendedChartAreas:[],onRemoved:function(e){return s.onLevelRemoved(e)},onChanged:function(){return s.onLevelChanged()},removeVisual:function(e,t){return s.removeAnnotation(e,t)},level:r},this.addAnnotation(t),this.displayArea.updateDisplay()}},Eg.prototype.applyAnnotationsStorage=function(){var t,r=this;if(this.enableSave){if(!this.model.get("savedAnnotations"))return this.clearAnnotationsForced(!0),void this.displayArea.onResize();try{t=JSON.parse(this.model.get("savedAnnotations"))}catch(e){console.log("Annotations string is in wrong format."),t=null}_.each(t,function(e){for(var t,i,a=e.drawStartPoint.selectedItemQuoteDate,n=e.drawEndPoint.selectedItemQuoteDate,o=0;o<r.displayArea.allSeries[0].get("elements").length;o+=1){var s=r.displayArea.allSeries[0].get("elements")[o];a>=s.get("quoteDate").valueOf()&&!t?(e.drawStartPoint.selectedIndex=s.get("index"),e.drawStartPoint.selectedItem=s):t=!0,n>=s.get("quoteDate").valueOf()&&!i?(e.drawEndPoint.selectedIndex=s.get("index"),e.drawEndPoint.selectedItem=s):i=!0,e.notePoints&&_.each(e.notePoints,function(e){for(var t,i=e.selectedItemQuoteDate,a=0;a<r.displayArea.allSeries[0].get("elements").length;a+=1){var n=r.displayArea.allSeries[0].get("elements")[a];i>=n.get("quoteDate").valueOf()&&!t?(e.selectedIndex=n.get("index"),e.selectedItem=n):t=!0}})}}),this.applyingAnnotations=!0,_.each(t,function(e){r.scalePendingAnnotations.push(e)}),this.clearAnnotationsForced(!0),this.scalingPending=!0,this.scaleAnnotations(),this.displayArea.onResize(),this.applyingAnnotations=!1}},Eg.prototype.onLevelAdded=function(e){var t=!1;switch(this.levels||(this.levels={entry:null,profits:[],stops:[]},this.model.set("levels",this.levels)),e.id=Helpers.getGUID(),e.type){case"entry":this.levels.entry||(this.levels.entry=e,t=!0);break;case"profit":this.levels.profits.length<3&&(this.levels.profits.push(e),t=!0);break;case"stop":this.levels.stops.length<3&&(this.levels.stops.push(e),t=!0);break;default:QuickBase.Log.Error("level type not supported: "+e.type)}return t},Eg.prototype.onLevelChanged=function(){this.level.value=this.maxPrice},Eg.prototype.onLevelRemoved=function(e){var t=e.level,i=-1;switch(t.type){case"entry":this.levels.entry=null;break;case"profit":-1!==(i=this.levels.profits.indexOf(t))&&this.levels.profits.slice(i,1);break;case"stop":-1!==(i=this.levels.stops.indexOf(t))&&this.levels.stops.slice(i,1);break;default:console.log("onLevelRemoved: level type not supported",t.type)}e.level=null},Eg.prototype.buildNotePoly=function(e,t){var i=[],a=0,n=1;e[0].x>e[1].x&&(a=1,n=0),i.push(e[a]),i.push({x:e[a].x,y:e[a].y+t}),i.push({x:e[n].x,y:e[a].y+t}),i.push({x:e[n].x,y:e[a].y});for(var o=(e[0].x+e[1].x)/2,s=(e[0].y+e[1].y)/2+t/2,a=2;a<e.length;a++){var r={x:e[a].x-o,y:e[a].y-s},l=Math.sqrt(r.x*r.x+r.y*r.y);r.x/=l,r.y/=l;for(var l=4*-r.y,r=4*r.x,d={x:o+l,y:s+r},c={x:o-l,y:s-r},h=void 0,p=void 0,u=void 0,m=void 0,u=0;u<i.length&&null===h;u++)n=(u+1)%i.length,h=Vector.prototype.intersection(d,e[a],i[u],i[n]);for(m=0;m<i.length&&null===p;m++)n=(m+1)%i.length,p=Vector.prototype.intersection(c,e[a],i[m],i[n]);null!==h&&null!==p&&(u!==m&&(m<u?(i=i.slice(m,m+(u-m)),u=0):i.splice(u,m-u)),i.splice(u%i.length,0,h,e[a],p))}return i},Eg.prototype.clearAnnotations=function(){this.scalePendingAnnotations=this.scalePendingAnnotations.concat(this.allAnnotations),this.allAnnotations=[],this.filteredAnnotations=[],this.scalingPending=!0,this.updateAnnotationsStorage()},Eg.prototype.clearAnnotationsForced=function(e){for(var t=0;t<this.allAnnotations.length;t+=1)this.allAnnotations[t].onRemoved&&this.allAnnotations[t].onRemoved(this.allAnnotations[t]);this.currentSymbol=this.model.get("stockSymbol"),this.scalingPending=!1,this.allAnnotations=[],this.filteredAnnotations=[],this.levels=null,this.model.set("levels",null),this.removedAnnotations=[],e||(this.clearAnnotationsCanvas(),this.displayArea.updateDisplay()),this.updateAnnotationsStorage()},Eg.prototype.clearAnnotationsCanvas=function(){var e,t,i;this.isCanvasClear||(e=this.$annotationsCanvas[0].getContext("2d"),t=this.$annotationsCanvas.width(),i=this.$annotationsCanvas.height(),e.clearRect(0,0,t,i),this.isCanvasClear=!0)},Eg.prototype.clearDrawingCanvas=function(){var e=this.$drawingCanvas[0].getContext("2d"),t=this.$drawingCanvas.width(),i=this.$drawingCanvas.height();e.clearRect(0,0,t,i)},Eg.prototype.drawAnnotationAndrewsPitchfork=function(t,e,i,a,n,o,s,d){function r(e,t,i,a,n,o,s){var r=(a+o)/2,l=((n+s)/2-i)/(r-t);return[{x1:t,y1:i,x2:r=t<=r?e:0,y2:l*r+(i-l*t)},{x1:a,y1:n,x2:r,y2:l*r+(n-l*a)},{x1:o,y1:s,x2:r,y2:l*r+(s-l*o)}]}var l,c,h=this,p=e.offset(),u=this.$drawingCanvas.offset(),m=this.$drawingCanvas[0].getContext("2d"),g=p.left-u.left,u=p.top-u.top,f=d&&d.drawAdditionalPoint?(l=d.drawAdditionalPoint.x,d.drawAdditionalPoint.y):((f=new Vector).fromPoints(o,n,o,s),l=o-f.x,n-f.y);t.lineWidth=i.lineThickness,t.strokeStyle=i.lineColor,c=r(e.width(),a,n,o,s,l,f),_.each(c,function(e){t.beginPath(),t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2),t.closePath(),t.stroke()}),t.beginPath(),t.moveTo(o,s),t.lineTo(l,f),t.closePath(),t.stroke(),d&&(d.setTrasformPoints=function(e,t,i,a,n,o,s,r,l){d.trasformPoints=[{x:e+s.left,y:t+s.top,dcx:e+r,dcy:t+l,cursor:"move"},{x:i+s.left,y:a+s.top,dcx:i+r,dcy:a+l,cursor:"move"},{x:n+s.left,y:o+s.top,dcx:n+r,dcy:o+l,cursor:"move"}];i=n+(i-n)/2,n=o+(a-o)/2,a=new Vector,a.fromPoints(e,t,i,n),o=a.findPerpendicular(2);d.boundsPoints=[{x:e+o.x+s.left,y:t+o.y+s.top,dcx:e+o.x+r,dcy:t+o.y+l},{x:i+o.x+s.left,y:n+o.y+s.top,dcx:i+o.x+r,dcy:n+o.y+l},{x:i-o.x+s.left,y:n-o.y+s.top,dcx:i-o.x+r,dcy:n-o.y+l},{x:e-o.x+s.left,y:t-o.y+s.top,dcx:e-o.x+r,dcy:t-o.y+l}]},d.isMouseOver=function(t,i){return d.isOverPoint=!1,_.each(d.trasformPoints,function(e){e.isMouseOverPoint=!1,h.isPointOverEllipse(t,i,e.x,e.y,h.transformPointRadius,h.transformPointRadius)&&(d.isOverPoint=!0,e.isMouseOverPoint=!0,d.mousePoint=e)}),d.isOverShape=!1,d.isOverPoint||(d.isOverShape=h.isPointOverPolygon(t,i,d.boundsPoints)),d.isOverPoint||d.isOverShape},d.drawDc=function(){m.lineWidth=d.drawTool.lineThickness,m.strokeStyle=d.drawTool.lineColor,c=r(h.$drawingCanvas.width(),d.trasformPoints[0].dcx,d.trasformPoints[0].dcy,d.trasformPoints[1].dcx,d.trasformPoints[1].dcy,d.trasformPoints[2].dcx,d.trasformPoints[2].dcy),_.each(c,function(e){m.beginPath(),m.moveTo(e.x1,e.y1),m.lineTo(e.x2,e.y2),m.closePath(),m.stroke()}),m.beginPath(),m.moveTo(d.trasformPoints[1].dcx,d.trasformPoints[1].dcy),m.lineTo(d.trasformPoints[2].dcx,d.trasformPoints[2].dcy),m.closePath(),m.stroke()},d.highlight=function(){_.each(d.trasformPoints,function(e){e.isMouseOverPoint?(m.fillStyle="red",h.cursor=e.cursor):m.fillStyle="white",m.lineWidth=h.transformPointStrokeWidth,m.strokeStyle="black",m.beginPath(),m.arc(e.dcx,e.dcy,h.transformPointRadius,0,2*Math.PI,!1),m.closePath(),m.fill(),m.stroke()}),d.isOverShape&&(h.cursor="move")},d.beginTransforming=function(e,t){h.filteredAnnotations=_.without(h.filteredAnnotations,d),h.allAnnotations=_.without(h.allAnnotations,d),h.clearAnnotationsCanvas(),h.drawAnnotations(h.lastxRatio,h.lastDisplayFromIndex),d.drawDc(),d.movePoint={x:e,y:t},d.isOverPoint&&(_.each(d.trasformPoints,function(e){e.isMouseOverPoint?(m.fillStyle="red",h.cursor=e.cursor):m.fillStyle="white",m.lineWidth=h.transformPointStrokeWidth,m.strokeStyle="black",m.beginPath(),m.arc(e.dcx,e.dcy,h.transformPointRadius,0,2*Math.PI,!1),m.closePath(),m.fill(),m.stroke()}),h.showCrosshair=!0)},d.transform=function(e,t){var i=e-d.movePoint.x,a=t-d.movePoint.y;d.movePoint={x:e,y:t},h.clearDrawingCanvas(),d.isOverPoint?(d.mousePoint.x+=i,d.mousePoint.y+=a,d.mousePoint.dcx+=i,d.mousePoint.dcy+=a):d.isOverShape&&_.each(d.trasformPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a}),d.drawDc()},d.finishTransforming=function(){h.clearDrawingCanvas();var e=h.displayArea.getPositionIndex(d.trasformPoints[0].x);d.drawStartPoint={x:d.trasformPoints[0].x,y:d.trasformPoints[0].y,selectedItem:h.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:h.displayArea.getPositionValue(d.trasformPoints[0].y)},e=h.displayArea.getPositionIndex(d.trasformPoints[1].x),d.drawEndPoint={x:d.trasformPoints[1].x,y:d.trasformPoints[1].y,selectedItem:h.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:h.displayArea.getPositionValue(d.trasformPoints[1].y)},e=h.displayArea.getPositionIndex(d.trasformPoints[2].x),d.drawAdditionalPoint={x:d.trasformPoints[2].x,y:d.trasformPoints[2].y,selectedItem:h.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:h.displayArea.getPositionValue(d.trasformPoints[2].y)},d.maxPrice=(d.drawStartPoint.selectedPrice>d.drawEndPoint.selectedPrice?d.drawStartPoint:d.drawEndPoint).selectedPrice,d.minPrice=(d.drawStartPoint.selectedPrice<d.drawEndPoint.selectedPrice?d.drawStartPoint:d.drawEndPoint).selectedPrice,h.addAnnotation(d),h.drawAnnotations(h.lastxRatio,h.lastDisplayFromIndex)},d.setTrasformPoints(a,n,o,s,l,f,p,g,u))},Eg.prototype.drawAnnotationEllipse=function(e,t,i,a,n,o,s,r){var l=this,t=t.offset(),d=this.$drawingCanvas.offset(),c=this.$drawingCanvas[0].getContext("2d"),h=t.left-d.left,d=t.top-d.top,p=o<a?o:a,u=o<a?a:o,m=s<n?s:n,g=s<n?n:s,f=m+(g-m)/2;e.lineWidth=i.lineThickness,e.strokeStyle=i.lineColor,e.fillStyle=i.fillColor,e.beginPath(),e.moveTo(p,f),e.bezierCurveTo(p,m,u,m,u,f),e.bezierCurveTo(u,g,p,g,p,f),e.closePath(),e.fill(),e.stroke(),r&&(r.setTrasformPoints=function(e,t,i,a,n,o,s){r.trasformPoints=[{x:t+n.left,y:e+n.top,dcx:t+o,dcy:e+s,cursor:"se-resize"},{x:i+n.left,y:e+n.top,dcx:i+o,dcy:e+s,cursor:"sw-resize"},{x:i+n.left,y:a+n.top,dcx:i+o,dcy:a+s,cursor:"se-resize"},{x:t+n.left,y:a+n.top,dcx:t+o,dcy:a+s,cursor:"sw-resize"}],r.trasformPoints[0].connectedX=r.trasformPoints[3],r.trasformPoints[0].connectedY=r.trasformPoints[1],r.trasformPoints[1].connectedX=r.trasformPoints[2],r.trasformPoints[1].connectedY=r.trasformPoints[0],r.trasformPoints[2].connectedX=r.trasformPoints[1],r.trasformPoints[2].connectedY=r.trasformPoints[3],r.trasformPoints[3].connectedX=r.trasformPoints[0],r.trasformPoints[3].connectedY=r.trasformPoints[2]},r.isMouseOver=function(t,i){return r.isOverPoint=!1,_.each(r.trasformPoints,function(e){e.isMouseOverPoint=!1,l.isPointOverEllipse(t,i,e.x,e.y,l.transformPointRadius,l.transformPointRadius)&&(r.isOverPoint=!0,e.isMouseOverPoint=!0,r.mousePoint=e)}),r.isOverShape=!1,r.isOverPoint||(r.isOverShape=l.isPointOverPolygon(t,i,r.trasformPoints)),r.isOverPoint||r.isOverShape},r.drawDc=function(){c.lineWidth=r.drawTool.lineThickness,c.strokeStyle=r.drawTool.lineColor,c.fillStyle=r.drawTool.fillColor,p=Math.min(r.trasformPoints[0].dcx,r.trasformPoints[1].dcx,r.trasformPoints[2].dcx,r.trasformPoints[3].dcx),u=Math.max(r.trasformPoints[0].dcx,r.trasformPoints[1].dcx,r.trasformPoints[2].dcx,r.trasformPoints[3].dcx),m=Math.min(r.trasformPoints[0].dcy,r.trasformPoints[1].dcy,r.trasformPoints[2].dcy,r.trasformPoints[3].dcy),g=Math.max(r.trasformPoints[0].dcy,r.trasformPoints[1].dcy,r.trasformPoints[2].dcy,r.trasformPoints[3].dcy),f=m+(g-m)/2,c.beginPath(),c.moveTo(p,f),c.bezierCurveTo(p,m,u,m,u,f),c.bezierCurveTo(u,g,p,g,p,f),c.closePath(),c.fill(),c.stroke()},r.highlight=function(){_.each(r.trasformPoints,function(e){e.isMouseOverPoint?(c.fillStyle="red",l.cursor=e.cursor):c.fillStyle="white",c.lineWidth=l.transformPointStrokeWidth,c.strokeStyle="black",c.beginPath(),c.arc(e.dcx,e.dcy,l.transformPointRadius,0,2*Math.PI,!1),c.closePath(),c.fill(),c.stroke()}),r.isOverShape&&(l.cursor="move")},r.beginTransforming=function(e,t){l.filteredAnnotations=_.without(l.filteredAnnotations,r),l.allAnnotations=_.without(l.allAnnotations,r),l.clearAnnotationsCanvas(),l.drawAnnotations(l.lastxRatio,l.lastDisplayFromIndex),r.drawDc(),r.movePoint={x:e,y:t},r.isOverPoint&&(_.each(r.trasformPoints,function(e){e.isMouseOverPoint?(c.fillStyle="red",l.cursor=e.cursor):c.fillStyle="white",c.lineWidth=l.transformPointStrokeWidth,c.strokeStyle="black",c.beginPath(),c.arc(e.dcx,e.dcy,l.transformPointRadius,0,2*Math.PI,!1),c.closePath(),c.fill(),c.stroke()}),l.showCrosshair=!0)},r.transform=function(e,t){var i=e-r.movePoint.x,a=t-r.movePoint.y;r.movePoint={x:e,y:t},l.clearDrawingCanvas(),r.isOverPoint?(r.mousePoint.x+=i,r.mousePoint.y+=a,r.mousePoint.dcx+=i,r.mousePoint.dcy+=a,r.mousePoint.connectedX.x+=i,r.mousePoint.connectedX.dcx+=i,r.mousePoint.connectedY.y+=a,r.mousePoint.connectedY.dcy+=a):r.isOverShape&&_.each(r.trasformPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a}),r.drawDc()},r.finishTransforming=function(){l.clearDrawingCanvas(),p=Math.min(r.trasformPoints[0].x,r.trasformPoints[1].x,r.trasformPoints[2].x,r.trasformPoints[3].x),u=Math.max(r.trasformPoints[0].x,r.trasformPoints[1].x,r.trasformPoints[2].x,r.trasformPoints[3].x),m=Math.min(r.trasformPoints[0].y,r.trasformPoints[1].y,r.trasformPoints[2].y,r.trasformPoints[3].y),g=Math.max(r.trasformPoints[0].y,r.trasformPoints[1].y,r.trasformPoints[2].y,r.trasformPoints[3].y);var e=l.displayArea.getPositionIndex(p);r.drawStartPoint={x:p,y:m,selectedItem:l.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:l.displayArea.getPositionValue(m)},e=l.displayArea.getPositionIndex(r.trasformPoints[1].x),r.drawEndPoint={x:u,y:g,selectedItem:l.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:l.displayArea.getPositionValue(g)},r.maxPrice=(r.drawStartPoint.selectedPrice>r.drawEndPoint.selectedPrice?r.drawStartPoint:r.drawEndPoint).selectedPrice,r.minPrice=(r.drawStartPoint.selectedPrice<r.drawEndPoint.selectedPrice?r.drawStartPoint:r.drawEndPoint).selectedPrice,l.addAnnotation(r),l.drawAnnotations(l.lastxRatio,l.lastDisplayFromIndex)},r.setTrasformPoints(m,p,u,g,t,h,d))},Eg.prototype.drawAnnotationFibonacciArcs=function(t,e,i,a,n,o,s,l){function r(e,t,i,a,n){var o=Math.sqrt(Math.pow(a-t,2)+Math.pow(n-i,2));return d.startPoint=a<t?{x:t,y:i}:{x:a,y:n},d.endPoint=t<a?{x:t,y:i}:{x:a,y:n},[{x:d.startPoint.x,y:d.startPoint.y,param:.236,r:.236*o,text:"23.6 %"},{x:d.startPoint.x,y:d.startPoint.y,param:.382,r:.382*o,text:"38.2 %"},{x:d.startPoint.x,y:d.startPoint.y,param:.5,r:.5*o,text:"50.0 %"},{x:d.startPoint.x,y:d.startPoint.y,param:.618,r:.618*o,text:"61.8 %"},{x:d.startPoint.x,y:d.startPoint.y,param:1,r:o,text:"100.0 %"}]}var d=this,c=e.offset(),h=this.$drawingCanvas.offset(),p=this.$drawingCanvas[0].getContext("2d"),u=c.left-h.left,h=c.top-h.top,i=(t.lineWidth=i.lineThickness,t.strokeStyle=i.lineColor,t.fillStyle=i.lineColor,t.textAlign="right",this.mainLines=r(e.width(),a,n,o,s),t.beginPath(),t.moveTo(a,n),t.lineTo(o,s),t.closePath(),t.stroke(),Math.atan2(this.endPoint.x-this.startPoint.x,this.endPoint.y-this.startPoint.y)),e=Math.atan2(this.endPoint.x-this.startPoint.x,0);this.angle=i-e,_.each(this.mainLines,function(e){t.beginPath(),t.arc(e.x,e.y,e.r,Math.PI-d.angle,-d.angle,d.endPoint.y>d.startPoint.y),t.stroke(),t.fillText(e.text,d.startPoint.x+(d.endPoint.x-d.startPoint.x)*e.param,d.startPoint.y+(d.endPoint.y-d.startPoint.y)*e.param)}),l&&(l.setTrasformPoints=function(e,t,i,a,n,o,s){l.trasformPoints=[{x:e+n.left,y:t+n.top,dcx:e+o,dcy:t+s,cursor:"move"},{x:i+n.left,y:a+n.top,dcx:i+o,dcy:a+s,cursor:"move"}];var r=new Vector,r=(r.fromPoints(e,t,i,a),r.findPerpendicular(2));l.boundsPoints=[{x:e+r.x+n.left,y:t+r.y+n.top,dcx:e+r.x+o,dcy:t+r.y+s},{x:i+r.x+n.left,y:a+r.y+n.top,dcx:i+r.x+o,dcy:a+r.y+s},{x:i-r.x+n.left,y:a-r.y+n.top,dcx:i-r.x+o,dcy:a-r.y+s},{x:e-r.x+n.left,y:t-r.y+n.top,dcx:e-r.x+o,dcy:t-r.y+s}]},l.isMouseOver=function(t,i){return l.isOverPoint=!1,_.each(l.trasformPoints,function(e){e.isMouseOverPoint=!1,d.isPointOverEllipse(t,i,e.x,e.y,d.transformPointRadius,d.transformPointRadius)&&(l.isOverPoint=!0,e.isMouseOverPoint=!0,l.mousePoint=e)}),l.isOverShape=!1,l.isOverPoint||(l.isOverShape=d.isPointOverPolygon(t,i,l.boundsPoints)),l.isOverPoint||l.isOverShape},l.drawDc=function(){p.lineWidth=l.drawTool.lineThickness,p.strokeStyle=l.drawTool.lineColor,p.fillStyle=l.drawTool.lineColor,d.mainLines=r(d.$drawingCanvas.width(),l.trasformPoints[0].dcx,l.trasformPoints[0].dcy,l.trasformPoints[1].dcx,l.trasformPoints[1].dcy),p.beginPath(),p.moveTo(d.startPoint.x,d.startPoint.y),p.lineTo(d.endPoint.x,d.endPoint.y),p.closePath(),p.stroke();var e=Math.atan2(d.endPoint.x-d.startPoint.x,d.endPoint.y-d.startPoint.y),t=Math.atan2(d.endPoint.x-d.startPoint.x,0);d.angle=e-t,_.each(d.mainLines,function(e){p.beginPath(),p.arc(e.x,e.y,e.r,Math.PI-d.angle,-d.angle,d.endPoint.y>d.startPoint.y),p.stroke(),p.fillText(e.text,d.startPoint.x+(d.endPoint.x-d.startPoint.x)*e.param,d.startPoint.y+(d.endPoint.y-d.startPoint.y)*e.param)})},l.highlight=function(){_.each(l.trasformPoints,function(e){e.isMouseOverPoint?(p.fillStyle="red",d.cursor=e.cursor):p.fillStyle="white",p.lineWidth=d.transformPointStrokeWidth,p.strokeStyle="black",p.beginPath(),p.arc(e.dcx,e.dcy,d.transformPointRadius,0,2*Math.PI,!1),p.closePath(),p.fill(),p.stroke()}),l.isOverShape&&(d.cursor="move")},l.beginTransforming=function(e,t){d.filteredAnnotations=_.without(d.filteredAnnotations,l),d.allAnnotations=_.without(d.allAnnotations,l),d.clearAnnotationsCanvas(),d.drawAnnotations(d.lastxRatio,d.lastDisplayFromIndex),l.drawDc(),l.movePoint={x:e,y:t},l.isOverPoint&&(_.each(l.trasformPoints,function(e){e.isMouseOverPoint?(p.fillStyle="red",d.cursor=e.cursor):p.fillStyle="white",p.lineWidth=d.transformPointStrokeWidth,p.strokeStyle="black",p.beginPath(),p.arc(e.dcx,e.dcy,d.transformPointRadius,0,2*Math.PI,!1),p.closePath(),p.fill(),p.stroke()}),d.showCrosshair=!0)},l.transform=function(e,t){var i=e-l.movePoint.x,a=t-l.movePoint.y;l.movePoint={x:e,y:t},d.clearDrawingCanvas(),l.isOverPoint?(l.mousePoint.x+=i,l.mousePoint.y+=a,l.mousePoint.dcx+=i,l.mousePoint.dcy+=a):l.isOverShape&&_.each(l.trasformPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a}),l.drawDc()},l.finishTransforming=function(){d.clearDrawingCanvas();var e=d.displayArea.getPositionIndex(l.trasformPoints[0].x);l.drawStartPoint={x:l.trasformPoints[0].x,y:l.trasformPoints[0].y,selectedItem:d.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:d.displayArea.getPositionValue(l.trasformPoints[0].y)},e=d.displayArea.getPositionIndex(l.trasformPoints[1].x),l.drawEndPoint={x:l.trasformPoints[1].x,y:l.trasformPoints[1].y,selectedItem:d.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:d.displayArea.getPositionValue(l.trasformPoints[1].y)},l.maxPrice=(l.drawStartPoint.selectedPrice>l.drawEndPoint.selectedPrice?l.drawStartPoint:l.drawEndPoint).selectedPrice,l.minPrice=(l.drawStartPoint.selectedPrice<l.drawEndPoint.selectedPrice?l.drawStartPoint:l.drawEndPoint).selectedPrice,d.addAnnotation(l),d.drawAnnotations(d.lastxRatio,d.lastDisplayFromIndex)},l.setTrasformPoints(a,n,o,s,c,u,h))},Eg.prototype.drawAnnotationFibonacciFan=function(t,e,i,a,n,o,s,l){function r(e,t,i,a,n,o){for(var s=(o=o||[10,0]).length,r=(e.moveTo(t,i),a-t+1e-8),l=(a=n-i)/r,d=Math.sqrt(r*r+a*a),c=0,h=!0;.1<=d;){var p=o[c++%s],u=(d<p&&(p=d),Math.sqrt(p*p/(1+l*l)));t+=u=r<0?-u:u,i+=l*u,h?e.lineTo(t,i):e.moveTo(t,i),d-=p,h=!h}}function d(e,t,i,a,n){var o,s,r=c.displayArea.$annotationsCanvas.height(),l=[];return t===a&&i===n?null:(s=t===a?(o=t,i<n?r:0):(n-i)/(a-t)*((o=t<=a?e:0)-t)+i,l.push({x1:t,y1:i,x2:o,y2:s,lineType:[5,5]}),_.each([.382,.5,.618],function(e){l.push({x1:t,y1:i,x2:o,y2:s+(i-s)*e})}),l)}var c=this,h=e.offset(),p=this.$drawingCanvas.offset(),u=this.$drawingCanvas[0].getContext("2d"),m=h.left-p.left,p=h.top-p.top;t.lineWidth=i.lineThickness,t.strokeStyle=i.lineColor,this.mainLines=d(e.width(),a,n,o,s),_.each(this.mainLines,function(e){t.beginPath(),e.lineType?r(t,e.x2,e.y2,e.x1,e.y1,e.lineType):(t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2)),t.closePath(),t.stroke()}),l&&(l.setTrasformPoints=function(e,t,i,a,n,o,s){l.trasformPoints=[{x:e+n.left,y:t+n.top,dcx:e+o,dcy:t+s,cursor:"move"},{x:i+n.left,y:a+n.top,dcx:i+o,dcy:a+s,cursor:"move"}];var r=new Vector,r=(r.fromPoints(e,t,i,a),r.findPerpendicular(2));l.boundsPoints=[{x:e+r.x+n.left,y:t+r.y+n.top,dcx:e+r.x+o,dcy:t+r.y+s},{x:i+r.x+n.left,y:a+r.y+n.top,dcx:i+r.x+o,dcy:a+r.y+s},{x:i-r.x+n.left,y:a-r.y+n.top,dcx:i-r.x+o,dcy:a-r.y+s},{x:e-r.x+n.left,y:t-r.y+n.top,dcx:e-r.x+o,dcy:t-r.y+s}]},l.isMouseOver=function(t,i){return l.isOverPoint=!1,_.each(l.trasformPoints,function(e){e.isMouseOverPoint=!1,c.isPointOverEllipse(t,i,e.x,e.y,c.transformPointRadius,c.transformPointRadius)&&(l.isOverPoint=!0,e.isMouseOverPoint=!0,l.mousePoint=e)}),l.isOverShape=!1,l.isOverPoint||(l.isOverShape=c.isPointOverPolygon(t,i,l.boundsPoints)),l.isOverPoint||l.isOverShape},l.drawDc=function(){u.lineWidth=l.drawTool.lineThickness,u.strokeStyle=l.drawTool.lineColor,c.mainLines=d(c.$drawingCanvas.width(),l.trasformPoints[0].dcx,l.trasformPoints[0].dcy,l.trasformPoints[1].dcx,l.trasformPoints[1].dcy),_.each(c.mainLines,function(e){e.lineType?(u.beginPath(),r(u,e.x2,e.y2,e.x1,e.y1,e.lineType)):(u.beginPath(),u.moveTo(e.x1,e.y1),u.lineTo(e.x2,e.y2)),u.closePath(),u.stroke()})},l.highlight=function(){_.each(l.trasformPoints,function(e){e.isMouseOverPoint?(u.fillStyle="red",c.cursor=e.cursor):u.fillStyle="white",u.lineWidth=c.transformPointStrokeWidth,u.strokeStyle="black",u.beginPath(),u.arc(e.dcx,e.dcy,c.transformPointRadius,0,2*Math.PI,!1),u.closePath(),u.fill(),u.stroke()}),l.isOverShape&&(c.cursor="move")},l.beginTransforming=function(e,t){c.filteredAnnotations=_.without(c.filteredAnnotations,l),c.allAnnotations=_.without(c.allAnnotations,l),c.clearAnnotationsCanvas(),c.drawAnnotations(c.lastxRatio,c.lastDisplayFromIndex),l.drawDc(),l.movePoint={x:e,y:t},l.isOverPoint&&(_.each(l.trasformPoints,function(e){e.isMouseOverPoint?(u.fillStyle="red",c.cursor=e.cursor):u.fillStyle="white",u.lineWidth=c.transformPointStrokeWidth,u.strokeStyle="black",u.beginPath(),u.arc(e.dcx,e.dcy,c.transformPointRadius,0,2*Math.PI,!1),u.closePath(),u.fill(),u.stroke()}),c.showCrosshair=!0)},l.transform=function(e,t){var i=e-l.movePoint.x,a=t-l.movePoint.y;l.movePoint={x:e,y:t},c.clearDrawingCanvas(),l.isOverPoint?(l.mousePoint.x+=i,l.mousePoint.y+=a,l.mousePoint.dcx+=i,l.mousePoint.dcy+=a):l.isOverShape&&_.each(l.trasformPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a}),l.drawDc()},l.finishTransforming=function(){c.clearDrawingCanvas();var e=c.displayArea.getPositionIndex(l.trasformPoints[0].x);l.drawStartPoint={x:l.trasformPoints[0].x,y:l.trasformPoints[0].y,selectedItem:c.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:c.displayArea.getPositionValue(l.trasformPoints[0].y)},e=c.displayArea.getPositionIndex(l.trasformPoints[1].x),l.drawEndPoint={x:l.trasformPoints[1].x,y:l.trasformPoints[1].y,selectedItem:c.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:c.displayArea.getPositionValue(l.trasformPoints[1].y)},l.maxPrice=(l.drawStartPoint.selectedPrice>l.drawEndPoint.selectedPrice?l.drawStartPoint:l.drawEndPoint).selectedPrice,l.minPrice=(l.drawStartPoint.selectedPrice<l.drawEndPoint.selectedPrice?l.drawStartPoint:l.drawEndPoint).selectedPrice,c.addAnnotation(l),c.drawAnnotations(c.lastxRatio,c.lastDisplayFromIndex)},l.setTrasformPoints(a,n,o,s,h,m,p))},Eg.prototype.drawAnnotationFibonacciRetracements=function(t,e,u,i,a,n,o,l){function s(e,t,i,a,n){var o,s=[],r=i<n?i:n,l=i<n?n:i,d=t<a?t:a,t=i<=n,c=e.width(),h=e.offset(),p=[0,1];return _.each(u.options,function(e){e.selected&&p.push(e.fibNum)}),t?_.each(p,function(e){o=r+(l-r)*(1-e),s.push({x1:d,y1:o,x2:c,y2:o,value:m.displayArea.getPositionValue(o+h.top).toFixed(m.fixedSize)+" ("+(100*e).toFixed(2)+"%)"})}):_.each(p,function(e){o=r+(l-r)*e,s.push({x1:d,y1:o,x2:c,y2:o,value:m.displayArea.getPositionValue(o+h.top).toFixed(m.fixedSize)+" ("+(100*e).toFixed(2)+"%)"})}),s}var m=this,r=e.offset(),d=this.$drawingCanvas.offset(),c=this.$drawingCanvas[0].getContext("2d"),h=r.left-d.left,d=r.top-d.top;u.options||(u.options=[{fibNum:.236,name:"show23",title:"23.6%",selected:!0},{fibNum:.382,name:"show38",title:"38.2%",selected:!0},{fibNum:.5,name:"show50",title:"50%",selected:!0},{fibNum:.618,name:"show61",title:"61.8%",selected:!0},{fibNum:.786,name:"show78",title:"78.6%",selected:!1},{fibNum:1.618,name:"show161",title:"161.8%",selected:!1},{fibNum:2.618,name:"show261",title:"261.8%",selected:!1},{fibNum:4.236,name:"show423",title:"423.6%",selected:!1}]),t.lineWidth=u.lineThickness,t.strokeStyle=u.lineColor,t.beginPath(),t.moveTo(i,a),t.lineTo(n,o),t.closePath(),t.stroke(),this.mainLines=s(e,i,a,n,o),_.each(this.mainLines,function(e){t.fillStyle=t.strokeStyle,t.textBaseline="middle",t.textAlign="right",t.fillText(e.value,e.x2,e.y1-u.textSize/2-1),t.beginPath(),t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2),t.closePath(),t.stroke()}),l&&(l.setTrasformPoints=function(e,t,i,a,n,o,s){l.trasformPoints=[{x:e+n.left,y:t+n.top,dcx:e+o,dcy:t+s,cursor:"move"},{x:i+n.left,y:a+n.top,dcx:i+o,dcy:a+s,cursor:"move"}];var r=new Vector,r=(r.fromPoints(e,t,i,a),r.findPerpendicular(2));l.boundsPoints=[{x:e+r.x+n.left,y:t+r.y+n.top,dcx:e+r.x+o,dcy:t+r.y+s},{x:i+r.x+n.left,y:a+r.y+n.top,dcx:i+r.x+o,dcy:a+r.y+s},{x:i-r.x+n.left,y:a-r.y+n.top,dcx:i-r.x+o,dcy:a-r.y+s},{x:e-r.x+n.left,y:t-r.y+n.top,dcx:e-r.x+o,dcy:t-r.y+s}]},l.isMouseOver=function(t,i){return l.isOverPoint=!1,_.each(l.trasformPoints,function(e){e.isMouseOverPoint=!1,m.isPointOverEllipse(t,i,e.x,e.y,m.transformPointRadius,m.transformPointRadius)&&(l.isOverPoint=!0,e.isMouseOverPoint=!0,l.mousePoint=e)}),l.isOverShape=!1,l.isOverPoint||(l.isOverShape=m.isPointOverPolygon(t,i,l.boundsPoints)),l.isOverPoint||l.isOverShape},l.drawDc=function(){c.lineWidth=l.drawTool.lineThickness,c.strokeStyle=l.drawTool.lineColor,m.mainLines=s(m.$drawingCanvas,l.trasformPoints[0].dcx,l.trasformPoints[0].dcy,l.trasformPoints[1].dcx,l.trasformPoints[1].dcy),_.each(m.mainLines,function(e){c.fillStyle=c.strokeStyle,c.textBaseline="middle",c.textAlign="right",c.fillText(e.value,e.x2,e.y1-6),c.beginPath(),c.moveTo(e.x1,e.y1),c.lineTo(e.x2,e.y2),c.closePath(),c.stroke()}),c.beginPath(),c.moveTo(l.trasformPoints[0].dcx,l.trasformPoints[0].dcy),c.lineTo(l.trasformPoints[1].dcx,l.trasformPoints[1].dcy),c.closePath(),c.stroke()},l.highlight=function(){_.each(l.trasformPoints,function(e){e.isMouseOverPoint?(c.fillStyle="red",m.cursor=e.cursor):c.fillStyle="white",c.lineWidth=m.transformPointStrokeWidth,c.strokeStyle="black",c.beginPath(),c.arc(e.dcx,e.dcy,m.transformPointRadius,0,2*Math.PI,!1),c.closePath(),c.fill(),c.stroke()}),l.isOverShape&&(m.cursor="move")},l.beginTransforming=function(e,t){m.filteredAnnotations=_.without(m.filteredAnnotations,l),m.allAnnotations=_.without(m.allAnnotations,l),m.clearAnnotationsCanvas(),m.drawAnnotations(m.lastxRatio,m.lastDisplayFromIndex),l.drawDc(),l.movePoint={x:e,y:t},l.isOverPoint&&(_.each(l.trasformPoints,function(e){e.isMouseOverPoint?(c.fillStyle="red",m.cursor=e.cursor):c.fillStyle="white",c.beginPath(),c.arc(e.dcx,e.dcy,m.transformPointRadius,0,2*Math.PI,!1),c.closePath(),c.fill(),c.stroke()}),m.showCrosshair=!0)},l.transform=function(e,t){var i=e-l.movePoint.x,a=t-l.movePoint.y;l.movePoint={x:e,y:t},m.clearDrawingCanvas(),l.isOverPoint?(l.mousePoint.x+=i,l.mousePoint.y+=a,l.mousePoint.dcx+=i,l.mousePoint.dcy+=a):l.isOverShape&&_.each(l.trasformPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a}),l.drawDc()},l.finishTransforming=function(){m.clearDrawingCanvas();var e=m.displayArea.getPositionIndex(l.trasformPoints[0].x);l.drawStartPoint={x:l.trasformPoints[0].x,y:l.trasformPoints[0].y,selectedItem:m.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:m.displayArea.getPositionValue(l.trasformPoints[0].y)},e=m.displayArea.getPositionIndex(l.trasformPoints[1].x),l.drawEndPoint={x:l.trasformPoints[1].x,y:l.trasformPoints[1].y,selectedItem:m.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:m.displayArea.getPositionValue(l.trasformPoints[1].y)},l.maxPrice=(l.drawStartPoint.selectedPrice>l.drawEndPoint.selectedPrice?l.drawStartPoint:l.drawEndPoint).selectedPrice,l.minPrice=(l.drawStartPoint.selectedPrice<l.drawEndPoint.selectedPrice?l.drawStartPoint:l.drawEndPoint).selectedPrice,m.addAnnotation(l),m.drawAnnotations(m.lastxRatio,m.lastDisplayFromIndex)},l.setTrasformPoints(i,a,n,o,r,h,d))},Eg.prototype.drawAnnotationFibonacciTimeZones=function(t,e,i,a,n,o,s,l){function r(e,t,i,a,n,o){for(var s=(o=o||[10,0]).length,r=(e.moveTo(t,i),a-t+1e-8),l=(a=n-i)/r,d=Math.sqrt(r*r+a*a),c=0,h=!0;.1<=d;){var p=o[c++%s],u=(d<p&&(p=d),Math.sqrt(p*p/(1+l*l)));t+=u=r<0?-u:u,i+=l*u,h?e.lineTo(t,i):e.moveTo(t,i),d-=p,h=!h}}function d(e,t,i,a){var n,o=c.displayArea.$annotationsCanvas.height(),s=[];return t===a?null:(a<t?s=[{x1:t,y1:0,x2:t,y2:o,value:0},{x1:a,y1:0,x2:a,y2:o,value:1}]:(n=a-t,_.each(g,function(e){s.push({x1:t+n*e,y1:0,x2:t+n*e,y2:o,value:e})})),s)}var c=this,h=(void 0===l&&(l=null),e.offset()),p=this.$drawingCanvas.offset(),u=this.$drawingCanvas[0].getContext("2d"),m=h.left-p.left,p=h.top-p.top,g=[0,1,2,3,5,8,13,21,34,55,89,144,233,377,610,987];t.lineWidth=i.lineThickness,t.strokeStyle=i.lineColor,t.beginPath(),t.moveTo(a,n),t.lineTo(o,s),t.closePath(),t.stroke(),this.mainLines=d(e.width(),a,0,o),_.each(this.mainLines,function(e){t.fillStyle=t.strokeStyle,t.textBaseline="middle",t.textAlign="right",t.fillText(e.value,e.x1-5,e.y1+i.textSize),t.beginPath(),r(t,e.x1,e.y1,e.x2,e.y2,[5,5]),t.closePath(),t.stroke()}),l&&(l.setTrasformPoints=function(e,t,i,a,n,o,s){l.trasformPoints=[{x:e+n.left,y:t+n.top,dcx:e+o,dcy:t+s,cursor:"move"},{x:i+n.left,y:a+n.top,dcx:i+o,dcy:a+s,cursor:"move"}];var r=new Vector,r=(r.fromPoints(e,t,i,a),r.findPerpendicular(2));l.boundsPoints=[{x:e+r.x+n.left,y:t+r.y+n.top,dcx:e+r.x+o,dcy:t+r.y+s},{x:i+r.x+n.left,y:a+r.y+n.top,dcx:i+r.x+o,dcy:a+r.y+s},{x:i-r.x+n.left,y:a-r.y+n.top,dcx:i-r.x+o,dcy:a-r.y+s},{x:e-r.x+n.left,y:t-r.y+n.top,dcx:e-r.x+o,dcy:t-r.y+s}]},l.isMouseOver=function(t,i){return l.isOverPoint=!1,_.each(l.trasformPoints,function(e){e.isMouseOverPoint=!1,c.isPointOverEllipse(t,i,e.x,e.y,c.transformPointRadius,c.transformPointRadius)&&(l.isOverPoint=!0,e.isMouseOverPoint=!0,l.mousePoint=e)}),l.isOverShape=!1,l.isOverPoint||(l.isOverShape=c.isPointOverPolygon(t,i,l.boundsPoints)),l.isOverPoint||l.isOverShape},l.drawDc=function(){u.lineWidth=l.drawTool.lineThickness,u.strokeStyle=l.drawTool.lineColor,c.mainLines=d(c.$drawingCanvas.width(),l.trasformPoints[0].dcx,l.trasformPoints[0].dcy,l.trasformPoints[1].dcx),_.each(c.mainLines,function(e){u.fillStyle=u.strokeStyle,u.textBaseline="middle",u.textAlign="right",u.fillText(e.value,e.x1-5,e.y1+i.textSize),u.beginPath(),r(u,e.x1,e.y1,e.x2,e.y2,[5,5]),u.closePath(),u.stroke()}),u.beginPath(),u.moveTo(l.trasformPoints[0].dcx,l.trasformPoints[0].dcy),u.lineTo(l.trasformPoints[1].dcx,l.trasformPoints[1].dcy),u.closePath(),u.stroke()},l.highlight=function(){_.each(l.trasformPoints,function(e){e.isMouseOverPoint?(u.fillStyle="red",c.cursor=e.cursor):u.fillStyle="white",u.lineWidth=c.transformPointStrokeWidth,u.strokeStyle="black",u.beginPath(),u.arc(e.dcx,e.dcy,c.transformPointRadius,0,2*Math.PI,!1),u.closePath(),u.fill(),u.stroke()}),l.isOverShape&&(c.cursor="move")},l.beginTransforming=function(e,t){c.filteredAnnotations=_.without(c.filteredAnnotations,l),c.allAnnotations=_.without(c.allAnnotations,l),c.clearAnnotationsCanvas(),c.drawAnnotations(c.lastxRatio,c.lastDisplayFromIndex),l.drawDc(),l.movePoint={x:e,y:t},l.isOverPoint&&(_.each(l.trasformPoints,function(e){e.isMouseOverPoint?(u.fillStyle="red",c.cursor=e.cursor):u.fillStyle="white",u.lineWidth=c.transformPointStrokeWidth,u.strokeStyle="black",u.beginPath(),u.arc(e.dcx,e.dcy,c.transformPointRadius,0,2*Math.PI,!1),u.closePath(),u.fill(),u.stroke()}),c.showCrosshair=!0)},l.transform=function(e,t){var i=e-l.movePoint.x,a=t-l.movePoint.y;l.movePoint={x:e,y:t},c.clearDrawingCanvas(),l.isOverPoint?(l.mousePoint.x+=i,l.mousePoint.y+=a,l.mousePoint.dcx+=i,l.mousePoint.dcy+=a):l.isOverShape&&_.each(l.trasformPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a}),l.drawDc()},l.finishTransforming=function(){c.clearDrawingCanvas();var e=c.displayArea.getPositionIndex(l.trasformPoints[0].x);l.drawStartPoint={x:l.trasformPoints[0].x,y:l.trasformPoints[0].y,selectedItem:c.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:c.displayArea.getPositionValue(l.trasformPoints[0].y)},e=c.displayArea.getPositionIndex(l.trasformPoints[1].x),l.drawEndPoint={x:l.trasformPoints[1].x,y:l.trasformPoints[1].y,selectedItem:c.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:c.displayArea.getPositionValue(l.trasformPoints[1].y)},l.maxPrice=(l.drawStartPoint.selectedPrice>l.drawEndPoint.selectedPrice?l.drawStartPoint:l.drawEndPoint).selectedPrice,l.minPrice=(l.drawStartPoint.selectedPrice<l.drawEndPoint.selectedPrice?l.drawStartPoint:l.drawEndPoint).selectedPrice,c.addAnnotation(l),c.drawAnnotations(c.lastxRatio,c.lastDisplayFromIndex)},l.setTrasformPoints(a,n,o,s,h,m,p))},Eg.prototype.drawAnnotationGannBox=function(e,t,i,a,n,o,s,r){var l=this,t=(void 0===r&&(r=null),t.offset()),d=this.$drawingCanvas.offset(),c=this.$drawingCanvas[0].getContext("2d"),h=t.left-d.left,d=t.top-d.top,p=o<a?o:a,u=o<a?a:o,m=s<n?s:n,g=s<n?n:s,f=(u-p)/2,y=(g-m)/2,D=f/2;e.lineWidth=i.lineThickness,e.strokeStyle=i.lineColor,e.beginPath(),e.moveTo(p,m),e.lineTo(u,m),e.lineTo(u,g),e.lineTo(p,g),e.lineTo(p,m),e.moveTo(p,m),e.lineTo(u,g),e.moveTo(u,m),e.lineTo(p,g),e.moveTo(p+f,m),e.lineTo(u,m+y),e.lineTo(p+f,g),e.lineTo(p,m+y),e.lineTo(p+f,m),e.lineTo(u,g),e.lineTo(p,m+y),e.lineTo(u,m),e.lineTo(u-D,g),e.lineTo(p+f,m),e.lineTo(p+D,g),e.lineTo(p,m),e.lineTo(u,m+y),e.lineTo(p,g),e.lineTo(p+D,m),e.lineTo(p+f,g),e.lineTo(u-D,m),e.lineTo(u,g),e.moveTo(u,m),e.lineTo(p+f,g),e.moveTo(p,m),e.lineTo(p+f,g),e.moveTo(p,g),e.lineTo(p+f,m),e.stroke(),r&&(r.setTrasformPoints=function(e,t,i,a,n,o,s){r.trasformPoints=[{x:t+n.left,y:e+n.top,dcx:t+o,dcy:e+s,cursor:"se-resize"},{x:i+n.left,y:e+n.top,dcx:i+o,dcy:e+s,cursor:"sw-resize"},{x:i+n.left,y:a+n.top,dcx:i+o,dcy:a+s,cursor:"se-resize"},{x:t+n.left,y:a+n.top,dcx:t+o,dcy:a+s,cursor:"sw-resize"}],r.trasformPoints[0].connectedX=r.trasformPoints[3],r.trasformPoints[0].connectedY=r.trasformPoints[1],r.trasformPoints[1].connectedX=r.trasformPoints[2],r.trasformPoints[1].connectedY=r.trasformPoints[0],r.trasformPoints[2].connectedX=r.trasformPoints[1],r.trasformPoints[2].connectedY=r.trasformPoints[3],r.trasformPoints[3].connectedX=r.trasformPoints[0],r.trasformPoints[3].connectedY=r.trasformPoints[2]},r.isMouseOver=function(t,i){return r.isOverPoint=!1,_.each(r.trasformPoints,function(e){e.isMouseOverPoint=!1,l.isPointOverEllipse(t,i,e.x,e.y,l.transformPointRadius,l.transformPointRadius)&&(r.isOverPoint=!0,e.isMouseOverPoint=!0,r.mousePoint=e)}),r.isOverShape=!1,r.isOverPoint||(r.isOverShape=l.isPointOverPolygon(t,i,r.trasformPoints)),r.isOverPoint||r.isOverShape},r.drawDc=function(){c.lineWidth=r.drawTool.lineThickness,c.strokeStyle=r.drawTool.lineColor,p=Math.min(r.trasformPoints[0].dcx,r.trasformPoints[1].dcx,r.trasformPoints[2].dcx,r.trasformPoints[3].dcx),u=Math.max(r.trasformPoints[0].dcx,r.trasformPoints[1].dcx,r.trasformPoints[2].dcx,r.trasformPoints[3].dcx),m=Math.min(r.trasformPoints[0].dcy,r.trasformPoints[1].dcy,r.trasformPoints[2].dcy,r.trasformPoints[3].dcy),g=Math.max(r.trasformPoints[0].dcy,r.trasformPoints[1].dcy,r.trasformPoints[2].dcy,r.trasformPoints[3].dcy),y=(g-m)/2,D=(f=(u-p)/2)/2,c.beginPath(),c.moveTo(p,m),c.lineTo(u,m),c.lineTo(u,g),c.lineTo(p,g),c.lineTo(p,m),c.moveTo(p,m),c.lineTo(u,g),c.moveTo(u,m),c.lineTo(p,g),c.moveTo(p+f,m),c.lineTo(u,m+y),c.lineTo(p+f,g),c.lineTo(p,m+y),c.lineTo(p+f,m),c.lineTo(u,g),c.lineTo(p,m+y),c.lineTo(u,m),c.lineTo(u-D,g),c.lineTo(p+f,m),c.lineTo(p+D,g),c.lineTo(p,m),c.lineTo(u,m+y),c.lineTo(p,g),c.lineTo(p+D,m),c.lineTo(p+f,g),c.lineTo(u-D,m),c.lineTo(u,g),c.moveTo(u,m),c.lineTo(p+f,g),c.moveTo(p,m),c.lineTo(p+f,g),c.moveTo(p,g),c.lineTo(p+f,m),c.stroke()},r.highlight=function(){_.each(r.trasformPoints,function(e){e.isMouseOverPoint?(c.fillStyle="red",l.cursor=e.cursor):c.fillStyle="white",c.lineWidth=l.transformPointStrokeWidth,c.strokeStyle="black",c.beginPath(),c.arc(e.dcx,e.dcy,l.transformPointRadius,0,2*Math.PI,!1),c.closePath(),c.fill(),c.stroke()}),r.isOverShape&&(l.cursor="move")},r.beginTransforming=function(e,t){l.filteredAnnotations=_.without(l.filteredAnnotations,r),l.allAnnotations=_.without(l.allAnnotations,r),l.clearAnnotationsCanvas(),l.drawAnnotations(l.lastxRatio,l.lastDisplayFromIndex),r.drawDc(),r.movePoint={x:e,y:t},r.isOverPoint&&(_.each(r.trasformPoints,function(e){e.isMouseOverPoint?(c.fillStyle="red",l.cursor=e.cursor):c.fillStyle="white",c.lineWidth=l.transformPointStrokeWidth,c.strokeStyle="black",c.beginPath(),c.arc(e.dcx,e.dcy,l.transformPointRadius,0,2*Math.PI,!1),c.closePath(),c.fill(),c.stroke()}),l.showCrosshair=!0)},r.transform=function(e,t){var i=e-r.movePoint.x,a=t-r.movePoint.y;r.movePoint={x:e,y:t},l.clearDrawingCanvas(),r.isOverPoint?(r.mousePoint.x+=i,r.mousePoint.y+=a,r.mousePoint.dcx+=i,r.mousePoint.dcy+=a,r.mousePoint.connectedX.x+=i,r.mousePoint.connectedX.dcx+=i,r.mousePoint.connectedY.y+=a,r.mousePoint.connectedY.dcy+=a):r.isOverShape&&_.each(r.trasformPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a}),r.drawDc()},r.finishTransforming=function(){l.clearDrawingCanvas(),p=Math.min(r.trasformPoints[0].x,r.trasformPoints[1].x,r.trasformPoints[2].x,r.trasformPoints[3].x),u=Math.max(r.trasformPoints[0].x,r.trasformPoints[1].x,r.trasformPoints[2].x,r.trasformPoints[3].x),m=Math.min(r.trasformPoints[0].y,r.trasformPoints[1].y,r.trasformPoints[2].y,r.trasformPoints[3].y),g=Math.max(r.trasformPoints[0].y,r.trasformPoints[1].y,r.trasformPoints[2].y,r.trasformPoints[3].y);var e=l.displayArea.getPositionIndex(p);r.drawStartPoint={x:p,y:m,selectedItem:l.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:l.displayArea.getPositionValue(m)},e=l.displayArea.getPositionIndex(r.trasformPoints[1].x),r.drawEndPoint={x:u,y:g,selectedItem:l.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:l.displayArea.getPositionValue(g)},r.maxPrice=(r.drawStartPoint.selectedPrice>r.drawEndPoint.selectedPrice?r.drawStartPoint:r.drawEndPoint).selectedPrice,r.minPrice=(r.drawStartPoint.selectedPrice<r.drawEndPoint.selectedPrice?r.drawStartPoint:r.drawEndPoint).selectedPrice,l.addAnnotation(r),l.drawAnnotations(l.lastxRatio,l.lastDisplayFromIndex)},r.setTrasformPoints(m,p,u,g,t,h,d))},Eg.prototype.drawAnnotationGannFan=function(t,i,e,a,n,o,s,l){function r(e,t,i,a,n,o){for(var s=(o=o||[10,0]).length,r=(e.moveTo(t,i),a-t+1e-8),l=(a=n-i)/r,d=Math.sqrt(r*r+a*a),c=0,h=!0;.1<=d;){var p=o[c++%s],u=(d<p&&(p=d),Math.sqrt(p*p/(1+l*l)));t+=u=r<0?-u:u,i+=l*u,h?e.lineTo(t,i):e.moveTo(t,i),d-=p,h=!h}}function d(t,i,a,n,o){var s,r,l,d,c,h,p=[],u=[];return i===n&&a===o?null:(h=i===n?(c=i,a<o?g:0):(o-a)/(n-i)*((c=i<=n?t:0)-i)+a,p.push({x1:i,y1:a,x2:c,y2:h,lineType:[5,5]}),u=[.5,2],_.each(e.options,function(e){e.selected&&(u=u.concat(e.angles))}),_.each(u,function(e){d=Math.atan(e)-Math.PI/4,r=n-i,l=o-a,s=Math.cos(d)*r-Math.sin(d)*l,r=Math.sin(d)*r+Math.cos(d)*l,d=r+a,c=i<=(l=s+i)?t:0,h=l-i==0?0:(d-a)/(l-i)*(c-i)+a,p.push({x1:i,y1:a,x2:c,y2:h})}),p)}var c=this,h=(void 0===l&&(l=null),i.offset()),p=this.$drawingCanvas.offset(),u=this.$drawingCanvas[0].getContext("2d"),m=h.left-p.left,p=h.top-p.top,g=this.displayArea.$annotationsCanvas.height(),f=(e.options||(e.options=[{angles:[3,1/3],name:"show3",title:"3x1, 1x3",selected:!0},{angles:[4,.25],name:"show4",title:"4x1, 1x4",selected:!0},{angles:[8,1/8],name:"show8",title:"8x1, 1x8",selected:!0},{angles:[16,1/16],name:"show16",title:"16x1, 1x16",selected:!1}]),t.lineWidth=e.lineThickness,t.strokeStyle=e.lineColor,i.width()),f=d(f,a,n,o,s);_.each(f,function(e){t.beginPath(),e.lineType?r(t,e.x1,e.y1,e.x2,e.y2,e.lineType):(t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2)),t.closePath(),t.stroke()}),l&&(l.setTrasformPoints=function(e,t,i,a,n,o,s){l.trasformPoints=[{x:e+n.left,y:t+n.top,dcx:e+o,dcy:t+s,cursor:"move"},{x:i+n.left,y:a+n.top,dcx:i+o,dcy:a+s,cursor:"move"}];var r=new Vector,r=(r.fromPoints(e,t,i,a),r.findPerpendicular(2));l.boundsPoints=[{x:e+r.x+n.left,y:t+r.y+n.top,dcx:e+r.x+o,dcy:t+r.y+s},{x:i+r.x+n.left,y:a+r.y+n.top,dcx:i+r.x+o,dcy:a+r.y+s},{x:i-r.x+n.left,y:a-r.y+n.top,dcx:i-r.x+o,dcy:a-r.y+s},{x:e-r.x+n.left,y:t-r.y+n.top,dcx:e-r.x+o,dcy:t-r.y+s}]},l.isMouseOver=function(e,t){return l.isOverPoint=!1,l.trasformPoints[1].isMouseOverPoint=!1,c.isPointOverEllipse(e,t,l.trasformPoints[1].x,l.trasformPoints[1].y,c.transformPointRadius,c.transformPointRadius)&&(l.isOverPoint=!0,l.trasformPoints[1].isMouseOverPoint=!0,l.mousePoint=l.trasformPoints[1]),l.isOverShape=!1,l.isOverPoint||(l.isOverShape=c.isPointOverPolygon(e,t,l.boundsPoints)||c.isPointOverEllipse(e,t,l.trasformPoints[0].x,l.trasformPoints[0].y,c.transformPointRadius,c.transformPointRadius)),l.isOverPoint||l.isOverShape},l.drawDc=function(){u.lineWidth=l.drawTool.lineThickness,u.strokeStyle=l.drawTool.lineColor;var e=i.width(),e=d(e,l.trasformPoints[0].dcx,l.trasformPoints[0].dcy,l.trasformPoints[1].dcx,l.trasformPoints[1].dcy);_.each(e,function(e){u.beginPath(),e.lineType?r(u,e.x1,e.y1,e.x2,e.y2,e.lineType):(u.moveTo(e.x1,e.y1),u.lineTo(e.x2,e.y2)),u.closePath(),u.stroke()})},l.highlight=function(){_.each(l.trasformPoints,function(e){e.isMouseOverPoint?(u.fillStyle="red",c.cursor=e.cursor):u.fillStyle="white",u.lineWidth=c.transformPointStrokeWidth,u.strokeStyle="black",u.beginPath(),u.arc(e.dcx,e.dcy,c.transformPointRadius,0,2*Math.PI,!1),u.closePath(),u.fill(),u.stroke()}),l.isOverShape&&(c.cursor="move")},l.beginTransforming=function(e,t){c.filteredAnnotations=_.without(c.filteredAnnotations,l),c.allAnnotations=_.without(c.allAnnotations,l),c.clearAnnotationsCanvas(),c.drawAnnotations(c.lastxRatio,c.lastDisplayFromIndex),l.drawDc(),l.movePoint={x:e,y:t},l.isOverPoint&&(_.each(l.trasformPoints,function(e){e.isMouseOverPoint?(u.fillStyle="red",c.cursor=e.cursor):u.fillStyle="white",u.lineWidth=c.transformPointStrokeWidth,u.strokeStyle="black",u.beginPath(),u.arc(e.dcx,e.dcy,c.transformPointRadius,0,2*Math.PI,!1),u.closePath(),u.fill(),u.stroke()}),c.showCrosshair=!0)},l.transform=function(e,t){var i=e-l.movePoint.x,a=t-l.movePoint.y;l.movePoint={x:e,y:t},c.clearDrawingCanvas(),l.isOverPoint?(l.mousePoint.x+=i,l.mousePoint.y+=a,l.mousePoint.dcx+=i,l.mousePoint.dcy+=a):l.isOverShape&&_.each(l.trasformPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a}),l.drawDc()},l.finishTransforming=function(){c.clearDrawingCanvas();var e=c.displayArea.getPositionIndex(l.trasformPoints[0].x);l.drawStartPoint={x:l.trasformPoints[0].x,y:l.trasformPoints[0].y,selectedItem:c.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:c.displayArea.getPositionValue(l.trasformPoints[0].y)},e=c.displayArea.getPositionIndex(l.trasformPoints[1].x),l.drawEndPoint={x:l.trasformPoints[1].x,y:l.trasformPoints[1].y,selectedItem:c.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:c.displayArea.getPositionValue(l.trasformPoints[1].y)},l.maxPrice=l.drawStartPoint.selectedPrice,l.minPrice=l.drawStartPoint.selectedPrice,c.addAnnotation(l),c.drawAnnotations(c.lastxRatio,c.lastDisplayFromIndex)},l.setTrasformPoints(a,n,o,s,h,m,p))},Eg.prototype.drawAnnotationLine=function(e,t,n,i,a,o,s,d){function r(e,t,i,a,n,o){for(var s=(o=o||[10,0]).length,r=(e.moveTo(t,i),a-t+1e-8),l=(a=n-i)/r,d=Math.sqrt(r*r+a*a),c=0,h=!0;.1<=d;){var p=o[c++%s],u=(d<p&&(p=d),Math.sqrt(p*p/(1+l*l)));t+=u=r<0?-u:u,i+=l*u,h?e.lineTo(t,i):e.moveTo(t,i),d-=p,h=!h}}function l(e,t,i,a,n){var o,s,r,l=i<e&&a<t||i<e&&t<a?(o=i,s=e,r=a,t):(o=e,s=i,r=t,a),d=s-o==0?1:(l-r)/(s-o);switch(n){case"future":return[{x:i,y:a},{x:s=e===i?e:g,y:l=1===d?f:r+d*(s-o)}];case"past":return e===i?s=e:o=0,[{x:o,y:r=1===d?0:l-d*(s-o)},{x:e,y:t}];default:return QuickBase.Log.Error("extend - direction not supported"),[]}}var c=this,h=(void 0===d&&(d=null),t.offset()),p=this.$drawingCanvas.offset(),u=this.$drawingCanvas[0].getContext("2d"),m=h.left-p.left,p=h.top-p.top,g=t.width(),f=this.displayArea.$annotationsCanvas.height(),y=[],t={},D={},C=(e.lineWidth=n.lineThickness,e.strokeStyle=n.lineColor,e.font);e.font=n.textSize+"px Arial",e.fillStyle=e.strokeStyle,e.textBaseline="middle",e.textAlign="right",e.beginPath(),d&&d.extendPast&&(y=l(i,a,o,s,"past"),n.lineType?r(e,y[0].x,y[0].y,y[1].x,y[1].y,n.lineType):(e.moveTo(y[0].x,y[0].y),e.lineTo(y[1].x,y[1].y)),t=_.minBy(y,function(e){return i===o?-e.y:e.x})),0<y.length&&y[0].y===f&&"vertical-line"===n.tool&&this.displayArea.getPositionDate(i+h.left)&&e.fillText(this.displayArea.getPositionDate(i+h.left)[0].format("d mmm yyyy HH:MM"),i-2,f-n.textSize/2-1),n.lineType?r(e,i,a,o,s,n.lineType):(e.moveTo(i,a),e.lineTo(o,s)),d&&d.extendFuture&&(y=l(i,a,o,s,"future"),n.lineType?r(e,y[0].x,y[0].y,y[1].x,y[1].y,n.lineType):(e.moveTo(y[0].x,y[0].y),e.lineTo(y[1].x,y[1].y)),D=_.maxBy(y,function(e){return i===o?-e.y:e.x})),e.closePath(),e.stroke(),0<y.length&&y[1].x===g&&"horizontal-line"===n.tool&&e.fillText(this.displayArea.getPositionValue(a+h.top).toFixed(this.fixedSize),g-1,a-n.textSize/2-1),e.font=C,d&&(d.setTrasformPoints=function(t,e,i,a,n,o,s,r,l){d.trasformPoints=[{x:t+n.left,y:e+n.top,dcx:t+o,dcy:e+s,cursor:"move"},{x:i+n.left,y:a+n.top,dcx:i+o,dcy:a+s,cursor:"move"}],e=[{x:t,y:e},{x:i,y:a},{x:r.x,y:r.y},{x:l.x,y:l.y}];a=_.minBy(e,function(e){return t===i?e.y:e.x}),r=_.maxBy(_.without(e,a),function(e){return t===i?e.y:e.x}),l=new Vector,l.fromPoints(a.x,a.y,r.x,r.y),e=l.findPerpendicular(6);d.boundsPoints=[{x:a.x+e.x+n.left,y:a.y+e.y+n.top,dcx:a.x+e.x+o,dcy:a.y+e.y+s},{x:r.x+e.x+n.left,y:r.y+e.y+n.top,dcx:r.x+e.x+o,dcy:r.y+e.y+s},{x:r.x-e.x+n.left,y:r.y-e.y+n.top,dcx:r.x-e.x+o,dcy:r.y-e.y+s},{x:a.x-e.x+n.left,y:a.y-e.y+n.top,dcx:a.x-e.x+o,dcy:a.y-e.y+s}]},d.isMouseOver=function(t,i){return d.isOverPoint=!1,_.each(d.trasformPoints,function(e){e.isMouseOverPoint=!1,c.isPointOverEllipse(t,i,e.x,e.y,c.transformPointRadius,c.transformPointRadius)&&(d.isOverPoint=!0,e.isMouseOverPoint=!0,d.mousePoint=e)}),d.isOverShape=!1,d.isOverPoint||(d.isOverShape=c.isPointOverPolygon(t,i,d.boundsPoints)),d.isOverPoint||d.isOverShape},d.drawDc=function(){u.lineWidth=d.drawTool.lineThickness,u.strokeStyle=d.drawTool.lineColor,u.beginPath(),d.extendPast&&(y=l(d.trasformPoints[0].dcx,d.trasformPoints[0].dcy,d.trasformPoints[1].dcx,d.trasformPoints[1].dcy,"past"),n.lineType?r(u,y[0].x,y[0].y,y[1].x,y[1].y,n.lineType):(u.moveTo(y[0].x,y[0].y),u.lineTo(y[1].x,y[1].y))),n.lineType?r(u,d.trasformPoints[0].dcx,d.trasformPoints[0].dcy,d.trasformPoints[1].dcx,d.trasformPoints[1].dcy,n.lineType):(u.moveTo(d.trasformPoints[0].dcx,d.trasformPoints[0].dcy),u.lineTo(d.trasformPoints[1].dcx,d.trasformPoints[1].dcy)),d.extendFuture&&(y=l(d.trasformPoints[0].dcx,d.trasformPoints[0].dcy,d.trasformPoints[1].dcx,d.trasformPoints[1].dcy,"future"),n.lineType?r(u,y[0].x,y[0].y,y[1].x,y[1].y,n.lineType):(u.moveTo(y[0].x,y[0].y),u.lineTo(y[1].x,y[1].y))),u.closePath(),u.stroke()},d.highlight=function(){_.each(d.trasformPoints,function(e){e.isMouseOverPoint?(u.fillStyle="red",c.cursor=e.cursor):u.fillStyle="white",u.lineWidth=c.transformPointStrokeWidth,u.strokeStyle="black",u.beginPath(),u.arc(e.dcx,e.dcy,c.transformPointRadius,0,2*Math.PI,!1),u.closePath(),u.fill(),u.stroke()}),d.isOverShape&&(c.cursor="move")},d.beginTransforming=function(e,t){c.filteredAnnotations=_.without(c.filteredAnnotations,d),c.allAnnotations=_.without(c.allAnnotations,d),c.clearAnnotationsCanvas(),c.drawAnnotations(c.lastxRatio,c.lastDisplayFromIndex),d.drawDc(),d.movePoint={x:e,y:t},d.isOverPoint&&(_.each(d.trasformPoints,function(e){e.isMouseOverPoint?(u.fillStyle="red",c.cursor=e.cursor):u.fillStyle="white",u.lineWidth=c.transformPointStrokeWidth,u.strokeStyle="black",u.beginPath(),u.arc(e.dcx,e.dcy,c.transformPointRadius,0,2*Math.PI,!1),u.closePath(),u.fill(),u.stroke()}),c.showCrosshair=!0)},d.transform=function(e,t){var i=e-d.movePoint.x,a=t-d.movePoint.y;if(d.movePoint={x:e,y:t},c.clearDrawingCanvas(),d.isOverPoint)switch(n.tool){case"trend-line":d.mousePoint.x+=i,d.mousePoint.y+=a,d.mousePoint.dcx+=i,d.mousePoint.dcy+=a;break;case"horizontal-line":d.mousePoint.x+=i,d.mousePoint.dcx+=i;break;case"vertical-line":d.mousePoint.y+=a,d.mousePoint.dcy+=a;break;default:QuickBase.Log.Error("drawing tool not supported")}else d.isOverShape&&_.each(d.trasformPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a});d.drawDc()},d.finishTransforming=function(){c.clearDrawingCanvas();var e=c.displayArea.getPositionIndex(d.trasformPoints[0].x);d.drawStartPoint={x:d.trasformPoints[0].x,y:d.trasformPoints[0].y,selectedItem:c.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:c.displayArea.getPositionValue(d.trasformPoints[0].y)},e=c.displayArea.getPositionIndex(d.trasformPoints[1].x),d.drawEndPoint={x:d.trasformPoints[1].x,y:d.trasformPoints[1].y,selectedItem:c.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:c.displayArea.getPositionValue(d.trasformPoints[1].y)},d.maxPrice=(d.drawStartPoint.selectedPrice>d.drawEndPoint.selectedPrice?d.drawStartPoint:d.drawEndPoint).selectedPrice,d.minPrice=(d.drawStartPoint.selectedPrice<d.drawEndPoint.selectedPrice?d.drawStartPoint:d.drawEndPoint).selectedPrice,c.addAnnotation(d),c.drawAnnotations(c.lastxRatio,c.lastDisplayFromIndex)},d.setTrasformPoints(i,a,o,s,h,m,p,t,D))},Eg.prototype.drawAnnotationRectangle=function(e,t,i,a,n,o,s,r){var l=this,t=(void 0===r&&(r=null),t.offset()),d=this.$drawingCanvas.offset(),c=this.$drawingCanvas[0].getContext("2d"),h=t.left-d.left,d=t.top-d.top,p=o<a?o:a,u=o<a?a:o,m=s<n?s:n,g=s<n?n:s;e.lineWidth=i.lineThickness,e.strokeStyle=i.lineColor,e.fillStyle=i.fillColor,e.beginPath(),e.moveTo(p,m),e.lineTo(u,m),e.lineTo(u,g),e.lineTo(p,g),e.lineTo(p,m),e.closePath(),e.fill(),e.stroke(),r&&(r.setTrasformPoints=function(e,t,i,a,n,o,s){r.trasformPoints=[{x:t+n.left,y:e+n.top,dcx:t+o,dcy:e+s,cursor:"se-resize"},{x:i+n.left,y:e+n.top,dcx:i+o,dcy:e+s,cursor:"sw-resize"},{x:i+n.left,y:a+n.top,dcx:i+o,dcy:a+s,cursor:"se-resize"},{x:t+n.left,y:a+n.top,dcx:t+o,dcy:a+s,cursor:"sw-resize"}],r.trasformPoints[0].connectedX=r.trasformPoints[3],r.trasformPoints[0].connectedY=r.trasformPoints[1],r.trasformPoints[1].connectedX=r.trasformPoints[2],r.trasformPoints[1].connectedY=r.trasformPoints[0],r.trasformPoints[2].connectedX=r.trasformPoints[1],r.trasformPoints[2].connectedY=r.trasformPoints[3],r.trasformPoints[3].connectedX=r.trasformPoints[0],r.trasformPoints[3].connectedY=r.trasformPoints[2]},r.isMouseOver=function(t,i){return r.isOverPoint=!1,_.each(r.trasformPoints,function(e){e.isMouseOverPoint=!1,l.isPointOverEllipse(t,i,e.x,e.y,l.transformPointRadius,l.transformPointRadius)&&(r.isOverPoint=!0,e.isMouseOverPoint=!0,r.mousePoint=e)}),r.isOverShape=!1,r.isOverPoint||(r.isOverShape=l.isPointOverPolygon(t,i,r.trasformPoints)),r.isOverPoint||r.isOverShape},r.drawDc=function(){c.lineWidth=r.drawTool.lineThickness,c.strokeStyle=r.drawTool.lineColor,c.fillStyle=r.drawTool.fillColor,p=Math.min(r.trasformPoints[0].dcx,r.trasformPoints[1].dcx,r.trasformPoints[2].dcx,r.trasformPoints[3].dcx),u=Math.max(r.trasformPoints[0].dcx,r.trasformPoints[1].dcx,r.trasformPoints[2].dcx,r.trasformPoints[3].dcx),m=Math.min(r.trasformPoints[0].dcy,r.trasformPoints[1].dcy,r.trasformPoints[2].dcy,r.trasformPoints[3].dcy),g=Math.max(r.trasformPoints[0].dcy,r.trasformPoints[1].dcy,r.trasformPoints[2].dcy,r.trasformPoints[3].dcy),c.beginPath(),c.moveTo(p,m),c.lineTo(u,m),c.lineTo(u,g),c.lineTo(p,g),c.lineTo(p,m),c.closePath(),c.fill(),c.stroke()},r.highlight=function(){_.each(r.trasformPoints,function(e){e.isMouseOverPoint?(c.fillStyle="red",l.cursor=e.cursor):c.fillStyle="white",c.lineWidth=l.transformPointStrokeWidth,c.strokeStyle="black",c.beginPath(),c.arc(e.dcx,e.dcy,l.transformPointRadius,0,2*Math.PI,!1),c.closePath(),c.fill(),c.stroke()}),r.isOverShape&&(l.cursor="move")},r.beginTransforming=function(e,t){l.filteredAnnotations=_.without(l.filteredAnnotations,r),l.allAnnotations=_.without(l.allAnnotations,r),l.clearAnnotationsCanvas(),l.drawAnnotations(l.lastxRatio,l.lastDisplayFromIndex),r.drawDc(),r.movePoint={x:e,y:t},r.isOverPoint&&(_.each(r.trasformPoints,function(e){e.isMouseOverPoint?(c.fillStyle="red",l.cursor=e.cursor):c.fillStyle="white",c.lineWidth=l.transformPointStrokeWidth,c.strokeStyle="black",c.beginPath(),c.arc(e.dcx,e.dcy,l.transformPointRadius,0,2*Math.PI,!1),c.closePath(),c.fill(),c.stroke()}),l.showCrosshair=!0)},r.transform=function(e,t){var i=e-r.movePoint.x,a=t-r.movePoint.y;r.movePoint={x:e,y:t},l.clearDrawingCanvas(),r.isOverPoint?(r.mousePoint.x+=i,r.mousePoint.y+=a,r.mousePoint.dcx+=i,r.mousePoint.dcy+=a,r.mousePoint.connectedX.x+=i,r.mousePoint.connectedX.dcx+=i,r.mousePoint.connectedY.y+=a,r.mousePoint.connectedY.dcy+=a):r.isOverShape&&_.each(r.trasformPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a}),r.drawDc()},r.finishTransforming=function(){l.clearDrawingCanvas(),p=Math.min(r.trasformPoints[0].x,r.trasformPoints[1].x,r.trasformPoints[2].x,r.trasformPoints[3].x),u=Math.max(r.trasformPoints[0].x,r.trasformPoints[1].x,r.trasformPoints[2].x,r.trasformPoints[3].x),m=Math.min(r.trasformPoints[0].y,r.trasformPoints[1].y,r.trasformPoints[2].y,r.trasformPoints[3].y),g=Math.max(r.trasformPoints[0].y,r.trasformPoints[1].y,r.trasformPoints[2].y,r.trasformPoints[3].y);var e=l.displayArea.getPositionIndex(p);r.drawStartPoint={x:p,y:m,selectedItem:l.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:l.displayArea.getPositionValue(m)},e=l.displayArea.getPositionIndex(r.trasformPoints[1].x),r.drawEndPoint={x:u,y:g,selectedItem:l.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:l.displayArea.getPositionValue(g)},r.maxPrice=(r.drawStartPoint.selectedPrice>r.drawEndPoint.selectedPrice?r.drawStartPoint:r.drawEndPoint).selectedPrice,r.minPrice=(r.drawStartPoint.selectedPrice<r.drawEndPoint.selectedPrice?r.drawStartPoint:r.drawEndPoint).selectedPrice,l.addAnnotation(r),l.drawAnnotations(l.lastxRatio,l.lastDisplayFromIndex)},r.setTrasformPoints(m,p,u,g,t,h,d))},Eg.prototype.drawAnnotationRotationRectangle=function(e,t,i,a,n,o,s,d){var r,l=this,c=(void 0===d&&(d=null),t.offset()),t=this.$drawingCanvas.offset(),h=this.$drawingCanvas[0].getContext("2d"),p=c.left-t.left,u=c.top-t.top,t=new Vector,t=(t.fromPoints(a,n,o,s),r=d&&d.currentHeight||50,t.findPerpendicular(r/2)),m=[{x:a+t.x+c.left,y:n+t.y+c.top,dcx:a+t.x+p,dcy:n+t.y+u},{x:o+t.x+c.left,y:s+t.y+c.top,dcx:o+t.x+p,dcy:s+t.y+u},{x:o-t.x+c.left,y:s-t.y+c.top,dcx:o-t.x+p,dcy:s-t.y+u},{x:a-t.x+c.left,y:n-t.y+c.top,dcx:a-t.x+p,dcy:n-t.y+u}];e.lineWidth=i.lineThickness,e.strokeStyle=i.lineColor,e.fillStyle=i.fillColor,e.beginPath(),e.moveTo(m[0].x-c.left,m[0].y-c.top),e.lineTo(m[1].x-c.left,m[1].y-c.top),e.lineTo(m[2].x-c.left,m[2].y-c.top),e.lineTo(m[3].x-c.left,m[3].y-c.top),e.lineTo(m[0].x-c.left,m[0].y-c.top),e.closePath(),e.fill(),e.stroke(),d&&(d.isMouseOver=function(t,i){return d.isOverPoint=!1,_.each(d.trasformPoints,function(e){e.isMouseOverPoint=!1,l.isPointOverEllipse(t,i,e.x,e.y,l.transformPointRadius,l.transformPointRadius)&&(d.isOverPoint=!0,e.isMouseOverPoint=!0,d.mousePoint=e)}),d.isOverShape=!1,d.isOverPoint||(d.isOverShape=l.isPointOverPolygon(t,i,m)),d.isOverPoint||d.isOverShape},d.drawDc=function(){h.lineWidth=d.drawTool.lineThickness,h.strokeStyle=d.drawTool.lineColor,h.fillStyle=d.drawTool.fillColor,h.beginPath(),h.moveTo(d.boundsPoints[0].dcx,d.boundsPoints[0].dcy),h.lineTo(d.boundsPoints[1].dcx,d.boundsPoints[1].dcy),h.lineTo(d.boundsPoints[2].dcx,d.boundsPoints[2].dcy),h.lineTo(d.boundsPoints[3].dcx,d.boundsPoints[3].dcy),h.lineTo(d.boundsPoints[0].dcx,d.boundsPoints[0].dcy),h.closePath(),h.fill(),h.stroke()},d.updatePoints=function(e,t,i,a,n,o){var s=new Vector,s=(s.fromPoints(e.x,e.y,t.x,t.y),s.findPerpendicular(i/2)),r=e.x+(t.x-e.x)/2,l=e.y+(t.y-e.y)/2;d.currentHeight=i,d.boundsPoints=[{x:e.x+s.x+a.left,y:e.y+s.y+a.top,dcx:e.x+s.x+n,dcy:e.y+s.y+o},{x:t.x+s.x+a.left,y:t.y+s.y+a.top,dcx:t.x+s.x+n,dcy:t.y+s.y+o},{x:t.x-s.x+a.left,y:t.y-s.y+a.top,dcx:t.x-s.x+n,dcy:t.y-s.y+o},{x:e.x-s.x+a.left,y:e.y-s.y+a.top,dcx:e.x-s.x+n,dcy:e.y-s.y+o}],d.trasformPoints=[{x:e.x+a.left,y:e.y+a.top,dcx:e.x+n,dcy:e.y+o,cursor:"move",action:"angle"},{x:t.x+a.left,y:t.y+a.top,dcx:t.x+n,dcy:t.y+o,cursor:"move",action:"angle"},{x:r+a.left-s.x,y:l+a.top-s.y,dcx:r-s.x+n,dcy:l-s.y+o,cursor:"move",action:"resize"},{x:r+a.left+s.x,y:l+a.top+s.y,dcx:r+s.x+n,dcy:l+s.y+o,cursor:"move",action:"resize"}],d.trasformPoints[0].pair=d.trasformPoints[1],d.trasformPoints[1].pair=d.trasformPoints[0],d.trasformPoints[2].pair=d.trasformPoints[3],d.trasformPoints[3].pair=d.trasformPoints[2]},d.highlight=function(){_.each(d.trasformPoints,function(e){e.isMouseOverPoint?(h.fillStyle="red",l.cursor=e.cursor):h.fillStyle="white",h.lineWidth=l.transformPointStrokeWidth,h.strokeStyle="black",h.beginPath(),h.arc(e.dcx,e.dcy,l.transformPointRadius,0,2*Math.PI,!1),h.closePath(),h.fill(),h.stroke()}),d.isOverShape&&(l.cursor="move")},d.beginTransforming=function(e,t){l.filteredAnnotations=_.without(l.filteredAnnotations,d),l.allAnnotations=_.without(l.allAnnotations,d),l.clearAnnotationsCanvas(),l.drawAnnotations(l.lastxRatio,l.lastDisplayFromIndex),d.drawDc(),d.movePoint={x:e,y:t},d.isOverPoint&&(_.each(d.trasformPoints,function(e){e.isMouseOverPoint?(h.fillStyle="red",l.cursor=e.cursor):h.fillStyle="white",h.lineWidth=l.transformPointStrokeWidth,h.strokeStyle="black",h.beginPath(),h.arc(e.dcx,e.dcy,l.transformPointRadius,0,2*Math.PI,!1),h.closePath(),h.fill(),h.stroke()}),l.showCrosshair=!0)},d.transform=function(e,t){var i=e-d.movePoint.x,a=t-d.movePoint.y;d.movePoint={x:e,y:t},l.clearDrawingCanvas(),d.isOverPoint?"resize"===d.mousePoint.action?((e=new Vector).fromPoints(d.mousePoint.pair.x,d.mousePoint.pair.y,d.movePoint.x,d.movePoint.y),t=e.magnitude(e.x,e.y),d.updatePoints({x:d.trasformPoints[0].x-c.left,y:d.trasformPoints[0].y-c.top},{x:d.trasformPoints[1].x-c.left,y:d.trasformPoints[1].y-c.top},t,c,p,u)):"angle"===d.mousePoint.action&&d.updatePoints({x:d.mousePoint.pair.x-c.left,y:d.mousePoint.pair.y-c.top},{x:d.movePoint.x-c.left,y:d.movePoint.y-c.top},d.currentHeight||50,c,p,u):d.isOverShape&&(_.each(d.boundsPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a}),_.each(d.trasformPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a})),d.drawDc()},d.finishTransforming=function(){l.clearDrawingCanvas();var e=l.displayArea.getPositionIndex(d.trasformPoints[0].x);d.drawStartPoint={x:d.trasformPoints[0].x,y:d.trasformPoints[0].y,selectedItem:l.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:l.displayArea.getPositionValue(d.trasformPoints[0].y)},e=l.displayArea.getPositionIndex(d.trasformPoints[1].x),d.drawEndPoint={x:d.trasformPoints[1].x,y:d.trasformPoints[1].x,selectedItem:l.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:l.displayArea.getPositionValue(d.trasformPoints[1].y)},d.maxPrice=(d.drawStartPoint.selectedPrice>d.drawEndPoint.selectedPrice?d.drawStartPoint:d.drawEndPoint).selectedPrice,d.minPrice=(d.drawStartPoint.selectedPrice<d.drawEndPoint.selectedPrice?d.drawStartPoint:d.drawEndPoint).selectedPrice,l.addAnnotation(d),l.drawAnnotations(l.lastxRatio,l.lastDisplayFromIndex)},d.updatePoints({x:a,y:n},{x:o,y:s},d.currentHeight||50,c,p,u))},Eg.prototype.drawAnnotationTextNote=function(i,e,a,t,n,o,s,d){var r,l,c,h,p,u,m,g,f,y,D,C=this,v=(void 0===d&&(d=null),e.offset()),e=this.$drawingCanvas.offset(),x=this.$drawingCanvas[0].getContext("2d"),w=v.left-e.left,P=v.top-e.top;for(i.font=a.textSize+"px Arial",i.textAlign="start",i.lineWidth=a.lineThickness,i.fillStyle=a.fillColor,i.strokeStyle=a.lineColor,e=d&&d.text?d.text:"edit to change text",m=e.split("\n"),p=_.max(_.map(m,function(e){return i.measureText(e).width})),u=m.length*a.textSize,r=o-(p/2+a.textMargin),c=o+(p/2+a.textMargin),l=s-(u/2+a.textMargin),h=s+(u/2+a.textMargin),f=[{x:r,y:l},{x:c,y:l}].concat(d&&d.notePoints?d.notePoints:[]),g=this.buildNotePoly(f,u+2*a.textMargin),i.beginPath(),i.moveTo(g[0].x,g[0].y),y=1;y<g.length;y++)i.lineTo(g[y].x,g[y].y);i.closePath(),i.fill(),i.stroke(),i.textBaseline="middle",i.fillStyle=a.textColor,_.each(m,function(e,t){i.fillText(e,o-p/2,l+a.textSize*(t+1))}),d&&(d.setTrasformPoints=function(e,t,i,a,n,o,s,r,l){d.trasformPoints=[{x:e+s.left,y:n+s.top,dcx:e+r,dcy:n+l,cursor:"pointer"},{x:i+s.left,y:t+s.top,dcx:i+r,dcy:t+l,cursor:"pointer"},{x:a+s.left,y:t+s.top,dcx:a+r,dcy:t+l,cursor:"pointer"},{x:e+s.left,y:o+s.top,dcx:e+r,dcy:o+l,cursor:"pointer"}],d.boundsPoints=[{x:i+s.left,y:n+s.top,dcx:i+r,dcy:n+l},{x:a+s.left,y:n+s.top,dcx:a+r,dcy:n+l},{x:a+s.left,y:o+s.top,dcx:a+r,dcy:o+l},{x:i+s.left,y:o+s.top,dcx:i+r,dcy:o+l}],d.middlePoint={x:e+s.left,y:t+s.top,dcx:e+r,dcy:t+l}},d.isMouseOver=function(t,i){return d.isOverPoint=!1,_.each(d.trasformPoints,function(e){e.isMouseOverPoint=!1,C.isPointOverEllipse(t,i,e.x,e.y,C.transformPointRadius,C.transformPointRadius)&&(d.isOverPoint=!0,e.isMouseOverPoint=!0,d.mousePoint=e)}),d.isOverShape=!1,d.isOverNotePoint=!1,d.isOverPoint||(_.each(d.notePoints,function(e){e.isMouseOverPoint=!1,C.isPointOverEllipse(t,i,e.x+v.left,e.y+v.top,C.transformPointRadius,C.transformPointRadius)&&(d.isOverNotePoint=!0,e.isMouseOverPoint=!0,d.mousePoint=e)}),d.isOverNotePoint||(d.isOverShape=C.isPointOverPolygon(t,i,d.boundsPoints))),d.isOverPoint||d.isOverShape||d.isOverNotePoint},d.drawDc=function(){for(x.font=a.textSize+"px Arial",x.textAlign="start",x.lineWidth=a.lineThickness,x.fillStyle=a.fillColor,x.strokeStyle=a.lineColor,d.text||(d.text="edit to change text"),m=d.text.split("\n"),p=_.max(_.map(m,function(e){return i.measureText(e).width})),u=m.length*a.textSize,r=d.middlePoint.dcx-(p/2+a.textMargin),c=d.middlePoint.dcx+(p/2+a.textMargin),l=d.middlePoint.dcy-(u/2+a.textMargin),h=d.middlePoint.dcy+(u/2+a.textMargin),D=d.notePoints,f=[{x:r,y:l},{x:c,y:l}].concat(_.map(D,function(e){return{x:e.dcx,y:e.dcy}})),g=this.buildNotePoly(f,u+2*a.textMargin),x.beginPath(),x.moveTo(g[0].x,g[0].y),y=1;y<g.length;y++)x.lineTo(g[y].x,g[y].y);x.closePath(),x.fill(),x.stroke(),x.textBaseline="middle",x.fillStyle=a.textColor,_.each(m,function(e,t){x.fillText(e,d.middlePoint.dcx-p/2,l+a.textSize*(t+1))})},d.highlight=function(){_.each(d.trasformPoints,function(e){e.isMouseOverPoint?(x.fillStyle="red",C.cursor=e.cursor):x.fillStyle="white",x.lineWidth=C.transformPointStrokeWidth,x.strokeStyle="black",x.beginPath(),x.arc(e.dcx,e.dcy,C.transformPointRadius,0,2*Math.PI,!1),x.closePath(),x.fill(),x.stroke()}),_.each(d.notePoints,function(e){e.isMouseOverPoint?(x.fillStyle="red",C.cursor=e.cursor):x.fillStyle="white",x.beginPath(),x.arc(e.dcx,e.dcy,C.transformPointRadius,0,2*Math.PI,!1),x.closePath(),x.fill()}),d.isOverShape&&(C.cursor="move")},d.beginTransforming=function(e,t){C.filteredAnnotations=_.without(C.filteredAnnotations,d),C.allAnnotations=_.without(C.allAnnotations,d),C.clearAnnotationsCanvas(),C.drawAnnotations(C.lastxRatio,C.lastDisplayFromIndex),d.drawDc(),d.movePoint={x:e,y:t},d.isOverPoint?(d.currentNotePoint={x:e-v.left,y:t-v.top,dcx:e-v.left+w,dcy:t-v.top+P},d.notePoints.push(d.currentNotePoint)):d.isOverNotePoint&&(d.currentNotePoint=d.mousePoint,d.currentNotePoint.x=e-v.left,d.currentNotePoint.y=t-v.top,d.currentNotePoint.dcx=e-v.left+w,d.currentNotePoint.dcy=t-v.top+P)},d.transform=function(e,t){var i=e-d.movePoint.x,a=t-d.movePoint.y;d.movePoint={x:e,y:t},C.clearDrawingCanvas(),d.isOverPoint||d.isOverNotePoint?(d.currentNotePoint.x+=i,d.currentNotePoint.y+=a,d.currentNotePoint.dcx+=i,d.currentNotePoint.dcy+=a):(_.each(d.trasformPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a}),_.each(d.boundsPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a}),d.middlePoint.x+=i,d.middlePoint.y+=a,d.middlePoint.dcx+=i,d.middlePoint.dcy+=a),d.drawDc()},d.finishTransforming=function(){C.clearDrawingCanvas();var t=C.displayArea.getPositionIndex(d.middlePoint.x);d.drawStartPoint={x:d.middlePoint.x,y:d.middlePoint.y,selectedItem:C.displayArea.allSeries[0].get("elements")[t],selectedIndex:t,selectedPrice:C.displayArea.getPositionValue(d.middlePoint.y)},_.each(d.notePoints,function(e){e.x+=v.left,e.y+=v.top,t=C.displayArea.getPositionIndex(e.x),e.selectedIndex=t,e.selectedItem=C.displayArea.allSeries[0].get("elements")[t],e.selectedPrice=C.displayArea.getPositionValue(e.y)}),d.drawEndPoint=$.extend({},d.drawStartPoint),d.maxPrice=d.drawStartPoint.selectedPrice,d.minPrice=d.drawStartPoint.selectedPrice,C.addAnnotation(d),C.drawAnnotations(C.lastxRatio,C.lastDisplayFromIndex)},d.setTrasformPoints(o,s,r,c,l,h,v,w,P),d.notePoints?_.each(d.notePoints,function(e){e.dcx=e.x+w,e.dcy=e.y+P}):d.notePoints=[])},Eg.prototype.drawAnnotationDiNapoli=function(t,e,i,a,n,o,s,d){function r(e,t,i,a,n,o,s){var r,l=[],d=i<n?i:n,c=i<n?n:i,h=t<a?t:a,t=i<=n,p=e.width(),u=e.offset();return l.push({x1:a,y1:n,x2:o,y2:s}),t?_.each(f,function(e){r=(c-d)*e.Multiplier+s,l.push({x1:h,y1:r,x2:p,y2:r,value:e.Name+": "+m.displayArea.getPositionValue(r+u.top).toFixed(m.fixedSize)+" ("+(100*e.Multiplier).toFixed(2)+"%)"})}):_.each(f,function(e){r=(d-c)*e.Multiplier+s,l.push({x1:h,y1:r,x2:p,y2:r,value:e.Name+": "+m.displayArea.getPositionValue(r+u.top).toFixed(m.fixedSize)+" ("+(100*e.Multiplier).toFixed(2)+"%)"})}),l}var l,c,m=this,h=(void 0===d&&(d=null),e.offset()),p=this.$drawingCanvas.offset(),u=this.$drawingCanvas[0].getContext("2d"),g=h.left-p.left,p=h.top-p.top,f=[{Name:"COP",Multiplier:.618},{Name:"OP",Multiplier:1},{Name:"XOP",Multiplier:1.618}];d&&d.drawAdditionalPoint?(l=d.drawAdditionalPoint.x,c=d.drawAdditionalPoint.y):(c=Math.max(n,s)-(Math.max(n,s)-Math.min(n,s))/2,l=Math.max(a,o)+(Math.max(n,s)-Math.min(n,s))/2);t.lineWidth=i.lineThickness,t.strokeStyle=i.lineColor,t.beginPath(),t.moveTo(a,n),t.lineTo(o,s),t.closePath(),t.stroke(),this.mainLines=r(e,a,n,o,s,l,c),_.each(this.mainLines,function(e){e.value&&(t.fillStyle=t.strokeStyle,t.textBaseline="middle",t.textAlign="right",t.fillText(e.value,e.x2,e.y1-i.textSize/2-1)),t.beginPath(),t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2),t.closePath(),t.stroke()}),d&&(d.setTrasformPoints=function(e,t,i,a,n,o,s,r,l){d.trasformPoints=[{x:e+s.left,y:t+s.top,dcx:e+r,dcy:t+l,cursor:"move"},{x:i+s.left,y:a+s.top,dcx:i+r,dcy:a+l,cursor:"move"},{x:n+s.left,y:o+s.top,dcx:n+r,dcy:o+l,cursor:"move"}];n=new Vector,n.fromPoints(e,t,i,a),o=n.findPerpendicular(2);d.boundsPoints=[{x:e+o.x+s.left,y:t+o.y+s.top,dcx:e+o.x+r,dcy:t+o.y+l},{x:i+o.x+s.left,y:a+o.y+s.top,dcx:i+o.x+r,dcy:a+o.y+l},{x:i-o.x+s.left,y:a-o.y+s.top,dcx:i-o.x+r,dcy:a-o.y+l},{x:e-o.x+s.left,y:t-o.y+s.top,dcx:e-o.x+r,dcy:t-o.y+l}]},d.isMouseOver=function(t,i){return d.isOverPoint=!1,_.each(d.trasformPoints,function(e){e.isMouseOverPoint=!1,m.isPointOverEllipse(t,i,e.x,e.y,m.transformPointRadius,m.transformPointRadius)&&(d.isOverPoint=!0,e.isMouseOverPoint=!0,d.mousePoint=e)}),d.isOverShape=!1,d.isOverPoint||(d.isOverShape=m.isPointOverPolygon(t,i,d.boundsPoints)),d.isOverPoint||d.isOverShape},d.drawDc=function(){u.lineWidth=d.drawTool.lineThickness,u.strokeStyle=d.drawTool.lineColor,m.mainLines=r(m.$drawingCanvas,d.trasformPoints[0].dcx,d.trasformPoints[0].dcy,d.trasformPoints[1].dcx,d.trasformPoints[1].dcy,d.trasformPoints[2].dcx,d.trasformPoints[2].dcy),_.each(m.mainLines,function(e){e.value&&(u.fillStyle=u.strokeStyle,u.textBaseline="middle",u.textAlign="right",u.fillText(e.value,e.x2,e.y1-6)),u.beginPath(),u.moveTo(e.x1,e.y1),u.lineTo(e.x2,e.y2),u.closePath(),u.stroke()}),u.beginPath(),u.moveTo(d.trasformPoints[0].dcx,d.trasformPoints[0].dcy),u.lineTo(d.trasformPoints[1].dcx,d.trasformPoints[1].dcy),u.closePath(),u.stroke()},d.highlight=function(){_.each(d.trasformPoints,function(e){e.isMouseOverPoint?(u.fillStyle="red",m.cursor=e.cursor):u.fillStyle="white",u.lineWidth=m.transformPointStrokeWidth,u.strokeStyle="black",u.beginPath(),u.arc(e.dcx,e.dcy,m.transformPointRadius,0,2*Math.PI,!1),u.closePath(),u.fill(),u.stroke()}),d.isOverShape&&(m.cursor="move")},d.beginTransforming=function(e,t){m.filteredAnnotations=_.without(m.filteredAnnotations,d),m.allAnnotations=_.without(m.allAnnotations,d),m.clearAnnotationsCanvas(),m.drawAnnotations(m.lastxRatio,m.lastDisplayFromIndex),d.drawDc(),d.movePoint={x:e,y:t},d.isOverPoint&&(_.each(d.trasformPoints,function(e){e.isMouseOverPoint?(u.fillStyle="red",m.cursor=e.cursor):u.fillStyle="white",u.beginPath(),u.arc(e.dcx,e.dcy,m.transformPointRadius,0,2*Math.PI,!1),u.closePath(),u.fill(),u.stroke()}),m.showCrosshair=!0)},d.transform=function(e,t){var i=e-d.movePoint.x,a=t-d.movePoint.y;d.movePoint={x:e,y:t},m.clearDrawingCanvas(),d.isOverPoint?(d.mousePoint.x+=i,d.mousePoint.y+=a,d.mousePoint.dcx+=i,d.mousePoint.dcy+=a):d.isOverShape&&_.each(d.trasformPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a}),d.drawDc()},d.finishTransforming=function(){m.clearDrawingCanvas();var e=m.displayArea.getPositionIndex(d.trasformPoints[0].x);d.drawStartPoint={x:d.trasformPoints[0].x,y:d.trasformPoints[0].y,selectedItem:m.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:m.displayArea.getPositionValue(d.trasformPoints[0].y)},e=m.displayArea.getPositionIndex(d.trasformPoints[1].x),d.drawEndPoint={x:d.trasformPoints[1].x,y:d.trasformPoints[1].y,selectedItem:m.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:m.displayArea.getPositionValue(d.trasformPoints[1].y)},e=m.displayArea.getPositionIndex(d.trasformPoints[2].x),d.drawAdditionalPoint={x:d.trasformPoints[2].x,y:d.trasformPoints[2].y,selectedItem:m.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:m.displayArea.getPositionValue(d.trasformPoints[2].y)},d.maxPrice=(d.drawStartPoint.selectedPrice>d.drawEndPoint.selectedPrice?d.drawStartPoint:d.drawEndPoint).selectedPrice,d.minPrice=(d.drawStartPoint.selectedPrice<d.drawEndPoint.selectedPrice?d.drawStartPoint:d.drawEndPoint).selectedPrice,m.addAnnotation(d),m.drawAnnotations(m.lastxRatio,m.lastDisplayFromIndex)},d.setTrasformPoints(a,n,o,s,l,c,h,g,p))},Eg.prototype.drawAnnotations=function(t,i){var e,a,n,o,s,r=this;if(this.allAnnotations.length<=0)this.clearAnnotationsCanvas();else if(this.filteredAnnotations.length<=0)this.clearAnnotationsCanvas();else for(var l=this.$annotationsCanvas[0].getContext("2d"),d=(this.lastxRatio=t,this.lastDisplayFromIndex=i,this.clearAnnotationsCanvas(),this.isCanvasClear=!1,this.filteredAnnotations.length),c=0;c<d;c+=1)switch(e=((s=this.filteredAnnotations[c]).drawStartPoint.selectedItem.get("index")-i)*t,e+=s.drawStartPoint.xAddOn*t,n=this.displayArea.getValuePosition(s.drawStartPoint.selectedPrice),a=(s.drawEndPoint.selectedItem.get("index")-i)*t,a+=s.drawEndPoint.xAddOn*t,o=this.displayArea.getValuePosition(s.drawEndPoint.selectedPrice),_.each(s.extendedChartAreas,function(t){var e;t.displayArea!==r.displayArea&&((e=_.find(s.extendedChildren,function(e){return e.chartArea===t})).drawStartPoint=s.drawStartPoint,e.drawEndPoint=s.drawEndPoint),r.refreshPending&&(r.refreshPending=!1,t.annotationsManager.drawAnnotations(r.lastxRatio,r.lastDisplayFromIndex))}),s.drawTool.tool){case"trend-line":case"horizontal-line":case"vertical-line":this.drawAnnotationLine(l,this.$annotationsCanvas,s.drawTool,e,n,a,o,s);break;case"ellipse":this.drawAnnotationEllipse(l,this.$annotationsCanvas,s.drawTool,e,n,a,o,s);break;case"gann-fan":this.drawAnnotationGannFan(l,this.$annotationsCanvas,s.drawTool,e,n,a,o,s);break;case"fibonacci-arcs":this.drawAnnotationFibonacciArcs(l,this.$annotationsCanvas,s.drawTool,e,n,a,o,s);break;case"fibonacci-fan":this.drawAnnotationFibonacciFan(l,this.$annotationsCanvas,s.drawTool,e,n,a,o,s);break;case"andrews-pitchfork":s.drawAdditionalPoint&&(s.drawAdditionalPoint.x=(s.drawAdditionalPoint.selectedItem.get("index")-i)*t,s.drawAdditionalPoint.y=this.displayArea.getValuePosition(s.drawAdditionalPoint.selectedPrice)),this.drawAnnotationAndrewsPitchfork(l,this.$annotationsCanvas,s.drawTool,e,n,a,o,s);break;case"fibonacci-retracements":this.drawAnnotationFibonacciRetracements(l,this.$annotationsCanvas,s.drawTool,e,n,a,o,s);break;case"fibonacci-time-zones":this.drawAnnotationFibonacciTimeZones(l,this.$annotationsCanvas,s.drawTool,e,n,a,o,s);break;case"gann-box":this.drawAnnotationGannBox(l,this.$annotationsCanvas,s.drawTool,e,n,a,o,s);break;case"rectangle":this.drawAnnotationRectangle(l,this.$annotationsCanvas,s.drawTool,e,n,a,o,s);break;case"rotation-rectangle":this.drawAnnotationRotationRectangle(l,this.$annotationsCanvas,s.drawTool,e,n,a,o,s);break;case"text-note":_.each(s.notePoints,function(e){e.x=(e.selectedItem.get("index")-i)*t,e.x+=e.xAddOn*t,e.y=r.displayArea.getValuePosition(e.selectedPrice)}),this.drawAnnotationTextNote(l,this.$annotationsCanvas,s.drawTool,e,n,a,o,s);break;case"dinapoli":s.drawAdditionalPoint&&(s.drawAdditionalPoint.x=(s.drawAdditionalPoint.selectedItem.get("index")-i)*t,s.drawAdditionalPoint.y=this.displayArea.getValuePosition(s.drawAdditionalPoint.selectedPrice)),this.drawAnnotationDiNapoli(l,this.$annotationsCanvas,s.drawTool,e,n,a,o,s);break;default:QuickBase.Log.Error("annotation not supported")}},Eg.prototype.filterAnnotations=function(){var e,t,i,a,n;this.filteredAnnotations=[],this.allAnnotations&&0<this.allAnnotations.length&&!this.disableAnnotations&&this.displayArea.allSeries[0].get("elements")[this.displayArea.displayFromIndex]&&this.displayArea.allSeries[0].get("elements")[this.displayArea.displayToIndex]&&(e=this.displayArea.allSeries[0].get("elements")[this.displayArea.displayFromIndex].get("quoteDate"),t=this.displayArea.allSeries[0].get("elements")[this.displayArea.displayToIndex].get("quoteDate"),t=Helpers.getNextDate(t,this.model.get("granularity")),i=e.getTime(),a=t.getTime(),this.filteredAnnotations=_.filter(this.allAnnotations,function(e){switch(e.drawTool.tool){case"horizontal-line":n=e.drawStartTime>=i&&e.drawStartTime<=a||e.drawEndTime>=i&&e.drawEndTime<=a||e.drawStartTime<=i&&e.drawEndTime>=a||e.drawEndTime<=a&&e.extendFuture||e.drawStartTime<=i&&e.extendPast;break;case"trend-line":n=e.drawStartTime>=i&&e.drawStartTime<=a||e.drawEndTime>=i&&e.drawEndTime<=a||e.drawStartTime<=i&&e.drawEndTime>=a||e.extendPast||e.extendFuture;case"vertical-line":case"ellipse":case"rectangle":case"gann-box":case"fibonacci-time-zones":case"rotation-rectangle":case"text-note":n=e.drawStartTime>=i&&e.drawStartTime<=a||e.drawEndTime>=i&&e.drawEndTime<=a||e.drawStartTime<=i&&e.drawEndTime>=a;break;case"gann-fan":n=e.drawEndTime<a;break;case"fibonacci-arcs":case"fibonacci-fan":case"andrews-pitchfork":case"fibonacci-retracements":case"dinapoli":n=e.drawEndTime<a&&e.drawStartTime<a}return n}))},Eg.prototype.findAnnotation=function(t){return _.find(this.allAnnotations,function(e){return e.drawStartTime===t.drawStartTime&&e.drawEndTime===t.drawEndTime&&e.drawTool.tool===t.drawTool.tool&&e.drawStartPoint.selectedPrice===t.drawStartPoint.selectedPrice})||null},Eg.prototype.getMin=function(){return _.min(_.map(this.filteredAnnotations,function(e){return e.minPrice}))},Eg.prototype.getMax=function(){return _.max(_.map(this.filteredAnnotations,function(e){return e.maxPrice}))},Eg.prototype.handleMouseDraw=function(e,t){var i,a,n,o,s,r,l,d=this.$drawingCanvas[0].getContext("2d"),c=this.$drawingCanvas.prop("width"),h=this.$drawingCanvas.prop("height"),p=e.pageX,u=e.pageY,m=this.displayArea.allSeries[0].get("elements")[t];switch((m=m||this.displayArea.allSeries[0].get("elements")[this.displayArea.allSeries[0].get("elements").length-1]).get("index")||m.set("index",t),this.drawTool.tool){case"vertical-line":a=this.drawStartPoint.selectedItem,n=this.drawStartPoint.selectedIndex,i=this.displayArea.getPositionValue(e.pageY),p=this.drawStartPoint.x;break;case"horizontal-line":n=(a=m).get("index"),i=this.drawStartPoint.selectedPrice,u=this.drawStartPoint.y;break;case"trend-line":case"ellipse":case"rectangle":case"gann-box":case"rotation-rectangle":case"gann-fan":case"fibonacci-arcs":case"fibonacci-fan":case"andrews-pitchfork":case"fibonacci-retracements":case"fibonacci-time-zones":case"text-note":case"dinapoli":n=(a=m).get("index"),i=this.displayArea.getPositionValue(e.pageY)}if(a)switch(this.drawEndPoint={x:p,y:u,selectedItem:a,selectedIndex:n,selectedPrice:i},t=this.$drawingCanvas.offset(),d.clearRect(0,0,c,h),o=this.drawStartPoint.x-t.left,s=this.drawStartPoint.y-t.top,r=this.drawEndPoint.x-t.left,l=this.drawEndPoint.y-t.top,this.drawTool.tool){case"vertical-line":case"horizontal-line":case"trend-line":this.drawAnnotationLine(d,this.$drawingCanvas,this.drawTool,o,s,r,l);break;case"ellipse":this.drawAnnotationEllipse(d,this.$drawingCanvas,this.drawTool,o,s,r,l,null);break;case"fibonacci-arcs":this.drawAnnotationFibonacciArcs(d,this.$drawingCanvas,this.drawTool,o,s,r,l,null);break;case"fibonacci-fan":this.drawAnnotationFibonacciFan(d,this.$drawingCanvas,this.drawTool,o,s,r,l,null);break;case"andrews-pitchfork":this.drawAnnotationAndrewsPitchfork(d,this.$drawingCanvas,this.drawTool,o,s,r,l,null);break;case"fibonacci-retracements":this.drawAnnotationFibonacciRetracements(d,this.$drawingCanvas,this.drawTool,o,s,r,l,null);break;case"fibonacci-time-zones":this.drawAnnotationFibonacciTimeZones(d,this.$drawingCanvas,this.drawTool,o,s,r,l);break;case"gann-fan":this.drawAnnotationGannFan(d,this.$drawingCanvas,this.drawTool,o,s,r,l);break;case"gann-box":this.drawAnnotationGannBox(d,this.$drawingCanvas,this.drawTool,o,s,r,l);break;case"rectangle":this.drawAnnotationRectangle(d,this.$drawingCanvas,this.drawTool,o,s,r,l);break;case"rotation-rectangle":this.drawAnnotationRotationRectangle(d,this.$drawingCanvas,this.drawTool,o,s,r,l);break;case"text-note":this.drawAnnotationTextNote(d,this.$drawingCanvas,this.drawTool,o,s,r,l);break;case"dinapoli":this.drawAnnotationDiNapoli(d,this.$drawingCanvas,this.drawTool,o,s,r,l)}else this.drawEndPoint=null},Eg.prototype.isActive=function(e,t){return this.isDrawing&&this.isDrawingStarted?(this.handleMouseDraw(e,t),!0):this.isTransforming?(this.activeItem.transform(e.pageX,e.pageY),!0):this.onMouseMove(e)},Eg.prototype.isPointOverEllipse=function(e,t,i,a,n,o){return(e-i)*(e-i)/(n*n)+(t-a)*(t-a)/(o*o)<=1},Eg.prototype.isPointOverPolygon=function(e,t,i){var a,n,o,s=!1;if(i)for(n=i.length-1,a=0;a<i.length;a++)(i[a].y<t&&i[n].y>=t||i[n].y<t&&i[a].y>=t)&&(i[a].x<=e||i[n].x<=e)&&(s=!((o=i[a].x+(t-i[a].y)/(i[n].y-i[a].y)*(i[n].x-i[a].x)<e)&&s||!o&&!s)),n=a;return s},Eg.prototype.onContextMenu=function(t){var e,i,a=this;return this.activeItem=_.find(this.filteredAnnotations,function(e){return e.isMouseOver(t.pageX,t.pageY)}),!this.activeItem||(e=this.activeItem,this.activeItem=null,(i=new AnnotationContextMenu({annotation:e,model:this.model,annotationsManager:this})).show(t),$(i).on("change",function(){a.drawAnnotations(a.lastxRatio,a.lastDisplayFromIndex)}),$(i).on("copy",function(e,t){a.clipboard=t.item}),$(i).on("delete",function(){_.includes(a.allAnnotations,e)||(e=a.findAnnotation(e)),a.allAnnotations=_.without(a.allAnnotations,e),a.filteredAnnotations=_.without(a.filteredAnnotations,e),a.removedAnnotations.push(e),a.activeItem=null,a.clearDrawingCanvas(),a.clearAnnotationsCanvas(),a.drawAnnotations(a.lastxRatio,a.lastDisplayFromIndex),e.onRemoved&&e.onRemoved(e),a.updateAnnotationsStorage()}),!1)},Eg.prototype.onMouseDblClick=function(t){var e,i=this;if(this.activeItem=_.find(this.filteredAnnotations,function(e){return e.isMouseOver(t.pageX,t.pageY)}),this.activeItem){if(e=this.activeItem,this.activeItem=null,this.openDialog)return this.openDialog.$el.parent().toggleClass("flash",!1),_.defer(function(){i.openDialog.$el.parent().toggleClass("flash",!0)}),!1;var a=new AnnotationEditForm({annotation:e});return(this.openDialog=a).$el.dialog({dialogClass:"charting "+this.model.get("currentTheme"),title:"Edit",resizable:!1,width:"auto",open:function(e){$(e.target).css("overflow","visible");e=$(e.target).parent();i.model.changeThemeClassForElementWhenThemeChanges(e)},close:function(){a.$el.dialog("destroy"),i.openDialog=null,i.updateAnnotationsStorage()}}),$(a).on("change",function(){i.drawAnnotations(i.lastxRatio,i.lastDisplayFromIndex)}),$(a).on("remove",function(){_.includes(i.allAnnotations,e)||(e=i.findAnnotation(e)),i.allAnnotations=_.without(i.allAnnotations,e),i.filteredAnnotations=_.without(i.filteredAnnotations,e),i.removedAnnotations.push(e),i.activeItem=null,i.clearDrawingCanvas(),i.clearAnnotationsCanvas(),i.drawAnnotations(i.lastxRatio,i.lastDisplayFromIndex),e.onRemoved&&e.onRemoved(e),i.updateAnnotationsStorage()}),$(a).on("close",function(){$(a.$el).dialog("close")}),!0}return!1},Eg.prototype.onMouseDown=function(e){var t,i=!1;return e.ctrlKey||2===e.button||(this.isDrawing?(this.isDrawingStarted=!0,t=this.displayArea.getPositionDate(e.pageX),this.drawStartPoint={x:e.pageX,y:e.pageY,selectedItem:t[2],selectedIndex:t[1],selectedPrice:this.displayArea.getPositionValue(e.pageY)},i=!0):this.activeItem&&(this.isTransforming=!0,this.activeItem.beginTransforming(e.pageX,e.pageY),i=!0)),i},Eg.prototype.onMouseMove=function(t){return 0<this.filteredAnnotations.length&&(this.clearDrawingCanvas(),this.activeItem=_.find(this.filteredAnnotations,function(e){return e.isMouseOver(t.pageX,t.pageY)})),this.activeItem&&(this.activeItem.highlight(t.pageX,t.pageY),this.showCrosshair=!1),null!==this.activeItem&&void 0!==this.activeItem},Eg.prototype.onMouseUp=function(e){var t=!1,i=$(this.displayArea.$mainCanvas[0]).offset(),a=this.displayArea.$annotationsCanvas.width(),n=this.displayArea.$annotationsCanvas.height(),o=e.pageX-i.left,e=e.pageY-i.top;return o<0||e<0||a<o||n<e?t=!1:this.isDrawing?(this.isDrawing=!1,this.isDrawingStarted=!1,this.clearDrawingCanvas(),this.drawEndPoint&&this.drawEndPoint.selectedItem&&("horizontal-line"===(i={drawTool:this.drawTool,drawStartPoint:this.drawStartPoint,drawEndPoint:this.drawEndPoint,maxPrice:(this.drawStartPoint.selectedPrice>this.drawEndPoint.selectedPrice?this.drawStartPoint:this.drawEndPoint).selectedPrice,minPrice:(this.drawStartPoint.selectedPrice<this.drawEndPoint.selectedPrice?this.drawStartPoint:this.drawEndPoint).selectedPrice,extendedChildren:[],extendedChartAreas:[]}).drawTool.tool&&(i.extendFuture=!0),"vertical-line"===i.drawTool.tool&&(i.extendPast=!0,i.extendFuture=!0),this.addAnnotation(i),this.displayArea.updateDisplay()),this.drawStartPoint=null,t=!(this.drawEndPoint=null)):this.isTransforming&&(a=this.activeItem,this.isTransforming=!1,this.activeItem.finishTransforming(),t=!(this.activeItem=null),a.onChanged&&a.onChanged()),t},Eg.prototype.redoAnnotations=function(){var e=this.removedAnnotations.pop();e&&(this.allAnnotations.push(e),this.filteredAnnotations.push(e),this.displayArea.updateDisplayMinMaxLength(),this.displayArea.updateDisplay(),this.updateAnnotationsStorage())},Eg.prototype.removeAnnotation=function(e,t){this.filteredAnnotations=_.without(this.filteredAnnotations,e),this.allAnnotations=_.without(this.allAnnotations,e),this.drawAnnotations(this.lastxRatio,this.lastDisplayFromIndex),e.onRemoved&&e.onRemoved(e),t&&this.displayArea.updateDisplay(),this.updateAnnotationsStorage()},Eg.prototype.scaleAnnotations=function(){var n,o,s,r,l,d,t,c=this,h=0,p=!1,u=!1,m=[];this.scalingPending&&(_.each(this.scalePendingAnnotations,function(e){for(n=parseInt(e.drawStartTime),l=new Date(n),o=parseInt(e.drawEndTime),d=new Date(o),h=c.displayArea.allDates.length-1;0<=h;--h)if(c.displayArea.allDates[h]<l){e.drawStartPoint.selectedItem=c.displayArea.allSeries[0].get("elements")[h],p=!0;break}for(p=!!e.drawStartPoint.selectedItem,h=c.displayArea.allDates.length-1;0<=h;--h)if(c.displayArea.allDates[h]<d){e.drawEndPoint.selectedItem=c.displayArea.allSeries[0].get("elements")[h],u=!0;break}var t,i,a;u=!!e.drawEndPoint.selectedItem,p&&u&&(s=e.drawStartPoint.selectedItem.get("quoteDate").getTime(),r=(c.displayArea.allSeries[0].get("elements").length>e.drawStartPoint.selectedItem.get("index")+1?c.displayArea.allSeries[0].get("elements")[e.drawStartPoint.selectedItem.get("index")+1].get("quoteDate"):Helpers.getNextDate(e.drawStartPoint.selectedItem.get("quoteDate"),c.model.get("granularity"))).getTime(),e.drawStartPoint.xAddOn=(n-s)/(r-s),e.drawStartTime=s+(r-s)*e.drawStartPoint.xAddOn,s=e.drawEndPoint.selectedItem.get("quoteDate").getTime(),r=(c.displayArea.allSeries[0].get("elements").length>e.drawEndPoint.selectedItem.get("index")+1?c.displayArea.allSeries[0].get("elements")[e.drawEndPoint.selectedItem.get("index")+1].get("quoteDate"):Helpers.getNextDate(e.drawEndPoint.selectedItem.get("quoteDate"),c.model.get("granularity"))).getTime(),e.drawEndPoint.xAddOn=(o-s)/(r-s),m.push(e),e.drawEndTime=s+(r-s)*e.drawEndPoint.xAddOn),u=p=!1,"text-note"===e.drawTool.tool&&_.each(e.notePoints,function(e){for(t=parseInt(e.drawTime),i=new Date(t),a=!1,h=c.displayArea.allDates.length-1;0<=h;--h)if(c.displayArea.allDates[h]<i){e.selectedItem=c.displayArea.allSeries[0].get("elements")[h],a=!0;break}a&&(s=e.selectedItem.get("quoteDate").getTime(),r=(c.displayArea.allSeries[0].get("elements").length>e.selectedItem.get("index")+1?c.displayArea.allSeries[0].get("elements")[e.selectedItem.get("index")+1].get("quoteDate"):Helpers.getNextDate(e.selectedItem.get("quoteDate"),c.model.get("granularity"))).getTime(),e.xAddOn=(o-s)/(r-s),e.drawTime=s+(r-s)*e.xAddOn)})}),_.each(m,function(e){c.allAnnotations.push(e),c.filteredAnnotations.push(e),-1<(t=c.scalePendingAnnotations.indexOf(e))&&c.scalePendingAnnotations.splice(t,1)}),this.scalePendingAnnotations.length<=0&&(this.scalingPending=!1))},Eg.prototype.setDecimals=function(e){e&&(this.fixedSize=e)},Eg.prototype.startDrawing=function(e){this.isDrawing=!0,this.drawTool={tool:e.tool,lineThickness:e.lineThickness,lineColorDef:e.lineColor,lineOpacity:e.strokeOpacity,fillColorDef:e.fillColor,fillOpacity:e.fillOpacity,textMargin:7,textSize:12};var t=Helpers.hexToRgb(e.lineColor);this.drawTool.lineColor="rgba("+t.r+","+t.g+","+t.b+","+e.strokeOpacity/100+")",t=Helpers.hexToRgb(e.fillColor),this.drawTool.fillColor="rgba("+t.r+","+t.g+","+t.b+","+e.fillOpacity/100+")",this.drawTool.textColor=this.drawTool.lineColorDef},Eg.prototype.stopDrawing=function(){this.isDrawing=!1,this.isDrawingStarted=!1,this.drawStartPoint=null,this.drawEndPoint=null;var e=this.$drawingCanvas[0].getContext("2d"),t=this.$drawingCanvas[0].width,i=this.$drawingCanvas[0].height;e.clearRect(0,0,t,i)},Eg.prototype.undoAnnotations=function(){var e=this.allAnnotations.pop();e&&(this.removedAnnotations.push(e),this.filteredAnnotations=_.without(this.filteredAnnotations,e),this.displayArea.updateDisplayMinMaxLength(),this.displayArea.updateDisplay()),this.updateAnnotationsStorage()},Eg.prototype.updateAnnotationsStorage=function(){var e;this.enableSave&&!this.applyingAnnotations&&(this.allAnnotations.length<=0?this.model.set("savedAnnotations",""):(e=_.map(this.allAnnotations,function(e){return{drawTool:e.drawTool,drawStartPoint:{selectedPrice:e.drawStartPoint.selectedPrice,x:e.drawStartPoint.x,y:e.drawStartPoint.y,xAddOn:e.drawStartPoint.xAddOn,selectedItemQuoteDate:e.drawStartPoint.selectedItem.get("quoteDate").valueOf()},drawEndPoint:e.drawEndPoint?{selectedPrice:e.drawEndPoint.selectedPrice,x:e.drawEndPoint.x,y:e.drawEndPoint.y,xAddOn:e.drawEndPoint.xAddOn,selectedItemQuoteDate:e.drawEndPoint.selectedItem.get("quoteDate").valueOf()}:null,drawEndTime:e.drawEndTime,drawStartTime:e.drawStartTime,extendFuture:e.extendFuture,extendPast:e.extendPast,currentHeight:e.currentHeight,notePoints:e.notePoints?_.map(e.notePoints,function(e){return{selectedPrice:e.selectedPrice,x:e.x,y:e.y,xAddOn:e.xAddOn,selectedItemQuoteDate:e.selectedItem.get("quoteDate").valueOf()}}):null,text:e.text}}),this.model.set("savedAnnotations",JSON.stringify(e))))},Eg);function Eg(e,t,i,a,n){var o=this;this.allAnnotations=[],this.filteredAnnotations=[],this.removedAnnotations=[],this.scalePendingAnnotations=[],this.model=a,this.isDrawing=!1,this.isDrawingStarted=!1,this.clipboard=null,this.drawStartPoint=null,this.drawEndPoint=null,this.drawTool=null,this.fixedSize=i,this.lastxRatio=null,this.lastDisplayFromIndex=null,this.showCrosshair=!0,this.cursor="default",this.activeItem=null,this.transformPointRadius=7,this.transformPointStrokeWidth=1,this.isTransforming=!1,this.disableAnnotations=!1,this.refreshPending=!1,this.isCanvasClear=!0,this.applyingAnnotations=!1,this.enableSave=n,this.displayArea=t,this.$drawingCanvas=e,this.$annotationsCanvas=t.$annotationsCanvas,this.allAnnotations=[],this.filteredAnnotations=[],this.removedAnnotations=[],this.scalePendingAnnotations=[],this.levels=null,this.openDialog=null,this.scalingPending=!1,this.currentSymbol=this.model.get("stockSymbol"),$(this.displayArea).on("dates-refreshed",function(){return o.scaleAnnotations()}),this.model.on("change:savedAnnotations",function(){return o.applyAnnotationsStorage()})}var ChartSeriesElement=(Rt=Backbone.Model,__extends(St,Rt),St.prototype.initialize=function(){this.set(St.defaults)},St.prototype.initialize2=function(){var t=this,e=(this.updateDirection(),this.listenTo(this,"change:close",function(){return t.updateDirection()}),this.listenTo(this,"change:open",function(){return t.updateDirection()}),[this.get("open"),this.get("high"),this.get("low"),this.get("close")]);_.each(e,function(e){e&&_.isNumber(e)&&!_.isNaN(e)&&_.isFinite(e)||(t.set("isValid",!1),t.set("isFake",!0),t.get("value")&&_.isNumber(t.get("value"))&&_.isFinite(t.get("value"))&&t.set("isFake",!1))})},St.prototype.updateDirection=function(){this.set("direction",this.get("close")>=this.get("open")?1:2)},St.defaults={open:null,high:null,low:null,close:null,value:null,quoteDate:null,isFake:!1,volume:null,isLiveElement:!1,index:null,letter:null,isInProfit:null,dateTag:null,direction:null,isValid:!0},St),Rt;function St(e){var t=Rt.call(this)||this;return t.set(e),t.initialize2(),t}var ChartDisplaySeries=(Yt=Backbone.Model,__extends(Zt,Yt),Zt.prototype.initialize=function(){this.set(Zt.defaults)},Zt.prototype.initialize2=function(){var e=this.get("elements").slice(-2);e&&1<e.length&&(e[0].get("value")>e[1].get("value")?this.set({lastChangeGreen:!1},{silent:!0}):this.set({lastChangeGreen:!0},{silent:!0}))},Zt.prototype.clearLiveElement=function(){this.get("liveElement")&&$(this.get("liveElement")).off(),this.set({liveElement:null})},Zt.prototype.addSeriesElement=function(e){this.get("elements").push(e)},Zt.prototype.addSeriesElements=function(e){var t=this;_.each(e,function(e){t.get("elements").push(e)})},Zt.prototype.addSeriesElementsInEnd=function(e){this.set({elements:this.get("elements").concat(e)});var e=e.length,t=this.get("displayFromIndex"),i=this.get("displayToIndex");this.set({displayFromIndex:t+e,displayToIndex:i+e})},Zt.prototype.addSeriesElementsInFront=function(e){this.set({elements:e.concat(this.get("elements"))});var e=e.length,t=this.get("displayFromIndex"),i=this.get("displayToIndex");this.set({displayFromIndex:t+e,displayToIndex:i+e})},Zt.prototype.setDisplayRange=function(e,t){this.set({displayFromIndex:e}),this.set({displayToIndex:t}),this.updateMinMax(e,t)},Zt.prototype.removeFakeElements=function(e){for(var t,i=this.get("elements").length,a=this.get("elements").length-1;0<=a;a--)if(!this.get("elements")[a].get("isFake")){t=a+1;break}e&&(t+=1);e=i-t;return 0<e?(this.set({elements:this.get("elements").slice(0,t)}),this.updateMinMax(null,null),e):0},Zt.prototype.replaceAndAddSeriesElements=function(e,t){for(var i=this.get("elements").length,a=t.length,n=0;n<a;n+=1)i<=n+e?this.get("elements").push(t[n]):this.get("elements")[n+e].set({open:t[n].get("open"),high:t[n].get("high"),low:t[n].get("low"),close:t[n].get("close"),value:t[n].get("value"),quoteDate:t[n].get("quoteDate"),volume:t[n].get("volume"),isFake:!1,isLiveElement:!1,letter:t[n].get("letter")});this.updateMinMax(null,null)},Zt.prototype.updateLiveElement=function(e,t,i,a,n,o,s){var r,l,d,c,h,p,e=(e+t)/2,t=this.get("elements")[this.get("elements").length-1];this.get("liveElement")?(r=this.get("liveElement").get("value"),l=this.get("liveElement").get("open"),h=d=this.get("liveElement").get("high"),p=c=this.get("liveElement").get("low"),n||(h=e<d?d:e),o||(p=c<e?c:e),this.get("liveElement").set({open:a||l,high:n||h,low:o||p,close:e,value:e,quoteDate:i||this.get("liveElement").get("quoteDate"),isLiveElement:!0}),e<r?this.set({lastChangeGreen:!1},{silent:!0}):this.set({lastChangeGreen:!0},{silent:!0}),this.updateMinMax(null,null)):(this.set({liveElement:new ChartSeriesElement({open:a||e,high:n||e,low:o||e,close:e,value:e,quoteDate:i,isLiveElement:!0})}),t.get("value")>e?this.set({lastChangeGreen:!1},{silent:!0}):this.set({lastChangeGreen:!0},{silent:!0})),s.onLiveElementValuesChanging({target:this})},Zt.prototype.updateMinMax=function(e,t){e&&t||(e=this.get("displayFromIndex"),t=this.get("displayToIndex")),-1===this.get("displayId")&&(n=!0);var i,a,n,o=this.get("elements").slice(e,t+1);switch(this.get("displayType")){case"Bar":case"Histogram":case"Kagi":case"Dots":case"Line":case"PivotLine":case"Mountain":i=Helpers.filteredMin(o,"value",n),_.isUndefined(i)&&(i=-1/0),a=Helpers.filteredMax(o,"value",n),_.isUndefined(a)&&(a=1/0);break;case"LineOpen":i=Helpers.filteredMin(o,"open",n),_.isUndefined(i)&&(i=-1/0),a=Helpers.filteredMax(o,"open",n),_.isUndefined(a)&&(a=1/0);break;case"LineHigh":i=Helpers.filteredMin(o,"high",n),_.isUndefined(i)&&(i=-1/0),a=Helpers.filteredMax(o,"high",n),_.isUndefined(a)&&(a=1/0);break;case"LineLow":i=Helpers.filteredMin(o,"low",n),_.isUndefined(i)&&(i=-1/0),a=Helpers.filteredMax(o,"low",n),_.isUndefined(a)&&(a=1/0);break;case"LineClose":i=Helpers.filteredMin(o,"close",n),_.isUndefined(i)&&(i=-1/0),a=Helpers.filteredMax(o,"close",n),_.isUndefined(a)&&(a=1/0);break;case"OHLCBar":case"ProfitArea":case"CandleStick":case"HeikinAshi":i=Helpers.filteredMin(o,"low",n),_.isUndefined(i)&&(i=-1/0),a=Helpers.filteredMax(o,"high",n),_.isUndefined(a)&&(a=1/0);break;default:throw new Error("Series require a display type.")}e=this.get("markers");e&&0<e.length&&(i=Math.min.apply(null,_.union([i],this.get("markers"))),a=Math.max.apply(null,_.union([a],this.get("markers")))),a+=1e-4*(a-(i-=1e-4*(a-i))),(t=_.find(o,function(e){return e.get("value")}))?(t=t.get("value"),this.set({seriesMax:a,seriesMin:i,percentBase:t,percentMin:(i-t)/t,percentMax:(a-t)/t})):this.set({seriesMax:a,seriesMin:i,percentBase:null,percentMin:null,percentMax:null})},Zt.defaults={displayName:null,displayType:null,displayColor:null,lineThickness:1,elements:null,liveElement:null,seriesMax:null,seriesMin:null,displayId:-1,displayFromIndex:null,displayToIndex:null,lastChangeGreen:null,displayArea:null,profitColor:null,lossColor:null,percentBase:null,percentMin:null,percentMax:null},Zt),Yt;function Zt(e){var t=Yt.call(this)||this;return t.set(e),t.initialize2(),t}for(var Xu=0,Yu=["ms","moz","webkit","o"],Zu=0;Zu<Yu.length&&!window.requestAnimationFrame;++Zu)window.requestAnimationFrame=window[Yu[Zu]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[Yu[Zu]+"CancelAnimationFrame"]||window[Yu[Zu]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,t){var i=(new Date).getTime(),a=Math.max(0,16-(i-Xu)),n=window.setTimeout(function(){e(i+a)},a);return Xu=i+a,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)});var DisplayArea=(ev=Backbone.View,__extends(fv,ev),fv.prototype.addSeries=function(e,t){var i=this;this.allSeries.push(e),e.set({displayArea:this}),t&&(this.seriesMarkers=this.seriesMarkers.concat(t)),this.refreshDates(),e.on("change:liveElement",function(e){return i.onLiveElementChanged(e)}),this.newSeriesAdded=!0},fv.prototype.removeSeries=function(e){for(var t=e?e.displaySeries.length:0,i=0;i<t;i+=1)this.allSeries=_.without(this.allSeries,e.displaySeries[i]),e.displaySeries[i].off()},fv.prototype.applyLayout=function(){var e=this.$el.width(),t=this.$el.height();this.updateDisplayMinMaxLength(),this.xRatio=e/this.elementsCount,this.yRatio=t/(this.max-this.min),this.$mainCanvas.prop("width",e),this.$mainCanvas.prop("height",t),this.$mainCanvas.css({height:t,width:e}),this.$preRenderCanvas.prop("width",e),this.$preRenderCanvas.prop("height",t),this.$preRenderCanvas.css({height:t,width:e}),this.mainCanvasHeight=t,this.mainCanvasWidth=e,this.mainCanvasOffset=this.$mainCanvas.offset(),this.$annotationsCanvas.prop("width",e),this.$annotationsCanvas.prop("height",t),this.$annotationsCanvas.css({height:t,width:e}),this.$liveElementsCanvas.prop("height",t),this.$liveElementsCanvas.css({height:t}),this.isLayoutApplied=!0,this.isDisplayPending&&this.updateDisplay()},fv.prototype.applyTemplate=function(){this.$el.html(T.DisplayArea()),this.$mainCanvas=this.$el.find(".MainCanvas"),this.mainCanvasContext=this.$mainCanvas[0].getContext("2d"),this.$preRenderCanvas=$(document.createElement("canvas")),this.preRenderCanvasContext=this.$preRenderCanvas[0].getContext("2d"),this.$annotationsCanvas=this.$el.find(".AnnotationsCanvas"),this.$liveElementsCanvas=this.$el.find(".LiveElementsCanvas")},fv.prototype.calculateDisplayValues=function(e,t){var i=this.$el,a=this.niceNum(t-e,!1),i=Math.floor(i.height()/26),n=this.niceNum(a/(i-1),!0),a=Math.floor(e/n)*n,o=null,s=a=e<a?e:a;if(_.isFinite(e)&&_.isFinite(t)&&(o=[],e!==t))if(1<i)if(this.model.get("autoZoomY"))for(o.push(a);o.push(s+=n),s<t;);else for(;s+n<t;)o.push(s+=n);else o=[e,t];return _.last(o)<t&&o.push(t),o},fv.prototype.clear=function(){var e,t,i;this.isLayoutApplied&&(e=this.mainCanvasContext,t=this.mainCanvasWidth,i=this.mainCanvasHeight,e.clearRect(0,0,t,i),this.$liveElementsCanvas&&(t=this.$liveElementsCanvas.prop("width"),i=this.$liveElementsCanvas.prop("height"),(e=this.$liveElementsCanvas[0].getContext("2d")).clearRect(0,0,t,i)),this.allDates=[],_.each(this.allSeries,function(e){e.off()}),this.allSeries=[],this.seriesMarkers=[],this.elementsCount=null,this.min=null,this.max=null,this.xRatio=null,this.yRatio=null,this.wasCleared=!0)},fv.prototype.displaySeries=function(e,t){var i,a=this;if(!this.drawingLocked&&(-1!==t&&-1!==e||(e=this.displayFromIndex,t=this.displayToIndex),this.hasDatesRangeChanged=this.displayFromIndex!==e||this.displayToIndex!==t,this.hasDatesRangeChanged||this.newSeriesAdded)){if(this.displayFromIndex=e,this.displayToIndex=t,this.invalid=!0,_.each(this.allSeries,function(e){e.setDisplayRange(a.displayFromIndex,a.displayToIndex)}),this.updateDisplayMinMaxLength(),this.updateRatios(),this.isDisplayPending=!0,this.isLiveElementEnabled&&this.isLastElementOnDisplay()){for(this.isLiveElementsCanvasVisible=!0,this.liveCanvasWidht=Math.round(2*this.xRatio),this.lastItemIndex=this.allSeries[0].get("elements").length-1,i=this.displayToIndex;0<=i;--i)if(!this.allSeries[0].get("elements")[i].get("isFake")){this.lastItemIndex=i-this.displayFromIndex;break}}else this.isLiveElementsCanvasVisible=!1;this.updateDisplay()}},fv.prototype.updateDisplay=function(){var e,t=this;if(!this.drawingLocked){var i=this.preRenderCanvasContext,a=this.mainCanvasWidth,n=this.mainCanvasHeight,o=(i.clearRect(0,0,a,n),this.allSeries.length);if(0<o)for(e=0;e<o;e+=1)switch(this.allSeries[e].get("displayType")){case"Bar":this.drawBarSeries(i,this.allSeries[e]);break;case"Kagi":this.drawKagiSeries(i,this.allSeries[e]);break;case"CandleStick":this.drawCandleStickSeries(i,this.allSeries[e]);break;case"Histogram":this.drawHistogramSeries(i,this.allSeries[e]);break;case"Line":this.drawLineSeries2(i,this.allSeries[e],"value");break;case"LineOpen":this.drawLineSeries2(i,this.allSeries[e],"open");break;case"LineHigh":this.drawLineSeries2(i,this.allSeries[e],"high");break;case"LineLow":this.drawLineSeries2(i,this.allSeries[e],"low");break;case"LineClose":this.drawLineSeries2(i,this.allSeries[e],"close");break;case"OHLCBar":this.drawOHLCBarSeries(i,this.allSeries[e]);break;case"Dots":this.drawDotSeries(i,this.allSeries[e]);break;case"ProfitArea":this.drawProfitAreaSeries(i,this.allSeries[e]);break;case"HeikinAshi":this.drawHeikinAshiSeries(i,this.allSeries[e]);break;case"PivotLine":this.drawPivotLineSeries(i,this.allSeries[e]);break;case"Mountain":this.drawMountainLineSeries(i,this.allSeries[e]);break;default:throw new Error("Series require a display type.")}this.annotationsManager.drawAnnotations(this.xRatio,this.displayFromIndex),this.isDisplayPending=!1,this.invalid=!0,requestAnimationFrame(function(){return t.displayUpdated()})}},fv.prototype.displayUpdated=function(){var e;this.invalid&&(this.invalid=!1,this.mainCanvasContext.clearRect(0,0,this.mainCanvasWidth,this.mainCanvasHeight),this.mainCanvasContext.drawImage(this.$preRenderCanvas[0],0,0),this.isLiveElementsCanvasVisible?(this.$liveElementsCanvas.prop("width",this.liveCanvasWidht),e={width:this.liveCanvasWidht,left:this.lastItemIndex*this.xRatio,display:"block"},this.liveCanvasDisplayed=!0,this.$liveElementsCanvas.css(e),this.updateLiveElementsCanvas(),this.isLiveElementsCanvasVisible=!0):this.hideLiveElementsCanvas(),$(this).trigger("displayUpdated"))},fv.prototype.drawBar=function(e,t,i,a){null===a||a.get("value")>i.get("value")?e.fillStyle=this.model.get("redColor"):e.fillStyle=this.model.get("greenColor");var a=this.xRatio*t+.07*this.xRatio,t=this.xRatio*(t+1)-.07*this.xRatio,n=this.getValuePosition(i.get("value"));e.fillRect(Math.floor(a)+.5,Math.floor(n)+.5,Math.floor(t-a)+.5,Math.floor(this.$mainCanvas[0].height-n)+.5),i.bounds={left:a,top:n,right:t,bottom:this.$mainCanvas[0].height}},fv.prototype.drawBarSeries=function(e,t){var i,a;for(this.drawBar(e,0,t.get("elements")[this.displayFromIndex],null),i=t.get("elements")[this.displayFromIndex],a=this.displayFromIndex+1;a<=this.displayToIndex;a+=1)this.drawBar(e,a-this.displayFromIndex,t.get("elements")[a],i),i=t.get("elements")[a]},fv.prototype.drawCandleStick=function(e,t,i,a){var n,o,s,r,l,d,c,h=[];i&&(n=1===i.get("direction")?(e.strokeStyle=this.model.get("chartDisplayAreaCandleStickUpStroke"),e.fillStyle=this.model.get("chartDisplayAreaCandleStickUpFill"),this.model.get("chartDisplayAreaCandleStickUpIsHollow")):(e.strokeStyle=this.model.get("chartDisplayAreaCandleStickDownStroke"),e.fillStyle=this.model.get("chartDisplayAreaCandleStickDownFill"),!1),h[0]=this.getValuePosition(i.get("open"),a),h[1]=this.getValuePosition(i.get("high"),a),h[2]=this.getValuePosition(i.get("low"),a),h[3]=this.getValuePosition(i.get("close"),a),h=_.sortBy(h,function(e){return e}),a=Math.floor(this.xRatio*(t+1)-this.xRatio/2)+.5,o=this.xRatio*t+.07*this.xRatio,t=this.xRatio*(t+1)-.07*this.xRatio,r=(s=Math.floor(h[1])+.5)+Math.floor(h[2]-h[1]),(l=Math.floor(r-s))<1&&(l=1),d=Math.floor(o)+.5,c=Math.floor(t-o),e.strokeRect(d,s,c,l),n||e.fillRect(d,s,c,l),e.beginPath(),e.moveTo(a,Math.floor(h[0])+.5),e.lineTo(a,s),e.stroke(),e.beginPath(),e.moveTo(a,r),e.lineTo(a,Math.floor(h[3])+.5),e.stroke(),i.bounds={left:o,top:h[0],right:t,bottom:h[3]})},fv.prototype.calcCandleStick=function(e,t,i){var a=[],i=(a[0]=this.getValuePosition(t.get("open"),i),a[1]=this.getValuePosition(t.get("high"),i),a[2]=this.getValuePosition(t.get("low"),i),a[3]=this.getValuePosition(t.get("close"),i),a=_.sortBy(a,function(e){return e}),Math.floor(this.xRatio*(e+1)-this.xRatio/2)+.5),n=this.xRatio*e+.07*this.xRatio,e=this.xRatio*(e+1)-.07*this.xRatio,o=Math.floor(a[1])+.5,s=o+Math.floor(a[2]-a[1]),r=Math.floor(s-o),l=(r<1&&(r=1),Math.floor(n)+.5),d=Math.floor(e-n);t.bounds={left:n,top:a[0],right:e,bottom:a[3],newLeft:l,newTop:o,newRight:d,newBottom:s,newMiddle:i,newHeight:r}},fv.prototype.drawCandleStickSeries=function(e,t){for(var i,a,n="percent"===this.model.get("stockDisplayValues")?t.get("percentBase"):null,o=t.get("elements"),s=this.displayFromIndex;s<=this.displayToIndex;s+=1)(i=o[s])&&i.get("isValid")&&this.calcCandleStick(s-this.displayFromIndex,i,n);for(e.fillStyle=this.model.get("chartDisplayAreaCandleStickDownFill"),s=this.displayFromIndex;s<=this.displayToIndex;s+=1)(i=o[s])&&2===i.get("direction")&&i.get("isValid")&&(a=i.bounds,e.fillRect(a.newLeft,a.newTop,a.newRight,a.newHeight));if(!this.model.get("chartDisplayAreaCandleStickUpIsHollow"))for(e.fillStyle=this.model.get("chartDisplayAreaCandleStickUpFill"),s=this.displayFromIndex;s<=this.displayToIndex;s+=1)(i=o[s])&&1===i.get("direction")&&i.get("isValid")&&(a=i.bounds,e.fillRect(a.newLeft,a.newTop,a.newRight,a.newHeight));for(e.lineWidth=1,e.strokeStyle=this.model.get("chartDisplayAreaCandleStickDownStroke"),e.beginPath(),s=this.displayFromIndex;s<=this.displayToIndex;s+=1)(i=o[s])&&2===i.get("direction")&&i.get("isValid")&&(a=i.bounds,e.moveTo(a.newMiddle,Math.floor(a.top)+.5),e.lineTo(a.newMiddle,a.newTop),e.moveTo(a.newMiddle,a.newBottom),e.lineTo(a.newMiddle,Math.floor(a.bottom)+.5),e.strokeRect(a.newLeft,a.newTop,a.newRight,a.newHeight));for(e.stroke(),e.strokeStyle=this.model.get("chartDisplayAreaCandleStickUpStroke"),e.beginPath(),s=this.displayFromIndex;s<=this.displayToIndex;s+=1)(i=o[s])&&1===i.get("direction")&&i.get("isValid")&&(a=i.bounds,e.moveTo(a.newMiddle,Math.floor(a.top)+.5),e.lineTo(a.newMiddle,a.newTop),e.moveTo(a.newMiddle,a.newBottom),e.lineTo(a.newMiddle,Math.floor(a.bottom)+.5),e.strokeRect(a.newLeft,a.newTop,a.newRight,a.newHeight));e.stroke()},fv.prototype.drawDot=function(e,t,i,a,n){i.x=this.xRatio*t+this.xRatio/2,i.y=this.getValuePosition(i.get("value")),e.beginPath(),e.arc(i.x,i.y,n,0,2*Math.PI,!1),a?(e.fillStyle=a,e.strokeStyle=a):this.allSeries[0].get("elements")[this.displayFromIndex+t].get("value")<i.get("value")?(e.fillStyle=this.model.get("redColor"),e.strokeStyle=this.model.get("redColor")):(e.fillStyle=this.model.get("greenColor"),e.strokeStyle=this.model.get("greenColor")),e.fill(),e.stroke(),i.bounds={left:this.xRatio*t,top:this.getValuePosition(i.get("value")),right:this.xRatio*(t+1),bottom:this.getValuePosition(i.get("value"))}},fv.prototype.drawDotSeries=function(e,t){for(var i,a=t.get("elements"),n=t.get("displayColor"),o=t.get("lineThickness"),s=this.displayFromIndex+1;s<=this.displayToIndex;s+=1)(i=a[s]).get("isFake")||this.drawDot(e,s-this.displayFromIndex,i,n,o)},fv.prototype.drawHeikinAshi=function(e,t,i,a,n,o){void 0===o&&(o=0);var s,r,l=[],d=(0===t?(s=(i.get("open")+i.get("close"))/2,d=i.get("high"),c=i.get("low"),r=(i.get("open")+i.get("high")+i.get("low")+i.get("close"))/4):(s=(n.open+n.close)/2,r=(i.get("open")+i.get("high")+i.get("low")+i.get("close"))/4,d=Math.max(i.get("high"),s,r),c=Math.min(i.get("low"),s,r)),n=s<=r?(e.strokeStyle=this.model.get("chartDisplayAreaCandleStickUpStroke"),e.fillStyle=this.model.get("chartDisplayAreaCandleStickUpFill"),this.model.get("chartDisplayAreaCandleStickUpIsHollow")):(e.strokeStyle=this.model.get("chartDisplayAreaCandleStickDownStroke"),e.fillStyle=this.model.get("chartDisplayAreaCandleStickDownFill"),!1),l[0]=this.getValuePosition(s,o),l[1]=this.getValuePosition(d,o),l[2]=this.getValuePosition(c,o),l[3]=this.getValuePosition(r,o),l=_.sortBy(l,function(e){return e}),Math.floor(this.xRatio*(t+1)-this.xRatio/2)+.5),c=this.xRatio*t+.07*this.xRatio,o=this.xRatio*(t+1)-.07*this.xRatio,t=Math.floor(l[1])+.5,h=t+Math.floor(l[2]-l[1]),p=Math.floor(h-t),u=(p<1&&(p=1),Math.floor(c)+.5),m=Math.floor(o-c);return e.strokeRect(u,t,m,p),n||e.fillRect(u,t,m,p),e.beginPath(),e.moveTo(d,Math.floor(l[0])+.5),e.lineTo(d,t),e.stroke(),e.beginPath(),e.moveTo(d,h),e.lineTo(d,Math.floor(l[3])+.5),e.stroke(),i.bounds={left:c,top:l[0],right:o,bottom:l[3]},i.hashi={open:s,close:r},i.hashi},fv.prototype.drawHeikinAshiSeries=function(e,t){var i=t.get("elements")[this.displayFromIndex],a="percent"===this.model.get("stockDisplayValues")?t.get("percentBase"):null;if(t&&i){e.lineWidth=1;for(var n=this.drawHeikinAshi(e,0,i,null,null),o=i,s=t.get("elements").length,r=this.displayFromIndex+1;r<=this.displayToIndex&&r<s;r+=1)t.get("elements")[r].get("isFake")||(i=t.get("elements")[r],n=this.drawHeikinAshi(e,r-this.displayFromIndex,i,o,n,a),o=i)}},fv.prototype.drawHistogram=function(e,t,i,a,n){var o;if(i){if(n)switch(n){case"relative":null===a||a.get("value")>i.get("value")?e.fillStyle=this.model.get("redColor"):e.fillStyle=this.model.get("greenColor");break;case"absolute":i.get("value")<0?e.fillStyle=this.model.get("redColor"):e.fillStyle=this.model.get("greenColor");break;default:e.fillStyle=n}else null===a||a.get("value")>i.get("value")?e.fillStyle=this.model.get("redColor"):e.fillStyle=this.model.get("greenColor");var s=this.xRatio*t+.07*this.xRatio,t=this.xRatio*(t+1)-.07*this.xRatio,r=0<i.get("value")?(o=this.getValuePosition(i.get("value")),this.getValuePosition(0)):(o=this.getValuePosition(0),this.getValuePosition(i.get("value")));e.fillRect(Math.floor(s)+.5,Math.floor(o)+.5,Math.floor(t-s)+.5,Math.floor(r-o)+.5),i.bounds={left:s,top:o,right:t,bottom:r}}},fv.prototype.drawHistogramSeries=function(e,t){var i,a;for(this.drawHistogram(e,0,t.get("elements")[this.displayFromIndex],null,t.get("displayColor")),(a=t.get("elements")[this.displayFromIndex])&&a.get("isFake")&&(a=null),i=this.displayFromIndex+1;i<=this.displayToIndex;i+=1)t.get("elements")[i]&&!t.get("elements")[i].get("isFake")&&(this.drawHistogram(e,i-this.displayFromIndex,t.get("elements")[i],a,t.get("displayColor")),a=t.get("elements")[i])},fv.prototype.drawKagi=function(e,t,i,a,n,o,s){void 0===s&&(s=0),o.isThick&&i.get("close")>=a.get("close")?(e.strokeStyle=this.model.get("chartDisplayAreaKagiUpColor"),e.lineWidth=2,e.beginPath(),e.moveTo(this.xRatio*(t-1)+this.xRatio/2,this.getValuePosition(a.get("close"),s)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(i.get("close"),s)),e.stroke(),o.limitValue=i.get("close")):o.isThick&&i.get("close")<a.get("close")?(e.strokeStyle=this.model.get("chartDisplayAreaKagiUpColor"),e.lineWidth=2,o.limitValue-i.get("close")>n?i.get("close")<a.get("low")?(e.beginPath(),e.moveTo(this.xRatio*(t-1)+this.xRatio/2,this.getValuePosition(a.get("close"),s)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(a.get("close"),s)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(a.get("low"),s)),e.stroke(),e.beginPath(),e.strokeStyle=this.model.get("chartDisplayAreaKagiDownColor"),e.lineWidth=1,e.moveTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(a.get("low"),s)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(i.get("close"),s)),e.stroke(),o.isThick=!1,o.limitValue=i.get("close")):(e.beginPath(),e.moveTo(this.xRatio*(t-1)+this.xRatio/2,this.getValuePosition(a.get("close"),s)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(a.get("close"),s)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(i.get("close"),s)),e.stroke()):(e.beginPath(),e.moveTo(this.xRatio*(t-1)+this.xRatio/2,this.getValuePosition(a.get("close"),s)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(i.get("close"),s)),e.stroke())):!o.isThick&&i.get("close")<=a.get("close")?(e.strokeStyle=this.model.get("chartDisplayAreaKagiDownColor"),e.lineWidth=1,e.beginPath(),e.moveTo(this.xRatio*(t-1)+this.xRatio/2,this.getValuePosition(a.get("close"),s)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(i.get("close"),s)),e.stroke(),o.limitValue=i.get("close")):!o.isThick&&i.get("close")>a.get("close")&&(e.strokeStyle=this.model.get("chartDisplayAreaKagiDownColor"),e.lineWidth=1,i.get("close")-o.limitValue>n?i.get("close")>a.get("high")?(e.beginPath(),e.moveTo(this.xRatio*(t-1)+this.xRatio/2,this.getValuePosition(a.get("close"),s)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(a.get("close"),s)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(a.get("high"),s)),e.stroke(),e.beginPath(),e.strokeStyle=this.model.get("chartDisplayAreaKagiUpColor"),e.lineWidth=2,e.moveTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(a.get("high"),s)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(i.get("close"),s)),e.stroke(),o.isThick=!0,o.limitValue=i.get("close")):(e.beginPath(),e.moveTo(this.xRatio*(t-1)+this.xRatio/2,this.getValuePosition(a.get("close"),s)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(a.get("close"),s)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(i.get("close"),s)),e.stroke()):(e.beginPath(),e.moveTo(this.xRatio*(t-1)+this.xRatio/2,this.getValuePosition(a.get("close"),s)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(i.get("close"),s)),e.stroke())),e.fillStyle=e.strokeStyle,i.bounds={left:this.xRatio*t,top:this.getValuePosition(i.get("high"),s),right:this.xRatio*(t+1),bottom:this.getValuePosition(i.get("low"),s)}},fv.prototype.drawKagiSeries=function(e,t){var i,a,n,o="percent"===this.model.get("stockDisplayValues")?t.get("percentBase"):null;if(t&&t.get("elements").length>=this.displayFromIndex){i=t.get("elements")[this.displayFromIndex].get("close"),a=.05*(this.max-this.min),n={isThick:null,limitValue:null},t.get("elements")[this.displayFromIndex+1].get("close")>=i?n.isThick=!0:n.isThick=!1,n.limitValue=t.get("elements")[this.displayFromIndex].get("close");for(var s=t.get("elements")[this.displayFromIndex],r=t.get("elements").length,l=this.displayFromIndex+1;l<=this.displayToIndex&&l<r;l+=1)t.get("elements")[l].get("isFake")||(this.drawKagi(e,l-this.displayFromIndex,t.get("elements")[l],s,a,n,o),s=t.get("elements")[l]);this.lastKagiArgs={isThick:n.isThick,limitValue:n.limitValue,kagiBasePrice:i,kagiReversalValue:a}}},fv.prototype.drawLine=function(e,t,i,a,n,o,s){var r=i.get(s=void 0===(s=void 0===s?"value":s)||"value"!==s&&"open"!==s&&"high"!==s&&"low"!==s&&"close"!==s?"value":s),o=this.getValuePosition(r,o);n?e.strokeStyle=n:null===a||a.get(s)>r?e.strokeStyle=this.model.get("chartDisplayAreaLineDownColor"):e.strokeStyle=this.model.get("chartDisplayAreaLineUpColor"),i.x=this.xRatio*t+this.xRatio/2,i.y=o,null===a?e.moveTo(i.x,i.y):(e.beginPath(),e.moveTo(a.x,a.y),e.lineTo(i.x,i.y),e.stroke()),i.bounds={left:this.xRatio*t,top:o,right:this.xRatio*(t+1),bottom:o}},fv.prototype.drawLine2=function(e,t,i,a,n,o){i&&(o=i.get(o),o=this.getValuePosition(o,n),i.x=this.xRatio*t+this.xRatio/2,i.y=o,a?(e.moveTo(a.x,a.y),e.lineTo(i.x,i.y)):e.moveTo(i.x,i.y),i.bounds={left:this.xRatio*t,top:o,right:this.xRatio*(t+1),bottom:o})},fv.prototype.drawLineSeries=function(e,t,i){var a,n,o,s=t.get("displayColor"),r="percent"===this.model.get("stockDisplayValues")?t.get("percentBase"):null;if(t&&t.get("elements").length>=this.displayFromIndex)for((void 0===i||"value"!==i&&"open"!==i&&"high"!==i&&"low"!==i&&"close"!==i)&&(i="value"),e.lineWidth=t.get("lineThickness"),o=t.get("elements")[this.displayFromIndex],this.drawLine(e,0,o,null,s,r,i),(n=o).get("isFake")&&(n=null),"ZigZag Line"===t.get("displayName")&&null===t.get("elements")[this.displayFromIndex+1].get("value")&&(this.drawLine(e,1,this.allSeries[0].get("elements")[this.displayFromIndex+1],null,s,r,"value"),n=this.allSeries[0].get("elements")[this.displayFromIndex+1]),a=this.displayFromIndex+1;a<=this.displayToIndex;a+=1)(o=t.get("elements")[a])&&!o.get("isFake")&&(this.drawLine(e,a-this.displayFromIndex,o,n,s,r,i),n=o)},fv.prototype.drawLineSeries2=function(e,t,i){var a,n,o,s,r=t.get("displayColor"),l="percent"===this.model.get("stockDisplayValues")?t.get("percentBase"):null;if(t&&t.get("elements").length>=this.displayFromIndex)if(e.lineWidth=t.get("lineThickness"),o=t.get("elements")[this.displayFromIndex],this.drawLine2(e,0,o,null,l,i),n=o&&o.get("isFake")?null:o,"ZigZag Line"===t.get("displayName")&&null===t.get("elements")[this.displayFromIndex+1].get("value")&&(this.drawLine(e,1,this.allSeries[0].get("elements")[this.displayFromIndex+1],null,r,l,"value"),n=this.allSeries[0].get("elements")[this.displayFromIndex+1]),r=r||this.model.get("chartDisplayAreaLineUpColor")!==this.model.get("chartDisplayAreaLineDownColor")?r:this.model.get("chartDisplayAreaLineUpColor")){for(e.strokeStyle=r,e.beginPath(),a=this.displayFromIndex+1;a<=this.displayToIndex;a+=1)(o=t.get("elements")[a])&&!o.get("isFake")&&(this.drawLine2(e,a-this.displayFromIndex,o,n,l,i),n=o);e.stroke()}else{for(e.strokeStyle=this.model.get("chartDisplayAreaLineUpColor"),e.beginPath(),a=this.displayFromIndex+1;a<=this.displayToIndex;a+=1)(o=t.get("elements")[a])&&n&&!o.get("isFake")&&((s=n.get(i))<=o.get(i)?this.drawLine2(e,a-this.displayFromIndex,o,n,l,i):this.drawLine2(e,a-this.displayFromIndex,o,null,l,i)),n=o;for(e.stroke(),e.strokeStyle=this.model.get("chartDisplayAreaLineDownColor"),e.beginPath(),a=this.displayFromIndex+1;a<=this.displayToIndex;a+=1)(o=t.get("elements")[a])&&n&&!o.get("isFake")&&(s=n.get(i),o.get(i)<s?this.drawLine2(e,a-this.displayFromIndex,o,n,l,i):this.drawLine2(e,a-this.displayFromIndex,o,null,l,i)),n=o;e.stroke()}},fv.prototype.drawMountainLineSeries=function(e,t){var i,a,n,o,s=t.get("displayColor"),r=[],l="percent"===this.model.get("stockDisplayValues")?t.get("percentBase"):null;if(t&&t.get("elements").length>=this.displayFromIndex){for(e.lineWidth=t.get("lineThickness"),n=t.get("elements")[this.displayFromIndex],this.drawLine(e,0,n,null,s,l),(a=n).x=.5*this.xRatio,a.y=this.getValuePosition(a.get("close")),a.get("isFake")&&(a=null),r.push(a),i=this.displayFromIndex+1;i<=this.displayToIndex;i+=1)(n=t.get("elements")[i])&&!n.get("isFake")&&(n.x=this.xRatio*(i-this.displayFromIndex)+this.xRatio/2,n.y=this.getValuePosition(n.get("close"),l),this.drawLine(e,i-this.displayFromIndex,n,a,s,l,"value"),a=n,r.push(n));if(e.fillStyle="rgba(127, 127, 127, 0.3)",a){for(e.moveTo(a.x,a.y);null!==(o=r.pop())&&o;)e.lineTo(o.x,o.y);e.lineTo(.5*this.xRatio,this.getValuePosition(this.min)),e.lineTo(a.x,this.getValuePosition(this.min)),e.closePath(),e.fillStyle="rgba(127, 127, 127, 0.3)",e.fill()}}},fv.prototype.drawOHLCBar=function(e,t,i,a){var n,o,s,r,l;void 0===a&&(a=0),i&&(i.get("open")<=i.get("close")?e.strokeStyle=this.model.get("chartDisplayAreaBarUpColor"):e.strokeStyle=this.model.get("chartDisplayAreaBarDownColor"),n=this.getValuePosition(i.get("open"),a),o=this.getValuePosition(i.get("high"),a),s=this.getValuePosition(i.get("low"),a),a=this.getValuePosition(i.get("close"),a),r=this.xRatio*(t+1)-this.xRatio/2,l=this.xRatio*t+.07*this.xRatio,t=this.xRatio*(t+1)-.07*this.xRatio,e.beginPath(),e.moveTo(Math.floor(r)+.5,Math.floor(o)+.5),e.lineTo(Math.floor(r)+.5,Math.floor(s)+.5),e.moveTo(Math.floor(l)+.5,Math.floor(n)+.5),e.lineTo(Math.floor(r)+.5,Math.floor(n)+.5),e.moveTo(Math.floor(r)+.5,Math.floor(a)+.5),e.lineTo(Math.floor(t)+.5,Math.floor(a)+.5),e.stroke(),e.fillStyle=e.strokeStyle,i.bounds={left:l,top:o,right:t,bottom:s})},fv.prototype.drawOHLCBarSeries=function(e,t){var i,a="percent"===this.model.get("stockDisplayValues")?t.get("percentBase"):null;for(e.lineWidth=1,i=this.displayFromIndex;i<=this.displayToIndex;i+=1)this.drawOHLCBar(e,i-this.displayFromIndex,t.get("elements")[i],a)},fv.prototype.drawPivotLine=function(e,t,i,a,n,o,s,r,l){void 0===s&&(s=0),void 0===r&&(r=0),void 0===l&&(l="");var d,c;i&&(d=i.get("value"),d=this.getValuePosition(d,o),c=this.model.get("mainChartAreaValuesAxisDecimalPlaces"),n?e.strokeStyle=n:(s||i.get("value"))<this.allSeries[0].get("elements")[t+this.displayFromIndex].get("close")?e.strokeStyle=this.model.get("chartDisplayAreaLineDownColor"):e.strokeStyle=this.model.get("chartDisplayAreaLineUpColor"),i.x=this.xRatio*t+this.xRatio/2,i.y=d,null===a?e.moveTo(i.x,i.y):(e.beginPath(),e.moveTo(a.x,a.y),e.lineTo(i.x,i.y),e.stroke()),s&&r&&(e.font="12px Arial",e.fillStyle=e.strokeStyle,e.textBaseline="middle",e.textAlign="right",e.fillText((l?l+": ":"")+s.toFixed(c),i.x-1,this.getValuePosition(s,o)-6-1)),i.bounds={left:this.xRatio*t,top:d,right:this.xRatio*(t+1),bottom:d})},fv.prototype.drawPivotLineSeries=function(e,t){for(var i,a,n,o=0,s=t.get("displayColor"),r="percent"===this.model.get("stockDisplayValues")?t.get("percentBase"):null,l=(e.lineWidth=t.get("lineThickness"),n=t.get("elements")[this.displayFromIndex],this.drawPivotLine(e,0,n,null,s,r),i=n,{"Support 1":"S1","Support 2":"S2","Support 3":"S3","Resistance 1":"R1","Resistance 2":"R2","Resistance 3":"R3"}[t.get("displayName")]),d=this.displayFromIndex+1;d<=this.displayToIndex;d+=1)(n=t.get("elements")[d])&&n.get("isFake")&&(a=n.get("quoteDate"),(n=i.clone()).set("quoteDate",a)),n&&!n.get("isFake")&&(n.get("value")!==i.get("value")?(o=i.get("value"),i=null):o=0,d===this.displayToIndex-1&&(o=n.get("value")),this.drawPivotLine(e,d-this.displayFromIndex,n,i,s,r,o,t.get("displayPrices"),l),i=n)},fv.prototype.drawProfitAreaSeries=function(e,t){var i,a,n,o,s,r=[],l=t.get("elements"),d=l[this.displayFromIndex],c=d.get("isInProfit"),h=c?(e.fillStyle=t.get("profitColor"),a=d.get("high"),d.get("low")):(e.fillStyle=t.get("lossColor"),a=d.get("low"),d.get("high"));for(e.beginPath(),d.x=.5*this.xRatio,d.y=this.getValuePosition(a),d.y2=this.getValuePosition(h),e.moveTo(d.x,d.y),r.push(d),i=this.displayFromIndex+1;i<=this.displayToIndex;i+=1){if((n=l[i]).get("isFake")){for(;null!==(s=r.pop());)e.lineTo(s.x,s.y2);return e.closePath(),void e.fill()}if(h=n.get("isInProfit")?(a=n.get("high"),n.get("low")):(a=n.get("low"),n.get("high")),n.get("isInProfit")===c)n.x=this.xRatio*(i-this.displayFromIndex+.5),n.y=this.getValuePosition(a),n.y2=this.getValuePosition(h),e.lineTo(n.x,n.y),r.push(n);else if(c=n.get("isInProfit"),n.x=this.xRatio*(i-this.displayFromIndex+.5),n.y=this.getValuePosition(a),n.y2=this.getValuePosition(h),o=this.findIntersection(d.x,d.y,n.x,n.y,d.x,d.y2,n.x,n.y2)){for(e.lineTo(o[0],o[1]);null!==(s=r.pop());)e.lineTo(s.x,s.y2);e.closePath(),e.fill(),e.beginPath(),e.moveTo(o[0],o[1]),e.fillStyle=c?t.get("profitColor"):t.get("lossColor"),e.lineTo(n.x,n.y),r.push(n)}d=n}for(;null!==(s=r.pop());)e.lineTo(s.x,s.y2);o&&e.lineTo(o[0],o[1]),e.closePath(),e.fill()},fv.prototype.findIntersection=function(e,t,i,a,n,o,s,r){var l=a-t,d=e-i,c=i*t-e*a,h=l*n+d*o+c,p=l*s+d*r+c;if(0!=h&&0!=p&&0<=h*p&&t!==a&&t!==o&&t!==r&&a!==o&&a!==r&&o!==r)return null;var h=r-o,p=n-s,s=s*o-n*r,n=h*e+p*t+s,e=h*i+p*a+s;if(0!=n&&0!=e&&0<=n*e&&t!==a&&t!==o&&t!==r&&a!==o&&a!==r&&o!==r)return null;i=l*p-h*d;return 0==i?null:(n=i<0?-i/2:i/2,[(e=d*s-p*c)<0?(e-n)/i:(e+n)/i,(e=h*c-l*s)<0?(e-n)/i:(e+n)/i])},fv.prototype.getLiveElementValue=function(e){var t="max"===e?1/0:-1/0;switch(this.allSeries[0].get("displayType")){case"Bar":case"Histogram":case"Kagi":case"Dots":case"Line":case"PivotLine":case"Mountain":t=this.allSeries[0].get("liveElement").get("value");break;case"LineOpen":t=this.allSeries[0].get("liveElement").get("open");break;case"LineHigh":t=this.allSeries[0].get("liveElement").get("high");break;case"LineLow":t=this.allSeries[0].get("liveElement").get("low");break;case"LineClose":t=this.allSeries[0].get("liveElement").get("close");break;case"OHLCBar":case"ProfitArea":case"CandleStick":case"HeikinAshi":t="max"===e?this.allSeries[0].get("liveElement").get("high"):this.allSeries[0].get("liveElement").get("low");break;default:throw new Error("Series require a display type.")}return t},fv.prototype.getPositionDate=function(e){var e=e-this.$mainCanvas.offset().left,e=Math.floor(e/this.xRatio),t=[];return 0<=e&&e<=this.displayToIndex-this.displayFromIndex?t=[this.allDates[this.displayFromIndex+e],this.displayFromIndex+e,this.allSeries[0].get("elements")[this.displayFromIndex+e]]:this.isAnyLiveElementActive()&&this.displayFromIndex+e===this.displayToIndex+1&&(t=[this.allSeries[0].get("liveElement").get("quoteDate"),this.displayFromIndex+e,this.allSeries[0].get("liveElement")]),t},fv.prototype.getPositionIndex=function(e){e-=this.$mainCanvas.offset().left,e=Math.floor(e/this.xRatio)+this.displayFromIndex;return e<0?e=0:e>=this.allSeries[0].get("elements").length&&(e=this.allSeries[0].get("elements").length-1),e},fv.prototype.getPositionValue=function(e){e-=this.$mainCanvas.offset().top;return(this.$mainCanvas.prop("height")-e)/this.yRatio+this.min},fv.prototype.getValuePosition=function(e,t){return(t=void 0===t?0:t)?this.$mainCanvas.prop("height")-((e-t)/t-this.min)*this.yRatio:this.$mainCanvas.prop("height")-(e-this.min)*this.yRatio},fv.prototype.hideLiveElementsCanvas=function(){this.liveCanvasDisplayed&&(this.$liveElementsCanvas.css({display:"none"}),this.liveCanvasDisplayed=!1)},fv.prototype.initializeEvents=function(){var e=this;this.model.bind("change:chartDisplayAreaLineUpColor",function(){0<e.allSeries.length&&["Line","Mountain","LineOpen","LineHigh","LineLow","LineClose"].includes(e.allSeries[0].get("displayType"))&&e.updateDisplay()}),this.model.bind("change:chartDisplayAreaLineDownColor",function(){0<e.allSeries.length&&["Line","Mountain","LineOpen","LineHigh","LineLow","LineClose"].includes(e.allSeries[0].get("displayType"))&&e.updateDisplay()}),this.model.bind("change:chartDisplayAreaCandleStickUpStroke",function(){0<e.allSeries.length&&("CandleStick"===e.allSeries[0].get("displayType")||"HeikinAshi"===e.allSeries[0].get("displayType"))&&e.updateDisplay()}),this.model.bind("change:chartDisplayAreaCandleStickDownStroke",function(){0<e.allSeries.length&&("CandleStick"===e.allSeries[0].get("displayType")||"HeikinAshi"===e.allSeries[0].get("displayType"))&&e.updateDisplay()}),this.model.bind("change:chartDisplayAreaCandleStickUpIsHollow",function(){0<e.allSeries.length&&("CandleStick"===e.allSeries[0].get("displayType")||"HeikinAshi"===e.allSeries[0].get("displayType"))&&e.updateDisplay()}),this.model.bind("change:chartDisplayAreaCandleStickUpFill",function(){0<e.allSeries.length&&("CandleStick"===e.allSeries[0].get("displayType")||"HeikinAshi"===e.allSeries[0].get("displayType"))&&e.updateDisplay()}),this.model.bind("change:chartDisplayAreaCandleStickDownFill",function(){0<e.allSeries.length&&("CandleStick"===e.allSeries[0].get("displayType")||"HeikinAshi"===e.allSeries[0].get("displayType"))&&e.updateDisplay()}),this.model.bind("change:chartDisplayAreaBarUpColor",function(){0<e.allSeries.length&&"OHLCBar"===e.allSeries[0].get("displayType")&&e.updateDisplay()}),this.model.bind("change:chartDisplayAreaBarDownColor",function(){0<e.allSeries.length&&"OHLCBar"===e.allSeries[0].get("displayType")&&e.updateDisplay()}),this.model.bind("change:chartDisplayAreaKagiUpColor",function(){0<e.allSeries.length&&"Kagi"===e.allSeries[0].get("displayType")&&e.updateDisplay()}),this.model.bind("change:chartDisplayAreaKagiDownColor",function(){0<e.allSeries.length&&"Kagi"===e.allSeries[0].get("displayType")&&e.updateDisplay()})},fv.prototype.isAnyLiveElementActive=function(){return _.some(this.allSeries,function(e){return e.get("liveElement")})},fv.prototype.isLastElementOnDisplay=function(){return!(!this.allSeries[0]||!this.allSeries[0].get("elements")[this.displayToIndex])&&this.allSeries[0].get("elements")[this.displayToIndex].get("isFake")},fv.prototype.niceNum=function(e,t){var i=Math.floor(Math.log(e)/Math.log(10)),e=e/Math.pow(10,i);return(t?e<1.5?1:e<3?2:e<7?5:10:e<=1?1:e<=2?2:e<=5?5:10)*Math.pow(10,i)},fv.prototype.onLiveElementChanged=function(e){var t=this.isLastElementOnDisplay();t&&this.isLiveElementsCanvasVisible?this.isAnyLiveElementActive()?this.updateLiveElementsCanvas():(e.updateMinMax(),this.updateDisplayMinMaxLength(),this.isDisplayPending=!0,this.applyLayout()):t&&(e.updateMinMax(),this.updateDisplayMinMaxLength(),this.isDisplayPending=!0,this.applyLayout())},fv.prototype.onLiveElementValuesChanging=function(){var e,t,i=this.isLastElementOnDisplay();i&&this.isLiveElementsCanvasVisible?(e=this.min,t=this.max,this.updateDisplayMinMaxLength(),this.updateRatios(),e>this.min||t<this.max?this.updateDisplay():this.updateLiveElementsCanvas()):i?(this.updateDisplayMinMaxLength(),this.isDisplayPending=!0,this.applyLayout()):$(this).trigger("liveElementCanvasUpdated",{type:"liveElementCanvasUpdated"})},fv.prototype.onResize=function(){0<this.allSeries.length&&(this.applyLayout(),(this.displayFromIndex||0===this.displayFromIndex)&&this.displayToIndex?this.updateDisplay():this.displaySeries(-1,-1))},fv.prototype.refreshDates=function(){this.allDates=[],this.allDatesTags=[];for(var e,t,i=this.allSeries[0].get("elements").length,a=0;a<i;a+=1)e=this.allSeries[0].get("elements")[a],0<a&&e.set({dateTag:Helpers.getDateTag(e.get("quoteDate"),t)}),this.allDates.push(e.get("quoteDate")),this.allDatesTags.push(e.get("dateTag")),e.set({index:a}),t=e.get("quoteDate");$(this).trigger("dates-refreshed")},fv.prototype.remove=function(){return ev.prototype.remove.call(this),this},fv.prototype.updateDisplayMinMaxLength=function(){var t,i,a,e,n,o="percent"===this.model.get("stockDisplayValues"),s=this.min,r=this.max;0<this.allSeries.length&&(o?(this.percentBase=this.allSeries[0].get("percentBase"),t=_.map(this.allSeries,function(e){return e.get("percentMax")}),i=_.map(this.allSeries,function(e){return e.get("percentMin")})):(t=[],i=[],_.each(this.allSeries,function(e){"PivotLine"!==e.get("displayType")&&(a=e.get("seriesMax"),_.isNaN(a)||t.push(a),a=e.get("seriesMin"),_.isNaN(a)||i.push(a))})),this.isLiveElementsCanvasVisible&&this.allSeries[0].get("liveElement")&&(n=this.getLiveElementValue("max"),e=this.getLiveElementValue("min"),o&&(n!==1/0&&(n=(n-this.percentBase)/this.percentBase),e!==-1/0&&(e=(e-this.percentBase)/this.percentBase)),t.push(n),i.push(e)),t=_.without(t,1/0),i=_.without(i,-1/0),this.realMax=_.max(t),this.realMin=_.min(i),this.model.get("autoZoomY")||(o=this.model.get("zoomYLevel"),n=.01*(this.realMax-this.realMin),0<o?(this.realMin=this.realMin+o*n,this.realMax=this.realMax-o*n):o<0?(this.realMin=this.realMin-o*-n,this.realMax=this.realMax+o*-n):this.staticRealMax&&this.staticRealMin?(this.realMin=this.staticRealMin<this.realMin?this.staticRealMin:this.realMin,this.realMax=this.staticRealMax>this.realMax?this.staticRealMax:this.realMax):void 0!==this.staticRealMaxPts&&null!==this.staticRealMaxPts&&void 0!==this.staticRealMinPts&&null!==this.staticRealMinPts&&0<=this.staticRealMaxPts&&0<=this.staticRealMinPts&&(this.staticPtsPrice||(e=_.last(this.allSeries[0].get("elements")),this.staticPtsPrice=e.get("value")),o=Math.pow(10,this.model.get("mainChartAreaValuesAxisDecimalPlaces")-1),this.realMax=Math.max(this.realMax,this.staticPtsPrice+this.staticRealMaxPts/o),n=this.staticPtsPrice-this.staticRealMinPts/o,this.realMin=Math.min(this.realMin,Math.max(n,0)))),_.isFinite(this.realMin)&&_.isFinite(this.realMax)?this.realMin===this.realMax&&(this.realMin-=.1*this.realMin,this.realMax+=.1*this.realMax):(this.realMin=_.min(this.displayValues),this.realMax=_.max(this.displayValues)),this.displayValues=this.calculateDisplayValues(this.realMin,this.realMax),this.seriesMarkers&&(this.displayValues=this.seriesMarkers.concat(this.displayValues||[])),e=_.min(this.displayValues.concat([this.realMin])),o=_.max(this.displayValues.concat([this.realMax])),_.isFinite(e)&&_.isFinite(this.realMin)?e<this.realMin?this.min=e:this.min=this.realMin:_.isFinite(e)?this.min=e:this.min=this.realMin,_.isFinite(o)&&_.isFinite(this.realMax)?o>this.realMax?this.max=o:this.max=this.realMax:_.isFinite(o)?this.max=o:this.max=this.realMax,this.elementsCount=this.displayToIndex-this.displayFromIndex+1,this.hasPriceRangeChanged=e!==s||o!==r)},fv.prototype.updateLiveElementsCanvas=function(){var e,t,i,a,n;if(this.allSeries[0]){var o=this.$liveElementsCanvas[0].getContext("2d"),s=this.$liveElementsCanvas.width(),r=this.$liveElementsCanvas.height();o.clearRect(0,0,s,r),o.strokeWidth=1;switch(this.allSeries[0].get("displayType")){case"Bar":for(n=(a=this.allSeries[0].get("elements")).length-1;0<=n;--n)if(!a[n].get("isFake")){e=a[n];break}this.drawBar(o,1,this.allSeries[0].get("liveElement"),e);break;case"Kagi":if(this.lastKagiArgs){for(i=this.lastKagiArgs.isThick,l=this.lastKagiArgs.limitValue,t=this.lastKagiArgs.kagiReversalValue,i={isThick:i,limitValue:l},n=(a=this.allSeries[0].get("elements")).length-1;0<=n;--n)if(!a[n].get("isFake")){e=a[n];break}var l=this.allSeries[0].get("liveElement");l&&this.drawKagi(o,1,l,e,t,i)}break;case"CandleStick":this.drawCandleStick(o,1,this.allSeries[0].get("liveElement"),!1);break;case"Histogram":throw"Drawing of histogram live element is not supported!";case"PivotLine":throw"Drawing of pivot line live element is not supported!";case"Line":for(n=(a=this.allSeries[0].get("elements")).length-1;0<=n;--n)if(!a[n].get("isFake")){e=a[n];break}e.x=this.xRatio/2,this.drawLine(o,1,this.allSeries[0].get("liveElement"),e,this.allSeries[0].get("displayColor"),"percent"===this.model.get("stockDisplayValues")?this.allSeries[0].get("percentBase"):null,"value");break;case"LineOpen":for(n=(a=this.allSeries[0].get("elements")).length-1;0<=n;--n)if(!a[n].get("isFake")){e=a[n];break}e.x=this.xRatio/2,this.drawLine(o,1,this.allSeries[0].get("liveElement"),e,this.allSeries[0].get("displayColor"),"percent"===this.model.get("stockDisplayValues")?this.allSeries[0].get("percentBase"):null,"open");break;case"LineHigh":for(n=(a=this.allSeries[0].get("elements")).length-1;0<=n;--n)if(!a[n].get("isFake")){e=a[n];break}e.x=this.xRatio/2,this.drawLine(o,1,this.allSeries[0].get("liveElement"),e,this.allSeries[0].get("displayColor"),"percent"===this.model.get("stockDisplayValues")?this.allSeries[0].get("percentBase"):null,"high");break;case"LineLow":for(n=(a=this.allSeries[0].get("elements")).length-1;0<=n;--n)if(!a[n].get("isFake")){e=a[n];break}e.x=this.xRatio/2,this.drawLine(o,1,this.allSeries[0].get("liveElement"),e,this.allSeries[0].get("displayColor"),"percent"===this.model.get("stockDisplayValues")?this.allSeries[0].get("percentBase"):null,"low");break;case"LineClose":for(n=(a=this.allSeries[0].get("elements")).length-1;0<=n;--n)if(!a[n].get("isFake")){e=a[n];break}e.x=this.xRatio/2,this.drawLine(o,1,this.allSeries[0].get("liveElement"),e,this.allSeries[0].get("displayColor"),"percent"===this.model.get("stockDisplayValues")?this.allSeries[0].get("percentBase"):null,"close");break;case"OHLCBar":this.drawOHLCBar(o,1,this.allSeries[0].get("liveElement"));break;case"HeikinAshi":for(n=(a=this.allSeries[0].get("elements")).length-1;0<=n;--n)if(!a[n].get("isFake")){e=a[n];break}e.hashi&&this.drawHeikinAshi(o,1,this.allSeries[0].get("liveElement"),e,e.hashi);break;case"Mountain":for(n=(a=this.allSeries[0].get("elements")).length-1;0<=n;--n)if(!a[n].get("isFake")){e=a[n];break}e.x=this.xRatio/2,this.drawLine(o,1,this.allSeries[0].get("liveElement"),e,this.allSeries[0].get("displayColor"),"percent"===this.model.get("stockDisplayValues")?this.allSeries[0].get("percentBase"):null,"value"),o.fillStyle="rgba(127, 127, 127, 0.3)",o.lineTo(1.5*this.xRatio,this.getValuePosition(0)),o.lineTo(e.x,this.getValuePosition(0)),o.closePath(),o.fill();break;default:throw new Error("Series require a display type.")}$(this).trigger("liveElementCanvasUpdated",{type:"liveElementCanvasUpdated"})}},fv.prototype.updateRatios=function(){var e=this.mainCanvasWidth,t=this.mainCanvasHeight,i=this.max-this.min;this.xRatio=e/this.elementsCount,this.yRatio=t/i},fv),ev;function fv(e){var t=ev.call(this,e)||this;return t.allDates=[],t.allDatesTags=[],t.allSeries=[],t.liveElements=[],t.seriesMarkers=[],t.options=e,t.drawingLocked=e.drawingLocked,t.isLayoutApplied=!1,t.isDisplayPending=!1,t.hideLiveElementsCanvas(),t.applyTemplate(),t.onResize(),t.initializeEvents(),t}var HorizontalAxis=(xB=Backbone.View,__extends(yB,xB),yB.prototype.applyLayout=function(e,t){this.$mainCanvas.prop("width",e),this.$mainCanvas.prop("height",t),this.$textsDiv.css({width:e,height:t})},yB.prototype.applyTemplate=function(){var e=this.model.get("chartBorderColor");this.selectedDates=[],this.$el.html(T.HorizontalAxis()),this.$mainCanvas=this.$el.find(".MainCanvas"),this.$textsDiv=this.$el.find(".TextsDiv"),this.$borderDiv=this.$el.find(".borderDiv"),this.$axisTextMinor=this.$el.find(".axisTextMinor"),this.$axisTextMajor=this.$el.find(".axisTextMajor"),this.$borderDiv.css({"background-color":this.model.get("chartDisplayAreaBackground"),"border-left-color":e,"border-right-color":e})},yB.prototype.drawDisplayDates=function(){if(this.displayDates){var e,t=void 0,i=void 0,a=void 0,n=void 0,o=-1,s=this.$textsDiv.width()-5,i=this.displayDates.length;if(this.displayDivs.length<i)for(t=this.displayDivs.length;t<i;t+=1)(a=$(document.createElement("div"))).appendTo(this.$textsDiv),this.displayDivs.push(a);for(i=this.displayDivs.length,t=0;t<i;t+=1)this.displayDates[t]&&this.displayDates[t].date&&t<this.displayDates.length?(e=this.displayDates[t].date.format(this.displayDates[t].format),this.displayDivs[t].html(e),e=this.displayDivs[t].width(),(n=this.displayDates[t].position+6-e/2)<3?n=3:s<n+e&&(n=s-(n+e+3)),n<o?this.displayDivs[t].css("display","none"):(this.displayDivs[t].css({display:"block",left:n}),o=n+e),this.displayDates[t].isMajorTick?(this.displayDivs[t].removeClass("axisTextMinor"),this.displayDivs[t].addClass("axisTextMajor"),this.displayDivs[t].css("color",this.model.get("axisTextMajor"))):(this.displayDivs[t].removeClass("axisTextMajor"),this.displayDivs[t].addClass("axisTextMinor"),this.displayDivs[t].css("color",this.model.get("axisTextMinor")))):(this.displayDivs[t].removeClass("axisTextMinor"),this.displayDivs[t].removeClass("axisTextMajor"),this.displayDivs[t].css("color",""),this.displayDivs[t].css("display","none"));this.$axisTextMinor=this.$el.find(".axisTextMinor"),this.$axisTextMajor=this.$el.find(".axisTextMajor")}},yB.prototype.drawSelectedDate=function(e,t){var i,a,n,o,s=this.$mainCanvas[0].getContext("2d"),r=this.$mainCanvas.prop("width"),l=this.$mainCanvas.prop("height");switch(t&&s.clearRect(0,0,r,l),this.model.get("granularity")){case"OneDay":case"OneWeek":case"OneMonth":o="d mmm yyyy",i=85;break;case"Tick":o="d mmm yyyy HH:MM:ss",i=150;break;default:o="d mmm yyyy HH:MM",i=120}e&&e[0]&&(t=e[1]+this.axisLeft,l=l/2,e=e[0].format(o),n=i+8,s.font="bold 11px Verdana",(a=(t=t-i/2)-4)<0?(a=0,t=4):r<a+n&&(t=(a=r-n)+4),r=l-5.5-2,s.textAlign="center",s.textBaseline="middle",s.fillStyle=this.model.get("selectedBackground"),s.strokeStyle=this.model.get("crosshairColor"),this.fillRectRound(s,a,r,n,15,4),s.stroke(),s.fillStyle=this.model.get("selectedForeground"),s.fillText(e,Math.floor(t+i/2)+.5,Math.floor(l)+.5))},yB.prototype.fillRectRound=function(e,t,i,a,n,o){e.beginPath(),e.moveTo(Math.floor(t+o)+.5,Math.floor(i)+.5),e.lineTo(Math.floor(t+a-o)+.5,Math.floor(i)+.5),e.quadraticCurveTo(Math.floor(t+a)+.5,Math.floor(i)+.5,Math.floor(t+a)+.5,Math.floor(i+o)+.5),e.lineTo(Math.floor(t+a)+.5,Math.floor(i+n-o)+.5),e.quadraticCurveTo(Math.floor(t+a)+.5,Math.floor(i+n)+.5,Math.floor(t+a-o)+.5,Math.floor(i+n)+.5),e.lineTo(Math.floor(t+o)+.5,Math.floor(i+n)+.5),e.quadraticCurveTo(Math.floor(t)+.5,Math.floor(i+n)+.5,Math.floor(t)+.5,Math.floor(i+n-o)+.5),e.lineTo(Math.floor(t)+.5,Math.floor(i+o)+.5),e.quadraticCurveTo(Math.floor(t)+.5,Math.floor(i)+.5,Math.floor(t+o)+.5,Math.floor(i)+.5),e.closePath(),e.fill()},yB.prototype.initialize=function(e){this.options=e,this.axisTop=0,this.axisBottom=0,this.displayDivs=[],this.applyTemplate(),this.onResize(),this.initializeEvents()},yB.prototype.initializeEvents=function(){var e=this;this.model.on("change:chartDisplayAreaBackground",function(){e.$borderDiv.css("background-color",e.model.get("chartDisplayAreaBackground"))}),this.model.on("change:axisTextMinor",function(){e.$axisTextMinor.css("color",e.model.get("axisTextMinor"))}),this.model.on("change:axisTextMajor",function(){e.$axisTextMajor.css("color",e.model.get("axisTextMajor"))}),this.model.on("change:chartBorderColor",function(){e.$borderDiv.css({"border-left-color":e.model.get("chartBorderColor"),"border-right-color":e.model.get("chartBorderColor")})})},yB.prototype.onResize=function(){var e=this.$el.width(),t=this.$el.height();this.applyLayout(e,t),0<e&&0<t&&(this.drawDisplayDates(),this.updateDisplay())},yB.prototype.setSelectedDates=function(e){this.selectedDates=e||[],this.updateDisplay()},yB.prototype.setDates=function(e){this.displayDates=e,this.drawDisplayDates()},yB.prototype.setAxisLeftRight=function(e,t){this.axisLeft=e,this.axisRight=t,this.$borderDiv.css("width",t)},yB.prototype.updateDisplay=function(){this.drawSelectedDate(this.selectedDates[0],!0);for(var e=this.selectedDates.length,t=1;t<e;t+=1)this.drawSelectedDate(this.selectedDates[t],!1)},yB),xB;function yB(){return null!==xB&&xB.apply(this,arguments)||this}var VerticalAxis=(pC=Backbone.View,__extends(qC,pC),qC.prototype.applyLayout=function(e,t){this.$mainCanvas.prop("width",e),this.$mainCanvas.prop("height",t),$(this.$textsDiv).css({width:e,height:t})},qC.prototype.applyTemplate=function(){$(this.el).html(T.VerticalAxis()),this.$mainCanvas=this.$el.find(".vertical-axis-canvas"),this.$textsDiv=this.$el.find(".TextsDiv")},qC.prototype.drawDisplayValues=function(){if(this.displayValues){var e,t=void 0,i=void 0,a=void 0,n="percent"===this.model.get("stockDisplayValues")?"%":"",i=this.displayValues.length;if(this.displayDivs.length<i)for(t=this.displayDivs.length;t<i;t+=1)(a=$(document.createElement("div"))).addClass("axisText"),a.appendTo(this.$textsDiv),this.displayDivs.push(a);for(i=this.displayDivs.length,t=0;t<i;t+=1)t<this.displayValues.length&&0<(e=Math.floor(this.displayValues[t][1]+this.axisTop))?(this.displayDivs[t].html(this.displayValues[t][0].toFixed(this.decimalPlaces)+n),this.displayDivs[t].css({display:"block",top:e})):this.displayDivs[t].css("display","none")}},qC.prototype.drawLastValue=function(){var e,t,i,a,n=this.$mainCanvas[0].getContext("2d"),o=this.$mainCanvas.prop("width"),s=this.$mainCanvas.prop("height");n.clearRect(0,0,o,s),this.lastValue?(s=o/2,o=this.displayArea.getValuePosition(this.lastValue,!1),a=this.lastValue.toFixed(this.decimalPlaces),n.font="11px Verdana",e=s-21.5-2,t=o-5.5-2,n.textAlign="center",n.textBaseline="middle",n.fillStyle=this.goingUp?this.model.get("cloudPriceUp"):this.model.get("cloudPriceDown"),n.strokeStyle="white",n.beginPath(),"Left"===this.axisSide?(n.moveTo(51+e,t),n.lineTo(51+e+7,7.5+t),n.lineTo(51+e,15+t),n.lineTo(4+e,15+t),n.quadraticCurveTo(e,15+t,e,15+t-4),n.lineTo(e,4+t),n.quadraticCurveTo(e,t,4+e,t),this.$el&&(i=this.$el.offset(),$(this).trigger("liveCloudChanged",{type:"liveCloudChanged",left:i.left+e,top:i.top+t,width:51,height:15,show:!0,source:"leftAxis"}))):"Right"===this.axisSide&&(n.moveTo(e,t),n.lineTo(e-7,7.5+t),n.lineTo(e,15+t),n.lineTo(51+e-4,15+t),n.quadraticCurveTo(51+e,15+t,51+e,15+t-4),n.lineTo(51+e,4+t),n.quadraticCurveTo(51+e,t,51+e-4,t),n.lineTo(e,t),$(this).trigger("liveCloudChanged",{type:"liveCloudChanged",left:this.$el.offset().left+e,top:this.$el.offset().top+t,width:51,height:15,show:!0,source:"rightAxis"})),n.fill(),n.stroke(),n.fillStyle="white",n.fillText(a,s,o)):$(this).trigger("liveCloudChanged",{type:"liveCloudChanged",show:!1,source:"Right"===this.axisSide?"rightAxis":"leftAxis"})},qC.prototype.drawSelectedValue=function(){var e,t,i,a,n=this.$mainCanvas[0].getContext("2d"),o=this.$mainCanvas.prop("width"),s="percent"===this.model.get("stockDisplayValues")?"%":"";this.selectedValue&&(o=o/2,e=this.selectedValue[1]+this.axisTop,s=this.selectedValue[0].toFixed(this.model.get(this.prefix+"ValuesAxisDecimalPlaces"))+s,a=n.measureText(s).width,n.font="11px Verdana",t=o-a/2-2,i=e-5.5-2,a=a+8,n.textAlign="center",n.textBaseline="middle",n.fillStyle=this.model.get("selectedBackground"),n.strokeStyle=this.model.get("crosshairColor"),n.beginPath(),"Left"===this.axisSide?(n.moveTo(t+a,i),n.lineTo(t+a+7,7.5+i),n.lineTo(t+a,15+i),n.lineTo(4+t,15+i),n.quadraticCurveTo(t,15+i,t,15+i-4),n.lineTo(t,4+i),n.quadraticCurveTo(t,i,4+t,i)):"Right"===this.axisSide&&(n.moveTo(t,i),n.lineTo(t-7,7.5+i),n.lineTo(t,15+i),n.lineTo(t+a-4,15+i),n.quadraticCurveTo(t+a,15+i,t+a,15+i-4),n.lineTo(t+a,4+i),n.quadraticCurveTo(t+a,i,t+a-4,i)),n.closePath(),n.fill(),n.stroke(),n.fillStyle=this.model.get("selectedForeground"),n.fillText(s,o,e))},qC.prototype.initialize2=function(e){var t=this;this.options=e,this.axisSide=e.axisSide,this.prefix=e.prefix,this.decimalPlaces=e.decimalPlaces,this.displayArea=e.displayArea,this.axisTop=0,this.axisBottom=0,this.displayDivs=[],this.lastBackground=this.model.get("liveGreenColor")||this.model.get("greenColor"),this.applyTemplate(),this.onResize(),e.showLastValue&&(this.listenTo(this.model,"change:lastAvgPrice",function(){return t.onLastPriceChanged()}),this.onLastPriceChanged())},qC.prototype.onLastPriceChanged=function(){var e=this.model.get("lastAvgPrice");this.lastValue&&(this.lastValue>e?this.goingUp=!1:this.lastValue<e&&(this.goingUp=!0)),this.lastValue=e,this.updateDisplay()},qC.prototype.onResize=function(){var e=this.$el.width(),t=this.$el.height();this.applyLayout(e,t),0<e&&0<t&&(this.drawDisplayValues(),this.updateDisplay())},qC.prototype.setDisplayValues=function(e){this.displayValues=e},qC.prototype.setSelectedValue=function(e){this.selectedValue=e,this.updateDisplay()},qC.prototype.setAxisTopBottm=function(e,t){this.axisTop=e,this.axisBottom=t},qC.prototype.updateDisplay=function(){this.drawLastValue(),this.drawSelectedValue()},qC),pC;function qC(e){var t=pC.call(this,e)||this;return t.lastForeground="#fff",t.goingUp=!1,t.initialize2(e),t}var SeriesToolbarItem=(mD=Backbone.Model,__extends(nD,mD),nD),mD;function nD(){return null!==mD&&mD.apply(this,arguments)||this}var SeriesToolbar=(oD=Backbone.View,__extends(pD,oD),pD.prototype.addSeries=function(e){var t=this,i=document.createElement("div"),a=document.createElement("div"),n=document.createElement("div"),o=new SeriesToolbarItem,s=document.createElement("button"),r=document.createElement("button"),e=(o.series=e,$(i).appendTo(this.rootDiv),$(i).css("display","inline"),$(n).appendTo(i),$(a).appendTo(i),$(a).css("display","inline"),$(s).appendTo(n),$(s).prop("title","edit"),$(s).prop("type","button"),$(s).html(e.displayName),s.series=e,$(r).appendTo(n),$(r).prop("type","button"),$(r).html("remove"),r.series=e,$(r).on("click",function(){t.triggetRemoveSeriesRequest($(r),t.series)}),$(s).button(),$(r).button({text:!1,icons:{primary:"ui-icon-closethick"}}),$(n).css("display","inline"),$(n).buttonset(),$(this.el).height()),l=$(r).height(),e=e<l;o.editButton=s,o.closeButton=r,o.buttonSet=n,o.rootDiv=i,o.infoText=a,this.allItems.push(o),e&&($(this.el).height(l),$(this).trigger("toolbarresize"))},pD.prototype.applyTemplate=function(){$(this.el).html(T.SeriesToolbar()),this.rootDiv=$(this.el).find(".RootDiv")},pD.prototype.clear=function(){$(this.rootDiv).html(""),this.allItems=[],$(this.el).height(0)},pD.prototype.initialize=function(e){this.options=e,this.allItems=[],this.elementHeight=0,this.applyTemplate()},pD.prototype.triggetRemoveSeriesRequest=function(e,t){e=_.filter(this.allItems,{closeButton:e});0<e.length&&($(e[0].buttonSet).remove(),this.allItems=_.without(this.allItems,e[0]),this.allItems<=0&&($(this.el).height(0),$(this).trigger("toolbarresize")),$(this).trigger("removeSeriesRequest",{type:"removeSeriesRequest",series:t}))},pD),oD;function pD(){return null!==oD&&oD.apply(this,arguments)||this}var ChartModel=(FD=Backbone.Model,__extends(GD,FD),GD.prototype.initialize=function(){this.set(GD.defaults)},GD.prototype.initialize2=function(){var e,t=this,i={};this.setColorsForCurrentTheme(!1),i.showTimeSlider=this.get("showTimeSlider"),i.showInfoBorder=this.get("showInfoBorder"),i.isIndicatorsToolbarVisible=this.get("isIndicatorsToolbarVisible"),this.set({originalModel:i}),this.get("isMobile")&&this.set({bottomMarginPx:2,leftMarginPx:0,rightMarginPx:0,topMarginPx:2}),this.get("granularity")||(i=0,(e=(e=_.find(this.get("viewOptions"),{isDefault:!0}))||this.get("viewOptions")[0]).defaultframe&&(i=e.defaultframe),this.set({granularity:e.value,displayPeriod:e.timeframes[i].value,dataPeriod:e.timeframes[i].value},{silent:!0})),this.get("api")&&(this.set("savedAnnotations",this.get("api").getProperty("Basics.annotations")||null),this.listenTo(this,"change:savedAnnotations",function(){return t.onAnnotationsChanged()}),this.set("saved_indicators",this.get("api").getProperty("Basics.indicators")||null),this.listenTo(this,"change:saved_indicators",function(){return t.onIndicatosChanged()}),["chartDisplayAreaHorizontalGridLinesColor","chartDisplayAreaVerticalGridLinesColor","crosshairColor","chartDisplayAreaBackground","crosshairColor","chartDisplayAreaBackground","chartDisplayAreaAlternativeBackground","chartBorderColor","axisTextMajor","axisTextMinor","selectedBackground","selectedForeground","chartDisplayAreaCandleStickUpFill","chartDisplayAreaCandleStickDownFill"].forEach(function(e){t.listenTo(t,"change:"+e,function(e){Object.keys(e.changed).forEach(function(e){t.get("api").setProperty("Style."+e,t.get(e))})})}))},GD.prototype.filterUserSetColors=function(e){var i=this,a=_.clone(e);return _.each(["chartDisplayAreaHorizontalGridLinesColor","chartDisplayAreaVerticalGridLinesColor","crosshairColor","chartDisplayAreaBackground","chartDisplayAreaAlternativeBackground","chartBorderColor","axisTextMajor","axisTextMinor","selectedBackground","selectedForeground","chartDisplayAreaCandleStickUpFill","chartDisplayAreaCandleStickDownFill"],function(e){var t=i.get(e);t&&t!==GD.constants.themeDefaults[e]&&t!==GD.constants.themeOverridesMap.dark[e]&&(a[e]=t)}),a},GD.prototype.onAnnotationsChanged=function(){this.get("api").setProperty("Basics.annotations",this.get("savedAnnotations"))},GD.prototype.onIndicatosChanged=function(){this.get("api").setProperty("Basics.indicators",this.get("saved_indicators"))},GD.prototype.setColorsForCurrentTheme=function(e){var i=this,t=this.get("currentTheme"),t=GD.constants.themeOverridesMap[t]||GD.constants.themeDefaults,t=this.filterUserSetColors(t);this.set(_.extend({},GD.constants.themeDefaults,t),{silent:!0}),e&&_.each(["chartDisplayAreaBackground","chartDisplayAreaAlternativeBackground","chartBorderColor","rightAxisWidthPx"],function(e){var t=i.get(e);i.set(e," ",{silent:!0}),i.set(e,t)})},GD.prototype.changeThemeClassForElementWhenThemeChanges=function(i){var a=this;this.on("change:currentTheme",function(){var e=a.get("supportedThemes"),t=a.get("currentTheme");_.each(e,function(e){i.removeClass(e)}),i.addClass(t)})},GD.constants={themeDefaults:{chartDisplayAreaBackground:"#ffffff",chartDisplayAreaAlternativeBackground:"#ffffff",chartRenderBackground:"#ffffff",chartDisplayAreaHorizontalGridLinesColor:"#D8D8D8",chartDisplayAreaHorizontalGridLinesOpacity:1,chartDisplayAreaHorizontalGridLinesType:[2,3],chartDisplayAreaHorizontalMarkerColor:"#888888",chartDisplayAreaVerticalGridLinesColor:"#D8D8D8",chartDisplayAreaVerticalGridLinesOpacity:1,chartDisplayAreaVerticalGridLinesType:[2,3],chartDisplayAreaLineUpColor:"#0876BD",chartDisplayAreaLineDownColor:"#bd081c",chartDisplayAreaCandleStickUpStroke:"#000000",chartDisplayAreaCandleStickDownStroke:"#000000",chartDisplayAreaCandleStickUpIsHollow:0,chartDisplayAreaCandleStickUpFill:"#0876BD",chartDisplayAreaCandleStickDownFill:"#bd081c",chartDisplayAreaBarUpColor:"#0876BD",chartDisplayAreaBarDownColor:"#bd081c",chartDisplayAreaKagiUpColor:"#0876BD",chartDisplayAreaKagiDownColor:"#bd081c",chartBorderColor:"#c5c5c5",annotationStrokeColor:"#104ab3",annotationFillColor:"#acf1ae",crosshairColor:"#555555",selectedForeground:"#555555",selectedBackground:"#FFFFFF",axisTextMinor:"#646464",axisTextMajor:"#000000",bottomMarginPx:7,leftMarginPx:13,rightMarginPx:13,topMarginPx:7,leftAxisWidthPx:72,rightAxisWidthPx:52,rangeSelectorHeightPx:40},themeOverridesMap:{dark:{chartRenderBackground:"#000000",chartDisplayAreaHorizontalGridLinesColor:"#D8D8D8",chartDisplayAreaHorizontalGridLinesOpacity:.36,chartDisplayAreaHorizontalGridLinesType:[2,3],chartDisplayAreaHorizontalMarkerColor:"#ffffff",chartDisplayAreaVerticalGridLinesColor:"#D8D8D8",chartDisplayAreaVerticalGridLinesOpacity:.36,chartDisplayAreaVerticalGridLinesType:[2,3],chartDisplayAreaLineUpColor:"#ffffff",chartDisplayAreaLineDownColor:"#ffffff",chartDisplayAreaCandleStickUpStroke:"#009933",chartDisplayAreaCandleStickDownStroke:"#d00d00",chartDisplayAreaCandleStickUpIsHollow:0,chartDisplayAreaCandleStickUpFill:"#009933",chartDisplayAreaCandleStickDownFill:"#d00d00",chartDisplayAreaBarUpColor:"#009933",chartDisplayAreaBarDownColor:"#d00d00",chartDisplayAreaKagiUpColor:"#009933",chartDisplayAreaKagiDownColor:"#d00d00",crosshairColor:"#ffffff",selectedForeground:"#000000",selectedBackground:"#ffffff",axisTextMinor:"#ffffff",axisTextMajor:"#ffffff",chartDisplayAreaBackground:"#262626",chartDisplayAreaAlternativeBackground:"#262626",chartBorderColor:"#ffffff",greenColor:"#009933",redColor:"#d00d00",cloudPriceUp:"#009933",cloudPriceDown:"#d00d00",rightAxisWidthPx:59,rightMarginPx:3,rangeSelectorHeightPx:35,annotationStrokeColor:"#e8e824",annotationFillColor:"#e8e824"}}},GD.defaults={stockSymbol:null,displaySymbol:null,stockPickerSymbol:null,displayPeriod:null,dataPeriod:null,granularity:null,isTouch:!1,allowZoom:!0,allowZoomY:!0,autoZoomY:!0,zoomYLevel:0,maxValueY:null,minValueY:null,startLivePrices:!0,isContextMenuEnabled:!0,customChartName:null,showMainChartName:!0,showGranularityAsChartName:!0,snapToDataPoint:!1,fromDate:null,toDate:null,fromDateDisplay:null,toDateDisplay:null,stockDisplayType:"CandleStick",stockDisplayValues:"price",showLastValue:!0,isVolumeChartAreaVisible:!1,isIndicatorsToolbarVisible:!0,bottomMarginPx:7,leftMarginPx:13,rightMarginPx:13,topMarginPx:7,elementsSpacingPx:0,indicatorsToolbarHeightPx:25,showIndicators:!0,indicatorChartAreaHeightPx:55,volumeChartAreaHeightPx:55,rangeSelectorHeightPx:40,isChartDimensionsVisible:!1,isChartDimensionsActive:!1,chartDimensionsWidthPx:null,chartDimensionsHeightPx:null,chartDimensionsHeightPercent:.62,showCrosshair:!1,highlightSelectedValue:!0,highlightSelectedDate:!0,showThemesOptions:!0,currentTheme:"light",supportedThemes:["light","dark"],supportedThemesUItext:["Light Theme","Dark Theme"],greenColor:"#0876BD",redColor:"#bd081c",cloudPriceUp:"#0876BD",cloudPriceDown:"#bd081c",blackColor:"#23a401",isGreenCandleStickHollow:!1,showTimeSlider:!0,showInfoBorder:!0,isInfoBorderInCursorMode:!1,showSaveButton:!0,c:!1,showDrawMenu:!0,showUndoRedoButtons:!1,isZoomSelectionVisible:!0,indicators:[],originalDecimalPlaces:5,mainChartAreaIsBottomAxisVisible:!0,mainChartAreaIsRightAxisVisible:!0,mainChartAreaValuesAxisDecimalPlaces:5,mainChartAreaCanUserResize:!1,indicatorChartAreaIsBottomAxisVisible:!0,indicatorChartAreaIsRightAxisVisible:!0,indicatorChartAreaValuesAxisDecimalPlaces:5,indicatorChartAreaCanUserResize:!0,bottomInnerMarginPx:5,leftInnerMarginPx:7,rightInnerMarginPx:7,topInnerMarginPx:5,seriesBarMarginPx:7,bottomAxisHeightPx:30,leftAxisWidthPx:72,rightAxisWidthPx:52,topAxisHeightPx:30,infoAreaHeightPx:16,isInfoAreaVisible:!1,lineColor:"#1c242a",leftHandleWidhtPx:10,rightHandleWidhtPx:10,rangeSelectorTopInnderMarginPx:2,rangeSelectorBottomInnderMarginPx:2,showArrows:!1,showSliderDates:!0,savedAnnotations:"",indicatorsData:[{IndicatorCode:"ac",IndicatorName:"Accelerator Indicator",IndicatorType:-1,ShortName:"AC",Default:!1,inCompactMode:!1},{IndicatorCode:"aroon",IndicatorName:"Aroon",IndicatorType:-1,ShortName:"AR",Default:!1,inCompactMode:!1},{IndicatorCode:"aroonosc",IndicatorName:"Aroon Oscillator",IndicatorType:-1,ShortName:"OSC",Default:!1,inCompactMode:!1},{IndicatorCode:"ao",IndicatorName:"Awesome Oscillator",IndicatorType:-1,ShortName:"AO",Default:!1,inCompactMode:!1},{IndicatorCode:"atr",IndicatorName:"Average True Range",IndicatorType:-1,ShortName:"ATR",Default:!1,inCompactMode:!1},{IndicatorCode:"bb",IndicatorName:"Bollinger Bands",IndicatorType:0,ShortName:"BB",Default:!0,inCompactMode:!0},{IndicatorCode:"cci",IndicatorName:"Commodity Channel Index (CCI)",IndicatorType:-1,ShortName:"CCI",Default:!0,inCompactMode:!1},{IndicatorCode:"kc",IndicatorName:"Keltner Channels",IndicatorType:0,ShortName:"KC",Default:!1,inCompactMode:!1},{IndicatorCode:"ema",IndicatorName:"Moving Average (Exponential)",IndicatorType:0,ShortName:"EMA",Default:!0,inCompactMode:!0},{IndicatorCode:"macd",IndicatorName:"MACD",IndicatorType:-1,ShortName:"MACD",Default:!0,inCompactMode:!0},{IndicatorCode:"mom",IndicatorName:"Momentum",IndicatorType:0,ShortName:"MOM",Default:!1,inCompactMode:!1},{IndicatorCode:"maenv",IndicatorName:"Moving Average Envelope",IndicatorType:0,ShortName:"ENV",Default:!1},{IndicatorCode:"psar",IndicatorName:"Parabolic SAR",IndicatorType:-1,ShortName:"PSAR",Default:!0,inCompactMode:!1},{IndicatorCode:"po",IndicatorName:"Price Oscillator",IndicatorType:0,ShortName:"PO",Default:!1,inCompactMode:!1},{IndicatorCode:"proc",IndicatorName:"Price ROC",IndicatorType:-1,ShortName:"PROC",Default:!1,inCompactMode:!1},{IndicatorCode:"rsi",IndicatorName:"Relative Strength Index (RSI)",IndicatorType:-1,ShortName:"RSI",Default:!0,inCompactMode:!0},{IndicatorCode:"sma",IndicatorName:"Moving Average (Simple)",IndicatorType:0,ShortName:"SMA",Default:!0,inCompactMode:!0},{IndicatorCode:"stddev",IndicatorName:"Standard Deviation",IndicatorType:-1,ShortName:"SD",Default:!1,inCompactMode:!1},{IndicatorCode:"stochosc",IndicatorName:"Stochastic Oscillator",IndicatorType:-1,ShortName:"SO",Default:!0,inCompactMode:!0},{IndicatorCode:"si",IndicatorName:"Swing Index",IndicatorType:-1,ShortName:"SI",Default:!1,inCompactMode:!1},{IndicatorCode:"sr",IndicatorName:"Support/Resistance",IndicatorType:0,ShortName:"SR",Default:!1,inCompactMode:!1},{IndicatorCode:"trix",IndicatorName:"TRIX",IndicatorType:-1,ShortName:"TRIX",Default:!1,inCompactMode:!1},{IndicatorCode:"truerange",IndicatorName:"True Range",IndicatorType:-1,ShortName:"TR",Default:!0,inCompactMode:!1},{IndicatorCode:"typprice",IndicatorName:"Typical Price",IndicatorType:-1,ShortName:"TP",Default:!1,inCompactMode:!1},{IndicatorCode:"uo",IndicatorName:"Ultimate Oscillator",IndicatorType:-1,ShortName:"UO",Default:!1,inCompactMode:!1},{IndicatorCode:"wma",IndicatorName:"Moving Average (Weighted)",IndicatorType:0,ShortName:"WMA",Default:!1,inCompactMode:!1},{IndicatorCode:"wws",IndicatorName:"Welles Wilder Smoothing",IndicatorType:-1,ShortName:"WWS",Default:!1,inCompactMode:!1},{IndicatorCode:"williams",IndicatorName:"Williams %R",IndicatorType:-1,ShortName:"W%R",Default:!0,inCompactMode:!1},{IndicatorCode:"vol",IndicatorName:"Volume",IndicatorType:-1,ShortName:"VOL",Default:!1},{IndicatorCode:"zz",IndicatorName:"ZigZag",IndicatorType:0,ShortName:"ZZ",Default:!1,inCompactMode:!1}],stylesData:[{Name:"chartDisplayAreaBackground",Class:".charting .chartDisplayAreaBackground",Property:"color"},{Name:"chartDisplayAreaAlternativeBackground",Class:".charting .chartDisplayAreaAlternativeBackground",Property:"color"},{Name:"chartRenderBackground",Class:".charting .chartRenderBackground",Property:"color"},{Name:"chartDisplayAreaHorizontalGridLinesColor",Class:".charting .chartDisplayAreaHorizontalGridLinesColor",Property:"color"},{Name:"chartDisplayAreaVerticalGridLinesColor",Class:".charting .chartDisplayAreaVerticalGridLinesColor",Property:"color"},{Name:"chartDisplayAreaHorizontalGridLinesOpacity",Property:"opacity"},{Name:"chartDisplayAreaVerticalGridLinesOpacity",Property:"opacity"},{Name:"chartDisplayAreaLineUpColor",Class:".charting .chartDisplayAreaLineUpColor",Property:"color"},{Name:"chartDisplayAreaLineDownColor",Class:".charting .chartDisplayAreaLineDownColor",Property:"color"},{Name:"chartDisplayAreaCandleStickUpStroke",Class:".charting .chartDisplayAreaCandleStickUpStroke",Property:"color"},{Name:"chartDisplayAreaCandleStickDownStroke",Class:".charting .chartDisplayAreaCandleStickDownStroke",Property:"color"},{Name:"chartDisplayAreaCandleStickUpFill",Class:".charting .chartDisplayAreaCandleStickUpFill",Property:"color"},{Name:"chartDisplayAreaCandleStickDownFill",Class:".charting .chartDisplayAreaCandleStickDownFill",Property:"color"},{Name:"chartDisplayAreaCandleStickUpIsHollow",Property:"checkbox"},{Name:"chartDisplayAreaBarUpColor",Class:".charting .chartDisplayAreaBarUpColor",Property:"color"},{Name:"chartDisplayAreaBarDownColor",Class:".charting .chartDisplayAreaBarDownColor",Property:"color"},{Name:"chartDisplayAreaKagiUpColor",Class:".charting .chartDisplayAreaKagiUpColor",Property:"color"},{Name:"chartDisplayAreaKagiDownColor",Class:".charting .chartDisplayAreaKagiDownColor",Property:"color"},{Name:"chartBorderColor",Class:".charting .chartBorderColor",Property:"color"},{Name:"crosshairColor",Class:".charting .crosshairColor",Property:"color"},{Name:"greenColor",Class:".charting .greenColor",Property:"color"},{Name:"redColor",Class:".charting .redColor",Property:"color"},{Name:"blackColor",Class:".charting .blackColor",Property:"color"},{Name:"selectedForeground",Class:".charting .selectedForeground",Property:"color"},{Name:"selectedBackground",Class:".charting .selectedBackground",Property:"color"},{Name:"lineColor",Class:".charting .lineColor",Property:"color"},{Name:"axisTextMinor",Class:".charting .axisTextMinor",Property:"color"},{Name:"axisTextMajor",Class:".charting .axisTextMajor",Property:"color"},{Name:"annotationStrokeColor",Class:".charting .annotationStrokeColor",Property:"color"},{Name:"annotationFillColor",Class:".charting .annotationFillColor",Property:"color"},{Name:"bottomMarginPx",Class:".charting .bottomMarginPx",Property:"marginBottom"},{Name:"leftMarginPx",Class:".charting .leftMarginPx",Property:"marginLeft"},{Name:"rightMarginPx",Class:".charting .rightMarginPx",Property:"marginRight"},{Name:"topMarginPx",Class:".charting .topMarginPx",Property:"marginTop"}],lowerIndicatorsLimit:null,upperIndicatorsLimit:null,originalModel:null,isMobile:!1,allowScroll:!0,doubleclickNotification:!0,isAxisFontSizeVisible:!1,levels:null,levelColorHexEntry:"#00B0F0",levelColorHexProfit:"#00B050",levelColorHexStop:"#990000",lastAvgPrice:null,lastBid:null,lastOffer:null,viewOptions:[{displayName:"Tick By Tick",value:"Tick",timeframes:[{displayName:"1500",value:"1500"},{displayName:"3000",value:"3000"}]},{displayName:"1 Minute",value:"OneMinute",defaultframe:1,isDefault:!0,momentKey:"minutes",momentValue:1,timeframes:[{displayName:"2 Hours",value:"TwoHours",momentKey:"hours",momentValue:2},{displayName:"4 Hours",value:"FourHours",momentKey:"hours",momentValue:4},{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3}]},{displayName:"2 Minutes",value:"TwoMinute",defaultframe:1,momentKey:"minutes",momentValue:2,timeframes:[{displayName:"2 Hours",value:"TwoHours",momentKey:"hours",momentValue:2},{displayName:"4 Hours",value:"FourHours",momentKey:"hours",momentValue:4},{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3}]},{displayName:"3 Minutes",value:"ThreeMinute",defaultframe:1,momentKey:"minutes",momentValue:3,timeframes:[{displayName:"2 Hours",value:"TwoHours",momentKey:"hours",momentValue:2},{displayName:"4 Hours",value:"FourHours",momentKey:"hours",momentValue:4},{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3}]},{displayName:"5 Minutes",value:"FiveMinute",defaultframe:2,momentKey:"minutes",momentValue:5,timeframes:[{displayName:"2 Hours",value:"TwoHours",momentKey:"hours",momentValue:2},{displayName:"4 Hours",value:"FourHours",momentKey:"hours",momentValue:4},{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3}]},{displayName:"15 Minutes",value:"FifteenMinute",defaultframe:2,momentKey:"minutes",momentValue:15,timeframes:[{displayName:"4 Hours",value:"FourHours",momentKey:"hours",momentValue:4},{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3},{displayName:"5 Days",value:"FiveDays",momentKey:"days",momentValue:5},{displayName:"10 Days",value:"TenDays",momentKey:"days",momentValue:10}]},{displayName:"30 Minutes",value:"ThirtyMinute",defaultframe:3,momentKey:"minutes",momentValue:30,timeframes:[{displayName:"4 Hours",value:"FourHours",momentKey:"hours",momentValue:4},{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3},{displayName:"5 Days",value:"FiveDays",momentKey:"days",momentValue:5},{displayName:"10 Days",value:"TenDays",momentKey:"days",momentValue:10}]},{displayName:"1 Hour",value:"SixtyMinute",defaultframe:3,momentKey:"minutes",momentValue:60,timeframes:[{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3},{displayName:"5 Days",value:"FiveDays",momentKey:"days",momentValue:5},{displayName:"10 Days",value:"TenDays",momentKey:"days",momentValue:10},{displayName:"1 Month",value:"OneMonth",momentKey:"months",momentValue:1},{displayName:"3 Months",value:"ThreeMonths",momentKey:"months",momentValue:3}]},{displayName:"4 Hours",value:"FourHour",defaultframe:2,momentKey:"hours",momentValue:4,timeframes:[{displayName:"5 Days",value:"FiveDays",momentKey:"days",momentValue:5},{displayName:"10 Days",value:"TenDays",momentKey:"days",momentValue:10},{displayName:"1 Month",value:"OneMonth",momentKey:"months",momentValue:1},{displayName:"3 Months",value:"ThreeMonths",momentKey:"months",momentValue:3},{displayName:"6 Months",value:"SixMonths",momentKey:"months",momentValue:6}]},{displayName:"Daily",value:"OneDay",defaultframe:2,momentKey:"days",momentValue:1,timeframes:[{displayName:"3 Months",value:"ThreeMonths",momentKey:"months",momentValue:3},{displayName:"6 Months",value:"SixMonths",momentKey:"months",momentValue:6},{displayName:"1 Year",value:"OneYear",momentKey:"years",momentValue:1},{displayName:"2 Years",value:"TwoYears",momentKey:"years",momentValue:2},{displayName:"3 Years",value:"ThreeYears",momentKey:"years",momentValue:3},{displayName:"5 Years",value:"FiveYears",momentKey:"years",momentValue:5},{displayName:"10 Years",value:"TenYears",momentKey:"years",momentValue:10}]},{displayName:"Weekly",value:"OneWeek",defaultframe:2,momentKey:"weeks",momentValue:1,timeframes:[{displayName:"6 Months",value:"SixMonths",momentKey:"months",momentValue:6},{displayName:"1 Year",value:"OneYear",momentKey:"years",momentValue:1},{displayName:"2 Years",value:"TwoYears",momentKey:"years",momentValue:2},{displayName:"3 Years",value:"ThreeYears",momentKey:"years",momentValue:3},{displayName:"5 Years",value:"FiveYears",momentKey:"years",momentValue:5},{displayName:"10 Years",value:"TenYears",momentKey:"years",momentValue:10}]},{displayName:"Monthly",value:"OneMonth",defaultframe:2,momentKey:"months",momentValue:1,timeframes:[{displayName:"2 Years",value:"TwoYears",momentKey:"years",momentValue:2},{displayName:"3 Years",value:"ThreeYears",momentKey:"years",momentValue:3},{displayName:"5 Years",value:"FiveYears",momentKey:"years",momentValue:5},{displayName:"10 Years",value:"TenYears",momentKey:"years",momentValue:10}]}]},GD),FD;function GD(e){var t=FD.call(this)||this;return t.idAttribute="chartID",t.set(e),t.initialize2(),t}var VisualSettings=(iE=Backbone.View,__extends(jE,iE),jE.prototype.applyTemplate=function(){var t=this;$(this.el).html(T.VisualSettings()),this.colorPickers=[],_.each(this.$el.find("input[name=color]"),function(e){t.colorPickers.push(e),$(e).colorpicker({displayIndicator:!1})}),this.gridLinesOpacitySlicer=this.$el.find(".grid-lines-opacity-slider"),$(this.gridLinesOpacitySlicer).slider({min:0,max:100,step:1}),this.gridLineType=this.$el.find(".grid-line-type"),this.gridLineVisibility=this.$el.find(".grid-lines-visibility"),this.isHollowCandleStick=this.$el.find('input[name="candle-stick-up-hollow"]'),this.chartDimensionsType=this.$el.find(".chart-dimensions-type"),this.chartDimensionsWidthSelect=this.$el.find(".chart-width-select"),this.chartDimensionsWidthInput=this.$el.find('input[name="custom-width"]'),this.chartDimensionsHeightInput=this.$el.find('input[name="custom-height"]'),this.chartDimensionsSetWidthRow=this.$el.find(".chart-dimensions-set-width-row"),this.chartDimensionsCustomRow=this.$el.find(".chart-dimensions-custom-row"),this.axisFontSizeHorizontalSlider=this.$el.find(".axis-font-size-horizontal-slider"),$(this.axisFontSizeHorizontalSlider).slider({min:10,max:14,step:1}),this.axisFontSizeVerticalSlider=this.$el.find(".axis-font-size-vertical-slider"),$(this.axisFontSizeVerticalSlider).slider({min:10,max:14,step:1}),this.$el.find('input[name="default"]').button().on("click",function(){var e=t.model.get("currentTheme"),e=new ChartModel({currentTheme:e});t.model.set({chartDisplayAreaHorizontalGridLinesColor:e.get("chartDisplayAreaHorizontalGridLinesColor"),chartDisplayAreaHorizontalGridLinesOpacity:e.get("chartDisplayAreaHorizontalGridLinesOpacity"),chartDisplayAreaHorizontalGridLinesType:e.get("chartDisplayAreaHorizontalGridLinesType"),chartDisplayAreaVerticalGridLinesColor:e.get("chartDisplayAreaVerticalGridLinesColor"),chartDisplayAreaVerticalGridLinesOpacity:e.get("chartDisplayAreaVerticalGridLinesOpacity"),chartDisplayAreaVerticalGridLinesType:e.get("chartDisplayAreaVerticalGridLinesType"),chartDisplayAreaLineUpColor:e.get("chartDisplayAreaLineUpColor"),chartDisplayAreaLineDownColor:e.get("chartDisplayAreaLineDownColor"),chartDisplayAreaCandleStickUpStroke:e.get("chartDisplayAreaCandleStickUpStroke"),chartDisplayAreaCandleStickDownStroke:e.get("chartDisplayAreaCandleStickDownStroke"),chartDisplayAreaCandleStickUpIsHollow:e.get("chartDisplayAreaCandleStickUpIsHollow"),chartDisplayAreaCandleStickUpFill:e.get("chartDisplayAreaCandleStickUpFill"),chartDisplayAreaCandleStickDownFill:e.get("chartDisplayAreaCandleStickDownFill"),chartDisplayAreaBarUpColor:e.get("chartDisplayAreaBarUpColor"),chartDisplayAreaBarDownColor:e.get("chartDisplayAreaBarDownColor"),chartDisplayAreaKagiUpColor:e.get("chartDisplayAreaKagiUpColor"),chartDisplayAreaKagiDownColor:e.get("chartDisplayAreaKagiDownColor"),axisFontSizeHorizontal:e.get("axisFontSizeHorizontal"),axisFontSizeVertical:e.get("axisFontSizeVertical"),crosshairColor:e.get("crosshairColor"),selectedForeground:e.get("selectedForeground"),selectedBackground:e.get("selectedBackground"),axisTextMinor:e.get("axisTextMinor"),chartDisplayAreaBackground:e.get("chartDisplayAreaBackground"),chartDisplayAreaAlternativeBackground:e.get("chartDisplayAreaAlternativeBackground"),isChartDimensionsActive:e.get("isChartDimensionsActive"),chartDimensionsWidthPx:e.get("chartDimensionsWidthPx"),chartDimensionsHeightPx:e.get("chartDimensionsHeightPx")}),t.turnEventsOff(),t.initializeValues(),t.turnEventsOn(),$(t).trigger("redraw")}),this.$el.find('input[name="ok"]').button().on("click",function(){$(t).trigger("close")})},jE.prototype.initialize=function(e){this.options=e,this.applyTemplate(),this.initializeValues(),this.turnEventsOn()},jE.prototype.initializeValues=function(){var t,i=this,e=(_.each(this.colorPickers,function(e){t=e.getAttribute("data-property-name"),t="grid-lines-color"===t?i.model.get("chartDisplayAreaHorizontalGridLinesColor"):i.model.get(t),$(e).colorpicker({color:t})}),0<this.model.get("chartDisplayAreaHorizontalGridLinesOpacity")),a=0<this.model.get("chartDisplayAreaVerticalGridLinesOpacity"),n=this.model.get("chartDisplayAreaHorizontalGridLinesType")[1];e&&a?(this.gridLineVisibility.find('option[value="both"]').prop("selected","selected"),$(this.gridLinesOpacitySlicer).slider("value",100*this.model.get("chartDisplayAreaHorizontalGridLinesOpacity"))):e?(this.gridLineVisibility.find('option[value="horizontal"]').prop("selected","selected"),$(this.gridLinesOpacitySlicer).slider("value",100*this.model.get("chartDisplayAreaHorizontalGridLinesOpacity"))):a?(this.gridLineVisibility.find('option[value="vertical"]').prop("selected","selected"),$(this.gridLinesOpacitySlicer).slider("value",100*this.model.get("chartDisplayAreaVerticalGridLinesOpacity"))):(this.gridLineVisibility.find('option[value="none"]').prop("selected","selected"),$(this.gridLinesOpacitySlicer).slider("value",0)),0===n?this.gridLineType.find('option[value="line"]').prop("selected","selected"):3===n?this.gridLineType.find('option[value="dots"]').prop("selected","selected"):5===n&&this.gridLineType.find('option[value="dashes"]').prop("selected","selected"),this.model.get("chartDisplayAreaCandleStickUpIsHollow")?this.$el.find('input[name="candle-stick-up-hollow"]').prop("checked",!1):this.$el.find('input[name="candle-stick-up-hollow"]').prop("checked",!0),this.model.get("isChartDimensionsVisible")?(this.$el.find(".chart-dimensions-section").show(),$(this.chartDimensionsWidthInput).spinner({stop:function(){return i.updateChartDimensionsInputs()},min:360,max:1600,step:5}),$(this.chartDimensionsHeightInput).spinner({stop:function(){return i.updateChartDimensionsInputs()},min:220,max:1e3,step:5}),this.$el.find(".ui-spinner").addClass("text-box"),$(this.chartDimensionsWidthInput).spinner("value",this.model.get("chartDimensionsWidthPx")),$(this.chartDimensionsHeightInput).spinner("value",this.model.get("chartDimensionsHeightPx")),(this.chartDimensionsWidthSelect.find('option[value="'+this.model.get("chartDimensionsWidthPx")+'"]').length?this.chartDimensionsWidthSelect.find('option[value="'+this.model.get("chartDimensionsWidthPx")+'"]'):this.chartDimensionsWidthSelect.find('option[value="1024"]')).prop("selected","selected"),this.model.get("isChartDimensionsActive")&&this.model.get("chartDimensionsWidthPx")&&this.model.get("chartDimensionsHeightPx")?this.chartDimensionsType.find('option[value="custom"]').prop("selected","selected"):this.model.get("isChartDimensionsActive")&&this.model.get("chartDimensionsWidthPx")&&!this.model.get("chartDimensionsHeightPx")?(this.chartDimensionsType.find('option[value="set-width"]').prop("selected","selected"),$(this.chartDimensionsHeightInput).spinner("value",this.model.get("chartDimensionsWidthPx")*this.model.get("chartDimensionsHeightPercent"))):this.chartDimensionsType.find('option[value="fit"]').prop("selected","selected"),this.updateChartDimensionsInputs()):this.$el.find(".chart-dimensions-section").hide(),this.model.get("isAxisFontSizeVisible")?(this.$el.find(".axis-font-size-section").show(),console.log("font-size",[this.model.get("axisFontSizeHorizontal"),this.model.get("axisFontSizeVertical")]),$(this.axisFontSizeHorizontalSlider).slider("value",12),$(this.axisFontSizeVerticalSlider).slider("value",12)):this.$el.find(".axis-font-size-section").hide()},jE.prototype.onColorChanged=function(e,t){e=e.target.getAttribute("data-property-name");"grid-lines-color"===e?this.model.set({chartDisplayAreaVerticalGridLinesColor:t,chartDisplayAreaHorizontalGridLinesColor:t}):this.model.set(e,t)},jE.prototype.turnEventsOff=function(){_.each(this.colorPickers,function(e){$(e).off()}),$(this.gridLinesOpacitySlicer).off(),$(this.gridLineType).off(),$(this.gridLineVisibility).off(),$(this.isHollowCandleStick).off()},jE.prototype.turnEventsOn=function(){var i,a=this;_.each(this.colorPickers,function(e){$(e).on("change.color",function(e,t){a.onColorChanged(e,t)})}),$(this.gridLinesOpacitySlicer).on("slide",function(e,t){switch(i=t.value/100,a.gridLineVisibility.prop("value")){case"both":a.model.set({chartDisplayAreaHorizontalGridLinesOpacity:i,chartDisplayAreaVerticalGridLinesOpacity:i});break;case"horizontal":a.model.set({chartDisplayAreaHorizontalGridLinesOpacity:i});break;case"vertical":a.model.set({chartDisplayAreaVerticalGridLinesOpacity:i})}}),$(this.gridLineType).on("change",function(){switch(a.gridLineType.prop("value")){case"line":a.model.set({chartDisplayAreaHorizontalGridLinesType:[5,0],chartDisplayAreaVerticalGridLinesType:[5,0]});break;case"dashes":a.model.set({chartDisplayAreaHorizontalGridLinesType:[5,5],chartDisplayAreaVerticalGridLinesType:[5,5]});break;case"dots":a.model.set({chartDisplayAreaHorizontalGridLinesType:[2,3],chartDisplayAreaVerticalGridLinesType:[2,3]})}}),$(this.gridLineVisibility).on("change",function(){switch(a.gridLineVisibility.prop("value")){case"both":a.model.set({chartDisplayAreaHorizontalGridLinesOpacity:1,chartDisplayAreaVerticalGridLinesOpacity:1}),$(a.gridLinesOpacitySlicer).slider("value",100);break;case"horizontal":a.model.set({chartDisplayAreaHorizontalGridLinesOpacity:1,chartDisplayAreaVerticalGridLinesOpacity:0}),$(a.gridLinesOpacitySlicer).slider("value",100);break;case"vertical":a.model.set({chartDisplayAreaHorizontalGridLinesOpacity:0,chartDisplayAreaVerticalGridLinesOpacity:1}),$(a.gridLinesOpacitySlicer).slider("value",100);break;case"none":a.model.set({chartDisplayAreaHorizontalGridLinesOpacity:0,chartDisplayAreaVerticalGridLinesOpacity:0}),$(a.gridLinesOpacitySlicer).slider("value",0)}}),$(this.isHollowCandleStick).on("click",function(){a.isHollowCandleStick.is(":checked")?a.model.set("chartDisplayAreaCandleStickUpIsHollow",0):a.model.set("chartDisplayAreaCandleStickUpIsHollow",1)}),$(this.chartDimensionsType).on("change",function(){return a.updateChartDimensionsInputs()}),$(this.chartDimensionsWidthSelect).on("change",function(){return a.updateChartDimensionsInputs()}),$(this.chartDimensionsWidthInput).on("change",function(){return a.updateChartDimensionsInputs()}),$(this.chartDimensionsHeightInput).on("change",function(){return a.updateChartDimensionsInputs()}),$(this.axisFontSizeHorizontalSlider).on("slide",function(e,t){i=t.value,a.model.set({axisFontSizeHorizontal:i})}),$(this.axisFontSizeVerticalSlider).on("slide",function(e,t){i=t.value,a.model.set({axisFontSizeVertical:i})})},jE.prototype.updateChartDimensionsInputs=function(){switch(this.chartDimensionsType.prop("value")){case"fit":this.chartDimensionsSetWidthRow.hide(),this.chartDimensionsCustomRow.hide(),this.model.set({isChartDimensionsActive:!1,chartDimensionsWidthPx:null,chartDimensionsHeightPx:null});break;case"set-width":this.chartDimensionsSetWidthRow.show(),this.chartDimensionsCustomRow.hide(),this.model.set({isChartDimensionsActive:!0,chartDimensionsWidthPx:parseInt(this.chartDimensionsWidthSelect.prop("value"),10),chartDimensionsHeightPx:null});break;case"custom":this.chartDimensionsSetWidthRow.hide(),this.chartDimensionsCustomRow.show(),this.model.set({isChartDimensionsActive:!0,chartDimensionsWidthPx:parseInt(this.chartDimensionsWidthInput.prop("value"),10),chartDimensionsHeightPx:parseInt(this.chartDimensionsHeightInput.prop("value"),10)})}},jE),iE;function jE(){return null!==iE&&iE.apply(this,arguments)||this}var SettingsContextMenu=(LE=Backbone.View,__extends(ME,LE),ME.prototype.initialize2=function(e){var t=this;this.options=e,this.clipboard=e.clipboard,this.hasAnnotations=e.hasAnnotations,this.onMainChart=e.onMainChart,this.layerHeight=e.layerHeight,this.positionValue=e.positionValue,this.onMouseUpWrap=function(e){return t.onMouseUp(e)},this.render(),$(document).on("mouseup",this.onMouseUpWrap)},ME.prototype.onMouseUp=function(e){var t=parseFloat(this.contextMenu.css("left")),i=t+this.contextMenu.width(),a=parseFloat(this.contextMenu.css("top")),n=a+this.contextMenu.height();(e.pageX<t||e.pageX>i||e.pageY<a||e.pageY>n)&&this.remove()},ME.prototype.onLimitBtnClick=function(){this.trigger("limit",this.positionValue)},ME.prototype.onStopBtnClick=function(){this.trigger("stop",this.positionValue)},ME.prototype.render=function(){var i=this,e=this.positionValue.toFixed(this.model.get("mainChartAreaValuesAxisDecimalPlaces")),t=this.model.get("currentTheme");return $(this.el).html(T.SettingsContextMenu({price:e})),this.$el.children(":first").addClass(t),this.contextMenu=this.$el.find(".context-menu"),this.$menuLeft=$(this.$el.find("#menu-left")),this.$pasteBtn=this.$el.find(".paste-btn"),this.$removeAllBtn=this.$el.find(".remove-all-btn"),this.$limitBtn=this.$el.find(".add-limit-btn"),this.$stopBtn=this.$el.find(".add-stop-btn"),this.$removeIndicatorButton=this.$el.find(".remove-indicator-button"),this.clipboard&&this.$pasteBtn.show(),this.hasAnnotations&&this.$removeAllBtn.show(),this.onMainChart||(this.$el.find(".not-indicator-menu-item").hide(),this.$removeIndicatorButton.show()),this.$menuLeft.menu({select:function(e,t){t=$(t.item[0]);t.hasClass("settings-btn")?i.showSettings():t.hasClass("paste-btn")?$(i).trigger("paste",{type:"paste",item:$.extend({},i.clipboard)}):t.hasClass("remove-all-btn")?$(i).trigger("delete-all"):t.hasClass("remove-indicator-btn")&&$(i).trigger("remove-indicator"),e.stopPropagation(),e.preventDefault(),i.remove()}}).removeClass("ui-widget-content"),this},ME.prototype.remove=function(){return $(document).off("mouseup",this.onMouseUpWrap),this.trigger("closed"),this.$menuLeft.menu("destroy"),this.contextMenu.remove(),this},ME.prototype.show=function(e){var t=this.$el.find(".context-menu"),i=t.height();"light"===this.model.get("currentTheme")&&t.addClass("light"),this.$el.appendTo($("body")),this.contextMenu.css({left:e.pageX+"px",top:(e.pageY+t.height()>this.layerHeight?e.pageY-i:e.pageY)+"px"})},ME.prototype.showSettings=function(){var t,i=this,e=new VisualSettings({model:this.model});e.$el.dialog({dialogClass:"charting "+this.model.get("currentTheme"),title:"Chart Properties",resizable:!1,width:"auto",close:function(){$(i).trigger("settings-closed"),$(e.$el).dialog("destroy")},open:function(e){$(e.target).css("overflow","visible"),t=$(e.target).parent(),i.model.changeThemeClassForElementWhenThemeChanges(t)}}),$(e).on("close",function(){$(e.$el).dialog("close")}),$(e).on("redraw",function(){$(i).trigger("redraw")})},ME),LE;function ME(e){var t=LE.call(this,e)||this;return t.onMainChart=!0,t.initialize2(e),t}var ChartArea=(CF=Backbone.View,__extends(DF,CF),DF.prototype.addSeries=function(e){this.allSeries.push(e),e.canUserEdit&&this.model.get(this.prefix+"isSeriesBarVisible")&&this.seriesToolbar.addSeries(e);for(var t,i=e.displaySeries.length,a=0;a<i;a+=1)this.displayArea.addSeries(e.displaySeries[a],e.seriesMarkers),this.showLastValue&&(t=e.displaySeries[0].get("elements")[e.displaySeries[0].get("elements").length-1],this.lastValue=t.get("value"));(e.chartArea=this).rightAxis.lastBackground=this.allSeries[0].displaySeries[0].get("lastChangeGreen")?this.model.get("liveGreenColor")||this.model.get("greenColor"):this.model.get("redColor"),1===this.allSeries.length&&(this.seriesMarkers=e.seriesMarkers,e.isIndicator?e.showDecimalPlaces?this.rightAxis.decimalPlaces=this.model.get(this.prefix+"ValuesAxisDecimalPlaces"):this.rightAxis.decimalPlaces=0:this.rightAxis.decimalPlaces=this.model.get("originalDecimalPlaces"))},DF.prototype.applyLayout=function(e,t){var i=0,a=0,n=0,o=0,s=0,r=0,l=0,d=0,c=0,h=0;this.model.get(this.prefix+"isSeriesBarVisible")&&(l=e,0<(r=this.seriesToolbar.$el.height())&&(d=r+this.model.get("seriesBarMarginPx"))),this.$seriesBarDiv.css({top:0,left:0,width:l,height:r}),this.$interactionLayer.css({top:i+=d,left:0,width:e,height:t-d}),this.model.get(this.prefix+"IsRightAxisVisible")&&(a=t-d,n=this.model.get("rightAxisWidthPx")),this.model.get(this.prefix+"IsBottomAxisVisible")&&(o=this.model.get("bottomAxisHeightPx"),s=e),l=e-(0+this.model.get("leftInnerMarginPx")+this.model.get("rightInnerMarginPx")+n),r=t-(d+0+this.model.get("topInnerMarginPx")+this.model.get("bottomInnerMarginPx")+o),this.$displayAreaDiv.css({top:d+0+this.model.get("topInnerMarginPx"),left:0+this.model.get("leftInnerMarginPx"),width:l,height:r}),this.$backgroundDiv.css({top:d+0,left:0,width:e-(0+n),height:t-(d+0+o)}),this.$rightAxisDiv.css({top:i,left:0+this.model.get("leftInnerMarginPx")+l+this.model.get("rightInnerMarginPx"),width:n,height:a}),this.$bottomAxisDiv.css({top:d+0+this.model.get("topInnerMarginPx")+r+this.model.get("bottomInnerMarginPx"),left:0,width:s,height:o}),c=0+l+this.model.get("leftInnerMarginPx")+this.model.get("rightInnerMarginPx")+.15*n,this.$horizontalGrid.css({top:d+0+this.model.get("topInnerMarginPx"),left:0,height:0<r?r:0,width:0<c?c:0}),this.$horizontalGrid.prop("width",0<c?c:0),this.$horizontalGrid.prop("height",0<r?r:0),h=0+r+this.model.get("topInnerMarginPx")+this.model.get("bottomInnerMarginPx")+.15*o,this.$verticalGrid.css({top:+(d+0),left:0+this.model.get("leftInnerMarginPx"),width:0<l?l:0,height:0<h?h:0}),this.$verticalGrid.prop("width",0<l?l:0),this.$verticalGrid.prop("height",0<h?h:0),c=l+this.model.get("leftInnerMarginPx")+this.model.get("rightInnerMarginPx"),h=r+this.model.get("topInnerMarginPx")+this.model.get("bottomInnerMarginPx"),this.$crosshairCanvas.css({top:d+0,left:0,width:0<c?c:0,height:0<h?h:0}),this.$crosshairCanvas.prop("width",0<c?c:0),this.$crosshairCanvas.prop("height",0<h?h:0),this.$drawingCanvas.css({top:d+0,left:0,width:0<c?c:0,height:0<h?h:0}),this.$drawingCanvas.prop("width",0<c?c:0),this.$drawingCanvas.prop("height",0<h?h:0),this.$zoomingCanvas.css({top:d+0,left:0,width:0<c?c:0,height:0<h?h:0}),this.$zoomingCanvas.prop("width",0<c?c:0),this.$zoomingCanvas.prop("height",0<h?h:0),this.rightAxis.setAxisTopBottm(0,t-o),this.bottomAxis.setAxisLeftRight(0,e-n),this.displayArea.onResize(),this.patternHighlight&&this.patternHighlight.onResize(),this.updateDisplayText(this.displayTexAlign,this.displayTexAlignV)},DF.prototype.applyTemplate=function(){var i=this,e=this.model.get("chartBorderColor");this.$el.html(T.ChartArea()),this.$backgroundDiv=this.$el.find(".Background"),this.$rightAxisDiv=this.$el.find(".RightAxisDiv"),this.$bottomAxisDiv=this.$el.find(".BottomAxisDiv"),this.$displayAreaDiv=this.$el.find(".DisplayAreaDiv"),this.$horizontalGrid=this.$el.find(".HorizontalGrid"),this.$verticalGrid=this.$el.find(".VerticalGrid"),this.$crosshairCanvas=this.$el.find(".CrosshairCanvas"),this.$drawingCanvas=this.$el.find(".DrawingCanvas"),this.$zoomingCanvas=this.$el.find(".ZoomingCanvas"),this.$seriesBarDiv=this.$el.find(".SeriesBarDiv"),this.$interactionLayer=this.$el.find(".InteractionLayer"),this.$displayText=this.$el.find(".DisplayText"),this.$interactionLayer.css("background-color","white"),this.$interactionLayer.css("opacity","0"),this.$crosshairCanvas.css({"border-left":"1px solid "+e,"border-top":"1px solid "+e,"border-right":"1px solid "+e}),this.$backgroundDiv.css("background-color",this.model.get("chartDisplayAreaBackground")),this.displayArea=new DisplayArea({el:this.$displayAreaDiv,model:this.model,drawingLocked:this.drawingLocked}),this.displayArea.displayFromIndex=this.tempDisplayFrom,this.displayArea.displayToIndex=this.tempDisplayTo,this.displayArea.isLiveElementEnabled=this.isLiveElementEnabled,this.rightAxis=new VerticalAxis({el:this.$rightAxisDiv,model:this.model,axisSide:"Right",prefix:this.prefix,showLastValue:!("indicatorChartArea"===this.prefix),decimalPlaces:"indicatorChartArea"===this.prefix?0:this.model.get("originalDecimalPlaces"),displayArea:this.displayArea}),this.bottomAxis=new HorizontalAxis({el:this.$bottomAxisDiv,model:this.model}),this.seriesToolbar=new SeriesToolbar({el:this.$seriesBarDiv}),this.annotationsManager=new AnnotationsManager(this.$drawingCanvas,this.displayArea,this.model.get(this.prefix+"ValuesAxisDecimalPlaces"),this.model,"mainChartArea"===this.options.prefix),this.listenTo(this.model,"change:"+this.prefix+"ValuesAxisDecimalPlaces",function(e,t){i.annotationsManager.setDecimals(t)}),this.displayArea.annotationsManager=this.annotationsManager},DF.prototype.calculateDisplayDates2=function(e,t,i){var a,n,o,s,r=[],l=!1,d=[],c=!0,h=!1,p=[["10year","yyyy","a"],["5year","yyyy","a"],["1year","yyyy","a"],["3month","mmm","b"],["1month","mmm","b"],["15day","d","c"],["7day","d","c"],["1day","d","c"],["6h","HH:MM","d"],["3h","HH:MM","d"],["1h","HH:MM","d"],["15min","HH:MM","e"],["5min","HH:MM","e"],["1min","HH:MM","e"],["1sec","HH:MM:ss","f"],["1tick","HH:MM:ss","g"]],u=parseInt((.021*i).toString(),10);if("number"!=typeof e||isNaN(e)||"number"!=typeof t||isNaN(t))return null;for(n=0;!l&&n<p.length;n++){for(a=e;!l&&a<=t;a++)this.displayArea.allDatesTags[a]===p[n][0]&&(d.push({index:a,isMajorTick:c||o===p[n][2],format:p[n][1],date:this.displayArea.allDates[a]}),r.length+d.length>=u&&(l=!0));!l&&0<d.length&&(c&&(c=!1,o=p[n][2],s=p[n][1]),h=!d[0].isMajorTick,r=r.concat(d),d=[])}return h||_.each(r,function(e){e.isMajorTick=!1}),0<r.length&&r[0].index!==e&&((i=new Array).push({index:e,isMajorTick:h,format:s,date:this.displayArea.allDates[e]}),r=i.concat(r)),_.sortBy(r,function(e){return e.date})},DF.prototype.checkIsMouseOverRightAxis=function(e){var t=this.$rightAxisDiv.offset(),i=this.$rightAxisDiv.width(),a=this.$rightAxisDiv.height();return e.pageX>=t.left&&e.pageX<=t.left+i&&e.pageY>=t.top&&e.pageY<=t.top+a},DF.prototype.checkIsMouseOverResizeEdge=function(e){var t,i,a=!1;return this.model.get(this.prefix+"CanUserResize")&&(t=this.$interactionLayer.offset(),i=this.$interactionLayer.width(),a=e.pageX>=t.left&&e.pageX<=t.left+i&&e.pageY>=t.top&&e.pageY<=t.top+9),a},DF.prototype.getMonthStep=function(e,t){var i=1;switch(e){case"Tick":case"OneMinute":case"TwoMinute":case"ThreeMinute":case"FiveMinute":case"FifteenMinute":case"ThirtyMinute":case"SixtyMinute":case"FourHour":break;case"OneDay":i=2.7<t?1:.64<t?3:.24<t?6:12;break;case"OneWeek":i=18<t?1:5.5<t?2:2.7<t?3:1.2<t?6:12;break;case"OneMonth":i=33<t?1:17.8<t?2:12<t?3:6<t?6:12}return i},DF.prototype.getDaysStep=function(e,t){var i=1;switch(e){case"Tick":case"OneMinute":case"TwoMinute":case"ThreeMinute":case"FiveMinute":case"FifteenMinute":case"ThirtyMinute":case"SixtyMinute":break;case"FourHour":i=9.1<t?1:4.5<t?2:3;break;case"OneDay":i=50<t?1:14<t?5:6<t?10:32;break;case"OneWeek":case"OneMonth":i=32}return i},DF.prototype.getHoursStep=function(e,t){var i=1;switch(e){case"Tick":case"OneMinute":case"TwoMinute":case"ThreeMinute":i=.85<t?1:.54<t?2:.31<t?4:.22<t?6:12;break;case"FiveMinute":i=4.1<t?1:1.8<t?2:1.2<t?4:.7<t?6:12;break;case"FifteenMinute":i=13<t?1:9<t?2:4.2<t?4:2.6<t?6:1.1<t?12:.6<t?24:48;break;case"ThirtyMinute":i=26<t?1:13.5<t?2:9.6<t?4:4.8<t?6:2.2<t?12:1<t?24:48;break;case"SixtyMinute":i=49<t?1:32<t?2:13<t?4:9.5<t?6:3.6<t?12:1.7<t?24:48;break;case"FourHour":i=51<t?4:30<t?8:16<t?12:9.1<t?24:4.5<t?48:72;break;case"OneDay":i=54<t?24:38<t?48:20<t?72:12<t?96:120;break;default:i=1}return i},DF.prototype.getMinutesStep=function(e,t){var i=1;switch(e){case"Tick":i=10<t?1:5.5<t?5:3.5<t?7:1.5<t?15:1<t?30:.6<t?60:.3<t?120:180;break;case"OneMinute":case"TwoMinute":case"ThreeMinute":i=10<t?5:5.5<t?10:3.5<t?15:1.5<t?30:1<t?60:.6<t?120:.3<t?240:360;break;case"FiveMinute":i=19<t?15:10<t?30:3.8<t?60:3<t?120:240;break;case"FifteenMinute":i=13<t?60:7.3<t?120:2.5<t?240:360;break;case"ThirtyMinute":i=50<t?30:25<t?60:14<t?120:6.1<t?240:360;break;case"SixtyMinute":i=50<t?60:32<t?120:11<t?240:360;break;default:i=1}return i},DF.prototype.clearCrosshair=function(){var e=this.$crosshairCanvas[0].getContext("2d"),t=this.$crosshairCanvas.prop("width"),i=this.$crosshairCanvas.prop("height");e.clearRect(0,0,t,i),this.model.get(this.prefix+"IsRightAxisVisible")&&this.rightAxis.setSelectedValue(null)},DF.prototype.clearMouseZoomY=function(){this.previousZoomY=null,this.isZoomingY=!1},DF.prototype.clearSelectedDates=function(){this.model.get(this.prefix+"IsBottomAxisVisible")&&this.bottomAxis.setSelectedDates(null)},DF.prototype.clearSelectedValue=function(){this.model.get(this.prefix+"IsRightAxisVisible")&&this.rightAxis.setSelectedValue(null)},DF.prototype.clearSeries=function(){this.allSeries=[],this.displayArea.clear(),this.seriesToolbar.clear(),this.patternHighlight&&this.patternHighlight.clearPatterns()},DF.prototype.display=function(e,t){this.displayArea.displaySeries(e,t),this.pendingDatesChangeEvent=!0},DF.prototype.displayCurrent=function(){this.display(this.displayArea.displayFromIndex,this.displayArea.displayToIndex)},DF.prototype.drawCrosshair=function(e,t,i,a,n,o){var s,r,l,d,c;this.model.get("showCrosshair")&&(r=s=0,l=this.$crosshairCanvas[0].getContext("2d"),d=this.$crosshairCanvas.prop("width"),c=this.$crosshairCanvas.prop("height"),o=o&&"percent"===this.model.get("stockDisplayValues")?this.displayArea.allSeries[0].get("percentBase"):null,l.clearRect(0,0,d,c),0<this.displayArea.elementsCount&&(l.strokeStyle=this.model.get("crosshairColor"),l.strokeWidth=1,r=i?(s=(n&&i.get("isFake")?this.displayArea.getValuePosition(n.get("value"),o):this.displayArea.getValuePosition(i.get("value"),o))+this.model.get("topInnerMarginPx"),this.displayArea.xRatio*(i.get("index")-this.displayArea.displayFromIndex+1)-this.displayArea.xRatio/2+this.model.get("leftInnerMarginPx")):(s=t-this.$crosshairCanvas.offset().top,e-this.$crosshairCanvas.offset().left),l.beginPath(),a||(l.moveTo(.5,Math.floor(s)+.5),l.lineTo(Math.floor(d)+.5,Math.floor(s)+.5)),l.moveTo(Math.floor(r)+.5,.5),l.lineTo(Math.floor(r)+.5,Math.floor(c)+.5),l.stroke()))},DF.prototype.drawDashedLine=function(e,t,i,a,n,o){for(var s=(o=o||[10,0]).length,r=(e.moveTo(t,i),a-t+1e-8),a=n-i,l=a/r,d=Math.sqrt(r*r+a*a),c=0,h=!0;.1<=d;){var p=o[c++%s],u=(d<p&&(p=d),Math.sqrt(p*p/(1+l*l)));t+=u=r<0?-u:u,i+=l*u,h?e.lineTo(t,i):e.moveTo(t,i),d-=p,h=!h}},DF.prototype.drawSelectedDates=function(e){this.model.get(this.prefix+"IsBottomAxisVisible")&&this.bottomAxis.setSelectedDates(e)},DF.prototype.drawSelectedValue=function(e){this.model.get(this.prefix+"IsRightAxisVisible")&&this.rightAxis.setSelectedValue(e)},DF.prototype.drawHorizontalGridLines=function(e){var t,i,a,n=this.$horizontalGrid[0].getContext("2d"),o=this.$horizontalGrid.prop("width"),s=this.$horizontalGrid.prop("height"),r=(this.allSeries[0]&&this.allSeries[0].seriesMarkers?this.seriesMarkers=this.allSeries[0].seriesMarkers:this.seriesMarkers=[],this.lastDisplayValues=e,_.uniqBy(e,function(e){return e[0]}));if(n.clearRect(0,0,o,s),this.$horizontalGrid.css("opacity",this.model.get("chartDisplayAreaHorizontalGridLinesOpacity")),n.strokeWidth=1,r)for(a=r.length,i=0;i<a;i+=1)t=0===i?Math.round(r[i][1])-(this.model.get("topInnerMarginPx")+1):Math.round(r[i][1])-this.model.get("topInnerMarginPx"),_.includes(this.seriesMarkers,r[i][0])?(n.strokeStyle=this.model.get("chartDisplayAreaHorizontalMarkerColor"),n.beginPath(),n.moveTo(.5,Math.floor(t)+.5),n.lineTo(Math.floor(o)+.5,Math.floor(t)+.5)):(n.strokeStyle=this.model.get("chartDisplayAreaHorizontalGridLinesColor"),n.beginPath(),this.drawDashedLine(n,.5,Math.floor(t)+.5,Math.floor(o)+.5,Math.floor(t)+.5,this.model.get("chartDisplayAreaHorizontalGridLinesType"))),n.stroke()},DF.prototype.drawVerticalGidLines=function(e){var t,i,a,n,o,s=this.$verticalGrid[0].getContext("2d"),r=this.$verticalGrid.prop("width"),l=this.$verticalGrid.prop("height"),d=Helpers.hexToRgb(this.model.get("chartDisplayAreaVerticalGridLinesColor"));if(this.lastDisplayDates=e,s.clearRect(0,0,r,l),null!==e&&0<(i=e.length)){for(s.strokeStyle="rgba("+d.r+","+d.g+","+d.b+","+this.model.get("chartDisplayAreaVerticalGridLinesOpacity")+")",s.beginPath(),o=e.length%2,t=0;t<i;t+=1)this.drawDashedLine(s,Math.floor(e[t].position)+.5,.5,Math.floor(e[t].position)+.5,Math.floor(l)+.5,this.model.get("chartDisplayAreaVerticalGridLinesType")),t&&t%2==o&&(s.fillStyle=this.model.get("chartDisplayAreaAlternativeBackground"),n=Math.floor(e[t-1].position)+.5,a=Math.floor(e[t].position)-n,s.fillRect(n,.5,a,Math.floor(l)+.5));i%2==o&&(s.fillStyle=this.model.get("chartDisplayAreaAlternativeBackground"),n=Math.floor(e[i-1].position)+.5,s.fillRect(n,.5,a=r-n,Math.floor(l)+.5)),s.stroke()}},DF.prototype.handleMouseZoom=function(e,t){var i,a,n,o,s,r,t=this.displayArea.allSeries[0].get("elements")[t];this.isZooming&&this.model.get("allowZoom")&&t&&t.bounds&&(i=this.$zoomingCanvas[0].getContext("2d"),r=this.$zoomingCanvas[0].width,a=this.$zoomingCanvas[0].height,i.clearRect(-1,-1,r+2,a+2),this.selectedItems.length<=0?this.selectedItems.push(t):(t.get("isLiveElement")||(this.selectedItems[1]=t),i.fillStyle="rgba(84, 141, 212, 0.2)",i.strokeStyle="rgba(84, 141, 212, 1.0)",i.lineWidth=1,r=this.selectedItems[0].bounds.left,r+=this.selectedItems[0].get("isLiveElement")?this.displayArea.mainCanvas.prop("width")-this.displayArea.xRatio:0,n=this.selectedItems[0].bounds.right,n+=this.selectedItems[0].get("isLiveElement")?this.displayArea.mainCanvas.prop("width")-this.displayArea.xRatio:0,o=t.bounds.left,o+=t.get("isLiveElement")?this.displayArea.mainCanvas.prop("width")-this.displayArea.xRatio:0,s=t.bounds.right,s+=t.get("isLiveElement")?this.displayArea.mainCanvas.prop("width")-this.displayArea.xRatio:0,t=r<o?r:o,t+=this.model.get("leftInnerMarginPx"),r=s<n?n:s,r+=this.model.get("rightInnerMarginPx"),i.fillRect(t,0,r-t,a),i.beginPath(),i.moveTo(t,0),i.lineTo(t,a),i.moveTo(r,0),i.lineTo(r,a),i.stroke()))},DF.prototype.handleMouseZoomY=function(e,t,i,a){void 0===i&&(i=!1),void 0===a&&(a=!1);(t=void 0===t?!1:t)&&a||e.pageY>this.previousZoomY&&13<=e.pageY-this.previousZoomY?(this.model.set({autoZoomY:!1,zoomYLevel:this.model.get("zoomYLevel")-1}),this.previousZoomY=e.pageY):(t&&i||e.pageY<this.previousZoomY&&13<=this.previousZoomY-e.pageY)&&this.model.get("zoomYLevel")<45&&(this.model.set({autoZoomY:!1,zoomYLevel:this.model.get("zoomYLevel")+1}),this.previousZoomY=e.pageY),this.display(this.displayArea.displayFromIndex,this.displayArea.displayToIndex)},DF.prototype.cancelMouseZoom=function(){var e,t,i;this.isZooming&&(e=this.$zoomingCanvas[0].getContext("2d"),t=this.$zoomingCanvas.prop("width"),i=this.$zoomingCanvas.prop("height"),e.clearRect(0,0,t,i),this.selectedItems=[],this.isZooming=!1)},DF.prototype.handleMouseLeave=function(){var e=this.$crosshairCanvas[0].getContext("2d"),t=this.$crosshairCanvas.prop("width"),i=this.$crosshairCanvas.prop("height");e.clearRect(0,0,t,i),this.cancelMouseZoom(),this.annotationsManager.isDrawing&&this.annotationsManager.isDrawingStarted?$(this).trigger("stopDrawing",{type:"stopDrawing"}):this.isZoomingY&&(this.isZoomingY=!1,this.clearMouseZoomY(),$(this).trigger("zoomY",{type:"zoomY"})),this.model.get(this.prefix+"IsRightAxisVisible")&&this.rightAxis.setSelectedValue(null),this.model.get(this.prefix+"IsBottomAxisVisible")&&this.bottomAxis.setSelectedDates(null)},DF.prototype.handleChartDragging=function(e){var t=this.draggingStartX>e.pageX,i=t?this.draggingStartX-e.pageX:e.pageX-this.draggingStartX,i=parseInt(Math.abs(i/this.displayArea.xRatio).toString(),10);0<i&&(this.draggingStartX=e.pageX),$(this).trigger("moveChart",{type:"moveChart",direction:t?"left":"right",step:i})},DF.prototype.clearPatterns=function(){this.patternHighlight&&this.patternHighlight.clearPatterns()},DF.prototype.initialize2=function(e){this.options=e,this.tempDisplayFrom=e.displayAreaFromIndex,this.tempDisplayTo=e.displayAreaToIndex,this.isLiveElementEnabled=e.isLiveElementEnabled,this.drawingLocked=e.drawingLocked,this.prefix=e.prefix,this.showLastValue=e.showLastValue,this.isMouseOn=!1,this.selectedItems=[],this.allSeries=[],this.applyTemplate(),this.initializeEvents(),this.onResize()},DF.prototype.initializeEvents=function(){var i=this;$(this.displayArea).on("displayUpdated",function(){return i.onDisplayUpdated()}),this.listenTo(this.model,"change:lastAvgPrice",function(){return i.onDisplayUpdated()}),$(this.seriesToolbar).on("toolbarresize",function(){return i.onToolbarResize()}),$(this.seriesToolbar).on("removeSeriesRequest",function(e,t){return i.onRemoveSeriesRequest(e,t)}),$(this.rightAxis).on("liveCloudChanged",function(e,t){return i.onLiveCloudChanged(e,t)}),this.patternHighlight&&$(this.patternHighlight).on("pattern-selected-on-chart",function(e){$(i).trigger(e)}),this.model.get("isTouch")?this.initTouch():(this.$interactionLayer.dblclick(function(e){return i.onMouseDblClick(e)}),this.$interactionLayer.mouseup(function(e){return i.onMouseUp(e)}),this.$interactionLayer.mousedown(function(e){return i.onMouseDown(e)}),this.$interactionLayer.mousemove(function(e){return i.onMouseMove(e)}),this.$interactionLayer.mouseleave(function(e){return i.onMouseLeave(e)}),this.model.get("allowScroll")&&this.$interactionLayer.on("mousewheel wheel",function(e){return i.onMouseWheel(e)}),this.model.get("isContextMenuEnabled")&&(window.oncontextmenu=function(){return!window.leftClicked||(window.leftClicked=!1)},this.$interactionLayer.mousedown(function(e){return 2!==e.button||(i.onContextMenu(e),!(window.leftClicked=!0))})),this.model.get("doubleclickNotification")&&this.$interactionLayer.dblclick(function(){$(i).trigger("dblclick")})),this.model.on("change:chartDisplayAreaBackground",function(){i.$backgroundDiv.css("background-color",i.model.get("chartDisplayAreaBackground"))}),this.model.on("change:chartDisplayAreaVerticalGridLinesColor",function(){return i.drawVerticalGidLines(i.lastDisplayDates)}),this.model.on("change:chartDisplayAreaVerticalGridLinesOpacity",function(){return i.drawVerticalGidLines(i.lastDisplayDates)}),this.model.on("change:chartDisplayAreaVerticalGridLinesType",function(){return i.drawVerticalGidLines(i.lastDisplayDates)}),this.model.on("change:chartDisplayAreaAlternativeBackground",function(){return i.drawVerticalGidLines(i.lastDisplayDates)}),this.model.on("change:chartDisplayAreaHorizontalGridLinesColor",function(){return i.drawHorizontalGridLines(i.lastDisplayValues)}),this.model.on("change:chartDisplayAreaHorizontalGridLinesOpacity",function(){return i.drawHorizontalGridLines(i.lastDisplayValues)}),this.model.on("change:chartDisplayAreaHorizontalGridLinesType",function(){return i.drawHorizontalGridLines(i.lastDisplayValues)}),this.model.on("change:chartBorderColor",function(){i.$crosshairCanvas.css({"border-left":"1px solid "+i.model.get("chartBorderColor"),"border-top":"1px solid "+i.model.get("chartBorderColor"),"border-right":"1px solid "+i.model.get("chartBorderColor")})},this),this.model.on("change:axisFontSizeHorizontal",function(){i.$bottomAxisDiv.css("font-size",i.model.get("axisFontSizeHorizontal"))}),this.model.on("change:axisFontSizeVertical",function(){i.$rightAxisDiv.css("font-size",i.model.get("axisFontSizeVertical"))})},DF.prototype.initTouch=function(){var i,a,n=this,o=!1,s=_.throttle(function(e,t){$(n).trigger("moveChart",{type:"moveChart",direction:"pinchout"===e?"zoom-in":"zoom-out",step:t})},100),e=new Hammer(this.$interactionLayer[0]);e.get("pinch").set({enable:!0,threshold:0}),e.on("panstart",function(e){n.touchDrag=!0,n.isDraggingChart=!0,n.draggingStartX=e.center.x}),e.on("panmove",function(e){n.handleChartDragging({pageX:e.center.x+e.deltaX,pageY:e.center.y+e.deltaY})}),e.on("panend",function(){n.isDraggingChart=!1,n.draggingStartX=null}),e.on("pinchstart",function(){o=!0,i=0}),e.on("pinchend",function(){o=!1,i=0}),e.on("pinchin pinchout",function(e){var t;o&&(t=Math.round(e.distance-i),i=e.distance,a=n.displayArea.displayToIndex-n.displayArea.displayFromIndex,0<(t=Math.round(.01*a+t))&&s(e.type,t))})},DF.prototype.onContextMenu=function(e){var t,i,a,n,o,s=this,r=this.annotationsManager.onContextMenu(e);return r&&!this.isContextOpen&&"InteractionLayer"===e.target.className&&(t=(i=this.$interactionLayer.offset()).left,i=i.top,a=t+this.$interactionLayer.width(),n=i+this.$interactionLayer.height(),e.pageX>=t&&e.pageX<=a&&e.pageY>=i&&e.pageY<=n?(o=new SettingsContextMenu({model:this.model,clipboard:this.annotationsManager.clipboard,hasAnnotations:0<this.annotationsManager.allAnnotations.length,layerHeight:this.$interactionLayer.height(),positionValue:this.displayArea.getPositionValue(e.pageY),onMainChart:"mainChartArea"===this.prefix}),this.isContextOpen=!0,o.show(e),o.on("closed",function(){o.off(),s.isContextOpen=!1}),$(o).on("redraw",function(){s.onResize()}),$(o).on("delete-all",function(){s.annotationsManager.clearAnnotationsForced()}),$(o).on("remove-indicator",function(){$(s).trigger("remove-indicator",{type:"remove-indicator",chartArea:s})}),$(o).on("paste",function(e,t){var i=t.item,a=(i.drawTool={tool:t.item.drawTool.tool,fillColorDef:t.item.drawTool.fillColorDef,fillOpacity:t.item.drawTool.fillOpacity,lineColorDef:t.item.drawTool.lineColorDef,lineOpacity:t.item.drawTool.lineOpacity,lineThickness:t.item.drawTool.lineThickness,textColor:t.item.drawTool.textColor,textMargin:t.item.drawTool.textMargin,textSize:t.item.drawTool.textSize},i.drawStartPoint={selectedIndex:t.item.drawStartPoint.selectedIndex,selectedItem:t.item.drawStartPoint.selectedItem,selectedPrice:t.item.drawStartPoint.selectedPrice,x:(t.item.drawStartPoint.selectedItem.get("index")-s.annotationsManager.lastDisplayFromIndex)*s.annotationsManager.lastxRatio+t.item.drawStartPoint.xAddOn*s.annotationsManager.lastxRatio,xAddOn:t.item.drawStartPoint.xAddOn,y:s.displayArea.getValuePosition(t.item.drawStartPoint.selectedPrice)},i.drawEndPoint={selectedIndex:t.item.drawEndPoint.selectedIndex,selectedItem:t.item.drawEndPoint.selectedItem,selectedPrice:t.item.drawEndPoint.selectedPrice,x:(t.item.drawEndPoint.selectedItem.get("index")-s.annotationsManager.lastDisplayFromIndex)*s.annotationsManager.lastxRatio+t.item.drawEndPoint.xAddOn*s.annotationsManager.lastxRatio,xAddOn:t.item.drawEndPoint.xAddOn,y:s.displayArea.getValuePosition(t.item.drawEndPoint.selectedPrice)},a=Helpers.hexToRgb(i.drawTool.lineColorDef),i.drawTool.lineColor="rgba("+a.r+","+a.g+","+a.b+","+i.drawTool.lineOpacity/100+")",a=Helpers.hexToRgb(i.drawTool.fillColorDef),i.drawTool.fillColor="rgba("+a.r+","+a.g+","+a.b+","+i.drawTool.fillOpacity/100+")","text-note"===t.item.drawTool.tool&&(i.notePoints=[]),s.annotationsManager.addAnnotation(i));a.drawStartTime=Helpers.getNextDate(a.drawStartPoint.selectedItem.get("quoteDate"),s.model.get("granularity")).getTime(),a.drawEndTime=Helpers.getNextDate(a.drawEndPoint.selectedItem.get("quoteDate"),s.model.get("granularity")).getTime(),s.annotationsManager.drawAnnotations(s.annotationsManager.lastxRatio,s.annotationsManager.lastDisplayFromIndex)}),r=!1):this.isContextOpen&&(this.isContextOpen=!1)),r},DF.prototype.onDisplayUpdated=function(){var e,t,i,a=this,n=this.displayArea.displayValues,o=this.calculateDisplayDates2(this.displayArea.displayFromIndex,this.displayArea.displayToIndex,this.displayArea.$el.width()),s=[],r=[];if(o){if(!this.valuesDivider){for(i=(t=[1]).length,e=0;e<i;e+=1)if(0<this.displayArea.min-t[e]){this.valuesDivider=t[e];break}0<n.length&&!this.valuesDivider&&(this.valuesDivider=1)}for(i=n.length,e=0;e<i;e+=1)s.push([n[e]/this.valuesDivider,this.displayArea.getValuePosition(n[e])+this.model.get("topInnerMarginPx")]);for(this.drawHorizontalGridLines(s),this.rightAxis.setDisplayValues(s),i=o.length,e=0;e<i;e+=1)r.push({date:this.displayArea.allDates[o[e].index],position:this.displayArea.xRatio*(o[e].index-this.displayArea.displayFromIndex),isMajorTick:o[e].isMajorTick,format:o[e].format});this.drawVerticalGidLines(r),this.bottomAxis.setDates(r),this.model.get(this.prefix+"IsRightAxisVisible")&&(this.lastBgd=null,this.rightAxis.onResize()),this.model.get(this.prefix+"IsBottomAxisVisible")&&this.bottomAxis.onResize(),this.pendingDatesChangeEvent&&(this.displayArea.hasDatesRangeChanged||this.displayArea.hasPriceRangeChanged)&&(this.pendingDatesChangeEvent=!1,this.patternHighlight&&this.patternHighlight.updateDisplay(),$(this).trigger("datesRangeChanged",{type:"datesRangeChanged",itemsOnDisplay:this.displayArea.elementsCount,startDate:this.displayArea.allDates[this.displayArea.displayFromIndex],endDate:this.displayArea.allDates[this.displayArea.displayToIndex],elements:this.displayArea.allSeries[0].get("elements").slice(this.displayArea.displayFromIndex,this.displayArea.displayToIndex+1),isLiveElementVisible:this.displayArea.displayToIndex===this.displayArea.allSeries[0].get("elements").length-1,min:this.displayArea.min,max:this.displayArea.max}))}this.firstRender&&(this.firstRender=!1,_.defer(function(){a.annotationsManager.applyAnnotationsStorage()})),$(this).trigger("chart-rendered")},DF.prototype.onLiveCloudChanged=function(e,t){t.show?"rightAxis"===t.source&&(this.rightLiveCloud={left:t.left,top:t.top,width:t.width,height:t.height}):"rightAxis"===t.source&&(this.rightLiveCloud=null)},DF.prototype.onLiveElementCanvasUpdated=function(){this.lastValue=this.model.get("lastAvgPrice"),this.isMouseOn&&this.onMouseMove({pageX:this.lastMouseX,pageY:this.lastMouseY})},DF.prototype.onMouseDblClick=function(e){this.annotationsManager.onMouseDblClick(e)},DF.prototype.onMouseDown=function(e){var t;this.checkIsMouseOverRightAxis(e)?(this.isZoomingY=!0,this.previousZoomY=e.pageY):this.annotationsManager.onMouseDown(e)||(this.isZoomingEnabled?(this.isZooming=!0,this.selectedItems=[]):this.patternHighlight&&this.patternHighlight.isActive()?(t=this.displayArea.getPositionDate(e.pageX),this.patternHighlight.startSelection(t[2])):this.checkIsMouseOverResizeEdge(e)?(this.isResizingChartArea=!0,$(this).trigger("startResize",{type:"startResize",pageX:e.pageX,pageY:e.pageY,source:this})):(this.isDraggingChart=!0,this.draggingStartX=e.pageX))},DF.prototype.onMouseUp=function(e){var t,i;this.isZooming&&this.selectedItems&&2<=this.selectedItems.length?(i=this.selectedItems[0].get("index")<this.selectedItems[1].get("index")?(t=this.selectedItems[0].get("index"),this.selectedItems[1].get("index")):(t=this.selectedItems[1].get("index"),this.selectedItems[0].get("index")),this.cancelMouseZoom(),t!==i&&$(this).trigger("zoom",{type:"zoom",fromIndex:t,toIndex:i})):this.annotationsManager.onMouseUp(e)?($(this).trigger("stopDrawing",{type:"stopDrawing"}),this.$interactionLayer.css("cursor","default")):this.isZoomingY?(this.clearMouseZoomY(),$(this).trigger("zoomY",{type:"zoomY"})):this.isDraggingChart?(this.isDraggingChart=!1,this.draggingStartX=null):this.patternHighlight&&this.patternHighlight.isActive()?this.patternHighlight.endSelection():this.isResizingChartArea&&(this.isResizingChartArea=!1,$(this).trigger("stopResize",{type:"stopResize",source:this}))},DF.prototype.onMouseMove=function(e){var t,i,a,n=this.displayArea.getPositionIndex(e.pageX),o=[];this.isMouseOn=!0,this.lastMouseX=e.pageX,this.lastMouseY=e.pageY,this.annotationsManager.isActive(e,n)?(i=this.annotationsManager.showCrosshair,this.$interactionLayer.css("cursor",this.annotationsManager.cursor)):this.isZooming&&-1!==n?(this.handleMouseZoom(e,n),1<this.selectedItems.length&&(o.push([this.selectedItems[0].get("quoteDate"),this.displayArea.xRatio*(this.selectedItems[0].get("index")-this.displayArea.displayFromIndex+1)-this.displayArea.xRatio/2+this.model.get("leftInnerMarginPx")]),o.push([this.selectedItems[1].get("quoteDate"),this.displayArea.xRatio*(this.selectedItems[1].get("index")-this.displayArea.displayFromIndex+1)-this.displayArea.xRatio/2+this.model.get("leftInnerMarginPx")]))):this.checkIsMouseOverRightAxis(e)?(this.isMouseOn=!1,this.$interactionLayer.css("cursor","n-resize"),this.isZoomingY&&this.handleMouseZoomY(null,e),this.patternHighlight&&this.patternHighlight.isActive()&&this.patternHighlight.cancelSelection()):this.isZoomingY?(this.isZoomingY=!1,this.clearMouseZoomY(),$(this).trigger("zoomY",{type:"zoomY"})):this.patternHighlight&&this.patternHighlight.isActive()&&-1!==n?(t=this.displayArea.allSeries[0].get("elements")[n])&&(t.get("isFake")||t.get("isLiveElement")?this.patternHighlight.cancelSelection():this.patternHighlight.updateSelection(t),$(this).trigger("interactionmousemove",{type:"interactionmousemove",pageX:e.pageX,pageY:e.pageY,sourceChartArea:this,mouseIndex:n,event:e})):this.isDraggingChart&&!this.model.get("isTouch")||this.isDraggingChart&&this.model.get("isTouch")&&this.touchDrag?this.handleChartDragging(e):this.checkIsMouseOverResizeEdge(e)?this.$interactionLayer.css("cursor","n-resize"):("default"!==this.$interactionLayer.css("cursor")&&this.$interactionLayer.css("cursor","default"),this.isMouseOn=!0,i=!(this.isZooming=!1)),i?(this.model.get("snapToDataPoint")&&"mainChartArea"===this.prefix?(t=t||this.displayArea.allSeries[0].get("elements")[n])&&t.get("isFake")&&this.displayArea.allSeries[0].get("liveElement")&&((i=new Date(this.displayArea.allSeries[0].get("liveElement").get("quoteDate"))).setSeconds(0),i.getTime()>=t.get("quoteDate").getTime()&&(a=this.displayArea.allSeries[0].get("liveElement"))):t=null,this.drawCrosshair(e.pageX,e.pageY,t,!1,a,"mainChartArea"===this.prefix),this.refreshSelectedPriceAndDate(e.pageX,e.pageY,n,t,a,"mainChartArea"===this.prefix),-1!==n&&$(this).trigger("interactionmousemove",{type:"interactionmousemove",pageX:e.pageX,pageY:e.pageY,sourceChartArea:this,mouseItem:t,mouseIndex:n,event:e,liveItem:a})):(this.clearCrosshair(),this.clearSelectedValue(),0<o.length?this.drawSelectedDates(o):this.clearSelectedDates())},DF.prototype.onMouseLeave=function(e){this.handleMouseLeave(),this.isMouseOn=!1,this.isDraggingChart=!1,"default"!==this.$interactionLayer.css("cursor")&&this.$interactionLayer.css("cursor","default"),this.patternHighlight&&this.patternHighlight.cancelSelection(),$(this).trigger("interactionmouseleave",{type:"interactionmouseleave",eventArgs:e,eventSource:this})},DF.prototype.onMouseWheel=function(e){var t,i,a,e=e.originalEvent||e;this.checkIsMouseOverRightAxis(e)?e.deltaY&&(0<e.deltaY?this.handleMouseZoomY(e,!0,!1,!0):this.handleMouseZoomY(e,!0,!0,!1),$(this).trigger("zoomY",{type:"zoomY"})):(a=this.displayArea.displayFromIndex,t=this.displayArea.displayToIndex,t=parseInt((.03*(t-a)).toString(),10),a=$(e.currentTarget).width(),i=e.clientX,t<=0&&(t=1),e.deltaY&&(e=0<e.deltaY?"zoom-in":"zoom-out",$(this).trigger("moveChart",{type:"moveChart",direction:e,step:t,leftRatio:i/a,rightRatio:(a-i)/a})))},DF.prototype.onRemoveSeriesRequest=function(e,t){this.removeSeries(t.series)},DF.prototype.onResize=function(){var e=this.$el.width(),t=this.$el.height();this.applyLayout(e,t)},DF.prototype.onToolbarResize=function(){$(this).trigger("toolbarResize")},DF.prototype.redoAnnotations=function(){this.annotationsManager.redoAnnotations()},DF.prototype.refreshSelectedPriceAndDate=function(e,t,i,a,n,o){var s=[],o=o&&"percent"===this.model.get("stockDisplayValues")?this.displayArea.allSeries[0].get("percentBase"):null,a=a?a.get("value"):this.displayArea.getPositionValue(t);n?this.drawSelectedValue(null):null!==a&&this.drawSelectedValue([a/this.valuesDivider,this.displayArea.getValuePosition(a,o)+this.model.get("topInnerMarginPx")]),s.push([this.displayArea.allDates[i],this.displayArea.xRatio*(i-this.displayArea.displayFromIndex+1)-this.displayArea.xRatio/2+this.model.get("leftInnerMarginPx")]),this.drawSelectedDates(s)},DF.prototype.remove=function(){return CF.prototype.remove.call(this),this},DF.prototype.removeSeries=function(e){this.allSeries=_.without(this.allSeries,e),this.displayArea.removeSeries(e),0<this.allSeries.length?(this.seriesToolbar.allItems<=0&&this.onResize(),this.displayCurrent()):$(this).trigger("removeChartAreaRequest",{type:"removeChartAreaRequest",chartArea:this})},DF.prototype.setChartName=function(e,t,i,a){this.displayTexAlign=i||"center",this.displayTexAlignV=a||"middle",this.$displayText.html(e),t?this.$displayText.css("font-size",t):this.$displayText.css("font-size",""),this.updateDisplayText(this.displayTexAlign,this.displayTexAlignV)},DF.prototype.toolbarHeight=function(){var e=0;return this.model.get(this.prefix+"isSeriesBarVisible")&&0<(e=$(this.seriesToolbar.el).height())&&(e+=this.model.get("seriesBarMarginPx")),e},DF.prototype.undoAnnotations=function(){this.annotationsManager.undoAnnotations()},DF.prototype.updateDisplayText=function(e,t){var i=this.$el.height(),a=this.$displayText.height();switch(t){case"top":this.$displayText.css("bottom","auto"),this.$displayText.css("top",3);break;case"bottom":this.$displayText.css("top","auto"),this.$displayText.css("bottom",3);break;default:this.$displayText.css("bottom","auto"),this.$displayText.css("top",i/2-a/2)}},DF),CF;function DF(e){var t=CF.call(this,e)||this;return t.displayTexAlign="center",t.displayTexAlignV="middle",t.isContextOpen=!1,t.isMouseOn=!1,t.isResizingChartArea=!1,t.pendingDatesChangeEvent=!1,t.firstRender=!0,t.initialize2(e),t}var ChartSeries=(eK=Backbone.Model,__extends(fK,eK),Object.defineProperty(fK.prototype,"IndicatorParameters",{set:function(e){this.indicatorParameters=e,this.isIndicator=!0},enumerable:!1,configurable:!0}),fK.prototype.addDisplaySeries=function(e){this.displaySeries.push(e)},fK.prototype.clone=function(){var t=this,i=new fK;return i.symbol=this.symbol,i.displayName=this.displayName,i.id=this.id,i.isToolbarVisible=this.isToolbarVisible,$.each(this.displaySeries,function(e){i.addDisplaySeries(t.displaySeries[e])}),i},fK.prototype.getID=function(){function e(){return Math.floor(65536*Math.random()).toString(16)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},fK.prototype.slice=function(t,i){var a=this,n=new fK;return n.symbol=this.symbol,n.displayName=this.displayName,n.isToolbarVisible=this.isToolbarVisible,n.id=this.id,$.each(this.displaySeries,function(e){n.addDisplaySeries(a.displaySeries[e].slice(t,i))}),n},fK),eK,sK;function fK(){var e=null!==eK&&eK.apply(this,arguments)||this;return e.id=e.getID(),e.symbol=null,e.displayName=null,e.showDecimalPlaces=!1,e.isToolbarVisible=!1,e.canUserEdit=!1,e.displaySeries=[],e.seriesMarkers=[],e.isIndicator=!1,e.indicatorParameters=null,e.displayIndex=0,e.chartArea=null,e}sK=jQuery,sK.widget("ui.dragslider",sK.ui.slider,{options:sK.extend({},sK.ui.slider.prototype.options,{rangeDrag:!1}),_create:function(){sK.ui.slider.prototype._create.apply(this,arguments),this._hoverable(this.range),this._rangeCapture=!1}});var TimeSlider=(uK=Backbone.View,__extends(vK,uK),vK.prototype.applyLayout=function(e,t){var i=this.model.get("rightAxisWidthPx"),a=this.model.get("chartBorderColor"),n=(this.model.get("showArrows")?(this.$leftArrow.css("left",0),this.$rightArrow.css("right",i)):(this.$leftArrow.css({width:0,display:"none"}),this.$rightArrow.css({width:0,display:"none"})),Math.max(0,this.$leftArrow.width())),o=Math.max(0,this.$rightArrow.width()),e=(this.scrollWidth=e-(0+n+0+0+o+i),this.bottomScroll.css("left",0+n+0),this.bottomScroll.css("width",this.scrollWidth),this.bottomScroll.css("height","9.1875px"),this.model.get("showSliderDates")?this.$datesBox.css({left:0+n+0,width:this.scrollWidth,height:t}):this.$datesBox.hide(),this.topScroll.css("left",0+n+0),this.topScroll.css("width",this.scrollWidth),t-9.1875);this.topScroll.css("height",e),this.$leftBox.css({height:t,"border-top-color":a,"border-right-color":a}),this.$rightBox.css({height:t,"border-top-color":a,"border-left-color":a}),this.$centerBox.css({height:t})},vK.prototype.applyTemplate=function(){var e=this,t=this.model.get("chartBorderColor");$(this.el).html(T.TimeSlider()),this.bottomScroll=this.$el.find(".bottomScroll"),this.topScroll=this.$el.find(".topScroll"),this.$leftArrow=this.$el.find(".LeftArrow"),this.$rightArrow=this.$el.find(".RightArrow"),this.$centerBox=this.$el.find(".centerBox"),this.$centerBox.css("background-color",this.model.get("chartDisplayAreaBackground")),this.$leftBox=this.$el.find(".leftBox"),this.$rightBox=this.$el.find(".rightBox"),this.$datesBox=this.$el.find(".datesBox"),this.buildTopScroll(),this.buildBottomScroll(),this.buildButtons(),this.sliderRange.css({"border-top-color":t,"border-bottom-color":t}),this.model.on("change:chartDisplayAreaBackground",function(){e.$centerBox.css("background-color",e.model.get("chartDisplayAreaBackground"))})},vK.prototype.buildButtons=function(){var e=this;this.$leftArrow.button({icons:{primary:"ui-icon-triangle-1-w"},text:!1}).on("click",function(){return e.onLeftArrowClick()}),this.$rightArrow.button({icons:{primary:"ui-icon-triangle-1-e"},text:!1}).on("click",function(){return e.onRightArrowClick()})},vK.prototype.buildBottomScroll=function(){var i=this;this.bottomScroll.dragslider({animate:!1,range:!0,rangeDrag:!0,min:0,max:30,values:[7,18],step:1,slide:function(e,t){return i.onBottomSliderSlide(e,t)}}),this.bottomScroll.find(".ui-slider-handle").hide(),this.sliderRange=this.bottomScroll.find(".ui-slider-range")},vK.prototype.buildTopScroll=function(){var i=this;this.topScroll.slider({animate:!1,range:!0,min:0,max:30,values:[7,18],step:1,slide:function(e,t){return i.onTopSliderSlide(e,t)}}),this.leftHandle=_.first(this.topScroll.find(".ui-slider-handle")),$(this.leftHandle).addClass("left-handle"),this.rightHandle=_.last(this.topScroll.find(".ui-slider-handle")),$(this.rightHandle).addClass("right-handle")},vK.prototype.datesWidth=function(){return this.$datesBox.width()},vK.prototype.initialize=function(e){var t=this;this.options=e,this.isMoving=!1,this.applyTemplate(),this.onResize(),this.model.on("change:chartBorderColor",function(){t.$leftBox.css({"border-top-color":t.model.get("chartBorderColor"),"border-right-color":t.model.get("chartBorderColor")}),t.$rightBox.css({"border-top-color":t.model.get("chartBorderColor"),"border-left-color":t.model.get("chartBorderColor")}),t.sliderRange.css({"border-top-color":t.model.get("chartBorderColor"),"border-bottom-color":t.model.get("chartBorderColor")})})},vK.prototype.onBottomSliderSlide=function(e,t){$(this.topScroll).slider("option","values",t.values),this.updateBoxes(),$(this).trigger("sliderSlide",{type:"sliderSlide",fromIndex:t.values[0],toIndex:t.values[1]})},vK.prototype.onLeftArrowClick=function(){var e,t=$(this.topScroll).slider("option","values"),i=t[1]-t[0],t=t[0]-i<0?(e=0,i>this.elementsCount-1?this.elementsCount-1:i):(e=t[0]-i,t[1]-i);$(this.bottomScroll).dragslider("option","values",[e,t]),$(this.topScroll).slider("option","values",[e,t]),this.updateBoxes(),$(this).trigger("sliderSlide",{type:"sliderSlide",fromIndex:e,toIndex:t})},vK.prototype.onResize=function(){var e=this.$el.width(),t=this.$el.height();this.applyLayout(e,t),this.updateBoxes(),null!==this.currentDates&&0<this.elementsCount&&this.updateScale(this.currentDates,this.elementsCount)},vK.prototype.onRightArrowClick=function(){var e,t,i=$(this.topScroll).slider("option","values"),a=i[1]-i[0];i[1]+a>=this.elementsCount?(t=this.elementsCount+parseInt((a/2).toString(),10),e=this.elementsCount-parseInt((a/2).toString(),10)):(e=i[0]+a,t=i[1]+a),$(this.bottomScroll).dragslider("option","values",[e,t]),$(this.topScroll).slider("option","values",[e,t]),this.updateBoxes(),$(this).trigger("sliderSlide",{type:"sliderSlide",fromIndex:e,toIndex:t})},vK.prototype.onTopSliderSlide=function(e,t){$(this.bottomScroll).dragslider("option","values",t.values),this.updateBoxes(),$(this).trigger("sliderSlide",{type:"sliderSlide",fromIndex:t.values[0],toIndex:t.values[1]})},vK.prototype.remove=function(){return Backbone.View.prototype.remove.call(this),this},vK.prototype.resetSlider=function(e,t,i,a){this.elementsCount=i,$(this.topScroll).slider({min:0,max:i-1,values:[e,t],value:e}),$(this.bottomScroll).dragslider({min:0,max:i-1,values:[e,t],value:e}),this.updateBoxes(),a&&this.updateScale(a,i)},vK.prototype.updateBoxes=function(){var e=$(this.sliderRange),t=this.$el.offset().left,i=e.offset().left,i=(this.$leftBox.css({left:0,width:i-t}),parseFloat(this.$leftBox.css("width"))),t=e.width()+2,e=(this.$centerBox.css({left:i,width:t}),this.scrollWidth-(i+t));this.$rightBox.css({left:i+t-1,width:0<e?2+e:0})},vK.prototype.updateScale=function(e,t){if(this.model.get("showSliderDates")){this.$datesBox.html(""),this.currentDates=e;for(var i,a=void 0,n=void 0,o=-1,s=void 0,r=this.$datesBox.width()/t,l=e.length,s=0;s<l;s+=1)(a=$(document.createElement("div"))).html(e[s].date.format(e[s].format)),a.appendTo(this.$datesBox),e[s].isMajorTick?a.addClass("axisTextMajor"):a.addClass("axisTextMinor"),i=a.width(),(n=(n=(e[s].index+1)*r-i/2)<0?0:n)<o?a.remove():(a.css("left",n),o=n+i)}},vK),uK;function vK(){return null!==uK&&uK.apply(this,arguments)||this}var InfoBorder=(xL=Backbone.View,__extends(yL,xL),yL.prototype.applyTemplate=function(){$(this.el).html(T.InfoBorder()),this.rootDiv=$(this.el).find(".RootDiv"),this.indicatorsDiv=$(this.el).find(".IndicatorsDiv"),this.openPriceTd=this.$el.find(".OpenPrice"),this.highPriceTd=this.$el.find(".HighPrice"),this.lowPriceTd=this.$el.find(".LowPrice"),this.closePriceTd=this.$el.find(".LastPrice"),this.dateTd=this.$el.find(".DateValue")},yL.prototype.clear=function(){this.openPriceTd.text(""),this.highPriceTd.text(""),this.lowPriceTd.text(""),this.closePriceTd.text(""),this.dateTd.text(""),$(this.indicatorsDiv).html(""),$(this.el).hide(),this.visible=!1},yL.prototype.initialize2=function(e){this.options=e,this.visible=!1,this.applyTemplate(),this.initializeEvents(),this.$el.hide()},yL.prototype.initializeEvents=function(){var e=this;this.rootDiv.draggable(),$(this.options.dragParent).on("resized",function(){return e.updateDragLimit()}),this.model.on("change:showInfoBorder",function(){return e.onShowInfoBorderChanged()}),this.model.on("change:isInfoBorderInCursorMode",function(){return e.onIsInfoBorderInCursorModeChanged()})},yL.prototype.onPause=function(e){e?this.$el.show():this.$el.hide()},yL.prototype.onShowInfoBorderChanged=function(){this.model.get("showInfoBorder")?this.$el.show():this.$el.hide()},yL.prototype.onIsInfoBorderInCursorModeChanged=function(){!this.model.get("isInfoBorderInCursorMode")&&this.model.get("showInfoBorder")?this.$el.show():this.$el.hide()},yL.prototype.setValues=function(e,t,i){var a;e&&(this.visible||$(this.el).show(),e.get("isFake")||((a=e.get("open"))&&this.openPriceTd.text(a.toFixed(t)),(a=e.get("high"))&&this.highPriceTd.text(a.toFixed(t)),(a=e.get("low"))&&this.lowPriceTd.text(a.toFixed(t)),(a=e.get("close"))&&this.closePriceTd.text(a.toFixed(t))),this.dateTd.text(e.get("quoteDate").format(i)),this.visible=!0,this.initialized?(t=[(a=$(this.options.dragParent.el).offset()).left,a.top+5])[0]===this.prevParentOffset[0]&&t[1]===this.prevParentOffset[1]||this.updateDragLimit():(this.initialized=!0,this.updateDragLimit()))},yL.prototype.setIndicatorsValues=function(e,t){var i="<table>";this.lastValues=e,this.lastFixedValue=t,$(this.indicatorsDiv).html(""),_.each(e,function(e){e.value&&(i=(i=(i=(i+='<tr style="color: ')+e.displayColor+';"><td>')+e.displayName+':</td><td style="width: 7px;"></td><td style="text-align: right; min-width: 65px;">')+e.value.toFixed(t)+"</td></tr>")}),i+="</table>",$(this.indicatorsDiv).html(i)},yL.prototype.updateDragLimit=function(){var e=this.options,e=$(e.dragParent.el),t=$(this.rootDiv),e=e.offset(),i=e.left,e=e.top+5,a=$(this.options.dragParent.el),n=i+a.width()-(t.width()+9),a=e+a.height()-t.height();this.prevParentOffset=[i,e];try{$(this.rootDiv).draggable("option","containment",[i,e,n,a])}catch(e){}},yL),xL;function yL(e){var t=xL.call(this,e)||this;return t.prevParentOffset=[0,0],t.initialize2(e),t}var IndicatorsToolbarItem=(ZL=Backbone.Model,__extends($L,ZL),$L),ZL;function $L(){return null!==ZL&&ZL.apply(this,arguments)||this}var IndicatorForm=(_L=Backbone.View,__extends(aM,_L),aM.prototype.applyTemplate=function(){var t,i,s=this,a=[],n=[];this.options.Indicator.parameters&&(this.options.Indicator.parameters.number=_.filter(this.options.Indicator.parameters,function(e){return"number"===e.Type}),this.options.Indicator.parameters.list=_.filter(this.options.Indicator.parameters,function(e){return"list"===e.Type}),_.each(this.options.Indicator.parameters.number,function(e){void 0!==e.Min&&(e.MinSet=!0),void 0!==e.Step&&(e.StepSet=!0)})),a.number=[],a.list=[],_.each(this.options.Indicator.parameters,function(e){i={Name:e.Name,Value:e.Value,Type:e.Type,OrderIndex:e.OrderIndex},e.MinSet&&(i.MinSet=e.MinSet,i.Min=e.Min),e.StepSet&&(i.StepSet=e.StepSet,i.Step=e.Step),"list"===e.Type?(a.list.push(i),i.Options=[],_.each(e.Options,function(e){i.Options.push({Name:e.Name,Value:e.Value,Selected:e.Selected})})):"number"===e.Type&&a.number.push(i),a.push(i)}),_.each(this.options.Indicator.discreteIndicators,function(e){n.push({discreteIndicatorID:e.discreteIndicatorID,discreteName:e.discreteName,shortName:e.shortName,displayType:e.displayType,color:e.color,lineThickness:e.lineThickness})}),$(this.el).html(T.IndicatorForm({indicatorID:this.options.Indicator.indicatorID,code:this.options.Indicator.code,name:this.options.Indicator.name,shortName:this.options.Indicator.shortName,parameters:a,display:this.options.Indicator.display,markers:this.options.Indicator.markers,discreteIndicators:n})),_.each(this.$el.find("input[name=color]"),function(e){switch(t=e.getAttribute("data-indicator-discrete-id"),e.getAttribute("data-color-type")){case"profitColor":$(e).colorpicker({displayIndicator:!1,color:_.find(s.options.Indicator.discreteIndicators,function(e){return"number"==typeof e.discreteIndicatorID&&(t=parseInt(t,10)),e.discreteIndicatorID===t}).profitColor});break;case"lossColor":$(e).colorpicker({displayIndicator:!1,color:_.find(s.options.Indicator.discreteIndicators,function(e){return"number"==typeof e.discreteIndicatorID&&(t=parseInt(t,10)),e.discreteIndicatorID===t}).lossColor});break;default:$(e).colorpicker({displayIndicator:!1,color:_.find(s.options.Indicator.discreteIndicators,function(e){return"number"==typeof e.discreteIndicatorID&&(t=parseInt(t,10)),e.discreteIndicatorID===t}).color})}$(e).on("change.color",function(e,t){s.onColorChanged(e,t)})}),_.each(this.$el.find("input[name=thickness]"),function(e){var t,i=$(e);s.model.get("isMobile")?((t=$(document.createElement("div"))).css("height","26px"),i.parent().append(t),t.button({icons:{primary:"ui-icon-triangle-1-s"},text:!1}).on("click",function(){var e=i.val(),e=parseInt(e,10),t=parseInt(i.attr("data-indicator-discrete-id"),10);1<=e-1?e-=1:e=1,i.val(e),s.onThicknessChanged(t,e)}),(t=$(document.createElement("div"))).css("height","26px"),i.parent().append(t),t.button({icons:{primary:"ui-icon-triangle-1-n"},text:!1}).on("click",function(){var e=i.val(),e=parseInt(e,10),t=parseInt(i.attr("data-indicator-discrete-id"),10);i.val(e+=1),s.onThicknessChanged(t,e)})):$(e).spinner({stop:function(e){s.onThicknessChanged(parseInt(e.target.getAttribute("data-indicator-discrete-id"),10),$(e.target).spinner("value"))},min:1})}),_.each(this.$el.find("input[name=number]"),function(e){var i=void 0!==$(e).data("min")?$(e).data("min"):1,t=$(e).data("step")||1,a=$(e),n=a.attr("data-parameter-order-index"),o=parseInt(n,10);s.model.get("isMobile")?((n=$(document.createElement("div"))).css("height","26px"),a.parent().append(n),n.button({icons:{primary:"ui-icon-triangle-1-s"},text:!1}).on("click",function(){var e=a.val(),t=parseInt(e,10);i<=t-1?t-=1:t=i,a.val(t),s.delay&&(clearTimeout(s.delay),s.delay=null),s.delay=setTimeout(function(){s.onParamValueChanged(o,t)},1e3)}),(n=$(document.createElement("div"))).css("height","26px"),a.parent().append(n),n.button({icons:{primary:"ui-icon-triangle-1-n"},text:!1}).on("click",function(){var e=a.val(),t=parseInt(e,10);a.val(t+=1),s.delay&&(clearTimeout(s.delay),s.delay=null),s.delay=setTimeout(function(){s.onParamValueChanged(o,t)},1e3)})):$(e).spinner({stop:function(e){s.onParamValueChanged(parseInt(e.target.getAttribute("data-parameter-order-index"),10),$(e.target).spinner("value"))},min:i,step:t})}),this.$el.find("select").on("change",function(e){s.onListChanged(e)}),this.$el.find(".ui-spinner").addClass("text-box")},aM.prototype.initialize2=function(e){var t=this;this.options=e,this.applyTemplate(),this.originalIndicator=$.extend(!0,{},this.options.Indicator),this.$el.on("dialogclose",function(e){e.originalEvent&&$(e.originalEvent.target).closest(".ui-dialog-titlebar-close").length&&t.resetChanges()})},aM.prototype.onColorChanged=function(e,t){var i,a=e.target.getAttribute("data-indicator-discrete-id"),e=e.target.getAttribute("data-color-type"),n=_.find(this.options.Indicator.discreteIndicators,function(e){return"number"==typeof e.discreteIndicatorID&&"number"!=typeof a&&(a=parseInt(a,10)),e.discreteIndicatorID===a});switch(e){case"profitColor":n.profitColor=t;break;case"lossColor":n.lossColor=t;break;default:n.color=t}var o=_.find(this.options.Indicator.indicatorSeries.displaySeries,function(e){return"number"==typeof(i=e.get("displayId"))&&"number"!=typeof a&&(a=parseInt(a,10)),i===a});switch(e){case"profitColor":o.set({profitColor:t});break;case"lossColor":o.set({lossColor:t});break;default:o.set({displayColor:t})}o.get("displayArea").updateDisplay(),this.options.IndicatorsManager.updateSerializedIndicators()},aM.prototype.onParamValueChanged=function(t,e){_.find(this.options.Indicator.parameters,function(e){return e.OrderIndex===t}).Value=e,this.updateItemName(),this.options.IndicatorsManager.updateIndicatorByObjectID(this.options.Indicator.objectID,this.options.Indicator.parameters)},aM.prototype.onListChanged=function(e){var t=parseInt(e.target.getAttribute("data-parameter-order-index"),10),i=$(e.target).val(),e=_.find(this.options.Indicator.parameters,function(e){return e.OrderIndex===t});_.each(e.Options,function(e){e.Value===i?e.Selected=!0:e.Selected=!1}),this.options.IndicatorsManager.updateIndicatorByObjectID(this.options.Indicator.objectID,this.options.Indicator.parameters)},aM.prototype.onThicknessChanged=function(t,e){_.find(this.options.Indicator.discreteIndicators,function(e){return"number"==typeof e.discreteIndicatorID&&"number"!=typeof t?t=parseInt(t,10):"string"==typeof e.discreteIndicatorID&&"string"!=typeof t&&(t=t.toString()),e.discreteIndicatorID===t}).lineThickness=e;var i,a=_.find(this.options.Indicator.indicatorSeries.displaySeries,function(e){return"number"==typeof(i=e.get("displayId"))&&"number"!=typeof t?t=parseInt(t,10):"string"==typeof i&&"string"!=typeof t&&(t=t.toString()),i===t});a.set({lineThickness:e}),a.get("displayArea").updateDisplay(),this.options.IndicatorsManager.updateSerializedIndicators()},aM.prototype.resetChanges=function(){var e=this.options.Indicator,i=this.originalIndicator;_.each(e.parameters,function(e,t){e.Value=i.parameters[t].Value,e.Options&&(e.Options=i.parameters[t].Options)}),_.each(e.discreteIndicators,function(e,t){e.color=i.discreteIndicators[t].color,e.lineThickness=i.discreteIndicators[t].lineThickness}),_.each(e.indicatorSeries.displaySeries,function(e,t){e.set({displayColor:i.discreteIndicators[t].color,lineThickness:i.discreteIndicators[t].lineThickness})}),e.isStock||(this.options.IndicatorsManager.updateIndicatorByObjectID(e.objectID,e.parameters),this.updateItemName()),e.indicatorSeries.displaySeries[0].get("displayArea").updateDisplay()},aM.prototype.updateItemName=function(){var e=this.options.TheItem.series.displayName,t="";0<this.options.Indicator.parameters.length&&(t+=" (",_.each(this.options.Indicator.parameters,function(e){e.Value&&(t+=e.Value+",")}),t=t.substr(0,t.length-1),t+=")"),e+=t,this.options.TheItem.$editLink.text(e)},aM),_L;function aM(e){var t=_L.call(this,e)||this;return t.initialize2(e),t}var IndicatorsToolbar=(EN=Backbone.View,__extends(FN,EN),FN.prototype.addSeries=function(e){var t=this,i=new IndicatorsToolbarItem,a=$(document.createElement("li")),n=$(document.createElement("a")),o=$(document.createElement("span")),s="";e.indicatorDetails.parameters&&0<e.indicatorDetails.parameters.length&&(s+=" (",_.each(e.indicatorDetails.parameters,function(e){e.Value&&(s+=e.Value+",")}),s=s.substr(0,s.length-1),s+=")"),i.series=e.series,i.objectID=e.objectID,i.isStackedIndicator=e.isStackedIndicator,n.prop("href","#"+e.objectID),n.html(e.series.displayName+s),o.css("display","none"),o.html(e.series.displayName),a.appendTo(this.rootDiv),n.appendTo(a),o.appendTo(a),a.series=e.series,n.on("click",function(e){e.preventDefault();e=$(e.currentTarget).prop("hash").substr(1);t.onIndicatorSelected(e)}),i.editButton=a,i.$editLink=n,i.$editText=o,i.series.set({displayIndex:this.allItems.length+1}),this.allItems.push(i),$(this).trigger("toolbarresize")},FN.prototype.applyTemplate=function(){var i=this;$(this.el).html(T.IndicatorsToolbar()),this.rootDiv=$(this.el).find(".IndicatorsToolbar"),this.rootDiv.sortable({placeholder:"indicator-placeholder",start:function(e,t){t.placeholder.html($(t.item).html()),_.each(i.allItems,function(e){e.$editLink.removeClass("hover"),e.$editLink.css("display","none"),e.$editText.css("display","block")})},stop:function(){_.each(i.allItems,function(e){e.$editText.css("display","none"),e.$editLink.css("display","block"),e.$editLink.removeClass("hover")}),i.updateItemsOrderAccordingToButtonsOrder(),$(i).trigger("display-indexes-updated")},helper:function(){return $("<div></div>")}}),this.rootDiv.disableSelection()},FN.prototype.clear=function(){$(this.rootDiv).html(""),this.allItems=[],$(this.el).height(0)},FN.prototype.getHeight=function(){return $(this.rootDiv).outerHeight()},FN.prototype.initialize2=function(e){this.options=e,this.allItems=[],this.elementHeight=0,this.applyTemplate()},FN.prototype.onIndicatorSelected=function(e){var t,i,a=this,e=parseInt(e);this.openDialog?(this.openDialog.$el.parent().toggleClass("flash",!1),_.defer(function(){a.openDialog.$el.parent().toggleClass("flash",!0)})):e&&(t=this.options.indicatorsManager.getIndicaotrByObjectID(e))&&(this.openDialog=new IndicatorForm({model:this.model,Indicator:t,IndicatorsManager:this.options.indicatorsManager,TheItem:_.find(this.allItems,{objectID:t.objectID})}),this.openDialog.$el.dialog({dialogClass:"charting editIndicatorDialog "+this.model.get("currentTheme"),title:t.name,modal:this.model.get("isMobile"),buttons:{Remove:function(){a.openDialog.$el.dialog("close"),a.options.indicatorsManager.removeIndicator(t)},OK:function(){a.openDialog.$el.dialog("close")}},open:function(e){var t=$(e.target).parent().find(".ui-dialog-buttonset");t.parent().css({"padding-left":"1em","padding-top":"0","padding-bottom":"0","margin-top":"0"}),t.css("width","100%"),t.find("button:last").css({float:"right","margin-right":"0"}),$(e.target).css("overflow","visible"),i=$(e.target).parent(),a.model.get("isMobile")&&(i.addClass("mobile"),$(e.target).find("input").attr("readonly","readonly")),a.model.changeThemeClassForElementWhenThemeChanges(i)},resizable:!1,width:"auto",close:function(){a.openDialog.$el.dialog("destroy"),a.openDialog=null}}))},FN.prototype.removeIndicator=function(t){var e=_.find(this.allItems,function(e){return e.objectID===t.objectID});this.allItems=_.without(this.allItems,e),e.editButton.detach(),$(this).trigger("toolbarresize"),$(this).trigger("indicator-removed")},FN.prototype.updateItemsOrderAccordingToButtonsOrder=function(){for(var t,e,i=this.rootDiv.find("a").toArray(),a=0;a<i.length;a+=1)e=$(i[a]),t=parseInt(e.prop("hash").substr(1)),(e=_.find(this.allItems,function(e){return e.objectID===t})).series.set({displayIndex:a})},FN),EN;function FN(e){var t=EN.call(this,e)||this;return t.initialize2(e),t}var TechInd={sma:function(e,t){this.pcheck("sma",arguments);for(var i=[],a=0,n=0,o=t.length,n=0;n<e-1;n+=1)i.push(null),a+=t[n];for(i.push((a+=t[n])/e),n=e;n<o;n+=1)a+=t[n]-t[n-e],i.push(a/e);return i},ema:function(e,t){this.pcheck("ema",arguments);for(var i=[],a=0,n=2/(e+1),o=1-n,s=0,r=t.length,s=0;s<e-1;s+=1)i.push(null),a+=t[s];for(i.push((a+=t[s])/e),s=e;s<r;s+=1)i.push(t[s]*n+i[s-1]*o);return i},wma:function(e,t){this.pcheck("wma",arguments);for(var i=[],a=0,n=0,o=t.length,s=0;s<e-1;s+=1)i.push(null),n+=t[s]*(e-(e-1-s)),a+=t[s];for(n+=t[s]*e,a+=t[s],i.push(n/(e*(e+1)/2)),s=e;s<o;s+=1)n+=e*t[s]-a,a+=t[s]-t[s-e],i.push(n/(e*(e+1)/2));return i},rsi:function(e,t){this.pcheck("rsi",arguments);var i,a=[],n=0,o=0,s=0,r=t.length;for(a.push(null),s=1;s<r;s+=1)i=t[s]-t[s-1],s<=e-1?(n+=0<i?i:0,o+=Math.abs(i<0?i:0),s===e-1&&(n/=e,o/=e)):(n=(n*(e-1)+(0<i?i:0))/e,o=(o*(e-1)+Math.abs(i<0?i:0))/e),a.push(s<e-1?null:100-100/(n/o+1));return a},typprice:function(e,t,i){this.pcheck("typprice",arguments);for(var a=[],n=0,o=i.length,n=0;n<o;n+=1)a[n]=(e[n]+t[n]+i[n])/3;return a},truerange:function(e,t,i){this.pcheck("truerange",arguments);var a=[],n=0,o=i.length;for(a.push(null),n=1;n<o;n+=1)a.push(Math.max(e[n]-t[n],Math.abs(e[n]-i[n-1]),Math.abs(t[n]-i[n-1])));return a},atr:function(e,t,i,a){this.pcheck("atr",arguments);t=this.truerange(t,i,a);return this.sma(e,t)},cci:function(e,t,i,a){this.pcheck("cci",arguments);for(var n=[],o=0,s=0,r=0,l=0,d=this.typprice(t,i,a),c=this.sma(e,d),o=0,h=d.length;o<h;o+=1){if(e-1<=o){for(r=d[o]-c[o],l=0,s=o;o-e<s;--s)l+=Math.abs(d[s]-c[o]);l/=e}n.push(o<e-1?null:r/(.015*l))}return n},williams:function(e,t,i,a){this.pcheck("williams",arguments);for(var n=[],o=0,s=0,r=0,l=1/0,d=0,c=0,h=0,p=0,u=a.length,o=0;o<u;o+=1){if(o-e<d)r=t[o]>r?t[d=o]:r;else for(r=0,s=o;o-e<s;--s)r=t[s]>r?t[d=s]:r;if(o-e<c)l=i[o]<l?i[c=o]:l;else for(l=1/0,s=o;o-e<s;--s)l=i[s]<l?i[c=s]:l;e-1<=o&&(h=r-a[o],p=r-l),n.push(o<e-1?null:h/p*-100)}return n},macd:function(e,t,i,a){this.pcheck("macd",arguments);for(var n=[],o=[],s=[],r=[],l=0,d=this.ema(t,e),c=this.ema(i,e),h=e.length,l=0;l<h;l+=1)o[l]=l<i-1?null:d[l]-c[l];if(null!==a)for(s=this.ema(a,o),l=0,h=o.length;l<h;l+=1)l<i+a-1?(r.push(null),s[l]=null):r.push(o[l]-s[l]);return n.MACD=o,n.SIGNAL=s,n.HISTOGRAM=r,n},aroon:function(e,t,i){this.pcheck("aroon",arguments);for(var a=[],n=[],o=[],s=[],r=0,l=0,d=0,c=1/0,h=0,p=0,u=t.length,r=0;r<e;r+=1)n.push(null),o.push(null),s.push(null);for(r=e;r<u;r+=1){if(r-e<h)d=i[r]>d?i[h=r]:d;else for(d=0,l=r;r-e<=l;--l)d=i[l]>=d?i[h=l]:d;if(r-e<p)c=t[r]<c?t[p=r]:c;else for(c=1/0,l=r;r-e<=l;--l)c=t[l]<=c?t[p=l]:c;n.push((e-(r-h))/e*100),o.push((e-(r-p))/e*100),s.push(n[r]-o[r])}return a.UP=n,a.DOWN=o,a.OSC=s,a},stochosc:function(e,t,i,a,n,o){this.pcheck("stochosc",arguments);for(var s=[],r=[],l=[],d=[],c=0,h=0,p=0,u=0,m=0,g=0,f=0,y=0,D=o.length,C=e+t-1,v=e+t+i-1,p=0;p<D;p+=1){if(p-e<f)m=a[p]>m?a[f=p]:m;else for(m=0,u=p;p-e<u;--u)m=a[u]>m?a[f=u]:m;if(p-e<y)g=n[p]<g?n[y=p]:g;else for(g=1/0,u=p;p-e<u;--u)g=n[u]<g?n[y=u]:g;m===g?l.push(50):l.push((o[p]-g)/(m-g)*100),c+=p<t?l[p]:l[p]-l[p-t],r.push(p<C?null:c/t),h+=p<i?r[p]:r[p]-r[p-i],d.push(p<v?null:h/i)}return s.K=r,s.D=d,s},stddev:function(e,t){this.pcheck("stddev",arguments);for(var i,a=[],n=0,o=0,s=0,r=t.length,s=0;s<e-1;s+=1)a.push(null),o+=t[s],n+=Math.pow(t[s],2);for(n+=Math.pow(t[s],2),i=(o+=t[s])/e,a.push(Math.sqrt((n-Math.pow(i,2)*e)/e)),s=e;s<r;s+=1)n+=Math.pow(t[s],2)-Math.pow(t[s-e],2),o+=t[s]-t[s-e],a.push(Math.sqrt((n-Math.pow(o/e,2)*e)/e));return a},bb:function(e,t){this.pcheck("bb",arguments);for(var i,a=[],n=[],o=[],s=0,r=this.sma(e,t),l=this.stddev(e,t),s=0;s<e-1;s+=1)n.push(null),o.push(null);for(s=e-1,i=r.length;s<i;s+=1)n.push(r[s]+2*l[s]),o.push(r[s]-2*l[s]);return a.BBM=r,a.BBU=n,a.BBL=o,a},maenv:function(e,t,i){this.pcheck("maenv",arguments);for(var a=[],n=[],o=[],s=0,r=this.sma(e,t),l=i/100,s=0,d=r.length;s<d;s+=1)n[s]=r[s]+r[s]*l,o[s]=r[s]-r[s]*l;return a.TOP=n,a.BOTTOM=o,a},trix:function(e,t){this.pcheck("trix",arguments);for(var i=[],a=0,t=this.ema(e,t),t=this.ema(e,t),n=this.ema(e,t),o=3*e,a=0,s=n.length;a<s;a+=1)i.push(a<o?null:(n[a]-n[a-1])/n[a-1]*100);return i},proc:function(e,t){this.pcheck("proc",arguments);for(var i=[],a=0,n=t.length,a=0;a<n;a+=1)i.push(a<e?null:(t[a]-t[a-e])/t[a-e]*100);return i},wws:function(e,t){this.pcheck("wws",arguments);for(var i=[],a=0,n=0,o=t.length,a=0;a<o;a+=1)a<e?(i.push(a===e-1?(n+=t[a])/e:null),n+=t[a]):i.push(i[a-1]+1/e*(t[a]-i[a-1]));return i},swingindex:function(e,t,i,a,n){this.pcheck("swingindex",arguments);var o,s,r,l,d=[],c=0,h=0,p=n.length;for(d.push(null),c=1;c<p;c+=1)o=Math.max(Math.abs(i[c]-n[c-1]),Math.abs(a[c]-n[c-1])),s=Math.abs(i[c]-n[c-1]),l=Math.abs(a[c]-n[c-1]),r=Math.abs(i[c]-a[c]),h=l<s&&r<s?s-.5*l+.25*Math.abs(n[c-1]-t[c-1]):s<l&&r<l?l-.5*s+.25*Math.abs(n[c-1]-t[c-1]):r+.25*Math.abs(n[c-1]-t[c-1]),l=(n[c]-n[c-1]+.5*(n[c]-t[c])+.25*(n[c-1]-t[c-1]))/h*50*(o/e),d.push(0===h?0:l);return d},asi:function(e,t,i,a,n){this.pcheck("asi",arguments);var o,s=[],r=this.swingindex(e,t,i,a,n),l=0,d=0;for(s.push(0),l=1,o=r.length;l<o;l+=1)s.push(d+=r[l]);return s},psar:function(e,t,i,a){this.pcheck("psar",arguments);var n=[],o=0,s=e,r=0,l=0,d=0,c=i.length;for(n.push(null),l=i[1]-i[0]<a[1]-a[0]?(r=i[1],a[d=0]):(r=a[1],i[0]),o=1;o<c;o+=1)1===d?(r=n[o-1]+s*(l-n[o-1]),i[o]>l&&(l=i[o],s<t&&(s+=e)),a[o]<r&&(d=0,s=e,r=l,l=a[o])):(r=n[o-1]+s*(l-n[o-1]),a[o]<l&&(l=a[o],s<t&&(s+=e)),i[o]>r&&(d=1,s=e,r=l,l=i[o])),s=this.roundX(s,2),n.push(r);return n},uo:function(e,t,i,a,n,o){this.pcheck("uo",arguments);var s=[],r=this.truerange(a,n,o),l=0,d=[],c=0,h=0,p=0,u=r[0],m=r[0],g=r[0],f=Math.max(e,t,i),y=o.length;for(d.push(null),s.push(null),l=1;l<y;l+=1)d.push(o[l]-Math.min(o[l-1],n[l])),c+=l<=e-1?d[l]:d[l]-d[l-e],u+=l<=e-1?r[l]:r[l]-r[l-e],h+=l<=t-1?d[l]:d[l]-d[l-t],m+=l<=t-1?r[l]:r[l]-r[l-t],p+=l<=i-1?d[l]:d[l]-d[l-i],g+=l<=i-1?r[l]:r[l]-r[l-i],s.push(l<f?null:(c/u*4+h/m*2+p/g)/7*100);return s},ao:function(e,t,i,a){this.pcheck("ao",arguments);for(var n,o,s=[],r=[],l=0,d=i.length,l=0;l<d;l+=1)r[l]=(i[l]+a[l])/2;for(n=this.sma(e,r),o=this.sma(t,r),l=0;l<d;l+=1)s[l]=l<t-1?null:n[l]-o[l];return s},ac:function(e,t,i,a){this.pcheck("ac",arguments);for(var n=[],o=0,s=i.length,r=this.ao(e,t,i,a),l=this.sma(e,r),o=0;o<s;o+=1)n[o]=o<t-1?null:r[o]-l[o];return n},zz:function(e,t){this.pcheck("zz",arguments);var i=[],a=0,n=[],o=0,s=t[0].length;n.i=0;if((n.trend=1)===t.length){var r=t[0];for(i[0]=r[n.i],a=1;a<s;a+=1)(o=r[a]-r[n.i]<0?-1:1)===n.trend?(i[a]=r[a],i[n.i]=null,n.i=a):Math.abs((r[a]-r[n.i])/r[n.i])>e/100?(i[a]=r[a],n.i=a,n.trend=o):i[a]=null}else if(4===t.length){var l=t[0],d=t[1],c=t[2],r=t[3],h=[];for(i[0]=r[n.i],a=1;a<s;a+=1)o=r[a]-r[n.i]<0?-1:1,h=r[a]>l[a]?d:c,o===n.trend?(i[a]=h[a],i[n.i]=null,n.i=a):Math.abs((r[a]-r[n.i])/r[n.i])>e/100?(i[a]=h[a],n.i=a,n.trend=o):i[a]=null}return i[s-1]=r[s-1],i},kc:function(e,t,i,a,n,o){this.pcheck("kc",arguments);for(var s,r=[],l=[],d=[],c=0,h=this.sma(e,o),p=this.atr(t,a,n,o),c=0;c<e-1;c+=1)l.push(null),d.push(null);for(c=e-1,s=h.length;c<s;c+=1)l.push(h[c]+i*p[c]),d.push(h[c]-i*p[c]);return r.KCM=h,r.KCU=l,r.KCL=d,r},sr:function(e,t,i,a,n){this.pcheck("sr",arguments);for(var o,s,r=[],l=[],d=[],c=0,h=(100-e)/300,e=(100-e)/100,p=i.length,u=this.zz(h,[i]),m=this.zz(h,[a]),g=this.zz(e,[i]),f=this.zz(e,[a]),c=1;c<p;c+=1)o=this.fractal(i,"upper",c),s=this.fractal(a,"lower",c),0<o&&(o==u[c]||o==g[c])?(d[c]=o,d[c+1]=o,d[c+2]=o):d[c]=d[c-1],0<s&&(s==m[c]||s==f[c])?(l[c]=s,l[c+1]=s,l[c+2]=s):l[c]=l[c-1];return r.R=d,r.S=l,r},mom:function(e,t){this.pcheck("mom",arguments);for(var i=[],a=0,n=t.length,a=0;a<e;a+=1)i[a]=null;for(a=e;a<n;a+=1)i[a]=t[a]-t[a-e];return i},po:function(e,t,i){this.pcheck("po",arguments);for(var a=[],n=0,o=i.length,s=this.sma(e,i),r=this.sma(t,i),n=0;n<t;n+=1)a[n]=null;for(n=t;n<o;n+=1)a[n]=s[n]-r[n];return a},roundX:function(e,t){return Math.round(e*(Math.pow(10,t)+(0<e?1e-10:-1e-10)))/Math.pow(10,t)},fractal:function(e,t,a){var n=[];switch(t){case"upper":for(i=0;i<5;i+=1)n[i]=e[a+i-2];return n[2]>n[0]&&n[2]>n[1]&&n[2]>n[3]&&n[2]>n[4]?n[2]:0;case"lower":for(i=0;i<5;i+=1)n[i]=e[a+i-2];return n[2]<n[0]&&n[2]<n[1]&&n[2]<n[3]&&n[2]<n[4]?n[2]:0;default:throw"Invalid fractal mode"}},pcheck:function(e,t){var i=0,a=0;switch(e){case"sma":case"ema":case"wma":case"rsi":case"stddev":case"trix":case"proc":case"bb":case"wws":case"mom":if(2!==t.length)throw e+": must have 2 params";if(t[0]>t[1].length)throw e+": not enough data supplied for "+t[0]+" period calculation";break;case"maenv":if(3!==t.length)throw e+": must have 3 params";if(t[0]>t[1].length)throw e+": not enough data supplied for "+t[0]+" period calculation";break;case"typprice":case"truerange":if(3!==t.length)throw e+": must have 3 params";if(t[0].length!==t[1].length||t[1].length!==t[2].length)throw e+": High, Low and Close data must be the same length";break;case"aroon":if(3!==t.length)throw e+": must have 3 params";if(t[1].length!==t[2].length)throw e+": High and Low data must be the same length";if(t[0]>t[1].length)throw e+": not enough data supplied for "+t[0]+" period calculation";break;case"cci":case"williams":case"atr":if(4!==t.length)throw e+": must have 4 params";if((i=Math.max(t[1].length,t[2].length,t[3].length))!==(a=Math.min(t[1].length,t[2].length,t[3].length)))throw e+": High, Low and Close data must be the same length";if(t[0]>t[1].length)throw e+": not enough data supplied for "+t[0]+" period calculation";break;case"psar":if(4!==t.length)throw e+": must have 4 params";if((i=Math.max(t[2].length,t[3].length))!==(a=Math.min(t[2].length,t[3].length)))throw e+": High and Low data must be the same length";if(t[0]>=t[1])throw e+": minaf must be less than maxaf";break;case"macd":if(4!==t.length)throw e+": must have 4 params";if(i=Math.max(t[1],t[2],t[3]),t[0]>i)throw e+": not enough data supplied for "+i+" period calculation";if(t[1]>t[2])throw e+": Long periods param must be greater than short periods param";break;case"swingindex":case"asi":if(5!==t.length)throw e+": must have 5 params";if((i=Math.max(t[1].length,t[2].length,t[3].length,t[4].length))!==(a=Math.min(t[1].length,t[2].length,t[3].length,t[4].length)))throw e+": Open, High, Low, and Close data must be the same length";break;case"stochosc":if(6!==t.length)throw e+": must have 6 params";if((i=Math.max(t[3].length,t[4].length,t[5].length))!==(a=Math.min(t[3].length,t[4].length,t[5].length)))throw e+": High, Low, and Close data must be the same length";if(t[0]+t[1]+t[2]>i)throw e+": not enough data supplied for "+t[0]+" period with a "+t[1]+" k smoothing and a"+t[2]+" d smoothing calculation";break;case"kc":case"uo":if(6!==t.length)throw e+": must have 6 params";if((i=Math.max(t[3].length,t[4].length,t[5].length))!==(a=Math.min(t[3].length,t[4].length,t[5].length)))throw e+": High, Low, and Close data must be the same length";if(a<(i=Math.max(t[0],t[1],t[2])))throw e+": not enough data supplied for "+t[0]+" period calculation";break;case"pvo":if(4!==t.length)throw e+": must have 4 params";if(t[0]<=t[1])throw e+": Short periods must be less that Long periods";if(t[0]>t[2].length)throw e+": not enough data supplied for "+t[1]+" period calculation";if("e"!==t[3]&&"s"!==t[3])throw e+": 4th parameter must be either 'e' (Exponential) or 's' (Simple)";break;case"ao":case"ac":if(4!==t.length)throw e+": must have 4 params";if(i=Math.max(t[2],t[3]),t[0].length<i)throw e+": not enough data supplied for "+i+" period calculation";if(t[0].length!==t[1].length)throw e+": High and Low data must be the same length";if(t[0]>t[1])throw e+": Long periods param must be greater than short periods param";break;case"zz":if(2!==t.length)throw e+": must have 2 params";if(3===t[1].length){if((i=Math.max(t[1][0].length,t[1][1].length,t[1][2].length,t[1][3].length))!==(a=Math.min(t[1][0].length,t[1][1].length,t[1][2].length,t[1][3].length)))throw e+": Open, High, Low and Close data must be the same length"}else if(4<t[1].length)throw e+": Data cannot have more than 4 elements";break;case"sr":if(5!==t.length)throw e+": must have 5 params";if((i=Math.max(t[1].length,t[2].length,t[3].length,t[4].length))!==(a=Math.min(t[1].length,t[2].length,t[3].length,t[4].length)))throw e+": High, Low, Close and Volume data must be the same length";break;case"po":if(3!==t.length)throw e+": must have 3 params";if(i=Math.max(t[0],t[1]),t[2].length<i)throw e+": not enough data supplied for "+i+" period calculation";if(t[0]>t[1])throw e+": Long periods param must be greater than short periods param";break;default:throw"Indicator param check not implemented"}},XHighPlusLowDivY:function(e,t,i,a){var n,o=e.length;for(results=[],n=o-1;i-1<n;--n){for(var s,r=0,l=1/0,d=n;n-i<d;--d)r<(s=e[d]||0)&&(r=s),(s=t[d]||0)<l&&0<s&&(l=s);results[n]=(r+l)/a}for(d=0;d<i;d+=1)results[d]=null;return results}},IndicatorCalculator=(kU.getDefaultIndicatorParameters=function(e){var t;switch(e){case"sma":t=[{Name:"Periods",Value:20,Type:"number",OrderIndex:0}];break;case"ema":t=[{Name:"Periods",Value:10,Type:"number",OrderIndex:0}];break;case"wma":t=[{Name:"Periods",Value:14,Type:"number",OrderIndex:0}];break;case"rsi":t=[{Name:"Periods",Value:14,Type:"number",OrderIndex:0},{Name:"Overbought Level",Options:[{Name:"70/30",Value:70,Selected:!0},{Name:"80/20",Value:80}],Type:"list",OrderIndex:1}];break;case"typprice":case"truerange":t=null;break;case"cci":case"williams":t=[{Name:"Periods",Value:14,Type:"number",OrderIndex:0}];break;case"macd":t=[{Name:"Short Cycle",Value:12,Type:"number",OrderIndex:0},{Name:"Long Cycle",Value:26,Type:"number",OrderIndex:1},{Name:"Signal Periods",Value:9,Type:"number",OrderIndex:2}];break;case"stddev":t=[{Name:"Periods",Value:14,Type:"number",OrderIndex:0}];break;case"bb":t=[{Name:"Periods",Value:20,Type:"number",OrderIndex:0}];break;case"maenv":t=[{Name:"Periods",Value:20,Type:"number",OrderIndex:0},{Name:"Shift (%)",Value:2.5,Type:"number",Step:.1,OrderIndex:1}];break;case"trix":t=[{Name:"Periods",Value:8,Type:"number",OrderIndex:0}];break;case"proc":t=[{Name:"Periods",Value:12,Type:"number",OrderIndex:0}];break;case"wws":case"si":case"asi":t=[{Name:"Periods",Value:14,Type:"number",OrderIndex:0}];break;case"uo":t=[{Name:"Cycle 1",Value:7,Type:"number",OrderIndex:0},{Name:"Cycle 2",Value:14,Type:"number",OrderIndex:1},{Name:"Cycle 3",Value:28,Type:"number",OrderIndex:2}];break;case"stochosc":t=[{Name:"%K Periods",Value:14,Type:"number",OrderIndex:0},{Name:"%K Slowing",Value:3,Type:"number",OrderIndex:1},{Name:"%D Periods",Value:3,Type:"number",OrderIndex:2}];break;case"aroon":case"aroonosc":t=[{Name:"Periods",Value:14,Type:"number",OrderIndex:0}];break;case"psar":t=[{Name:"Min AF (Accumulation Factor)",Value:.02,Type:"number",Min:0,Step:.01,OrderIndex:0},{Name:"Max AF (Accumulation Factor)",Value:.2,Type:"number",Min:0,Step:.01,OrderIndex:1}];break;case"const":t=[{Name:"Value",Value:0,Type:"number",Min:0,OrderIndex:0}];break;case"bp":t=null;break;case"ao":case"ac":t=[{Name:"Short Cycle",Value:5,Type:"number",OrderIndex:0},{Name:"Long Cycle",Value:34,Type:"number",OrderIndex:1}];break;case"zz":t=[{Name:"Threshold",Value:5,Type:"number",Min:0,Step:.1,OrderIndex:0}];break;case"kc":t=[{Name:"EMA Periods",Value:20,Type:"number",OrderIndex:0},{Name:"ATR Periods",Value:10,Type:"number",OrderIndex:1},{Name:"ATR Multiplier",Value:2,Type:"number",OrderIndex:2}];break;case"sr":t=[{Name:"Sensitivity",Value:60,Type:"number",OrderIndex:0}];break;case"mom":t=[{Name:"Periods",Value:10,Type:"number",OrderIndex:0}];break;case"po":t=[{Name:"Short Cycle",Value:9,Type:"number",OrderIndex:0},{Name:"Long Cycle",Value:18,Type:"number",OrderIndex:1}];break;case"vol":t=[];break;case"atr":t=[{Name:"Periods",Value:14,Type:"number",OrderIndex:0}];break;default:console.log("indicator not implemented")}return t},kU.getIndicatorCode=function(e){var t;try{switch(e){case 37:t="sma";break;case 44:t="truerange";break;case 13:t="ema";break;case 52:t="wma";break;case 36:t="rsi";break;case 45:t="typprice";break;case 274:t="truerange";break;case 8:t="cci";break;case 55:t="williams";break;case 254:break;case 19:case 136:case 276:t="macd";break;case 38:t="stddev";break;case 4:case 128:case 252:t="bb";break;case 24:case 133:t="maenv";break;case 43:t="trix";break;case 31:t="proc";break;case 54:t="wws";break;case 41:t="si";break;case 1:t="asi";break;case 46:t="uo";break;case 40:case 135:t="stochosc";break;case 3:case 249:case 250:t="aroon";break;case 251:t="aroonosc";break;case 27:t="psar";break;case 137:t="const";break;case 277:case 278:case 279:case 280:case 281:t="bp";break;case 282:t="ten";break;case 283:t="kij";break;case 284:t="sa";break;case 285:t="sb";break;case 286:t="chi";break;case 1302:t="ao";break;case 1303:t="ac";break;case 1304:t="zz";break;case 1311:case 1312:case 1313:case 1314:t="kc";break;case 1315:case 1316:case 1317:t="sr";break;case 1318:t="mom";break;case 1319:t="po";break;case 1323:case 1324:t="atr";break;default:console.log("indicator not implemented")}}catch(e){console.log(e)}return t},kU.calculateDefaultIndicator=function(e,t,i,a,n,o,s,r){var l,d=this.getDefaultIndicatorParameters(e);return d&&r&&r.length===d.length&&_.each(d,function(e){l=r.splice(0,1)[0],e.Value=l}),this.calculateIndicator(e,t,d,i,a,n,o,s)},kU.calculateDefaultIndicatorDiscrete=function(e,t){var i=this.getDefaultIndicatorParameters(this.getIndicatorCode(e));return this.calculateIndicatorDiscrete(e,t,i,"",null,null)},kU.calculateIndicator=function(t,e,i,a,n,o,s,r){var l,d=null;try{switch(t){case"sma":d={indicatorID:37,code:"sma",name:"Simple Moving Average",shortName:"SMA",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:37,discreteName:"Simple Moving Average",shortName:"SMA",data:c=TechInd.sma(i[0].Value,_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"ema":d={indicatorID:13,code:"ema",name:"Exponential Moving Average",shortName:"EMA",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:13,discreteName:"Exponential Moving Average",shortName:"EMA",data:c=TechInd.ema(i[0].Value,_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"wma":d={indicatorID:52,code:"wma",name:"Weighted Moving Average",shortName:"WMA",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:52,discreteName:"Weighted Moving Average",shortName:"WMA",data:c=TechInd.wma(i[0].Value,_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"rsi":var c,h=_.find(i[1].Options,function(e){return!0===e.Selected}).Value||70,d={indicatorID:36,code:"rsi",name:"Relative Strength Index",shortName:"RSI",parameters:i,display:"own-window",markers:[100-h,50,h],discreteIndicators:[{discreteIndicatorID:36,discreteName:"Relative Strength Index",shortName:"RSI",data:c=TechInd.rsi(i[0].Value,_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"typprice":d={indicatorID:45,code:"typprice",name:"Typical Price",shortName:"TP",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:45,discreteName:"Typical Price",shortName:"TP",data:c=TechInd.typprice(_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")}),_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"truerange":d={indicatorID:44,code:"truerange",name:"True Range",shortName:"TR",parameters:i,display:"own-window",markers:null,showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:274,discreteName:"True Range",shortName:"TR",data:c=TechInd.truerange(_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")}),_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"atr":d={indicatorID:1323,code:"atr",name:"Average True Range",shortName:"ATR",parameters:i,display:"own-window",markers:null,showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1324,discreteName:"Average True Range",shortName:"ATR",data:c=TechInd.atr(i[0].Value,_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")}),_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"cci":d={indicatorID:8,code:"cci",name:"Commodity Channel Index",shortName:"CCI",parameters:i,display:"own-window",markers:[-100,0,100],discreteIndicators:[{discreteIndicatorID:8,discreteName:"Commodity Channel Index",shortName:"CCI",data:c=TechInd.cci(i[0].Value,_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")}),_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"williams":d={indicatorID:55,code:"williams",name:"Williams %R",shortName:"W%R",parameters:i,display:"own-window",markers:[-20,-50,-80],discreteIndicators:[{discreteIndicatorID:55,discreteName:"Williams %R",shortName:"W%R",data:c=TechInd.williams(i[0].Value,_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")}),_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"macd":d={indicatorID:19,code:"macd",name:"MACD",shortName:"MACD",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:276,discreteName:"MACD Histogram",shortName:"MACD H",data:(c=TechInd.macd(_.map(e,function(e){return e.get("close")}),i[0].Value,i[1].Value,i[2].Value)).HISTOGRAM,displayType:"Histogram",color:"absolute",lineThickness:1,nonConfigurable:!0},{discreteIndicatorID:19,discreteName:"MACD",shortName:"MACD",data:c.MACD,displayType:"Line",color:"#FAF23E",lineThickness:1},{discreteIndicatorID:136,discreteName:"MACD Signal",shortName:"MACD S",data:c.SIGNAL,displayType:"Line",color:"#3EE2FA",lineThickness:1}]};break;case"stddev":d={indicatorID:38,code:"stddev",name:"Standard Deviation",shortName:"SD",parameters:i,display:"own-window",markers:null,discreteIndicators:[{discreteIndicatorID:38,discreteName:"Standard Deviation",shortName:"SD",data:c=TechInd.stddev(i[0].Value,_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"bb":d={indicatorID:4,code:"bb",name:"Bollinger Bands",shortName:"BB",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:4,discreteName:"BB Upper Band",shortName:"Upper Band",data:(c=TechInd.bb(i[0].Value,_.map(e,function(e){return e.get("close")}))).BBU,displayType:"Line",color:"#61BDF0",lineThickness:1},{discreteIndicatorID:252,discreteName:"BB Median",shortName:"Median",data:c.BBM,displayType:"Line",color:"#C3E2F4",lineThickness:2},{discreteIndicatorID:128,discreteName:"BB Lower Band",shortName:"Lower Band",data:c.BBL,displayType:"Line",color:"#61BDF0",lineThickness:1}]};break;case"maenv":d={indicatorID:24,code:"maenv",name:"Moving Average Envelope",shortName:"ENV",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:24,discreteName:"ENV Top",shortName:"Top",data:(c=TechInd.maenv(i[0].Value,_.map(e,function(e){return e.get("close")}),i[1].Value)).TOP,displayType:"Line",color:"#CA53F4",lineThickness:1},{discreteIndicatorID:133,discreteName:"ENV Bottom",shortName:"Bottom",data:c.BOTTOM,displayType:"Line",color:"#CA53F4",lineThickness:1}]};break;case"trix":d={indicatorID:43,code:"trix",name:"TRIX",shortName:"TRIX",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:43,discreteName:"TRIX",shortName:"TRIX",data:c=TechInd.trix(i[0].Value,_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"proc":d={indicatorID:31,code:"proc",name:"Price ROC",shortName:"PROC",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:31,discreteName:"Price ROC",shortName:"PROC",data:c=TechInd.proc(i[0].Value,_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"wws":d={indicatorID:54,code:"wws",name:"Welles Wilder Smoothing",shortName:"WWS",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:54,discreteName:"Welles Wilder Smoothing",shortName:"WWS",data:c=TechInd.wws(i[0].Value,_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"si":d={indicatorID:41,code:"si",name:"Swing Index",shortName:"SI",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:41,discreteName:"Swing Index",shortName:"SI",data:c=TechInd.swingindex(i[0].Value,_.map(e,function(e){return e.get("open")}),_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")}),_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"asi":d={indicatorID:1,code:"asi",name:"Accumulative Swing Index",shortName:"ASI",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1,discreteName:"Accumulative Swing Index",shortName:"ASI",data:c=TechInd.asi(i[0].Value,_.map(e,function(e){return e.get("open")}),_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")}),_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#48DC4A",lineThickness:1}]};break;case"uo":d={indicatorID:46,code:"uo",name:"Ultimate Oscillator",shortName:"UO",parameters:i,display:"own-window",markers:[30,50,70],discreteIndicators:[{discreteIndicatorID:46,discreteName:"Ultimate Oscillator",shortName:"UO",data:c=TechInd.uo(i[0].Value,i[1].Value,i[2].Value,_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")}),_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"stochosc":d={indicatorID:40,code:"stochosc",name:"Stochastic Oscillator",shortName:"SO",parameters:i,display:"own-window",markers:[20,50,80],discreteIndicators:[{discreteIndicatorID:40,discreteName:"Stochastic Oscillator %K",shortName:"%K",data:(c=TechInd.stochosc(i[0].Value,i[1].Value,i[2].Value,_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")}),_.map(e,function(e){return e.get("close")}))).K,displayType:"Line",color:"#E3EA5E",lineThickness:1},{discreteIndicatorID:135,discreteName:"Stochastic Oscillator %D",shortName:"%D",data:c.D,displayType:"Line",color:"#F4D548",lineThickness:1}]};break;case"aroon":d={indicatorID:3,code:"aroon",name:"Aroon",shortName:"AR",parameters:i,display:"own-window",markers:[30,50,70],discreteIndicators:[{discreteIndicatorID:249,discreteName:"Aroon Up",shortName:"Up",data:(c=TechInd.aroon(i[0].Value,_.map(e,function(e){return e.get("low")}),_.map(e,function(e){return e.get("high")}))).UP,displayType:"Line",color:"#77b34b",lineThickness:1},{discreteIndicatorID:250,discreteName:"Aroon Down",shortName:"Down",data:c.DOWN,displayType:"Line",color:"#b84d6a",lineThickness:1}]};break;case"aroonosc":d={indicatorID:251,code:"aroonosc",name:"Aroon Oscillator",shortName:"OSC",parameters:i,display:"own-window",markers:[0],discreteIndicators:[{discreteIndicatorID:251,discreteName:"Aroon Oscillator",shortName:"OSC",data:(c=TechInd.aroon(i[0].Value,_.map(e,function(e){return e.get("low")}),_.map(e,function(e){return e.get("high")}))).OSC,displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"psar":d={indicatorID:27,code:"psar",name:"Parabolic SAR",shortName:"PSAR",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:27,discreteName:"Parabolic SAR",shortName:"PSAR",data:c=TechInd.psar(i[0].Value,i[1].Value,_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")})),displayType:"Dots",lineThickness:1}]};break;case"const":d={indicatorID:128,code:"const",name:"Constant Value",shortName:"Cons. V.",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:137,discreteName:"Constant Value",shortName:"Cons. V.",data:c=this.calculateConstantValue(i[0].Value,e.length),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"bp":d={indicatorID:254,code:"bp",name:"Bar Price",shortName:"BP",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:277,discreteName:"Open Bar Price",shortName:"OBP",data:(c=this.calculateBarPrice(e)).OPEN,displayType:"Line",color:"#3DA8FF",lineThickness:1},{discreteIndicatorID:278,discreteName:"High Bar Price",shortName:"HBP",data:c.HIGH,displayType:"Line",color:"#3DA8FF",lineThickness:1},{discreteIndicatorID:279,discreteName:"Low Bar Price",shortName:"LBP",data:c.LOW,displayType:"Line",color:"#3DA8FF",lineThickness:1},{discreteIndicatorID:280,discreteName:"Close Bar Price",shortName:"CBP",data:c.CLOSE,displayType:"Line",color:"#3DA8FF",lineThickness:1},{discreteIndicatorID:281,discreteName:"Live Price",shortName:"LP",data:c.LIVE,displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"ao":d={indicatorID:1302,code:"ao",name:"Awesome Oscillator",shortName:"AO",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1302,discreteName:"Awesome Oscillator Histogram",shortName:"AO H",data:c=TechInd.ao(i[0].Value,i[1].Value,_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")})),displayType:"Histogram",color:"relative",lineThickness:1,nonConfigurable:!0}]};break;case"ac":d={indicatorID:1303,code:"ac",name:"Accelerator Oscillator",shortName:"AC",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1303,discreteName:"Accelerator Oscillator Histogram",shortName:"AC H",data:c=TechInd.ac(i[0].Value,i[1].Value,_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")})),displayType:"Histogram",color:"relative",lineThickness:1,nonConfigurable:!0}]};break;case"zz":switch(a){case"CandleStick":case"Bar":case"Kagi":case"HeikinAshi":l=[_.map(e,function(e){return e.get("open")}),_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")}),_.map(e,function(e){return e.get("close")})];break;default:l=[_.map(e,function(e){return e.get("close")})]}d={indicatorID:1304,code:"zz",name:"ZigZag",shortName:"ZZ",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:1304,discreteName:"ZigZag Line",shortName:"ZZL",data:c=TechInd.zz(i[0].Value,l),displayType:"Line",color:"#61BDF0",lineThickness:1}]};break;case"kc":d={indicatorID:1311,code:"kc",name:"Keltner Channels",shortName:"KC",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:1312,discreteName:"KC Upper Channel Line",shortName:"Upper Channel Line",data:(c=TechInd.kc(i[0].Value,i[1].Value,i[2].Value,_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")}),_.map(e,function(e){return e.get("close")}))).KCU,displayType:"Line",color:"#61BDF0",lineThickness:1},{discreteIndicatorID:1313,discreteName:"KC Middle Line",shortName:"Middle Line",data:c.KCM,displayType:"Line",color:"#C3E2F4",lineThickness:2},{discreteIndicatorID:1314,discreteName:"KC Lower Channel Line",shortName:"Lower Channel Line",data:c.KCL,displayType:"Line",color:"#61BDF0",lineThickness:1}]};break;case"sr":d={indicatorID:1315,code:"sr",name:"Support/Resistance",shortName:"S/R",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:1316,discreteName:"Support",shortName:"Support",data:(c=TechInd.sr(i[0].Value,_.map(e,function(e){return e.get("close")}),_.map(e,function(e){return e.get("open")}),_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")}))).S,displayType:"PivotLine",color:"#77b34b",displayPrices:!0,lineThickness:2},{discreteIndicatorID:1317,discreteName:"Resistance",shortName:"Resistance",data:c.R,displayType:"PivotLine",color:"#b84d6a",displayPrices:!0,lineThickness:2}]};break;case"mom":d={indicatorID:1318,code:"mom",name:"Momentum",shortName:"MOM",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1318,discreteName:"Momentum",shortName:"Momentum",data:c=TechInd.mom(i[0].Value,_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"po":d={indicatorID:1319,code:"po",name:"Price Oscillator",shortName:"PO",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1319,discreteName:"Price Oscillator",shortName:"Price Oscillator",data:c=TechInd.po(i[0].Value,i[1].Value,_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"vol":d={indicatorID:1329,code:"vol",name:"VOLUME",shortName:"VOL",parameters:i,display:"own-window",markers:null,showDecimalPlaces:!1,discreteIndicators:[{discreteIndicatorID:1319,discreteName:"Volume",shortName:"Volume",data:c=_.map(_.sortBy(e,"Date"),function(e){return isNaN(e.get("volume"))?e.get("volume"):parseInt(e.get("volume"),10)}),displayType:"Histogram",color:"#3DA8FF",lineThickness:1}]};break;default:console.log("indicator not implemented")}}catch(e){console.log(e),d=this.getPendingIndicator(t,i)}return s&&s.call(r,d),d},kU.calculateIndicatorDiscrete=function(e,t,i,a,n,o){void 0===a&&(a=""),void 0===o&&(o=null);var s=null;try{switch(e){case 37:s={indicatorID:37,code:"sma",name:"Simple Moving Average",shortName:"SMA",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:37,discreteName:"Simple Moving Average",shortName:"SMA",data:r=TechInd.sma(i[0].Value,_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 13:s={indicatorID:13,code:"ema",name:"Exponential Moving Average",shortName:"EMA",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:13,discreteName:"Exponential Moving Average",shortName:"EMA",data:r=TechInd.ema(i[0].Value,_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 52:s={indicatorID:52,code:"wma",name:"Weighted Moving Average",shortName:"WMA",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:52,discreteName:"Weighted Moving Average",shortName:"WMA",data:r=TechInd.wma(i[0].Value,_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 36:var r,l=_.find(i[1].Options,function(e){return!0===e.Selected}).Value||70,s={indicatorID:36,code:"rsi",name:"Relative Strength Index",shortName:"RSI",parameters:i,display:"own-window",markers:[100-l,50,l],discreteIndicators:[{discreteIndicatorID:36,discreteName:"Relative Strength Index",shortName:"RSI",data:r=TechInd.rsi(i[0].Value,_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 45:s={indicatorID:45,code:"typprice",name:"Typical Price",shortName:"TP",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:45,discreteName:"Typical Price",shortName:"TP",data:r=TechInd.typprice(_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 274:s={indicatorID:44,code:"truerange",name:"True Range",shortName:"TR",parameters:i,display:"own-window",markers:null,showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:274,discreteName:"True Range",shortName:"TR",data:r=TechInd.truerange(_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 1324:s={indicatorID:1323,code:"atr",name:"Average True Range",shortName:"ATR",parameters:i,display:"own-window",markers:null,showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1324,discreteName:"Average True Range",shortName:"ATR",data:r=TechInd.atr(i[0].Value,_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 8:s={indicatorID:8,code:"cci",name:"Commodity Channel Index",shortName:"CCI",parameters:i,display:"own-window",markers:[-100,0,100],discreteIndicators:[{discreteIndicatorID:8,discreteName:"Commodity Channel Index",shortName:"CCI",data:r=TechInd.cci(i[0].Value,_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 55:s={indicatorID:55,code:"williams",name:"Williams %R",shortName:"W%R",parameters:i,display:"own-window",markers:[-20,-50,-80],discreteIndicators:[{discreteIndicatorID:55,discreteName:"Williams %R",shortName:"W%R",data:r=TechInd.williams(i[0].Value,_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 19:s={indicatorID:19,code:"macd",name:"MACD",shortName:"MACD",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:19,discreteName:"MACD",shortName:"MACD",data:(r=TechInd.macd(_.map(t,function(e){return e.get("close")}),i[0].Value,i[1].Value,i[2].Value)).MACD,displayType:"Line",color:"#FAF23E",lineThickness:1}]};break;case 136:s={indicatorID:19,code:"macd",name:"MACD",shortName:"MACD",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:136,discreteName:"MACD Signal",shortName:"MACD S",data:(r=TechInd.macd(_.map(t,function(e){return e.get("close")}),i[0].Value,i[1].Value,i[2].Value)).SIGNAL,displayType:"Line",color:"#3EE2FA",lineThickness:1}]};break;case 276:s={indicatorID:19,code:"macd",name:"MACD",shortName:"MACD",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:276,discreteName:"MACD Histogram",shortName:"MACD H",data:(r=TechInd.macd(_.map(t,function(e){return e.get("close")}),i[0].Value,i[1].Value,i[2].Value)).HISTOGRAM,displayType:"Histogram",color:"absolute",lineThickness:1,nonConfigurable:!0}]};break;case 38:s={indicatorID:38,code:"stddev",name:"Standard Deviation",shortName:"SD",parameters:i,display:"own-window",markers:null,discreteIndicators:[{discreteIndicatorID:38,discreteName:"Standard Deviation",shortName:"SD",data:r=TechInd.stddev(i[0].Value,_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 4:s={indicatorID:4,code:"bb",name:"Bollinger Bands",shortName:"BB",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:4,discreteName:"BB Upper Band",shortName:"Upper Band",data:(r=TechInd.bb(i[0].Value,_.map(t,function(e){return e.get("close")}))).BBU,displayType:"Line",color:"#61BDF0",lineThickness:1}]};break;case 128:s={indicatorID:4,code:"bb",name:"Bollinger Bands",shortName:"BB",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:128,discreteName:"BB Lower Band",shortName:"Lower Band",data:(r=TechInd.bb(i[0].Value,_.map(t,function(e){return e.get("close")}))).BBL,displayType:"Line",color:"#61BDF0",lineThickness:1}]};break;case 252:s={indicatorID:4,code:"bb",name:"Bollinger Bands",shortName:"BB",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:252,discreteName:"BB Median",shortName:"Median",data:(r=TechInd.bb(i[0].Value,_.map(t,function(e){return e.get("close")}))).BBM,displayType:"Line",color:"#C3E2F4",lineThickness:2}]};break;case 24:s={indicatorID:24,code:"maenv",name:"Moving Average Envelope",shortName:"ENV",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:24,discreteName:"ENV Top",shortName:"Top",data:(r=TechInd.maenv(i[0].Value,_.map(t,function(e){return e.get("close")}),i[1].Value)).TOP,displayType:"Line",color:"#CA53F4",lineThickness:1}]};break;case 133:s={indicatorID:24,code:"maenv",name:"Moving Average Envelope",shortName:"ENV",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:133,discreteName:"ENV Bottom",shortName:"Bottom",data:(r=TechInd.maenv(i[0].Value,_.map(t,function(e){return e.get("close")}),i[1].Value)).BOTTOM,displayType:"Line",color:"#CA53F4",lineThickness:1}]};break;case 43:s={indicatorID:43,code:"trix",name:"TRIX",shortName:"TRIX",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:43,discreteName:"TRIX",shortName:"TRIX",data:r=TechInd.trix(i[0].Value,_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 31:s={indicatorID:31,code:"proc",name:"Price ROC",shortName:"PROC",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:31,discreteName:"Price ROC",shortName:"PROC",data:r=TechInd.proc(i[0].Value,_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 54:s={indicatorID:54,code:"wws",name:"Welles Wilder Smoothing",shortName:"WWS",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:54,discreteName:"Welles Wilder Smoothing",shortName:"WWS",data:r=TechInd.wws(i[0].Value,_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 41:s={indicatorID:41,code:"si",name:"Swing Index",shortName:"SI",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:41,discreteName:"Swing Index",shortName:"SI",data:r=TechInd.swingindex(i[0].Value,_.map(t,function(e){return e.get("open")}),_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 1:s={indicatorID:1,code:"asi",name:"Accumulative Swing Index",shortName:"ASI",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1,discreteName:"Accumulative Swing Index",shortName:"ASI",data:r=TechInd.asi(i[0].Value,_.map(t,function(e){return e.get("open")}),_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#48DC4A",lineThickness:1}]};break;case 46:s={indicatorID:46,code:"uo",name:"Ultimate Oscillator",shortName:"UO",parameters:i,display:"own-window",markers:[30,50,70],discreteIndicators:[{discreteIndicatorID:46,discreteName:"Ultimate Oscillator",shortName:"UO",data:r=TechInd.uo(i[0].Value,i[1].Value,i[2].Value,_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 40:s={indicatorID:40,code:"stochosc",name:"Stochastic Oscillator",shortName:"SO",parameters:i,display:"own-window",markers:[20,50,80],discreteIndicators:[{discreteIndicatorID:40,discreteName:"Stochastic Oscillator %K",shortName:"%K",data:(r=TechInd.stochosc(i[0].Value,i[1].Value,i[2].Value,_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("close")}))).K,displayType:"Line",color:"#E3EA5E",lineThickness:1}]};break;case 135:s={indicatorID:40,code:"stochosc",name:"Stochastic Oscillator",shortName:"SO",parameters:i,display:"own-window",markers:[20,50,80],discreteIndicators:[{discreteIndicatorID:135,discreteName:"Stochastic Oscillator %D",shortName:"%D",data:(r=TechInd.stochosc(i[0].Value,i[1].Value,i[2].Value,_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("close")}))).D,displayType:"Line",color:"#F4D548",lineThickness:1}]};break;case 249:s={indicatorID:3,code:"aroon",name:"Aroon",shortName:"AR",parameters:i,display:"own-window",markers:[30,50,70],discreteIndicators:[{discreteIndicatorID:249,discreteName:"Aroon Up",shortName:"Up",data:(r=TechInd.aroon(i[0].Value,_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("high")}))).UP,displayType:"Line",color:"#77b34b",lineThickness:1}]};break;case 250:s={indicatorID:3,code:"aroon",name:"Aroon",shortName:"AR",parameters:i,display:"own-window",markers:[30,50,70],discreteIndicators:[{discreteIndicatorID:250,discreteName:"Aroon Down",shortName:"Down",data:(r=TechInd.aroon(i[0].Value,_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("high")}))).DOWN,displayType:"Line",color:"#b84d6a",lineThickness:1}]};break;case 251:s={indicatorID:251,code:"aroonosc",name:"Aroon Oscillator",shortName:"OSC",parameters:i,display:"own-window",markers:[0],discreteIndicators:[{discreteIndicatorID:251,discreteName:"Aroon Oscillator",shortName:"OSC",data:(r=TechInd.aroon(i[0].Value,_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("high")}))).OSC,displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 27:s={indicatorID:27,code:"psar",name:"Parabolic SAR",shortName:"PSAR",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:27,discreteName:"Parabolic SAR",shortName:"PSAR",data:r=TechInd.psar(i[0].Value,i[1].Value,_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")})),displayType:"Dots",lineThickness:1}]};break;case 137:s={indicatorID:128,code:"const",name:"Constant Value",shortName:"Cons. V.",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:137,discreteName:"Constant Value",shortName:"Cons. V.",data:r=this.calculateConstantValue(i[0].Value,t.length),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 277:s={indicatorID:254,code:"bp",name:"Bar Price",shortName:"BP",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:277,discreteName:"Open Bar Price",shortName:"OBP",data:(r=this.calculateBarPrice(t)).OPEN,displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 278:s={indicatorID:254,code:"bp",name:"Bar Price",shortName:"BP",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:278,discreteName:"High Bar Price",shortName:"HBP",data:(r=this.calculateBarPrice(t)).HIGH,displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 279:s={indicatorID:254,code:"bp",name:"Bar Price",shortName:"BP",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:279,discreteName:"Low Bar Price",shortName:"LBP",data:(r=this.calculateBarPrice(t)).LOW,displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 280:s={indicatorID:254,code:"bp",name:"Bar Price",shortName:"BP",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:280,discreteName:"Close Bar Price",shortName:"CBP",data:(r=this.calculateBarPrice(t)).CLOSE,displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 281:s={indicatorID:254,code:"bp",name:"Bar Price",shortName:"BP",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:281,discreteName:"Live Price",shortName:"LP",data:(r=this.calculateBarPrice(t)).LIVE,displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 1302:s={indicatorID:1302,code:"ao",name:"Awesome Oscillator",shortName:"AO",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1302,discreteName:"Awesome Oscillator Histogram",shortName:"AO H",data:r=TechInd.ao(i[0].Value,i[1].Value,_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")})),displayType:"Histogram",color:"relative",lineThickness:1,nonConfigurable:!0}]};break;case 1303:s={indicatorID:1303,code:"ac",name:"Accelerator Oscillator",shortName:"AC",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1303,discreteName:"Accelerator Oscillator Histogram",shortName:"AC H",data:r=TechInd.ac(i[0].Value,i[1].Value,_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")})),displayType:"Histogram",color:"relative",lineThickness:1,nonConfigurable:!0}]};break;case 1304:var d=void 0;switch(a){case"CandleStick":case"Bar":case"Kagi":case"HeikinAshi":d=[_.map(t,function(e){return e.get("open")}),_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("close")})];break;case"Line-High":d=[_.map(t,function(e){return e.get("high")})];break;case"Line-Low":d=[_.map(t,function(e){return e.get("low")})];break;default:d=[_.map(t,function(e){return e.get("close")})]}s={indicatorID:1304,code:"zz",name:"ZigZag",shortName:"ZZ",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:1304,discreteName:"ZigZag Line",shortName:"ZZL",data:r=TechInd.zz(i[0].Value,d),displayType:"Line",color:"#61BDF0",lineThickness:1}]};break;case 1311:s={indicatorID:1311,code:"kc",name:"Keltner Channels",shortName:"KC",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:1312,discreteName:"KC Upper Channel Line",shortName:"Upper Channel Line",data:(r=TechInd.kc(i[0].Value,i[1].Value,i[2].Value,_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("close")}))).KCU,displayType:"Line",color:"#61BDF0",lineThickness:1},{discreteIndicatorID:1313,discreteName:"KC Middle Line",shortName:"Middle Line",data:r.KCM,displayType:"Line",color:"#C3E2F4",lineThickness:2},{discreteIndicatorID:1314,discreteName:"KC Lower Channel Line",shortName:"Lower Channel Line",data:r.KCL,displayType:"Line",color:"#61BDF0",lineThickness:1}]};break;case 1315:s={indicatorID:1315,code:"sr",name:"Support/Resistance",shortName:"S/R",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:1316,discreteName:"Support",shortName:"Support",data:(r=TechInd.sr(_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")}))).S,displayType:"PivotLine",color:"#77b34b",displayPrices:!0,lineThickness:2},{discreteIndicatorID:1317,discreteName:"Resistance",shortName:"Resistance",data:r.R,displayType:"PivotLine",color:"#b84d6a",displayPrices:!0,lineThickness:2}]};break;case 1318:s={indicatorID:1318,code:"mom",name:"Momentum",shortName:"MOM",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1318,discreteName:"Momentum",shortName:"Momentum",data:r=TechInd.mom(i[0].Value,_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 1319:s={indicatorID:1319,code:"po",name:"Price Oscillator",shortName:"PO",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1319,discreteName:"Price Oscillator",shortName:"Price Oscillator",data:r=TechInd.po(i[0].Value,i[1].Value,_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;default:console.log("indicator not implemented")}}catch(e){console.log(e)}return n&&n.call(o,s),s},kU.calculateBarPrice=function(e){var t={OPEN:[],HIGH:[],LOW:[],CLOSE:[],LIVE:[]};return _.each(e,function(e){t.OPEN.push(e.get("open")),t.HIGH.push(e.get("high")),t.LOW.push(e.get("low")),t.CLOSE.push(e.get("close")),t.LIVE.push(e.get("close"))}),t},kU.calculateConstantValue=function(e,t){for(var i=[],a=0;a<t;a+=1)i.push(e);return i},kU.getPendingIndicator=function(e,t){try{switch(e){case"sma":a={indicatorID:37,code:"sma",name:"Simple Moving Average",shortName:"SMA",parameters:t,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:37,discreteName:"Simple Moving Average",shortName:"SMA",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"ema":a={indicatorID:13,code:"ema",name:"Exponential Moving Average",shortName:"EMA",parameters:t,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:13,discreteName:"Exponential Moving Average",shortName:"EMA",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"wma":a={indicatorID:52,code:"wma",name:"Weighted Moving Average",shortName:"WMA",parameters:t,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:52,discreteName:"Weighted Moving Average",shortName:"WMA",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"rsi":var i=_.find(t[1].Options,function(e){return!0===e.Selected}).Value||70,a={indicatorID:36,code:"rsi",name:"Relative Strength Index",shortName:"RSI",parameters:t,display:"own-window",markers:[100-i,50,i],discreteIndicators:[{discreteIndicatorID:36,discreteName:"Relative Strength Index",shortName:"RSI",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"typprice":a={indicatorID:45,code:"typprice",name:"Typical Price",shortName:"TP",parameters:t,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:45,discreteName:"Typical Price",shortName:"TP",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"truerange":a={indicatorID:44,code:"truerange",name:"True Range",shortName:"TR",parameters:t,display:"own-window",markers:null,showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:274,discreteName:"True Range",shortName:"TR",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"atr":a={indicatorID:1323,code:"atr",name:"Average True Range",shortName:"ATR",parameters:t,display:"own-window",markers:null,showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1324,discreteName:"Average True Range",shortName:"ATR",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"cci":a={indicatorID:8,code:"cci",name:"Commodity Channel Index",shortName:"CCI",parameters:t,display:"own-window",markers:[-100,0,100],discreteIndicators:[{discreteIndicatorID:8,discreteName:"Commodity Channel Index",shortName:"CCI",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"williams":a={indicatorID:55,code:"williams",name:"Williams %R",shortName:"W%R",parameters:t,display:"own-window",markers:[-20,-50,-80],discreteIndicators:[{discreteIndicatorID:55,discreteName:"Williams %R",shortName:"W%R",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"macd":a={indicatorID:19,code:"macd",name:"MACD",shortName:"MACD",parameters:t,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:276,discreteName:"MACD Histogram",shortName:"MACD H",data:[],displayType:"Histogram",color:"absolute",lineThickness:1,nonConfigurable:!0},{discreteIndicatorID:19,discreteName:"MACD",shortName:"MACD",data:[],displayType:"Line",color:"#FAF23E",lineThickness:1},{discreteIndicatorID:136,discreteName:"MACD Signal",shortName:"MACD S",data:[],displayType:"Line",color:"#3EE2FA",lineThickness:1}]};break;case"stddev":a={indicatorID:38,code:"stddev",name:"Standard Deviation",shortName:"SD",parameters:t,display:"own-window",markers:null,discreteIndicators:[{discreteIndicatorID:38,discreteName:"Standard Deviation",shortName:"SD",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"bb":a={indicatorID:4,code:"bb",name:"Bollinger Bands",shortName:"BB",parameters:t,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:4,discreteName:"BB Upper Band",shortName:"Upper Band",data:[],displayType:"Line",color:"#61BDF0",lineThickness:1},{discreteIndicatorID:252,discreteName:"BB Median",shortName:"Median",data:[],displayType:"Line",color:"#C3E2F4",lineThickness:2},{discreteIndicatorID:128,discreteName:"BB Lower Band",shortName:"Lower Band",data:[],displayType:"Line",color:"#61BDF0",lineThickness:1}]};break;case"maenv":a={indicatorID:24,code:"maenv",name:"Moving Average Envelope",shortName:"ENV",parameters:t,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:24,discreteName:"ENV Top",shortName:"Top",data:[],displayType:"Line",color:"#CA53F4",lineThickness:1},{discreteIndicatorID:133,discreteName:"ENV Bottom",shortName:"Bottom",data:[],displayType:"Line",color:"#CA53F4",lineThickness:1}]};break;case"trix":a={indicatorID:43,code:"trix",name:"TRIX",shortName:"TRIX",parameters:t,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:43,discreteName:"TRIX",shortName:"TRIX",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"proc":a={indicatorID:31,code:"proc",name:"Price ROC",shortName:"PROC",parameters:t,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:31,discreteName:"Price ROC",shortName:"PROC",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"wws":a={indicatorID:54,code:"wws",name:"Welles Wilder Smoothing",shortName:"WWS",parameters:t,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:54,discreteName:"Welles Wilder Smoothing",shortName:"WWS",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"si":a={indicatorID:41,code:"si",name:"Swing Index",shortName:"SI",parameters:t,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:41,discreteName:"Swing Index",shortName:"SI",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"asi":a={indicatorID:1,code:"asi",name:"Accumulative Swing Index",shortName:"ASI",parameters:t,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1,discreteName:"Accumulative Swing Index",shortName:"ASI",data:[],displayType:"Line",color:"#48DC4A",lineThickness:1}]};break;case"uo":a={indicatorID:46,code:"uo",name:"Ultimate Oscillator",shortName:"UO",parameters:t,display:"own-window",markers:[30,50,70],discreteIndicators:[{discreteIndicatorID:46,discreteName:"Ultimate Oscillator",shortName:"UO",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"stochosc":a={indicatorID:40,code:"stochosc",name:"Stochastic Oscillator",shortName:"SO",parameters:t,display:"own-window",markers:[20,50,80],discreteIndicators:[{discreteIndicatorID:40,discreteName:"Stochastic Oscillator %K",shortName:"%K",data:[],displayType:"Line",color:"#E3EA5E",lineThickness:1},{discreteIndicatorID:135,discreteName:"Stochastic Oscillator %D",shortName:"%D",data:[],displayType:"Line",color:"#F4D548",lineThickness:1}]};break;case"aroon":a={indicatorID:3,code:"aroon",name:"Aroon",shortName:"AR",parameters:t,display:"own-window",markers:[30,50,70],discreteIndicators:[{discreteIndicatorID:249,discreteName:"Aroon Up",shortName:"Up",data:[],displayType:"Line",color:"#77b34b",lineThickness:1},{discreteIndicatorID:250,discreteName:"Aroon Down",shortName:"Down",data:[],displayType:"Line",color:"#b84d6a",lineThickness:1}]};break;case"aroonosc":a={indicatorID:251,code:"aroonosc",name:"Aroon Oscillator",shortName:"OSC",parameters:t,display:"own-window",markers:[0],discreteIndicators:[{discreteIndicatorID:251,discreteName:"Aroon Oscillator",shortName:"OSC",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"psar":a={indicatorID:27,code:"psar",name:"Parabolic SAR",shortName:"PSAR",parameters:t,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:27,discreteName:"Parabolic SAR",shortName:"PSAR",data:[],displayType:"Dots",lineThickness:1}]};break;case"const":a={indicatorID:128,code:"const",name:"Constant Value",shortName:"Cons. V.",parameters:t,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:137,discreteName:"Constant Value",shortName:"Cons. V.",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"bp":a={indicatorID:254,code:"bp",name:"Bar Price",shortName:"BP",parameters:t,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:277,discreteName:"Open Bar Price",shortName:"OBP",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1},{discreteIndicatorID:278,discreteName:"High Bar Price",shortName:"HBP",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1},{discreteIndicatorID:279,discreteName:"Low Bar Price",shortName:"LBP",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1},{discreteIndicatorID:280,discreteName:"Close Bar Price",shortName:"CBP",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1},{discreteIndicatorID:281,discreteName:"Live Price",shortName:"LP",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"ao":a={indicatorID:1302,code:"ao",name:"Awesome Oscillator",shortName:"AO",parameters:t,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1302,discreteName:"Awesome Oscillator Histogram",shortName:"AO H",data:[],displayType:"Histogram",color:"relative",lineThickness:1,nonConfigurable:!0}]};break;case"ac":a={indicatorID:1303,code:"ac",name:"Accelerator Oscillator",shortName:"AC",parameters:t,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1303,discreteName:"Accelerator Oscillator Histogram",shortName:"AC H",data:[],displayType:"Histogram",color:"relative",lineThickness:1,nonConfigurable:!0}]};break;case"zz":a={indicatorID:1304,code:"zz",name:"ZigZag",shortName:"ZZ",parameters:t,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:1304,discreteName:"ZigZag Line",shortName:"ZZL",data:[],displayType:"Line",color:"#61BDF0",lineThickness:1}]};break;case"kc":a={indicatorID:1311,code:"kc",name:"Keltner Channels",shortName:"KC",parameters:t,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:1312,discreteName:"KC Upper Channel Line",shortName:"Upper Channel Line",data:[],displayType:"Line",color:"#61BDF0",lineThickness:1},{discreteIndicatorID:1313,discreteName:"KC Middle Line",shortName:"Middle Line",data:[],displayType:"Line",color:"#C3E2F4",lineThickness:2},{discreteIndicatorID:1314,discreteName:"KC Lower Channel Line",shortName:"Lower Channel Line",data:[],displayType:"Line",color:"#61BDF0",lineThickness:1}]};break;case"sr":a={indicatorID:1315,code:"sr",name:"Support/Resistance",shortName:"S/R",parameters:t,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:1316,discreteName:"Support",shortName:"Support",data:[],displayType:"PivotLine",color:"#77b34b",displayPrices:!0,lineThickness:2},{discreteIndicatorID:1317,discreteName:"Resistance",shortName:"Resistance",data:[],displayType:"PivotLine",color:"#b84d6a",displayPrices:!0,lineThickness:2}]};break;case"mom":a={indicatorID:1318,code:"mom",name:"Momentum",shortName:"MOM",parameters:t,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1318,discreteName:"Momentum",shortName:"Momentum",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"po":a={indicatorID:1319,code:"po",name:"Price Oscillator",shortName:"PO",parameters:t,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1319,discreteName:"Price Oscillator",shortName:"Price Oscillator",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"vol":a={indicatorID:1329,code:"vol",name:"Volume",shortName:"VOL",parameters:t,display:"own-window",markers:null,showDecimalPlaces:!1,discreteIndicators:[{discreteIndicatorID:1319,discreteName:"Volume",shortName:"Volume",data:[],displayType:"Histogram",color:"#3DA8FF",lineThickness:1}]};break;default:console.log("indicator not implemented")}}catch(e){console.log(e)}return a},kU);function kU(){}var IndicatorsManager=(UX.prototype.addCustomIndicator=function(e,t,i,a,n){for(var o,s=_.filter(this.displayArea.allSeries[0].get("elements"),function(e){return!e.get("isFake")}),r={indicatorID:-1,code:"custom",name:a,shortName:a,parameters:null,display:i,markers:null,discreteIndicators:[]},l=0;l<e.length;l+=1)o=IndicatorCalculator.calculateIndicatorDiscrete(e[l],s,t[l],this.displayArea.allSeries[0].get("displayType"),this.displayArea.model,this.chart.stockDataProvider),n&&n[l]&&(o.discreteIndicators[0].color=n[l]),r.discreteIndicators.push(o.discreteIndicators[0]);return this.addIndicatorDetails(r)},UX.prototype.addIndicator=function(e,t,a,n){var o,s,r=this,l=_.filter(this.displayArea.allSeries[0].get("elements"),function(e){return!e.get("isFake")}).length,d=[],c=0;IndicatorCalculator.calculateIndicator(e,this.getDataSource(d),t,this.displayArea.allSeries[0].get("displayType"),this.displayArea.model,this.chart.stockDataProvider,function(i){if(i){if(!i.error){for(var e=0;e<i.discreteIndicators.length;e+=1)!function(t){0<i.discreteIndicators[t].data.length&&_.each(d,function(e){i.discreteIndicators[t].data.splice(e,0,null)}),a[t]&&(i.discreteIndicators[t].color=a[t]),n[t]&&(i.discreteIndicators[t].lineThickness=n[t]),o=l,i.discreteIndicators[t].futureElementsCount&&(o+=i.discreteIndicators[t].futureElementsCount,i.discreteIndicators[t].futureElementsCount&&(c=i.discreteIndicators[t].futureElementsCount>c?i.discreteIndicators[t].futureElementsCount:c)),"ProfitArea"===i.discreteIndicators[t].displayType?(i.discreteIndicators[t].profitData=i.discreteIndicators[t].profitData.slice(i.discreteIndicators[t].profitData.length-o),i.discreteIndicators[t].lossData=i.discreteIndicators[t].lossData.slice(i.discreteIndicators[t].lossData.length-o)):i.discreteIndicators[t].data=i.discreteIndicators[t].data.slice(i.discreteIndicators[t].data.length-o)}(e);return r.chart.moveIntoTheFuture(c),s=r.addIndicatorDetails(i),"vol"===i.code&&r.chart.volumeIndicator&&(r.chart.volumeIndicator=s),s}r.onError(i.error)}},this)},UX.prototype.addDefaultIndicator=function(e,t){var i,a,n=this,o=0,s=[];this.chart.isStockLoaded?(a=_.filter(this.displayArea.allSeries[0].get("elements"),function(e){return!e.get("isFake")}).length,IndicatorCalculator.calculateDefaultIndicator(e,this.getDataSource(s),this.displayArea.allSeries[0].get("displayType"),this.displayArea.model,this.chart.stockDataProvider,function(e){e.error?n.onError(e.error):(_.each(e.discreteIndicators,function(t){"ProfitArea"===t.displayType?(0<t.profitData.length&&_.each(s,function(e){t.profitData.splice(e,0,null)}),0<t.lossData.length&&_.each(s,function(e){t.lossData.splice(e,0,null)})):0<t.data.length&&_.each(s,function(e){t.data.splice(e,0,null)}),i=a,t.futureElementsCount&&(i+=t.futureElementsCount,o=t.futureElementsCount>o?t.futureElementsCount:o),"ProfitArea"===t.displayType&&(t.profitData=t.profitData.slice(t.profitData.length-i),t.lossData=t.lossData.slice(t.lossData.length-i))}),n.chart.moveIntoTheFuture(o),n.addIndicatorDetails(e,!1))},this,t)):console.log("error - trying to add indicator while no stock loaded!")},UX.prototype.addDefaultIndicator2=function(e,t){var i,a,n=0,o=[];return this.chart.isStockLoaded?(i=_.filter(this.displayArea.allSeries[0].get("elements"),function(e){return!e.get("isFake")}).length,e=IndicatorCalculator.calculateDefaultIndicator(e,this.getDataSource(o),this.displayArea.allSeries[0].get("displayType"),this.displayArea.model,this.chart.stockDataProvider,null,this,t),_.each(e.discreteIndicators,function(t){0<t.data.length&&_.each(o,function(e){t.data.splice(e,0,null)}),a=i,t.futureElementsCount&&(a+=t.futureElementsCount,n=t.futureElementsCount>n?t.futureElementsCount:n),"ProfitArea"===t.displayType&&(t.profitData=t.profitData.slice(t.profitData.length-a),t.lossData=t.lossData.slice(t.lossData.length-a))}),this.chart.moveIntoTheFuture(n),this.addIndicatorDetails(e,!1)):null},UX.prototype.addElementsInEnd=function(t){_.forEach(this.indicators,function(e){_.forEach(e.indicatorSeries.displaySeries,function(e){e.addSeriesElementsInEnd(_.toArray(t))}),e.chartArea&&e.chartArea.displayArea.refreshDates()})},UX.prototype.addIndicatorDetails=function(i,e){void 0===e&&(e=!1);var a,n,o,s,r,l,d,t,c=_.map(this.displayArea.allSeries[0].get("elements"),function(e){return e.get("quoteDate")});return this.indicatorsCounter+=1,i.objectID=this.indicatorsCounter,"own-window"===i.display&&this.chart.model.get("lowerIndicatorsLimit")?(t=_.filter(this.indicators,{display:"own-window"})).length+1>this.chart.model.get("lowerIndicatorsLimit")&&this.removeIndicator(_.first(t)):"on-chart"===i.display&&this.chart.model.get("upperIndicatorsLimit")&&(t=_.filter(this.indicators,{display:"on-chart"})).length+1>this.chart.model.get("upperIndicatorsLimit")&&this.removeIndicator(_.first(t)),this.indicators.push(i),this.updateSerializedIndicators(),i.indicatorSeries=new ChartSeries,i.indicatorSeries.symbol=i.code,i.indicatorSeries.displayName=i.name,i.indicatorSeries.showDecimalPlaces=i.showDecimalPlaces,i.indicatorSeries.IndicatorParameters=i.parameters,i.indicatorSeries.seriesMarkers=i.markers,_.each(i.discreteIndicators,function(e){if(a=[],s=new ChartDisplaySeries({elements:[],displayType:e.displayType,displayName:e.discreteName,displayColor:e.color,lineThickness:e.lineThickness,displayId:e.discreteIndicatorID,displayPrices:e.displayPrices,markers:i.markers}),"ProfitArea"===e.displayType){o=e.profitData.length;var t=c.length-o;for(n=0;n<t;n+=1)a.push(new ChartSeriesElement({value:null,quoteDate:new Date(c[n]),isFake:!0}));for(n=0;n<o;n++)r=e.profitData[n]>e.lossData[n],l=(r?e.profitData:e.lossData)[n],d=(r?e.lossData:e.profitData)[n],a.push(new ChartSeriesElement({high:l,low:d,value:l,quoteDate:new Date(c[n+t]),isFake:null===e.profitData[n],isInProfit:r}));s.set({profitColor:e.profitColor,lossColor:e.lossColor})}else{o=e.data.length;t=c.length-o;for(n=0;n<t;n+=1)a.push(new ChartSeriesElement({value:null,quoteDate:new Date(c[n]),isFake:!0}));for(n=0;n<o;n++)a.push(new ChartSeriesElement({value:e.data[n],quoteDate:new Date(c[n+t]),isFake:null===e.data[n]}))}s.addSeriesElements(a),i.indicatorSeries.addDisplaySeries(s)}),"on-chart"===i.display?this.mainChartArea.addSeries(i.indicatorSeries):"own-window"===i.display?(this.addIndicatorChartArea(i),e||this.chart.onResize()):console.log("unsupported indicator display type"),this.chart.model.get("isIndicatorsToolbarVisible")&&this.chart.indicatorsToolbar.addSeries({series:i.indicatorSeries,objectID:i.objectID,isStackedIndicator:"own-window"===i.display,indicatorDetails:i}),e||this.chart.display(!0),this.chart.model.get("isIndicatorsToolbarVisible")||this.chart.onResize(!0),this.indicatorsCounter},UX.prototype.addDefaultIndicatorDiscrete=function(e){e=IndicatorCalculator.calculateDefaultIndicatorDiscrete(e,_.filter(this.displayArea.allSeries[0].get("elements"),function(e){return!e.get("isFake")}));return this.addIndicatorDetails(e)},UX.prototype.addIndicatorDiscrete=function(e,t){e=IndicatorCalculator.calculateIndicatorDiscrete(e,_.filter(this.displayArea.allSeries[0].get("elements"),function(e){return!e.get("isFake")}),t,this.displayArea.allSeries[0].get("displayType"),this.displayArea.model,this.chart.stockDataProvider);return this.addIndicatorDetails(e)},UX.prototype.addIndicatorChartArea=function(e){var i=this,t=e.name,a=document.createElement("div"),a=($(a).css("position","absolute"),$(a).appendTo(this.$indicatorsChartAreaDiv),new ChartArea({el:$(a),model:this.chart.model,prefix:"indicatorChartArea",showLastValue:!1,percentageHeight:.15}));this.indicatorsChartAreas.push(a),this.chart.chartAreas.push(a),this.chart.applyChartAreaEvents(a),a.addSeries(e.indicatorSeries),e.parameters&&0<e.parameters.length&&(t+="("+_.map(e.parameters,function(e){switch(e.Type){case"number":return e.Value;case"list":var t=_.find(e.Options,function(e){return e.Selected});return t?t.Name:null;default:return e.Value}}).join(",")+")"),a.setChartName(t,14,"left","top"),e.chartArea=a,$(a).on("datesRangeChanged",function(e,t){t.isIndicator=!0,i.chart.onDatesRangeChanged(t)}),$(a).on("remove-indicator",function(e,t){t=_.find(i.indicators,{chartArea:t.chartArea});t&&i.removeIndicator(t)})},UX.prototype.clear=function(e){var t,i=this;this.indicators.length<=0||(e||(_.each(this.indicators,function(e){e.chartArea||i.mainChartArea.onRemoveSeriesRequest(null,{series:e.indicatorSeries})}),t=0),this.indicators=[],0<this.$indicatorsChartAreaDiv.children().length&&(this.chart.chartAreas=_.difference(this.chart.chartAreas,this.indicatorsChartAreas),t=this.chart.chartAreas.length,this.indicatorsChartAreas=[],this.$indicatorsChartAreaDiv.html("")),this.chart.indicatorsToolbar.clear(),(0<t||!this.chart.model.get("isIndicatorsToolbarVisible"))&&this.chart.onResize(!0),this.updateSerializedIndicators())},UX.prototype.getChartAreasToolbarsHeights=function(){return 0<this.indicatorsChartAreas.length?this.indicatorsChartAreas[0].toolbarHeight():0},UX.prototype.getDataSource=function(i){return _.filter(this.displayArea.allSeries[0].get("elements"),function(e,t){return!!e.get("close")||(i.push(t),!1)})},UX.prototype.getIndicaotrByObjectID=function(t){return _.find(this.indicators,function(e){return e.objectID===t})},UX.prototype.getIndicaotrsDiscrete=function(){var t=[];return _.forEach(this.indicators,function(e){_.forEach(e.discreteIndicators,function(e){t.push({indicatorDiscreteID:e.discreteIndicatorID,data:_.toArray(e.data)})})}),t},UX.prototype.getIndicaotrsInfo=function(t){var i,e=_.sortBy(this.indicators,function(e){return e.indicatorSeries.get("displayIndex")}),a=[];return _.each(e,function(e){_.each(e.indicatorSeries.displaySeries,function(e){(i=e.get("elements")).length>t&&!i[t].get("isFake")&&a.push({displayColor:e.get("displayColor"),displayName:e.get("displayName"),value:e.get("elements")[t].get("value")})})}),a},UX.prototype.onError=function(e){var t=this;this.chart.model.get("componentApi").showErrorMessage({error:e}),this.errorTimeout&&clearTimeout(this.errorTimeout),this.errorTimeout=setTimeout(function(){t.chart.model.get("componentApi").hideErrorMessage()},3e3)},UX.prototype.recalculateIndicators=function(a){var e,n,o,s,r,l,d,c,h,p,u,m,g,f,y=this,t=_.filter(this.indicators,function(e){return!e.isStock});0<t.length&&(c=_.filter(this.displayArea.allSeries[0].get("elements"),function(e){return!e.get("isFake")}).length,n=_.map(this.displayArea.allSeries[0].get("elements"),function(e){return e.get("quoteDate")}),p=0,f=_.last(t),_.forEach(t,function(t){var i=[];e=function(e){e.error?y.onError(e.error):(_.each(e.discreteIndicators,function(t){0<t.data.length&&_.each(i,function(e){t.data.splice(e,0,null)})}),_.forEach(t.indicatorSeries.displaySeries,function(t){if(e){if(d=_.filter(e.discreteIndicators,function(e){return e.discreteName===t.get("displayName")})[0],o=[],h=c,d.futureElementsCount&&(h+=d.futureElementsCount,p=d.futureElementsCount>p?d.futureElementsCount:p),"ProfitArea"===d.displayType){for(r=h,l=n.length-h,d.profitData=d.profitData.slice(d.profitData.length-h),d.lossData=d.lossData.slice(d.lossData.length-h),s=0;s<l;s+=1)o.push(new ChartSeriesElement({value:null,quoteDate:new Date(n[s]),isFake:!0}));for(s=0;s<r;s++)u=d.profitData[s]>d.lossData[s],m=(u?d.profitData:d.lossData)[s],g=(u?d.lossData:d.profitData)[s],o.push(new ChartSeriesElement({high:m,low:g,value:m,quoteDate:new Date(n[s+l]),isFake:null===d.profitData[s],isInProfit:u}))}else for(s=0;s<d.data.length;s++)o.push(new ChartSeriesElement({value:d.data[s],quoteDate:new Date(n[s]),isFake:null===d.data[s]}));t.set({elements:o})}else for(o=[],s=0;s<n.length;s++)o.push(new ChartSeriesElement({quoteDate:new Date(n[s]),isFake:!0})),t.set({elements:o})}),f===t&&(y.chart.display(!0),a&&a()))},IndicatorCalculator.calculateIndicator(t.code,y.getDataSource(i),t.parameters,y.displayArea.allSeries[0].get("displayType"),y.displayArea.model,y.chart.stockDataProvider,e,y),t.chartArea&&t.chartArea.displayArea.refreshDates()}))},UX.prototype.removeIndicator=function(e){this.indicators=_.without(this.indicators,e),e.chartArea?(this.indicatorsChartAreas=_.without(this.indicatorsChartAreas,e.chartArea),e.chartArea.remove(),this.chart.onRemoveChartAreaRequest({chartArea:e.chartArea,targert:e.chartArea}),this.chart.onResize()):this.mainChartArea.onRemoveSeriesRequest(null,{series:e.indicatorSeries}),this.chart.indicatorsToolbar&&(this.chart.model.get("isIndicatorsToolbarVisible")?this.chart.indicatorsToolbar.removeIndicator(e):$(this.chart.indicatorsToolbar).trigger("toolbarresize")),this.updateSerializedIndicators()},UX.prototype.removeIndicatorByObjectID=function(e){e=this.getIndicaotrByObjectID(e);e&&this.removeIndicator(e)},UX.prototype.serializeIndicators=function(e){var t=[];return _.each(e,function(e){t.push({code:e.code,parameters:e.parameters,discreteIndicators:_.map(e.discreteIndicators,function(e){return{color:e.color,lineThickness:e.lineThickness}})})}),JSON.stringify(t)},UX.prototype.updateIndicatorByObjectID=function(e){this.getIndicaotrByObjectID(e)&&this.updateIndicator()},UX.prototype.updateIndicator=function(){this.recalculateIndicators(null),this.savedIndicatorsInitialized&&this.updateSerializedIndicators()},UX.prototype.updateSerializedIndicators=function(){this.chart.model.set("indicators",this.serializeIndicators(this.indicators))},UX);function UX(e,t,i){var a=this;this.mainChartArea=t,this.displayArea=i,this.chart=e,this.$indicatorsChartAreaDiv=this.chart.$el.find(".IndicatorsChartAreaDiv"),this.indicators=[],this.pendingIndicators=[],this.indicatorsCounter=0,this.indicatorsChartAreas=[],this.savedIndicatorsInitialized=!1,$(this.chart.indicatorsToolbar).on("removeSeriesRequest",function(e,t){var i=_.find(a.indicators,function(e){return e.indicatorSeries===t.series});i&&a.removeIndicator(i)})}var DynamicPricesManager=(M$.prototype.init=function(){this.pricesQ=[],this.livePrices=[],this.bucketSizeMinutes=null,this.bucketSizeDays=null,this.bucketSizeMonths=null,this.bucketSizeSeconds=null,this.isProcessing=!1,this.firstPriceIn=!1,this.lastDate=null,this.nowDate=null,this.limitDate=null,this.updateBucketSize()},M$.prototype.clear=function(){this.livePrices=[],this.pricesQ=[],this.isProcessing=!1,this.firstPriceIn=!1,this.lastDate=null,this.nowDate=null,this.limitDate=null,this.updateBucketSize()},M$.prototype.flush=function(){var e,t,i,a,n,o;if(this.livePrices&&0<this.livePrices.length){var s=this.livePrices;if(this.livePrices=[],0<s.length)for(e=s[0],a=_.last(s),i=t=e=e.real||(e.offer+e.bid)/2,a=a.real||(a.offer+a.bid)/2,n=0;n<s.length;n+=1)t<(o=s[n].real||(s[n].offer+s[n].bid)/2)?t=o:o<i&&(i=o);this.onHistoricalPrice({granularity:this.chart.model.get("granularity"),period:this.chart.model.get("period"),stock:{symbol:this.chart.model.get("stockSymbol"),newElements:[{Open:e,High:t,Low:i,Close:a,Date:this.limitDate,Volume:s[s.length-1].volume}]}})}},M$.prototype.onPrice=function(){var e,t=this;if(!this.isProcessing&&0<this.pricesQ.length)if(this.isProcessing=!0,this.chart&&this.chart.mainChartArea&&this.chart.mainChartArea.allSeries[0]){switch((e=this.pricesQ.shift()).type){case"live":this.onLivePrice(e.price);break;case"historical":this.onHistoricalPrice(e.price)}this.isProcessing=!1,this.onPrice()}else setTimeout(function(){t.isProcessing=!1,t.onPrice()},100)},M$.prototype.onLivePrice=function(e){var t,i,a,n,o,s,r=this;if(this.firstPriceIn?(t=this.getLastElement(),this.updateLastDate(t.get("quoteDate")),t.get("index")===this.chart.lastToIndex&&this.chart.moveIntoTheFuture(1)):(this.firstPriceIn=!0,this.setLastDate(this.flattenDateAndRemoveOneBucket(e.printedAt)),this.chart.moveIntoTheFuture(1,this.nowDate)),"Tick"===this.chart.model.get("granularity"))i=(e.bid+e.offer)/2,this.onHistoricalPrice({granularity:this.chart.model.get("granularity"),period:this.chart.model.get("period"),stock:{symbol:this.chart.model.get("stockSymbol"),newElements:[{Open:i,High:i,Low:i,Close:i,Date:e.printedAt}]}});else if(this.livePrices.push(e),this.limitDate>e.printedAt){if(this.livePrices=_.filter(this.livePrices,function(e){return e.printedAt>=r.nowDate}),0<this.livePrices.length)for(n=a=i=(t=this.livePrices[0]).real||(t.offer+t.bid)/2,s=0;s<this.livePrices.length;s+=1)a<(o=this.livePrices[s].real||(this.livePrices[s].offer+this.livePrices[s].bid)/2)?a=o:o<n&&(n=o);this.chart.mainChartArea.allSeries[0].displaySeries[0].updateLiveElement(e.bid,e.offer,e.printedAt,i,a,n,this.chart.mainChartArea.displayArea)}else this.flush()},M$.prototype.onHistoricalPrice=function(e){if(!(e.stock.newElements.length<=0)){for(var e=_.map(e.stock.newElements,function(e){return new ChartSeriesElement({open:e.Open,high:e.High,low:e.Low,close:e.Close,value:e.Close,quoteDate:e.Date,volume:e.Volume,letter:e.Letter,dateTag:e.DateTag})}),t=e[0].get("quoteDate").getTime(),i=this.chart.mainChartArea.displayArea.allDates,a=i.length-1;0<=a&&!(i[a].getTime()<=t);--a);var n=this.chart.mainChartArea.displayArea.allSeries[0].get("elements").length,o=e[e.length-1].get("value");o>this.chart.mainChartArea.lastValue?this.chart.mainChartArea.lastBgd=this.chart.model.get("liveGreenColor")||this.chart.model.get("greenColor"):this.chart.mainChartArea.lastBgd=this.chart.model.get("redColor"),this.chart.mainChartArea.lastValue=o,this.chart.mainChartArea.displayArea.allSeries[0].replaceAndAddSeriesElements(a,e),n!==(o=this.chart.mainChartArea.displayArea.allSeries[0].get("elements").length)?(e=o-n,this.chart.mainChartArea.displayArea.refreshDates(),this.chart.recalculateIndicators(),this.chart.lastToIndex===n-1&&this.chart.displayIndexes(!1,this.chart.lastFromIndex+e,this.chart.lastToIndex+e),this.chart.rangeSelector&&this.chart.rangeSelector.resetSlider(this.chart.lastFromIndex,this.chart.lastToIndex,o,this.chart.model.get("showSliderDates")?this.chart.mainChartArea.calculateDisplayDates2(0,this.chart.mainChartArea.displayArea.allDates.length-1,this.chart.rangeSelector.datesWidth()):null),this.chart.mainChartArea.isMouseOn&&this.chart.mainChartArea.onMouseMove({pageX:this.chart.mainChartArea.lastMouseX,pageY:this.chart.mainChartArea.lastMouseY})):(this.chart.recalculateIndicators(),this.chart.displayIndexes(!0,this.chart.lastFromIndex,this.chart.lastToIndex)),0<this.livePrices.length&&this.onLivePrice(this.livePrices[this.livePrices.length-1])}},M$.prototype.pushLivePrice=function(e,t){e.marketId.toString()===this.chart.model.get("stockSymbol").toString()&&(this.pricesQ.push({type:"live",price:e}),t||this.onPrice())},M$.prototype.pushHistoricalPrice=function(e){e.hasNewData&&e.stock.symbol===this.chart.model.get("stockSymbol")&&e.granularity===this.chart.model.get("granularity")&&(this.pricesQ.push({type:"historical",price:e}),this.onPrice())},M$.prototype.getLastElement=function(){for(var e=this.chart.mainChartArea.allSeries[0].displaySeries[0].get("elements"),t=null,i=e.length-1;0<=i;--i)if(!e[i].get("isFake")){t=e[i];break}return t},M$.prototype.updateBucketSize=function(){var e=this.chart.model.get("granularity");switch(this.bucketSizeDays=null,this.bucketSizeMinutes=null,this.bucketSizeMonths=null,e){case"OneDay":this.bucketSizeDays=1;break;case"OneWeek":this.bucketSizeDays=7;break;case"OneMonth":this.bucketSizeMonths=1;break;case"Tick":this.bucketSizeSeconds=1;break;default:this.bucketSizeMinutes=this.chart.granularityToMinutes(e)}},M$.prototype.flattenDateAndRemoveOneBucket=function(e){var t;switch(this.chart.model.get("granularity")){case"OneDay":case"OneWeek":(t=new Date(e)).setDate(e.getDate()-this.bucketSizeDays),t.setHours(0,0,0,0);break;case"OneMonth":t=new Date(e),t=new Date(t.setMonth(e.getMonth()-this.bucketSizeMonths));break;case"Tick":t=new Date(e),t=new Date(t.setSeconds(e.getSeconds()-this.bucketSizeSeconds));break;default:(t=new Date(e.getTime()-6e4*this.bucketSizeMinutes)).setSeconds(0,0)}return t},M$.prototype.setLastDate=function(e){switch(this.chart.model.get("granularity")){case"OneDay":case"OneWeek":this.lastDate=new Date(e),this.lastDate.setHours(0,0,0,0),this.nowDate=new Date(this.lastDate),this.nowDate.setDate(this.lastDate.getDate()+this.bucketSizeDays),this.nowDate.setHours(0,0,0,0),this.limitDate=new Date(this.nowDate),this.limitDate.setDate(this.nowDate.getDate()+this.bucketSizeDays),this.limitDate.setHours(0,0,0,0);break;case"OneMonth":this.lastDate=new Date(e),this.nowDate=new Date(this.lastDate),this.nowDate=new Date(this.lastDate.setMonth(this.lastDate.getMonth()+this.bucketSizeMonths)),this.limitDate=new Date(this.nowDate),this.limitDate=new Date(this.limitDate.setMonth(this.nowDate.getMonth()+this.bucketSizeMonths));break;case"Tick":this.lastDate=new Date(e),this.nowDate=new Date(this.lastDate.getTime()+1e3*this.bucketSizeSeconds),this.limitDate=new Date(this.nowDate.getTime()+1e3*this.bucketSizeSeconds);break;default:this.lastDate=new Date(e),this.lastDate.setSeconds(0,0),this.nowDate=new Date(this.lastDate.getTime()+6e4*this.bucketSizeMinutes),this.nowDate.setSeconds(0,0),this.limitDate=new Date(this.nowDate.getTime()+6e4*this.bucketSizeMinutes),this.limitDate.setSeconds(0,0)}},M$.prototype.updateLastDate=function(e){var t=new Date(e);switch(this.chart.model.get("granularity")){case"OneDay":case"OneWeek":case"OneMonth":t.setHours(0,0,0,0);break;case"Tick":t.setMilliseconds(0);break;default:t.setSeconds(0,0)}t>this.lastDate&&this.setLastDate(e)},M$);function M$(e){this.pricesQ=[],this.livePrices=[],this.chart=e,this.init()}var Chart=(F_=Backbone.View,__extends(G_,F_),G_.prototype.addDefaultIndicator=function(e){return this.indicatorsManager.addDefaultIndicator(e)},G_.prototype.addDefaultIndicatorDiscrete=function(e){return this.indicatorsManager.addDefaultIndicatorDiscrete(e)},G_.prototype.addIndicatorDiscrete=function(e,t){return this.indicatorsManager.addIndicatorDiscrete(e,t)},G_.prototype.addIndicators=function(e){var n=this;_.each(e,function(e){for(var t=[],i=[],a=0;a<e.discreteIndicators.length;a+=1)e.discreteIndicators[a].color&&(t[a]=e.discreteIndicators[a].color),e.discreteIndicators[a].lineThickness&&(i[a]=e.discreteIndicators[a].lineThickness);n.indicatorsManager.addIndicator(e.code,e.parameters,t,i)})},G_.prototype.addLevel=function(e,t){this.mainChartArea.annotationsManager.addLevel(e,t)},G_.prototype.addStockSeries=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=null);var a,n=[],o=new ChartSeries,e=(o.symbol=t.symbol,o.displayName=t.displaySymbol,o.canUserEdit=e,o.isToolbarVisible=!1,$(t.eodData).each(function(e){a=new ChartSeriesElement({open:t.eodData[e].Open,high:t.eodData[e].High,low:t.eodData[e].Low,close:t.eodData[e].Close,value:t.eodData[e].Close,quoteDate:t.eodData[e].Date,volume:t.eodData[e].Volume,letter:t.eodData[e].Letter,dateTag:t.eodData[e].DateTag}),n.push(a)}),new ChartDisplaySeries({elements:_.toArray(n),displayType:this.model.get("stockDisplayType"),displayName:t.displaySymbol,displayColor:i}));return o.addDisplaySeries(e),this.mainChartArea.addSeries(o),o},G_.prototype.applyChartAreaEvents=function(e){var i=this,t=$(e);this.$resizeIndicatorInteraction.on("mousemove",function(e){return i.onChartAreaResizeMouseMove(e)}),this.$resizeIndicatorInteraction.on("mouseup",function(){return i.onChartAreaResizeMouseUp()}),t.on("interactionmousemove",function(e,t){return i.onChartAreaMouseMove(e,t)}),t.on("interactionmouseleave",function(e,t){return i.onChartAreaMouseLeave(e,t)}),t.on("toolbarResize",function(){return i.onResize()}),t.on("removeChartAreaRequest",function(e){return i.onRemoveChartAreaRequest(e)}),t.on("startResize",function(e,t){return i.onChartAreaStartResize(e,t)}),t.on("moveChart",function(e,t){return i.onMoveChart(e,t)}),t.on("stopResize",function(){return i.onChartAreaStopResize()}),t.on("stopDrawing",function(){return i.stopDrawing(null,e)})},G_.prototype.applyLayout=function(e,t){var i,a,n,o=this.model.get("topMarginPx"),s=this.model.get("leftMarginPx"),r=0,l=0,d=0,c=0,h=0,p=0,u=0,m=e-(this.model.get("leftMarginPx")+this.model.get("rightMarginPx")),g=this.indicatorsManager.getChartAreasToolbarsHeights();this.model.get("isIndicatorsToolbarVisible")&&(this.$indicatorsToolbarDiv.css({width:m}),c=0<(d=this.indicatorsToolbar.getHeight()-this.model.get("topMarginPx"))?d+this.model.get("elementsSpacingPx"):0),this.volumeChartArea&&(h=this.volumeChartArea.toolbarHeight()+this.model.get("volumeChartAreaHeightPx")+this.model.get("elementsSpacingPx")),this.model.get("isInfoAreaVisible")&&(p=this.model.get("infoAreaHeightPx")+this.model.get("elementsSpacingPx")),this.model.get("showTimeSlider")&&(u=this.model.get("rangeSelectorHeightPx")),i=t-(c+this.model.get("topMarginPx")+h+p+u+this.model.get("bottomMarginPx")),this.currentChartAreasHeight=i,a=_.reduce(this.indicatorsManager.indicatorsChartAreas,function(e,t){return e+t.options.percentageHeight*i},0),this.$indicatorsToolbarDiv.css({top:o,left:s,width:m,height:d,"margin-top":-1*this.model.get("topMarginPx")}),this.model.get("isChartDimensionsActive")?(r=t-(c+this.model.get("topMarginPx")+h+p+u+this.model.get("bottomMarginPx")),this.$el.css({height:t+a+this.model.get("topMarginPx"),width:e})):(r=t-(c+this.model.get("topMarginPx")+a+h+p+u+this.model.get("bottomMarginPx")),this.$el.css({width:""})),this.$mainChartAreaDiv.css({top:o+c,left:s,width:m,height:r}),this.mainChartArea.onResize(),this.$resizeIndicatorInteraction.css({top:o+c,left:0,bottom:0,right:0}),this.$indicatorsChartAreaDiv.css({top:o+c+r,left:s,width:m,height:a}),l=0,_.each(_.sortBy(this.indicatorsManager.indicatorsChartAreas,function(e){return e.allSeries[0].get("displayIndex")}),function(e){var t=e.options.percentageHeight*i;$(e.el).css({top:l,left:0,width:m,height:t+g}),l+=t+g,e.onResize()}),this.$volumeChartAreaDiv.css({top:o+c+r+a,left:s}),n=this.model.get("showTimeSlider")?(n=this.model.get("mainChartAreaIsLeftAxisVisible")?m-this.model.get("leftAxisWidthPx"):m,this.model.get("mainChartAreaIsRightAxisVisible")?n:n-this.model.get("rightAxisWidthPx")):m-(this.model.get("rightAxisWidthPx")-2),this.$rangeSelectorDiv.css({top:o+c+r+a+h,left:s,width:n,height:u}),this.rangeSelector&&this.rangeSelector.onResize(),this.$infoAreaDiv.css({top:o+c+r+a+h+u+this.model.get("elementsSpacingPx"),left:s,width:m,height:this.model.get("infoAreaHeightPx")})},G_.prototype.applyTemplate=function(){$(this.el).html(T.Chart()),this.$mainChartAreaDiv=this.$el.find(".MainChartAreaDiv"),this.$indicatorsChartAreaDiv=this.$el.find(".IndicatorsChartAreaDiv"),this.$volumeChartAreaDiv=this.$el.find(".VolumeChartAreaDiv"),this.$rangeSelectorDiv=this.$el.find(".RangeSelectorDiv"),this.$indicatorsToolbarDiv=this.$el.find(".IndicatorsToolbarDiv"),this.$infoAreaDiv=this.$el.find(".InfoAreaDiv"),this.$resizeIndicatorInteraction=this.$el.find(".resize-indicator-interaction"),this.model.get("isInfoAreaVisible")||this.$infoAreaDiv.css("display","none"),this.mainChartArea=new ChartArea({el:this.$mainChartAreaDiv,model:this.model,prefix:"mainChartArea",showLastValue:!0,drawingLocked:!0,isLiveElementEnabled:!0}),this.chartAreas.push(this.mainChartArea),this.indicatorsManager=new IndicatorsManager(this,this.mainChartArea,this.mainChartArea.displayArea),this.dynamicPricesManager=new DynamicPricesManager(this),this.model.get("showTimeSlider")?this.rangeSelector=new TimeSlider({el:this.$rangeSelectorDiv,model:this.model}):this.$rangeSelectorDiv.css({"border-bottom":"1px solid "+this.model.get("chartBorderColor")}),this.infoBorder=new InfoBorder({el:this.$el.find(".InfoBorderDiv"),dragParent:this,model:this.model}),this.indicatorsToolbar=new IndicatorsToolbar({el:this.$indicatorsToolbarDiv,indicatorsManager:this.indicatorsManager,model:this.model})},G_.prototype.beforeStockLoad=function(e){(this.pendingIndicators&&this.pendingIndicators.length<=0||!this.pendingIndicators)&&(this.pendingIndicators=this.indicatorsManager.indicators),this.isOperationInProgress=!0,this.clear(!e,!1),this.onResize(!0),this.mainChartArea.displayArea.applyLayout()},G_.prototype.clear=function(e,t){this.firstClear?this.firstClear=!1:($(this.el).hide(),0<this.mainChartArea.allSeries.length&&this.mainChartArea.allSeries[0].displaySeries[0].clearLiveElement(),this.mainChartArea.clearSeries(),this.lastFromIndex=null,this.lastToIndex=null,this.mainChartArea.setChartName(""),e&&(this.model.set({fromDateDisplay:this.model.get("fromDateDisplayVS")||null,toDateDisplay:this.model.get("toDateDisplayVS")||null},{silent:!0}),this.model.set({autoZoomY:!0,maxValueY:null,minValueY:null,zoomYLevel:0})),t?this.clearIndicators():this.clearIndicators(!0),this.livePrices=[],this.model.set({livePricesOn:!1,wasFirst:!1},{silent:!0}),this.dynamicPricesManager&&this.dynamicPricesManager.clear())},G_.prototype.clearAnnotations=function(){_.each(this.chartAreas,function(e){e.annotationsManager.clearAnnotations()})},G_.prototype.clearAnnotationsForced=function(){_.each(this.chartAreas,function(e){e.annotationsManager.clearAnnotationsForced()})},G_.prototype.clearIndicators=function(e){this.indicatorsManager.clear(e=void 0===e?!1:e)},G_.prototype.display=function(e,t){void 0===t&&(t=!1);var i,a=_.map(this.mainChartArea.allSeries[0].displaySeries[0].get("elements"),function(e){return e.get("quoteDate").getTime()}),n=this.model.get("fromDateDisplay").getTime(),o=_.sortedIndexOf(a,n),s=(-1===o&&(_.find(a,function(e,t){return n<=e&&(o=t,!0)}),-1===o&&(o=0)),this.model.get("toDateDisplay").getTime());if(-1===(i=this.model.get("pinLastDataPoint")?a.length-1:_.sortedIndexOf(a,s))){for(var r=a.length-1;0<=r;--r)if(a[r]>=n){i=r;break}-1===i&&(i=a.length-1)}this.displayIndexes(e,o,i,t)},G_.prototype.displayIndexes=function(e,i,a,t){var n;void 0===t&&(t=!1),-1!==i&&-1!==a&&(e||t||this.lastFromIndex!==i||this.lastToIndex!==a)&&(this.lastFromIndex=i,this.lastToIndex=a,e=this.mainChartArea.displayArea.allDates[i],n=this.mainChartArea.displayArea.allDates[a],this.model.set({fromDateDisplay:e,toDateDisplay:n},{silent:!0}),this.model.set({fromDateDisplayVS:e,toDateDisplayVS:n}),t||this.mainChartArea.display(i,a),$(this.indicatorsManager.indicatorsChartAreas).each(function(e,t){t.clearCrosshair(),t.display(i,a)})),this.isStockLoaded=!0},G_.prototype.displayRange=function(e,t,i){for(var a,n,o,s;e<this.mainChartArea.displayArea.allDates[0]&&this.moveIntoPast(null,null););for(s=this.mainChartArea.displayArea.allDates.length,o=0;o<s;o+=1)if(e<=this.mainChartArea.displayArea.allDates[o]){a=o;break}for(o=--s;0<=o;--o)if(t>=this.mainChartArea.displayArea.allDates[o]){n=o;break}this.displayIndexes(i,a,n),this.rangeSelector&&this.rangeSelector.resetSlider(this.lastFromIndex,this.lastToIndex,this.mainChartArea.displayArea.allSeries[0].get("elements").length,null)},G_.prototype.getFromDate=function(){return this.model.get("fromDate")},G_.prototype.getNextDate=function(e,t){var i;switch(t){case"Tick":i=new Date(e.getTime()+1e3);break;case"OneMinute":i=new Date(e.getTime()+6e4);break;case"TwoMinute":i=new Date(e.getTime()+12e4);break;case"ThreeMinute":i=new Date(e.getTime()+18e4);break;case"FiveMinute":i=new Date(e.getTime()+3e5);break;case"FifteenMinute":i=new Date(e.getTime()+9e5);break;case"ThirtyMinute":i=new Date(e.getTime()+18e5);break;case"SixtyMinute":i=new Date(e.getTime()+36e5);break;case"FourHour":i=new Date(e.getTime()+144e5);break;case"OneDay":(i=new Date(e)).setDate(e.getDate()+1);break;case"OneWeek":(i=new Date(e)).setDate(e.getDate()+7);break;case"OneMonth":i=new Date(e),i=new Date(i.setMonth(e.getMonth()+1));break;default:throw"granulatiry not suported"}return i},G_.prototype.getStockSymbol=function(){return this.model.get("stockSymbol")},G_.prototype.getToDate=function(){return this.model.get("toDate")},G_.prototype.granularityToMinutes=function(e){var t;switch(e){case"Tick":t=0;break;case"OneMinute":t=1;break;case"TwoMinute":t=2;break;case"ThreeMinute":t=3;break;case"FiveMinute":t=5;break;case"FifteenMinute":t=15;break;case"ThirtyMinute":t=30;break;case"SixtyMinute":t=60;break;case"FourHour":t=240;break;default:t=null}return t},G_.prototype.initialize2=function(e){this.options=e,this.isStockLoaded=!1,this.isOperationInProgress=!1,this.stockDataProvider=new StockDataProvider({model:this.model}),this.firstClear=!0,this.chartAreas=[],this.livePrices=[],this.isAddingLivePrice=!1,this.lastDrawChartAreas=[],this.undoneChartAreas=[],this.applyTemplate(),this.initializeEvents(),this.onResize(),$(this.el).hide()},G_.prototype.initializeIndicators=function(){var e=this,t=this.model.get("saved_indicators");t&&t===this.model.get("indicators")||(this.clearIndicators(),t&&_.defer(function(){e.addIndicators(JSON.parse(t))}))},G_.prototype.initializeEvents=function(){var i=this,e=$(this.stockDataProvider),t=$(this.indicatorsToolbar),a=$(this.mainChartArea);e.on("stockPartDownloaded",function(e,t){return i.onStockPartDownloaded(e,t)}),e.on("firstextradatadownloaded",function(e){return i.moveIntoPast(e,null)}),e.on("perioddownloaded",function(e,t){return i.onPeriodDownloaded(e,t)}),e.on("periodenabled",function(e,t){$(i).trigger(e,t)}),e.on("historicalPricesUpdate",function(e){return i.onHistoricalPricesUpdate(e)}),this.rangeSelector&&((e=$(this.rangeSelector)).on("dateschanged",function(e){return i.onDatesChanged(e)}),e.on("sliderSlide",function(e,t){return i.onSliderSlide(e,t)})),t.on("toolbarresize",function(){i.applyLayout(i.lastWidth,i.lastHeight)}),t.on("display-indexes-updated",function(){return i.onDisplayIndexesUpdated()}),t.on("series-removed",function(e){return i.onSeriesRemoved(e)}),this.applyChartAreaEvents(this.mainChartArea),this.listenTo(this.model,"change:stockDisplayType",function(){return i.onModelChangeStockDisplayType()}),this.listenTo(this.model,"change:displayPeriod",function(){return i.onModelChangeDisplayPeriod()}),this.listenTo(this.model,"change:indicators",function(){return i.onModelChangeIndicators()}),this.listenTo(this.model,"change:customChartName",function(){return i.onModelChangeCustomChartName()}),this.listenTo(this.model,"change:rightAxisWidthPx",function(){i.onResize(!0)}),this.listenTo(this.model,"change:chartBorderColor",function(){return i.onModelChangeChartBorderColor()}),this.listenTo(this.model,"change:showTimeSlider",function(){return i.onModelChangeShowTimeSlider()}),this.listenTo(this.model,"change:isChartDimensionsActive change:chartDimensionsWidthPx change:chartDimensionsHeightPx",function(){return i.onModelChangeChartDimensions()}),a.on("zoom",function(e,t){return i.onZoom(e,t)}),a.on("priceRangeChanged",function(e){$(this).trigger(e)}),a.on("datesRangeChanged",function(e,t){i.onDatesRangeChanged(t)}),a.on("pattern-selected-on-chart",function(e){$(i).trigger(e)}),a.on("chart-rendered",function(){i.chartRendered=!0,$(i).trigger("chart-rendered")}),this.listenTo(this.model,"change:showVolume",function(e,t){return i.onShowVolumeChanged(e,t)}),$(this).one("chart-rendered",function(){this.indicatorObj=this.model.get("saved_indicators"),this.initializeIndicators()}),this.listenTo(this.model,"change:saved_indicators",function(){return i.initializeIndicators()})},G_.prototype.loadStock=function(e){this.model.set({stockSymbol:e})},G_.prototype.moveIntoPast=function(e,t){var i=this.stockDataProvider.getNextPeriod(),a=!!(i&&0<i.length)&&(a=_.map(i,function(e){return new ChartSeriesElement({open:e.Open,high:e.High,low:e.Low,close:e.Close,value:e.Close,quoteDate:e.Date,volume:e.Volume,letter:e.Letter,dateTag:e.DateTag})}),this.mainChartArea.allSeries[0].displaySeries[0].addSeriesElementsInFront(a),this.lastFromIndex+=a.length,this.lastToIndex+=a.length,this.mainChartArea.displayArea.displayFromIndex=this.lastFromIndex,this.mainChartArea.displayArea.displayToIndex=this.lastToIndex,this.model.set({fromDate:i[0].Date},{silent:!0}),this.mainChartArea.displayArea.refreshDates(),this.rangeSelector&&this.rangeSelector.resetSlider(this.lastFromIndex,this.lastToIndex,this.mainChartArea.allSeries[0].displaySeries[0].get("elements").length,this.model.get("showSliderDates")?this.mainChartArea.calculateDisplayDates2(0,this.mainChartArea.displayArea.allDates.length-1,this.rangeSelector.datesWidth()):null),(!t||t.dontMoveIntoPast)&&t||this.recalculateIndicators(),!0);return a},G_.prototype.moveIntoTheFuture=function(e,t){void 0===t&&(t=null);var i,a=[];if(!(e<=0)){for(var n=this.mainChartArea.allSeries[0].displaySeries[0].get("elements"),n=n[n.length-1].get("quoteDate"),o=new Date(n),s=0;s<e;s+=1)o=t||this.getNextDate(o,this.model.get("granularity")),a.push(new ChartSeriesElement({isFake:!0,quoteDate:o,dateTag:Helpers.getDateTag(o,i)})),i=o;this.mainChartArea.allSeries[0].displaySeries[0].addSeriesElementsInEnd(_.toArray(a)),this.lastFromIndex+=a.length,this.lastToIndex+=a.length,this.indicatorsManager.addElementsInEnd(a),this.model.set({toDate:o},{silent:!0}),this.mainChartArea.displayArea.refreshDates(),this.rangeSelector&&this.rangeSelector.resetSlider(this.lastFromIndex,this.lastToIndex,this.mainChartArea.allSeries[0].displaySeries[0].get("elements").length,this.model.get("showSliderDates")?this.mainChartArea.calculateDisplayDates2(0,this.mainChartArea.displayArea.allDates.length-1,this.rangeSelector.datesWidth()):null),this.displayIndexes(!0,this.lastFromIndex,this.lastToIndex)}},G_.prototype.onDatesChanged=function(e){this.model.set({fromDateDisplay:this.mainChartArea.allSeries[0].displaySeries[0].get("elements")[e.fromIndex].get("quoteDate"),toDateDisplay:this.mainChartArea.allSeries[0].displaySeries[0].get("elements")[e.toIndex].get("quoteDate")})},G_.prototype.onChartAreaMouseLeave=function(e,t){for(var i=0,a=this.chartAreas.length,i=0;i<a;i+=1)this.chartAreas[i]!==t.eventSource&&(this.chartAreas[i].handleMouseLeave(t.eventArgs),this.chartAreas[i].clearCrosshair());clearTimeout(this.priceInfoTimer)},G_.prototype.onChartAreaMouseMove=function(e,t){var i,a,n,o,s=this;for(this.lastMouseIndex=t.mouseIndex,i=0;i<this.chartAreas.length;i+=1)this.chartAreas[i]!==t.sourceChartArea&&(this.chartAreas[i].clearSelectedDates(),this.chartAreas[i].clearSelectedValue(),this.chartAreas[i].clearCrosshair(),this.chartAreas[i].drawCrosshair(t.pageX,t.pageY,t.mouseItem,!0),this.chartAreas[i].refreshSelectedPriceAndDate(t.pageX,t.pageY,t.mouseIndex));a=t.liveItem||this.mainChartArea.displayArea.allSeries[0].get("elements")[t.mouseIndex],this.model.get("showInfoBorder")&&this.updateBottomInfoBar(a),o="dd/mm/yy HH:MM","OneDay"!==this.model.get("granularity")&&"OneWeek"!==this.model.get("granularity")&&"OneMonth"!==this.model.get("granularity")||(o="dd/mm/yy"),this.model.get("showInfoBorder")&&(n=this.model.get("mainChartAreaValuesAxisDecimalPlaces"),this.infoBorder.setValues(a,n,o),this.infoBorder.setIndicatorsValues(this.indicatorsManager.getIndicaotrsInfo(t.mouseIndex),n),!this.model.get("isInfoBorderInCursorMode")||this.oldPageX===t.pageX&&this.oldPageY===t.pageY||(this.oldPageX=t.pageX,this.oldPageY=t.pageY,this.infoBorder.onPause(!1),clearTimeout(this.priceInfoTimer),this.priceInfoTimer=setTimeout(function(){s.infoBorder.onPause(!0)},1e3)))},G_.prototype.onChartAreaResizeMouseMove=function(e){var t;this.resizeStart&&(t=this.resizeStart.source.$el.height()+(this.resizeStart.pageY-e.pageY),e.bubbles&&this.resizeStart.pageY-e.pageY!=0&&(this.resizeStart.pageY=e.pageY,this.resizeStart.source.options.percentageHeight=t/this.currentChartAreasHeight,this.onResize(!0)))},G_.prototype.onChartAreaResizeMouseUp=function(){this.$resizeIndicatorInteraction.hide(),this.resizeStart=null},G_.prototype.onChartAreaStartResize=function(e,t){this.$resizeIndicatorInteraction.show(),this.resizeStart=t},G_.prototype.onChartAreaStopResize=function(){this.resizeStart=null},G_.prototype.onDatesRangeChanged=function(e){e.indictors=this.indicatorsManager.getIndicaotrsDiscrete(),$(this).trigger("datesRangeChanged",e)},G_.prototype.onDisplayIndexesUpdated=function(){this.lastMouseIndex&&this.model.get("showInfoBorder")&&this.infoBorder.setIndicatorsValues(this.indicatorsManager.getIndicaotrsInfo(this.lastMouseIndex),this.model.get("mainChartAreaValuesAxisDecimalPlaces")),this.onResize()},G_.prototype.onHistoricalPricesUpdate=function(e){this.dynamicPricesManager&&this.dynamicPricesManager.pushHistoricalPrice(e)},G_.prototype.onModelChangeChartBorderColor=function(){this.model.get("showTimeSlider")||this.$rangeSelectorDiv.css({"border-bottom":"1px solid "+this.model.get("chartBorderColor")})},G_.prototype.onModelChangeChartDimensions=function(){$(this).trigger("appresize")},G_.prototype.onModelChangeCustomChartName=function(){this.mainChartArea.setChartName(this.model.get("customChartName"))},G_.prototype.onModelChangeDisplayPeriod=function(){var e,t,i=this.model.get("displayPeriod");if(!this.isOperationInProgress){for(;!this.stockDataProvider.isPeriodLoaded(i);)this.moveIntoPast(null,null);e=this.stockDataProvider.getLoadedBaseIndex(),e=this.stockDataProvider.getPeriodInfo(i).firstIndex-e,t=this.mainChartArea.displayArea.allDates.length-1,this.displayIndexes(!1,e,t),this.rangeSelector&&this.rangeSelector.resetSlider(this.lastFromIndex,this.lastToIndex,this.mainChartArea.displayArea.allSeries[0].get("elements").length,null)}},G_.prototype.onModelChangeIndicators=function(){this.indicatorObj?this.model.get("indicators")===this.indicatorObj&&(this.indicatorObj=null,this.indicatorsManager.savedIndicatorsInitialized=!0):this.model.set("saved_indicators",this.model.get("indicators"))},G_.prototype.onModelChangeShowTimeSlider=function(){this.model.get("showTimeSlider")?(this.rangeSelector.$el.children().first().show(),this.$rangeSelectorDiv.css({"border-bottom":"1px solid transparent"})):(this.rangeSelector.$el.children().first().hide(),this.$rangeSelectorDiv.css({"border-bottom":"1px solid "+this.model.get("chartBorderColor")}))},G_.prototype.onModelChangeStockDisplayType=function(){this.model.get("stockSymbol")&&(this.mainChartArea.allSeries[0].displaySeries[0].set({displayType:this.model.get("stockDisplayType")}),this.mainChartArea.displayCurrent())},G_.prototype.onMoveChart=function(e,t){var i,a,n=t.step;this.moving||("right"===t.direction?(this.lastFromIndex<t.step&&(t.step=this.lastFromIndex),0<t.step?(this.displayIndexes(!1,this.lastFromIndex-t.step,this.lastToIndex-t.step),this.rangeSelector&&this.rangeSelector.resetSlider(this.lastFromIndex,this.lastToIndex,this.mainChartArea.allSeries[0].displaySeries[0].get("elements").length,null)):0<n&&this.moveIntoPast(null,null)):"left"===t.direction?(this.lastToIndex+t.step>=this.mainChartArea.displayArea.allSeries[0].get("elements").length&&(t.step=this.mainChartArea.displayArea.allSeries[0].get("elements").length-(this.lastToIndex+1)),0<t.step?(this.displayIndexes(!1,this.lastFromIndex+t.step,this.lastToIndex+t.step),this.rangeSelector&&this.rangeSelector.resetSlider(this.lastFromIndex,this.lastToIndex,this.mainChartArea.allSeries[0].displaySeries[0].get("elements").length,null)):0<n&&this.moveIntoTheFuture(n)):"zoom-in"===t.direction?(i=(i=this.lastFromIndex+Math.round(t.step*t.leftRatio))<0?0:i)<=(a=(a=this.lastToIndex-Math.round(t.step*t.rightRatio))>=this.mainChartArea.displayArea.allSeries[0].get("elements").length?this.mainChartArea.displayArea.allSeries[0].get("elements").length-1:a)&&7<a-i&&(this.displayIndexes(!1,i,a),this.rangeSelector&&this.rangeSelector.resetSlider(this.lastFromIndex,this.lastToIndex,this.mainChartArea.allSeries[0].displaySeries[0].get("elements").length,null)):"zoom-out"===t.direction&&((i=this.lastFromIndex-Math.round(t.step*t.leftRatio))<0&&(i=0),(a=this.lastToIndex+Math.round(t.step*t.rightRatio))>=this.mainChartArea.displayArea.allSeries[0].get("elements").length&&(a=this.mainChartArea.displayArea.allSeries[0].get("elements").length-1),this.displayIndexes(!1,i,a),this.rangeSelector&&this.rangeSelector.resetSlider(this.lastFromIndex,this.lastToIndex,this.mainChartArea.allSeries[0].displaySeries[0].get("elements").length,null)))},G_.prototype.onPeriodDownloaded=function(e,t){var i=this;t.reloadIndicators&&(t.reloadIndicators&&0<this.pendingIndicators.length?(_.each(this.pendingIndicators,function(e){i.indicatorsManager.addIndicator(e.code,e.parameters,_.map(e.discreteIndicators,function(e){return e.color}),_.map(e.discreteIndicators,function(e){return e.lineThickness}))}),this.pendingIndicators=[],this.pendingLivePriceRefresh&&(this.mainChartArea.displayArea.drawingLocked=!1,this.dynamicPricesManager.onPrice(),this.pendingLivePriceRefresh=!1)):this.pendingLivePriceRefresh?(this.mainChartArea.displayArea.drawingLocked=!1,this.dynamicPricesManager.onPrice(),this.pendingLivePriceRefresh=!1):_.defer(function(){i.mainChartArea.displayArea.drawingLocked=!1,i.mainChartArea.onResize(),i.mainChartArea.display(i.lastFromIndex,i.lastToIndex)}),$(this).trigger(t))},G_.prototype.onReloadChart=function(){var e=_.groupBy(this.indicatorsManager.indicators,function(e){return e.isStock?"stock":"indicators"});this.indicatorsManager.clear(),this.addIndicators(e.indicators)},G_.prototype.onRemoveChartAreaRequest=function(e){this.chartAreas=_.without(this.chartAreas,e.chartArea),this.onResize()},G_.prototype.onResetChart=function(){this.model.set({autoZoomY:!0,zoomYLevel:0},{silent:!0}),this.removeFutureElements(),this.onModelChangeDisplayPeriod()},G_.prototype.onResize=function(e){void 0===e&&(e=!1);var t=$(this.el).width(),i=$(this.el).height();this.model.get("isChartDimensionsActive")?(t=this.model.get("chartDimensionsWidthPx")||$(this.el).width(),i=this.model.get("chartDimensionsHeightPx")||this.model.get("chartDimensionsWidthPx")*this.model.get("chartDimensionsHeightPercent")||$(this.el).height()):(this.model.set("chartDimensionsWidthPx",$(this.el).width()),this.model.set("chartDimensionsHeightPx",$(this.el).height())),!e&&this.lastHeight===i&&this.lastWidth===t||(this.lastWidth=t,this.lastHeight=i,this.applyLayout(t,i),$(this).trigger("resized"))},G_.prototype.onSeriesRemoved=function(e){e=e.series.series;this.mainChartArea.removeSeries(e)},G_.prototype.onShowVolumeChanged=function(e,t){var i=this;t?this.chartRendered?this.volumeIndicator=this.indicatorsManager.addDefaultIndicator2("vol"):$(this).one("chart-rendered",function(){_.defer(function(){i.volumeIndicator=i.indicatorsManager.addDefaultIndicator2("vol")})}):this.volumeIndicator&&(this.indicatorsManager.removeIndicatorByObjectID(this.volumeIndicator),this.volumeIndicator=null)},G_.prototype.onSliderSlide=function(e,t){this.displayIndexes(!1,t.fromIndex,t.toIndex)},G_.prototype.onStartZoom=function(){this.mainChartArea.isZoomingEnabled=!0},G_.prototype.onStopZoom=function(){this.mainChartArea.isZoomingEnabled=!1},G_.prototype.onStockPartDownloaded=function(e,t){var i;_.some(this.mainChartArea.allSeries,function(e){return e.symbol===t.stock.symbol})||($(this.el).show(),this.dynamicPricesManager.updateBucketSize(),this.setChartName(),this.model.set({fromDate:t.stock.eodData[0].Date,toDate:t.stock.eodData[t.stock.eodData.length-1].Date},{silent:!0}),this.addStockSeries(t.stock),(!this.model.get("fromDateDisplay")||this.model.get("fromDateDisplay")<this.model.get("fromDate"))&&this.model.set({fromDateDisplay:this.model.get("fromDate")},{silent:!0}),(!this.model.get("toDateDisplay")||this.model.get("toDateDisplay")>this.model.get("toDate"))&&this.model.set({toDateDisplay:this.model.get("toDate")},{silent:!0}),this.display(!1,!0),this.onResize(),this.rangeSelector&&this.rangeSelector.resetSlider(this.lastFromIndex,this.lastToIndex,this.mainChartArea.allSeries[0].displaySeries[0].get("elements").length,this.model.get("showSliderDates")?this.mainChartArea.calculateDisplayDates2(0,this.mainChartArea.displayArea.allDates.length-1,this.rangeSelector.datesWidth()):null),this.isOperationInProgress=!1,t.isLastDataPointOpen?this.dynamicPricesManager&&("Tick"===this.model.get("granularity")?this.dynamicPricesManager.pushLivePrice({bid:i.Close,offer:i.Close,printedAt:i.Date,isFast:!0,real:i.Close,marketId:this.model.get("stockSymbol")}):(this.dynamicPricesManager.pushLivePrice({bid:i.Open,offer:i.Open,printedAt:i.Date,isFast:!0,real:i.Open,marketId:this.model.get("stockSymbol")},!0),this.dynamicPricesManager.pushLivePrice({bid:i.High,offer:i.High,printedAt:i.Date,isFast:!0,real:i.High,marketId:this.model.get("stockSymbol")},!0),this.dynamicPricesManager.pushLivePrice({bid:i.Low,offer:i.Low,printedAt:i.Date,isFast:!0,real:i.Low,marketId:this.model.get("stockSymbol")},!0),this.dynamicPricesManager.pushLivePrice({bid:i.Close,offer:i.Close,printedAt:i.Date,isFast:!0,real:i.Close,marketId:this.model.get("stockSymbol")},!this.firstClear),this.pendingLivePriceRefresh=!0)):this.pendingLivePriceRefresh=!1,this.isLivePriceInit=!1,this.model.set("init-data-loaded",!0),$(this).trigger("initial-data-loaded"))},G_.prototype.onZoom=function(e,t){this.initialDisplayToIndex||(this.initialDisplayFromIndex=this.lastFromIndex,this.initialDisplayToIndex=this.lastToIndex),this.displayIndexes(!1,t.fromIndex,t.toIndex),this.rangeSelector&&this.rangeSelector.resetSlider(this.lastFromIndex,this.lastToIndex,this.mainChartArea.displayArea.allSeries[0].get("elements").length,null),this.mainChartArea.isZoomingEnabled=!1,$(this).trigger("zoomstop")},G_.prototype.recalculateIndicators=function(e){this.indicatorsManager.recalculateIndicators(e=void 0===e?null:e)},G_.prototype.redoAnnotations=function(){var e=this.undoneChartAreas.pop();e&&(this.lastDrawChartAreas.push(e),e.redoAnnotations())},G_.prototype.removeFutureElements=function(){var e,t=this,i=this.mainChartArea.allSeries[0].displaySeries[0].removeFakeElements(this.isLivePriceInit);for(this.lastFromIndex-=i,this.lastToIndex-=i,this.mainChartArea.displayArea.displayFromIndex=this.lastFromIndex,this.mainChartArea.displayArea.displayToIndex=this.lastToIndex,this.mainChartArea.displayArea.refreshDates(),e=1;e<this.mainChartArea.allSeries.length;e++)_.forEach(this.mainChartArea.allSeries[e].displaySeries,function(e){e.removeFakeElements(t.isLivePriceInit)});_.forEach(this.indicatorsManager.indicatorsChartAreas,function(e){_.forEach(e.allSeries,function(e){_.forEach(e.displaySeries,function(e){e.removeFakeElements(t.isLivePriceInit)})}),e.displayArea.displayFromIndex=t.lastFromIndex,e.displayArea.displayToIndex=t.lastToIndex,e.displayArea.refreshDates()}),this.rangeSelector&&this.rangeSelector.resetSlider(this.lastFromIndex,this.lastToIndex,this.mainChartArea.allSeries[0].displaySeries[0].get("elements").length,this.model.get("showSliderDates")?this.mainChartArea.calculateDisplayDates2(0,this.mainChartArea.displayArea.allDates.length-1,this.rangeSelector.datesWidth()):null),this.displayIndexes(!0,this.lastFromIndex,this.lastToIndex)},G_.prototype.removeIndicator=function(e){this.indicatorsManager.removeIndicator(e)},G_.prototype.removeIndicatorByObjectID=function(e){this.indicatorsManager.removeIndicatorByObjectID(e)},G_.prototype.setChartName=function(){var e;this.model.get("showMainChartName")?this.model.get("customChartName")&&this.model.get("customChartName")?this.mainChartArea.setChartName(this.model.get("customChartName")):this.model.get("showGranularityAsChartName")?(e=_.find(this.model.get("viewOptions"),{value:this.model.get("granularity")}),this.mainChartArea.setChartName(e.displayName)):this.model.get("stockPickerSymbol")&&this.mainChartArea.setChartName(this.model.get("stockPickerSymbol").name):this.mainChartArea.setChartName("")},G_.prototype.setLivePrice=function(e){this.dynamicPricesManager&&(this.model.set({lastBid:e.bid,lastOffer:e.offer,lastAvgPrice:(e.bid+e.offer)/2}),this.dynamicPricesManager.pushLivePrice(e))},G_.prototype.setPricesRange=function(e,t){e&&t?(this.model.set({autoZoomY:!1},{silent:!0}),this.mainChartArea.displayArea.staticRealMaxPts=null,this.mainChartArea.displayArea.staticRealMinPts=null,this.mainChartArea.displayArea.staticPtsPrice=null,this.mainChartArea.displayArea.staticRealMax=t,this.mainChartArea.displayArea.staticRealMin=e):(this.model.set({autoZoomY:!0},{silent:!0}),this.mainChartArea.displayArea.staticRealMax=null,this.mainChartArea.displayArea.staticRealMin=null),this.display(!0)},G_.prototype.setPricesRangePts=function(e,t,i,a){null===e||null===t?(this.model.set({autoZoomY:!0},{silent:!0}),this.mainChartArea.displayArea.staticRealMaxPts=null,this.mainChartArea.displayArea.staticRealMinPts=null,this.mainChartArea.displayArea.staticPtsPrice=null):(this.model.set({autoZoomY:!1},{silent:!0}),this.mainChartArea.displayArea.staticRealMax=null,this.mainChartArea.displayArea.staticRealMin=null,this.mainChartArea.displayArea.staticRealMaxPts=e,this.mainChartArea.displayArea.staticRealMinPts=t,this.mainChartArea.displayArea.staticPtsPrice=i),a&&this.display(!0)},G_.prototype.startDrawing=function(t){_.each(this.chartAreas,function(e){e.annotationsManager.startDrawing(t)}),this.chartToolbar.addActiveMenuItem(this.chartToolbar.drawButton)},G_.prototype.stopDrawing=function(e,t){_.each(this.chartAreas,function(e){e.annotationsManager.stopDrawing()}),this.lastDrawChartAreas.push(t),this.chartToolbar.removeActiveMenuItem(this.chartToolbar.drawButton)},G_.prototype.toggleSaveLayout=function(){this.$el.removeClass("save-mode"),this.onResize(!0)},G_.prototype.undoAnnotations=function(){var e=this.lastDrawChartAreas.pop();e&&(this.undoneChartAreas.push(e),e.undoAnnotations())},G_.prototype.updateBottomInfoBar=function(e){var t,i=this.model.get("mainChartAreaValuesAxisDecimalPlaces");e&&(this.$infoAreaDiv.find("#dateInfo").html(e.get("quoteDate").format("dd/mm/yy HH:MM")),e.get("isFake")||((t=e.get("open"))&&this.$infoAreaDiv.find("#openInfo").html(t.toFixed(i)),(t=e.get("high"))&&this.$infoAreaDiv.find("#highInfo").html(t.toFixed(i)),(t=e.get("low"))&&this.$infoAreaDiv.find("#lowInfo").html(t.toFixed(i)),(t=e.get("close"))&&this.$infoAreaDiv.find("#closeInfo").html(t.toFixed(i))))},G_.prototype.updateIndicatorByObjectID=function(e,t){this.indicatorsManager.updateIndicatorByObjectID(e,t)},G_),F_,M1a,P1a,Q1a,O1a,R1a,S1a,T1a,U1a,V1a,W1a,s2a,t2a,u2a;function G_(e){var t=F_.call(this,e)||this;return t.extendedAnnotations=[],t.isAddingLivePrice=!1,t.isLivePriceInit=!1,t.isOperationInProgress=!1,t.lastHeight=-1,t.lastWidth=-1,t.resetLivePrice=!1,t.pendingIndicators=[],t.initialize2(e),t}function X1a(e){return W1a(Number(e))}function Y1a(e){return(e=W1a(e))+e+e}function Z1a(e){var t,i;return 10<e.length?(i=1+e.indexOf("("),t=e.indexOf(")"),i=e.substring(i,t).split(","),["#",X1a(i[0]),X1a(i[1]),X1a(i[2])].join("")):e}M1a=jQuery,O1a=0,R1a=[],S1a=["ffffff","000000","eeece1","1f497d","4f81bd","c0504d","9bbb59","8064a2","4bacc6","f79646"],T1a=["f2f2f2","7f7f7f","ddd9c3","c6d9f0","dbe5f1","f2dcdb","ebf1dd","e5e0ec","dbeef3","fdeada","d8d8d8","595959","c4bd97","8db3e2","b8cce4","e5b9b7","d7e3bc","ccc1d9","b7dde8","fbd5b5","bfbfbf","3f3f3f","938953","548dd4","95b3d7","d99694","c3d69b","b2a2c7","92cddc","fac08f","a5a5a5","262626","494429","17365d","366092","953734","76923c","5f497a","31859b","e36c09","7f7f7f","0c0c0c","1d1b10","0f243e","244061","632423","4f6128","3f3151","205867","974806"],U1a=["c00000","ff0000","ffc000","ffff00","92d050","00b050","00b0f0","0070c0","002060","7030a0"],V1a=[["003366","336699","3366cc","003399","000099","0000cc","000066"],["006666","006699","0099cc","0066cc","0033cc","0000ff","3333ff","333399"],["669999","009999","33cccc","00ccff","0099ff","0066ff","3366ff","3333cc","666699"],["339966","00cc99","00ffcc","00ffff","33ccff","3399ff","6699ff","6666ff","6600ff","6600cc"],["339933","00cc66","00ff99","66ffcc","66ffff","66ccff","99ccff","9999ff","9966ff","9933ff","9900ff"],["006600","00cc00","00ff00","66ff99","99ffcc","ccffff","ccccff","cc99ff","cc66ff","cc33ff","cc00ff","9900cc"],["003300","009933","33cc33","66ff66","99ff99","ccffcc","ffffff","ffccff","ff99ff","ff66ff","ff00ff","cc00cc","660066"],["333300","009900","66ff33","99ff66","ccff99","ffffcc","ffcccc","ff99cc","ff66cc","ff33cc","cc0099","993399"],["336600","669900","99ff33","ccff66","ffff99","ffcc99","ff9999","ff6699","ff3399","cc3399","990099"],["666633","99cc00","ccff33","ffff66","ffcc66","ff9966","ff6666","ff0066","d60094","993366"],["a58800","cccc00","ffff00","ffcc00","ff9933","ff6600","ff0033","cc0066","660033"],["996633","cc9900","ff9900","cc6600","ff3300","ff0000","cc0000","990033"],["663300","996600","cc3300","993300","990000","800000","993333"]],W1a=function(e){e=e.toString(16);return e=1==e.length?"0"+e:e},M1a.widget("evol.colorpicker",{version:"2.0",options:{color:null,showOn:"both",displayIndicator:!0,history:!0,strings:"Theme Colors,Standard Colors,More Colors,Less Colors,Back to Palette,History,No history yet."},_create:function(){P1a=M1a.browser.msie&&!jQuery.support.boxModel,Q1a=P1a?"-ie":"",this._paletteIdx=1,this._id="evo-cp"+O1a++,this._enabled=!0;var e,t,i,a=this;"INPUT"===this.element.get(0).tagName?(e=this.options.color,t=this.element,this._isPopup=!0,(this._palette=null)!=e?t.val(e):""!=(i=t.val())&&(e=this.options.color=i),t.addClass("colorPicker "+this._id).wrap('<div style="width:'+(this.element.width()+32)+"px;"+(P1a?"margin-bottom:-21px;":"")+(M1a.browser.mozilla?"padding:1px 0;":"")+'"></div>').after('<div class="evo-colorind'+(M1a.browser.mozilla?"-ff":Q1a)+'" '+(null!=e?'style="background-color:'+e+'"':"")+"></div>").on("keyup onpaste",function(e){var t=M1a(this).val();t!=a.options.color&&a._setValue(t,!0)}),"both"!=(i=this.options.showOn)&&"focus"!=i||t.on("focus",function(){a.showPalette()}),"both"!=i&&"button"!=i||t.next().on("click",function(e){e.stopPropagation(),a.showPalette()})):(this._isPopup=!1,this._palette=this.element.html(this._paletteHTML()).attr("aria-haspopup","true"),this._bindColors()),null!=e&&this.options.history&&this._add2History(e)},_paletteHTML:function(){var e=[],t=this._paletteIdx=Math.abs(this._paletteIdx),i=this.options,a=i.strings.split(",");return e.push('<div class="evo-pop',Q1a,' ui-widget ui-widget-content ui-corner-all"',this._isPopup?' style="position:absolute"':"",">"),e.push("<span>",this["_paletteHTML"+t](),"</span>"),e.push('<div class="evo-more"><a href="javascript:void(0)">',a[1+t],"</a>"),i.history&&e.push('<a href="javascript:void(0)" class="evo-hist">',a[5],"</a>"),e.push("</div>"),i.displayIndicator&&e.push(this._colorIndHTML(this.options.color,"left"),this._colorIndHTML("","right")),e.push("</div>"),e.join("")},_colorIndHTML:function(e,t){var i=[];return i.push('<div class="evo-color" style="float:left"><div style="'),i.push(e?"background-color:"+e:"display:none"),P1a?i.push('" class="evo-colorbox-ie"></div><span class=".evo-colortxt-ie" '):i.push('"></div><span '),i.push(e?">"+e+"</span>":"/>"),i.push("</div>"),i.join("")},_paletteHTML1:function(){var e=[],t=this.options.strings.split(","),i='<td style="background-color:#',a=P1a?'"><div style="width:2px;"></div></td>':'"><span/></td>',n='<tr><th colspan="10" class="ui-widget-content">';e.push('<table class="evo-palette',Q1a,'">',n,t[0],"</th></tr><tr>");for(var o=0;o<10;o++)e.push(i,S1a[o],a);e.push("</tr>"),P1a||e.push('<tr><th colspan="10"></th></tr>'),e.push('<tr class="top">');for(o=0;o<10;o++)e.push(i,T1a[o],a);for(var s=1;s<4;s++){e.push('</tr><tr class="in">');for(o=0;o<10;o++)e.push(i,T1a[10*s+o],a)}e.push('</tr><tr class="bottom">');for(o=40;o<50;o++)e.push(i,T1a[o],a);e.push("</tr>",n,t[1],"</th></tr><tr>");for(o=0;o<10;o++)e.push(i,U1a[o],a);return e.push("</tr></table>"),e.join("")},_paletteHTML2:function(){var e=[],t='<td style="background-color:#',i=P1a?'"><div style="width:5px;"></div></td>':'"><span/></td>',a='<table class="evo-palette2'+Q1a+'"><tr>',n="</tr></table>";e.push('<div class="evo-palcenter">');for(var o=0,s=V1a.length;o<s;o++){e.push(a);for(var r=V1a[o],l=0,d=r.length;l<d;l++)e.push(t,r[l],i);e.push(n)}e.push('<div class="evo-sep"/>');var c=[];e.push(a);for(l=255;10<l;l-=10)e.push(t,Y1a(l),i),c.push(t,Y1a(l-=10),i);return e.push(n,a,c.join(""),n),e.push("</div>"),e.join("")},_switchPalette:function(e){if(this._enabled){var t=this.options.strings.split(",");if(M1a(e).hasClass("evo-hist")){var i=['<table class="evo-palette"><tr><th class="ui-widget-content">',t[5],"</th></tr></tr></table>",'<div class="evo-cHist">'];if(0==R1a.length)i.push("<p>Â ",t[6],"</p>");else for(var a=R1a.length-1;-1<a;a--)i.push('<div style="background-color:',R1a[a],'"></div>');i.push("</div>");var n=-this._paletteIdx,o=i.join(""),s=t[4]}else{o=(this._paletteIdx<0?(n=-this._paletteIdx,this._palette.find(".evo-hist").show()):n=2==this._paletteIdx?1:2,this["_paletteHTML"+n]()),s=t[n+1];this._paletteIdx=n}this._paletteIdx=n;e=this._palette.find(".evo-more").prev().html(o).end().children().eq(0).html(s);n<0&&e.next().hide()}},showPalette:function(){var t,e;return this._enabled&&((e=M1a(".colorPicker").not("."+this._id).colorpicker).hidePalette&&e("hidePalette"),null==this._palette&&(this._palette=this.element.next().after(this._paletteHTML()).next().on("click",function(e){e.stopPropagation()}),this._bindColors(),t=this,M1a(document.body).on("click."+this._id,function(e){e.target!=t.element.get(0)&&t.hidePalette()}))),this},hidePalette:function(){var e;return this._isPopup&&this._palette&&(M1a(document.body).off("click."+this._id),(e=this)._palette.off("mouseover click","td").fadeOut(function(){e._palette.remove(),e._palette=e._cTxt=null}).find(".evo-more a").off("click")),this},_bindColors:function(){var e=this._palette.find("div.evo-color"),t=this.options.history?"td,.evo-cHist div":"td",i=(this._cTxt1=e.eq(0).children().eq(0),this._cTxt2=e.eq(1).children().eq(0),this);this._palette.on("click",t,function(e){var t;i._enabled&&(t=Z1a(M1a(this).attr("style").substring(17)),i._setValue(t))}).on("mouseover",t,function(e){var t;i._enabled&&(t=Z1a(M1a(this).attr("style").substring(17)),i.options.displayIndicator&&i._setColorInd(t,2),i.element.trigger("mouseover.color",t))}).find(".evo-more a").on("click",function(){i._switchPalette(this)})},val:function(e){return void 0===e?this.options.color:(this._setValue(e),this)},_setValue:function(e,t){this.options.color=e,this._isPopup?(t||this.hidePalette(),this.element.val(e).next().attr("style","background-color:"+e)):this._setColorInd(e,1),this.options.history&&0<this._paletteIdx&&this._add2History(e),this.element.trigger("change.color",e)},_setColorInd:function(e,t){this["_cTxt"+t].attr("style","background-color:"+e).next().html(e)},_setOption:function(e,t){"color"==e?this._setValue(t,!0):this.options[e]=t},_add2History:function(e){for(var t=R1a.length,i=0;i<t;i++)if(e==R1a[i])return;27<t&&R1a.shift(),R1a.push(e)},enable:function(){var e=this.element;return this._isPopup?e.removeAttr("disabled"):e.css({opacity:"1","pointer-events":"auto"}),e.removeAttr("aria-disabled"),this._enabled=!0,this},disable:function(){var e=this.element;return this._isPopup?e.attr("disabled","disabled"):(this.hidePalette(),e.css({opacity:"0.3","pointer-events":"none"})),e.attr("aria-disabled","true"),this._enabled=!1,this},isDisabled:function(){return!this._enabled},destroy:function(){M1a(document.body).off("click."+this._id),this._palette&&(this._palette.off("mouseover click","td").find(".evo-more a").off("click"),this._isPopup&&this._palette.remove(),this._palette=this._cTxt=null),this._isPopup&&this.element.next().off("click").remove().end().off("focus").unwrap(),this.element.removeClass("colorPicker "+this.id).empty(),M1a.Widget.prototype.destroy.call(this)}}),s2a=jQuery,t2a=this,s2a.fn.jScrollPane=function(i){function a(v,e){var x,w,P,b,A,T,I,ie,ae,k,B,S,M,F,$,O,L,ne,N,t,V,R,E,_,oe,H,z,U,W,se,j,re,K,le,G=this,o=!0,s=!0,r=!1,l=!1,i=v.clone(!1,!1).empty(),de=s2a.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";function ce(e){var t,i,a,n,o,s,r,l,d,c,h,p,u,m,g,f,y=!1,D=!1;if(x=e,w===u2a)n=v.scrollTop(),o=v.scrollLeft(),v.css({overflow:"hidden",padding:0}),P=v.innerWidth()+K,b=v.innerHeight(),v.width(P),w=s2a('<div class="jspPane" />').css("padding",re).append(v.children()),A=s2a('<div class="jspContainer" />').css({width:P+"px",height:b+"px"}).append(w).appendTo(v);else{if(v.css("width",""),y=x.stickToBottom&&(20<(s=I-b)&&s-ee()<10),D=x.stickToRight&&(20<(s=T-P)&&s-J()<10),(a=v.innerWidth()+K!=P||v.outerHeight()!=b)&&(P=v.innerWidth()+K,b=v.innerHeight(),A.css({width:P+"px",height:b+"px"})),!a&&le==T&&w.outerHeight()==I)return void v.width(P);le=T,w.css("width",""),v.width(P),A.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end()}function C(){var e=L,t=F;switch(l){case 40:G.scrollByY(x.keyboardSpeed,!1);break;case 38:G.scrollByY(-x.keyboardSpeed,!1);break;case 34:case 32:G.scrollByY(b*x.scrollPagePercent,!1);break;case 33:G.scrollByY(-b*x.scrollPagePercent,!1);break;case 39:G.scrollByX(x.keyboardSpeed,!1);break;case 37:G.scrollByX(-x.keyboardSpeed,!1)}d=e!=L||t!=F}w.css("overflow","auto"),T=e.contentWidth||w[0].scrollWidth,I=w[0].scrollHeight,w.css("overflow",""),k=1<(ae=I/b),(B=1<(ie=T/P))||k?(v.addClass("jspScrollable"),(a=x.maintainPosition&&(F||L))&&(t=J(),i=ee()),k&&(A.append(s2a('<div class="jspVerticalBar" />').append(s2a('<div class="jspCap jspCapTop" />'),s2a('<div class="jspTrack" />').append(s2a('<div class="jspDrag" />').append(s2a('<div class="jspDragTop" />'),s2a('<div class="jspDragBottom" />'))),s2a('<div class="jspCap jspCapBottom" />'))),ne=A.find(">.jspVerticalBar"),N=ne.find(">.jspTrack"),S=N.find(">.jspDrag"),x.showArrows&&(E=s2a('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",Y(0,-1)).bind("click.jsp",te),_=s2a('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",Y(0,1)).bind("click.jsp",te),x.arrowScrollOnHover&&(E.bind("mouseover.jsp",Y(0,-1,E)),_.bind("mouseover.jsp",Y(0,1,_))),ue(N,x.verticalArrowPositions,E,_)),V=b,A.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){V-=s2a(this).outerHeight()}),S.hover(function(){S.addClass("jspHover")},function(){S.removeClass("jspHover")}).bind("mousedown.jsp",function(e){s2a("html").bind("dragstart.jsp selectstart.jsp",te),S.addClass("jspActive");var t=e.pageY-S.position().top;return s2a("html").bind("mousemove.jsp",function(e){q(e.pageY-t,!1)}).bind("mouseup.jsp mouseleave.jsp",ge),!1}),he()),B&&(A.append(s2a('<div class="jspHorizontalBar" />').append(s2a('<div class="jspCap jspCapLeft" />'),s2a('<div class="jspTrack" />').append(s2a('<div class="jspDrag" />').append(s2a('<div class="jspDragLeft" />'),s2a('<div class="jspDragRight" />'))),s2a('<div class="jspCap jspCapRight" />'))),oe=A.find(">.jspHorizontalBar"),H=oe.find(">.jspTrack"),$=H.find(">.jspDrag"),x.showArrows&&(W=s2a('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",Y(-1,0)).bind("click.jsp",te),se=s2a('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",Y(1,0)).bind("click.jsp",te),x.arrowScrollOnHover&&(W.bind("mouseover.jsp",Y(-1,0,W)),se.bind("mouseover.jsp",Y(1,0,se))),ue(H,x.horizontalArrowPositions,W,se)),$.hover(function(){$.addClass("jspHover")},function(){$.removeClass("jspHover")}).bind("mousedown.jsp",function(e){s2a("html").bind("dragstart.jsp selectstart.jsp",te),$.addClass("jspActive");var t=e.pageX-$.position().left;return s2a("html").bind("mousemove.jsp",function(e){X(e.pageX-t,!1)}).bind("mouseup.jsp mouseleave.jsp",ge),!1}),z=A.innerWidth(),pe()),B&&k&&(e=H.outerHeight(),r=N.outerWidth(),V-=e,s2a(oe).find(">.jspCap:visible,>.jspArrow").each(function(){z+=s2a(this).outerWidth()}),z-=r,b-=r,P-=e,H.parent().append(s2a('<div class="jspCorner" />').css("width",e+"px")),he(),pe()),B&&w.width(A.outerWidth()-K+"px"),I=w.outerHeight(),ae=I/b,B&&((U=Math.ceil(1/ie*z))>x.horizontalDragMaxWidth?U=x.horizontalDragMaxWidth:U<x.horizontalDragMinWidth&&(U=x.horizontalDragMinWidth),$.width(U+"px"),O=z-U,ye(L)),k&&((R=Math.ceil(1/ae*V))>x.verticalDragMaxHeight?R=x.verticalDragMaxHeight:R<x.verticalDragMinHeight&&(R=x.verticalDragMinHeight),S.height(R+"px"),M=V-R,fe(F)),a&&(Q(D?T-P:t,!1),Z(y?I-b:i,!1)),w.find(":input,a").unbind("focus.jsp").bind("focus.jsp",function(e){De(e.target,!1)}),A.unbind(de).bind(de,function(e,t,i,a){var n=L,o=F;return G.scrollBy(i*x.mouseWheelSpeed,-a*x.mouseWheelSpeed,!1),n==L&&o==F}),f=!1,A.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(e){e=e.originalEvent.touches[0];h=J(),p=ee(),u=e.pageX,m=e.pageY,f=!(g=!1)}).bind("touchmove.jsp",function(e){var t,i;if(f)return e=e.originalEvent.touches[0],t=L,i=F,G.scrollTo(h+u-e.pageX,p+m-e.pageY),g=g||5<Math.abs(u-e.pageX)||5<Math.abs(m-e.pageY),t==L&&i==F}).bind("touchend.jsp",function(e){f=!1}).bind("click.jsp-touchclick",function(e){if(g)return g=!1}),x.enableKeyboardNavigation&&(c=[],B&&c.push(oe[0]),k&&c.push(ne[0]),w.focus(function(){v.focus()}),v.attr("tabindex",0).unbind("keydown.jsp keypress.jsp").bind("keydown.jsp",function(e){if(e.target===this||c.length&&s2a(e.target).closest(c).length){var t=L,i=F;switch(e.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:l=e.keyCode,C();break;case 35:Z(I-b),l=null;break;case 36:Z(0),l=null}return!(d=e.keyCode==l&&t!=L||i!=F)}}).bind("keypress.jsp",function(e){return e.keyCode==l&&C(),!d}),x.hideFocus?(v.css("outline","none"),"hideFocus"in A[0]&&v.attr("hideFocus",!0)):(v.css("outline",""),"hideFocus"in A[0]&&v.attr("hideFocus",!1))),x.clickOnTrack&&(me(),k&&N.bind("mousedown.jsp",function(a){var n,e,o,s,r,l,d;if(a.originalTarget===u2a||a.originalTarget==a.currentTarget)return e=(n=s2a(this)).offset(),o=a.pageY-e.top-F,r=!0,d=function(){s&&clearTimeout(s),s=null,s2a(document).unbind("mouseup.jsp",d)},(l=function(){var e=n.offset(),e=a.pageY-e.top-R/2,t=b*x.scrollPagePercent,i=M*t/(I-b);if(o<0)e<F-i?G.scrollByY(-t):q(e);else{if(!(0<o))return void d();F+i<e?G.scrollByY(t):q(e)}s=setTimeout(l,r?x.initialDelay:x.trackClickRepeatFreq),r=!1})(),s2a(document).bind("mouseup.jsp",d),!1}),B&&H.bind("mousedown.jsp",function(a){var n,e,o,s,r,l,d;if(a.originalTarget===u2a||a.originalTarget==a.currentTarget)return e=(n=s2a(this)).offset(),o=a.pageX-e.left-L,r=!0,d=function(){s&&clearTimeout(s),s=null,s2a(document).unbind("mouseup.jsp",d)},(l=function(){var e=n.offset(),e=a.pageX-e.left-U/2,t=P*x.scrollPagePercent,i=O*t/(T-P);if(o<0)e<L-i?G.scrollByX(-t):X(e);else{if(!(0<o))return void d();L+i<e?G.scrollByX(t):X(e)}s=setTimeout(l,r?x.initialDelay:x.trackClickRepeatFreq),r=!1})(),s2a(document).bind("mouseup.jsp",d),!1})),function(){if(location.hash&&1<location.hash.length){var e,t,i=escape(location.hash.substr(1));try{e=s2a("#"+i+', a[name="'+i+'"]')}catch(e){return}e.length&&w.find(i)&&(0===A.scrollTop()?t=setInterval(function(){0<A.scrollTop()&&(De(e,!0),s2a(document).scrollTop(A.position().top),clearInterval(t))},50):(De(e,!0),s2a(document).scrollTop(A.position().top)))}}(),x.hijackInternalLinks&&!s2a(document.body).data("jspHijack")&&(s2a(document.body).data("jspHijack",!0),s2a(document.body).delegate("a[href*=#]","click",function(e){var t,i=this.href.substr(0,this.href.indexOf("#")),a=location.href;if(i===(a=-1!==location.href.indexOf("#")?location.href.substr(0,location.href.indexOf("#")):a)){i=escape(this.href.substr(this.href.indexOf("#")+1));try{t=s2a("#"+i+', a[name="'+i+'"]')}catch(e){return}t.length&&((a=t.closest(".jspScrollable")).data("jsp").scrollToElement(t,!0),a[0].scrollIntoView&&(i=s2a(t2a).scrollTop(),((t=t.offset().top)<i||t>i+s2a(t2a).height())&&a[0].scrollIntoView()),e.preventDefault())}}))):(v.removeClass("jspScrollable"),w.css({top:0,width:A.width()-K}),A.unbind(de),w.find(":input,a").unbind("focus.jsp"),v.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keypress.jsp"),me()),x.autoReinitialise&&!j?j=setInterval(function(){ce(x)},x.autoReinitialiseDelay):!x.autoReinitialise&&j&&clearInterval(j),n&&v.scrollTop(0)&&Z(n,!1),o&&v.scrollLeft(0)&&Q(o,!1),v.trigger("jsp-initialised",[B||k])}function he(){N.height(V+"px"),F=0,t=x.verticalGutter+N.outerWidth(),w.width(P-t-K);try{0===ne.position().left&&w.css("margin-left",t+"px")}catch(e){}}function pe(){A.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){z-=s2a(this).outerWidth()}),H.width(z+"px"),L=0}function ue(e,t,i,a){var n="before",o="after";(t="os"==t?/Mac/.test(navigator.platform)?"after":"split":t)==n?o=t:t==o&&(n=t,t=i,i=a,a=t),e[n](i)[o](a)}function Y(l,d,c){return function(){function e(){0!==t&&G.scrollByX(t*x.arrowButtonSpeed),0!==i&&G.scrollByY(i*x.arrowButtonSpeed),s=setTimeout(e,r?x.initialDelay:x.arrowRepeatFreq),r=!1}var t,i,a,n,o,s,r;return t=l,i=d,n=c,a=s2a(a=this).addClass("jspActive"),r=!0,e(),o=n?"mouseout.jsp":"mouseup.jsp",(n=n||s2a("html")).bind(o,function(){a.removeClass("jspActive"),s&&clearTimeout(s),s=null,n.unbind(o)}),this.blur(),!1}}function me(){H&&H.unbind("mousedown.jsp"),N&&N.unbind("mousedown.jsp")}function ge(){s2a("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp"),S&&S.removeClass("jspActive"),$&&$.removeClass("jspActive")}function q(e,t){k&&(e<0?e=0:M<e&&(e=M),(t=t===u2a?x.animateScroll:t)?G.animate(S,"top",e,fe):(S.css("top",e),fe(e)))}function fe(e){e===u2a&&(e=S.position().top),A.scrollTop(0);var t,i,a=0===(F=e),n=F==M,e=-(e/M)*(I-b);o==a&&r==n||(o=a,r=n,v.trigger("jsp-arrow-change",[o,r,s,l])),t=a,i=n,x.showArrows&&(E[t?"addClass":"removeClass"]("jspDisabled"),_[i?"addClass":"removeClass"]("jspDisabled")),w.css("top",e),v.trigger("jsp-scroll-y",[-e,a,n]).trigger("scroll")}function X(e,t){B&&(e<0?e=0:O<e&&(e=O),(t=t===u2a?x.animateScroll:t)?G.animate($,"left",e,ye):($.css("left",e),ye(e)))}function ye(e){e===u2a&&(e=$.position().left),A.scrollTop(0);var t,i,a=0===(L=e),n=L==O,e=-(e/O)*(T-P);s==a&&l==n||(s=a,l=n,v.trigger("jsp-arrow-change",[o,r,s,l])),t=a,i=n,x.showArrows&&(W[t?"addClass":"removeClass"]("jspDisabled"),se[i?"addClass":"removeClass"]("jspDisabled")),w.css("left",e),v.trigger("jsp-scroll-x",[-e,a,n]).trigger("scroll")}function Z(e,t){q(e/(I-b)*M,t)}function Q(e,t){X(e/(T-P)*O,t)}function De(e,t,i){var a,n,o,s,r,l,d=0,c=0;try{a=s2a(e)}catch(e){return}for(e=a.outerHeight(),n=a.outerWidth(),A.scrollTop(0),A.scrollLeft(0);!a.is(".jspPane");)if(d+=a.position().top,c+=a.position().left,a=a.offsetParent(),/^body|html$/i.test(a[0].nodeName))return;s=(o=ee())+b,d<o||t?r=d-x.verticalGutter:s<d+e&&(r=d-b+e+x.verticalGutter),r&&Z(r,i),s=(o=J())+P,c<o||t?l=c-x.horizontalGutter:s<c+n&&(l=c-P+n+x.horizontalGutter),l&&Q(l,i)}function J(){return-w.position().left}function ee(){return-w.position().top}function te(){return!1}re=v.css("paddingTop")+" "+v.css("paddingRight")+" "+v.css("paddingBottom")+" "+v.css("paddingLeft"),K=(parseInt(v.css("paddingLeft"),10)||0)+(parseInt(v.css("paddingRight"),10)||0),s2a.extend(G,{reinitialise:function(e){ce(e=s2a.extend({},x,e))},scrollToElement:function(e,t,i){De(e,t,i)},scrollTo:function(e,t,i){Q(e,i),Z(t,i)},scrollToX:function(e,t){Q(e,t)},scrollToY:function(e,t){Z(e,t)},scrollToPercentX:function(e,t){Q(e*(T-P),t)},scrollToPercentY:function(e,t){Z(e*(I-b),t)},scrollBy:function(e,t,i){G.scrollByX(e,i),G.scrollByY(t,i)},scrollByX:function(e,t){X((J()+Math[e<0?"floor":"ceil"](e))/(T-P)*O,t)},scrollByY:function(e,t){q((ee()+Math[e<0?"floor":"ceil"](e))/(I-b)*M,t)},positionDragX:function(e,t){X(e,t)},positionDragY:function(e,t){q(e,t)},animate:function(e,t,i,a){var n={};n[t]=i,e.animate(n,{duration:x.animateDuration,easing:x.animateEase,queue:!1,step:a})},getContentPositionX:J,getContentPositionY:ee,getContentWidth:function(){return T},getContentHeight:function(){return I},getPercentScrolledX:function(){return J()/(T-P)},getPercentScrolledY:function(){return ee()/(I-b)},getIsScrollableH:function(){return B},getIsScrollableV:function(){return k},getContentPane:function(){return w},scrollToBottom:function(e){q(M,e)},hijackInternalLinks:s2a.noop,destroy:function(){var e,t;e=ee(),t=J(),v.removeClass("jspScrollable").unbind(".jsp"),v.replaceWith(i.append(w.children())),i.scrollTop(e),i.scrollLeft(t),j&&clearInterval(j)}}),ce(e)}return i=s2a.extend({},s2a.fn.jScrollPane.defaults,i),s2a.each(["arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){i[this]=i[this]||i.speed}),this.each(function(){var e=s2a(this),t=e.data("jsp");t?t.reinitialise(i):(s2a("script",e).filter('[type="text/javascript"],:not([type])').remove(),t=new a(e,i),e.data("jsp",t))})},s2a.fn.jScrollPane.defaults={showArrows:!1,maintainPosition:!0,stickToBottom:!1,stickToRight:!1,clickOnTrack:!0,autoReinitialise:!1,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,contentWidth:u2a,animateScroll:!1,animateDuration:300,animateEase:"linear",hijackInternalLinks:!1,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:3,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:!1,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:!0,hideFocus:!1,keyboardSpeed:0,initialDelay:300,speed:30,scrollPagePercent:.8},eval(decodeURIComponent("%2F*%0A%20%20html2canvas%200.4.1%20%3Chttp%3A%2F%2Fhtml2canvas.hertzen.com%3E%0A%20%20Copyright%20(c)%202013%20Niklas%20von%20Hertzen%0A%0A%20%20Released%20under%20MIT%20License%0A*%2F%0A(function(t%2Ce%2Cn)%7B%22use%20strict%22%3Bfunction%20r(t%2Ce%2Cn)%7Bvar%20r%2Ca%3Dt.runtimeStyle%26%26t.runtimeStyle%5Be%5D%2Co%3Dt.style%3Breturn!%2F%5E-%3F%5B0-9%5D%2B%5C.%3F%5B0-9%5D*(%3F%3Apx)%3F%24%2Fi.test(n)%26%26%2F%5E-%3F%5Cd%2F.test(n)%26%26(r%3Do.left%2Ca%26%26(t.runtimeStyle.left%3Dt.currentStyle.left)%2Co.left%3D%22fontSize%22%3D%3D%3De%3F%221em%22%3An%7C%7C0%2Cn%3Do.pixelLeft%2B%22px%22%2Co.left%3Dr%2Ca%26%26(t.runtimeStyle.left%3Da))%2C%2F%5E(thin%7Cmedium%7Cthick)%24%2Fi.test(n)%3Fn%3AMath.round(parseFloat(n))%2B%22px%22%7Dfunction%20a(t)%7Breturn%20parseInt(t%2C10)%7Dfunction%20o(t)%7Breturn-1!%3D%3D(%22%22%2Bt).indexOf(%22%25%22)%7Dfunction%20i(t%2Ce%2Ca%2Co)%7Bif(t%3D(t%7C%7C%22%22).split(%22%2C%22)%2Ct%3Dt%5Bo%7C%7C0%5D%7C%7Ct%5B0%5D%7C%7C%22auto%22%2Ct%3Dd.Util.trimText(t).split(%22%20%22)%2C%22backgroundSize%22%3D%3D%3Da%26%26t%5B0%5D%26%26t%5B0%5D.match(%2F%5E(cover%7Ccontain%7Cauto)%24%2F))return%20t%3Bif(t%5B0%5D%3D-1%3D%3D%3Dt%5B0%5D.indexOf(%22%25%22)%3Fr(e%2Ca%2B%22X%22%2Ct%5B0%5D)%3At%5B0%5D%2Ct%5B1%5D%3D%3D%3Dn)%7Bif(%22backgroundSize%22%3D%3D%3Da)return%20t%5B1%5D%3D%22auto%22%2Ct%3Bt%5B1%5D%3Dt%5B0%5D%7Dreturn%20t%5B1%5D%3D-1%3D%3D%3Dt%5B1%5D.indexOf(%22%25%22)%3Fr(e%2Ca%2B%22Y%22%2Ct%5B1%5D)%3At%5B1%5D%2Ct%7Dfunction%20l(t%2Ce)%7Bvar%20n%3D%5B%5D%3Breturn%7Bstorage%3An%2Cwidth%3At%2Cheight%3Ae%2Cclip%3Afunction()%7Bn.push(%7Btype%3A%22function%22%2Cname%3A%22clip%22%2Carguments%3Aarguments%7D)%7D%2Ctranslate%3Afunction()%7Bn.push(%7Btype%3A%22function%22%2Cname%3A%22translate%22%2Carguments%3Aarguments%7D)%7D%2Cfill%3Afunction()%7Bn.push(%7Btype%3A%22function%22%2Cname%3A%22fill%22%2Carguments%3Aarguments%7D)%7D%2Csave%3Afunction()%7Bn.push(%7Btype%3A%22function%22%2Cname%3A%22save%22%2Carguments%3Aarguments%7D)%7D%2Crestore%3Afunction()%7Bn.push(%7Btype%3A%22function%22%2Cname%3A%22restore%22%2Carguments%3Aarguments%7D)%7D%2CfillRect%3Afunction()%7Bn.push(%7Btype%3A%22function%22%2Cname%3A%22fillRect%22%2Carguments%3Aarguments%7D)%7D%2CcreatePattern%3Afunction()%7Bn.push(%7Btype%3A%22function%22%2Cname%3A%22createPattern%22%2Carguments%3Aarguments%7D)%7D%2CdrawShape%3Afunction()%7Bvar%20t%3D%5B%5D%3Breturn%20n.push(%7Btype%3A%22function%22%2Cname%3A%22drawShape%22%2Carguments%3At%7D)%2C%7BmoveTo%3Afunction()%7Bt.push(%7Bname%3A%22moveTo%22%2Carguments%3Aarguments%7D)%7D%2ClineTo%3Afunction()%7Bt.push(%7Bname%3A%22lineTo%22%2Carguments%3Aarguments%7D)%7D%2CarcTo%3Afunction()%7Bt.push(%7Bname%3A%22arcTo%22%2Carguments%3Aarguments%7D)%7D%2CbezierCurveTo%3Afunction()%7Bt.push(%7Bname%3A%22bezierCurveTo%22%2Carguments%3Aarguments%7D)%7D%2CquadraticCurveTo%3Afunction()%7Bt.push(%7Bname%3A%22quadraticCurveTo%22%2Carguments%3Aarguments%7D)%7D%7D%7D%2CdrawImage%3Afunction()%7Bn.push(%7Btype%3A%22function%22%2Cname%3A%22drawImage%22%2Carguments%3Aarguments%7D)%7D%2CfillText%3Afunction()%7Bn.push(%7Btype%3A%22function%22%2Cname%3A%22fillText%22%2Carguments%3Aarguments%7D)%7D%2CsetVariable%3Afunction(t%2Ce)%7Breturn%20n.push(%7Btype%3A%22variable%22%2Cname%3At%2Carguments%3Ae%7D)%2Ce%7D%7D%7Dvar%20s%2Cc%2Cd%3D%7B%7D%3Bd.Util%3D%7B%7D%2Cd.Util.log%3Dfunction(e)%7Bd.logging%26%26t.console%26%26t.console.log%26%26t.console.log(e)%7D%2Cd.Util.trimText%3Dfunction(t)%7Breturn%20function(e)%7Breturn%20t%3Ft.apply(e)%3A((e%7C%7C%22%22)%2B%22%22).replace(%2F%5E%5Cs%2B%7C%5Cs%2B%24%2Fg%2C%22%22)%7D%7D(String.prototype.trim)%2Cd.Util.asFloat%3Dfunction(t)%7Breturn%20parseFloat(t)%7D%2Cfunction()%7Bvar%20t%3D%2F((rgba%7Crgb)%5C(%5B%5E%5C)%5D%2B%5C)(%5Cs-%3F%5Cd%2Bpx)%7B0%2C%7D)%2Fg%2Ce%3D%2F(-%3F%5Cd%2Bpx)%7C(%23.%2B)%7C(rgb%5C(.%2B%5C))%7C(rgba%5C(.%2B%5C))%2Fg%3Bd.Util.parseTextShadows%3Dfunction(n)%7Bif(!n%7C%7C%22none%22%3D%3D%3Dn)return%5B%5D%3Bfor(var%20r%3Dn.match(t)%2Ca%3D%5B%5D%2Co%3D0%3Br%26%26r.length%3Eo%3Bo%2B%2B)%7Bvar%20i%3Dr%5Bo%5D.match(e)%3Ba.push(%7Bcolor%3Ai%5B0%5D%2CoffsetX%3Ai%5B1%5D%3Fi%5B1%5D.replace(%22px%22%2C%22%22)%3A0%2CoffsetY%3Ai%5B2%5D%3Fi%5B2%5D.replace(%22px%22%2C%22%22)%3A0%2Cblur%3Ai%5B3%5D%3Fi%5B3%5D.replace(%22px%22%2C%22%22)%3A0%7D)%7Dreturn%20a%7D%7D()%2Cd.Util.parseBackgroundImage%3Dfunction(t)%7Bvar%20e%2Cn%2Cr%2Ca%2Co%2Ci%2Cl%2Cs%2Cc%3D%22%20%5Cr%5Cn%09%22%2Cd%3D%5B%5D%2Ch%3D0%2Cu%3D0%2Cf%3Dfunction()%7Be%26%26(%27%22%27%3D%3D%3Dn.substr(0%2C1)%26%26(n%3Dn.substr(1%2Cn.length-2))%2Cn%26%26s.push(n)%2C%22-%22%3D%3D%3De.substr(0%2C1)%26%26(a%3De.indexOf(%22-%22%2C1)%2B1)%3E0%26%26(r%3De.substr(0%2Ca)%2Ce%3De.substr(a))%2Cd.push(%7Bprefix%3Ar%2Cmethod%3Ae.toLowerCase()%2Cvalue%3Ao%2Cargs%3As%7D))%2Cs%3D%5B%5D%2Ce%3Dr%3Dn%3Do%3D%22%22%7D%3Bf()%3Bfor(var%20p%3D0%2Cg%3Dt.length%3Bg%3Ep%3Bp%2B%2B)if(i%3Dt%5Bp%5D%2C!(0%3D%3D%3Dh%26%26c.indexOf(i)%3E-1))%7Bswitch(i)%7Bcase%27%22%27%3Al%3Fl%3D%3D%3Di%26%26(l%3Dnull)%3Al%3Di%3Bbreak%3Bcase%22(%22%3Aif(l)break%3Bif(0%3D%3D%3Dh)%7Bh%3D1%2Co%2B%3Di%3Bcontinue%7Du%2B%2B%3Bbreak%3Bcase%22)%22%3Aif(l)break%3Bif(1%3D%3D%3Dh)%7Bif(0%3D%3D%3Du)%7Bh%3D0%2Co%2B%3Di%2Cf()%3Bcontinue%7Du--%7Dbreak%3Bcase%22%2C%22%3Aif(l)break%3Bif(0%3D%3D%3Dh)%7Bf()%3Bcontinue%7Dif(1%3D%3D%3Dh%26%260%3D%3D%3Du%26%26!e.match(%2F%5Eurl%24%2Fi))%7Bs.push(n)%2Cn%3D%22%22%2Co%2B%3Di%3Bcontinue%7D%7Do%2B%3Di%2C0%3D%3D%3Dh%3Fe%2B%3Di%3An%2B%3Di%7Dreturn%20f()%2Cd%7D%2Cd.Util.Bounds%3Dfunction(t)%7Bvar%20e%2Cn%3D%7B%7D%3Breturn%20t.getBoundingClientRect%26%26(e%3Dt.getBoundingClientRect()%2Cn.top%3De.top%2Cn.bottom%3De.bottom%7C%7Ce.top%2Be.height%2Cn.left%3De.left%2Cn.width%3Dt.offsetWidth%2Cn.height%3Dt.offsetHeight)%2Cn%7D%2Cd.Util.OffsetBounds%3Dfunction(t)%7Bvar%20e%3Dt.offsetParent%3Fd.Util.OffsetBounds(t.offsetParent)%3A%7Btop%3A0%2Cleft%3A0%7D%3Breturn%7Btop%3At.offsetTop%2Be.top%2Cbottom%3At.offsetTop%2Bt.offsetHeight%2Be.top%2Cleft%3At.offsetLeft%2Be.left%2Cwidth%3At.offsetWidth%2Cheight%3At.offsetHeight%7D%7D%2Cd.Util.getCSS%3Dfunction(t%2Cn%2Cr)%7Bs!%3D%3Dt%26%26(c%3De.defaultView.getComputedStyle(t%2Cnull))%3Bvar%20o%3Dc%5Bn%5D%3Bif(%2F%5Ebackground(Size%7CPosition)%24%2F.test(n))return%20i(o%2Ct%2Cn%2Cr)%3Bif(%2Fborder(Top%7CBottom)(Left%7CRight)Radius%2F.test(n))%7Bvar%20l%3Do.split(%22%20%22)%3Breturn%201%3E%3Dl.length%26%26(l%5B1%5D%3Dl%5B0%5D)%2Cl.map(a)%7Dreturn%20o%7D%2Cd.Util.resizeBounds%3Dfunction(t%2Ce%2Cn%2Cr%2Ca)%7Bvar%20o%2Ci%2Cl%3Dn%2Fr%2Cs%3Dt%2Fe%3Breturn%20a%26%26%22auto%22!%3D%3Da%3Fs%3El%5E%22contain%22%3D%3D%3Da%3F(i%3Dr%2Co%3Dr*s)%3A(o%3Dn%2Ci%3Dn%2Fs)%3A(o%3Dn%2Ci%3Dr)%2C%7Bwidth%3Ao%2Cheight%3Ai%7D%7D%2Cd.Util.BackgroundPosition%3Dfunction(t%2Ce%2Cn%2Cr%2Ca)%7Bvar%20i%2Cl%2Cs%3Dd.Util.getCSS(t%2C%22backgroundPosition%22%2Cr)%3Breturn%201%3D%3D%3Ds.length%26%26(s%3D%5Bs%5B0%5D%2Cs%5B0%5D%5D)%2Ci%3Do(s%5B0%5D)%3F(e.width-(a%7C%7Cn).width)*(parseFloat(s%5B0%5D)%2F100)%3AparseInt(s%5B0%5D%2C10)%2Cl%3D%22auto%22%3D%3D%3Ds%5B1%5D%3Fi%2Fn.width*n.height%3Ao(s%5B1%5D)%3F(e.height-(a%7C%7Cn).height)*parseFloat(s%5B1%5D)%2F100%3AparseInt(s%5B1%5D%2C10)%2C%22auto%22%3D%3D%3Ds%5B0%5D%26%26(i%3Dl%2Fn.height*n.width)%2C%7Bleft%3Ai%2Ctop%3Al%7D%7D%2Cd.Util.BackgroundSize%3Dfunction(t%2Ce%2Cn%2Cr)%7Bvar%20a%2Ci%2Cl%3Dd.Util.getCSS(t%2C%22backgroundSize%22%2Cr)%3Bif(1%3D%3D%3Dl.length%26%26(l%3D%5Bl%5B0%5D%2Cl%5B0%5D%5D)%2Co(l%5B0%5D))a%3De.width*parseFloat(l%5B0%5D)%2F100%3Belse%7Bif(%2Fcontain%7Ccover%2F.test(l%5B0%5D))return%20d.Util.resizeBounds(n.width%2Cn.height%2Ce.width%2Ce.height%2Cl%5B0%5D)%3Ba%3DparseInt(l%5B0%5D%2C10)%7Dreturn%20i%3D%22auto%22%3D%3D%3Dl%5B0%5D%26%26%22auto%22%3D%3D%3Dl%5B1%5D%3Fn.height%3A%22auto%22%3D%3D%3Dl%5B1%5D%3Fa%2Fn.width*n.height%3Ao(l%5B1%5D)%3Fe.height*parseFloat(l%5B1%5D)%2F100%3AparseInt(l%5B1%5D%2C10)%2C%22auto%22%3D%3D%3Dl%5B0%5D%26%26(a%3Di%2Fn.height*n.width)%2C%7Bwidth%3Aa%2Cheight%3Ai%7D%7D%2Cd.Util.BackgroundRepeat%3Dfunction(t%2Ce)%7Bvar%20n%3Dd.Util.getCSS(t%2C%22backgroundRepeat%22).split(%22%2C%22).map(d.Util.trimText)%3Breturn%20n%5Be%5D%7C%7Cn%5B0%5D%7D%2Cd.Util.Extend%3Dfunction(t%2Ce)%7Bfor(var%20n%20in%20t)t.hasOwnProperty(n)%26%26(e%5Bn%5D%3Dt%5Bn%5D)%3Breturn%20e%7D%2Cd.Util.Children%3Dfunction(t)%7Bvar%20e%3Btry%7Be%3Dt.nodeName%26%26%22IFRAME%22%3D%3D%3Dt.nodeName.toUpperCase()%3Ft.contentDocument%7C%7Ct.contentWindow.document%3Afunction(t)%7Bvar%20e%3D%5B%5D%3Breturn%20null!%3D%3Dt%26%26function(t%2Ce)%7Bvar%20r%3Dt.length%2Ca%3D0%3Bif(%22number%22%3D%3Dtypeof%20e.length)for(var%20o%3De.length%3Bo%3Ea%3Ba%2B%2B)t%5Br%2B%2B%5D%3De%5Ba%5D%3Belse%20for(%3Be%5Ba%5D!%3D%3Dn%3B)t%5Br%2B%2B%5D%3De%5Ba%2B%2B%5D%3Breturn%20t.length%3Dr%2Ct%7D(e%2Ct)%2Ce%7D(t.childNodes)%7Dcatch(r)%7Bd.Util.log(%22html2canvas.Util.Children%20failed%20with%20exception%3A%20%22%2Br.message)%2Ce%3D%5B%5D%7Dreturn%20e%7D%2Cd.Util.isTransparent%3Dfunction(t)%7Breturn!t%7C%7C%22transparent%22%3D%3D%3Dt%7C%7C%22rgba(0%2C%200%2C%200%2C%200)%22%3D%3D%3Dt%7D%2Cd.Util.Font%3Dfunction()%7Bvar%20t%3D%7B%7D%3Breturn%20function(e%2Cr%2Ca)%7Bif(t%5Be%2B%22-%22%2Br%5D!%3D%3Dn)return%20t%5Be%2B%22-%22%2Br%5D%3Bvar%20o%2Ci%2Cl%2Cs%3Da.createElement(%22div%22)%2Cc%3Da.createElement(%22img%22)%2Cd%3Da.createElement(%22span%22)%2Ch%3D%22Hidden%20Text%22%3Breturn%20s.style.visibility%3D%22hidden%22%2Cs.style.fontFamily%3De%2Cs.style.fontSize%3Dr%2Cs.style.margin%3D0%2Cs.style.padding%3D0%2Ca.body.appendChild(s)%2Cc.src%3D%22data%3Aimage%2Fgif%3Bbase64%2CR0lGODlhAQABAIABAP%2F%2F%2FwAAACwAAAAAAQABAAACAkQBADs%3D%22%2Cc.width%3D1%2Cc.height%3D1%2Cc.style.margin%3D0%2Cc.style.padding%3D0%2Cc.style.verticalAlign%3D%22baseline%22%2Cd.style.fontFamily%3De%2Cd.style.fontSize%3Dr%2Cd.style.margin%3D0%2Cd.style.padding%3D0%2Cd.appendChild(a.createTextNode(h))%2Cs.appendChild(d)%2Cs.appendChild(c)%2Co%3Dc.offsetTop-d.offsetTop%2B1%2Cs.removeChild(d)%2Cs.appendChild(a.createTextNode(h))%2Cs.style.lineHeight%3D%22normal%22%2Cc.style.verticalAlign%3D%22super%22%2Ci%3Dc.offsetTop-s.offsetTop%2B1%2Cl%3D%7Bbaseline%3Ao%2ClineWidth%3A1%2Cmiddle%3Ai%7D%2Ct%5Be%2B%22-%22%2Br%5D%3Dl%2Ca.body.removeChild(s)%2Cl%7D%7D()%2Cfunction()%7Bfunction%20t(t)%7Breturn%20function(e)%7Btry%7Bt.addColorStop(e.stop%2Ce.color)%7Dcatch(r)%7Bn.log(%5B%22failed%20to%20add%20color%20stop%3A%20%22%2Cr%2C%22%3B%20tried%20to%20add%3A%20%22%2Ce%5D)%7D%7D%7Dvar%20n%3Dd.Util%2Cr%3D%7B%7D%3Bd.Generate%3Dr%3Bvar%20a%3D%5B%2F%5E(-webkit-linear-gradient)%5C((%5Ba-z%5Cs%5D%2B)(%5B%5Cw%5Cd%5C.%5Cs%2C%25%5C(%5C)%5D%2B)%5C)%24%2F%2C%2F%5E(-o-linear-gradient)%5C((%5Ba-z%5Cs%5D%2B)(%5B%5Cw%5Cd%5C.%5Cs%2C%25%5C(%5C)%5D%2B)%5C)%24%2F%2C%2F%5E(-webkit-gradient)%5C((linear%7Cradial)%2C%5Cs((%3F%3A%5Cd%7B1%2C3%7D%25%3F)%5Cs(%3F%3A%5Cd%7B1%2C3%7D%25%3F)%2C%5Cs(%3F%3A%5Cd%7B1%2C3%7D%25%3F)%5Cs(%3F%3A%5Cd%7B1%2C3%7D%25%3F))(%5B%5Cw%5Cd%5C.%5Cs%2C%25%5C(%5C)%5C-%5D%2B)%5C)%24%2F%2C%2F%5E(-moz-linear-gradient)%5C(((%3F%3A%5Cd%7B1%2C3%7D%25%3F)%5Cs(%3F%3A%5Cd%7B1%2C3%7D%25%3F))(%5B%5Cw%5Cd%5C.%5Cs%2C%25%5C(%5C)%5D%2B)%5C)%24%2F%2C%2F%5E(-webkit-radial-gradient)%5C(((%3F%3A%5Cd%7B1%2C3%7D%25%3F)%5Cs(%3F%3A%5Cd%7B1%2C3%7D%25%3F))%2C%5Cs(%5Cw%2B)%5Cs(%5Ba-z%5C-%5D%2B)(%5B%5Cw%5Cd%5C.%5Cs%2C%25%5C(%5C)%5D%2B)%5C)%24%2F%2C%2F%5E(-moz-radial-gradient)%5C(((%3F%3A%5Cd%7B1%2C3%7D%25%3F)%5Cs(%3F%3A%5Cd%7B1%2C3%7D%25%3F))%2C%5Cs(%5Cw%2B)%5Cs%3F(%5Ba-z%5C-%5D*)(%5B%5Cw%5Cd%5C.%5Cs%2C%25%5C(%5C)%5D%2B)%5C)%24%2F%2C%2F%5E(-o-radial-gradient)%5C(((%3F%3A%5Cd%7B1%2C3%7D%25%3F)%5Cs(%3F%3A%5Cd%7B1%2C3%7D%25%3F))%2C%5Cs(%5Cw%2B)%5Cs(%5Ba-z%5C-%5D%2B)(%5B%5Cw%5Cd%5C.%5Cs%2C%25%5C(%5C)%5D%2B)%5C)%24%2F%5D%3Br.parseGradient%3Dfunction(t%2Ce)%7Bvar%20n%2Cr%2Co%2Ci%2Cl%2Cs%2Cc%2Cd%2Ch%2Cu%2Cf%2Cp%2Cg%3Da.length%3Bfor(r%3D0%3Bg%3Er%26%26!(o%3Dt.match(a%5Br%5D))%3Br%2B%3D1)%3Bif(o)switch(o%5B1%5D)%7Bcase%22-webkit-linear-gradient%22%3Acase%22-o-linear-gradient%22%3Aif(n%3D%7Btype%3A%22linear%22%2Cx0%3Anull%2Cy0%3Anull%2Cx1%3Anull%2Cy1%3Anull%2CcolorStops%3A%5B%5D%7D%2Cl%3Do%5B2%5D.match(%2F%5Cw%2B%2Fg))for(s%3Dl.length%2Cr%3D0%3Bs%3Er%3Br%2B%3D1)switch(l%5Br%5D)%7Bcase%22top%22%3An.y0%3D0%2Cn.y1%3De.height%3Bbreak%3Bcase%22right%22%3An.x0%3De.width%2Cn.x1%3D0%3Bbreak%3Bcase%22bottom%22%3An.y0%3De.height%2Cn.y1%3D0%3Bbreak%3Bcase%22left%22%3An.x0%3D0%2Cn.x1%3De.width%7Dif(null%3D%3D%3Dn.x0%26%26null%3D%3D%3Dn.x1%26%26(n.x0%3Dn.x1%3De.width%2F2)%2Cnull%3D%3D%3Dn.y0%26%26null%3D%3D%3Dn.y1%26%26(n.y0%3Dn.y1%3De.height%2F2)%2Cl%3Do%5B3%5D.match(%2F((%3F%3Argb%7Crgba)%5C(%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D(%3F%3A%2C%5Cs%5B0-9%5C.%5D%2B)%3F%5C)(%3F%3A%5Cs%5Cd%7B1%2C3%7D(%3F%3A%25%7Cpx))%3F)%2B%2Fg))for(s%3Dl.length%2Cc%3D1%2FMath.max(s-1%2C1)%2Cr%3D0%3Bs%3Er%3Br%2B%3D1)d%3Dl%5Br%5D.match(%2F((%3F%3Argb%7Crgba)%5C(%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D(%3F%3A%2C%5Cs%5B0-9%5C.%5D%2B)%3F%5C))%5Cs*(%5Cd%7B1%2C3%7D)%3F(%25%7Cpx)%3F%2F)%2Cd%5B2%5D%3F(i%3DparseFloat(d%5B2%5D)%2Ci%2F%3D%22%25%22%3D%3D%3Dd%5B3%5D%3F100%3Ae.width)%3Ai%3Dr*c%2Cn.colorStops.push(%7Bcolor%3Ad%5B1%5D%2Cstop%3Ai%7D)%3Bbreak%3Bcase%22-webkit-gradient%22%3Aif(n%3D%7Btype%3A%22radial%22%3D%3D%3Do%5B2%5D%3F%22circle%22%3Ao%5B2%5D%2Cx0%3A0%2Cy0%3A0%2Cx1%3A0%2Cy1%3A0%2CcolorStops%3A%5B%5D%7D%2Cl%3Do%5B3%5D.match(%2F(%5Cd%7B1%2C3%7D)%25%3F%5Cs(%5Cd%7B1%2C3%7D)%25%3F%2C%5Cs(%5Cd%7B1%2C3%7D)%25%3F%5Cs(%5Cd%7B1%2C3%7D)%25%3F%2F)%2Cl%26%26(n.x0%3Dl%5B1%5D*e.width%2F100%2Cn.y0%3Dl%5B2%5D*e.height%2F100%2Cn.x1%3Dl%5B3%5D*e.width%2F100%2Cn.y1%3Dl%5B4%5D*e.height%2F100)%2Cl%3Do%5B4%5D.match(%2F((%3F%3Afrom%7Cto%7Ccolor-stop)%5C((%3F%3A%5B0-9%5C.%5D%2B%2C%5Cs)%3F(%3F%3Argb%7Crgba)%5C(%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D(%3F%3A%2C%5Cs%5B0-9%5C.%5D%2B)%3F%5C)%5C))%2B%2Fg))for(s%3Dl.length%2Cr%3D0%3Bs%3Er%3Br%2B%3D1)d%3Dl%5Br%5D.match(%2F(from%7Cto%7Ccolor-stop)%5C((%5B0-9%5C.%5D%2B)%3F(%3F%3A%2C%5Cs)%3F((%3F%3Argb%7Crgba)%5C(%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D(%3F%3A%2C%5Cs%5B0-9%5C.%5D%2B)%3F%5C))%5C)%2F)%2Ci%3DparseFloat(d%5B2%5D)%2C%22from%22%3D%3D%3Dd%5B1%5D%26%26(i%3D0)%2C%22to%22%3D%3D%3Dd%5B1%5D%26%26(i%3D1)%2Cn.colorStops.push(%7Bcolor%3Ad%5B3%5D%2Cstop%3Ai%7D)%3Bbreak%3Bcase%22-moz-linear-gradient%22%3Aif(n%3D%7Btype%3A%22linear%22%2Cx0%3A0%2Cy0%3A0%2Cx1%3A0%2Cy1%3A0%2CcolorStops%3A%5B%5D%7D%2Cl%3Do%5B2%5D.match(%2F(%5Cd%7B1%2C3%7D)%25%3F%5Cs(%5Cd%7B1%2C3%7D)%25%3F%2F)%2Cl%26%26(n.x0%3Dl%5B1%5D*e.width%2F100%2Cn.y0%3Dl%5B2%5D*e.height%2F100%2Cn.x1%3De.width-n.x0%2Cn.y1%3De.height-n.y0)%2Cl%3Do%5B3%5D.match(%2F((%3F%3Argb%7Crgba)%5C(%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D(%3F%3A%2C%5Cs%5B0-9%5C.%5D%2B)%3F%5C)(%3F%3A%5Cs%5Cd%7B1%2C3%7D%25)%3F)%2B%2Fg))for(s%3Dl.length%2Cc%3D1%2FMath.max(s-1%2C1)%2Cr%3D0%3Bs%3Er%3Br%2B%3D1)d%3Dl%5Br%5D.match(%2F((%3F%3Argb%7Crgba)%5C(%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D(%3F%3A%2C%5Cs%5B0-9%5C.%5D%2B)%3F%5C))%5Cs*(%5Cd%7B1%2C3%7D)%3F(%25)%3F%2F)%2Cd%5B2%5D%3F(i%3DparseFloat(d%5B2%5D)%2Cd%5B3%5D%26%26(i%2F%3D100))%3Ai%3Dr*c%2Cn.colorStops.push(%7Bcolor%3Ad%5B1%5D%2Cstop%3Ai%7D)%3Bbreak%3Bcase%22-webkit-radial-gradient%22%3Acase%22-moz-radial-gradient%22%3Acase%22-o-radial-gradient%22%3Aif(n%3D%7Btype%3A%22circle%22%2Cx0%3A0%2Cy0%3A0%2Cx1%3Ae.width%2Cy1%3Ae.height%2Ccx%3A0%2Ccy%3A0%2Crx%3A0%2Cry%3A0%2CcolorStops%3A%5B%5D%7D%2Cl%3Do%5B2%5D.match(%2F(%5Cd%7B1%2C3%7D)%25%3F%5Cs(%5Cd%7B1%2C3%7D)%25%3F%2F)%2Cl%26%26(n.cx%3Dl%5B1%5D*e.width%2F100%2Cn.cy%3Dl%5B2%5D*e.height%2F100)%2Cl%3Do%5B3%5D.match(%2F%5Cw%2B%2F)%2Cd%3Do%5B4%5D.match(%2F%5Ba-z%5C-%5D*%2F)%2Cl%26%26d)switch(d%5B0%5D)%7Bcase%22farthest-corner%22%3Acase%22cover%22%3Acase%22%22%3Ah%3DMath.sqrt(Math.pow(n.cx%2C2)%2BMath.pow(n.cy%2C2))%2Cu%3DMath.sqrt(Math.pow(n.cx%2C2)%2BMath.pow(n.y1-n.cy%2C2))%2Cf%3DMath.sqrt(Math.pow(n.x1-n.cx%2C2)%2BMath.pow(n.y1-n.cy%2C2))%2Cp%3DMath.sqrt(Math.pow(n.x1-n.cx%2C2)%2BMath.pow(n.cy%2C2))%2Cn.rx%3Dn.ry%3DMath.max(h%2Cu%2Cf%2Cp)%3Bbreak%3Bcase%22closest-corner%22%3Ah%3DMath.sqrt(Math.pow(n.cx%2C2)%2BMath.pow(n.cy%2C2))%2Cu%3DMath.sqrt(Math.pow(n.cx%2C2)%2BMath.pow(n.y1-n.cy%2C2))%2Cf%3DMath.sqrt(Math.pow(n.x1-n.cx%2C2)%2BMath.pow(n.y1-n.cy%2C2))%2Cp%3DMath.sqrt(Math.pow(n.x1-n.cx%2C2)%2BMath.pow(n.cy%2C2))%2Cn.rx%3Dn.ry%3DMath.min(h%2Cu%2Cf%2Cp)%3Bbreak%3Bcase%22farthest-side%22%3A%22circle%22%3D%3D%3Dl%5B0%5D%3Fn.rx%3Dn.ry%3DMath.max(n.cx%2Cn.cy%2Cn.x1-n.cx%2Cn.y1-n.cy)%3A(n.type%3Dl%5B0%5D%2Cn.rx%3DMath.max(n.cx%2Cn.x1-n.cx)%2Cn.ry%3DMath.max(n.cy%2Cn.y1-n.cy))%3Bbreak%3Bcase%22closest-side%22%3Acase%22contain%22%3A%22circle%22%3D%3D%3Dl%5B0%5D%3Fn.rx%3Dn.ry%3DMath.min(n.cx%2Cn.cy%2Cn.x1-n.cx%2Cn.y1-n.cy)%3A(n.type%3Dl%5B0%5D%2Cn.rx%3DMath.min(n.cx%2Cn.x1-n.cx)%2Cn.ry%3DMath.min(n.cy%2Cn.y1-n.cy))%7Dif(l%3Do%5B5%5D.match(%2F((%3F%3Argb%7Crgba)%5C(%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D(%3F%3A%2C%5Cs%5B0-9%5C.%5D%2B)%3F%5C)(%3F%3A%5Cs%5Cd%7B1%2C3%7D(%3F%3A%25%7Cpx))%3F)%2B%2Fg))for(s%3Dl.length%2Cc%3D1%2FMath.max(s-1%2C1)%2Cr%3D0%3Bs%3Er%3Br%2B%3D1)d%3Dl%5Br%5D.match(%2F((%3F%3Argb%7Crgba)%5C(%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D(%3F%3A%2C%5Cs%5B0-9%5C.%5D%2B)%3F%5C))%5Cs*(%5Cd%7B1%2C3%7D)%3F(%25%7Cpx)%3F%2F)%2Cd%5B2%5D%3F(i%3DparseFloat(d%5B2%5D)%2Ci%2F%3D%22%25%22%3D%3D%3Dd%5B3%5D%3F100%3Ae.width)%3Ai%3Dr*c%2Cn.colorStops.push(%7Bcolor%3Ad%5B1%5D%2Cstop%3Ai%7D)%7Dreturn%20n%7D%2Cr.Gradient%3Dfunction(n%2Cr)%7Bif(0!%3D%3Dr.width%26%260!%3D%3Dr.height)%7Bvar%20a%2Co%2Ci%3De.createElement(%22canvas%22)%2Cl%3Di.getContext(%222d%22)%3Bif(i.width%3Dr.width%2Ci.height%3Dr.height%2Ca%3Dd.Generate.parseGradient(n%2Cr))switch(a.type)%7Bcase%22linear%22%3Ao%3Dl.createLinearGradient(a.x0%2Ca.y0%2Ca.x1%2Ca.y1)%2Ca.colorStops.forEach(t(o))%2Cl.fillStyle%3Do%2Cl.fillRect(0%2C0%2Cr.width%2Cr.height)%3Bbreak%3Bcase%22circle%22%3Ao%3Dl.createRadialGradient(a.cx%2Ca.cy%2C0%2Ca.cx%2Ca.cy%2Ca.rx)%2Ca.colorStops.forEach(t(o))%2Cl.fillStyle%3Do%2Cl.fillRect(0%2C0%2Cr.width%2Cr.height)%3Bbreak%3Bcase%22ellipse%22%3Avar%20s%3De.createElement(%22canvas%22)%2Cc%3Ds.getContext(%222d%22)%2Ch%3DMath.max(a.rx%2Ca.ry)%2Cu%3D2*h%3Bs.width%3Ds.height%3Du%2Co%3Dc.createRadialGradient(a.rx%2Ca.ry%2C0%2Ca.rx%2Ca.ry%2Ch)%2Ca.colorStops.forEach(t(o))%2Cc.fillStyle%3Do%2Cc.fillRect(0%2C0%2Cu%2Cu)%2Cl.fillStyle%3Da.colorStops%5Ba.colorStops.length-1%5D.color%2Cl.fillRect(0%2C0%2Ci.width%2Ci.height)%2Cl.drawImage(s%2Ca.cx-a.rx%2Ca.cy-a.ry%2C2*a.rx%2C2*a.ry)%7Dreturn%20i%7D%7D%2Cr.ListAlpha%3Dfunction(t)%7Bvar%20e%2Cn%3D%22%22%3Bdo%20e%3Dt%2526%2Cn%3DString.fromCharCode(e%2B64)%2Bn%2Ct%2F%3D26%3Bwhile(26*t%3E26)%3Breturn%20n%7D%2Cr.ListRoman%3Dfunction(t)%7Bvar%20e%2Cn%3D%5B%22M%22%2C%22CM%22%2C%22D%22%2C%22CD%22%2C%22C%22%2C%22XC%22%2C%22L%22%2C%22XL%22%2C%22X%22%2C%22IX%22%2C%22V%22%2C%22IV%22%2C%22I%22%5D%2Cr%3D%5B1e3%2C900%2C500%2C400%2C100%2C90%2C50%2C40%2C10%2C9%2C5%2C4%2C1%5D%2Ca%3D%22%22%2Co%3Dn.length%3Bif(0%3E%3Dt%7C%7Ct%3E%3D4e3)return%20t%3Bfor(e%3D0%3Bo%3Ee%3Be%2B%3D1)for(%3Bt%3E%3Dr%5Be%5D%3B)t-%3Dr%5Be%5D%2Ca%2B%3Dn%5Be%5D%3Breturn%20a%7D%7D()%2Cd.Parse%3Dfunction(r%2Ca%2Co)%7Bfunction%20i()%7Bvar%20t%3Dbe(e.documentElement%2C%22backgroundColor%22)%2Cn%3Dme.isTransparent(t)%26%26fe%3D%3D%3De.body%2Cr%3Dce(fe%2Cnull%2C!1%2Cn)%3Bs(fe)%2Cue(fe%2Cr%2Cfunction()%7Bn%26%26(t%3Dr.backgroundColor)%2Cc()%2Cme.log(%22Done%20parsing%2C%20moving%20to%20Render.%22)%2Co(%7BbackgroundColor%3At%2Cstack%3Ar%7D)%7D)%7Dfunction%20s(t)%7Bfunction%20n()%7Bfor(var%20t%3D%2F%3Abefore%7C%3Aafter%2F%2Cn%3De.styleSheets%2Cr%3D0%2Ca%3Dn.length%3Ba%3Er%3Br%2B%2B)try%7Bfor(var%20o%3Dn%5Br%5D.cssRules%2Ci%3D0%2Cs%3Do.length%3Bs%3Ei%3Bi%2B%2B)t.test(o%5Bi%5D.selectorText)%26%26l.push(o%5Bi%5D.selectorText)%7Dcatch(c)%7B%7Dfor(r%3D0%2Ca%3Dl.length%3Ba%3Er%3Br%2B%2B)l%5Br%5D%3Dl%5Br%5D.match(%2F(%5E%5B%5E%3A%5D*)%2F)%5B1%5D%7Dfunction%20r()%7Bfor(var%20t%3De.querySelectorAll(l.join(%22%2C%22))%2Cn%3D0%2Cr%3Dt.length%3Br%3En%3Bn%2B%2B)a(t%5Bn%5D)%7Dfunction%20a(t)%7Bvar%20e%3DY(t%2C%22%3Abefore%22)%2Cn%3DY(t%2C%22%3Aafter%22)%3Be%26%26i.push(%7Btype%3A%22before%22%2Cpseudo%3Ae%2Cel%3At%7D)%2Cn%26%26i.push(%7Btype%3A%22after%22%2Cpseudo%3An%2Cel%3At%7D)%7Dfunction%20o()%7Bi.forEach(function(t)%7Bh(t.el%2Cve%2B%22-parent%22)%7D)%2Ci.forEach(function(t)%7B%22before%22%3D%3D%3Dt.type%3Ft.el.insertBefore(t.pseudo%2Ct.el.firstChild)%3At.el.appendChild(t.pseudo)%7D)%7Dvar%20i%3D%5B%5D%2Cl%3D%5B%5D%3Bn()%2Cr(t)%2Co()%7Dfunction%20c()%7Bxe.removeChild(Ce)%3Bfor(var%20t%3De.getElementsByClassName(ve%2B%22-element%22)%3Bt.length%3B)t%5B0%5D.parentNode.removeChild(t%5B0%5D)%3Bfor(var%20n%3De.getElementsByClassName(ve%2B%22-parent%22)%3Bn.length%3B)u(n%5B0%5D%2Cve%2B%22-parent%22)%7Dfunction%20h(t%2Ce)%7Bt.classList%3Ft.classList.add(e)%3At.className%3Dt.className%2B%22%20%22%2Be%7Dfunction%20u(t%2Ce)%7Bt.classList%3Ft.classList.remove(e)%3At.className%3Dt.className.replace(e%2C%22%22).trim()%7Dfunction%20f()%7Breturn%20Math.max(Math.max(ge.body.scrollWidth%2Cge.documentElement.scrollWidth)%2CMath.max(ge.body.offsetWidth%2Cge.documentElement.offsetWidth)%2CMath.max(ge.body.clientWidth%2Cge.documentElement.clientWidth))%7Dfunction%20p()%7Breturn%20Math.max(Math.max(ge.body.scrollHeight%2Cge.documentElement.scrollHeight)%2CMath.max(ge.body.offsetHeight%2Cge.documentElement.offsetHeight)%2CMath.max(ge.body.clientHeight%2Cge.documentElement.clientHeight))%7Dfunction%20g(t%2Ce)%7Bvar%20n%3DparseInt(be(t%2Ce)%2C10)%3Breturn%20isNaN(n)%3F0%3An%7Dfunction%20m(t%2Ce%2Cn%2Cr%2Ca%2Co)%7B%22transparent%22!%3D%3Do%26%26(t.setVariable(%22fillStyle%22%2Co)%2Ct.fillRect(e%2Cn%2Cr%2Ca)%2Cpe%2B%3D1)%7Dfunction%20y(t%2Ce%2Cr)%7Breturn%20t.length%3E0%3Fe%2Br.toUpperCase()%3An%7Dfunction%20w(t%2Ce)%7Bswitch(e)%7Bcase%22lowercase%22%3Areturn%20t.toLowerCase()%3Bcase%22capitalize%22%3Areturn%20t.replace(%2F(%5E%7C%5Cs%7C%3A%7C-%7C%5C(%7C%5C))(%5Ba-z%5D)%2Fg%2Cy)%3Bcase%22uppercase%22%3Areturn%20t.toUpperCase()%3Bdefault%3Areturn%20t%7D%7Dfunction%20x(t)%7Breturn%2F%5E(normal%7Cnone%7C0px)%24%2F.test(t)%7Dfunction%20b(t%2Ce%2Cn%2Cr)%7Bnull!%3D%3Dt%26%26me.trimText(t).length%3E0%26%26(r.fillText(t%2Ce%2Cn)%2Cpe%2B%3D1)%7Dfunction%20v(t%2Ce%2Cr%2Ca)%7Bvar%20o%3D!1%2Ci%3Dbe(e%2C%22fontWeight%22)%2Cl%3Dbe(e%2C%22fontFamily%22)%2Cs%3Dbe(e%2C%22fontSize%22)%2Cc%3Dme.parseTextShadows(be(e%2C%22textShadow%22))%3Bswitch(parseInt(i%2C10))%7Bcase%20401%3Ai%3D%22bold%22%3Bbreak%3Bcase%20400%3Ai%3D%22normal%22%7Dreturn%20t.setVariable(%22fillStyle%22%2Ca)%2Ct.setVariable(%22font%22%2C%5Bbe(e%2C%22fontStyle%22)%2Cbe(e%2C%22fontVariant%22)%2Ci%2Cs%2Cl%5D.join(%22%20%22))%2Ct.setVariable(%22textAlign%22%2Co%3F%22right%22%3A%22left%22)%2Cc.length%26%26(t.setVariable(%22shadowColor%22%2Cc%5B0%5D.color)%2Ct.setVariable(%22shadowOffsetX%22%2Cc%5B0%5D.offsetX)%2Ct.setVariable(%22shadowOffsetY%22%2Cc%5B0%5D.offsetY)%2Ct.setVariable(%22shadowBlur%22%2Cc%5B0%5D.blur))%2C%22none%22!%3D%3Dr%3Fme.Font(l%2Cs%2Cge)%3An%7Dfunction%20C(t%2Ce%2Cn%2Cr%2Ca)%7Bswitch(e)%7Bcase%22underline%22%3Am(t%2Cn.left%2CMath.round(n.top%2Br.baseline%2Br.lineWidth)%2Cn.width%2C1%2Ca)%3Bbreak%3Bcase%22overline%22%3Am(t%2Cn.left%2CMath.round(n.top)%2Cn.width%2C1%2Ca)%3Bbreak%3Bcase%22line-through%22%3Am(t%2Cn.left%2CMath.ceil(n.top%2Br.middle%2Br.lineWidth)%2Cn.width%2C1%2Ca)%7D%7Dfunction%20k(t%2Ce%2Cn%2Cr%2Ca)%7Bvar%20o%3Bif(ye.rangeBounds%26%26!a)(%22none%22!%3D%3Dn%7C%7C0!%3D%3Dme.trimText(e).length)%26%26(o%3DT(e%2Ct.node%2Ct.textOffset))%2Ct.textOffset%2B%3De.length%3Belse%20if(t.node%26%26%22string%22%3D%3Dtypeof%20t.node.nodeValue)%7Bvar%20i%3Dr%3Ft.node.splitText(e.length)%3Anull%3Bo%3DS(t.node%2Ca)%2Ct.node%3Di%7Dreturn%20o%7Dfunction%20T(t%2Ce%2Cn)%7Bvar%20r%3Dge.createRange()%3Breturn%20r.setStart(e%2Cn)%2Cr.setEnd(e%2Cn%2Bt.length)%2Cr.getBoundingClientRect()%7Dfunction%20S(t%2Ce)%7Bvar%20n%3Dt.parentNode%2Cr%3Dge.createElement(%22wrapper%22)%2Ca%3Dt.cloneNode(!0)%3Br.appendChild(t.cloneNode(!0))%2Cn.replaceChild(r%2Ct)%3Bvar%20o%3De%3Fme.OffsetBounds(r)%3Ame.Bounds(r)%3Breturn%20n.replaceChild(a%2Cr)%2Co%7Dfunction%20E(t%2Ce%2Cn)%7Bvar%20r%2Co%2Ci%3Dn.ctx%2Cl%3Dbe(t%2C%22color%22)%2Cs%3Dbe(t%2C%22textDecoration%22)%2Cc%3Dbe(t%2C%22textAlign%22)%2Cd%3D%7Bnode%3Ae%2CtextOffset%3A0%7D%3Bme.trimText(e.nodeValue).length%3E0%26%26(e.nodeValue%3Dw(e.nodeValue%2Cbe(t%2C%22textTransform%22))%2Cc%3Dc.replace(%5B%22-webkit-auto%22%5D%2C%5B%22auto%22%5D)%2Co%3D!a.letterRendering%26%26%2F%5E(left%7Cright%7Cjustify%7Cauto)%24%2F.test(c)%26%26x(be(t%2C%22letterSpacing%22))%3Fe.nodeValue.split(%2F(%5Cb%7C%20)%2F)%3Ae.nodeValue.split(%22%22)%2Cr%3Dv(i%2Ct%2Cs%2Cl)%2Ca.chinese%26%26o.forEach(function(t%2Ce)%7B%2F.*%5B%5Cu4E00-%5Cu9FA5%5D.*%24%2F.test(t)%26%26(t%3Dt.split(%22%22)%2Ct.unshift(e%2C1)%2Co.splice.apply(o%2Ct))%7D)%2Co.forEach(function(t%2Ce)%7Bvar%20a%3Dk(d%2Ct%2Cs%2Co.length-1%3Ee%2Cn.transform.matrix)%3Ba%26%26(b(t%2Ca.left%2Ca.bottom%2Ci)%2CC(i%2Cs%2Ca%2Cr%2Cl))%7D))%7Dfunction%20R(t%2Ce)%7Bvar%20n%2Cr%2Ca%3Dge.createElement(%22boundelement%22)%3Breturn%20a.style.display%3D%22inline%22%2Cn%3Dt.style.listStyleType%2Ct.style.listStyleType%3D%22none%22%2Ca.appendChild(ge.createTextNode(e))%2Ct.insertBefore(a%2Ct.firstChild)%2Cr%3Dme.Bounds(a)%2Ct.removeChild(a)%2Ct.style.listStyleType%3Dn%2Cr%7Dfunction%20M(t)%7Bvar%20e%3D-1%2Cn%3D1%2Cr%3Dt.parentNode.childNodes%3Bif(t.parentNode)%7Bfor(%3Br%5B%2B%2Be%5D!%3D%3Dt%3B)1%3D%3D%3Dr%5Be%5D.nodeType%26%26n%2B%2B%3Breturn%20n%7Dreturn-1%7Dfunction%20I(t%2Ce)%7Bvar%20n%2Cr%3DM(t)%3Bswitch(e)%7Bcase%22decimal%22%3An%3Dr%3Bbreak%3Bcase%22decimal-leading-zero%22%3An%3D1%3D%3D%3D(%22%22%2Br).length%3Fr%3D%220%22%2B(%22%22%2Br)%3A%22%22%2Br%3Bbreak%3Bcase%22upper-roman%22%3An%3Dd.Generate.ListRoman(r)%3Bbreak%3Bcase%22lower-roman%22%3An%3Dd.Generate.ListRoman(r).toLowerCase()%3Bbreak%3Bcase%22lower-alpha%22%3An%3Dd.Generate.ListAlpha(r).toLowerCase()%3Bbreak%3Bcase%22upper-alpha%22%3An%3Dd.Generate.ListAlpha(r)%7Dreturn%20n%2B%22.%20%22%7Dfunction%20L(t%2Ce%2Cn)%7Bvar%20r%2Ca%2Co%2Ci%3De.ctx%2Cl%3Dbe(t%2C%22listStyleType%22)%3Bif(%2F%5E(decimal%7Cdecimal-leading-zero%7Cupper-alpha%7Cupper-latin%7Cupper-roman%7Clower-alpha%7Clower-greek%7Clower-latin%7Clower-roman)%24%2Fi.test(l))%7Bif(a%3DI(t%2Cl)%2Co%3DR(t%2Ca)%2Cv(i%2Ct%2C%22none%22%2Cbe(t%2C%22color%22))%2C%22inside%22!%3D%3Dbe(t%2C%22listStylePosition%22))return%3Bi.setVariable(%22textAlign%22%2C%22left%22)%2Cr%3Dn.left%2Cb(a%2Cr%2Co.bottom%2Ci)%7D%7Dfunction%20O(t)%7Bvar%20e%3Dr%5Bt%5D%3Breturn%20e%26%26e.succeeded%3D%3D%3D!0%3Fe.img%3A!1%7Dfunction%20z(t%2Ce)%7Bvar%20n%3DMath.max(t.left%2Ce.left)%2Cr%3DMath.max(t.top%2Ce.top)%2Ca%3DMath.min(t.left%2Bt.width%2Ce.left%2Be.width)%2Co%3DMath.min(t.top%2Bt.height%2Ce.top%2Be.height)%3Breturn%7Bleft%3An%2Ctop%3Ar%2Cwidth%3Aa-n%2Cheight%3Ao-r%7D%7Dfunction%20B(t%2Ce%2Cn)%7Bvar%20r%2Ca%3D%22static%22!%3D%3De.cssPosition%2Co%3Da%3Fbe(t%2C%22zIndex%22)%3A%22auto%22%2Ci%3Dbe(t%2C%22opacity%22)%2Cl%3D%22none%22!%3D%3Dbe(t%2C%22cssFloat%22)%3Be.zIndex%3Dr%3DU(o)%2Cr.isPositioned%3Da%2Cr.isFloated%3Dl%2Cr.opacity%3Di%2Cr.ownStacking%3D%22auto%22!%3D%3Do%7C%7C1%3Ei%2Cr.depth%3Dn%3Fn.zIndex.depth%2B1%3A0%2Cn%26%26n.zIndex.children.push(e)%7Dfunction%20U(t)%7Breturn%7Bdepth%3A0%2Czindex%3At%2Cchildren%3A%5B%5D%7D%7Dfunction%20A(t%2Ce%2Cn%2Cr%2Ca)%7Bvar%20o%3Dg(e%2C%22paddingLeft%22)%2Ci%3Dg(e%2C%22paddingTop%22)%2Cl%3Dg(e%2C%22paddingRight%22)%2Cs%3Dg(e%2C%22paddingBottom%22)%3B_(t%2Cn%2C0%2C0%2Cn.width%2Cn.height%2Cr.left%2Bo%2Ba%5B3%5D.width%2Cr.top%2Bi%2Ba%5B0%5D.width%2Cr.width-(a%5B1%5D.width%2Ba%5B3%5D.width%2Bo%2Bl)%2Cr.height-(a%5B0%5D.width%2Ba%5B2%5D.width%2Bi%2Bs))%7Dfunction%20N(t)%7Breturn%5B%22Top%22%2C%22Right%22%2C%22Bottom%22%2C%22Left%22%5D.map(function(e)%7Breturn%7Bwidth%3Ag(t%2C%22border%22%2Be%2B%22Width%22)%2Ccolor%3Abe(t%2C%22border%22%2Be%2B%22Color%22)%7D%7D)%7Dfunction%20P(t)%7Breturn%5B%22TopLeft%22%2C%22TopRight%22%2C%22BottomRight%22%2C%22BottomLeft%22%5D.map(function(e)%7Breturn%20be(t%2C%22border%22%2Be%2B%22Radius%22)%7D)%7Dfunction%20F(t%2Ce%2Cn%2Cr)%7Bvar%20a%3D4*((Math.sqrt(2)-1)%2F3)%2Co%3Dn*a%2Ci%3Dr*a%2Cl%3Dt%2Bn%2Cs%3De%2Br%3Breturn%7BtopLeft%3AV(%7Bx%3At%2Cy%3As%7D%2C%7Bx%3At%2Cy%3As-i%7D%2C%7Bx%3Al-o%2Cy%3Ae%7D%2C%7Bx%3Al%2Cy%3Ae%7D)%2CtopRight%3AV(%7Bx%3At%2Cy%3Ae%7D%2C%7Bx%3At%2Bo%2Cy%3Ae%7D%2C%7Bx%3Al%2Cy%3As-i%7D%2C%7Bx%3Al%2Cy%3As%7D)%2CbottomRight%3AV(%7Bx%3Al%2Cy%3Ae%7D%2C%7Bx%3Al%2Cy%3Ae%2Bi%7D%2C%7Bx%3At%2Bo%2Cy%3As%7D%2C%7Bx%3At%2Cy%3As%7D)%2CbottomLeft%3AV(%7Bx%3Al%2Cy%3As%7D%2C%7Bx%3Al-o%2Cy%3As%7D%2C%7Bx%3At%2Cy%3Ae%2Bi%7D%2C%7Bx%3At%2Cy%3Ae%7D)%7D%7Dfunction%20V(t%2Ce%2Cn%2Cr)%7Bvar%20a%3Dfunction(t%2Ce%2Cn)%7Breturn%7Bx%3At.x%2B(e.x-t.x)*n%2Cy%3At.y%2B(e.y-t.y)*n%7D%7D%3Breturn%7Bstart%3At%2CstartControl%3Ae%2CendControl%3An%2Cend%3Ar%2Csubdivide%3Afunction(o)%7Bvar%20i%3Da(t%2Ce%2Co)%2Cl%3Da(e%2Cn%2Co)%2Cs%3Da(n%2Cr%2Co)%2Cc%3Da(i%2Cl%2Co)%2Cd%3Da(l%2Cs%2Co)%2Ch%3Da(c%2Cd%2Co)%3Breturn%5BV(t%2Ci%2Cc%2Ch)%2CV(h%2Cd%2Cs%2Cr)%5D%7D%2CcurveTo%3Afunction(t)%7Bt.push(%5B%22bezierCurve%22%2Ce.x%2Ce.y%2Cn.x%2Cn.y%2Cr.x%2Cr.y%5D)%7D%2CcurveToReversed%3Afunction(r)%7Br.push(%5B%22bezierCurve%22%2Cn.x%2Cn.y%2Ce.x%2Ce.y%2Ct.x%2Ct.y%5D)%7D%7D%7Dfunction%20D(t%2Ce%2Cn%2Cr%2Ca%2Co%2Ci)%7Be%5B0%5D%3E0%7C%7Ce%5B1%5D%3E0%3F(t.push(%5B%22line%22%2Cr%5B0%5D.start.x%2Cr%5B0%5D.start.y%5D)%2Cr%5B0%5D.curveTo(t)%2Cr%5B1%5D.curveTo(t))%3At.push(%5B%22line%22%2Co%2Ci%5D)%2C(n%5B0%5D%3E0%7C%7Cn%5B1%5D%3E0)%26%26t.push(%5B%22line%22%2Ca%5B0%5D.start.x%2Ca%5B0%5D.start.y%5D)%7Dfunction%20%24(t%2Ce%2Cn%2Cr%2Ca%2Co%2Ci)%7Bvar%20l%3D%5B%5D%3Breturn%20e%5B0%5D%3E0%7C%7Ce%5B1%5D%3E0%3F(l.push(%5B%22line%22%2Cr%5B1%5D.start.x%2Cr%5B1%5D.start.y%5D)%2Cr%5B1%5D.curveTo(l))%3Al.push(%5B%22line%22%2Ct.c1%5B0%5D%2Ct.c1%5B1%5D%5D)%2Cn%5B0%5D%3E0%7C%7Cn%5B1%5D%3E0%3F(l.push(%5B%22line%22%2Co%5B0%5D.start.x%2Co%5B0%5D.start.y%5D)%2Co%5B0%5D.curveTo(l)%2Cl.push(%5B%22line%22%2Ci%5B0%5D.end.x%2Ci%5B0%5D.end.y%5D)%2Ci%5B0%5D.curveToReversed(l))%3A(l.push(%5B%22line%22%2Ct.c2%5B0%5D%2Ct.c2%5B1%5D%5D)%2Cl.push(%5B%22line%22%2Ct.c3%5B0%5D%2Ct.c3%5B1%5D%5D))%2Ce%5B0%5D%3E0%7C%7Ce%5B1%5D%3E0%3F(l.push(%5B%22line%22%2Ca%5B1%5D.end.x%2Ca%5B1%5D.end.y%5D)%2Ca%5B1%5D.curveToReversed(l))%3Al.push(%5B%22line%22%2Ct.c4%5B0%5D%2Ct.c4%5B1%5D%5D)%2Cl%7Dfunction%20G(t%2Ce%2Cn)%7Bvar%20r%3Dt.left%2Ca%3Dt.top%2Co%3Dt.width%2Ci%3Dt.height%2Cl%3De%5B0%5D%5B0%5D%2Cs%3De%5B0%5D%5B1%5D%2Cc%3De%5B1%5D%5B0%5D%2Cd%3De%5B1%5D%5B1%5D%2Ch%3De%5B2%5D%5B0%5D%2Cu%3De%5B2%5D%5B1%5D%2Cf%3De%5B3%5D%5B0%5D%2Cp%3De%5B3%5D%5B1%5D%2Cg%3Do-c%2Cm%3Di-u%2Cy%3Do-h%2Cw%3Di-p%3Breturn%7BtopLeftOuter%3AF(r%2Ca%2Cl%2Cs).topLeft.subdivide(.5)%2CtopLeftInner%3AF(r%2Bn%5B3%5D.width%2Ca%2Bn%5B0%5D.width%2CMath.max(0%2Cl-n%5B3%5D.width)%2CMath.max(0%2Cs-n%5B0%5D.width)).topLeft.subdivide(.5)%2CtopRightOuter%3AF(r%2Bg%2Ca%2Cc%2Cd).topRight.subdivide(.5)%2CtopRightInner%3AF(r%2BMath.min(g%2Co%2Bn%5B3%5D.width)%2Ca%2Bn%5B0%5D.width%2Cg%3Eo%2Bn%5B3%5D.width%3F0%3Ac-n%5B3%5D.width%2Cd-n%5B0%5D.width).topRight.subdivide(.5)%2CbottomRightOuter%3AF(r%2By%2Ca%2Bm%2Ch%2Cu).bottomRight.subdivide(.5)%2CbottomRightInner%3AF(r%2BMath.min(y%2Co%2Bn%5B3%5D.width)%2Ca%2BMath.min(m%2Ci%2Bn%5B0%5D.width)%2CMath.max(0%2Ch-n%5B1%5D.width)%2CMath.max(0%2Cu-n%5B2%5D.width)).bottomRight.subdivide(.5)%2CbottomLeftOuter%3AF(r%2Ca%2Bw%2Cf%2Cp).bottomLeft.subdivide(.5)%2CbottomLeftInner%3AF(r%2Bn%5B3%5D.width%2Ca%2Bw%2CMath.max(0%2Cf-n%5B3%5D.width)%2CMath.max(0%2Cp-n%5B2%5D.width)).bottomLeft.subdivide(.5)%7D%7Dfunction%20W(t%2Ce%2Cn%2Cr%2Ca)%7Bvar%20o%3Dbe(t%2C%22backgroundClip%22)%2Ci%3D%5B%5D%3Bswitch(o)%7Bcase%22content-box%22%3Acase%22padding-box%22%3AD(i%2Cr%5B0%5D%2Cr%5B1%5D%2Ce.topLeftInner%2Ce.topRightInner%2Ca.left%2Bn%5B3%5D.width%2Ca.top%2Bn%5B0%5D.width)%2CD(i%2Cr%5B1%5D%2Cr%5B2%5D%2Ce.topRightInner%2Ce.bottomRightInner%2Ca.left%2Ba.width-n%5B1%5D.width%2Ca.top%2Bn%5B0%5D.width)%2CD(i%2Cr%5B2%5D%2Cr%5B3%5D%2Ce.bottomRightInner%2Ce.bottomLeftInner%2Ca.left%2Ba.width-n%5B1%5D.width%2Ca.top%2Ba.height-n%5B2%5D.width)%2CD(i%2Cr%5B3%5D%2Cr%5B0%5D%2Ce.bottomLeftInner%2Ce.topLeftInner%2Ca.left%2Bn%5B3%5D.width%2Ca.top%2Ba.height-n%5B2%5D.width)%3Bbreak%3Bdefault%3AD(i%2Cr%5B0%5D%2Cr%5B1%5D%2Ce.topLeftOuter%2Ce.topRightOuter%2Ca.left%2Ca.top)%2CD(i%2Cr%5B1%5D%2Cr%5B2%5D%2Ce.topRightOuter%2Ce.bottomRightOuter%2Ca.left%2Ba.width%2Ca.top)%2CD(i%2Cr%5B2%5D%2Cr%5B3%5D%2Ce.bottomRightOuter%2Ce.bottomLeftOuter%2Ca.left%2Ba.width%2Ca.top%2Ba.height)%2CD(i%2Cr%5B3%5D%2Cr%5B0%5D%2Ce.bottomLeftOuter%2Ce.topLeftOuter%2Ca.left%2Ca.top%2Ba.height)%7Dreturn%20i%7Dfunction%20H(t%2Ce%2Cn)%7Bvar%20r%2Ca%2Co%2Ci%2Cl%2Cs%2Cc%3De.left%2Cd%3De.top%2Ch%3De.width%2Cu%3De.height%2Cf%3DP(t)%2Cp%3DG(e%2Cf%2Cn)%2Cg%3D%7Bclip%3AW(t%2Cp%2Cn%2Cf%2Ce)%2Cborders%3A%5B%5D%7D%3Bfor(r%3D0%3B4%3Er%3Br%2B%2B)if(n%5Br%5D.width%3E0)%7Bswitch(a%3Dc%2Co%3Dd%2Ci%3Dh%2Cl%3Du-n%5B2%5D.width%2Cr)%7Bcase%200%3Al%3Dn%5B0%5D.width%2Cs%3D%24(%7Bc1%3A%5Ba%2Co%5D%2Cc2%3A%5Ba%2Bi%2Co%5D%2Cc3%3A%5Ba%2Bi-n%5B1%5D.width%2Co%2Bl%5D%2Cc4%3A%5Ba%2Bn%5B3%5D.width%2Co%2Bl%5D%7D%2Cf%5B0%5D%2Cf%5B1%5D%2Cp.topLeftOuter%2Cp.topLeftInner%2Cp.topRightOuter%2Cp.topRightInner)%3Bbreak%3Bcase%201%3Aa%3Dc%2Bh-n%5B1%5D.width%2Ci%3Dn%5B1%5D.width%2Cs%3D%24(%7Bc1%3A%5Ba%2Bi%2Co%5D%2Cc2%3A%5Ba%2Bi%2Co%2Bl%2Bn%5B2%5D.width%5D%2Cc3%3A%5Ba%2Co%2Bl%5D%2Cc4%3A%5Ba%2Co%2Bn%5B0%5D.width%5D%7D%2Cf%5B1%5D%2Cf%5B2%5D%2Cp.topRightOuter%2Cp.topRightInner%2Cp.bottomRightOuter%2Cp.bottomRightInner)%3Bbreak%3Bcase%202%3Ao%3Do%2Bu-n%5B2%5D.width%2Cl%3Dn%5B2%5D.width%2Cs%3D%24(%7Bc1%3A%5Ba%2Bi%2Co%2Bl%5D%2Cc2%3A%5Ba%2Co%2Bl%5D%2Cc3%3A%5Ba%2Bn%5B3%5D.width%2Co%5D%2Cc4%3A%5Ba%2Bi-n%5B3%5D.width%2Co%5D%7D%2Cf%5B2%5D%2Cf%5B3%5D%2Cp.bottomRightOuter%2Cp.bottomRightInner%2Cp.bottomLeftOuter%2Cp.bottomLeftInner)%3Bbreak%3Bcase%203%3Ai%3Dn%5B3%5D.width%2Cs%3D%24(%7Bc1%3A%5Ba%2Co%2Bl%2Bn%5B2%5D.width%5D%2Cc2%3A%5Ba%2Co%5D%2Cc3%3A%5Ba%2Bi%2Co%2Bn%5B0%5D.width%5D%2Cc4%3A%5Ba%2Bi%2Co%2Bl%5D%7D%2Cf%5B3%5D%2Cf%5B0%5D%2Cp.bottomLeftOuter%2Cp.bottomLeftInner%2Cp.topLeftOuter%2Cp.topLeftInner)%7Dg.borders.push(%7Bargs%3As%2Ccolor%3An%5Br%5D.color%7D)%7Dreturn%20g%7Dfunction%20j(t%2Ce)%7Bvar%20n%3Dt.drawShape()%3Breturn%20e.forEach(function(t%2Ce)%7Bn%5B0%3D%3D%3De%3F%22moveTo%22%3At%5B0%5D%2B%22To%22%5D.apply(null%2Ct.slice(1))%7D)%2Cn%7Dfunction%20q(t%2Ce%2Cn)%7B%22transparent%22!%3D%3Dn%26%26(t.setVariable(%22fillStyle%22%2Cn)%2Cj(t%2Ce)%2Ct.fill()%2Cpe%2B%3D1)%7Dfunction%20X(t%2Ce%2Cn)%7Bvar%20r%2Ca%2Co%3Dge.createElement(%22valuewrap%22)%2Ci%3D%5B%22lineHeight%22%2C%22textAlign%22%2C%22fontFamily%22%2C%22color%22%2C%22fontSize%22%2C%22paddingLeft%22%2C%22paddingTop%22%2C%22width%22%2C%22height%22%2C%22border%22%2C%22borderLeftWidth%22%2C%22borderTopWidth%22%5D%3Bi.forEach(function(e)%7Btry%7Bo.style%5Be%5D%3Dbe(t%2Ce)%7Dcatch(n)%7Bme.log(%22html2canvas%3A%20Parse%3A%20Exception%20caught%20in%20renderFormValue%3A%20%22%2Bn.message)%7D%7D)%2Co.style.borderColor%3D%22black%22%2Co.style.borderStyle%3D%22solid%22%2Co.style.display%3D%22block%22%2Co.style.position%3D%22absolute%22%2C(%2F%5E(submit%7Creset%7Cbutton%7Ctext%7Cpassword)%24%2F.test(t.type)%7C%7C%22SELECT%22%3D%3D%3Dt.nodeName)%26%26(o.style.lineHeight%3Dbe(t%2C%22height%22))%2Co.style.top%3De.top%2B%22px%22%2Co.style.left%3De.left%2B%22px%22%2Cr%3D%22SELECT%22%3D%3D%3Dt.nodeName%3F(t.options%5Bt.selectedIndex%5D%7C%7C0).text%3At.value%2Cr%7C%7C(r%3Dt.placeholder)%2Ca%3Dge.createTextNode(r)%2Co.appendChild(a)%2Cxe.appendChild(o)%2CE(t%2Ca%2Cn)%2Cxe.removeChild(o)%7Dfunction%20_(t)%7Bt.drawImage.apply(t%2CArray.prototype.slice.call(arguments%2C1))%2Cpe%2B%3D1%7Dfunction%20Y(n%2Cr)%7Bvar%20a%3Dt.getComputedStyle(n%2Cr)%2Co%3Dt.getComputedStyle(n)%3Bif(a%26%26a.content%26%26%22none%22!%3D%3Da.content%26%26%22-moz-alt-content%22!%3D%3Da.content%26%26%22none%22!%3D%3Da.display%26%26o.content!%3D%3Da.content)%7Bvar%20i%3Da.content%2B%22%22%3B(%22%27%22%3D%3D%3Di%5B0%5D%7C%7C%27%22%27%3D%3D%3Di%5B0%5D)%26%26(i%3Di.replace(%2F(%5E%5B%27%22%5D)%7C(%5B%27%22%5D%24)%2Fg%2C%22%22))%3Bvar%20l%3D%22url%22%3D%3D%3Di.substr(0%2C3)%2Cs%3De.createElement(l%3F%22img%22%3A%22span%22)%3Breturn%20s.className%3Dve%2B%22-element%20%22%2CObject.keys(a).filter(Q).forEach(function(t)%7Btry%7Bs.style%5Bt%5D%3Da%5Bt%5D%7Dcatch(e)%7Bme.log(%5B%22Tried%20to%20assign%20readonly%20property%20%22%2Ct%2C%22Error%3A%22%2Ce%5D)%7D%7D)%2Cl%3Fs.src%3Dme.parseBackgroundImage(i)%5B0%5D.args%5B0%5D%3As.innerHTML%3Di%2Cs%7D%7Dfunction%20Q(e)%7Breturn%20isNaN(t.parseInt(e%2C10))%7Dfunction%20J(t%2Ce%2Cn%2Cr)%7Bvar%20a%3DMath.round(r.left%2Bn.left)%2Co%3DMath.round(r.top%2Bn.top)%3Bt.createPattern(e)%2Ct.translate(a%2Co)%2Ct.fill()%2Ct.translate(-a%2C-o)%7Dfunction%20K(t%2Ce%2Cn%2Cr%2Ca%2Co%2Ci%2Cl)%7Bvar%20s%3D%5B%5D%3Bs.push(%5B%22line%22%2CMath.round(a)%2CMath.round(o)%5D)%2Cs.push(%5B%22line%22%2CMath.round(a%2Bi)%2CMath.round(o)%5D)%2Cs.push(%5B%22line%22%2CMath.round(a%2Bi)%2CMath.round(l%2Bo)%5D)%2Cs.push(%5B%22line%22%2CMath.round(a)%2CMath.round(l%2Bo)%5D)%2Cj(t%2Cs)%2Ct.save()%2Ct.clip()%2CJ(t%2Ce%2Cn%2Cr)%2Ct.restore()%7Dfunction%20Z(t%2Ce%2Cn)%7Bm(t%2Ce.left%2Ce.top%2Ce.width%2Ce.height%2Cn)%7Dfunction%20te(t%2Ce%2Cn%2Cr%2Ca)%7Bvar%20o%3Dme.BackgroundSize(t%2Ce%2Cr%2Ca)%2Ci%3Dme.BackgroundPosition(t%2Ce%2Cr%2Ca%2Co)%2Cl%3Dme.BackgroundRepeat(t%2Ca)%3Bswitch(r%3Dne(r%2Co)%2Cl)%7Bcase%22repeat-x%22%3Acase%22repeat%20no-repeat%22%3AK(n%2Cr%2Ci%2Ce%2Ce.left%2Ce.top%2Bi.top%2C99999%2Cr.height)%3Bbreak%3Bcase%22repeat-y%22%3Acase%22no-repeat%20repeat%22%3AK(n%2Cr%2Ci%2Ce%2Ce.left%2Bi.left%2Ce.top%2Cr.width%2C99999)%3Bbreak%3Bcase%22no-repeat%22%3AK(n%2Cr%2Ci%2Ce%2Ce.left%2Bi.left%2Ce.top%2Bi.top%2Cr.width%2Cr.height)%3Bbreak%3Bdefault%3AJ(n%2Cr%2Ci%2C%7Btop%3Ae.top%2Cleft%3Ae.left%2Cwidth%3Ar.width%2Cheight%3Ar.height%7D)%7D%7Dfunction%20ee(t%2Ce%2Cn)%7Bfor(var%20r%2Ca%3Dbe(t%2C%22backgroundImage%22)%2Co%3Dme.parseBackgroundImage(a)%2Ci%3Do.length%3Bi--%3B)if(a%3Do%5Bi%5D%2Ca.args%26%260!%3D%3Da.args.length)%7Bvar%20l%3D%22url%22%3D%3D%3Da.method%3Fa.args%5B0%5D%3Aa.value%3Br%3DO(l)%2Cr%3Fte(t%2Ce%2Cn%2Cr%2Ci)%3Ame.log(%22html2canvas%3A%20Error%20loading%20background%3A%22%2Ca)%7D%7Dfunction%20ne(t%2Ce)%7Bif(t.width%3D%3D%3De.width%26%26t.height%3D%3D%3De.height)return%20t%3Bvar%20n%2Cr%3Dge.createElement(%22canvas%22)%3Breturn%20r.width%3De.width%2Cr.height%3De.height%2Cn%3Dr.getContext(%222d%22)%2C_(n%2Ct%2C0%2C0%2Ct.width%2Ct.height%2C0%2C0%2Ce.width%2Ce.height)%2Cr%7Dfunction%20re(t%2Ce%2Cn)%7Breturn%20t.setVariable(%22globalAlpha%22%2Cbe(e%2C%22opacity%22)*(n%3Fn.opacity%3A1))%7Dfunction%20ae(t)%7Breturn%20t.replace(%22px%22%2C%22%22)%7Dfunction%20oe(t)%7Bvar%20e%3D%2F(matrix)%5C((.%2B)%5C)%2F%2Cn%3Dbe(t%2C%22transform%22)%7C%7Cbe(t%2C%22-webkit-transform%22)%7C%7Cbe(t%2C%22-moz-transform%22)%7C%7Cbe(t%2C%22-ms-transform%22)%7C%7Cbe(t%2C%22-o-transform%22)%2Cr%3Dbe(t%2C%22transform-origin%22)%7C%7Cbe(t%2C%22-webkit-transform-origin%22)%7C%7Cbe(t%2C%22-moz-transform-origin%22)%7C%7Cbe(t%2C%22-ms-transform-origin%22)%7C%7Cbe(t%2C%22-o-transform-origin%22)%7C%7C%220px%200px%22%3Br%3Dr.split(%22%20%22).map(ae).map(me.asFloat)%3Bvar%20a%3Bif(n%26%26%22none%22!%3D%3Dn)%7Bvar%20o%3Dn.match(e)%3Bif(o)switch(o%5B1%5D)%7Bcase%22matrix%22%3Aa%3Do%5B2%5D.split(%22%2C%22).map(me.trimText).map(me.asFloat)%7D%7Dreturn%7Borigin%3Ar%2Cmatrix%3Aa%7D%7Dfunction%20ie(t%2Ce%2Cn%2Cr)%7Bvar%20o%3Dl(e%3Fn.width%3Af()%2Ce%3Fn.height%3Ap())%2Ci%3D%7Bctx%3Ao%2Copacity%3Are(o%2Ct%2Ce)%2CcssPosition%3Abe(t%2C%22position%22)%2Cborders%3AN(t)%2Ctransform%3Ar%2Cclip%3Ae%26%26e.clip%3Fme.Extend(%7B%7D%2Ce.clip)%3Anull%7D%3Breturn%20B(t%2Ci%2Ce)%2Ca.useOverflow%3D%3D%3D!0%26%26%2F(hidden%7Cscroll%7Cauto)%2F.test(be(t%2C%22overflow%22))%3D%3D%3D!0%26%26%2F(BODY)%2Fi.test(t.nodeName)%3D%3D%3D!1%26%26(i.clip%3Di.clip%3Fz(i.clip%2Cn)%3An)%2Ci%7Dfunction%20le(t%2Ce%2Cn)%7Bvar%20r%3D%7Bleft%3Ae.left%2Bt%5B3%5D.width%2Ctop%3Ae.top%2Bt%5B0%5D.width%2Cwidth%3Ae.width-(t%5B1%5D.width%2Bt%5B3%5D.width)%2Cheight%3Ae.height-(t%5B0%5D.width%2Bt%5B2%5D.width)%7D%3Breturn%20n%26%26(r%3Dz(r%2Cn))%2Cr%7Dfunction%20se(t%2Ce)%7Bvar%20n%3De.matrix%3Fme.OffsetBounds(t)%3Ame.Bounds(t)%3Breturn%20e.origin%5B0%5D%2B%3Dn.left%2Ce.origin%5B1%5D%2B%3Dn.top%2Cn%7Dfunction%20ce(t%2Ce%2Cn)%7Bvar%20r%2Ca%3Doe(t%2Ce)%2Co%3Dse(t%2Ca)%2Ci%3Die(t%2Ce%2Co%2Ca)%2Cl%3Di.borders%2Cs%3Di.ctx%2Cc%3Dle(l%2Co%2Ci.clip)%2Cd%3DH(t%2Co%2Cl)%2Ch%3Dwe.test(t.nodeName)%3F%22%23efefef%22%3Abe(t%2C%22backgroundColor%22)%3Bswitch(j(s%2Cd.clip)%2Cs.save()%2Cs.clip()%2Cc.height%3E0%26%26c.width%3E0%26%26!n%3F(Z(s%2Co%2Ch)%2Cee(t%2Cc%2Cs))%3An%26%26(i.backgroundColor%3Dh)%2Cs.restore()%2Cd.borders.forEach(function(t)%7Bq(s%2Ct.args%2Ct.color)%7D)%2Ct.nodeName)%7Bcase%22IMG%22%3A(r%3DO(t.getAttribute(%22src%22)))%3FA(s%2Ct%2Cr%2Co%2Cl)%3Ame.log(%22html2canvas%3A%20Error%20loading%20%3Cimg%3E%3A%22%2Bt.getAttribute(%22src%22))%3Bbreak%3Bcase%22INPUT%22%3A%2F%5E(text%7Curl%7Cemail%7Csubmit%7Cbutton%7Creset)%24%2F.test(t.type)%26%26(t.value%7C%7Ct.placeholder%7C%7C%22%22).length%3E0%26%26X(t%2Co%2Ci)%3Bbreak%3Bcase%22TEXTAREA%22%3A(t.value%7C%7Ct.placeholder%7C%7C%22%22).length%3E0%26%26X(t%2Co%2Ci)%3Bbreak%3Bcase%22SELECT%22%3A(t.options%7C%7Ct.placeholder%7C%7C%22%22).length%3E0%26%26X(t%2Co%2Ci)%3Bbreak%3Bcase%22LI%22%3AL(t%2Ci%2Cc)%3Bbreak%3Bcase%22CANVAS%22%3AA(s%2Ct%2Ct%2Co%2Cl)%7Dreturn%20i%7Dfunction%20de(t)%7Breturn%22none%22!%3D%3Dbe(t%2C%22display%22)%26%26%22hidden%22!%3D%3Dbe(t%2C%22visibility%22)%26%26!t.hasAttribute(%22data-html2canvas-ignore%22)%7Dfunction%20he(t%2Ce%2Cr)%7Breturn%20r%7C%7C(r%3Dfunction()%7B%7D)%2Cde(t)%26%26(e%3Dce(t%2Ce%2C!1)%7C%7Ce%2C!we.test(t.nodeName))%3Fue(t%2Ce%2Cr)%3A(r()%2Cn)%7Dfunction%20ue(t%2Ce%2Cn)%7Bfunction%20r(n)%7Bn.nodeType%3D%3D%3Dn.ELEMENT_NODE%3Fhe(n%2Ce%2Co)%3An.nodeType%3D%3D%3Dn.TEXT_NODE%3F(E(t%2Cn%2Ce)%2Co())%3Ao()%7Dfunction%20o()%7B0%3E%3D--l%26%26(me.log(%22finished%20rendering%20%22%2Bi.length%2B%22%20children.%22)%2Cn())%7Dvar%20i%3Dme.Children(t)%2Cl%3Di.length%2B1%3Bo()%2Ca.async%3Fi.forEach(function(t)%7BsetTimeout(function()%7Br(t)%7D%2C0)%7D)%3Ai.forEach(r)%7Dt.scroll(0%2C0)%3Bvar%20fe%3Da.elements%3D%3D%3Dn%3Fe.body%3Aa.elements%5B0%5D%2Cpe%3D0%2Cge%3Dfe.ownerDocument%2Cme%3Dd.Util%2Cye%3Dme.Support(a%2Cge)%2Cwe%3DRegExp(%22(%22%2Ba.ignoreElements%2B%22)%22)%2Cxe%3Dge.body%2Cbe%3Dme.getCSS%2Cve%3D%22___html2canvas___pseudoelement%22%2CCe%3Dge.createElement(%22style%22)%3BCe.innerHTML%3D%22.%22%2Bve%2B%27-parent%3Abefore%20%7B%20content%3A%20%22%22%20!important%3B%20display%3A%20none%20!important%3B%20%7D%27%2B%22.%22%2Bve%2B%27-parent%3Aafter%20%7B%20content%3A%20%22%22%20!important%3B%20display%3A%20none%20!important%3B%20%7D%27%2Cxe.appendChild(Ce)%2Cr%3Dr%7C%7C%7B%7D%2Ci()%7D%2Cd.Preload%3Dfunction(r)%7Bfunction%20a(t)%7BE.href%3Dt%2CE.href%3DE.href%3Bvar%20e%3DE.protocol%2BE.host%3Breturn%20e%3D%3D%3Dg%7Dfunction%20o()%7Bb.log(%22html2canvas%3A%20start%3A%20images%3A%20%22%2Bx.numLoaded%2B%22%20%2F%20%22%2Bx.numTotal%2B%22%20(failed%3A%20%22%2Bx.numFailed%2B%22)%22)%2C!x.firstRun%26%26x.numLoaded%3E%3Dx.numTotal%26%26(b.log(%22Finished%20loading%20images%3A%20%23%20%22%2Bx.numTotal%2B%22%20(failed%3A%20%22%2Bx.numFailed%2B%22)%22)%2C%22function%22%3D%3Dtypeof%20r.complete%26%26r.complete(x))%7Dfunction%20i(e%2Ca%2Ci)%7Bvar%20l%2Cs%2Cc%3Dr.proxy%3BE.href%3De%2Ce%3DE.href%2Cl%3D%22html2canvas_%22%2Bv%2B%2B%2Ci.callbackname%3Dl%2Cc%2B%3Dc.indexOf(%22%3F%22)%3E-1%3F%22%26%22%3A%22%3F%22%2Cc%2B%3D%22url%3D%22%2BencodeURIComponent(e)%2B%22%26callback%3D%22%2Bl%2Cs%3Dk.createElement(%22script%22)%2Ct%5Bl%5D%3Dfunction(e)%7B%22error%3A%22%3D%3D%3De.substring(0%2C6)%3F(i.succeeded%3D!1%2Cx.numLoaded%2B%2B%2Cx.numFailed%2B%2B%2Co())%3A(p(a%2Ci)%2Ca.src%3De)%2Ct%5Bl%5D%3Dn%3Btry%7Bdelete%20t%5Bl%5D%7Dcatch(r)%7B%7Ds.parentNode.removeChild(s)%2Cs%3Dnull%2Cdelete%20i.script%2Cdelete%20i.callbackname%7D%2Cs.setAttribute(%22type%22%2C%22text%2Fjavascript%22)%2Cs.setAttribute(%22src%22%2Cc)%2Ci.script%3Ds%2Ct.document.body.appendChild(s)%7Dfunction%20l(e%2Cn)%7Bvar%20r%3Dt.getComputedStyle(e%2Cn)%2Ca%3Dr.content%3B%22url%22%3D%3D%3Da.substr(0%2C3)%26%26m.loadImage(d.Util.parseBackgroundImage(a)%5B0%5D.args%5B0%5D)%2Cu(r.backgroundImage%2Ce)%7Dfunction%20s(t)%7Bl(t%2C%22%3Abefore%22)%2Cl(t%2C%22%3Aafter%22)%7Dfunction%20c(t%2Ce)%7Bvar%20r%3Dd.Generate.Gradient(t%2Ce)%3Br!%3D%3Dn%26%26(x%5Bt%5D%3D%7Bimg%3Ar%2Csucceeded%3A!0%7D%2Cx.numTotal%2B%2B%2Cx.numLoaded%2B%2B%2Co())%7Dfunction%20h(t)%7Breturn%20t%26%26t.method%26%26t.args%26%26t.args.length%3E0%7Dfunction%20u(t%2Ce)%7Bvar%20r%3Bd.Util.parseBackgroundImage(t).filter(h).forEach(function(t)%7B%22url%22%3D%3D%3Dt.method%3Fm.loadImage(t.args%5B0%5D)%3At.method.match(%2F%5C-%3Fgradient%24%2F)%26%26(r%3D%3D%3Dn%26%26(r%3Dd.Util.Bounds(e))%2Cc(t.value%2Cr))%7D)%7Dfunction%20f(t)%7Bvar%20e%3D!1%3Btry%7Bb.Children(t).forEach(f)%7Dcatch(r)%7B%7Dtry%7Be%3Dt.nodeType%7Dcatch(a)%7Be%3D!1%2Cb.log(%22html2canvas%3A%20failed%20to%20access%20some%20element%27s%20nodeType%20-%20Exception%3A%20%22%2Ba.message)%7Dif(1%3D%3D%3De%7C%7Ce%3D%3D%3Dn)%7Bs(t)%3Btry%7Bu(b.getCSS(t%2C%22backgroundImage%22)%2Ct)%7Dcatch(r)%7Bb.log(%22html2canvas%3A%20failed%20to%20get%20background-image%20-%20Exception%3A%20%22%2Br.message)%7Du(t)%7D%7Dfunction%20p(e%2Ca)%7Be.onload%3Dfunction()%7Ba.timer!%3D%3Dn%26%26t.clearTimeout(a.timer)%2Cx.numLoaded%2B%2B%2Ca.succeeded%3D!0%2Ce.onerror%3De.onload%3Dnull%2Co()%7D%2Ce.onerror%3Dfunction()%7Bif(%22anonymous%22%3D%3D%3De.crossOrigin%26%26(t.clearTimeout(a.timer)%2Cr.proxy))%7Bvar%20l%3De.src%3Breturn%20e%3Dnew%20Image%2Ca.img%3De%2Ce.src%3Dl%2Ci(e.src%2Ce%2Ca)%2Cn%7Dx.numLoaded%2B%2B%2Cx.numFailed%2B%2B%2Ca.succeeded%3D!1%2Ce.onerror%3De.onload%3Dnull%2Co()%7D%7Dvar%20g%2Cm%2Cy%2Cw%2Cx%3D%7BnumLoaded%3A0%2CnumFailed%3A0%2CnumTotal%3A0%2CcleanupDone%3A!1%7D%2Cb%3Dd.Util%2Cv%3D0%2CC%3Dr.elements%5B0%5D%7C%7Ce.body%2Ck%3DC.ownerDocument%2CT%3DC.getElementsByTagName(%22img%22)%2CS%3DT.length%2CE%3Dk.createElement(%22a%22)%2CR%3Dfunction(t)%7Breturn%20t.crossOrigin!%3D%3Dn%7D(new%20Image)%3Bfor(E.href%3Dt.location.href%2Cg%3DE.protocol%2BE.host%2Cm%3D%7BloadImage%3Afunction(t)%7Bvar%20e%2Co%3Bt%26%26x%5Bt%5D%3D%3D%3Dn%26%26(e%3Dnew%20Image%2Ct.match(%2Fdata%3Aimage%5C%2F.*%3Bbase64%2C%2Fi)%3F(e.src%3Dt.replace(%2Furl%5C(%5B%27%22%5D%7B0%2C%7D%7C%5B%27%22%5D%7B0%2C%7D%5C)%24%2Fgi%2C%22%22)%2Co%3Dx%5Bt%5D%3D%7Bimg%3Ae%7D%2Cx.numTotal%2B%2B%2Cp(e%2Co))%3Aa(t)%7C%7Cr.allowTaint%3D%3D%3D!0%3F(o%3Dx%5Bt%5D%3D%7Bimg%3Ae%7D%2Cx.numTotal%2B%2B%2Cp(e%2Co)%2Ce.src%3Dt)%3AR%26%26!r.allowTaint%26%26r.useCORS%3F(e.crossOrigin%3D%22anonymous%22%2Co%3Dx%5Bt%5D%3D%7Bimg%3Ae%7D%2Cx.numTotal%2B%2B%2Cp(e%2Co)%2Ce.src%3Dt)%3Ar.proxy%26%26(o%3Dx%5Bt%5D%3D%7Bimg%3Ae%7D%2Cx.numTotal%2B%2B%2Ci(t%2Ce%2Co)))%7D%2CcleanupDOM%3Afunction(a)%7Bvar%20i%2Cl%3B%0Aif(!x.cleanupDone)%7Ba%26%26%22string%22%3D%3Dtypeof%20a%3Fb.log(%22html2canvas%3A%20Cleanup%20because%3A%20%22%2Ba)%3Ab.log(%22html2canvas%3A%20Cleanup%20after%20timeout%3A%20%22%2Br.timeout%2B%22%20ms.%22)%3Bfor(l%20in%20x)if(x.hasOwnProperty(l)%26%26(i%3Dx%5Bl%5D%2C%22object%22%3D%3Dtypeof%20i%26%26i.callbackname%26%26i.succeeded%3D%3D%3Dn))%7Bt%5Bi.callbackname%5D%3Dn%3Btry%7Bdelete%20t%5Bi.callbackname%5D%7Dcatch(s)%7B%7Di.script%26%26i.script.parentNode%26%26(i.script.setAttribute(%22src%22%2C%22about%3Ablank%22)%2Ci.script.parentNode.removeChild(i.script))%2Cx.numLoaded%2B%2B%2Cx.numFailed%2B%2B%2Cb.log(%22html2canvas%3A%20Cleaned%20up%20failed%20img%3A%20%27%22%2Bl%2B%22%27%20Steps%3A%20%22%2Bx.numLoaded%2B%22%20%2F%20%22%2Bx.numTotal)%7Dt.stop!%3D%3Dn%3Ft.stop()%3Ae.execCommand!%3D%3Dn%26%26e.execCommand(%22Stop%22%2C!1)%2Ce.close!%3D%3Dn%26%26e.close()%2Cx.cleanupDone%3D!0%2Ca%26%26%22string%22%3D%3Dtypeof%20a%7C%7Co()%7D%7D%2CrenderingDone%3Afunction()%7Bw%26%26t.clearTimeout(w)%7D%7D%2Cr.timeout%3E0%26%26(w%3Dt.setTimeout(m.cleanupDOM%2Cr.timeout))%2Cb.log(%22html2canvas%3A%20Preload%20starts%3A%20finding%20background-images%22)%2Cx.firstRun%3D!0%2Cf(C)%2Cb.log(%22html2canvas%3A%20Preload%3A%20Finding%20images%22)%2Cy%3D0%3BS%3Ey%3By%2B%3D1)m.loadImage(T%5By%5D.getAttribute(%22src%22))%3Breturn%20x.firstRun%3D!1%2Cb.log(%22html2canvas%3A%20Preload%3A%20Done.%22)%2Cx.numTotal%3D%3D%3Dx.numLoaded%26%26o()%2Cm%7D%2Cd.Renderer%3Dfunction(t%2Cr)%7Bfunction%20a(t%2Ce)%7Breturn%22children%22%3D%3D%3Dt%3F-1%3A%22children%22%3D%3D%3De%3F1%3At-e%7Dfunction%20o(t)%7Bfunction%20e(t)%7BObject.keys(t).sort(a).forEach(function(n)%7Bvar%20r%3D%5B%5D%2Ca%3D%5B%5D%2Ci%3D%5B%5D%2Cl%3D%5B%5D%3Bt%5Bn%5D.forEach(function(t)%7Bt.node.zIndex.isPositioned%7C%7C1%3Et.node.zIndex.opacity%3Fi.push(t)%3At.node.zIndex.isFloated%3Fa.push(t)%3Ar.push(t)%7D)%2Cfunction%20s(t)%7Bt.forEach(function(t)%7Bl.push(t)%2Ct.children%26%26s(t.children)%7D)%7D(r.concat(a%2Ci))%2Cl.forEach(function(t)%7Bt.context%3Fe(t.context)%3Ao.push(t.node)%7D)%7D)%7Dvar%20r%2Co%3D%5B%5D%3Breturn%20r%3Dfunction(t)%7Bfunction%20e(t%2Cr%2Ca)%7Bvar%20o%3D%22auto%22%3D%3D%3Dr.zIndex.zindex%3F0%3ANumber(r.zIndex.zindex)%2Ci%3Dt%2Cl%3Dr.zIndex.isPositioned%2Cs%3Dr.zIndex.isFloated%2Cc%3D%7Bnode%3Ar%7D%2Cd%3Da%3Br.zIndex.ownStacking%3F(i%3Dc.context%3D%7Bchildren%3A%5B%7Bnode%3Ar%2Cchildren%3A%5B%5D%7D%5D%7D%2Cd%3Dn)%3A(l%7C%7Cs)%26%26(d%3Dc.children%3D%5B%5D)%2C0%3D%3D%3Do%26%26a%3Fa.push(c)%3A(t%5Bo%5D%7C%7C(t%5Bo%5D%3D%5B%5D)%2Ct%5Bo%5D.push(c))%2Cr.zIndex.children.forEach(function(t)%7Be(i%2Ct%2Cd)%7D)%7Dvar%20r%3D%7B%7D%3Breturn%20e(r%2Ct)%2Cr%7D(t)%2Ce(r)%2Co%7Dfunction%20i(t)%7Bvar%20e%3Bif(%22string%22%3D%3Dtypeof%20r.renderer%26%26d.Renderer%5Bt%5D!%3D%3Dn)e%3Dd.Renderer%5Bt%5D(r)%3Belse%7Bif(%22function%22!%3Dtypeof%20t)throw%20Error(%22Unknown%20renderer%22)%3Be%3Dt(r)%7Dif(%22function%22!%3Dtypeof%20e)throw%20Error(%22Invalid%20renderer%20defined%22)%3Breturn%20e%7Dreturn%20i(r.renderer)(t%2Cr%2Ce%2Co(t.stack)%2Cd)%7D%2Cd.Util.Support%3Dfunction(t%2Ce)%7Bfunction%20r()%7Bvar%20t%3Dnew%20Image%2Cr%3De.createElement(%22canvas%22)%2Ca%3Dr.getContext%3D%3D%3Dn%3F!1%3Ar.getContext(%222d%22)%3Bif(a%3D%3D%3D!1)return!1%3Br.width%3Dr.height%3D10%2Ct.src%3D%5B%22data%3Aimage%2Fsvg%2Bxml%2C%22%2C%22%3Csvg%20xmlns%3D%27http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%27%20width%3D%2710%27%20height%3D%2710%27%3E%22%2C%22%3CforeignObject%20width%3D%2710%27%20height%3D%2710%27%3E%22%2C%22%3Cdiv%20xmlns%3D%27http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%27%20style%3D%27width%3A10%3Bheight%3A10%3B%27%3E%22%2C%22sup%22%2C%22%3C%2Fdiv%3E%22%2C%22%3C%2FforeignObject%3E%22%2C%22%3C%2Fsvg%3E%22%5D.join(%22%22)%3Btry%7Ba.drawImage(t%2C0%2C0)%2Cr.toDataURL()%7Dcatch(o)%7Breturn!1%7Dreturn%20d.Util.log(%22html2canvas%3A%20Parse%3A%20SVG%20powered%20rendering%20available%22)%2C!0%7Dfunction%20a()%7Bvar%20t%2Cn%2Cr%2Ca%2Co%3D!1%3Breturn%20e.createRange%26%26(t%3De.createRange()%2Ct.getBoundingClientRect%26%26(n%3De.createElement(%22boundtest%22)%2Cn.style.height%3D%22123px%22%2Cn.style.display%3D%22block%22%2Ce.body.appendChild(n)%2Ct.selectNode(n)%2Cr%3Dt.getBoundingClientRect()%2Ca%3Dr.height%2C123%3D%3D%3Da%26%26(o%3D!0)%2Ce.body.removeChild(n)))%2Co%7Dreturn%7BrangeBounds%3Aa()%2CsvgRendering%3At.svgRendering%26%26r()%7D%7D%2Ct.html2canvas4%3Dfunction(e%2Cn)%7Be%3De.length%3Fe%3A%5Be%5D%3Bvar%20r%2Ca%3D%7Blogging%3A!1%2Celements%3Ae%2Cbackground%3A%22%23fff%22%2Cproxy%3Anull%2Ctimeout%3A0%2CuseCORS%3A!1%2CallowTaint%3A!1%2CsvgRendering%3A!1%2CignoreElements%3A%22IFRAME%7COBJECT%7CPARAM%22%2CuseOverflow%3A!0%2CletterRendering%3A!1%2Cchinese%3A!1%2Casync%3A!1%2Cwidth%3Anull%2Cheight%3Anull%2CtaintTest%3A!0%2Crenderer%3A%22Canvas%22%7D%3Breturn%20a%3Dd.Util.Extend(n%2Ca)%2Cd.logging%3Da.logging%2Ca.complete%3Dfunction(t)%7B(%22function%22!%3Dtypeof%20a.onpreloaded%7C%7Ca.onpreloaded(t)!%3D%3D!1)%26%26d.Parse(t%2Ca%2Cfunction(t)%7B(%22function%22!%3Dtypeof%20a.onparsed%7C%7Ca.onparsed(t)!%3D%3D!1)%26%26(r%3Dd.Renderer(t%2Ca)%2C%22function%22%3D%3Dtypeof%20a.onrendered%26%26a.onrendered(r))%7D)%7D%2Ct.setTimeout(function()%7Bd.Preload(a)%7D%2C0)%2C%7Brender%3Afunction(t%2Ce)%7Breturn%20d.Renderer(t%2Cd.Util.Extend(e%2Ca))%7D%2Cparse%3Afunction(t%2Ce)%7Breturn%20d.Parse(t%2Cd.Util.Extend(e%2Ca))%7D%2Cpreload%3Afunction(t)%7Breturn%20d.Preload(d.Util.Extend(t%2Ca))%7D%2Clog%3Ad.Util.log%7D%7D%2Ct.html2canvas4.log%3Dd.Util.log%2Ct.html2canvas4.Renderer%3D%7BCanvas%3An%7D%2Cd.Renderer.Canvas%3Dfunction(t)%7Bfunction%20r(t%2Ce)%7Bt.beginPath()%2Ce.forEach(function(e)%7Bt%5Be.name%5D.apply(t%2Ce.arguments)%7D)%2Ct.closePath()%7Dfunction%20a(t)%7Bif(-1%3D%3D%3Dl.indexOf(t.arguments%5B0%5D.src))%7Bc.drawImage(t.arguments%5B0%5D%2C0%2C0)%3Btry%7Bc.getImageData(0%2C0%2C1%2C1)%7Dcatch(e)%7Breturn%20s%3Di.createElement(%22canvas%22)%2Cc%3Ds.getContext(%222d%22)%2C!1%7Dl.push(t.arguments%5B0%5D.src)%7Dreturn!0%7Dfunction%20o(e%2Cn)%7Bswitch(n.type)%7Bcase%22variable%22%3Ae%5Bn.name%5D%3Dn.arguments%3Bbreak%3Bcase%22function%22%3Aswitch(n.name)%7Bcase%22createPattern%22%3Aif(n.arguments%5B0%5D.width%3E0%26%26n.arguments%5B0%5D.height%3E0)try%7Be.fillStyle%3De.createPattern(n.arguments%5B0%5D%2C%22repeat%22)%7Dcatch(o)%7Bh.log(%22html2canvas%3A%20Renderer%3A%20Error%20creating%20pattern%22%2Co.message)%7Dbreak%3Bcase%22drawShape%22%3Ar(e%2Cn.arguments)%3Bbreak%3Bcase%22drawImage%22%3An.arguments%5B8%5D%3E0%26%26n.arguments%5B7%5D%3E0%26%26(!t.taintTest%7C%7Ct.taintTest%26%26a(n))%26%26e.drawImage.apply(e%2Cn.arguments)%3Bbreak%3Bdefault%3Ae%5Bn.name%5D.apply(e%2Cn.arguments)%7D%7D%7Dt%3Dt%7C%7C%7B%7D%3Bvar%20i%3De%2Cl%3D%5B%5D%2Cs%3De.createElement(%22canvas%22)%2Cc%3Ds.getContext(%222d%22)%2Ch%3Dd.Util%2Cu%3Dt.canvas%7C%7Ci.createElement(%22canvas%22)%3Breturn%20function(t%2Ce%2Cr%2Ca%2Ci)%7Bvar%20l%2Cs%2Cc%2Cd%3Du.getContext(%222d%22)%2Cf%3Dt.stack%3Breturn%20u.width%3Du.style.width%3De.width%7C%7Cf.ctx.width%2Cu.height%3Du.style.height%3De.height%7C%7Cf.ctx.height%2Cc%3Dd.fillStyle%2Cd.fillStyle%3Dh.isTransparent(t.backgroundColor)%26%26e.background!%3D%3Dn%3Fe.background%3At.backgroundColor%2Cd.fillRect(0%2C0%2Cu.width%2Cu.height)%2Cd.fillStyle%3Dc%2Ca.forEach(function(t)%7Bd.textBaseline%3D%22bottom%22%2Cd.save()%2Ct.transform.matrix%26%26(d.translate(t.transform.origin%5B0%5D%2Ct.transform.origin%5B1%5D)%2Cd.transform.apply(d%2Ct.transform.matrix)%2Cd.translate(-t.transform.origin%5B0%5D%2C-t.transform.origin%5B1%5D))%2Ct.clip%26%26(d.beginPath()%2Cd.rect(t.clip.left%2Ct.clip.top%2Ct.clip.width%2Ct.clip.height)%2Cd.clip())%2Ct.ctx.storage%26%26t.ctx.storage.forEach(function(t)%7Bo(d%2Ct)%7D)%2Cd.restore()%7D)%2Ch.log(%22html2canvas%3A%20Renderer%3A%20Canvas%20renderer%20done%20-%20returning%20canvas%20obj%22)%2C1%3D%3D%3De.elements.length%26%26%22object%22%3D%3Dtypeof%20e.elements%5B0%5D%26%26%22BODY%22!%3D%3De.elements%5B0%5D.nodeName%3F(s%3Di.Util.Bounds(e.elements%5B0%5D)%2Cl%3Dr.createElement(%22canvas%22)%2Cl.width%3DMath.ceil(s.width)%2Cl.height%3DMath.ceil(s.height)%2Cd%3Dl.getContext(%222d%22)%2Cd.drawImage(u%2Cs.left%2Cs.top%2Cs.width%2Cs.height%2C0%2C0%2Cs.width%2Cs.height)%2Cu%3Dnull%2Cl)%3Au%7D%7D%7D)(window%2Cdocument)%3B"));var SaveDialog=(sfa=Backbone.View,__extends(tfa,sfa),tfa.prototype.applyTemplate=function(){var i,e,a,n=this;$(this.el).html(T.SaveDialog()),this.previousOverflow=this.model.get("$appRoot").css("overflow"),this.previousSettings={isChartDimensionsActive:this.model.get("isChartDimensionsActive"),chartDimensionsWidthPx:this.model.get("chartDimensionsWidthPx"),chartDimensionsHeightPx:this.model.get("chartDimensionsHeightPx"),currentTheme:this.model.get("currentTheme")},this.dialog=this.$el.dialog({dialogClass:"charting "+this.model.get("currentTheme"),title:"Save Chart",resizable:!1,modal:!0,draggable:!1,open:function(e){$(e.target).addClass("save-dialog-content")},close:function(){n.model.set(n.previousSettings),n.model.get("$appRoot").css({overflow:n.previousOverflow}),n.$el.dialog("destroy")},height:.95*this.model.get("$appRoot").height(),width:.95*this.model.get("$appRoot").width()}),this.$chartImage=this.$el.find(".chart-image"),this.$downloadButton=this.$el.find(".download-button"),this.$downloadInstructions=this.$el.find(".download-instructions"),this.$imgFrame=this.$el.find(".img-frame"),this.$imgLoading=this.$el.find(".img-loading"),this.$imgWrapper=this.$el.find(".img-wrapper"),this.$saveHeader=this.$el.find(".save-header"),this.$chartDimensionsThemeSection=this.$el.find(".chart-theme-section"),this.$chartDimensionsThemeSelect=this.$el.find(".chart-theme-select"),this.$chartDimensionsWidthSelect=this.$el.find(".chart-width-select"),$(this.$chartDimensionsThemeSelect).on("change",function(){return n.onOptionsChange()}),$(this.$chartDimensionsWidthSelect).on("change",function(){return n.onOptionsChange()}),this.downloadAttrSupported?(this.$downloadButton.button({icons:{primary:"ui-icon-arrowstop-1-s"}}).show(),this.$downloadInstructions.hide()):(this.$downloadButton.hide(),this.$downloadInstructions.show()),this.model.get("showThemesOptions")?(i="",e=this.model.get("supportedThemes"),a=this.model.get("supportedThemesUItext"),1<e.length?(_.each(e,function(e,t){i+='<option value="'+e+'"',n.model.get("currentTheme")===e&&(i+=' selected="selected"'),i+=">"+a[t]+"</option>"}),this.$chartDimensionsThemeSelect.append(i)):this.$chartDimensionsThemeSection.hide()):this.$chartDimensionsThemeSection.hide()},tfa.prototype.onOptionsChange=function(){var e=this.$chartDimensionsThemeSelect.prop("value")||this.model.get("currentTheme");this.model.set({isChartDimensionsActive:!0,chartDimensionsWidthPx:parseInt(this.$chartDimensionsWidthSelect.prop("value"),10),chartDimensionsHeightPx:null,currentTheme:e}),this.renderChart()},tfa.prototype.renderChart=function(){var i=this,a=.95*this.model.get("$appRoot").height(),n=.95*this.model.get("$appRoot").width(),e=(this.chart.toggleSaveLayout(!0),this.model.get("$appRoot").css({overflow:"auto"}),this.$imgLoading.show(),this.$imgWrapper.hide(),this.$downloadButton.attr("disabled",!0),this.chart.$el.offset());return window.html2canvas4(this.chart.$el,{height:this.chart.$el.height()+e.top,width:this.chart.$el.width()+e.left,background:this.model.get("chartRenderBackground"),onrendered:function(e){var t="",t=(t=i.model.get("stockPickerSymbol")&&i.model.get("stockPickerSymbol").name?t+i.model.get("stockPickerSymbol").name.replace(/\W+/g,"")+"-":t)+moment().format("YYYYMMDD-hhmmss")+".png";i.imageData=e.toDataURL("image/png"),i.$chartImage.attr("src",i.imageData),i.$downloadButton.attr("href",i.imageData),i.$downloadButton.attr("download",t),i.$chartImage.load(function(){i.chart.toggleSaveLayout(!1),i.model.get("$appRoot").css({overflow:"hidden"}),i.$imgLoading.hide(),i.$imgWrapper.show(),i.$downloadButton.attr("disabled",!1),i.model.set(i.previousSettings),a=Math.min(a,i.$chartImage.get(0).naturalHeight+60+i.$saveHeader.height()),n=Math.min(n,i.$chartImage.get(0).naturalWidth+50),i.dialog.dialog("option",{height:a,width:n}),i.$imgWrapper.css("top",i.$saveHeader.outerHeight())})}}),this},tfa),sfa;function tfa(e){var t=sfa.call(this,e)||this;return t.options=e,t.chart=e.chart,t.downloadAttrSupported="download"in document.createElement("a"),t.themeButtons=[],t.applyTemplate(),t.onOptionsChange(),t}var ChartIndicator=(Kfa=Backbone.Model,__extends(Lfa,Kfa),Lfa.prototype.initialize=function(){this.set(Lfa.defaults)},Lfa.defaults={IndicatorCode:null,IndicatorName:null,IndicatorType:null,ChartDisplayType:null,ShortName:null,MarkersValues:null,RangeValues:null,IndicatorParameters:[],IndicatorsDiscrete:[],Color:null,Order:null},Lfa),Kfa;function Lfa(e){var t=Kfa.call(this)||this;return t.set(e),t}var ChartIndicatorsCollection=(Ofa=Backbone.Collection,__extends(Pfa,Ofa),Pfa),Ofa;function Pfa(){var e=null!==Ofa&&Ofa.apply(this,arguments)||this;return e.model=ChartIndicator,e}var LevelDialog=(Rfa=Backbone.View,__extends(Sfa,Rfa),Sfa.prototype.initialize=function(e){this.options=e,this.removeLevelFn=e.removeLevelFn,this.render()},Sfa.prototype.onClose=function(){$(this.dialogView).dialog("close"),this.okCallback&&this.okCallback({level:parseFloat(this.$inputBox.val()),type:this.$el.find(".level-radios input:checked").val()})},Sfa.prototype.onRemoveLevel=function(e){var t,i,e=$(e.currentTarget),a=e.data("levelid"),n=e.data("type"),o=this.model.get("levels"),s=!1;if(e.parent().remove(),o){switch(n){case"entry":t=o.entry,o.entry=null,this.$levelRadios.find('input[value="entry"]').attr("disabled",!1);break;case"profit":for(s=!1,t=null,i=0;i<o.profits.length;i+=1)if(o.profits[i].id===a){t=o.profits[i],s=!0;break}s&&o.profits.splice(i,1),this.$levelRadios.find('input[value="profit"]').attr("disabled",!1);break;case"stop":for(s=!1,t=null,i=0;i<o.stops.length;i+=1)if(o.stops[i].id===a){t=o.profits[i],s=!0;break}s&&o.stops.splice(i,1),this.$levelRadios.find('input[value="stop"]').attr("disabled",!1)}this.$levelRadios.buttonset("refresh"),t.annotation.removeVisual(t.annotation,!0)}},Sfa.prototype.render=function(){var e,t=this,i=this.model.get("levels"),a=this.model.get("stockPickerSymbol").decimalPlaces,n={r1:Helpers.getGUID(),r2:Helpers.getGUID(),r3:Helpers.getGUID()};if(i){if(i.entry&&(n.currentEntry=i.entry.value.toFixed(a),n.currentEntryId=i.entry.id),i.profits)for(e=0;e<i.profits.length;e+=1)n["profit"+e]=i.profits[0].value.toFixed(a),n["profit"+e+"id"]=i.profits[0].id;if(i.stops)for(e=0;e<i.stops.length;e+=1)n["stop"+e]=i.stops[0].value.toFixed(a),n["stop"+e+"id"]=i.stops[0].id}return this.$el.html(T.LevelDialog(n)),this.$inputBox=this.$el.find(".level-input"),this.$inputBox.val(this.model.get("lastAvgPrice").toFixed(this.model.get("stockPickerSymbol").decimalPlaces)),this.$inputBox.focus(function(){t.$inputBox.select()}),this.$inputBox.keypress(function(e){13===e.which&&(e.preventDefault(),t.onClose())}),this.$inputBox.spinner({step:1/Math.pow(10,a)}),this.$el.find(".ui-spinner").addClass("text-box"),this.$levelRadios=this.$el.find(".level-radios"),this.$levelRadios.buttonset(),i&&(i.entry&&this.$levelRadios.find('input[value="entry"]').attr("disabled","disabled"),i.profits&&3<=i.profits.length&&this.$levelRadios.find('input[value="profit"]').attr("disabled","disabled"),i.stops&&3<=i.stops.length&&this.$levelRadios.find('input[value="stop"]').attr("disabled","disabled"),this.$levelRadios.buttonset("refresh")),this.$el.find(".remove-list-entry").on("click",function(e){return t.onRemoveLevel(e)}),this.$levelRadios.find("input").change(function(){t.$addButton.button("option","disabled",!1)}),this},Sfa.prototype.show=function(e){var t=this;this.okCallback=e,this.dialogView=this.$el.dialog({dialogClass:"charting "+this.model.get("currentTheme"),title:"Add Target",resizable:!1,modal:!0,draggable:!1,open:function(){t.$addButton=$("#ac-level-add-button")},close:function(){t.$el.dialog("destroy"),t.dialogView=null},buttons:[{id:"ac-level-add-button",text:"add",disabled:!0,click:function(){return t.onClose()}}]})},Sfa),Rfa;function Sfa(){return null!==Rfa&&Rfa.apply(this,arguments)||this}var ChartToolbar=(p5a=Backbone.View,__extends(q5a,p5a),q5a.prototype.applyTemplate=function(){var i="",e=this.model.get("supportedThemes"),a=this.model.get("supportedThemesUItext");this.$el.html(T.ChartToolbar($.extend({},this.radiosIds,{viewOptions:this.model.get("viewOptions")}))),1<e.length&&(_.each(e,function(e,t){i+='<a href="#'+e+'">'+a[t]+"</a>"}),this.$(".themes-list").append(i)),this.rootDiv=this.$el.find(".RootDiv"),this.$buttonsDiv=this.$el.find(".buttons-div"),this.$toolbarLeft=this.$buttonsDiv.find(".toolbar-left"),this.$toolbarRight=this.$buttonsDiv.find(".toolbar-right"),this.setZoom(),this.setDraw(),this.setIndicators(),this.setOptions(),this.setSave(),this.setOverflow()},q5a.prototype.closeCurrentMenu=function(){this.currentMenu&&(this.model.get("isMobile")&&this.currentMenu!==this.$overflowMenu?$(this.currentMenu).dialog("close"):$(this.currentMenu).hide(),this.currentMenu=null),this.removeActiveMenuItem(this.currentMenuButton),this.currentMenuButton=null},q5a.prototype.addActiveMenuItem=function(e){this.model.set({activeMenuButtons:_.union(this.model.get("activeMenuButtons"),[e])})},q5a.prototype.removeActiveMenuItem=function(e){this.model.set({activeMenuButtons:_.without(this.model.get("activeMenuButtons"),e)})},q5a.prototype.changeTheme=function(e){this.model.set({currentTheme:e}),this.updateThemeButtons(this.model.get("currentTheme"))},q5a.prototype.createIdsForRadioBoxes=function(){return{line1:Helpers.getGUID(),line2:Helpers.getGUID(),line3:Helpers.getGUID(),trendLine:Helpers.getGUID(),horizontalLine:Helpers.getGUID(),verticalLine:Helpers.getGUID(),ellipse:Helpers.getGUID(),rectangle:Helpers.getGUID(),rotationRectangle:Helpers.getGUID(),textNote:Helpers.getGUID(),fibonacciRetracements:Helpers.getGUID(),fibonacciTimeZones:Helpers.getGUID(),fibonacciFan:Helpers.getGUID(),gannFan:Helpers.getGUID(),andrewsPitchfork:Helpers.getGUID()}},q5a.prototype.initialize2=function(e){var t=this;this.options=e,this.radiosIds=this.createIdsForRadioBoxes(),this.timeframeButtons=[],this.chartMenuItems=[],this.chartTypeButtons=[],this.crosshairTypeButtons=[],this.priceInfoButtons=[],this.lineThickness=2,this.lineColor="pink",this.loadedPeriods=[],this.chart=e.chart,this.pendingSymbol=e.pendingSymbol,this.buttons=[],this.applyTemplate(),$(document).on("click",function(){return t.onDocumentClick()}),this.listenTo(this.model,"change:activeMenuButtons",function(){return t.onModelChangeActiveMenuButtons()}),this.listenTo(this.model,"change:showDrawMenu",function(){t.model.get("showDrawMenu")?t.drawButton.show():t.drawButton.hide()}),this.listenTo(this.model,"change:showIndicators",function(){t.model.get("showIndicators")?t.$indicators.show():(t.$indicators.hide(),t.indicatorsMenu.hide())}),this.listenTo(this.model,"change:init-data-loaded",function(){t.model.get("init-data-loaded")?_.each(t.buttons,function(e){e.button("enable")}):_.each(t.buttons,function(e){e.button("disable")})})},q5a.prototype.onModelChangeActiveMenuButtons=function(){var e=this.model.get("activeMenuButtons");0<e.length?($(this.$buttonsDiv).find(".menu-button-active").removeClass("menu-button-active"),_.each(e,function(e){$(e).addClass("menu-button-active")})):$(this.$buttonsDiv).find(".menu-button-active").removeClass("menu-button-active")},q5a.prototype.setDraw=function(){var i=this;this.drawMenu=this.$el.find(".draw-menu"),$(this.drawMenu).hide(),this.drawButton=this.$el.find(".draw"),this.drawButton.button({disabled:!0}).on("click",function(e){e.preventDefault(),i.currentMenu!==i.drawMenu&&(i.openMenu(i.drawMenu,i.drawButton,"Draw"),i.updateDrawMenu())}),this.buttons.push(this.drawButton),this.$el.find(".clear-button").button().on("click",function(){$(i).trigger("remove-all-annotations")}),this.model.get("showUndoRedoButtons")?(this.$el.find(".undo-button").button({icons:{primary:"ui-icon-undo"},text:!1}).on("click",function(){$(i).trigger("undo")}),this.$el.find(".redo-button").button({icons:{primary:"ui-icon-redo"},text:!1}).on("click",function(){$(i).trigger("redo")})):($(this.el).find(".undo-button").hide(),$(this.el).find(".redo-button").hide()),this.$btnLineThickness1=this.$el.find(".lt1"),this.$btnLineThickness2=this.$el.find(".lt2"),this.$btnLineThickness3=this.$el.find(".lt3"),this.$btnLineThickness1.on("click",function(e){e.stopPropagation(),i.onLineThicknessClick(1)}),this.$btnLineThickness2.on("click",function(e){e.stopPropagation(),i.onLineThicknessClick(2)}),this.$btnLineThickness3.on("click",function(e){e.stopPropagation(),i.onLineThicknessClick(3)}),this.colorPicker=$(this.drawMenu).find(".strokeColor"),$(this.colorPicker).colorpicker({displayIndicator:!1,color:this.model.get("annotationStrokeColor")}),this.fillColorPicker=$(this.drawMenu).find(".fillColor"),$(this.fillColorPicker).colorpicker({displayIndicator:!1,color:this.model.get("annotationFillColor")}),this.fillOpacitySlider=100,this.strokeOpacitySlider=100,$($(this.drawMenu).find(".annotations a")).each(function(e,t){$(t).button().on("click",function(e){var t=$(e.currentTarget).prop("hash").substring(1);e.preventDefault(),"level"===t?new LevelDialog({model:i.model}).show(function(e){$(i).trigger("levelcreated",{type:"levelcreated",level:e.level,levelType:e.type})}):(i.closeCurrentMenu(),$(i).trigger("startdrawing",{type:"startdrawing",tool:t,lineColor:$(i.colorPicker).colorpicker("val"),lineThickness:i.lineThickness,fillColor:$(i.fillColorPicker).colorpicker("val"),strokeOpacity:100,fillOpacity:20}))})}),this.model.get("showDrawMenu")||this.drawButton.hide()},q5a.prototype.setIndicators=function(){var t=this,e=(this.$indicators=this.$el.find(".indicators"),this.indicatorsMenu=this.$el.find(".indicators-menu"),this.indicatorsList=this.indicatorsMenu.find(".chartTypeMenu"),this.indicatorsScrollPane=this.$el.find(".scroll-pane"),this.indicatorSearchField=$(this.el).find(".ctSearch"),this.indicatorsScrollPaneApi=this.indicatorsScrollPane.jScrollPane({mouseWheelSpeed:20}).data("jsp"),this.indicatorsScrollPane.on("jsp-scroll-y",function(){t.justOpened=!0}),this.$indicators.button({disabled:!0}).on("click",function(e){t.currentMenu!==t.indicatorsMenu&&(t.indicatorsScrollPane.css("height",.7*t.appHeight),t.openMenu(t.indicatorsMenu,t.$indicators,"Indicators"),t.clearIndicatorSearch(),t.highlightedIndicator=null,t.model.get("isMobile")?t.indicatorsMenu.find(".indicator-search-container").hide():t.indicatorSearchField.focus()),t.indicatorsScrollPaneApi&&t.indicatorsScrollPaneApi.reinitialise(),e.preventDefault()}),this.buttons.push($(this.$indicators)),this.indicatorsMenu.hide(),this.indicators=new ChartIndicatorsCollection([],{comparator:"IndicatorName"}),this.indicatorsSearchResults=new ChartIndicatorsCollection([],{comparator:"IndicatorName"}),this.model.get("indicatorsData"));this.indicators.add(e),this.listIndicators(),this.model.get("isMobile")?this.indicatorsMenu.find(".indicator-search-container").hide():(this.indicatorSearchField.keydown(function(e){return t.onIndicatorSearchKeyDown(e)}),this.indicatorSearchField.keyup(function(e){return t.onIndicatorSearchKeyUp(e)}),this.indicatorSearchField.focus(function(){return t.onIndicatorSearchFieldFocus()}),this.indicatorSearchField.blur(function(){return t.onIndicatorSearchFieldBlur()})),this.model.get("showIndicators")||(this.$indicators.hide(),this.indicatorsMenu.hide())},q5a.prototype.setOptions=function(){var t,a=this,e=(this.options=this.$el.find(".options"),this.options.button({disabled:!0}).on("click",function(e){var t;a.currentMenu!==a.optionsMenu&&(a.openMenu(a.optionsMenu,a.options,"Options"),a.updateChartTypeMenuButtons(a.model.get("stockDisplayType")),t="none",a.model.get("showCrosshair")&&(t=a.model.get("snapToDataPoint")?"price":"cursor"),a.updateCrosshairTypeMenuButtons(t),t="off",a.model.get("showInfoBorder")&&(t="on",a.model.get("isInfoBorderInCursorMode")&&(t="cursor")),a.updatePriceInfoMenuButtons(t),a.updateThemeButtons(a.model.get("currentTheme"))),e.preventDefault()}),this.buttons.push($(this.options)),this.optionsMenu=this.$el.find(".options-menu"),this.optionsMenu.hide(),this.model.get("isMobile")&&this.optionsMenu.find(".notMobile").hide(),$(this.$el.find(".chartTypeMenu a")).each(function(e,t){var i=$(t);i.button().on("click",function(e){a.onChartTypeMenuSelect(e,i[0])}),a.chartTypeButtons.push(i[0])}),this.chartTypeMenu=this.$el.find(".chartTypeMenu"),$(this.$el.find(".crosshair-types a")).each(function(e,t){var i=$(t);i.button().on("click",function(e){a.onCrosshairTypeMenuSelect(e,i[0])}),a.crosshairTypeButtons.push(i[0])}),$(this.$el.find(".border-types a")).each(function(e,t){var i=$(t);i.button().on("click",function(e){a.onPriceInfoBorderChange(e,i[0])}),a.priceInfoButtons.push(i[0])}),this.model.get("showThemesOptions")?$(this.$el.find(".themes a")).each(function(e,t){var i=$(t);i.button().on("click",function(e){a.onThemeMenuSelect(e,i[0])}),a.themeButtons.push(i[0])}):$(this.$el.find(".themes")).hide(),this.optionsMenu.find("input[name=crosshair]"));$(e).each(function(e,t){$(t).on("click",function(){"on"===t.value?a.model.set({showCrosshair:!0,highlightSelectedValue:!0,highlightSelectedDate:!0}):a.model.set({showCrosshair:!1,highlightSelectedValue:!1,highlightSelectedDate:!1})})}),$(this.$el.find(".settings-link")).button().on("click",function(e){e.preventDefault(),(t=new SettingsContextMenu({model:a.model})).showSettings(),$(t).on("redraw",function(){$(a).trigger("redraw")}),a.closeCurrentMenu()})},q5a.prototype.setOverflow=function(){this.$overflowButton=this.$el.find(".overflow-btn"),this.$overflowMenu=this.$el.find(".overflow-menu"),this.$overflowButton.hide(),this.$overflowMenu.hide()},q5a.prototype.setSave=function(){var t=this;this.save=$(this.el).find(".save"),this.model.get("showSaveButton")?($(this.save).button({icons:{primary:"ui-icon-save-chart"},text:!1,disabled:!0}).on("click",function(){new SaveDialog({chart:t.chart,model:t.model}).on("save-image",function(e){t.trigger("save-image",e)})}),this.buttons.push($(this.save))):this.save.hide()},q5a.prototype.setZoom=function(){var t=this;this.zoom=$(this.el).find(".zoom"),this.model.get("isZoomSelectionVisible")?($(this.zoom).button({icons:{primary:"ui-icon-chart-zoom"},text:!1,disabled:!0}).on("click",function(e){t.zooming=!t.zooming,t.updateZooming(),e.preventDefault()}),this.buttons.push($(this.zoom))):this.zoom.hide()},q5a.prototype.selectSymbol=function(e){this.model.set({stockSymbol:e})},q5a.prototype.onChartTypeMenuSelect=function(e,t){t=t.hash.substring(1);this.updateChartTypeMenuButtons(t),e.preventDefault(),this.model.set({stockDisplayType:t})},q5a.prototype.onCrosshairTypeMenuSelect=function(e,t){t=t.hash.substring(1);switch(this.updateCrosshairTypeMenuButtons(t),e.preventDefault(),t){case"none":this.chart.mainChartArea.clearCrosshair(),this.model.set("snapToDataPoint",!1),this.model.set("showCrosshair",!1),this.model.set("highlightSelectedValue",!1),this.model.set("highlightSelectedDate",!1);break;case"price":this.model.set("snapToDataPoint",!0),this.model.set("showCrosshair",!0),this.model.set("highlightSelectedValue",!0),this.model.set("highlightSelectedDate",!0);break;case"cursor":this.model.set("snapToDataPoint",!1),this.model.set("showCrosshair",!0),this.model.set("highlightSelectedValue",!0),this.model.set("highlightSelectedDate",!0);break;default:this.model.set("snapToDataPoint",!1),this.model.set("showCrosshair",!1),this.model.set("highlightSelectedValue",!1),this.model.set("highlightSelectedDate",!1)}},q5a.prototype.onDocumentClick=function(){this.currentMenu&&(this.justOpened?this.justOpened=!1:this.closeCurrentMenu())},q5a.prototype.onIndicatorMenuSelect=function(e,t){t=$(t).prop("hash").substring(1);$(this).trigger("addindicator",{type:"addindicator",indicatorCode:t}),e.preventDefault()},q5a.prototype.onLineThicknessClick=function(e){this.lineThickness=e,this.updateDrawMenu()},q5a.prototype.onPeriodDownloaded=function(t){var i,a=this,e=(this.loadedPeriods.push(t.period),_.filter(this.timeframeButtons,function(e){return(i=e.hash.substring(1))===t.period&&i!==a.model.get("dataPeriod")}));_.each(e,function(e){$(e).button("option","disabled",!1)})},q5a.prototype.onPriceInfoBorderChange=function(e,t){t=t.hash.substring(1);switch(this.updatePriceInfoMenuButtons(t),e.preventDefault(),t){case"off":this.model.set({showInfoBorder:!1}),this.model.set({isInfoBorderInCursorMode:!1}),this.model.get("originalModel").showInfoBorder=!1;break;case"on":this.model.set({showInfoBorder:!0}),this.model.set({isInfoBorderInCursorMode:!1}),this.model.get("originalModel").showInfoBorder=!0;break;case"cursor":this.model.set({showInfoBorder:!0}),this.model.set({isInfoBorderInCursorMode:!0}),this.model.get("originalModel").showInfoBorder=!0;break;default:this.model.set({showInfoBorder:!0}),this.model.set({isInfoBorderInCursorMode:!1}),this.model.get("originalModel").showInfoBorder=!0}},q5a.prototype.onResize=function(e){this.appHeight=e,this.closeCurrentMenu()},q5a.prototype.openMenu=function(e,t,i){var a=this,n=$(t),o=(this.closeCurrentMenu(),$(this).trigger("minimisecustomtoolbar"),_.find(this.chartMenuItems,function(e){return e.button[0]===t}));if(this.model.get("isMobile")&&e!==this.$overflowMenu||o&&o.inOverflow)return $(e).dialog({title:i||"",width:"auto",height:"auto",resizable:!1,modal:!0,draggable:!1,dialogClass:"charting mobile "+this.model.get("currentTheme"),close:function(){a.currentMenu=null,$(e).dialog("destroy")}}),this.currentMenu=e,void(this.justOpened=!0);$(e).addClass("ui-widget-content").show();o=$(e).outerWidth(),i=n.position().left+n.outerWidth()/2-o/2,n=this.$el.outerWidth(),(i=n<i+o+13?n-(o+13):i)<7&&(i=7),n=parseInt($(e).css("padding-top"),10)+parseInt($(e).css("padding-bottom"),10);$(e).css({"margin-top":0,"margin-left":i,"max-height":this.$el.parent().outerHeight()-($(e).position().top+n)}),this.currentMenu=e,this.currentMenuButton=t,this.addActiveMenuItem(t),this.zooming&&(this.zooming=!1,this.updateZooming()),this.justOpened=!0},q5a.prototype.onThemeMenuSelect=function(e,t){t=t.hash.substring(1);e.preventDefault(),this.changeTheme(t)},q5a.prototype.onZoomStop=function(){this.zooming=!1,this.updateZooming()},q5a.prototype.updateDrawMenu=function(){var e;switch(this.lineThickness){case 1:e=this.$btnLineThickness1;break;case 2:e=this.$btnLineThickness2;break;default:e=this.$btnLineThickness3}e.addClass("selected").siblings().removeClass("selected")},q5a.prototype.updateChartTypeMenuButtons=function(e){$(this.chartTypeButtons).each(function(){$(this).button({disabled:!1})});e=_.filter(this.chartTypeButtons,{hash:"#"+e})[0];$(e).button({disabled:!0})},q5a.prototype.updateCrosshairTypeMenuButtons=function(e){$(this.crosshairTypeButtons).each(function(){$(this).button({disabled:!1})});e=_.filter(this.crosshairTypeButtons,{hash:"#"+e})[0];$(e).button({disabled:!0})},q5a.prototype.updatePriceInfoMenuButtons=function(e){$(this.priceInfoButtons).each(function(){$(this).button({disabled:!1})});e=_.filter(this.priceInfoButtons,{hash:"#"+e})[0];$(e).button({disabled:!0})},q5a.prototype.updateThemeButtons=function(e){$(this.themeButtons).each(function(){$(this).button({disabled:!1})});e=_.filter(this.themeButtons,{hash:"#"+e})[0];$(e).button({disabled:!0})},q5a.prototype.updateZooming=function(){var e=$(this.zoom).children("span:first");this.zooming?($(e).removeClass("ui-icon-chart-zoom"),$(e).addClass("ui-icon-chart-zoom-selected"),$(this).trigger("startzoom"),this.addActiveMenuItem(this.zoom)):($(e).removeClass("ui-icon-chart-zoom-selected"),$(e).addClass("ui-icon-chart-zoom"),$(this).trigger("stopzoom"),this.removeActiveMenuItem(this.zoom))},q5a.prototype.onIndicatorSearchKeyDown=function(e){var t,i=this.indicatorsList.find("li");switch(e.which){case 13:var a=this.highlightedIndicator.find("a")[0].hash.substring(1);$(this).trigger("addindicator",{type:"addindicator",indicatorCode:a}),e.preventDefault();break;case 27:this.clearIndicatorSearch(),e.preventDefault();break;case 38:this.highlightedIndicator?(this.highlightedIndicator.removeClass("highlighted"),0<(t=this.highlightedIndicator.prev("li")).length?this.highlightedIndicator=t.addClass("highlighted"):this.highlightedIndicator=i.last().addClass("highlighted")):this.highlightedIndicator=i.last().addClass("highlighted"),this.indicatorsScrollPaneApi&&this.indicatorsScrollPaneApi.scrollToElement(this.highlightedIndicator),e.preventDefault();break;case 40:this.highlightedIndicator?(this.highlightedIndicator.removeClass("highlighted"),0<(t=this.highlightedIndicator.next("li")).length?this.highlightedIndicator=t.addClass("highlighted"):this.highlightedIndicator=i.eq(0).addClass("highlighted")):this.highlightedIndicator=i.eq(0).addClass("highlighted"),this.indicatorsScrollPaneApi&&this.indicatorsScrollPaneApi.scrollToElement(this.highlightedIndicator),e.preventDefault();break;default:this.listIndicators()}},q5a.prototype.onIndicatorSearchKeyUp=function(e){13===e.which||27===e.which||38===e.which||40===e.which?e.preventDefault():this.listIndicators()},q5a.prototype.onIndicatorSearchFieldFocus=function(){this.indicatorSearchField.addClass("active")},q5a.prototype.onIndicatorSearchFieldBlur=function(){this.indicatorSearchField.removeClass("active"),this.highlightedIndicator&&this.highlightedIndicator.removeClass("highlighted")},q5a.prototype.clearIndicatorSearch=function(){this.indicatorSearchField.val(""),this.highlightedIndicator=null,this.listIndicators()},q5a.prototype.listIndicators=function(t){var e,i,a=this;void 0===t&&(t=""),e=(t=this.indicatorSearchField.val())?(e=this.indicators.filter(function(e){return-1!==e.get("IndicatorName").toLowerCase().indexOf(t.toLowerCase())}),this.indicatorsSearchResults.reset(e)):this.indicators,this.indicatorsList.empty(),0<e.length?e.forEach(function(e){(i=$(document.createElement("li"))).text(e.get("IndicatorName")),i.wrapInner('<a href="#'+e.get("IndicatorCode")+'">'),a.indicatorsList.append(i)}):this.indicatorsList.append($("<p>",{text:"No matches found"})),_.defer(function(){a.indicatorsScrollPaneApi&&a.indicatorsScrollPaneApi.reinitialise()}),this.indicatorsList.find("a").each(function(e,t){var i=$(t);i.button().on("click",function(e){e.preventDefault(),a.onIndicatorMenuSelect(e,i)}),i.mouseup(function(){a.justOpened=!1})})},q5a),p5a,H6a,L6a,K6a;function q5a(e){var t=p5a.call(this,e)||this;return t.themeButtons=[],t.initialize2(e),t}H6a=jQuery,window,H6a.uaMatch=function(e){e=e.toLowerCase();e=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:e[1]||"",version:e[2]||"0"}},H6a.browser||(K6a={},(L6a=H6a.uaMatch(navigator.userAgent)).browser&&(K6a[L6a.browser]=!0,K6a.version=L6a.version),K6a.chrome?K6a.webkit=!0:K6a.webkit&&(K6a.safari=!0),H6a.browser=K6a);var App=(O6a=Backbone.View,__extends(P6a,O6a),P6a.prototype.addIndicators=function(e){function t(){a.chart.isStockLoaded?_.each(e,function(e){i=e.indicatorCode||IndicatorCalculator.getIndicatorCode(e.indicatorId),a.chart.indicatorsManager.addDefaultIndicator(i,e.parametersValues)}):setTimeout(t,100)}var i,a=this;this.chart&&this.chart.indicatorsManager&&t()},P6a.prototype.clearIndicators=function(){this.chart&&this.chart.indicatorsManager&&this.chart.indicatorsManager.clear()},P6a.prototype.disableSelect=function(e){$($(e).children()[0]).attr("unselectable","on").css("user-select","none").on("selectstart",!1)},P6a.prototype.changeAppThemeClassname=function(){var t=this,e=this.chartModel.get("currentTheme"),i=this.chartModel.get("supportedThemes");_.each(i,function(e){t.rootDiv.removeClass(e)}),this.rootDiv.addClass(e)},P6a.prototype.displayChart=function(e){this.displayChart2(e)},P6a.prototype.displayChart2=function(e){e&&this.chartToolbar?this.chartToolbar.selectSymbol(e):this.pendingSymbol=e},P6a.prototype.getDefaultChartModel=function(e){var t={};return this.isTouchDevice()&&(t.isMobile=!0,t.isTouch=!0),e.hasOwnProperty("api")&&(t.api=e.api),new ChartModel(t)},P6a.prototype.initialize=function(e){var a=Backbone.sync;if(this.api=e.api,this.options=e,Backbone.sync=function(e,t,i){return(i=i||{}).crossDomain||(i.crossDomain=!0),i.xhrFields||(i.xhrFields={withCredentials:!0}),a(e,t,i)},this.chartModel=this.getDefaultChartModel(e),e.settingsModel&&this.processComponentArgs(e),e.pendingPortalEvents&&0<e.pendingPortalEvents.length)for(var t=e.pendingPortalEvents.length-1;0<=t;t++)if("show-stock"===e.pendingPortalEvents[t].name){e.marketId=e.pendingPortalEvents[t].params.marketId;break}$(this.el).html(T.app()),this.rootDiv=this.$el.find(".ChartRoot"),this.chartDiv=this.$el.find(".ChartDiv"),this.chartToolbarDiv=this.$el.find(".ChartToolbar"),this.disclaimer=this.$el.find(".disclaimer"),this.$noData=this.$el.find(".no-data"),this.$noData.hide(),e.hasOwnProperty("renderedCallback")&&(this.renderedCallback=e.renderedCallback),this.disableSelect(document),this.initChart(),this.displayChart2(this.chartModel.get("marketId"))},P6a.prototype.initChart=function(){var e,i=this;if(this.changeAppThemeClassname(),this.chartModel.setColorsForCurrentTheme(!1),this.componetStyles){for(e in this.componetStyles)this.componetStyles.hasOwnProperty(e)&&null===this.componetStyles[e]&&(this.componetStyles[e]=this.chartModel.get(e));this.chartModel.set(this.componetStyles,{silent:!0}),this.componetStyles=null}this.currentTheme=this.chartModel.get("currentTheme"),this.listenTo(this.chartModel,"change:currentTheme",function(){return i.onCurrentThemeChanged()}),this.listenTo(this.chartModel,"change:fromDateDisplayVS",function(){var e=moment(i.chartModel.get("fromDateDisplayVS")).toISOString();i.api.getPropertyMeta("Basics.viewFrom")&&"viewstate"===i.api.getPropertyMeta("Basics.viewFrom").type&&i.api.setProperty("Basics.viewFrom",e)}),this.listenTo(this.chartModel,"change:toDateDisplayVS",function(){var e=moment(i.chartModel.get("toDateDisplayVS")).toISOString();i.api.getPropertyMeta("Basics.viewTo")&&"viewstate"===i.api.getPropertyMeta("Basics.viewTo").type&&i.api.setProperty("Basics.viewTo",e)}),this.chartModel.get("isMobile")&&this.$el.find(".ChartRoot").addClass("mobile"),this.chartModel.set("componentApi",this.api),this.chart=new Chart({el:this.chartDiv,model:this.chartModel});var t=$(this.chart);t.on("elementselected",function(e){return i.onChartElementSelected(e)}),t.on("priceRangeChanged",function(e){return $(i).trigger(e)}),t.on("pattern-selected-on-chart",function(e){$(i).trigger(e)}),t.on("chart-rendered",function(){$(i).trigger("chart-rendered",{type:"chart-rendered",symbol:i.chartModel.get("stockSymbol")}),i.renderedCallback&&i.renderedCallback()}),t.on("change-stock",function(e){i.displayChart(e.marketId)}),this.chartModel.on("change:granularity",function(){$(i).trigger("granularity-changed",{type:"granularity-changed",granularity:i.chartModel.get("granularity")})}),this.customToolbar&&$(this.customToolbar).on("addindicator",function(e,t){$.proxy(i.chart.addDefaultIndicator(t.indicatorCode),i.chart)}),this.initChartToolbar(),this.onResize()},P6a.prototype.initChartToolbar=function(){var i=this,e=(this.showChartToolbar||this.chartToolbarDiv.css({height:"0",overflow:"hidden"}),this.chartToolbar=new ChartToolbar({el:this.chartToolbarDiv,model:this.chartModel,chart:this.chart,pendingSymbol:this.pendingSymbol}),this.chart.chartToolbar=this.chartToolbar,$(this.chart)),e=(e.on("datesRangeChanged",function(e,t){$(i).trigger(t)}),e.on("zoomstop",function(e){i.chartToolbar.onZoomStop(e.startDate,e.endDate)}),e.on("periodenabled",function(e,t){i.chartToolbar.onPeriodDownloaded(e,t)}),e.on("appresize",function(){i.onResize()}),$(this.chartToolbar));e.on("remove-all-annotations",$.proxy(this.chart.clearAnnotationsForced,this.chart)),e.on("undo",$.proxy(this.chart.undoAnnotations,this.chart)),e.on("redo",$.proxy(this.chart.redoAnnotations,this.chart)),e.on("startzoom",$.proxy(this.chart.onStartZoom,this.chart)),e.on("stopzoom",$.proxy(this.chart.onStopZoom,this.chart)),e.on("startdrawing",function(e,t){$.proxy(i.chart.startDrawing(t),i.chart)}),e.on("levelcreated",function(e,t){$.proxy(i.chart.addLevel(t.level,t.levelType),i.chart)}),e.on("addindicator",function(e,t){$.proxy(i.chart.addDefaultIndicator(t.indicatorCode),i.chart)}),e.on("no-data",function(){i.$noData.show()}),e.on("data-ok",function(){i.$noData.hide()}),this.customToolbar&&e.on("minimisecustomtoolbar",$.proxy(this.customToolbar.minimiseCustomToolbar,this.customToolbar)),e.on("redraw",function(){i.chart.mainChartArea.onResize()}),this.chartToolbar.on("save-image",function(e){i.trigger("portal-event",{name:"save-chart-image",params:e.params})}),e.on("granularity-changed",function(e,t){$(this).trigger(e,t)})},P6a.prototype.initializeErrorHandler=function(e){var t=this;this.updateErrorMessage(e),this.listenTo(e,"change:error",function(){t.updateErrorMessage(e)})},P6a.prototype.isTouchDevice=function(){if("ontouchstart"in window)return!0;var e=["","-webkit-","-moz-","-o-","-ms-"].map(function(e){return"("+e+"touch-enabled)"});return window.matchMedia(e.join(",")).matches},P6a.prototype.onChartElementSelected=function(e){this.chartToolbar&&this.chartToolbar.showElementInfo(e.selectedItem)},P6a.prototype.onDashboardThemeChanged=function(e){var t,i;if(this.chartModel.set("currentTheme",e.theme||"dark"),!e.dontOverrideColors)for(t in i=this.settingsModel.get("Style"))i.hasOwnProperty(t)&&(i[t]=this.chartModel.get(t))},P6a.prototype.onDataSourceChange=function(i,e,t){var a,n=this;t?this.updateErrorMessageText(t):this.chart&&((e=_.clone(e)).change&&1<e.change.length&&(e.reset=e.items(),delete e.change,delete e.remove,delete e.add),e.reset&&(this.dataClone=null,this.dataClone=new Backbone.Collection,e.collection.each(function(e){n.dataClone.add(new Backbone.Model(e.toJSON()))})),t=_.remove(_.keys(e),function(e){return!_.includes(["collection","remove"],e)})[0],_.includes(["add","reset","change"],t)&&(e[t]=e[t].map(function(e){var t=Object.create(null);return Object.assign(t,e),!t.Time&&e.Date&&(t.Time=e.Date),t}),_.includes(["add","change"],t)&&_.each(e[t],function(t){var e=n.dataClone.find(function(e){return void 0!==e.get(i.primaryKey)&&e.get(i.primaryKey).toString()===t[i.primaryKey].toString()});e&&(t.Time&&"Time"!==i.primaryKey&&e.set({Time:t.Time}),t.Date&&"Date"!==i.primaryKey&&e.set({Date:t.Date}),e.get("Time")||e.set({Time:e.get("Date")}))})),e.reset?(e.reset=_.sortBy(e.reset,function(e){return e.Time.i}),1<e.reset.length&&(a=e.reset.pop()),this.dataSourceDataReset=e,this.onDataSourceReload(),a&&this.onDataSourceLivePrice(a)):!e.add&&!e.remove&&e.change&&1===e.change.length&&this.liveCandle&&(e.change[0].Date&&e.change[0].Date.i===this.liveCandle.Time.i||e.change[0].Time&&e.change[0].Time.i===this.liveCandle.Time.i)?(e.change[0].Time=e.change[0].Date||e.change[0].Time,this.onDataSourceLivePrice(e.change[0])):(e.add||e.remove)&&(this.liveCandle&&(this.liveCandle=null),this.chart.dynamicPricesManager.flush(),this.chart.mainChartArea.allSeries[0].displaySeries[0].clearLiveElement(),e.remove&&_.each(e.remove,function(t){var e=n.dataClone.find(function(e){return void 0!==e.get(i.primaryKey)&&e.get(i.primaryKey).toString()===t[i.primaryKey].toString()});n.dataClone.remove(e)}),e.add&&_.each(e.add,function(e){n.dataClone.add(new Backbone.Model(e))}),this.dataSourceDataReset={reset:_.map(this.dataClone.models,function(e){return e.attributes})},a=this.dataSourceDataReset.reset.pop(),this.onDataSourceReload(),this.onDataSourceLivePrice(a)))},P6a.prototype.onDataSourceLivePrice=function(e){var t;e&&(this.liveCandle=_.extend(this.liveCandle||{},e),t=QuickBase.Tools.convertKDBTemporalToMoment(e.Time),t=new Date(t.year(),t.month(),t.day()-1,t.hours(),t.minutes(),t.seconds()),this.chart.setLivePrice({marketId:this.chart.model.get("stockSymbol"),printedAt:t,bid:e.Open,offer:e.Open,volume:e.Volume}),this.chart.setLivePrice({marketId:this.chart.model.get("stockSymbol"),printedAt:t,bid:e.High,offer:e.High,volume:e.Volume}),this.chart.setLivePrice({marketId:this.chart.model.get("stockSymbol"),printedAt:t,bid:e.Low,offer:e.Low,volume:e.Volume}),this.chart.setLivePrice({marketId:this.chart.model.get("stockSymbol"),printedAt:t,bid:e.Close,offer:e.Close,volume:e.Volume}))},P6a.prototype.calcGranularity=function(){var e,t,i,a="OneMinute",n=0,o=this.dataSourceDataReset.reset;if(o&&o.length&&1<o.length&&(o[0].Date||o[0].Time)){for(var s=o.length,r=1;r<(o.length<10?o.length:10);r+=1){var l=o[s-r].Date||o[s-r].Time,d=o[s-(r+1)].Date||o[s-(r+1)].Time,l=QuickBase.Tools.convertKDBTemporalToMoment(l),d=QuickBase.Tools.convertKDBTemporalToMoment(d),l=l.diff(d).valueOf(),d=Math.abs(l);(!n||d<n)&&(n=d)}e=moment.duration(n).asMinutes(),t=moment.duration(n).asHours(),i=moment.duration(n).asDays(),e<=1?a="OneMinute":2<=e&&e<3?a="TwoMinute":3<=e&&e<5?a="ThreeMinute":5<=e&&e<15?a="FiveMinute":15<=e&&e<30?a="FifteenMinute":30<=e&&e<60?a="ThirtyMinute":4<=t&&t<24?a="FourHour":1<=i&&i<7?a="OneDay":7<=i&&i<30?a="OneWeek":30<=i&&(a="OneMonth")}return a},P6a.prototype.onDataSourceReload=function(e){var t,i=this;void 0===e&&(e=!1),this.dataSourceDataReset&&(t=this.calcGranularity(),this.chart.model.set({pinLastDataPoint:e},{silent:!0}),e||this.chartModel.set({fromDateDisplay:null,toDateDisplay:null},{silent:!0}),this.chart.beforeStockLoad(e),this.chartModel.get("stockSymbol")&&this.chartModel.get("granularity")===t||(this.chartModel.set("granularity",t),this.chart.stockDataProvider.getStock("XXX",t,this.chart.stockDataProvider.getDeltaGranularity(t),!0,null,null)),this.chart.stockDataProvider.onDataSourceData(this.dataSourceDataReset,function(e){e?i.$noData.show():i.$noData.hide(),i.chart.stockDataProvider.loadingData=!1,i.chart.indicatorsManager.updateIndicator()}),this.chart.infoBorder.clear())},P6a.prototype.onResize=function(){var e,t=0,i=this.$el.height(),i=(this.showChartToolbar&&(t=this.chartToolbarDiv.height(),this.chartToolbar.onResize(i)),i||0),a=this.showDisclaimer?this.disclaimer.outerHeight():0,n={};this.oldToolbarHeight!==t&&(n.top=t,this.oldToolbarHeight=t,e=!0),i=this.chartModel.get("isChartDimensionsActive")?this.chart.$el.height():i-(t+a),this.oldChartHeight!==i&&(n.height=i,this.oldChartHeight=i,e=!0),e&&this.chartDiv.css(n),this.chartModel.set({$appRoot:this.$el}),this.chart.onResize(),$("html").find(".charting.ui-dialog").each(function(e,t){t=$(t).find(".ui-dialog-content");t.dialog("isOpen")&&t.dialog("option","position",{my:"center",at:"center"})})},P6a.prototype.onSettingsChange=function(e){var t,i,a=this,n={};if(!_.isUndefined(e["Basics.crosshair"]))switch(e["Basics.crosshair"]){case"none":this.chartModel.set({showCrosshair:!1,snapToDataPoint:!1});break;case"price":this.chartModel.set({showCrosshair:!0,snapToDataPoint:!0});break;case"freeflow":this.chartModel.set({showCrosshair:!0,snapToDataPoint:!1})}_.isUndefined(e["Basics.showDisclaimer"])||(e["Basics.showDisclaimer"]?(this.showDisclaimer=!0,this.disclaimer&&this.disclaimer.css("display","block")):(this.showDisclaimer=!1,this.disclaimer&&this.disclaimer.css("display","none")),this.chart&&this.onResize()),_.isUndefined(e["Basics.stockDisplayType"])||this.chartModel.set("stockDisplayType",e["Basics.stockDisplayType"]),_.isUndefined(e["Basics.showVolume"])||this.chartModel.set("showVolume",e["Basics.showVolume"]),_.isUndefined(e["Basics.showInfoBorder"])||this.chartModel.set("showInfoBorder",e["Basics.showInfoBorder"]),_.isUndefined(e["Toolbar.showDrawMenu"])||this.chartModel.set("showDrawMenu",e["Toolbar.showDrawMenu"]),_.isUndefined(e["Toolbar.showIndicators"])||this.chartModel.set("showIndicators",e["Toolbar.showIndicators"]),_.isUndefined(e["Toolbar.showChartToolbar"])||(this.showChartToolbar=e["Toolbar.showChartToolbar"],this.showChartToolbar?this.chartToolbarDiv&&this.chartToolbarDiv.css({height:"",overflow:""}):this.chartToolbarDiv&&this.chartToolbarDiv.css({height:"0",overflow:"hidden"}),this.chart&&this.onResize()),_.each(e,function(e,t){0===t.indexOf("Style")&&(n[t.split(".")[1]]=e)}),_.isEmpty(n)||this.chartModel.set(n),!_.isUndefined(e["ViewState.Focus"])&&e["ViewState.Focus"]&&(this.chartToolbar?this.chartToolbar.selectSymbol(e["ViewState.Focus"]):this.chartModel.set("marketId",e["ViewState.Focus"])),_.isUndefined(e["Basics.data"])||(t=e["Basics.data"])!==this.dataSource&&(this.dataSource&&this.api.unsubscribe(this.dataSource),this.chartModel.set("init-data-loaded",!1),t?(this.chartModel.set("dataSource",t),this.initializeErrorHandler(t),this.dataSource=t,this.api.subscribe(t,function(e,t,i){a.onDataSourceChange(e,t,i)})):this.dataSource&&(this.dataSource=null,this.chartModel.set("dataSource",null),i=this.chartModel.get("marketId"),this.chartToolbar.selectSymbol(null),this.chartModel.set("stockSymbol",null),this.chart.clear(!0,!0,!0),this.chartToolbar.selectSymbol(i))),!_.isUndefined(e["Basics.viewFrom"])&&this.api.getProperty("Basics.viewFrom")&&(t=moment(e["Basics.viewFrom"]).toDate(),this.chart&&(this.chart.model.get("fromDateDisplay")?this.chart.displayRange(t,this.chart.model.get("toDateDisplayVS"),!0):this.chart.model.set({fromDateDisplayVS:t},{silent:!0}))),!_.isUndefined(e["Basics.viewTo"])&&this.api.getProperty("Basics.viewTo")&&(t=moment(e["Basics.viewTo"]).toDate(),this.chart&&(this.chart.model.get("toDateDisplay")?this.chart.displayRange(this.chart.model.get("fromDateDisplayVS"),t,!0):this.chart.model.set({toDateDisplayVS:t},{silent:!0}))),_.isUndefined(e["Basics.decimalPlaces"])||(i=this.chartModel.get("originalDecimalPlaces"),this.chartModel.set("originalDecimalPlaces",e["Basics.decimalPlaces"]),this.chartModel.set("mainChartAreaValuesAxisDecimalPlaces",e["Basics.decimalPlaces"]),i!==e["Basics.decimalPlaces"]&&this.onDataSourceReload()),_.isUndefined(e["Basics.annotations"])||this.chartModel.set("savedAnnotations",e["Basics.annotations"]),_.isUndefined(e["Basics.indicators"])||this.chartModel.set("saved_indicators",e["Basics.indicators"])},P6a.prototype.setOldOptions=function(){this.chartModel.set({marketId:null,customChartName:!1,showMainChartName:!1,showGranularityAsChartName:!1,showThemesOptions:!1,themeSettingsConfig:{currentTheme:"dark",supportedThemes:["light","dark"],supportedThemesUItext:["Light","Dark"]},viewOptions:[{displayName:"1 Minute",value:"OneMinute",defaultframe:1,isDefault:!0,momentKey:"minutes",momentValue:1,timeframes:[{displayName:"2 Hours",value:"TwoHours",momentKey:"hours",momentValue:2},{displayName:"4 Hours",value:"FourHours",momentKey:"hours",momentValue:4},{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3}]},{displayName:"2 Minutes",value:"TwoMinute",defaultframe:1,momentKey:"minutes",momentValue:2,timeframes:[{displayName:"2 Hours",value:"TwoHours",momentKey:"hours",momentValue:2},{displayName:"4 Hours",value:"FourHours",momentKey:"hours",momentValue:4},{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3}]},{displayName:"3 Minutes",value:"ThreeMinute",defaultframe:1,momentKey:"minutes",momentValue:3,timeframes:[{displayName:"2 Hours",value:"TwoHours",momentKey:"hours",momentValue:2},{displayName:"4 Hours",value:"FourHours",momentKey:"hours",momentValue:4},{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3}]},{displayName:"5 Minutes",value:"FiveMinute",defaultframe:2,momentKey:"minutes",momentValue:5,timeframes:[{displayName:"2 Hours",value:"TwoHours",momentKey:"hours",momentValue:2},{displayName:"4 Hours",value:"FourHours",momentKey:"hours",momentValue:4},{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3}]},{displayName:"15 Minutes",value:"FifteenMinute",defaultframe:2,momentKey:"minutes",momentValue:15,timeframes:[{displayName:"4 Hours",value:"FourHours",momentKey:"hours",momentValue:4},{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3},{displayName:"5 Days",value:"FiveDays",momentKey:"days",momentValue:5},{displayName:"10 Days",value:"TenDays",momentKey:"days",momentValue:10}]},{displayName:"30 Minutes",value:"ThirtyMinute",defaultframe:3,momentKey:"minutes",momentValue:30,timeframes:[{displayName:"4 Hours",value:"FourHours",momentKey:"hours",momentValue:4},{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3},{displayName:"5 Days",value:"FiveDays",momentKey:"days",momentValue:5},{displayName:"10 Days",value:"TenDays",momentKey:"days",momentValue:10}]},{displayName:"1 Hour",value:"SixtyMinute",defaultframe:3,momentKey:"minutes",momentValue:60,timeframes:[{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3},{displayName:"5 Days",value:"FiveDays",momentKey:"days",momentValue:5},{displayName:"10 Days",value:"TenDays",momentKey:"days",momentValue:10},{displayName:"1 Month",value:"OneMonth",momentKey:"months",momentValue:1},{displayName:"3 Months",value:"ThreeMonths",momentKey:"months",momentValue:3}]},{displayName:"4 Hours",value:"FourHour",defaultframe:2,momentKey:"hours",momentValue:4,timeframes:[{displayName:"5 Days",value:"FiveDays",momentKey:"days",momentValue:5},{displayName:"10 Days",value:"TenDays",momentKey:"days",momentValue:10},{displayName:"1 Month",value:"OneMonth",momentKey:"months",momentValue:1},{displayName:"3 Months",value:"ThreeMonths",momentKey:"months",momentValue:3},{displayName:"6 Months",value:"SixMonths",momentKey:"months",momentValue:6}]},{displayName:"Daily",value:"OneDay",defaultframe:2,momentKey:"days",momentValue:1,timeframes:[{displayName:"3 Months",value:"ThreeMonths",momentKey:"months",momentValue:3},{displayName:"6 Months",value:"SixMonths",momentKey:"months",momentValue:6},{displayName:"1 Year",value:"OneYear",momentKey:"years",momentValue:1},{displayName:"2 Years",value:"TwoYears",momentKey:"years",momentValue:2},{displayName:"3 Years",value:"ThreeYears",momentKey:"years",momentValue:3},{displayName:"5 Years",value:"FiveYears",momentKey:"years",momentValue:5},{displayName:"10 Years",value:"TenYears",momentKey:"years",momentValue:10}]},{displayName:"Weekly",value:"OneWeek",defaultframe:2,momentKey:"weeks",momentValue:1,timeframes:[{displayName:"6 Months",value:"SixMonths",momentKey:"months",momentValue:6},{displayName:"1 Year",value:"OneYear",momentKey:"years",momentValue:1},{displayName:"2 Years",value:"TwoYears",momentKey:"years",momentValue:2},{displayName:"3 Years",value:"ThreeYears",momentKey:"years",momentValue:3},{displayName:"5 Years",value:"FiveYears",momentKey:"years",momentValue:5},{displayName:"10 Years",value:"TenYears",momentKey:"years",momentValue:10}]},{displayName:"Monthly",value:"OneMonth",defaultframe:2,momentKey:"months",momentValue:1,timeframes:[{displayName:"2 Years",value:"TwoYears",momentKey:"years",momentValue:2},{displayName:"3 Years",value:"ThreeYears",momentKey:"years",momentValue:3},{displayName:"5 Years",value:"FiveYears",momentKey:"years",momentValue:5},{displayName:"10 Years",value:"TenYears",momentKey:"years",momentValue:10}]}]})},P6a.prototype.processComponentArgs=function(e){var i=this;e.settingsModel&&(this.settingsModel=e.settingsModel,this.viewModel=e.viewModel,this.dataModel=e.dataModel,this.api=e.api,this.dashboardAppModel=e.dashboardAppModel,this.dashboardViewModel=e.dashboardViewModel,this.componetStyles=e.settingsModel.get("Style"),this.setOldOptions(),this.loadValuesFromViewState(),this.onDashboardThemeChanged({dontOverrideColors:!0,theme:this.dashboardViewModel.get("DashboardTheme").toLowerCase()}),this.listenTo(this.chartModel,"change:stockDisplayType",function(e,t){i.onStockDisplayTypeChanged(e,t)}),this.listenTo(this.chartModel,"change:showInfoBorder",function(e,t){i.onShowInfoBorderChanged(e,t)}),this.listenTo(this.chartModel,"change:granularity",function(e,t){i.onGranularityChanged(e,t)}),this.listenTo(this.chartModel,"change:displayPeriod",function(e,t){i.onDisplayPeriodChanged(e,t)}),this.listenTo(this.chartModel,"change:stockSymbol",function(e,t){i.onStockSymbolChanged(e,t)}),this.listenTo(this.chartModel,"change:showCrosshair change:snapToDataPoint",function(){return i.onCrosshairChanged()}))},P6a.prototype.loadValuesFromViewState=function(){var e=this.settingsModel.get("Basics"),t=this.api.loadSetting("basics_crosshair");t&&(e.crosshair=t),t=null,(t=this.api.loadSetting("stockDisplayType"))&&(e.stockDisplayType=t),t=null,(t=this.api.loadSetting("showInfoBorder"))&&(e.showInfoBorder=t),t=null,(t=this.api.loadSetting("granularity"))&&this.chartModel.set({granularity:t},{silent:!0}),t=null,(t=this.api.loadSetting("displayPeriod"))&&this.chartModel.set({displayPeriod:t},{silent:!0}),t=null,(t=this.api.loadSetting("stockSymbol"))&&this.chartModel.set({marketId:t},{silent:!0})},P6a.prototype.onCrosshairChanged=function(){var e,t=this.chartModel.get("showCrosshair"),i=this.chartModel.get("snapToDataPoint");t||i?t&&i?e="price":t&&!i&&(e="freeflow"):e="none",e&&(this.api.saveSetting("basics_crosshair",e),t=$.extend({},this.settingsModel.get("Basics"),{crosshair:e}),this.settingsModel.set("Basics",t))},P6a.prototype.onStockDisplayTypeChanged=function(e,t){this.api.saveSetting("stockDisplayType",t);t=$.extend({},this.settingsModel.get("Basics"),{stockDisplayType:t});this.settingsModel.set("Basics",t)},P6a.prototype.onShowInfoBorderChanged=function(e,t){this.api.saveSetting("showInfoBorder",t);t=$.extend({},this.settingsModel.get("Basics"),{showInfoBorder:t});this.settingsModel.set("Basics",t)},P6a.prototype.onGranularityChanged=function(e,t){this.api.saveSetting("granularity",t)},P6a.prototype.onDisplayPeriodChanged=function(e,t){this.api.saveSetting("displayPeriod",t)},P6a.prototype.onStockSymbolChanged=function(e,t){this.api.saveSetting("stockSymbol",t),this.api.setProperty("ViewState.Focus",t)},P6a.prototype.remove=function(){return this.chart&&this.chart.remove(),Backbone.View.prototype.remove.apply(this)},P6a.prototype.setLivePrice=function(e){this.chart.setLivePrice({bid:e.bid,offer:e.offer,printedAt:e.printedAt,isFast:e.isFast,real:e.real,marketId:e.marketId,volume:e.volume})},P6a.prototype.setPricesRange=function(e,t,i,a){this.chart.setPricesRangePts(e,t,i,a)},P6a.prototype.setTheme=function(e){this.onDashboardThemeChanged({theme:e.toLowerCase()})},P6a.prototype.updateIndicator=function(e,t){this.chart&&this.chart.updateIndicatorByObjectID(e,t)},P6a.prototype.onCurrentThemeChanged=function(){this.changeAppThemeClassname(),this.chartModel.setColorsForCurrentTheme(!0),this.chart.mainChartArea.onResize(),this.currentTheme=this.chartModel.get("currentTheme")},P6a.prototype.updateErrorMessage=function(e){e.get("error")?this.updateErrorMessageText(e.get("error")):this.updateErrorMessageText()},P6a.prototype.updateErrorMessageText=function(e){(e=void 0===e?null:e)?this.api.showErrorMessage(e):this.api.hideErrorMessage()},P6a.getComponentDefinition=ComponentDefinition.getComponentDefinition,P6a),O6a;function P6a(){return null!==O6a&&O6a.apply(this,arguments)||this}return App});